var cQ=Object.defineProperty;var W3=n=>{throw TypeError(n)};var dQ=(n,e,t)=>e in n?cQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var W=(n,e,t)=>dQ(n,typeof e!="symbol"?e+"":e,t),uD=(n,e,t)=>e.has(n)||W3("Cannot "+t);var l=(n,e,t)=>(uD(n,e,"read from private field"),t?t.call(n):e.get(n)),A=(n,e,t)=>e.has(n)?W3("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),v=(n,e,t,s)=>(uD(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),E=(n,e,t)=>(uD(n,e,"access private method"),t);var vt=(n,e,t,s)=>({set _(i){v(n,e,i,t)},get _(){return l(n,e,s)}});function H8(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function uL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var V8={exports:{}},pL={},G8={exports:{}},Ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dE=Symbol.for("react.element"),hQ=Symbol.for("react.portal"),uQ=Symbol.for("react.fragment"),pQ=Symbol.for("react.strict_mode"),fQ=Symbol.for("react.profiler"),mQ=Symbol.for("react.provider"),gQ=Symbol.for("react.context"),xQ=Symbol.for("react.forward_ref"),yQ=Symbol.for("react.suspense"),bQ=Symbol.for("react.memo"),vQ=Symbol.for("react.lazy"),q3=Symbol.iterator;function wQ(n){return n===null||typeof n!="object"?null:(n=q3&&n[q3]||n["@@iterator"],typeof n=="function"?n:null)}var W8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},q8=Object.assign,Y8={};function U1(n,e,t){this.props=n,this.context=e,this.refs=Y8,this.updater=t||W8}U1.prototype.isReactComponent={};U1.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};U1.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function X8(){}X8.prototype=U1.prototype;function yO(n,e,t){this.props=n,this.context=e,this.refs=Y8,this.updater=t||W8}var bO=yO.prototype=new X8;bO.constructor=yO;q8(bO,U1.prototype);bO.isPureReactComponent=!0;var Y3=Array.isArray,K8=Object.prototype.hasOwnProperty,vO={current:null},Q8={key:!0,ref:!0,__self:!0,__source:!0};function J8(n,e,t){var s,i={},r=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)K8.call(e,s)&&!Q8.hasOwnProperty(s)&&(i[s]=e[s]);var c=arguments.length-2;if(c===1)i.children=t;else if(1<c){for(var d=Array(c),h=0;h<c;h++)d[h]=arguments[h+2];i.children=d}if(n&&n.defaultProps)for(s in c=n.defaultProps,c)i[s]===void 0&&(i[s]=c[s]);return{$$typeof:dE,type:n,key:r,ref:o,props:i,_owner:vO.current}}function SQ(n,e){return{$$typeof:dE,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function wO(n){return typeof n=="object"&&n!==null&&n.$$typeof===dE}function CQ(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var X3=/\/+/g;function pD(n,e){return typeof n=="object"&&n!==null&&n.key!=null?CQ(""+n.key):e.toString(36)}function Wk(n,e,t,s,i){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case dE:case hQ:o=!0}}if(o)return o=n,i=i(o),n=s===""?"."+pD(o,0):s,Y3(i)?(t="",n!=null&&(t=n.replace(X3,"$&/")+"/"),Wk(i,e,t,"",function(h){return h})):i!=null&&(wO(i)&&(i=SQ(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(X3,"$&/")+"/")+n)),e.push(i)),1;if(o=0,s=s===""?".":s+":",Y3(n))for(var c=0;c<n.length;c++){r=n[c];var d=s+pD(r,c);o+=Wk(r,e,t,d,i)}else if(d=wQ(n),typeof d=="function")for(n=d.call(n),c=0;!(r=n.next()).done;)r=r.value,d=s+pD(r,c++),o+=Wk(r,e,t,d,i);else if(r==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function UE(n,e,t){if(n==null)return n;var s=[],i=0;return Wk(n,s,"","",function(r){return e.call(t,r,i++)}),s}function NQ(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Wr={current:null},qk={transition:null},jQ={ReactCurrentDispatcher:Wr,ReactCurrentBatchConfig:qk,ReactCurrentOwner:vO};function Z8(){throw Error("act(...) is not supported in production builds of React.")}Ct.Children={map:UE,forEach:function(n,e,t){UE(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return UE(n,function(){e++}),e},toArray:function(n){return UE(n,function(e){return e})||[]},only:function(n){if(!wO(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ct.Component=U1;Ct.Fragment=uQ;Ct.Profiler=fQ;Ct.PureComponent=yO;Ct.StrictMode=pQ;Ct.Suspense=yQ;Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jQ;Ct.act=Z8;Ct.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=q8({},n.props),i=n.key,r=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=vO.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var c=n.type.defaultProps;for(d in e)K8.call(e,d)&&!Q8.hasOwnProperty(d)&&(s[d]=e[d]===void 0&&c!==void 0?c[d]:e[d])}var d=arguments.length-2;if(d===1)s.children=t;else if(1<d){c=Array(d);for(var h=0;h<d;h++)c[h]=arguments[h+2];s.children=c}return{$$typeof:dE,type:n.type,key:i,ref:r,props:s,_owner:o}};Ct.createContext=function(n){return n={$$typeof:gQ,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:mQ,_context:n},n.Consumer=n};Ct.createElement=J8;Ct.createFactory=function(n){var e=J8.bind(null,n);return e.type=n,e};Ct.createRef=function(){return{current:null}};Ct.forwardRef=function(n){return{$$typeof:xQ,render:n}};Ct.isValidElement=wO;Ct.lazy=function(n){return{$$typeof:vQ,_payload:{_status:-1,_result:n},_init:NQ}};Ct.memo=function(n,e){return{$$typeof:bQ,type:n,compare:e===void 0?null:e}};Ct.startTransition=function(n){var e=qk.transition;qk.transition={};try{n()}finally{qk.transition=e}};Ct.unstable_act=Z8;Ct.useCallback=function(n,e){return Wr.current.useCallback(n,e)};Ct.useContext=function(n){return Wr.current.useContext(n)};Ct.useDebugValue=function(){};Ct.useDeferredValue=function(n){return Wr.current.useDeferredValue(n)};Ct.useEffect=function(n,e){return Wr.current.useEffect(n,e)};Ct.useId=function(){return Wr.current.useId()};Ct.useImperativeHandle=function(n,e,t){return Wr.current.useImperativeHandle(n,e,t)};Ct.useInsertionEffect=function(n,e){return Wr.current.useInsertionEffect(n,e)};Ct.useLayoutEffect=function(n,e){return Wr.current.useLayoutEffect(n,e)};Ct.useMemo=function(n,e){return Wr.current.useMemo(n,e)};Ct.useReducer=function(n,e,t){return Wr.current.useReducer(n,e,t)};Ct.useRef=function(n){return Wr.current.useRef(n)};Ct.useState=function(n){return Wr.current.useState(n)};Ct.useSyncExternalStore=function(n,e,t){return Wr.current.useSyncExternalStore(n,e,t)};Ct.useTransition=function(){return Wr.current.useTransition()};Ct.version="18.3.1";G8.exports=Ct;var N=G8.exports;const Td=uL(N),AQ=H8({__proto__:null,default:Td},[N]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EQ=N,kQ=Symbol.for("react.element"),TQ=Symbol.for("react.fragment"),_Q=Object.prototype.hasOwnProperty,PQ=EQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,LQ={key:!0,ref:!0,__self:!0,__source:!0};function eH(n,e,t){var s,i={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)_Q.call(e,s)&&!LQ.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:kQ,type:n,key:r,ref:o,props:i,_owner:PQ.current}}pL.Fragment=TQ;pL.jsx=eH;pL.jsxs=eH;V8.exports=pL;var a=V8.exports,YR={},tH={exports:{}},Ao={},sH={exports:{}},nH={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e($,G){var ne=$.length;$.push(G);e:for(;0<ne;){var Z=ne-1>>>1,K=$[Z];if(0<i(K,G))$[Z]=G,$[ne]=K,ne=Z;else break e}}function t($){return $.length===0?null:$[0]}function s($){if($.length===0)return null;var G=$[0],ne=$.pop();if(ne!==G){$[0]=ne;e:for(var Z=0,K=$.length,X=K>>>1;Z<X;){var V=2*(Z+1)-1,q=$[V],ee=V+1,ie=$[ee];if(0>i(q,ne))ee<K&&0>i(ie,q)?($[Z]=ie,$[ee]=ne,Z=ee):($[Z]=q,$[V]=ne,Z=V);else if(ee<K&&0>i(ie,ne))$[Z]=ie,$[ee]=ne,Z=ee;else break e}}return G}function i($,G){var ne=$.sortIndex-G.sortIndex;return ne!==0?ne:$.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,c=o.now();n.unstable_now=function(){return o.now()-c}}var d=[],h=[],u=1,p=null,f=3,m=!1,x=!1,g=!1,b=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w($){for(var G=t(h);G!==null;){if(G.callback===null)s(h);else if(G.startTime<=$)s(h),G.sortIndex=G.expirationTime,e(d,G);else break;G=t(h)}}function S($){if(g=!1,w($),!x)if(t(d)!==null)x=!0,B(j);else{var G=t(h);G!==null&&U(S,G.startTime-$)}}function j($,G){x=!1,g&&(g=!1,y(_),_=-1),m=!0;var ne=f;try{for(w(G),p=t(d);p!==null&&(!(p.expirationTime>G)||$&&!P());){var Z=p.callback;if(typeof Z=="function"){p.callback=null,f=p.priorityLevel;var K=Z(p.expirationTime<=G);G=n.unstable_now(),typeof K=="function"?p.callback=K:p===t(d)&&s(d),w(G)}else s(d);p=t(d)}if(p!==null)var X=!0;else{var V=t(h);V!==null&&U(S,V.startTime-G),X=!1}return X}finally{p=null,f=ne,m=!1}}var T=!1,k=null,_=-1,L=5,D=-1;function P(){return!(n.unstable_now()-D<L)}function I(){if(k!==null){var $=n.unstable_now();D=$;var G=!0;try{G=k(!0,$)}finally{G?M():(T=!1,k=null)}}else T=!1}var M;if(typeof C=="function")M=function(){C(I)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,F=O.port2;O.port1.onmessage=I,M=function(){F.postMessage(null)}}else M=function(){b(I,0)};function B($){k=$,T||(T=!0,M())}function U($,G){_=b(function(){$(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function($){$.callback=null},n.unstable_continueExecution=function(){x||m||(x=!0,B(j))},n.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<$?Math.floor(1e3/$):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function($){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var ne=f;f=G;try{return $()}finally{f=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function($,G){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var ne=f;f=$;try{return G()}finally{f=ne}},n.unstable_scheduleCallback=function($,G,ne){var Z=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?Z+ne:Z):ne=Z,$){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=ne+K,$={id:u++,callback:G,priorityLevel:$,startTime:ne,expirationTime:K,sortIndex:-1},ne>Z?($.sortIndex=ne,e(h,$),t(d)===null&&$===t(h)&&(g?(y(_),_=-1):g=!0,U(S,ne-Z))):($.sortIndex=K,e(d,$),x||m||(x=!0,B(j))),$},n.unstable_shouldYield=P,n.unstable_wrapCallback=function($){var G=f;return function(){var ne=f;f=G;try{return $.apply(this,arguments)}finally{f=ne}}}})(nH);sH.exports=nH;var DQ=sH.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RQ=N,So=DQ;function le(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var iH=new Set,ZC={};function ey(n,e){v1(n,e),v1(n+"Capture",e)}function v1(n,e){for(ZC[n]=e,n=0;n<e.length;n++)iH.add(e[n])}var Tu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),XR=Object.prototype.hasOwnProperty,IQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,K3={},Q3={};function MQ(n){return XR.call(Q3,n)?!0:XR.call(K3,n)?!1:IQ.test(n)?Q3[n]=!0:(K3[n]=!0,!1)}function FQ(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function OQ(n,e,t,s){if(e===null||typeof e>"u"||FQ(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qr(n,e,t,s,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Xi[n]=new qr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Xi[e]=new qr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Xi[n]=new qr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Xi[n]=new qr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Xi[n]=new qr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Xi[n]=new qr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Xi[n]=new qr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Xi[n]=new qr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Xi[n]=new qr(n,5,!1,n.toLowerCase(),null,!1,!1)});var SO=/[\-:]([a-z])/g;function CO(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(SO,CO);Xi[e]=new qr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(SO,CO);Xi[e]=new qr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(SO,CO);Xi[e]=new qr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Xi[n]=new qr(n,1,!1,n.toLowerCase(),null,!1,!1)});Xi.xlinkHref=new qr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Xi[n]=new qr(n,1,!1,n.toLowerCase(),null,!0,!0)});function NO(n,e,t,s){var i=Xi.hasOwnProperty(e)?Xi[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(OQ(e,t,i,s)&&(t=null),s||i===null?MQ(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,s=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var zu=RQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zE=Symbol.for("react.element"),Fy=Symbol.for("react.portal"),Oy=Symbol.for("react.fragment"),jO=Symbol.for("react.strict_mode"),KR=Symbol.for("react.profiler"),rH=Symbol.for("react.provider"),aH=Symbol.for("react.context"),AO=Symbol.for("react.forward_ref"),QR=Symbol.for("react.suspense"),JR=Symbol.for("react.suspense_list"),EO=Symbol.for("react.memo"),tp=Symbol.for("react.lazy"),oH=Symbol.for("react.offscreen"),J3=Symbol.iterator;function nS(n){return n===null||typeof n!="object"?null:(n=J3&&n[J3]||n["@@iterator"],typeof n=="function"?n:null)}var an=Object.assign,fD;function MS(n){if(fD===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);fD=e&&e[1]||""}return`
`+fD+n}var mD=!1;function gD(n,e){if(!n||mD)return"";mD=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var s=h}Reflect.construct(n,[],e)}else{try{e.call()}catch(h){s=h}n.call(e.prototype)}else{try{throw Error()}catch(h){s=h}n()}}catch(h){if(h&&s&&typeof h.stack=="string"){for(var i=h.stack.split(`
`),r=s.stack.split(`
`),o=i.length-1,c=r.length-1;1<=o&&0<=c&&i[o]!==r[c];)c--;for(;1<=o&&0<=c;o--,c--)if(i[o]!==r[c]){if(o!==1||c!==1)do if(o--,c--,0>c||i[o]!==r[c]){var d=`
`+i[o].replace(" at new "," at ");return n.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",n.displayName)),d}while(1<=o&&0<=c);break}}}finally{mD=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?MS(n):""}function BQ(n){switch(n.tag){case 5:return MS(n.type);case 16:return MS("Lazy");case 13:return MS("Suspense");case 19:return MS("SuspenseList");case 0:case 2:case 15:return n=gD(n.type,!1),n;case 11:return n=gD(n.type.render,!1),n;case 1:return n=gD(n.type,!0),n;default:return""}}function ZR(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Oy:return"Fragment";case Fy:return"Portal";case KR:return"Profiler";case jO:return"StrictMode";case QR:return"Suspense";case JR:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case aH:return(n.displayName||"Context")+".Consumer";case rH:return(n._context.displayName||"Context")+".Provider";case AO:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case EO:return e=n.displayName||null,e!==null?e:ZR(n.type)||"Memo";case tp:e=n._payload,n=n._init;try{return ZR(n(e))}catch{}}return null}function $Q(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ZR(e);case 8:return e===jO?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function om(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function lH(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function UQ(n){var e=lH(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,r=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,r.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function HE(n){n._valueTracker||(n._valueTracker=UQ(n))}function cH(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=lH(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function k_(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function eI(n,e){var t=e.checked;return an({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Z3(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=om(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function dH(n,e){e=e.checked,e!=null&&NO(n,"checked",e,!1)}function tI(n,e){dH(n,e);var t=om(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?sI(n,e.type,t):e.hasOwnProperty("defaultValue")&&sI(n,e.type,om(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function e6(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function sI(n,e,t){(e!=="number"||k_(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var FS=Array.isArray;function ob(n,e,t,s){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&s&&(n[t].defaultSelected=!0)}else{for(t=""+om(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,s&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function nI(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(le(91));return an({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function t6(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(le(92));if(FS(t)){if(1<t.length)throw Error(le(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:om(t)}}function hH(n,e){var t=om(e.value),s=om(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function s6(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function uH(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function iI(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?uH(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var VE,pH=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(VE=VE||document.createElement("div"),VE.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=VE.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function eN(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var RC={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zQ=["Webkit","ms","Moz","O"];Object.keys(RC).forEach(function(n){zQ.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),RC[e]=RC[n]})});function fH(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||RC.hasOwnProperty(n)&&RC[n]?(""+e).trim():e+"px"}function mH(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,i=fH(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,i):n[t]=i}}var HQ=an({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rI(n,e){if(e){if(HQ[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(le(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(le(62))}}function aI(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oI=null;function kO(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var lI=null,lb=null,cb=null;function n6(n){if(n=pE(n)){if(typeof lI!="function")throw Error(le(280));var e=n.stateNode;e&&(e=yL(e),lI(n.stateNode,n.type,e))}}function gH(n){lb?cb?cb.push(n):cb=[n]:lb=n}function xH(){if(lb){var n=lb,e=cb;if(cb=lb=null,n6(n),e)for(n=0;n<e.length;n++)n6(e[n])}}function yH(n,e){return n(e)}function bH(){}var xD=!1;function vH(n,e,t){if(xD)return n(e,t);xD=!0;try{return yH(n,e,t)}finally{xD=!1,(lb!==null||cb!==null)&&(bH(),xH())}}function tN(n,e){var t=n.stateNode;if(t===null)return null;var s=yL(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(le(231,e,typeof t));return t}var cI=!1;if(Tu)try{var iS={};Object.defineProperty(iS,"passive",{get:function(){cI=!0}}),window.addEventListener("test",iS,iS),window.removeEventListener("test",iS,iS)}catch{cI=!1}function VQ(n,e,t,s,i,r,o,c,d){var h=Array.prototype.slice.call(arguments,3);try{e.apply(t,h)}catch(u){this.onError(u)}}var IC=!1,T_=null,__=!1,dI=null,GQ={onError:function(n){IC=!0,T_=n}};function WQ(n,e,t,s,i,r,o,c,d){IC=!1,T_=null,VQ.apply(GQ,arguments)}function qQ(n,e,t,s,i,r,o,c,d){if(WQ.apply(this,arguments),IC){if(IC){var h=T_;IC=!1,T_=null}else throw Error(le(198));__||(__=!0,dI=h)}}function ty(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function wH(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function i6(n){if(ty(n)!==n)throw Error(le(188))}function YQ(n){var e=n.alternate;if(!e){if(e=ty(n),e===null)throw Error(le(188));return e!==n?null:n}for(var t=n,s=e;;){var i=t.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){t=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===t)return i6(i),n;if(r===s)return i6(i),e;r=r.sibling}throw Error(le(188))}if(t.return!==s.return)t=i,s=r;else{for(var o=!1,c=i.child;c;){if(c===t){o=!0,t=i,s=r;break}if(c===s){o=!0,s=i,t=r;break}c=c.sibling}if(!o){for(c=r.child;c;){if(c===t){o=!0,t=r,s=i;break}if(c===s){o=!0,s=r,t=i;break}c=c.sibling}if(!o)throw Error(le(189))}}if(t.alternate!==s)throw Error(le(190))}if(t.tag!==3)throw Error(le(188));return t.stateNode.current===t?n:e}function SH(n){return n=YQ(n),n!==null?CH(n):null}function CH(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=CH(n);if(e!==null)return e;n=n.sibling}return null}var NH=So.unstable_scheduleCallback,r6=So.unstable_cancelCallback,XQ=So.unstable_shouldYield,KQ=So.unstable_requestPaint,Dn=So.unstable_now,QQ=So.unstable_getCurrentPriorityLevel,TO=So.unstable_ImmediatePriority,jH=So.unstable_UserBlockingPriority,P_=So.unstable_NormalPriority,JQ=So.unstable_LowPriority,AH=So.unstable_IdlePriority,fL=null,Cd=null;function ZQ(n){if(Cd&&typeof Cd.onCommitFiberRoot=="function")try{Cd.onCommitFiberRoot(fL,n,void 0,(n.current.flags&128)===128)}catch{}}var ac=Math.clz32?Math.clz32:sJ,eJ=Math.log,tJ=Math.LN2;function sJ(n){return n>>>=0,n===0?32:31-(eJ(n)/tJ|0)|0}var GE=64,WE=4194304;function OS(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function L_(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,i=n.suspendedLanes,r=n.pingedLanes,o=t&268435455;if(o!==0){var c=o&~i;c!==0?s=OS(c):(r&=o,r!==0&&(s=OS(r)))}else o=t&~i,o!==0?s=OS(o):r!==0&&(s=OS(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-ac(e),i=1<<t,s|=n[t],e&=~i;return s}function nJ(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iJ(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,i=n.expirationTimes,r=n.pendingLanes;0<r;){var o=31-ac(r),c=1<<o,d=i[o];d===-1?(!(c&t)||c&s)&&(i[o]=nJ(c,e)):d<=e&&(n.expiredLanes|=c),r&=~c}}function hI(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function EH(){var n=GE;return GE<<=1,!(GE&4194240)&&(GE=64),n}function yD(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function hE(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ac(e),n[e]=t}function rJ(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-ac(t),r=1<<i;e[i]=0,s[i]=-1,n[i]=-1,t&=~r}}function _O(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-ac(t),i=1<<s;i&e|n[s]&e&&(n[s]|=e),t&=~i}}var Kt=0;function kH(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var TH,PO,_H,PH,LH,uI=!1,qE=[],Qf=null,Jf=null,Zf=null,sN=new Map,nN=new Map,ip=[],aJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function a6(n,e){switch(n){case"focusin":case"focusout":Qf=null;break;case"dragenter":case"dragleave":Jf=null;break;case"mouseover":case"mouseout":Zf=null;break;case"pointerover":case"pointerout":sN.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":nN.delete(e.pointerId)}}function rS(n,e,t,s,i,r){return n===null||n.nativeEvent!==r?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=pE(e),e!==null&&PO(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function oJ(n,e,t,s,i){switch(e){case"focusin":return Qf=rS(Qf,n,e,t,s,i),!0;case"dragenter":return Jf=rS(Jf,n,e,t,s,i),!0;case"mouseover":return Zf=rS(Zf,n,e,t,s,i),!0;case"pointerover":var r=i.pointerId;return sN.set(r,rS(sN.get(r)||null,n,e,t,s,i)),!0;case"gotpointercapture":return r=i.pointerId,nN.set(r,rS(nN.get(r)||null,n,e,t,s,i)),!0}return!1}function DH(n){var e=Jm(n.target);if(e!==null){var t=ty(e);if(t!==null){if(e=t.tag,e===13){if(e=wH(t),e!==null){n.blockedOn=e,LH(n.priority,function(){_H(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Yk(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=pI(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);oI=s,t.target.dispatchEvent(s),oI=null}else return e=pE(t),e!==null&&PO(e),n.blockedOn=t,!1;e.shift()}return!0}function o6(n,e,t){Yk(n)&&t.delete(e)}function lJ(){uI=!1,Qf!==null&&Yk(Qf)&&(Qf=null),Jf!==null&&Yk(Jf)&&(Jf=null),Zf!==null&&Yk(Zf)&&(Zf=null),sN.forEach(o6),nN.forEach(o6)}function aS(n,e){n.blockedOn===e&&(n.blockedOn=null,uI||(uI=!0,So.unstable_scheduleCallback(So.unstable_NormalPriority,lJ)))}function iN(n){function e(i){return aS(i,n)}if(0<qE.length){aS(qE[0],n);for(var t=1;t<qE.length;t++){var s=qE[t];s.blockedOn===n&&(s.blockedOn=null)}}for(Qf!==null&&aS(Qf,n),Jf!==null&&aS(Jf,n),Zf!==null&&aS(Zf,n),sN.forEach(e),nN.forEach(e),t=0;t<ip.length;t++)s=ip[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<ip.length&&(t=ip[0],t.blockedOn===null);)DH(t),t.blockedOn===null&&ip.shift()}var db=zu.ReactCurrentBatchConfig,D_=!0;function cJ(n,e,t,s){var i=Kt,r=db.transition;db.transition=null;try{Kt=1,LO(n,e,t,s)}finally{Kt=i,db.transition=r}}function dJ(n,e,t,s){var i=Kt,r=db.transition;db.transition=null;try{Kt=4,LO(n,e,t,s)}finally{Kt=i,db.transition=r}}function LO(n,e,t,s){if(D_){var i=pI(n,e,t,s);if(i===null)kD(n,e,s,R_,t),a6(n,s);else if(oJ(i,n,e,t,s))s.stopPropagation();else if(a6(n,s),e&4&&-1<aJ.indexOf(n)){for(;i!==null;){var r=pE(i);if(r!==null&&TH(r),r=pI(n,e,t,s),r===null&&kD(n,e,s,R_,t),r===i)break;i=r}i!==null&&s.stopPropagation()}else kD(n,e,s,null,t)}}var R_=null;function pI(n,e,t,s){if(R_=null,n=kO(s),n=Jm(n),n!==null)if(e=ty(n),e===null)n=null;else if(t=e.tag,t===13){if(n=wH(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return R_=n,null}function RH(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(QQ()){case TO:return 1;case jH:return 4;case P_:case JQ:return 16;case AH:return 536870912;default:return 16}default:return 16}}var Yf=null,DO=null,Xk=null;function IH(){if(Xk)return Xk;var n,e=DO,t=e.length,s,i="value"in Yf?Yf.value:Yf.textContent,r=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(s=1;s<=o&&e[t-s]===i[r-s];s++);return Xk=i.slice(n,1<s?1-s:void 0)}function Kk(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function YE(){return!0}function l6(){return!1}function Eo(n){function e(t,s,i,r,o){this._reactName=t,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var c in n)n.hasOwnProperty(c)&&(t=n[c],this[c]=t?t(r):r[c]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?YE:l6,this.isPropagationStopped=l6,this}return an(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=YE)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=YE)},persist:function(){},isPersistent:YE}),e}var z1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},RO=Eo(z1),uE=an({},z1,{view:0,detail:0}),hJ=Eo(uE),bD,vD,oS,mL=an({},uE,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:IO,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==oS&&(oS&&n.type==="mousemove"?(bD=n.screenX-oS.screenX,vD=n.screenY-oS.screenY):vD=bD=0,oS=n),bD)},movementY:function(n){return"movementY"in n?n.movementY:vD}}),c6=Eo(mL),uJ=an({},mL,{dataTransfer:0}),pJ=Eo(uJ),fJ=an({},uE,{relatedTarget:0}),wD=Eo(fJ),mJ=an({},z1,{animationName:0,elapsedTime:0,pseudoElement:0}),gJ=Eo(mJ),xJ=an({},z1,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),yJ=Eo(xJ),bJ=an({},z1,{data:0}),d6=Eo(bJ),vJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function CJ(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=SJ[n])?!!e[n]:!1}function IO(){return CJ}var NJ=an({},uE,{key:function(n){if(n.key){var e=vJ[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Kk(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?wJ[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:IO,charCode:function(n){return n.type==="keypress"?Kk(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Kk(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),jJ=Eo(NJ),AJ=an({},mL,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),h6=Eo(AJ),EJ=an({},uE,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:IO}),kJ=Eo(EJ),TJ=an({},z1,{propertyName:0,elapsedTime:0,pseudoElement:0}),_J=Eo(TJ),PJ=an({},mL,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),LJ=Eo(PJ),DJ=[9,13,27,32],MO=Tu&&"CompositionEvent"in window,MC=null;Tu&&"documentMode"in document&&(MC=document.documentMode);var RJ=Tu&&"TextEvent"in window&&!MC,MH=Tu&&(!MO||MC&&8<MC&&11>=MC),u6=" ",p6=!1;function FH(n,e){switch(n){case"keyup":return DJ.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OH(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var By=!1;function IJ(n,e){switch(n){case"compositionend":return OH(e);case"keypress":return e.which!==32?null:(p6=!0,u6);case"textInput":return n=e.data,n===u6&&p6?null:n;default:return null}}function MJ(n,e){if(By)return n==="compositionend"||!MO&&FH(n,e)?(n=IH(),Xk=DO=Yf=null,By=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return MH&&e.locale!=="ko"?null:e.data;default:return null}}var FJ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function f6(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!FJ[n.type]:e==="textarea"}function BH(n,e,t,s){gH(s),e=I_(e,"onChange"),0<e.length&&(t=new RO("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var FC=null,rN=null;function OJ(n){KH(n,0)}function gL(n){var e=zy(n);if(cH(e))return n}function BJ(n,e){if(n==="change")return e}var $H=!1;if(Tu){var SD;if(Tu){var CD="oninput"in document;if(!CD){var m6=document.createElement("div");m6.setAttribute("oninput","return;"),CD=typeof m6.oninput=="function"}SD=CD}else SD=!1;$H=SD&&(!document.documentMode||9<document.documentMode)}function g6(){FC&&(FC.detachEvent("onpropertychange",UH),rN=FC=null)}function UH(n){if(n.propertyName==="value"&&gL(rN)){var e=[];BH(e,rN,n,kO(n)),vH(OJ,e)}}function $J(n,e,t){n==="focusin"?(g6(),FC=e,rN=t,FC.attachEvent("onpropertychange",UH)):n==="focusout"&&g6()}function UJ(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return gL(rN)}function zJ(n,e){if(n==="click")return gL(e)}function HJ(n,e){if(n==="input"||n==="change")return gL(e)}function VJ(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var lc=typeof Object.is=="function"?Object.is:VJ;function aN(n,e){if(lc(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var i=t[s];if(!XR.call(e,i)||!lc(n[i],e[i]))return!1}return!0}function x6(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function y6(n,e){var t=x6(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=x6(t)}}function zH(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?zH(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function HH(){for(var n=window,e=k_();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=k_(n.document)}return e}function FO(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function GJ(n){var e=HH(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&zH(t.ownerDocument.documentElement,t)){if(s!==null&&FO(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!n.extend&&r>s&&(i=s,s=r,r=i),i=y6(t,r);var o=y6(t,s);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),r>s?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var WJ=Tu&&"documentMode"in document&&11>=document.documentMode,$y=null,fI=null,OC=null,mI=!1;function b6(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;mI||$y==null||$y!==k_(s)||(s=$y,"selectionStart"in s&&FO(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),OC&&aN(OC,s)||(OC=s,s=I_(fI,"onSelect"),0<s.length&&(e=new RO("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=$y)))}function XE(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Uy={animationend:XE("Animation","AnimationEnd"),animationiteration:XE("Animation","AnimationIteration"),animationstart:XE("Animation","AnimationStart"),transitionend:XE("Transition","TransitionEnd")},ND={},VH={};Tu&&(VH=document.createElement("div").style,"AnimationEvent"in window||(delete Uy.animationend.animation,delete Uy.animationiteration.animation,delete Uy.animationstart.animation),"TransitionEvent"in window||delete Uy.transitionend.transition);function xL(n){if(ND[n])return ND[n];if(!Uy[n])return n;var e=Uy[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in VH)return ND[n]=e[t];return n}var GH=xL("animationend"),WH=xL("animationiteration"),qH=xL("animationstart"),YH=xL("transitionend"),XH=new Map,v6="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bm(n,e){XH.set(n,e),ey(e,[n])}for(var jD=0;jD<v6.length;jD++){var AD=v6[jD],qJ=AD.toLowerCase(),YJ=AD[0].toUpperCase()+AD.slice(1);bm(qJ,"on"+YJ)}bm(GH,"onAnimationEnd");bm(WH,"onAnimationIteration");bm(qH,"onAnimationStart");bm("dblclick","onDoubleClick");bm("focusin","onFocus");bm("focusout","onBlur");bm(YH,"onTransitionEnd");v1("onMouseEnter",["mouseout","mouseover"]);v1("onMouseLeave",["mouseout","mouseover"]);v1("onPointerEnter",["pointerout","pointerover"]);v1("onPointerLeave",["pointerout","pointerover"]);ey("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ey("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ey("onBeforeInput",["compositionend","keypress","textInput","paste"]);ey("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ey("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ey("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var BS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XJ=new Set("cancel close invalid load scroll toggle".split(" ").concat(BS));function w6(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,qQ(s,e,void 0,n),n.currentTarget=null}function KH(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var c=s[o],d=c.instance,h=c.currentTarget;if(c=c.listener,d!==r&&i.isPropagationStopped())break e;w6(i,c,h),r=d}else for(o=0;o<s.length;o++){if(c=s[o],d=c.instance,h=c.currentTarget,c=c.listener,d!==r&&i.isPropagationStopped())break e;w6(i,c,h),r=d}}}if(__)throw n=dI,__=!1,dI=null,n}function Ls(n,e){var t=e[vI];t===void 0&&(t=e[vI]=new Set);var s=n+"__bubble";t.has(s)||(QH(e,n,2,!1),t.add(s))}function ED(n,e,t){var s=0;e&&(s|=4),QH(t,n,s,e)}var KE="_reactListening"+Math.random().toString(36).slice(2);function oN(n){if(!n[KE]){n[KE]=!0,iH.forEach(function(t){t!=="selectionchange"&&(XJ.has(t)||ED(t,!1,n),ED(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[KE]||(e[KE]=!0,ED("selectionchange",!1,e))}}function QH(n,e,t,s){switch(RH(e)){case 1:var i=cJ;break;case 4:i=dJ;break;default:i=LO}t=i.bind(null,e,t,n),i=void 0,!cI||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function kD(n,e,t,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var c=s.stateNode.containerInfo;if(c===i||c.nodeType===8&&c.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var d=o.tag;if((d===3||d===4)&&(d=o.stateNode.containerInfo,d===i||d.nodeType===8&&d.parentNode===i))return;o=o.return}for(;c!==null;){if(o=Jm(c),o===null)return;if(d=o.tag,d===5||d===6){s=r=o;continue e}c=c.parentNode}}s=s.return}vH(function(){var h=r,u=kO(t),p=[];e:{var f=XH.get(n);if(f!==void 0){var m=RO,x=n;switch(n){case"keypress":if(Kk(t)===0)break e;case"keydown":case"keyup":m=jJ;break;case"focusin":x="focus",m=wD;break;case"focusout":x="blur",m=wD;break;case"beforeblur":case"afterblur":m=wD;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=c6;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=pJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=kJ;break;case GH:case WH:case qH:m=gJ;break;case YH:m=_J;break;case"scroll":m=hJ;break;case"wheel":m=LJ;break;case"copy":case"cut":case"paste":m=yJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=h6}var g=(e&4)!==0,b=!g&&n==="scroll",y=g?f!==null?f+"Capture":null:f;g=[];for(var C=h,w;C!==null;){w=C;var S=w.stateNode;if(w.tag===5&&S!==null&&(w=S,y!==null&&(S=tN(C,y),S!=null&&g.push(lN(C,S,w)))),b)break;C=C.return}0<g.length&&(f=new m(f,x,null,t,u),p.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==oI&&(x=t.relatedTarget||t.fromElement)&&(Jm(x)||x[_u]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(x=t.relatedTarget||t.toElement,m=h,x=x?Jm(x):null,x!==null&&(b=ty(x),x!==b||x.tag!==5&&x.tag!==6)&&(x=null)):(m=null,x=h),m!==x)){if(g=c6,S="onMouseLeave",y="onMouseEnter",C="mouse",(n==="pointerout"||n==="pointerover")&&(g=h6,S="onPointerLeave",y="onPointerEnter",C="pointer"),b=m==null?f:zy(m),w=x==null?f:zy(x),f=new g(S,C+"leave",m,t,u),f.target=b,f.relatedTarget=w,S=null,Jm(u)===h&&(g=new g(y,C+"enter",x,t,u),g.target=w,g.relatedTarget=b,S=g),b=S,m&&x)t:{for(g=m,y=x,C=0,w=g;w;w=dy(w))C++;for(w=0,S=y;S;S=dy(S))w++;for(;0<C-w;)g=dy(g),C--;for(;0<w-C;)y=dy(y),w--;for(;C--;){if(g===y||y!==null&&g===y.alternate)break t;g=dy(g),y=dy(y)}g=null}else g=null;m!==null&&S6(p,f,m,g,!1),x!==null&&b!==null&&S6(p,b,x,g,!0)}}e:{if(f=h?zy(h):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var j=BJ;else if(f6(f))if($H)j=HJ;else{j=UJ;var T=$J}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(j=zJ);if(j&&(j=j(n,h))){BH(p,j,t,u);break e}T&&T(n,f,h),n==="focusout"&&(T=f._wrapperState)&&T.controlled&&f.type==="number"&&sI(f,"number",f.value)}switch(T=h?zy(h):window,n){case"focusin":(f6(T)||T.contentEditable==="true")&&($y=T,fI=h,OC=null);break;case"focusout":OC=fI=$y=null;break;case"mousedown":mI=!0;break;case"contextmenu":case"mouseup":case"dragend":mI=!1,b6(p,t,u);break;case"selectionchange":if(WJ)break;case"keydown":case"keyup":b6(p,t,u)}var k;if(MO)e:{switch(n){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else By?FH(n,t)&&(_="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(MH&&t.locale!=="ko"&&(By||_!=="onCompositionStart"?_==="onCompositionEnd"&&By&&(k=IH()):(Yf=u,DO="value"in Yf?Yf.value:Yf.textContent,By=!0)),T=I_(h,_),0<T.length&&(_=new d6(_,n,null,t,u),p.push({event:_,listeners:T}),k?_.data=k:(k=OH(t),k!==null&&(_.data=k)))),(k=RJ?IJ(n,t):MJ(n,t))&&(h=I_(h,"onBeforeInput"),0<h.length&&(u=new d6("onBeforeInput","beforeinput",null,t,u),p.push({event:u,listeners:h}),u.data=k))}KH(p,e)})}function lN(n,e,t){return{instance:n,listener:e,currentTarget:t}}function I_(n,e){for(var t=e+"Capture",s=[];n!==null;){var i=n,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=tN(n,t),r!=null&&s.unshift(lN(n,r,i)),r=tN(n,e),r!=null&&s.push(lN(n,r,i))),n=n.return}return s}function dy(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function S6(n,e,t,s,i){for(var r=e._reactName,o=[];t!==null&&t!==s;){var c=t,d=c.alternate,h=c.stateNode;if(d!==null&&d===s)break;c.tag===5&&h!==null&&(c=h,i?(d=tN(t,r),d!=null&&o.unshift(lN(t,d,c))):i||(d=tN(t,r),d!=null&&o.push(lN(t,d,c)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var KJ=/\r\n?/g,QJ=/\u0000|\uFFFD/g;function C6(n){return(typeof n=="string"?n:""+n).replace(KJ,`
`).replace(QJ,"")}function QE(n,e,t){if(e=C6(e),C6(n)!==e&&t)throw Error(le(425))}function M_(){}var gI=null,xI=null;function yI(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var bI=typeof setTimeout=="function"?setTimeout:void 0,JJ=typeof clearTimeout=="function"?clearTimeout:void 0,N6=typeof Promise=="function"?Promise:void 0,ZJ=typeof queueMicrotask=="function"?queueMicrotask:typeof N6<"u"?function(n){return N6.resolve(null).then(n).catch(eZ)}:bI;function eZ(n){setTimeout(function(){throw n})}function TD(n,e){var t=e,s=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(s===0){n.removeChild(i),iN(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=i}while(t);iN(e)}function em(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function j6(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var H1=Math.random().toString(36).slice(2),xd="__reactFiber$"+H1,cN="__reactProps$"+H1,_u="__reactContainer$"+H1,vI="__reactEvents$"+H1,tZ="__reactListeners$"+H1,sZ="__reactHandles$"+H1;function Jm(n){var e=n[xd];if(e)return e;for(var t=n.parentNode;t;){if(e=t[_u]||t[xd]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=j6(n);n!==null;){if(t=n[xd])return t;n=j6(n)}return e}n=t,t=n.parentNode}return null}function pE(n){return n=n[xd]||n[_u],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function zy(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(le(33))}function yL(n){return n[cN]||null}var wI=[],Hy=-1;function vm(n){return{current:n}}function Is(n){0>Hy||(n.current=wI[Hy],wI[Hy]=null,Hy--)}function Ts(n,e){Hy++,wI[Hy]=n.current,n.current=e}var lm={},Sr=vm(lm),xa=vm(!1),O0=lm;function w1(n,e){var t=n.type.contextTypes;if(!t)return lm;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in t)i[r]=e[r];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ya(n){return n=n.childContextTypes,n!=null}function F_(){Is(xa),Is(Sr)}function A6(n,e,t){if(Sr.current!==lm)throw Error(le(168));Ts(Sr,e),Ts(xa,t)}function JH(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(le(108,$Q(n)||"Unknown",i));return an({},t,s)}function O_(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||lm,O0=Sr.current,Ts(Sr,n),Ts(xa,xa.current),!0}function E6(n,e,t){var s=n.stateNode;if(!s)throw Error(le(169));t?(n=JH(n,e,O0),s.__reactInternalMemoizedMergedChildContext=n,Is(xa),Is(Sr),Ts(Sr,n)):Is(xa),Ts(xa,t)}var Jd=null,bL=!1,_D=!1;function ZH(n){Jd===null?Jd=[n]:Jd.push(n)}function nZ(n){bL=!0,ZH(n)}function wm(){if(!_D&&Jd!==null){_D=!0;var n=0,e=Kt;try{var t=Jd;for(Kt=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}Jd=null,bL=!1}catch(i){throw Jd!==null&&(Jd=Jd.slice(n+1)),NH(TO,wm),i}finally{Kt=e,_D=!1}}return null}var Vy=[],Gy=0,B_=null,$_=0,il=[],rl=0,B0=null,mu=1,gu="";function Mm(n,e){Vy[Gy++]=$_,Vy[Gy++]=B_,B_=n,$_=e}function eV(n,e,t){il[rl++]=mu,il[rl++]=gu,il[rl++]=B0,B0=n;var s=mu;n=gu;var i=32-ac(s)-1;s&=~(1<<i),t+=1;var r=32-ac(e)+i;if(30<r){var o=i-i%5;r=(s&(1<<o)-1).toString(32),s>>=o,i-=o,mu=1<<32-ac(e)+i|t<<i|s,gu=r+n}else mu=1<<r|t<<i|s,gu=n}function OO(n){n.return!==null&&(Mm(n,1),eV(n,1,0))}function BO(n){for(;n===B_;)B_=Vy[--Gy],Vy[Gy]=null,$_=Vy[--Gy],Vy[Gy]=null;for(;n===B0;)B0=il[--rl],il[rl]=null,gu=il[--rl],il[rl]=null,mu=il[--rl],il[rl]=null}var xo=null,go=null,Gs=!1,sc=null;function tV(n,e){var t=hl(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function k6(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,xo=n,go=em(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,xo=n,go=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=B0!==null?{id:mu,overflow:gu}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=hl(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,xo=n,go=null,!0):!1;default:return!1}}function SI(n){return(n.mode&1)!==0&&(n.flags&128)===0}function CI(n){if(Gs){var e=go;if(e){var t=e;if(!k6(n,e)){if(SI(n))throw Error(le(418));e=em(t.nextSibling);var s=xo;e&&k6(n,e)?tV(s,t):(n.flags=n.flags&-4097|2,Gs=!1,xo=n)}}else{if(SI(n))throw Error(le(418));n.flags=n.flags&-4097|2,Gs=!1,xo=n}}}function T6(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;xo=n}function JE(n){if(n!==xo)return!1;if(!Gs)return T6(n),Gs=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!yI(n.type,n.memoizedProps)),e&&(e=go)){if(SI(n))throw sV(),Error(le(418));for(;e;)tV(n,e),e=em(e.nextSibling)}if(T6(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(le(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){go=em(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}go=null}}else go=xo?em(n.stateNode.nextSibling):null;return!0}function sV(){for(var n=go;n;)n=em(n.nextSibling)}function S1(){go=xo=null,Gs=!1}function $O(n){sc===null?sc=[n]:sc.push(n)}var iZ=zu.ReactCurrentBatchConfig;function lS(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(le(309));var s=t.stateNode}if(!s)throw Error(le(147,n));var i=s,r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var c=i.refs;o===null?delete c[r]:c[r]=o},e._stringRef=r,e)}if(typeof n!="string")throw Error(le(284));if(!t._owner)throw Error(le(290,n))}return n}function ZE(n,e){throw n=Object.prototype.toString.call(e),Error(le(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function _6(n){var e=n._init;return e(n._payload)}function nV(n){function e(y,C){if(n){var w=y.deletions;w===null?(y.deletions=[C],y.flags|=16):w.push(C)}}function t(y,C){if(!n)return null;for(;C!==null;)e(y,C),C=C.sibling;return null}function s(y,C){for(y=new Map;C!==null;)C.key!==null?y.set(C.key,C):y.set(C.index,C),C=C.sibling;return y}function i(y,C){return y=im(y,C),y.index=0,y.sibling=null,y}function r(y,C,w){return y.index=w,n?(w=y.alternate,w!==null?(w=w.index,w<C?(y.flags|=2,C):w):(y.flags|=2,C)):(y.flags|=1048576,C)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function c(y,C,w,S){return C===null||C.tag!==6?(C=FD(w,y.mode,S),C.return=y,C):(C=i(C,w),C.return=y,C)}function d(y,C,w,S){var j=w.type;return j===Oy?u(y,C,w.props.children,S,w.key):C!==null&&(C.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===tp&&_6(j)===C.type)?(S=i(C,w.props),S.ref=lS(y,C,w),S.return=y,S):(S=nT(w.type,w.key,w.props,null,y.mode,S),S.ref=lS(y,C,w),S.return=y,S)}function h(y,C,w,S){return C===null||C.tag!==4||C.stateNode.containerInfo!==w.containerInfo||C.stateNode.implementation!==w.implementation?(C=OD(w,y.mode,S),C.return=y,C):(C=i(C,w.children||[]),C.return=y,C)}function u(y,C,w,S,j){return C===null||C.tag!==7?(C=R0(w,y.mode,S,j),C.return=y,C):(C=i(C,w),C.return=y,C)}function p(y,C,w){if(typeof C=="string"&&C!==""||typeof C=="number")return C=FD(""+C,y.mode,w),C.return=y,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case zE:return w=nT(C.type,C.key,C.props,null,y.mode,w),w.ref=lS(y,null,C),w.return=y,w;case Fy:return C=OD(C,y.mode,w),C.return=y,C;case tp:var S=C._init;return p(y,S(C._payload),w)}if(FS(C)||nS(C))return C=R0(C,y.mode,w,null),C.return=y,C;ZE(y,C)}return null}function f(y,C,w,S){var j=C!==null?C.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return j!==null?null:c(y,C,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case zE:return w.key===j?d(y,C,w,S):null;case Fy:return w.key===j?h(y,C,w,S):null;case tp:return j=w._init,f(y,C,j(w._payload),S)}if(FS(w)||nS(w))return j!==null?null:u(y,C,w,S,null);ZE(y,w)}return null}function m(y,C,w,S,j){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(w)||null,c(C,y,""+S,j);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case zE:return y=y.get(S.key===null?w:S.key)||null,d(C,y,S,j);case Fy:return y=y.get(S.key===null?w:S.key)||null,h(C,y,S,j);case tp:var T=S._init;return m(y,C,w,T(S._payload),j)}if(FS(S)||nS(S))return y=y.get(w)||null,u(C,y,S,j,null);ZE(C,S)}return null}function x(y,C,w,S){for(var j=null,T=null,k=C,_=C=0,L=null;k!==null&&_<w.length;_++){k.index>_?(L=k,k=null):L=k.sibling;var D=f(y,k,w[_],S);if(D===null){k===null&&(k=L);break}n&&k&&D.alternate===null&&e(y,k),C=r(D,C,_),T===null?j=D:T.sibling=D,T=D,k=L}if(_===w.length)return t(y,k),Gs&&Mm(y,_),j;if(k===null){for(;_<w.length;_++)k=p(y,w[_],S),k!==null&&(C=r(k,C,_),T===null?j=k:T.sibling=k,T=k);return Gs&&Mm(y,_),j}for(k=s(y,k);_<w.length;_++)L=m(k,y,_,w[_],S),L!==null&&(n&&L.alternate!==null&&k.delete(L.key===null?_:L.key),C=r(L,C,_),T===null?j=L:T.sibling=L,T=L);return n&&k.forEach(function(P){return e(y,P)}),Gs&&Mm(y,_),j}function g(y,C,w,S){var j=nS(w);if(typeof j!="function")throw Error(le(150));if(w=j.call(w),w==null)throw Error(le(151));for(var T=j=null,k=C,_=C=0,L=null,D=w.next();k!==null&&!D.done;_++,D=w.next()){k.index>_?(L=k,k=null):L=k.sibling;var P=f(y,k,D.value,S);if(P===null){k===null&&(k=L);break}n&&k&&P.alternate===null&&e(y,k),C=r(P,C,_),T===null?j=P:T.sibling=P,T=P,k=L}if(D.done)return t(y,k),Gs&&Mm(y,_),j;if(k===null){for(;!D.done;_++,D=w.next())D=p(y,D.value,S),D!==null&&(C=r(D,C,_),T===null?j=D:T.sibling=D,T=D);return Gs&&Mm(y,_),j}for(k=s(y,k);!D.done;_++,D=w.next())D=m(k,y,_,D.value,S),D!==null&&(n&&D.alternate!==null&&k.delete(D.key===null?_:D.key),C=r(D,C,_),T===null?j=D:T.sibling=D,T=D);return n&&k.forEach(function(I){return e(y,I)}),Gs&&Mm(y,_),j}function b(y,C,w,S){if(typeof w=="object"&&w!==null&&w.type===Oy&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case zE:e:{for(var j=w.key,T=C;T!==null;){if(T.key===j){if(j=w.type,j===Oy){if(T.tag===7){t(y,T.sibling),C=i(T,w.props.children),C.return=y,y=C;break e}}else if(T.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===tp&&_6(j)===T.type){t(y,T.sibling),C=i(T,w.props),C.ref=lS(y,T,w),C.return=y,y=C;break e}t(y,T);break}else e(y,T);T=T.sibling}w.type===Oy?(C=R0(w.props.children,y.mode,S,w.key),C.return=y,y=C):(S=nT(w.type,w.key,w.props,null,y.mode,S),S.ref=lS(y,C,w),S.return=y,y=S)}return o(y);case Fy:e:{for(T=w.key;C!==null;){if(C.key===T)if(C.tag===4&&C.stateNode.containerInfo===w.containerInfo&&C.stateNode.implementation===w.implementation){t(y,C.sibling),C=i(C,w.children||[]),C.return=y,y=C;break e}else{t(y,C);break}else e(y,C);C=C.sibling}C=OD(w,y.mode,S),C.return=y,y=C}return o(y);case tp:return T=w._init,b(y,C,T(w._payload),S)}if(FS(w))return x(y,C,w,S);if(nS(w))return g(y,C,w,S);ZE(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,C!==null&&C.tag===6?(t(y,C.sibling),C=i(C,w),C.return=y,y=C):(t(y,C),C=FD(w,y.mode,S),C.return=y,y=C),o(y)):t(y,C)}return b}var C1=nV(!0),iV=nV(!1),U_=vm(null),z_=null,Wy=null,UO=null;function zO(){UO=Wy=z_=null}function HO(n){var e=U_.current;Is(U_),n._currentValue=e}function NI(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function hb(n,e){z_=n,UO=Wy=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(ga=!0),n.firstContext=null)}function ml(n){var e=n._currentValue;if(UO!==n)if(n={context:n,memoizedValue:e,next:null},Wy===null){if(z_===null)throw Error(le(308));Wy=n,z_.dependencies={lanes:0,firstContext:n}}else Wy=Wy.next=n;return e}var Zm=null;function VO(n){Zm===null?Zm=[n]:Zm.push(n)}function rV(n,e,t,s){var i=e.interleaved;return i===null?(t.next=t,VO(e)):(t.next=i.next,i.next=t),e.interleaved=t,Pu(n,s)}function Pu(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var sp=!1;function GO(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aV(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function vu(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function tm(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,Pt&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,Pu(n,t)}return i=s.interleaved,i===null?(e.next=e,VO(s)):(e.next=i.next,i.next=e),s.interleaved=e,Pu(n,t)}function Qk(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,_O(n,t)}}function P6(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var i=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?i=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?i=r=e:r=r.next=e}else i=r=e;t={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function H_(n,e,t,s){var i=n.updateQueue;sp=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,c=i.shared.pending;if(c!==null){i.shared.pending=null;var d=c,h=d.next;d.next=null,o===null?r=h:o.next=h,o=d;var u=n.alternate;u!==null&&(u=u.updateQueue,c=u.lastBaseUpdate,c!==o&&(c===null?u.firstBaseUpdate=h:c.next=h,u.lastBaseUpdate=d))}if(r!==null){var p=i.baseState;o=0,u=h=d=null,c=r;do{var f=c.lane,m=c.eventTime;if((s&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var x=n,g=c;switch(f=e,m=t,g.tag){case 1:if(x=g.payload,typeof x=="function"){p=x.call(m,p,f);break e}p=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,f=typeof x=="function"?x.call(m,p,f):x,f==null)break e;p=an({},p,f);break e;case 2:sp=!0}}c.callback!==null&&c.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[c]:f.push(c))}else m={eventTime:m,lane:f,tag:c.tag,payload:c.payload,callback:c.callback,next:null},u===null?(h=u=m,d=p):u=u.next=m,o|=f;if(c=c.next,c===null){if(c=i.shared.pending,c===null)break;f=c,c=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(d=p),i.baseState=d,i.firstBaseUpdate=h,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);U0|=o,n.lanes=o,n.memoizedState=p}}function L6(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],i=s.callback;if(i!==null){if(s.callback=null,s=t,typeof i!="function")throw Error(le(191,i));i.call(s)}}}var fE={},Nd=vm(fE),dN=vm(fE),hN=vm(fE);function eg(n){if(n===fE)throw Error(le(174));return n}function WO(n,e){switch(Ts(hN,e),Ts(dN,n),Ts(Nd,fE),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:iI(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=iI(e,n)}Is(Nd),Ts(Nd,e)}function N1(){Is(Nd),Is(dN),Is(hN)}function oV(n){eg(hN.current);var e=eg(Nd.current),t=iI(e,n.type);e!==t&&(Ts(dN,n),Ts(Nd,t))}function qO(n){dN.current===n&&(Is(Nd),Is(dN))}var en=vm(0);function V_(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var PD=[];function YO(){for(var n=0;n<PD.length;n++)PD[n]._workInProgressVersionPrimary=null;PD.length=0}var Jk=zu.ReactCurrentDispatcher,LD=zu.ReactCurrentBatchConfig,$0=0,nn=null,Zn=null,bi=null,G_=!1,BC=!1,uN=0,rZ=0;function Zi(){throw Error(le(321))}function XO(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!lc(n[t],e[t]))return!1;return!0}function KO(n,e,t,s,i,r){if($0=r,nn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jk.current=n===null||n.memoizedState===null?cZ:dZ,n=t(s,i),BC){r=0;do{if(BC=!1,uN=0,25<=r)throw Error(le(301));r+=1,bi=Zn=null,e.updateQueue=null,Jk.current=hZ,n=t(s,i)}while(BC)}if(Jk.current=W_,e=Zn!==null&&Zn.next!==null,$0=0,bi=Zn=nn=null,G_=!1,e)throw Error(le(300));return n}function QO(){var n=uN!==0;return uN=0,n}function Cc(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bi===null?nn.memoizedState=bi=n:bi=bi.next=n,bi}function gl(){if(Zn===null){var n=nn.alternate;n=n!==null?n.memoizedState:null}else n=Zn.next;var e=bi===null?nn.memoizedState:bi.next;if(e!==null)bi=e,Zn=n;else{if(n===null)throw Error(le(310));Zn=n,n={memoizedState:Zn.memoizedState,baseState:Zn.baseState,baseQueue:Zn.baseQueue,queue:Zn.queue,next:null},bi===null?nn.memoizedState=bi=n:bi=bi.next=n}return bi}function pN(n,e){return typeof e=="function"?e(n):e}function DD(n){var e=gl(),t=e.queue;if(t===null)throw Error(le(311));t.lastRenderedReducer=n;var s=Zn,i=s.baseQueue,r=t.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}s.baseQueue=i=r,t.pending=null}if(i!==null){r=i.next,s=s.baseState;var c=o=null,d=null,h=r;do{var u=h.lane;if(($0&u)===u)d!==null&&(d=d.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),s=h.hasEagerState?h.eagerState:n(s,h.action);else{var p={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};d===null?(c=d=p,o=s):d=d.next=p,nn.lanes|=u,U0|=u}h=h.next}while(h!==null&&h!==r);d===null?o=s:d.next=c,lc(s,e.memoizedState)||(ga=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=d,t.lastRenderedState=s}if(n=t.interleaved,n!==null){i=n;do r=i.lane,nn.lanes|=r,U0|=r,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function RD(n){var e=gl(),t=e.queue;if(t===null)throw Error(le(311));t.lastRenderedReducer=n;var s=t.dispatch,i=t.pending,r=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do r=n(r,o.action),o=o.next;while(o!==i);lc(r,e.memoizedState)||(ga=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,s]}function lV(){}function cV(n,e){var t=nn,s=gl(),i=e(),r=!lc(s.memoizedState,i);if(r&&(s.memoizedState=i,ga=!0),s=s.queue,JO(uV.bind(null,t,s,n),[n]),s.getSnapshot!==e||r||bi!==null&&bi.memoizedState.tag&1){if(t.flags|=2048,fN(9,hV.bind(null,t,s,i,e),void 0,null),vi===null)throw Error(le(349));$0&30||dV(t,e,i)}return i}function dV(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=nn.updateQueue,e===null?(e={lastEffect:null,stores:null},nn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function hV(n,e,t,s){e.value=t,e.getSnapshot=s,pV(e)&&fV(n)}function uV(n,e,t){return t(function(){pV(e)&&fV(n)})}function pV(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!lc(n,t)}catch{return!0}}function fV(n){var e=Pu(n,1);e!==null&&oc(e,n,1,-1)}function D6(n){var e=Cc();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pN,lastRenderedState:n},e.queue=n,n=n.dispatch=lZ.bind(null,nn,n),[e.memoizedState,n]}function fN(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=nn.updateQueue,e===null?(e={lastEffect:null,stores:null},nn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function mV(){return gl().memoizedState}function Zk(n,e,t,s){var i=Cc();nn.flags|=n,i.memoizedState=fN(1|e,t,void 0,s===void 0?null:s)}function vL(n,e,t,s){var i=gl();s=s===void 0?null:s;var r=void 0;if(Zn!==null){var o=Zn.memoizedState;if(r=o.destroy,s!==null&&XO(s,o.deps)){i.memoizedState=fN(e,t,r,s);return}}nn.flags|=n,i.memoizedState=fN(1|e,t,r,s)}function R6(n,e){return Zk(8390656,8,n,e)}function JO(n,e){return vL(2048,8,n,e)}function gV(n,e){return vL(4,2,n,e)}function xV(n,e){return vL(4,4,n,e)}function yV(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function bV(n,e,t){return t=t!=null?t.concat([n]):null,vL(4,4,yV.bind(null,e,n),t)}function ZO(){}function vV(n,e){var t=gl();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&XO(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function wV(n,e){var t=gl();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&XO(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function SV(n,e,t){return $0&21?(lc(t,e)||(t=EH(),nn.lanes|=t,U0|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,ga=!0),n.memoizedState=t)}function aZ(n,e){var t=Kt;Kt=t!==0&&4>t?t:4,n(!0);var s=LD.transition;LD.transition={};try{n(!1),e()}finally{Kt=t,LD.transition=s}}function CV(){return gl().memoizedState}function oZ(n,e,t){var s=nm(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},NV(n))jV(e,t);else if(t=rV(n,e,t,s),t!==null){var i=Ur();oc(t,n,s,i),AV(t,e,s)}}function lZ(n,e,t){var s=nm(n),i={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(NV(n))jV(e,i);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,c=r(o,t);if(i.hasEagerState=!0,i.eagerState=c,lc(c,o)){var d=e.interleaved;d===null?(i.next=i,VO(e)):(i.next=d.next,d.next=i),e.interleaved=i;return}}catch{}finally{}t=rV(n,e,i,s),t!==null&&(i=Ur(),oc(t,n,s,i),AV(t,e,s))}}function NV(n){var e=n.alternate;return n===nn||e!==null&&e===nn}function jV(n,e){BC=G_=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function AV(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,_O(n,t)}}var W_={readContext:ml,useCallback:Zi,useContext:Zi,useEffect:Zi,useImperativeHandle:Zi,useInsertionEffect:Zi,useLayoutEffect:Zi,useMemo:Zi,useReducer:Zi,useRef:Zi,useState:Zi,useDebugValue:Zi,useDeferredValue:Zi,useTransition:Zi,useMutableSource:Zi,useSyncExternalStore:Zi,useId:Zi,unstable_isNewReconciler:!1},cZ={readContext:ml,useCallback:function(n,e){return Cc().memoizedState=[n,e===void 0?null:e],n},useContext:ml,useEffect:R6,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Zk(4194308,4,yV.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Zk(4194308,4,n,e)},useInsertionEffect:function(n,e){return Zk(4,2,n,e)},useMemo:function(n,e){var t=Cc();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=Cc();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=oZ.bind(null,nn,n),[s.memoizedState,n]},useRef:function(n){var e=Cc();return n={current:n},e.memoizedState=n},useState:D6,useDebugValue:ZO,useDeferredValue:function(n){return Cc().memoizedState=n},useTransition:function(){var n=D6(!1),e=n[0];return n=aZ.bind(null,n[1]),Cc().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=nn,i=Cc();if(Gs){if(t===void 0)throw Error(le(407));t=t()}else{if(t=e(),vi===null)throw Error(le(349));$0&30||dV(s,e,t)}i.memoizedState=t;var r={value:t,getSnapshot:e};return i.queue=r,R6(uV.bind(null,s,r,n),[n]),s.flags|=2048,fN(9,hV.bind(null,s,r,t,e),void 0,null),t},useId:function(){var n=Cc(),e=vi.identifierPrefix;if(Gs){var t=gu,s=mu;t=(s&~(1<<32-ac(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=uN++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=rZ++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},dZ={readContext:ml,useCallback:vV,useContext:ml,useEffect:JO,useImperativeHandle:bV,useInsertionEffect:gV,useLayoutEffect:xV,useMemo:wV,useReducer:DD,useRef:mV,useState:function(){return DD(pN)},useDebugValue:ZO,useDeferredValue:function(n){var e=gl();return SV(e,Zn.memoizedState,n)},useTransition:function(){var n=DD(pN)[0],e=gl().memoizedState;return[n,e]},useMutableSource:lV,useSyncExternalStore:cV,useId:CV,unstable_isNewReconciler:!1},hZ={readContext:ml,useCallback:vV,useContext:ml,useEffect:JO,useImperativeHandle:bV,useInsertionEffect:gV,useLayoutEffect:xV,useMemo:wV,useReducer:RD,useRef:mV,useState:function(){return RD(pN)},useDebugValue:ZO,useDeferredValue:function(n){var e=gl();return Zn===null?e.memoizedState=n:SV(e,Zn.memoizedState,n)},useTransition:function(){var n=RD(pN)[0],e=gl().memoizedState;return[n,e]},useMutableSource:lV,useSyncExternalStore:cV,useId:CV,unstable_isNewReconciler:!1};function Tl(n,e){if(n&&n.defaultProps){e=an({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function jI(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:an({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var wL={isMounted:function(n){return(n=n._reactInternals)?ty(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=Ur(),i=nm(n),r=vu(s,i);r.payload=e,t!=null&&(r.callback=t),e=tm(n,r,i),e!==null&&(oc(e,n,i,s),Qk(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=Ur(),i=nm(n),r=vu(s,i);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=tm(n,r,i),e!==null&&(oc(e,n,i,s),Qk(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ur(),s=nm(n),i=vu(t,s);i.tag=2,e!=null&&(i.callback=e),e=tm(n,i,s),e!==null&&(oc(e,n,s,t),Qk(e,n,s))}};function I6(n,e,t,s,i,r,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,r,o):e.prototype&&e.prototype.isPureReactComponent?!aN(t,s)||!aN(i,r):!0}function EV(n,e,t){var s=!1,i=lm,r=e.contextType;return typeof r=="object"&&r!==null?r=ml(r):(i=ya(e)?O0:Sr.current,s=e.contextTypes,r=(s=s!=null)?w1(n,i):lm),e=new e(t,r),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wL,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=r),e}function M6(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&wL.enqueueReplaceState(e,e.state,null)}function AI(n,e,t,s){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},GO(n);var r=e.contextType;typeof r=="object"&&r!==null?i.context=ml(r):(r=ya(e)?O0:Sr.current,i.context=w1(n,r)),i.state=n.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(jI(n,e,r,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&wL.enqueueReplaceState(i,i.state,null),H_(n,t,i,s),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function j1(n,e){try{var t="",s=e;do t+=BQ(s),s=s.return;while(s);var i=t}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:e,stack:i,digest:null}}function ID(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function EI(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var uZ=typeof WeakMap=="function"?WeakMap:Map;function kV(n,e,t){t=vu(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){Y_||(Y_=!0,FI=s),EI(n,e)},t}function TV(n,e,t){t=vu(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;t.payload=function(){return s(i)},t.callback=function(){EI(n,e)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){EI(n,e),typeof s!="function"&&(sm===null?sm=new Set([this]):sm.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function F6(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new uZ;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(t)||(i.add(t),n=AZ.bind(null,n,e,t),e.then(n,n))}function O6(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function B6(n,e,t,s,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=vu(-1,1),e.tag=2,tm(t,e,1))),t.lanes|=1),n)}var pZ=zu.ReactCurrentOwner,ga=!1;function Or(n,e,t,s){e.child=n===null?iV(e,null,t,s):C1(e,n.child,t,s)}function $6(n,e,t,s,i){t=t.render;var r=e.ref;return hb(e,i),s=KO(n,e,t,s,r,i),t=QO(),n!==null&&!ga?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Lu(n,e,i)):(Gs&&t&&OO(e),e.flags|=1,Or(n,e,s,i),e.child)}function U6(n,e,t,s,i){if(n===null){var r=t.type;return typeof r=="function"&&!o5(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,_V(n,e,r,s,i)):(n=nT(t.type,null,s,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(r=n.child,!(n.lanes&i)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:aN,t(o,s)&&n.ref===e.ref)return Lu(n,e,i)}return e.flags|=1,n=im(r,s),n.ref=e.ref,n.return=e,e.child=n}function _V(n,e,t,s,i){if(n!==null){var r=n.memoizedProps;if(aN(r,s)&&n.ref===e.ref)if(ga=!1,e.pendingProps=s=r,(n.lanes&i)!==0)n.flags&131072&&(ga=!0);else return e.lanes=n.lanes,Lu(n,e,i)}return kI(n,e,t,s,i)}function PV(n,e,t){var s=e.pendingProps,i=s.children,r=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ts(Yy,oo),oo|=t;else{if(!(t&1073741824))return n=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ts(Yy,oo),oo|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:t,Ts(Yy,oo),oo|=s}else r!==null?(s=r.baseLanes|t,e.memoizedState=null):s=t,Ts(Yy,oo),oo|=s;return Or(n,e,i,t),e.child}function LV(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function kI(n,e,t,s,i){var r=ya(t)?O0:Sr.current;return r=w1(e,r),hb(e,i),t=KO(n,e,t,s,r,i),s=QO(),n!==null&&!ga?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Lu(n,e,i)):(Gs&&s&&OO(e),e.flags|=1,Or(n,e,t,i),e.child)}function z6(n,e,t,s,i){if(ya(t)){var r=!0;O_(e)}else r=!1;if(hb(e,i),e.stateNode===null)eT(n,e),EV(e,t,s),AI(e,t,s,i),s=!0;else if(n===null){var o=e.stateNode,c=e.memoizedProps;o.props=c;var d=o.context,h=t.contextType;typeof h=="object"&&h!==null?h=ml(h):(h=ya(t)?O0:Sr.current,h=w1(e,h));var u=t.getDerivedStateFromProps,p=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(c!==s||d!==h)&&M6(e,o,s,h),sp=!1;var f=e.memoizedState;o.state=f,H_(e,s,o,i),d=e.memoizedState,c!==s||f!==d||xa.current||sp?(typeof u=="function"&&(jI(e,t,u,s),d=e.memoizedState),(c=sp||I6(e,t,c,s,f,d,h))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=d),o.props=s,o.state=d,o.context=h,s=c):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,aV(n,e),c=e.memoizedProps,h=e.type===e.elementType?c:Tl(e.type,c),o.props=h,p=e.pendingProps,f=o.context,d=t.contextType,typeof d=="object"&&d!==null?d=ml(d):(d=ya(t)?O0:Sr.current,d=w1(e,d));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(c!==p||f!==d)&&M6(e,o,s,d),sp=!1,f=e.memoizedState,o.state=f,H_(e,s,o,i);var x=e.memoizedState;c!==p||f!==x||xa.current||sp?(typeof m=="function"&&(jI(e,t,m,s),x=e.memoizedState),(h=sp||I6(e,t,h,s,f,x,d)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,x,d),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,x,d)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||c===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||c===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=x),o.props=s,o.state=x,o.context=d,s=h):(typeof o.componentDidUpdate!="function"||c===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||c===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),s=!1)}return TI(n,e,t,s,r,i)}function TI(n,e,t,s,i,r){LV(n,e);var o=(e.flags&128)!==0;if(!s&&!o)return i&&E6(e,t,!1),Lu(n,e,r);s=e.stateNode,pZ.current=e;var c=o&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&o?(e.child=C1(e,n.child,null,r),e.child=C1(e,null,c,r)):Or(n,e,c,r),e.memoizedState=s.state,i&&E6(e,t,!0),e.child}function DV(n){var e=n.stateNode;e.pendingContext?A6(n,e.pendingContext,e.pendingContext!==e.context):e.context&&A6(n,e.context,!1),WO(n,e.containerInfo)}function H6(n,e,t,s,i){return S1(),$O(i),e.flags|=256,Or(n,e,t,s),e.child}var _I={dehydrated:null,treeContext:null,retryLane:0};function PI(n){return{baseLanes:n,cachePool:null,transitions:null}}function RV(n,e,t){var s=e.pendingProps,i=en.current,r=!1,o=(e.flags&128)!==0,c;if((c=o)||(c=n!==null&&n.memoizedState===null?!1:(i&2)!==0),c?(r=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Ts(en,i&1),n===null)return CI(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,n=s.fallback,r?(s=e.mode,r=e.child,o={mode:"hidden",children:o},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=NL(o,s,0,null),n=R0(n,s,t,null),r.return=e,n.return=e,r.sibling=n,e.child=r,e.child.memoizedState=PI(t),e.memoizedState=_I,n):e5(e,o));if(i=n.memoizedState,i!==null&&(c=i.dehydrated,c!==null))return fZ(n,e,o,s,c,i,t);if(r){r=s.fallback,o=e.mode,i=n.child,c=i.sibling;var d={mode:"hidden",children:s.children};return!(o&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=d,e.deletions=null):(s=im(i,d),s.subtreeFlags=i.subtreeFlags&14680064),c!==null?r=im(c,r):(r=R0(r,o,t,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,o=n.child.memoizedState,o=o===null?PI(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=n.childLanes&~t,e.memoizedState=_I,s}return r=n.child,n=r.sibling,s=im(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function e5(n,e){return e=NL({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ek(n,e,t,s){return s!==null&&$O(s),C1(e,n.child,null,t),n=e5(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function fZ(n,e,t,s,i,r,o){if(t)return e.flags&256?(e.flags&=-257,s=ID(Error(le(422))),ek(n,e,o,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=NL({mode:"visible",children:s.children},i,0,null),r=R0(r,i,o,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&C1(e,n.child,null,o),e.child.memoizedState=PI(o),e.memoizedState=_I,r);if(!(e.mode&1))return ek(n,e,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var c=s.dgst;return s=c,r=Error(le(419)),s=ID(r,s,void 0),ek(n,e,o,s)}if(c=(o&n.childLanes)!==0,ga||c){if(s=vi,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,Pu(n,i),oc(s,n,i,-1))}return a5(),s=ID(Error(le(421))),ek(n,e,o,s)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=EZ.bind(null,n),i._reactRetry=e,null):(n=r.treeContext,go=em(i.nextSibling),xo=e,Gs=!0,sc=null,n!==null&&(il[rl++]=mu,il[rl++]=gu,il[rl++]=B0,mu=n.id,gu=n.overflow,B0=e),e=e5(e,s.children),e.flags|=4096,e)}function V6(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),NI(n.return,e,t)}function MD(n,e,t,s,i){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=t,r.tailMode=i)}function IV(n,e,t){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(Or(n,e,s.children,t),s=en.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&V6(n,t,e);else if(n.tag===19)V6(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(Ts(en,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&V_(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),MD(e,!1,i,t,r);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&V_(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}MD(e,!0,t,null,r);break;case"together":MD(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function eT(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Lu(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),U0|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(le(153));if(e.child!==null){for(n=e.child,t=im(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=im(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function mZ(n,e,t){switch(e.tag){case 3:DV(e),S1();break;case 5:oV(e);break;case 1:ya(e.type)&&O_(e);break;case 4:WO(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;Ts(U_,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Ts(en,en.current&1),e.flags|=128,null):t&e.child.childLanes?RV(n,e,t):(Ts(en,en.current&1),n=Lu(n,e,t),n!==null?n.sibling:null);Ts(en,en.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return IV(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ts(en,en.current),s)break;return null;case 22:case 23:return e.lanes=0,PV(n,e,t)}return Lu(n,e,t)}var MV,LI,FV,OV;MV=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};LI=function(){};FV=function(n,e,t,s){var i=n.memoizedProps;if(i!==s){n=e.stateNode,eg(Nd.current);var r=null;switch(t){case"input":i=eI(n,i),s=eI(n,s),r=[];break;case"select":i=an({},i,{value:void 0}),s=an({},s,{value:void 0}),r=[];break;case"textarea":i=nI(n,i),s=nI(n,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=M_)}rI(t,s);var o;t=null;for(h in i)if(!s.hasOwnProperty(h)&&i.hasOwnProperty(h)&&i[h]!=null)if(h==="style"){var c=i[h];for(o in c)c.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(ZC.hasOwnProperty(h)?r||(r=[]):(r=r||[]).push(h,null));for(h in s){var d=s[h];if(c=i!=null?i[h]:void 0,s.hasOwnProperty(h)&&d!==c&&(d!=null||c!=null))if(h==="style")if(c){for(o in c)!c.hasOwnProperty(o)||d&&d.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in d)d.hasOwnProperty(o)&&c[o]!==d[o]&&(t||(t={}),t[o]=d[o])}else t||(r||(r=[]),r.push(h,t)),t=d;else h==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,c=c?c.__html:void 0,d!=null&&c!==d&&(r=r||[]).push(h,d)):h==="children"?typeof d!="string"&&typeof d!="number"||(r=r||[]).push(h,""+d):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(ZC.hasOwnProperty(h)?(d!=null&&h==="onScroll"&&Ls("scroll",n),r||c===d||(r=[])):(r=r||[]).push(h,d))}t&&(r=r||[]).push("style",t);var h=r;(e.updateQueue=h)&&(e.flags|=4)}};OV=function(n,e,t,s){t!==s&&(e.flags|=4)};function cS(n,e){if(!Gs)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function er(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function gZ(n,e,t){var s=e.pendingProps;switch(BO(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return er(e),null;case 1:return ya(e.type)&&F_(),er(e),null;case 3:return s=e.stateNode,N1(),Is(xa),Is(Sr),YO(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(JE(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,sc!==null&&($I(sc),sc=null))),LI(n,e),er(e),null;case 5:qO(e);var i=eg(hN.current);if(t=e.type,n!==null&&e.stateNode!=null)FV(n,e,t,s,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(le(166));return er(e),null}if(n=eg(Nd.current),JE(e)){s=e.stateNode,t=e.type;var r=e.memoizedProps;switch(s[xd]=e,s[cN]=r,n=(e.mode&1)!==0,t){case"dialog":Ls("cancel",s),Ls("close",s);break;case"iframe":case"object":case"embed":Ls("load",s);break;case"video":case"audio":for(i=0;i<BS.length;i++)Ls(BS[i],s);break;case"source":Ls("error",s);break;case"img":case"image":case"link":Ls("error",s),Ls("load",s);break;case"details":Ls("toggle",s);break;case"input":Z3(s,r),Ls("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},Ls("invalid",s);break;case"textarea":t6(s,r),Ls("invalid",s)}rI(t,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var c=r[o];o==="children"?typeof c=="string"?s.textContent!==c&&(r.suppressHydrationWarning!==!0&&QE(s.textContent,c,n),i=["children",c]):typeof c=="number"&&s.textContent!==""+c&&(r.suppressHydrationWarning!==!0&&QE(s.textContent,c,n),i=["children",""+c]):ZC.hasOwnProperty(o)&&c!=null&&o==="onScroll"&&Ls("scroll",s)}switch(t){case"input":HE(s),e6(s,r,!0);break;case"textarea":HE(s),s6(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=M_)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=uH(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=o.createElement(t,{is:s.is}):(n=o.createElement(t),t==="select"&&(o=n,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):n=o.createElementNS(n,t),n[xd]=e,n[cN]=s,MV(n,e,!1,!1),e.stateNode=n;e:{switch(o=aI(t,s),t){case"dialog":Ls("cancel",n),Ls("close",n),i=s;break;case"iframe":case"object":case"embed":Ls("load",n),i=s;break;case"video":case"audio":for(i=0;i<BS.length;i++)Ls(BS[i],n);i=s;break;case"source":Ls("error",n),i=s;break;case"img":case"image":case"link":Ls("error",n),Ls("load",n),i=s;break;case"details":Ls("toggle",n),i=s;break;case"input":Z3(n,s),i=eI(n,s),Ls("invalid",n);break;case"option":i=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},i=an({},s,{value:void 0}),Ls("invalid",n);break;case"textarea":t6(n,s),i=nI(n,s),Ls("invalid",n);break;default:i=s}rI(t,i),c=i;for(r in c)if(c.hasOwnProperty(r)){var d=c[r];r==="style"?mH(n,d):r==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&pH(n,d)):r==="children"?typeof d=="string"?(t!=="textarea"||d!=="")&&eN(n,d):typeof d=="number"&&eN(n,""+d):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(ZC.hasOwnProperty(r)?d!=null&&r==="onScroll"&&Ls("scroll",n):d!=null&&NO(n,r,d,o))}switch(t){case"input":HE(n),e6(n,s,!1);break;case"textarea":HE(n),s6(n);break;case"option":s.value!=null&&n.setAttribute("value",""+om(s.value));break;case"select":n.multiple=!!s.multiple,r=s.value,r!=null?ob(n,!!s.multiple,r,!1):s.defaultValue!=null&&ob(n,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=M_)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return er(e),null;case 6:if(n&&e.stateNode!=null)OV(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(le(166));if(t=eg(hN.current),eg(Nd.current),JE(e)){if(s=e.stateNode,t=e.memoizedProps,s[xd]=e,(r=s.nodeValue!==t)&&(n=xo,n!==null))switch(n.tag){case 3:QE(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&QE(s.nodeValue,t,(n.mode&1)!==0)}r&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[xd]=e,e.stateNode=s}return er(e),null;case 13:if(Is(en),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Gs&&go!==null&&e.mode&1&&!(e.flags&128))sV(),S1(),e.flags|=98560,r=!1;else if(r=JE(e),s!==null&&s.dehydrated!==null){if(n===null){if(!r)throw Error(le(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(le(317));r[xd]=e}else S1(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;er(e),r=!1}else sc!==null&&($I(sc),sc=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||en.current&1?ei===0&&(ei=3):a5())),e.updateQueue!==null&&(e.flags|=4),er(e),null);case 4:return N1(),LI(n,e),n===null&&oN(e.stateNode.containerInfo),er(e),null;case 10:return HO(e.type._context),er(e),null;case 17:return ya(e.type)&&F_(),er(e),null;case 19:if(Is(en),r=e.memoizedState,r===null)return er(e),null;if(s=(e.flags&128)!==0,o=r.rendering,o===null)if(s)cS(r,!1);else{if(ei!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=V_(n),o!==null){for(e.flags|=128,cS(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)r=t,n=s,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,n=o.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ts(en,en.current&1|2),e.child}n=n.sibling}r.tail!==null&&Dn()>A1&&(e.flags|=128,s=!0,cS(r,!1),e.lanes=4194304)}else{if(!s)if(n=V_(o),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),cS(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Gs)return er(e),null}else 2*Dn()-r.renderingStartTime>A1&&t!==1073741824&&(e.flags|=128,s=!0,cS(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Dn(),e.sibling=null,t=en.current,Ts(en,s?t&1|2:t&1),e):(er(e),null);case 22:case 23:return r5(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?oo&1073741824&&(er(e),e.subtreeFlags&6&&(e.flags|=8192)):er(e),null;case 24:return null;case 25:return null}throw Error(le(156,e.tag))}function xZ(n,e){switch(BO(e),e.tag){case 1:return ya(e.type)&&F_(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return N1(),Is(xa),Is(Sr),YO(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return qO(e),null;case 13:if(Is(en),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(le(340));S1()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Is(en),null;case 4:return N1(),null;case 10:return HO(e.type._context),null;case 22:case 23:return r5(),null;case 24:return null;default:return null}}var tk=!1,br=!1,yZ=typeof WeakSet=="function"?WeakSet:Set,ke=null;function qy(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){wn(n,e,s)}else t.current=null}function DI(n,e,t){try{t()}catch(s){wn(n,e,s)}}var G6=!1;function bZ(n,e){if(gI=D_,n=HH(),FO(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,c=-1,d=-1,h=0,u=0,p=n,f=null;t:for(;;){for(var m;p!==t||i!==0&&p.nodeType!==3||(c=o+i),p!==r||s!==0&&p.nodeType!==3||(d=o+s),p.nodeType===3&&(o+=p.nodeValue.length),(m=p.firstChild)!==null;)f=p,p=m;for(;;){if(p===n)break t;if(f===t&&++h===i&&(c=o),f===r&&++u===s&&(d=o),(m=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=m}t=c===-1||d===-1?null:{start:c,end:d}}else t=null}t=t||{start:0,end:0}}else t=null;for(xI={focusedElem:n,selectionRange:t},D_=!1,ke=e;ke!==null;)if(e=ke,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ke=n;else for(;ke!==null;){e=ke;try{var x=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,b=x.memoizedState,y=e.stateNode,C=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Tl(e.type,g),b);y.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(S){wn(e,e.return,S)}if(n=e.sibling,n!==null){n.return=e.return,ke=n;break}ke=e.return}return x=G6,G6=!1,x}function $C(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&n)===n){var r=i.destroy;i.destroy=void 0,r!==void 0&&DI(e,t,r)}i=i.next}while(i!==s)}}function SL(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function RI(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function BV(n){var e=n.alternate;e!==null&&(n.alternate=null,BV(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[xd],delete e[cN],delete e[vI],delete e[tZ],delete e[sZ])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function $V(n){return n.tag===5||n.tag===3||n.tag===4}function W6(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||$V(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function II(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=M_));else if(s!==4&&(n=n.child,n!==null))for(II(n,e,t),n=n.sibling;n!==null;)II(n,e,t),n=n.sibling}function MI(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for(MI(n,e,t),n=n.sibling;n!==null;)MI(n,e,t),n=n.sibling}var Oi=null,ec=!1;function Yu(n,e,t){for(t=t.child;t!==null;)UV(n,e,t),t=t.sibling}function UV(n,e,t){if(Cd&&typeof Cd.onCommitFiberUnmount=="function")try{Cd.onCommitFiberUnmount(fL,t)}catch{}switch(t.tag){case 5:br||qy(t,e);case 6:var s=Oi,i=ec;Oi=null,Yu(n,e,t),Oi=s,ec=i,Oi!==null&&(ec?(n=Oi,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Oi.removeChild(t.stateNode));break;case 18:Oi!==null&&(ec?(n=Oi,t=t.stateNode,n.nodeType===8?TD(n.parentNode,t):n.nodeType===1&&TD(n,t),iN(n)):TD(Oi,t.stateNode));break;case 4:s=Oi,i=ec,Oi=t.stateNode.containerInfo,ec=!0,Yu(n,e,t),Oi=s,ec=i;break;case 0:case 11:case 14:case 15:if(!br&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&DI(t,e,o),i=i.next}while(i!==s)}Yu(n,e,t);break;case 1:if(!br&&(qy(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(c){wn(t,e,c)}Yu(n,e,t);break;case 21:Yu(n,e,t);break;case 22:t.mode&1?(br=(s=br)||t.memoizedState!==null,Yu(n,e,t),br=s):Yu(n,e,t);break;default:Yu(n,e,t)}}function q6(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new yZ),e.forEach(function(s){var i=kZ.bind(null,n,s);t.has(s)||(t.add(s),s.then(i,i))})}}function Sl(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var i=t[s];try{var r=n,o=e,c=o;e:for(;c!==null;){switch(c.tag){case 5:Oi=c.stateNode,ec=!1;break e;case 3:Oi=c.stateNode.containerInfo,ec=!0;break e;case 4:Oi=c.stateNode.containerInfo,ec=!0;break e}c=c.return}if(Oi===null)throw Error(le(160));UV(r,o,i),Oi=null,ec=!1;var d=i.alternate;d!==null&&(d.return=null),i.return=null}catch(h){wn(i,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)zV(e,n),e=e.sibling}function zV(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Sl(e,n),pc(n),s&4){try{$C(3,n,n.return),SL(3,n)}catch(g){wn(n,n.return,g)}try{$C(5,n,n.return)}catch(g){wn(n,n.return,g)}}break;case 1:Sl(e,n),pc(n),s&512&&t!==null&&qy(t,t.return);break;case 5:if(Sl(e,n),pc(n),s&512&&t!==null&&qy(t,t.return),n.flags&32){var i=n.stateNode;try{eN(i,"")}catch(g){wn(n,n.return,g)}}if(s&4&&(i=n.stateNode,i!=null)){var r=n.memoizedProps,o=t!==null?t.memoizedProps:r,c=n.type,d=n.updateQueue;if(n.updateQueue=null,d!==null)try{c==="input"&&r.type==="radio"&&r.name!=null&&dH(i,r),aI(c,o);var h=aI(c,r);for(o=0;o<d.length;o+=2){var u=d[o],p=d[o+1];u==="style"?mH(i,p):u==="dangerouslySetInnerHTML"?pH(i,p):u==="children"?eN(i,p):NO(i,u,p,h)}switch(c){case"input":tI(i,r);break;case"textarea":hH(i,r);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var m=r.value;m!=null?ob(i,!!r.multiple,m,!1):f!==!!r.multiple&&(r.defaultValue!=null?ob(i,!!r.multiple,r.defaultValue,!0):ob(i,!!r.multiple,r.multiple?[]:"",!1))}i[cN]=r}catch(g){wn(n,n.return,g)}}break;case 6:if(Sl(e,n),pc(n),s&4){if(n.stateNode===null)throw Error(le(162));i=n.stateNode,r=n.memoizedProps;try{i.nodeValue=r}catch(g){wn(n,n.return,g)}}break;case 3:if(Sl(e,n),pc(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{iN(e.containerInfo)}catch(g){wn(n,n.return,g)}break;case 4:Sl(e,n),pc(n);break;case 13:Sl(e,n),pc(n),i=n.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(n5=Dn())),s&4&&q6(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(br=(h=br)||u,Sl(e,n),br=h):Sl(e,n),pc(n),s&8192){if(h=n.memoizedState!==null,(n.stateNode.isHidden=h)&&!u&&n.mode&1)for(ke=n,u=n.child;u!==null;){for(p=ke=u;ke!==null;){switch(f=ke,m=f.child,f.tag){case 0:case 11:case 14:case 15:$C(4,f,f.return);break;case 1:qy(f,f.return);var x=f.stateNode;if(typeof x.componentWillUnmount=="function"){s=f,t=f.return;try{e=s,x.props=e.memoizedProps,x.state=e.memoizedState,x.componentWillUnmount()}catch(g){wn(s,t,g)}}break;case 5:qy(f,f.return);break;case 22:if(f.memoizedState!==null){X6(p);continue}}m!==null?(m.return=f,ke=m):X6(p)}u=u.sibling}e:for(u=null,p=n;;){if(p.tag===5){if(u===null){u=p;try{i=p.stateNode,h?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(c=p.stateNode,d=p.memoizedProps.style,o=d!=null&&d.hasOwnProperty("display")?d.display:null,c.style.display=fH("display",o))}catch(g){wn(n,n.return,g)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=h?"":p.memoizedProps}catch(g){wn(n,n.return,g)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===n)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===n)break e;for(;p.sibling===null;){if(p.return===null||p.return===n)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Sl(e,n),pc(n),s&4&&q6(n);break;case 21:break;default:Sl(e,n),pc(n)}}function pc(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if($V(t)){var s=t;break e}t=t.return}throw Error(le(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(eN(i,""),s.flags&=-33);var r=W6(n);MI(n,r,i);break;case 3:case 4:var o=s.stateNode.containerInfo,c=W6(n);II(n,c,o);break;default:throw Error(le(161))}}catch(d){wn(n,n.return,d)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function vZ(n,e,t){ke=n,HV(n)}function HV(n,e,t){for(var s=(n.mode&1)!==0;ke!==null;){var i=ke,r=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||tk;if(!o){var c=i.alternate,d=c!==null&&c.memoizedState!==null||br;c=tk;var h=br;if(tk=o,(br=d)&&!h)for(ke=i;ke!==null;)o=ke,d=o.child,o.tag===22&&o.memoizedState!==null?K6(i):d!==null?(d.return=o,ke=d):K6(i);for(;r!==null;)ke=r,HV(r),r=r.sibling;ke=i,tk=c,br=h}Y6(n)}else i.subtreeFlags&8772&&r!==null?(r.return=i,ke=r):Y6(n)}}function Y6(n){for(;ke!==null;){var e=ke;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:br||SL(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!br)if(t===null)s.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Tl(e.type,t.memoizedProps);s.componentDidUpdate(i,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&L6(e,r,s);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}L6(e,o,t)}break;case 5:var c=e.stateNode;if(t===null&&e.flags&4){t=c;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&t.focus();break;case"img":d.src&&(t.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var u=h.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&iN(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}br||e.flags&512&&RI(e)}catch(f){wn(e,e.return,f)}}if(e===n){ke=null;break}if(t=e.sibling,t!==null){t.return=e.return,ke=t;break}ke=e.return}}function X6(n){for(;ke!==null;){var e=ke;if(e===n){ke=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ke=t;break}ke=e.return}}function K6(n){for(;ke!==null;){var e=ke;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{SL(4,e)}catch(d){wn(e,t,d)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(d){wn(e,i,d)}}var r=e.return;try{RI(e)}catch(d){wn(e,r,d)}break;case 5:var o=e.return;try{RI(e)}catch(d){wn(e,o,d)}}}catch(d){wn(e,e.return,d)}if(e===n){ke=null;break}var c=e.sibling;if(c!==null){c.return=e.return,ke=c;break}ke=e.return}}var wZ=Math.ceil,q_=zu.ReactCurrentDispatcher,t5=zu.ReactCurrentOwner,ul=zu.ReactCurrentBatchConfig,Pt=0,vi=null,Gn=null,qi=0,oo=0,Yy=vm(0),ei=0,mN=null,U0=0,CL=0,s5=0,UC=null,ma=null,n5=0,A1=1/0,Xd=null,Y_=!1,FI=null,sm=null,sk=!1,Xf=null,X_=0,zC=0,OI=null,tT=-1,sT=0;function Ur(){return Pt&6?Dn():tT!==-1?tT:tT=Dn()}function nm(n){return n.mode&1?Pt&2&&qi!==0?qi&-qi:iZ.transition!==null?(sT===0&&(sT=EH()),sT):(n=Kt,n!==0||(n=window.event,n=n===void 0?16:RH(n.type)),n):1}function oc(n,e,t,s){if(50<zC)throw zC=0,OI=null,Error(le(185));hE(n,t,s),(!(Pt&2)||n!==vi)&&(n===vi&&(!(Pt&2)&&(CL|=t),ei===4&&rp(n,qi)),ba(n,s),t===1&&Pt===0&&!(e.mode&1)&&(A1=Dn()+500,bL&&wm()))}function ba(n,e){var t=n.callbackNode;iJ(n,e);var s=L_(n,n===vi?qi:0);if(s===0)t!==null&&r6(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&r6(t),e===1)n.tag===0?nZ(Q6.bind(null,n)):ZH(Q6.bind(null,n)),ZJ(function(){!(Pt&6)&&wm()}),t=null;else{switch(kH(s)){case 1:t=TO;break;case 4:t=jH;break;case 16:t=P_;break;case 536870912:t=AH;break;default:t=P_}t=QV(t,VV.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function VV(n,e){if(tT=-1,sT=0,Pt&6)throw Error(le(327));var t=n.callbackNode;if(ub()&&n.callbackNode!==t)return null;var s=L_(n,n===vi?qi:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=K_(n,s);else{e=s;var i=Pt;Pt|=2;var r=WV();(vi!==n||qi!==e)&&(Xd=null,A1=Dn()+500,D0(n,e));do try{NZ();break}catch(c){GV(n,c)}while(!0);zO(),q_.current=r,Pt=i,Gn!==null?e=0:(vi=null,qi=0,e=ei)}if(e!==0){if(e===2&&(i=hI(n),i!==0&&(s=i,e=BI(n,i))),e===1)throw t=mN,D0(n,0),rp(n,s),ba(n,Dn()),t;if(e===6)rp(n,s);else{if(i=n.current.alternate,!(s&30)&&!SZ(i)&&(e=K_(n,s),e===2&&(r=hI(n),r!==0&&(s=r,e=BI(n,r))),e===1))throw t=mN,D0(n,0),rp(n,s),ba(n,Dn()),t;switch(n.finishedWork=i,n.finishedLanes=s,e){case 0:case 1:throw Error(le(345));case 2:Fm(n,ma,Xd);break;case 3:if(rp(n,s),(s&130023424)===s&&(e=n5+500-Dn(),10<e)){if(L_(n,0)!==0)break;if(i=n.suspendedLanes,(i&s)!==s){Ur(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=bI(Fm.bind(null,n,ma,Xd),e);break}Fm(n,ma,Xd);break;case 4:if(rp(n,s),(s&4194240)===s)break;for(e=n.eventTimes,i=-1;0<s;){var o=31-ac(s);r=1<<o,o=e[o],o>i&&(i=o),s&=~r}if(s=i,s=Dn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*wZ(s/1960))-s,10<s){n.timeoutHandle=bI(Fm.bind(null,n,ma,Xd),s);break}Fm(n,ma,Xd);break;case 5:Fm(n,ma,Xd);break;default:throw Error(le(329))}}}return ba(n,Dn()),n.callbackNode===t?VV.bind(null,n):null}function BI(n,e){var t=UC;return n.current.memoizedState.isDehydrated&&(D0(n,e).flags|=256),n=K_(n,e),n!==2&&(e=ma,ma=t,e!==null&&$I(e)),n}function $I(n){ma===null?ma=n:ma.push.apply(ma,n)}function SZ(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var i=t[s],r=i.getSnapshot;i=i.value;try{if(!lc(r(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function rp(n,e){for(e&=~s5,e&=~CL,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ac(e),s=1<<t;n[t]=-1,e&=~s}}function Q6(n){if(Pt&6)throw Error(le(327));ub();var e=L_(n,0);if(!(e&1))return ba(n,Dn()),null;var t=K_(n,e);if(n.tag!==0&&t===2){var s=hI(n);s!==0&&(e=s,t=BI(n,s))}if(t===1)throw t=mN,D0(n,0),rp(n,e),ba(n,Dn()),t;if(t===6)throw Error(le(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Fm(n,ma,Xd),ba(n,Dn()),null}function i5(n,e){var t=Pt;Pt|=1;try{return n(e)}finally{Pt=t,Pt===0&&(A1=Dn()+500,bL&&wm())}}function z0(n){Xf!==null&&Xf.tag===0&&!(Pt&6)&&ub();var e=Pt;Pt|=1;var t=ul.transition,s=Kt;try{if(ul.transition=null,Kt=1,n)return n()}finally{Kt=s,ul.transition=t,Pt=e,!(Pt&6)&&wm()}}function r5(){oo=Yy.current,Is(Yy)}function D0(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,JJ(t)),Gn!==null)for(t=Gn.return;t!==null;){var s=t;switch(BO(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&F_();break;case 3:N1(),Is(xa),Is(Sr),YO();break;case 5:qO(s);break;case 4:N1();break;case 13:Is(en);break;case 19:Is(en);break;case 10:HO(s.type._context);break;case 22:case 23:r5()}t=t.return}if(vi=n,Gn=n=im(n.current,null),qi=oo=e,ei=0,mN=null,s5=CL=U0=0,ma=UC=null,Zm!==null){for(e=0;e<Zm.length;e++)if(t=Zm[e],s=t.interleaved,s!==null){t.interleaved=null;var i=s.next,r=t.pending;if(r!==null){var o=r.next;r.next=i,s.next=o}t.pending=s}Zm=null}return n}function GV(n,e){do{var t=Gn;try{if(zO(),Jk.current=W_,G_){for(var s=nn.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}G_=!1}if($0=0,bi=Zn=nn=null,BC=!1,uN=0,t5.current=null,t===null||t.return===null){ei=1,mN=e,Gn=null;break}e:{var r=n,o=t.return,c=t,d=e;if(e=qi,c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var h=d,u=c,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=O6(o);if(m!==null){m.flags&=-257,B6(m,o,c,r,e),m.mode&1&&F6(r,h,e),e=m,d=h;var x=e.updateQueue;if(x===null){var g=new Set;g.add(d),e.updateQueue=g}else x.add(d);break e}else{if(!(e&1)){F6(r,h,e),a5();break e}d=Error(le(426))}}else if(Gs&&c.mode&1){var b=O6(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),B6(b,o,c,r,e),$O(j1(d,c));break e}}r=d=j1(d,c),ei!==4&&(ei=2),UC===null?UC=[r]:UC.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var y=kV(r,d,e);P6(r,y);break e;case 1:c=d;var C=r.type,w=r.stateNode;if(!(r.flags&128)&&(typeof C.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(sm===null||!sm.has(w)))){r.flags|=65536,e&=-e,r.lanes|=e;var S=TV(r,c,e);P6(r,S);break e}}r=r.return}while(r!==null)}YV(t)}catch(j){e=j,Gn===t&&t!==null&&(Gn=t=t.return);continue}break}while(!0)}function WV(){var n=q_.current;return q_.current=W_,n===null?W_:n}function a5(){(ei===0||ei===3||ei===2)&&(ei=4),vi===null||!(U0&268435455)&&!(CL&268435455)||rp(vi,qi)}function K_(n,e){var t=Pt;Pt|=2;var s=WV();(vi!==n||qi!==e)&&(Xd=null,D0(n,e));do try{CZ();break}catch(i){GV(n,i)}while(!0);if(zO(),Pt=t,q_.current=s,Gn!==null)throw Error(le(261));return vi=null,qi=0,ei}function CZ(){for(;Gn!==null;)qV(Gn)}function NZ(){for(;Gn!==null&&!XQ();)qV(Gn)}function qV(n){var e=KV(n.alternate,n,oo);n.memoizedProps=n.pendingProps,e===null?YV(n):Gn=e,t5.current=null}function YV(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=xZ(t,e),t!==null){t.flags&=32767,Gn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ei=6,Gn=null;return}}else if(t=gZ(t,e,oo),t!==null){Gn=t;return}if(e=e.sibling,e!==null){Gn=e;return}Gn=e=n}while(e!==null);ei===0&&(ei=5)}function Fm(n,e,t){var s=Kt,i=ul.transition;try{ul.transition=null,Kt=1,jZ(n,e,t,s)}finally{ul.transition=i,Kt=s}return null}function jZ(n,e,t,s){do ub();while(Xf!==null);if(Pt&6)throw Error(le(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(le(177));n.callbackNode=null,n.callbackPriority=0;var r=t.lanes|t.childLanes;if(rJ(n,r),n===vi&&(Gn=vi=null,qi=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||sk||(sk=!0,QV(P_,function(){return ub(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=ul.transition,ul.transition=null;var o=Kt;Kt=1;var c=Pt;Pt|=4,t5.current=null,bZ(n,t),zV(t,n),GJ(xI),D_=!!gI,xI=gI=null,n.current=t,vZ(t),KQ(),Pt=c,Kt=o,ul.transition=r}else n.current=t;if(sk&&(sk=!1,Xf=n,X_=i),r=n.pendingLanes,r===0&&(sm=null),ZQ(t.stateNode),ba(n,Dn()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],s(i.value,{componentStack:i.stack,digest:i.digest});if(Y_)throw Y_=!1,n=FI,FI=null,n;return X_&1&&n.tag!==0&&ub(),r=n.pendingLanes,r&1?n===OI?zC++:(zC=0,OI=n):zC=0,wm(),null}function ub(){if(Xf!==null){var n=kH(X_),e=ul.transition,t=Kt;try{if(ul.transition=null,Kt=16>n?16:n,Xf===null)var s=!1;else{if(n=Xf,Xf=null,X_=0,Pt&6)throw Error(le(331));var i=Pt;for(Pt|=4,ke=n.current;ke!==null;){var r=ke,o=r.child;if(ke.flags&16){var c=r.deletions;if(c!==null){for(var d=0;d<c.length;d++){var h=c[d];for(ke=h;ke!==null;){var u=ke;switch(u.tag){case 0:case 11:case 15:$C(8,u,r)}var p=u.child;if(p!==null)p.return=u,ke=p;else for(;ke!==null;){u=ke;var f=u.sibling,m=u.return;if(BV(u),u===h){ke=null;break}if(f!==null){f.return=m,ke=f;break}ke=m}}}var x=r.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var b=g.sibling;g.sibling=null,g=b}while(g!==null)}}ke=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,ke=o;else e:for(;ke!==null;){if(r=ke,r.flags&2048)switch(r.tag){case 0:case 11:case 15:$C(9,r,r.return)}var y=r.sibling;if(y!==null){y.return=r.return,ke=y;break e}ke=r.return}}var C=n.current;for(ke=C;ke!==null;){o=ke;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,ke=w;else e:for(o=C;ke!==null;){if(c=ke,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:SL(9,c)}}catch(j){wn(c,c.return,j)}if(c===o){ke=null;break e}var S=c.sibling;if(S!==null){S.return=c.return,ke=S;break e}ke=c.return}}if(Pt=i,wm(),Cd&&typeof Cd.onPostCommitFiberRoot=="function")try{Cd.onPostCommitFiberRoot(fL,n)}catch{}s=!0}return s}finally{Kt=t,ul.transition=e}}return!1}function J6(n,e,t){e=j1(t,e),e=kV(n,e,1),n=tm(n,e,1),e=Ur(),n!==null&&(hE(n,1,e),ba(n,e))}function wn(n,e,t){if(n.tag===3)J6(n,n,t);else for(;e!==null;){if(e.tag===3){J6(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(sm===null||!sm.has(s))){n=j1(t,n),n=TV(e,n,1),e=tm(e,n,1),n=Ur(),e!==null&&(hE(e,1,n),ba(e,n));break}}e=e.return}}function AZ(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=Ur(),n.pingedLanes|=n.suspendedLanes&t,vi===n&&(qi&t)===t&&(ei===4||ei===3&&(qi&130023424)===qi&&500>Dn()-n5?D0(n,0):s5|=t),ba(n,e)}function XV(n,e){e===0&&(n.mode&1?(e=WE,WE<<=1,!(WE&130023424)&&(WE=4194304)):e=1);var t=Ur();n=Pu(n,e),n!==null&&(hE(n,e,t),ba(n,t))}function EZ(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),XV(n,t)}function kZ(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(le(314))}s!==null&&s.delete(e),XV(n,t)}var KV;KV=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||xa.current)ga=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return ga=!1,mZ(n,e,t);ga=!!(n.flags&131072)}else ga=!1,Gs&&e.flags&1048576&&eV(e,$_,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;eT(n,e),n=e.pendingProps;var i=w1(e,Sr.current);hb(e,t),i=KO(null,e,s,n,i,t);var r=QO();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ya(s)?(r=!0,O_(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,GO(e),i.updater=wL,e.stateNode=i,i._reactInternals=e,AI(e,s,n,t),e=TI(null,e,s,!0,r,t)):(e.tag=0,Gs&&r&&OO(e),Or(null,e,i,t),e=e.child),e;case 16:s=e.elementType;e:{switch(eT(n,e),n=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=_Z(s),n=Tl(s,n),i){case 0:e=kI(null,e,s,n,t);break e;case 1:e=z6(null,e,s,n,t);break e;case 11:e=$6(null,e,s,n,t);break e;case 14:e=U6(null,e,s,Tl(s.type,n),t);break e}throw Error(le(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Tl(s,i),kI(n,e,s,i,t);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Tl(s,i),z6(n,e,s,i,t);case 3:e:{if(DV(e),n===null)throw Error(le(387));s=e.pendingProps,r=e.memoizedState,i=r.element,aV(n,e),H_(e,s,null,t);var o=e.memoizedState;if(s=o.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=j1(Error(le(423)),e),e=H6(n,e,s,t,i);break e}else if(s!==i){i=j1(Error(le(424)),e),e=H6(n,e,s,t,i);break e}else for(go=em(e.stateNode.containerInfo.firstChild),xo=e,Gs=!0,sc=null,t=iV(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(S1(),s===i){e=Lu(n,e,t);break e}Or(n,e,s,t)}e=e.child}return e;case 5:return oV(e),n===null&&CI(e),s=e.type,i=e.pendingProps,r=n!==null?n.memoizedProps:null,o=i.children,yI(s,i)?o=null:r!==null&&yI(s,r)&&(e.flags|=32),LV(n,e),Or(n,e,o,t),e.child;case 6:return n===null&&CI(e),null;case 13:return RV(n,e,t);case 4:return WO(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=C1(e,null,s,t):Or(n,e,s,t),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Tl(s,i),$6(n,e,s,i,t);case 7:return Or(n,e,e.pendingProps,t),e.child;case 8:return Or(n,e,e.pendingProps.children,t),e.child;case 12:return Or(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,Ts(U_,s._currentValue),s._currentValue=o,r!==null)if(lc(r.value,o)){if(r.children===i.children&&!xa.current){e=Lu(n,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var c=r.dependencies;if(c!==null){o=r.child;for(var d=c.firstContext;d!==null;){if(d.context===s){if(r.tag===1){d=vu(-1,t&-t),d.tag=2;var h=r.updateQueue;if(h!==null){h=h.shared;var u=h.pending;u===null?d.next=d:(d.next=u.next,u.next=d),h.pending=d}}r.lanes|=t,d=r.alternate,d!==null&&(d.lanes|=t),NI(r.return,t,e),c.lanes|=t;break}d=d.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(le(341));o.lanes|=t,c=o.alternate,c!==null&&(c.lanes|=t),NI(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}Or(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,hb(e,t),i=ml(i),s=s(i),e.flags|=1,Or(n,e,s,t),e.child;case 14:return s=e.type,i=Tl(s,e.pendingProps),i=Tl(s.type,i),U6(n,e,s,i,t);case 15:return _V(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Tl(s,i),eT(n,e),e.tag=1,ya(s)?(n=!0,O_(e)):n=!1,hb(e,t),EV(e,s,i),AI(e,s,i,t),TI(null,e,s,!0,n,t);case 19:return IV(n,e,t);case 22:return PV(n,e,t)}throw Error(le(156,e.tag))};function QV(n,e){return NH(n,e)}function TZ(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hl(n,e,t,s){return new TZ(n,e,t,s)}function o5(n){return n=n.prototype,!(!n||!n.isReactComponent)}function _Z(n){if(typeof n=="function")return o5(n)?1:0;if(n!=null){if(n=n.$$typeof,n===AO)return 11;if(n===EO)return 14}return 2}function im(n,e){var t=n.alternate;return t===null?(t=hl(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function nT(n,e,t,s,i,r){var o=2;if(s=n,typeof n=="function")o5(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Oy:return R0(t.children,i,r,e);case jO:o=8,i|=8;break;case KR:return n=hl(12,t,e,i|2),n.elementType=KR,n.lanes=r,n;case QR:return n=hl(13,t,e,i),n.elementType=QR,n.lanes=r,n;case JR:return n=hl(19,t,e,i),n.elementType=JR,n.lanes=r,n;case oH:return NL(t,i,r,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case rH:o=10;break e;case aH:o=9;break e;case AO:o=11;break e;case EO:o=14;break e;case tp:o=16,s=null;break e}throw Error(le(130,n==null?n:typeof n,""))}return e=hl(o,t,e,i),e.elementType=n,e.type=s,e.lanes=r,e}function R0(n,e,t,s){return n=hl(7,n,s,e),n.lanes=t,n}function NL(n,e,t,s){return n=hl(22,n,s,e),n.elementType=oH,n.lanes=t,n.stateNode={isHidden:!1},n}function FD(n,e,t){return n=hl(6,n,null,e),n.lanes=t,n}function OD(n,e,t){return e=hl(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function PZ(n,e,t,s,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yD(0),this.expirationTimes=yD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yD(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function l5(n,e,t,s,i,r,o,c,d){return n=new PZ(n,e,t,c,d),e===1?(e=1,r===!0&&(e|=8)):e=0,r=hl(3,null,null,e),n.current=r,r.stateNode=n,r.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},GO(r),n}function LZ(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fy,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function JV(n){if(!n)return lm;n=n._reactInternals;e:{if(ty(n)!==n||n.tag!==1)throw Error(le(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ya(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(le(171))}if(n.tag===1){var t=n.type;if(ya(t))return JH(n,t,e)}return e}function ZV(n,e,t,s,i,r,o,c,d){return n=l5(t,s,!0,n,i,r,o,c,d),n.context=JV(null),t=n.current,s=Ur(),i=nm(t),r=vu(s,i),r.callback=e??null,tm(t,r,i),n.current.lanes=i,hE(n,i,s),ba(n,s),n}function jL(n,e,t,s){var i=e.current,r=Ur(),o=nm(i);return t=JV(t),e.context===null?e.context=t:e.pendingContext=t,e=vu(r,o),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=tm(i,e,o),n!==null&&(oc(n,i,o,r),Qk(n,i,o)),o}function Q_(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Z6(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function c5(n,e){Z6(n,e),(n=n.alternate)&&Z6(n,e)}function DZ(){return null}var eG=typeof reportError=="function"?reportError:function(n){console.error(n)};function d5(n){this._internalRoot=n}AL.prototype.render=d5.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(le(409));jL(n,e,null,null)};AL.prototype.unmount=d5.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;z0(function(){jL(null,n,null,null)}),e[_u]=null}};function AL(n){this._internalRoot=n}AL.prototype.unstable_scheduleHydration=function(n){if(n){var e=PH();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ip.length&&e!==0&&e<ip[t].priority;t++);ip.splice(t,0,n),t===0&&DH(n)}};function h5(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function EL(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function eB(){}function RZ(n,e,t,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var h=Q_(o);r.call(h)}}var o=ZV(e,s,n,0,null,!1,!1,"",eB);return n._reactRootContainer=o,n[_u]=o.current,oN(n.nodeType===8?n.parentNode:n),z0(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof s=="function"){var c=s;s=function(){var h=Q_(d);c.call(h)}}var d=l5(n,0,!1,null,null,!1,!1,"",eB);return n._reactRootContainer=d,n[_u]=d.current,oN(n.nodeType===8?n.parentNode:n),z0(function(){jL(e,d,t,s)}),d}function kL(n,e,t,s,i){var r=t._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var c=i;i=function(){var d=Q_(o);c.call(d)}}jL(e,o,n,i)}else o=RZ(t,e,n,i,s);return Q_(o)}TH=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=OS(e.pendingLanes);t!==0&&(_O(e,t|1),ba(e,Dn()),!(Pt&6)&&(A1=Dn()+500,wm()))}break;case 13:z0(function(){var s=Pu(n,1);if(s!==null){var i=Ur();oc(s,n,1,i)}}),c5(n,1)}};PO=function(n){if(n.tag===13){var e=Pu(n,134217728);if(e!==null){var t=Ur();oc(e,n,134217728,t)}c5(n,134217728)}};_H=function(n){if(n.tag===13){var e=nm(n),t=Pu(n,e);if(t!==null){var s=Ur();oc(t,n,e,s)}c5(n,e)}};PH=function(){return Kt};LH=function(n,e){var t=Kt;try{return Kt=n,e()}finally{Kt=t}};lI=function(n,e,t){switch(e){case"input":if(tI(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var i=yL(s);if(!i)throw Error(le(90));cH(s),tI(s,i)}}}break;case"textarea":hH(n,t);break;case"select":e=t.value,e!=null&&ob(n,!!t.multiple,e,!1)}};yH=i5;bH=z0;var IZ={usingClientEntryPoint:!1,Events:[pE,zy,yL,gH,xH,i5]},dS={findFiberByHostInstance:Jm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},MZ={bundleType:dS.bundleType,version:dS.version,rendererPackageName:dS.rendererPackageName,rendererConfig:dS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zu.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=SH(n),n===null?null:n.stateNode},findFiberByHostInstance:dS.findFiberByHostInstance||DZ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nk=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nk.isDisabled&&nk.supportsFiber)try{fL=nk.inject(MZ),Cd=nk}catch{}}Ao.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=IZ;Ao.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h5(e))throw Error(le(200));return LZ(n,e,null,t)};Ao.createRoot=function(n,e){if(!h5(n))throw Error(le(299));var t=!1,s="",i=eG;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=l5(n,1,!1,null,null,t,!1,s,i),n[_u]=e.current,oN(n.nodeType===8?n.parentNode:n),new d5(e)};Ao.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(le(188)):(n=Object.keys(n).join(","),Error(le(268,n)));return n=SH(e),n=n===null?null:n.stateNode,n};Ao.flushSync=function(n){return z0(n)};Ao.hydrate=function(n,e,t){if(!EL(e))throw Error(le(200));return kL(null,n,e,!0,t)};Ao.hydrateRoot=function(n,e,t){if(!h5(n))throw Error(le(405));var s=t!=null&&t.hydratedSources||null,i=!1,r="",o=eG;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=ZV(e,null,n,1,t??null,i,!1,r,o),n[_u]=e.current,oN(n),s)for(n=0;n<s.length;n++)t=s[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new AL(e)};Ao.render=function(n,e,t){if(!EL(e))throw Error(le(200));return kL(null,n,e,!1,t)};Ao.unmountComponentAtNode=function(n){if(!EL(n))throw Error(le(40));return n._reactRootContainer?(z0(function(){kL(null,null,n,!1,function(){n._reactRootContainer=null,n[_u]=null})}),!0):!1};Ao.unstable_batchedUpdates=i5;Ao.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!EL(t))throw Error(le(200));if(n==null||n._reactInternals===void 0)throw Error(le(38));return kL(n,e,t,!1,s)};Ao.version="18.3.1-next-f1338f8080-20240426";function tG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tG)}catch(n){console.error(n)}}tG(),tH.exports=Ao;var TL=tH.exports;const FZ=uL(TL),OZ=H8({__proto__:null,default:FZ},[TL]);var tB=TL;YR.createRoot=tB.createRoot,YR.hydrateRoot=tB.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Vs(){return Vs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Vs.apply(this,arguments)}var Vn;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Vn||(Vn={}));const sB="popstate";function BZ(n){n===void 0&&(n={});function e(s,i){let{pathname:r,search:o,hash:c}=s.location;return gN("",{pathname:r,search:o,hash:c},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(s,i){return typeof i=="string"?i:V0(i)}return UZ(e,t,null,n)}function ft(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function H0(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function $Z(){return Math.random().toString(36).substr(2,8)}function nB(n,e){return{usr:n.state,key:n.key,idx:e}}function gN(n,e,t,s){return t===void 0&&(t=null),Vs({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Sm(e):e,{state:t,key:e&&e.key||s||$Z()})}function V0(n){let{pathname:e="/",search:t="",hash:s=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Sm(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substr(s),n=n.substr(0,s)),n&&(e.pathname=n)}return e}function UZ(n,e,t,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:r=!1}=s,o=i.history,c=Vn.Pop,d=null,h=u();h==null&&(h=0,o.replaceState(Vs({},o.state,{idx:h}),""));function u(){return(o.state||{idx:null}).idx}function p(){c=Vn.Pop;let b=u(),y=b==null?null:b-h;h=b,d&&d({action:c,location:g.location,delta:y})}function f(b,y){c=Vn.Push;let C=gN(g.location,b,y);h=u()+1;let w=nB(C,h),S=g.createHref(C);try{o.pushState(w,"",S)}catch(j){if(j instanceof DOMException&&j.name==="DataCloneError")throw j;i.location.assign(S)}r&&d&&d({action:c,location:g.location,delta:1})}function m(b,y){c=Vn.Replace;let C=gN(g.location,b,y);h=u();let w=nB(C,h),S=g.createHref(C);o.replaceState(w,"",S),r&&d&&d({action:c,location:g.location,delta:0})}function x(b){let y=i.location.origin!=="null"?i.location.origin:i.location.href,C=typeof b=="string"?b:V0(b);return C=C.replace(/ $/,"%20"),ft(y,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,y)}let g={get action(){return c},get location(){return n(i,o)},listen(b){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(sB,p),d=b,()=>{i.removeEventListener(sB,p),d=null}},createHref(b){return e(i,b)},createURL:x,encodeLocation(b){let y=x(b);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:f,replace:m,go(b){return o.go(b)}};return g}var Xt;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Xt||(Xt={}));const zZ=new Set(["lazy","caseSensitive","path","id","index","children"]);function HZ(n){return n.index===!0}function J_(n,e,t,s){return t===void 0&&(t=[]),s===void 0&&(s={}),n.map((i,r)=>{let o=[...t,String(r)],c=typeof i.id=="string"?i.id:o.join("-");if(ft(i.index!==!0||!i.children,"Cannot specify children on an index route"),ft(!s[c],'Found a route id collision on id "'+c+`".  Route id's must be globally unique within Data Router usages`),HZ(i)){let d=Vs({},i,e(i),{id:c});return s[c]=d,d}else{let d=Vs({},i,e(i),{id:c,children:void 0});return s[c]=d,i.children&&(d.children=J_(i.children,e,o,s)),d}})}function Wm(n,e,t){return t===void 0&&(t="/"),iT(n,e,t,!1)}function iT(n,e,t,s){let i=typeof e=="string"?Sm(e):e,r=_d(i.pathname||"/",t);if(r==null)return null;let o=nG(n);VZ(o);let c=null;for(let d=0;c==null&&d<o.length;++d){let h=tee(r);c=ZZ(o[d],h,s)}return c}function sG(n,e){let{route:t,pathname:s,params:i}=n;return{id:t.id,pathname:s,params:i,data:e[t.id],handle:t.handle}}function nG(n,e,t,s){e===void 0&&(e=[]),t===void 0&&(t=[]),s===void 0&&(s="");let i=(r,o,c)=>{let d={relativePath:c===void 0?r.path||"":c,caseSensitive:r.caseSensitive===!0,childrenIndex:o,route:r};d.relativePath.startsWith("/")&&(ft(d.relativePath.startsWith(s),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(s.length));let h=wu([s,d.relativePath]),u=t.concat(d);r.children&&r.children.length>0&&(ft(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),nG(r.children,e,u,h)),!(r.path==null&&!r.index)&&e.push({path:h,score:QZ(h,r.index),routesMeta:u})};return n.forEach((r,o)=>{var c;if(r.path===""||!((c=r.path)!=null&&c.includes("?")))i(r,o);else for(let d of iG(r.path))i(r,o,d)}),e}function iG(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return i?[r,""]:[r];let o=iG(s.join("/")),c=[];return c.push(...o.map(d=>d===""?r:[r,d].join("/"))),i&&c.push(...o),c.map(d=>n.startsWith("/")&&d===""?"/":d)}function VZ(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:JZ(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}const GZ=/^:[\w-]+$/,WZ=3,qZ=2,YZ=1,XZ=10,KZ=-2,iB=n=>n==="*";function QZ(n,e){let t=n.split("/"),s=t.length;return t.some(iB)&&(s+=KZ),e&&(s+=qZ),t.filter(i=>!iB(i)).reduce((i,r)=>i+(GZ.test(r)?WZ:r===""?YZ:XZ),s)}function JZ(n,e){return n.length===e.length&&n.slice(0,-1).every((s,i)=>s===e[i])?n[n.length-1]-e[e.length-1]:0}function ZZ(n,e,t){t===void 0&&(t=!1);let{routesMeta:s}=n,i={},r="/",o=[];for(let c=0;c<s.length;++c){let d=s[c],h=c===s.length-1,u=r==="/"?e:e.slice(r.length)||"/",p=Z_({path:d.relativePath,caseSensitive:d.caseSensitive,end:h},u),f=d.route;if(!p&&h&&t&&!s[s.length-1].route.index&&(p=Z_({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},u)),!p)return null;Object.assign(i,p.params),o.push({params:i,pathname:wu([r,p.pathname]),pathnameBase:ree(wu([r,p.pathnameBase])),route:f}),p.pathnameBase!=="/"&&(r=wu([r,p.pathnameBase]))}return o}function Z_(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=eee(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let r=i[0],o=r.replace(/(.)\/+$/,"$1"),c=i.slice(1);return{params:s.reduce((h,u,p)=>{let{paramName:f,isOptional:m}=u;if(f==="*"){let g=c[p]||"";o=r.slice(0,r.length-g.length).replace(/(.)\/+$/,"$1")}const x=c[p];return m&&!x?h[f]=void 0:h[f]=(x||"").replace(/%2F/g,"/"),h},{}),pathname:r,pathnameBase:o,pattern:n}}function eee(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),H0(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let s=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,d)=>(s.push({paramName:c,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(s.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function tee(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return H0(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function _d(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}const see=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,nee=n=>see.test(n);function iee(n,e){e===void 0&&(e="/");let{pathname:t,search:s="",hash:i=""}=typeof n=="string"?Sm(n):n,r;if(t)if(nee(t))r=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),H0(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?r=rB(t.substring(1),"/"):r=rB(t,e)}else r=e;return{pathname:r,search:aee(s),hash:oee(i)}}function rB(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function BD(n,e,t,s){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function rG(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function _L(n,e){let t=rG(n);return e?t.map((s,i)=>i===t.length-1?s.pathname:s.pathnameBase):t.map(s=>s.pathnameBase)}function PL(n,e,t,s){s===void 0&&(s=!1);let i;typeof n=="string"?i=Sm(n):(i=Vs({},n),ft(!i.pathname||!i.pathname.includes("?"),BD("?","pathname","search",i)),ft(!i.pathname||!i.pathname.includes("#"),BD("#","pathname","hash",i)),ft(!i.search||!i.search.includes("#"),BD("#","search","hash",i)));let r=n===""||i.pathname==="",o=r?"/":i.pathname,c;if(o==null)c=t;else{let p=e.length-1;if(!s&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),p-=1;i.pathname=f.join("/")}c=p>=0?e[p]:"/"}let d=iee(i,c),h=o&&o!=="/"&&o.endsWith("/"),u=(r||o===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(h||u)&&(d.pathname+="/"),d}const wu=n=>n.join("/").replace(/\/\/+/g,"/"),ree=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),aee=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,oee=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class eP{constructor(e,t,s,i){i===void 0&&(i=!1),this.status=e,this.statusText=t||"",this.internal=i,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}}function xN(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const aG=["post","put","patch","delete"],lee=new Set(aG),cee=["get",...aG],dee=new Set(cee),hee=new Set([301,302,303,307,308]),uee=new Set([307,308]),$D={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},pee={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},hS={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},u5=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,fee=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),oG="remix-router-transitions";function mee(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",s=!t;ft(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let i;if(n.mapRouteProperties)i=n.mapRouteProperties;else if(n.detectErrorBoundary){let H=n.detectErrorBoundary;i=Y=>({hasErrorBoundary:H(Y)})}else i=fee;let r={},o=J_(n.routes,i,void 0,r),c,d=n.basename||"/",h=n.dataStrategy||bee,u=n.patchRoutesOnNavigation,p=Vs({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},n.future),f=null,m=new Set,x=null,g=null,b=null,y=n.hydrationData!=null,C=Wm(o,n.history.location,d),w=!1,S=null;if(C==null&&!u){let H=ha(404,{pathname:n.history.location.pathname}),{matches:Y,route:Q}=gB(o);C=Y,S={[Q.id]:H}}C&&!n.hydrationData&&vl(C,o,n.history.location.pathname).active&&(C=null);let j;if(C)if(C.some(H=>H.route.lazy))j=!1;else if(!C.some(H=>H.route.loader))j=!0;else if(p.v7_partialHydration){let H=n.hydrationData?n.hydrationData.loaderData:null,Y=n.hydrationData?n.hydrationData.errors:null;if(Y){let Q=C.findIndex(re=>Y[re.route.id]!==void 0);j=C.slice(0,Q+1).every(re=>!zI(re.route,H,Y))}else j=C.every(Q=>!zI(Q.route,H,Y))}else j=n.hydrationData!=null;else if(j=!1,C=[],p.v7_partialHydration){let H=vl(null,o,n.history.location.pathname);H.active&&H.matches&&(w=!0,C=H.matches)}let T,k={historyAction:n.history.action,location:n.history.location,matches:C,initialized:j,navigation:$D,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||S,fetchers:new Map,blockers:new Map},_=Vn.Pop,L=!1,D,P=!1,I=new Map,M=null,O=!1,F=!1,B=[],U=new Set,$=new Map,G=0,ne=-1,Z=new Map,K=new Set,X=new Map,V=new Map,q=new Set,ee=new Map,ie=new Map,Re;function Ye(){if(f=n.history.listen(H=>{let{action:Y,location:Q,delta:re}=H;if(Re){Re(),Re=void 0;return}H0(ie.size===0||re!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let he=Am({currentLocation:k.location,nextLocation:Q,historyAction:Y});if(he&&re!=null){let $e=new Promise(Xe=>{Re=Xe});n.history.go(re*-1),Gu(he,{state:"blocked",location:Q,proceed(){Gu(he,{state:"proceeding",proceed:void 0,reset:void 0,location:Q}),$e.then(()=>n.history.go(re))},reset(){let Xe=new Map(k.blockers);Xe.set(he,hS),fe({blockers:Xe})}});return}return gt(Y,Q)}),t){Dee(e,I);let H=()=>Ree(e,I);e.addEventListener("pagehide",H),M=()=>e.removeEventListener("pagehide",H)}return k.initialized||gt(Vn.Pop,k.location,{initialHydration:!0}),T}function Le(){f&&f(),M&&M(),m.clear(),D&&D.abort(),k.fetchers.forEach((H,Y)=>ze(Y)),k.blockers.forEach((H,Y)=>uc(Y))}function te(H){return m.add(H),()=>m.delete(H)}function fe(H,Y){Y===void 0&&(Y={}),k=Vs({},k,H);let Q=[],re=[];p.v7_fetcherPersist&&k.fetchers.forEach((he,$e)=>{he.state==="idle"&&(q.has($e)?re.push($e):Q.push($e))}),q.forEach(he=>{!k.fetchers.has(he)&&!$.has(he)&&re.push(he)}),[...m].forEach(he=>he(k,{deletedFetchers:re,viewTransitionOpts:Y.viewTransitionOpts,flushSync:Y.flushSync===!0})),p.v7_fetcherPersist?(Q.forEach(he=>k.fetchers.delete(he)),re.forEach(he=>ze(he))):re.forEach(he=>q.delete(he))}function Ne(H,Y,Q){var re,he;let{flushSync:$e}=Q===void 0?{}:Q,Xe=k.actionData!=null&&k.navigation.formMethod!=null&&tc(k.navigation.formMethod)&&k.navigation.state==="loading"&&((re=H.state)==null?void 0:re._isRedirect)!==!0,Ae;Y.actionData?Object.keys(Y.actionData).length>0?Ae=Y.actionData:Ae=null:Xe?Ae=k.actionData:Ae=null;let De=Y.loaderData?fB(k.loaderData,Y.loaderData,Y.matches||[],Y.errors):k.loaderData,xe=k.blockers;xe.size>0&&(xe=new Map(xe),xe.forEach((bt,Mn)=>xe.set(Mn,hS)));let Oe=L===!0||k.navigation.formMethod!=null&&tc(k.navigation.formMethod)&&((he=H.state)==null?void 0:he._isRedirect)!==!0;c&&(o=c,c=void 0),O||_===Vn.Pop||(_===Vn.Push?n.history.push(H,H.state):_===Vn.Replace&&n.history.replace(H,H.state));let Ze;if(_===Vn.Pop){let bt=I.get(k.location.pathname);bt&&bt.has(H.pathname)?Ze={currentLocation:k.location,nextLocation:H}:I.has(H.pathname)&&(Ze={currentLocation:H,nextLocation:k.location})}else if(P){let bt=I.get(k.location.pathname);bt?bt.add(H.pathname):(bt=new Set([H.pathname]),I.set(k.location.pathname,bt)),Ze={currentLocation:k.location,nextLocation:H}}fe(Vs({},Y,{actionData:Ae,loaderData:De,historyAction:_,location:H,initialized:!0,navigation:$D,revalidation:"idle",restoreScrollPosition:Nn(H,Y.matches||k.matches),preventScrollReset:Oe,blockers:xe}),{viewTransitionOpts:Ze,flushSync:$e===!0}),_=Vn.Pop,L=!1,P=!1,O=!1,F=!1,B=[]}async function Pe(H,Y){if(typeof H=="number"){n.history.go(H);return}let Q=UI(k.location,k.matches,d,p.v7_prependBasename,H,p.v7_relativeSplatPath,Y==null?void 0:Y.fromRouteId,Y==null?void 0:Y.relative),{path:re,submission:he,error:$e}=aB(p.v7_normalizeFormMethod,!1,Q,Y),Xe=k.location,Ae=gN(k.location,re,Y&&Y.state);Ae=Vs({},Ae,n.history.encodeLocation(Ae));let De=Y&&Y.replace!=null?Y.replace:void 0,xe=Vn.Push;De===!0?xe=Vn.Replace:De===!1||he!=null&&tc(he.formMethod)&&he.formAction===k.location.pathname+k.location.search&&(xe=Vn.Replace);let Oe=Y&&"preventScrollReset"in Y?Y.preventScrollReset===!0:void 0,Ze=(Y&&Y.flushSync)===!0,bt=Am({currentLocation:Xe,nextLocation:Ae,historyAction:xe});if(bt){Gu(bt,{state:"blocked",location:Ae,proceed(){Gu(bt,{state:"proceeding",proceed:void 0,reset:void 0,location:Ae}),Pe(H,Y)},reset(){let Mn=new Map(k.blockers);Mn.set(bt,hS),fe({blockers:Mn})}});return}return await gt(xe,Ae,{submission:he,pendingError:$e,preventScrollReset:Oe,replace:Y&&Y.replace,enableViewTransition:Y&&Y.viewTransition,flushSync:Ze})}function nt(){if(pe(),fe({revalidation:"loading"}),k.navigation.state!=="submitting"){if(k.navigation.state==="idle"){gt(k.historyAction,k.location,{startUninterruptedRevalidation:!0});return}gt(_||k.historyAction,k.navigation.location,{overrideNavigation:k.navigation,enableViewTransition:P===!0})}}async function gt(H,Y,Q){D&&D.abort(),D=null,_=H,O=(Q&&Q.startUninterruptedRevalidation)===!0,hD(k.location,k.matches),L=(Q&&Q.preventScrollReset)===!0,P=(Q&&Q.enableViewTransition)===!0;let re=c||o,he=Q&&Q.overrideNavigation,$e=Q!=null&&Q.initialHydration&&k.matches&&k.matches.length>0&&!w?k.matches:Wm(re,Y,d),Xe=(Q&&Q.flushSync)===!0;if($e&&k.initialized&&!F&&jee(k.location,Y)&&!(Q&&Q.submission&&tc(Q.submission.formMethod))){Ne(Y,{matches:$e},{flushSync:Xe});return}let Ae=vl($e,re,Y.pathname);if(Ae.active&&Ae.matches&&($e=Ae.matches),!$e){let{error:Jt,notFoundMatches:de,route:z}=Wu(Y.pathname);Ne(Y,{matches:de,loaderData:{},errors:{[z.id]:Jt}},{flushSync:Xe});return}D=new AbortController;let De=hy(n.history,Y,D.signal,Q&&Q.submission),xe;if(Q&&Q.pendingError)xe=[qm($e).route.id,{type:Xt.error,error:Q.pendingError}];else if(Q&&Q.submission&&tc(Q.submission.formMethod)){let Jt=await hs(De,Y,Q.submission,$e,Ae.active,{replace:Q.replace,flushSync:Xe});if(Jt.shortCircuited)return;if(Jt.pendingActionResult){let[de,z]=Jt.pendingActionResult;if(lo(z)&&xN(z.error)&&z.error.status===404){D=null,Ne(Y,{matches:Jt.matches,loaderData:{},errors:{[de]:z.error}});return}}$e=Jt.matches||$e,xe=Jt.pendingActionResult,he=UD(Y,Q.submission),Xe=!1,Ae.active=!1,De=hy(n.history,De.url,De.signal)}let{shortCircuited:Oe,matches:Ze,loaderData:bt,errors:Mn}=await qs(De,Y,$e,Ae.active,he,Q&&Q.submission,Q&&Q.fetcherSubmission,Q&&Q.replace,Q&&Q.initialHydration===!0,Xe,xe);Oe||(D=null,Ne(Y,Vs({matches:Ze||$e},mB(xe),{loaderData:bt,errors:Mn})))}async function hs(H,Y,Q,re,he,$e){$e===void 0&&($e={}),pe();let Xe=Pee(Y,Q);if(fe({navigation:Xe},{flushSync:$e.flushSync===!0}),he){let xe=await ly(re,Y.pathname,H.signal);if(xe.type==="aborted")return{shortCircuited:!0};if(xe.type==="error"){let Oe=qm(xe.partialMatches).route.id;return{matches:xe.partialMatches,pendingActionResult:[Oe,{type:Xt.error,error:xe.error}]}}else if(xe.matches)re=xe.matches;else{let{notFoundMatches:Oe,error:Ze,route:bt}=Wu(Y.pathname);return{matches:Oe,pendingActionResult:[bt.id,{type:Xt.error,error:Ze}]}}}let Ae,De=$S(re,Y);if(!De.route.action&&!De.route.lazy)Ae={type:Xt.error,error:ha(405,{method:H.method,pathname:Y.pathname,routeId:De.route.id})};else if(Ae=(await ye("action",k,H,[De],re,null))[De.route.id],H.signal.aborted)return{shortCircuited:!0};if(tg(Ae)){let xe;return $e&&$e.replace!=null?xe=$e.replace:xe=hB(Ae.response.headers.get("Location"),new URL(H.url),d)===k.location.pathname+k.location.search,await ce(H,Ae,!0,{submission:Q,replace:xe}),{shortCircuited:!0}}if(Kf(Ae))throw ha(400,{type:"defer-action"});if(lo(Ae)){let xe=qm(re,De.route.id);return($e&&$e.replace)!==!0&&(_=Vn.Push),{matches:re,pendingActionResult:[xe.route.id,Ae]}}return{matches:re,pendingActionResult:[De.route.id,Ae]}}async function qs(H,Y,Q,re,he,$e,Xe,Ae,De,xe,Oe){let Ze=he||UD(Y,$e),bt=$e||Xe||yB(Ze),Mn=!O&&(!p.v7_partialHydration||!De);if(re){if(Mn){let Ps=Cn(Oe);fe(Vs({navigation:Ze},Ps!==void 0?{actionData:Ps}:{}),{flushSync:xe})}let Ge=await ly(Q,Y.pathname,H.signal);if(Ge.type==="aborted")return{shortCircuited:!0};if(Ge.type==="error"){let Ps=qm(Ge.partialMatches).route.id;return{matches:Ge.partialMatches,loaderData:{},errors:{[Ps]:Ge.error}}}else if(Ge.matches)Q=Ge.matches;else{let{error:Ps,notFoundMatches:Od,route:sS}=Wu(Y.pathname);return{matches:Od,loaderData:{},errors:{[sS.id]:Ps}}}}let Jt=c||o,[de,z]=lB(n.history,k,Q,bt,Y,p.v7_partialHydration&&De===!0,p.v7_skipActionErrorRevalidation,F,B,U,q,X,K,Jt,d,Oe);if(eS(Ge=>!(Q&&Q.some(Ps=>Ps.route.id===Ge))||de&&de.some(Ps=>Ps.route.id===Ge)),ne=++G,de.length===0&&z.length===0){let Ge=In();return Ne(Y,Vs({matches:Q,loaderData:{},errors:Oe&&lo(Oe[1])?{[Oe[0]]:Oe[1].error}:null},mB(Oe),Ge?{fetchers:new Map(k.fetchers)}:{}),{flushSync:xe}),{shortCircuited:!0}}if(Mn){let Ge={};if(!re){Ge.navigation=Ze;let Ps=Cn(Oe);Ps!==void 0&&(Ge.actionData=Ps)}z.length>0&&(Ge.fetchers=ni(z)),fe(Ge,{flushSync:xe})}z.forEach(Ge=>{Bt(Ge.key),Ge.controller&&$.set(Ge.key,Ge.controller)});let oe=()=>z.forEach(Ge=>Bt(Ge.key));D&&D.signal.addEventListener("abort",oe);let{loaderResults:we,fetcherResults:kt}=await se(k,Q,de,z,H);if(H.signal.aborted)return{shortCircuited:!0};D&&D.signal.removeEventListener("abort",oe),z.forEach(Ge=>$.delete(Ge.key));let us=ik(we);if(us)return await ce(H,us.result,!0,{replace:Ae}),{shortCircuited:!0};if(us=ik(kt),us)return K.add(us.key),await ce(H,us.result,!0,{replace:Ae}),{shortCircuited:!0};let{loaderData:Fs,errors:Fn}=pB(k,Q,we,Oe,z,kt,ee);ee.forEach((Ge,Ps)=>{Ge.subscribe(Od=>{(Od||Ge.done)&&ee.delete(Ps)})}),p.v7_partialHydration&&De&&k.errors&&(Fn=Vs({},k.errors,Fn));let Ni=In(),wl=wa(ne),qu=Ni||wl||z.length>0;return Vs({matches:Q,loaderData:Fs,errors:Fn},qu?{fetchers:new Map(k.fetchers)}:{})}function Cn(H){if(H&&!lo(H[1]))return{[H[0]]:H[1].data};if(k.actionData)return Object.keys(k.actionData).length===0?null:k.actionData}function ni(H){return H.forEach(Y=>{let Q=k.fetchers.get(Y.key),re=uS(void 0,Q?Q.data:void 0);k.fetchers.set(Y.key,re)}),new Map(k.fetchers)}function Ji(H,Y,Q,re){if(s)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Bt(H);let he=(re&&re.flushSync)===!0,$e=c||o,Xe=UI(k.location,k.matches,d,p.v7_prependBasename,Q,p.v7_relativeSplatPath,Y,re==null?void 0:re.relative),Ae=Wm($e,Xe,d),De=vl(Ae,$e,Xe);if(De.active&&De.matches&&(Ae=De.matches),!Ae){Be(H,Y,ha(404,{pathname:Xe}),{flushSync:he});return}let{path:xe,submission:Oe,error:Ze}=aB(p.v7_normalizeFormMethod,!0,Xe,re);if(Ze){Be(H,Y,Ze,{flushSync:he});return}let bt=$S(Ae,xe),Mn=(re&&re.preventScrollReset)===!0;if(Oe&&tc(Oe.formMethod)){Si(H,Y,xe,bt,Ae,De.active,he,Mn,Oe);return}X.set(H,{routeId:Y,path:xe}),Ci(H,Y,xe,bt,Ae,De.active,he,Mn,Oe)}async function Si(H,Y,Q,re,he,$e,Xe,Ae,De){pe(),X.delete(H);function xe(On){if(!On.route.action&&!On.route.lazy){let cy=ha(405,{method:De.formMethod,pathname:Q,routeId:Y});return Be(H,Y,cy,{flushSync:Xe}),!0}return!1}if(!$e&&xe(re))return;let Oe=k.fetchers.get(H);Ue(H,Lee(De,Oe),{flushSync:Xe});let Ze=new AbortController,bt=hy(n.history,Q,Ze.signal,De);if($e){let On=await ly(he,new URL(bt.url).pathname,bt.signal,H);if(On.type==="aborted")return;if(On.type==="error"){Be(H,Y,On.error,{flushSync:Xe});return}else if(On.matches){if(he=On.matches,re=$S(he,Q),xe(re))return}else{Be(H,Y,ha(404,{pathname:Q}),{flushSync:Xe});return}}$.set(H,Ze);let Mn=G,de=(await ye("action",k,bt,[re],he,H))[re.route.id];if(bt.signal.aborted){$.get(H)===Ze&&$.delete(H);return}if(p.v7_fetcherPersist&&q.has(H)){if(tg(de)||lo(de)){Ue(H,Ku(void 0));return}}else{if(tg(de))if($.delete(H),ne>Mn){Ue(H,Ku(void 0));return}else return K.add(H),Ue(H,uS(De)),ce(bt,de,!1,{fetcherSubmission:De,preventScrollReset:Ae});if(lo(de)){Be(H,Y,de.error);return}}if(Kf(de))throw ha(400,{type:"defer-action"});let z=k.navigation.location||k.location,oe=hy(n.history,z,Ze.signal),we=c||o,kt=k.navigation.state!=="idle"?Wm(we,k.navigation.location,d):k.matches;ft(kt,"Didn't find any matches after fetcher action");let us=++G;Z.set(H,us);let Fs=uS(De,de.data);k.fetchers.set(H,Fs);let[Fn,Ni]=lB(n.history,k,kt,De,z,!1,p.v7_skipActionErrorRevalidation,F,B,U,q,X,K,we,d,[re.route.id,de]);Ni.filter(On=>On.key!==H).forEach(On=>{let cy=On.key,G3=k.fetchers.get(cy),lQ=uS(void 0,G3?G3.data:void 0);k.fetchers.set(cy,lQ),Bt(cy),On.controller&&$.set(cy,On.controller)}),fe({fetchers:new Map(k.fetchers)});let wl=()=>Ni.forEach(On=>Bt(On.key));Ze.signal.addEventListener("abort",wl);let{loaderResults:qu,fetcherResults:Ge}=await se(k,kt,Fn,Ni,oe);if(Ze.signal.aborted)return;Ze.signal.removeEventListener("abort",wl),Z.delete(H),$.delete(H),Ni.forEach(On=>$.delete(On.key));let Ps=ik(qu);if(Ps)return ce(oe,Ps.result,!1,{preventScrollReset:Ae});if(Ps=ik(Ge),Ps)return K.add(Ps.key),ce(oe,Ps.result,!1,{preventScrollReset:Ae});let{loaderData:Od,errors:sS}=pB(k,kt,qu,void 0,Ni,Ge,ee);if(k.fetchers.has(H)){let On=Ku(de.data);k.fetchers.set(H,On)}wa(us),k.navigation.state==="loading"&&us>ne?(ft(_,"Expected pending action"),D&&D.abort(),Ne(k.navigation.location,{matches:kt,loaderData:Od,errors:sS,fetchers:new Map(k.fetchers)})):(fe({errors:sS,loaderData:fB(k.loaderData,Od,kt,sS),fetchers:new Map(k.fetchers)}),F=!1)}async function Ci(H,Y,Q,re,he,$e,Xe,Ae,De){let xe=k.fetchers.get(H);Ue(H,uS(De,xe?xe.data:void 0),{flushSync:Xe});let Oe=new AbortController,Ze=hy(n.history,Q,Oe.signal);if($e){let de=await ly(he,new URL(Ze.url).pathname,Ze.signal,H);if(de.type==="aborted")return;if(de.type==="error"){Be(H,Y,de.error,{flushSync:Xe});return}else if(de.matches)he=de.matches,re=$S(he,Q);else{Be(H,Y,ha(404,{pathname:Q}),{flushSync:Xe});return}}$.set(H,Oe);let bt=G,Jt=(await ye("loader",k,Ze,[re],he,H))[re.route.id];if(Kf(Jt)&&(Jt=await p5(Jt,Ze.signal,!0)||Jt),$.get(H)===Oe&&$.delete(H),!Ze.signal.aborted){if(q.has(H)){Ue(H,Ku(void 0));return}if(tg(Jt))if(ne>bt){Ue(H,Ku(void 0));return}else{K.add(H),await ce(Ze,Jt,!1,{preventScrollReset:Ae});return}if(lo(Jt)){Be(H,Y,Jt.error);return}ft(!Kf(Jt),"Unhandled fetcher deferred data"),Ue(H,Ku(Jt.data))}}async function ce(H,Y,Q,re){let{submission:he,fetcherSubmission:$e,preventScrollReset:Xe,replace:Ae}=re===void 0?{}:re;Y.response.headers.has("X-Remix-Revalidate")&&(F=!0);let De=Y.response.headers.get("Location");ft(De,"Expected a Location header on the redirect Response"),De=hB(De,new URL(H.url),d);let xe=gN(k.location,De,{_isRedirect:!0});if(t){let de=!1;if(Y.response.headers.has("X-Remix-Reload-Document"))de=!0;else if(u5.test(De)){const z=n.history.createURL(De);de=z.origin!==e.location.origin||_d(z.pathname,d)==null}if(de){Ae?e.location.replace(De):e.location.assign(De);return}}D=null;let Oe=Ae===!0||Y.response.headers.has("X-Remix-Replace")?Vn.Replace:Vn.Push,{formMethod:Ze,formAction:bt,formEncType:Mn}=k.navigation;!he&&!$e&&Ze&&bt&&Mn&&(he=yB(k.navigation));let Jt=he||$e;if(uee.has(Y.response.status)&&Jt&&tc(Jt.formMethod))await gt(Oe,xe,{submission:Vs({},Jt,{formAction:De}),preventScrollReset:Xe||L,enableViewTransition:Q?P:void 0});else{let de=UD(xe,he);await gt(Oe,xe,{overrideNavigation:de,fetcherSubmission:$e,preventScrollReset:Xe||L,enableViewTransition:Q?P:void 0})}}async function ye(H,Y,Q,re,he,$e){let Xe,Ae={};try{Xe=await vee(h,H,Y,Q,re,he,$e,r,i)}catch(De){return re.forEach(xe=>{Ae[xe.route.id]={type:Xt.error,error:De}}),Ae}for(let[De,xe]of Object.entries(Xe))if(Aee(xe)){let Oe=xe.result;Ae[De]={type:Xt.redirect,response:Cee(Oe,Q,De,he,d,p.v7_relativeSplatPath)}}else Ae[De]=await See(xe);return Ae}async function se(H,Y,Q,re,he){let $e=H.matches,Xe=ye("loader",H,he,Q,Y,null),Ae=Promise.all(re.map(async Oe=>{if(Oe.matches&&Oe.match&&Oe.controller){let bt=(await ye("loader",H,hy(n.history,Oe.path,Oe.controller.signal),[Oe.match],Oe.matches,Oe.key))[Oe.match.route.id];return{[Oe.key]:bt}}else return Promise.resolve({[Oe.key]:{type:Xt.error,error:ha(404,{pathname:Oe.path})}})})),De=await Xe,xe=(await Ae).reduce((Oe,Ze)=>Object.assign(Oe,Ze),{});return await Promise.all([Tee(Y,De,he.signal,$e,H.loaderData),_ee(Y,xe,re)]),{loaderResults:De,fetcherResults:xe}}function pe(){F=!0,B.push(...eS()),X.forEach((H,Y)=>{$.has(Y)&&U.add(Y),Bt(Y)})}function Ue(H,Y,Q){Q===void 0&&(Q={}),k.fetchers.set(H,Y),fe({fetchers:new Map(k.fetchers)},{flushSync:(Q&&Q.flushSync)===!0})}function Be(H,Y,Q,re){re===void 0&&(re={});let he=qm(k.matches,Y);ze(H),fe({errors:{[he.route.id]:Q},fetchers:new Map(k.fetchers)},{flushSync:(re&&re.flushSync)===!0})}function je(H){return V.set(H,(V.get(H)||0)+1),q.has(H)&&q.delete(H),k.fetchers.get(H)||pee}function ze(H){let Y=k.fetchers.get(H);$.has(H)&&!(Y&&Y.state==="loading"&&Z.has(H))&&Bt(H),X.delete(H),Z.delete(H),K.delete(H),p.v7_fetcherPersist&&q.delete(H),U.delete(H),k.fetchers.delete(H)}function Ft(H){let Y=(V.get(H)||0)-1;Y<=0?(V.delete(H),q.add(H),p.v7_fetcherPersist||ze(H)):V.set(H,Y),fe({fetchers:new Map(k.fetchers)})}function Bt(H){let Y=$.get(H);Y&&(Y.abort(),$.delete(H))}function Ys(H){for(let Y of H){let Q=je(Y),re=Ku(Q.data);k.fetchers.set(Y,re)}}function In(){let H=[],Y=!1;for(let Q of K){let re=k.fetchers.get(Q);ft(re,"Expected fetcher: "+Q),re.state==="loading"&&(K.delete(Q),H.push(Q),Y=!0)}return Ys(H),Y}function wa(H){let Y=[];for(let[Q,re]of Z)if(re<H){let he=k.fetchers.get(Q);ft(he,"Expected fetcher: "+Q),he.state==="loading"&&(Bt(Q),Z.delete(Q),Y.push(Q))}return Ys(Y),Y.length>0}function Fd(H,Y){let Q=k.blockers.get(H)||hS;return ie.get(H)!==Y&&ie.set(H,Y),Q}function uc(H){k.blockers.delete(H),ie.delete(H)}function Gu(H,Y){let Q=k.blockers.get(H)||hS;ft(Q.state==="unblocked"&&Y.state==="blocked"||Q.state==="blocked"&&Y.state==="blocked"||Q.state==="blocked"&&Y.state==="proceeding"||Q.state==="blocked"&&Y.state==="unblocked"||Q.state==="proceeding"&&Y.state==="unblocked","Invalid blocker state transition: "+Q.state+" -> "+Y.state);let re=new Map(k.blockers);re.set(H,Y),fe({blockers:re})}function Am(H){let{currentLocation:Y,nextLocation:Q,historyAction:re}=H;if(ie.size===0)return;ie.size>1&&H0(!1,"A router only supports one blocker at a time");let he=Array.from(ie.entries()),[$e,Xe]=he[he.length-1],Ae=k.blockers.get($e);if(!(Ae&&Ae.state==="proceeding")&&Xe({currentLocation:Y,nextLocation:Q,historyAction:re}))return $e}function Wu(H){let Y=ha(404,{pathname:H}),Q=c||o,{matches:re,route:he}=gB(Q);return eS(),{notFoundMatches:re,route:he,error:Y}}function eS(H){let Y=[];return ee.forEach((Q,re)=>{(!H||H(re))&&(Q.cancel(),Y.push(re),ee.delete(re))}),Y}function Em(H,Y,Q){if(x=H,b=Y,g=Q||null,!y&&k.navigation===$D){y=!0;let re=Nn(k.location,k.matches);re!=null&&fe({restoreScrollPosition:re})}return()=>{x=null,b=null,g=null}}function BE(H,Y){return g&&g(H,Y.map(re=>sG(re,k.loaderData)))||H.key}function hD(H,Y){if(x&&b){let Q=BE(H,Y);x[Q]=b()}}function Nn(H,Y){if(x){let Q=BE(H,Y),re=x[Q];if(typeof re=="number")return re}return null}function vl(H,Y,Q){if(u)if(H){if(Object.keys(H[0].params).length>0)return{active:!0,matches:iT(Y,Q,d,!0)}}else return{active:!0,matches:iT(Y,Q,d,!0)||[]};return{active:!1,matches:null}}async function ly(H,Y,Q,re){if(!u)return{type:"success",matches:H};let he=H;for(;;){let $e=c==null,Xe=c||o,Ae=r;try{await u({signal:Q,path:Y,matches:he,fetcherKey:re,patch:(Oe,Ze)=>{Q.aborted||dB(Oe,Ze,Xe,Ae,i)}})}catch(Oe){return{type:"error",error:Oe,partialMatches:he}}finally{$e&&!Q.aborted&&(o=[...o])}if(Q.aborted)return{type:"aborted"};let De=Wm(Xe,Y,d);if(De)return{type:"success",matches:De};let xe=iT(Xe,Y,d,!0);if(!xe||he.length===xe.length&&he.every((Oe,Ze)=>Oe.route.id===xe[Ze].route.id))return{type:"success",matches:null};he=xe}}function $E(H){r={},c=J_(H,i,void 0,r)}function tS(H,Y){let Q=c==null;dB(H,Y,c||o,r,i),Q&&(o=[...o],fe({}))}return T={get basename(){return d},get future(){return p},get state(){return k},get routes(){return o},get window(){return e},initialize:Ye,subscribe:te,enableScrollRestoration:Em,navigate:Pe,fetch:Ji,revalidate:nt,createHref:H=>n.history.createHref(H),encodeLocation:H=>n.history.encodeLocation(H),getFetcher:je,deleteFetcher:Ft,dispose:Le,getBlocker:Fd,deleteBlocker:uc,patchRoutes:tS,_internalFetchControllers:$,_internalActiveDeferreds:ee,_internalSetRoutes:$E},T}function gee(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function UI(n,e,t,s,i,r,o,c){let d,h;if(o){d=[];for(let p of e)if(d.push(p),p.route.id===o){h=p;break}}else d=e,h=e[e.length-1];let u=PL(i||".",_L(d,r),_d(n.pathname,t)||n.pathname,c==="path");if(i==null&&(u.search=n.search,u.hash=n.hash),(i==null||i===""||i===".")&&h){let p=f5(u.search);if(h.route.index&&!p)u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index";else if(!h.route.index&&p){let f=new URLSearchParams(u.search),m=f.getAll("index");f.delete("index"),m.filter(g=>g).forEach(g=>f.append("index",g));let x=f.toString();u.search=x?"?"+x:""}}return s&&t!=="/"&&(u.pathname=u.pathname==="/"?t:wu([t,u.pathname])),V0(u)}function aB(n,e,t,s){if(!s||!gee(s))return{path:t};if(s.formMethod&&!kee(s.formMethod))return{path:t,error:ha(405,{method:s.formMethod})};let i=()=>({path:t,error:ha(400,{type:"invalid-body"})}),r=s.formMethod||"get",o=n?r.toUpperCase():r.toLowerCase(),c=dG(t);if(s.body!==void 0){if(s.formEncType==="text/plain"){if(!tc(o))return i();let f=typeof s.body=="string"?s.body:s.body instanceof FormData||s.body instanceof URLSearchParams?Array.from(s.body.entries()).reduce((m,x)=>{let[g,b]=x;return""+m+g+"="+b+`
`},""):String(s.body);return{path:t,submission:{formMethod:o,formAction:c,formEncType:s.formEncType,formData:void 0,json:void 0,text:f}}}else if(s.formEncType==="application/json"){if(!tc(o))return i();try{let f=typeof s.body=="string"?JSON.parse(s.body):s.body;return{path:t,submission:{formMethod:o,formAction:c,formEncType:s.formEncType,formData:void 0,json:f,text:void 0}}}catch{return i()}}}ft(typeof FormData=="function","FormData is not available in this environment");let d,h;if(s.formData)d=HI(s.formData),h=s.formData;else if(s.body instanceof FormData)d=HI(s.body),h=s.body;else if(s.body instanceof URLSearchParams)d=s.body,h=uB(d);else if(s.body==null)d=new URLSearchParams,h=new FormData;else try{d=new URLSearchParams(s.body),h=uB(d)}catch{return i()}let u={formMethod:o,formAction:c,formEncType:s&&s.formEncType||"application/x-www-form-urlencoded",formData:h,json:void 0,text:void 0};if(tc(u.formMethod))return{path:t,submission:u};let p=Sm(t);return e&&p.search&&f5(p.search)&&d.append("index",""),p.search="?"+d,{path:V0(p),submission:u}}function oB(n,e,t){t===void 0&&(t=!1);let s=n.findIndex(i=>i.route.id===e);return s>=0?n.slice(0,t?s+1:s):n}function lB(n,e,t,s,i,r,o,c,d,h,u,p,f,m,x,g){let b=g?lo(g[1])?g[1].error:g[1].data:void 0,y=n.createURL(e.location),C=n.createURL(i),w=t;r&&e.errors?w=oB(t,Object.keys(e.errors)[0],!0):g&&lo(g[1])&&(w=oB(t,g[0]));let S=g?g[1].statusCode:void 0,j=o&&S&&S>=400,T=w.filter((_,L)=>{let{route:D}=_;if(D.lazy)return!0;if(D.loader==null)return!1;if(r)return zI(D,e.loaderData,e.errors);if(xee(e.loaderData,e.matches[L],_)||d.some(M=>M===_.route.id))return!0;let P=e.matches[L],I=_;return cB(_,Vs({currentUrl:y,currentParams:P.params,nextUrl:C,nextParams:I.params},s,{actionResult:b,actionStatus:S,defaultShouldRevalidate:j?!1:c||y.pathname+y.search===C.pathname+C.search||y.search!==C.search||lG(P,I)}))}),k=[];return p.forEach((_,L)=>{if(r||!t.some(O=>O.route.id===_.routeId)||u.has(L))return;let D=Wm(m,_.path,x);if(!D){k.push({key:L,routeId:_.routeId,path:_.path,matches:null,match:null,controller:null});return}let P=e.fetchers.get(L),I=$S(D,_.path),M=!1;f.has(L)?M=!1:h.has(L)?(h.delete(L),M=!0):P&&P.state!=="idle"&&P.data===void 0?M=c:M=cB(I,Vs({currentUrl:y,currentParams:e.matches[e.matches.length-1].params,nextUrl:C,nextParams:t[t.length-1].params},s,{actionResult:b,actionStatus:S,defaultShouldRevalidate:j?!1:c})),M&&k.push({key:L,routeId:_.routeId,path:_.path,matches:D,match:I,controller:new AbortController})}),[T,k]}function zI(n,e,t){if(n.lazy)return!0;if(!n.loader)return!1;let s=e!=null&&e[n.id]!==void 0,i=t!=null&&t[n.id]!==void 0;return!s&&i?!1:typeof n.loader=="function"&&n.loader.hydrate===!0?!0:!s&&!i}function xee(n,e,t){let s=!e||t.route.id!==e.route.id,i=n[t.route.id]===void 0;return s||i}function lG(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function cB(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}function dB(n,e,t,s,i){var r;let o;if(n){let h=s[n];ft(h,"No route found to patch children into: routeId = "+n),h.children||(h.children=[]),o=h.children}else o=t;let c=e.filter(h=>!o.some(u=>cG(h,u))),d=J_(c,i,[n||"_","patch",String(((r=o)==null?void 0:r.length)||"0")],s);o.push(...d)}function cG(n,e){return"id"in n&&"id"in e&&n.id===e.id?!0:n.index===e.index&&n.path===e.path&&n.caseSensitive===e.caseSensitive?(!n.children||n.children.length===0)&&(!e.children||e.children.length===0)?!0:n.children.every((t,s)=>{var i;return(i=e.children)==null?void 0:i.some(r=>cG(t,r))}):!1}async function yee(n,e,t){if(!n.lazy)return;let s=await n.lazy();if(!n.lazy)return;let i=t[n.id];ft(i,"No route found in manifest");let r={};for(let o in s){let d=i[o]!==void 0&&o!=="hasErrorBoundary";H0(!d,'Route "'+i.id+'" has a static property "'+o+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+o+'" will be ignored.')),!d&&!zZ.has(o)&&(r[o]=s[o])}Object.assign(i,r),Object.assign(i,Vs({},e(i),{lazy:void 0}))}async function bee(n){let{matches:e}=n,t=e.filter(i=>i.shouldLoad);return(await Promise.all(t.map(i=>i.resolve()))).reduce((i,r,o)=>Object.assign(i,{[t[o].route.id]:r}),{})}async function vee(n,e,t,s,i,r,o,c,d,h){let u=r.map(m=>m.route.lazy?yee(m.route,d,c):void 0),p=r.map((m,x)=>{let g=u[x],b=i.some(C=>C.route.id===m.route.id);return Vs({},m,{shouldLoad:b,resolve:async C=>(C&&s.method==="GET"&&(m.route.lazy||m.route.loader)&&(b=!0),b?wee(e,s,m,g,C,h):Promise.resolve({type:Xt.data,result:void 0}))})}),f=await n({matches:p,request:s,params:r[0].params,fetcherKey:o,context:h});try{await Promise.all(u)}catch{}return f}async function wee(n,e,t,s,i,r){let o,c,d=h=>{let u,p=new Promise((x,g)=>u=g);c=()=>u(),e.signal.addEventListener("abort",c);let f=x=>typeof h!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+n+'" [routeId: '+t.route.id+"]"))):h({request:e,params:t.params,context:r},...x!==void 0?[x]:[]),m=(async()=>{try{return{type:"data",result:await(i?i(g=>f(g)):f())}}catch(x){return{type:"error",result:x}}})();return Promise.race([m,p])};try{let h=t.route[n];if(s)if(h){let u,[p]=await Promise.all([d(h).catch(f=>{u=f}),s]);if(u!==void 0)throw u;o=p}else if(await s,h=t.route[n],h)o=await d(h);else if(n==="action"){let u=new URL(e.url),p=u.pathname+u.search;throw ha(405,{method:e.method,pathname:p,routeId:t.route.id})}else return{type:Xt.data,result:void 0};else if(h)o=await d(h);else{let u=new URL(e.url),p=u.pathname+u.search;throw ha(404,{pathname:p})}ft(o.result!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(h){return{type:Xt.error,result:h}}finally{c&&e.signal.removeEventListener("abort",c)}return o}async function See(n){let{result:e,type:t}=n;if(hG(e)){let p;try{let f=e.headers.get("Content-Type");f&&/\bapplication\/json\b/.test(f)?e.body==null?p=null:p=await e.json():p=await e.text()}catch(f){return{type:Xt.error,error:f}}return t===Xt.error?{type:Xt.error,error:new eP(e.status,e.statusText,p),statusCode:e.status,headers:e.headers}:{type:Xt.data,data:p,statusCode:e.status,headers:e.headers}}if(t===Xt.error){if(xB(e)){var s,i;if(e.data instanceof Error){var r,o;return{type:Xt.error,error:e.data,statusCode:(r=e.init)==null?void 0:r.status,headers:(o=e.init)!=null&&o.headers?new Headers(e.init.headers):void 0}}return{type:Xt.error,error:new eP(((s=e.init)==null?void 0:s.status)||500,void 0,e.data),statusCode:xN(e)?e.status:void 0,headers:(i=e.init)!=null&&i.headers?new Headers(e.init.headers):void 0}}return{type:Xt.error,error:e,statusCode:xN(e)?e.status:void 0}}if(Eee(e)){var c,d;return{type:Xt.deferred,deferredData:e,statusCode:(c=e.init)==null?void 0:c.status,headers:((d=e.init)==null?void 0:d.headers)&&new Headers(e.init.headers)}}if(xB(e)){var h,u;return{type:Xt.data,data:e.data,statusCode:(h=e.init)==null?void 0:h.status,headers:(u=e.init)!=null&&u.headers?new Headers(e.init.headers):void 0}}return{type:Xt.data,data:e}}function Cee(n,e,t,s,i,r){let o=n.headers.get("Location");if(ft(o,"Redirects returned/thrown from loaders/actions must have a Location header"),!u5.test(o)){let c=s.slice(0,s.findIndex(d=>d.route.id===t)+1);o=UI(new URL(e.url),c,i,!0,o,r),n.headers.set("Location",o)}return n}function hB(n,e,t){if(u5.test(n)){let s=n,i=s.startsWith("//")?new URL(e.protocol+s):new URL(s),r=_d(i.pathname,t)!=null;if(i.origin===e.origin&&r)return i.pathname+i.search+i.hash}return n}function hy(n,e,t,s){let i=n.createURL(dG(e)).toString(),r={signal:t};if(s&&tc(s.formMethod)){let{formMethod:o,formEncType:c}=s;r.method=o.toUpperCase(),c==="application/json"?(r.headers=new Headers({"Content-Type":c}),r.body=JSON.stringify(s.json)):c==="text/plain"?r.body=s.text:c==="application/x-www-form-urlencoded"&&s.formData?r.body=HI(s.formData):r.body=s.formData}return new Request(i,r)}function HI(n){let e=new URLSearchParams;for(let[t,s]of n.entries())e.append(t,typeof s=="string"?s:s.name);return e}function uB(n){let e=new FormData;for(let[t,s]of n.entries())e.append(t,s);return e}function Nee(n,e,t,s,i){let r={},o=null,c,d=!1,h={},u=t&&lo(t[1])?t[1].error:void 0;return n.forEach(p=>{if(!(p.route.id in e))return;let f=p.route.id,m=e[f];if(ft(!tg(m),"Cannot handle redirect results in processLoaderData"),lo(m)){let x=m.error;u!==void 0&&(x=u,u=void 0),o=o||{};{let g=qm(n,f);o[g.route.id]==null&&(o[g.route.id]=x)}r[f]=void 0,d||(d=!0,c=xN(m.error)?m.error.status:500),m.headers&&(h[f]=m.headers)}else Kf(m)?(s.set(f,m.deferredData),r[f]=m.deferredData.data,m.statusCode!=null&&m.statusCode!==200&&!d&&(c=m.statusCode),m.headers&&(h[f]=m.headers)):(r[f]=m.data,m.statusCode&&m.statusCode!==200&&!d&&(c=m.statusCode),m.headers&&(h[f]=m.headers))}),u!==void 0&&t&&(o={[t[0]]:u},r[t[0]]=void 0),{loaderData:r,errors:o,statusCode:c||200,loaderHeaders:h}}function pB(n,e,t,s,i,r,o){let{loaderData:c,errors:d}=Nee(e,t,s,o);return i.forEach(h=>{let{key:u,match:p,controller:f}=h,m=r[u];if(ft(m,"Did not find corresponding fetcher result"),!(f&&f.signal.aborted))if(lo(m)){let x=qm(n.matches,p==null?void 0:p.route.id);d&&d[x.route.id]||(d=Vs({},d,{[x.route.id]:m.error})),n.fetchers.delete(u)}else if(tg(m))ft(!1,"Unhandled fetcher revalidation redirect");else if(Kf(m))ft(!1,"Unhandled fetcher deferred data");else{let x=Ku(m.data);n.fetchers.set(u,x)}}),{loaderData:c,errors:d}}function fB(n,e,t,s){let i=Vs({},e);for(let r of t){let o=r.route.id;if(e.hasOwnProperty(o)?e[o]!==void 0&&(i[o]=e[o]):n[o]!==void 0&&r.route.loader&&(i[o]=n[o]),s&&s.hasOwnProperty(o))break}return i}function mB(n){return n?lo(n[1])?{actionData:{}}:{actionData:{[n[0]]:n[1].data}}:{}}function qm(n,e){return(e?n.slice(0,n.findIndex(s=>s.route.id===e)+1):[...n]).reverse().find(s=>s.route.hasErrorBoundary===!0)||n[0]}function gB(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function ha(n,e){let{pathname:t,routeId:s,method:i,type:r,message:o}=e===void 0?{}:e,c="Unknown Server Error",d="Unknown @remix-run/router error";return n===400?(c="Bad Request",i&&t&&s?d="You made a "+i+' request to "'+t+'" but '+('did not provide a `loader` for route "'+s+'", ')+"so there is no way to handle the request.":r==="defer-action"?d="defer() is not supported in actions":r==="invalid-body"&&(d="Unable to encode submission body")):n===403?(c="Forbidden",d='Route "'+s+'" does not match URL "'+t+'"'):n===404?(c="Not Found",d='No route matches URL "'+t+'"'):n===405&&(c="Method Not Allowed",i&&t&&s?d="You made a "+i.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+s+'", ')+"so there is no way to handle the request.":i&&(d='Invalid request method "'+i.toUpperCase()+'"')),new eP(n||500,c,new Error(d),!0)}function ik(n){let e=Object.entries(n);for(let t=e.length-1;t>=0;t--){let[s,i]=e[t];if(tg(i))return{key:s,result:i}}}function dG(n){let e=typeof n=="string"?Sm(n):n;return V0(Vs({},e,{hash:""}))}function jee(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function Aee(n){return hG(n.result)&&hee.has(n.result.status)}function Kf(n){return n.type===Xt.deferred}function lo(n){return n.type===Xt.error}function tg(n){return(n&&n.type)===Xt.redirect}function xB(n){return typeof n=="object"&&n!=null&&"type"in n&&"data"in n&&"init"in n&&n.type==="DataWithResponseInit"}function Eee(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function hG(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function kee(n){return dee.has(n.toLowerCase())}function tc(n){return lee.has(n.toLowerCase())}async function Tee(n,e,t,s,i){let r=Object.entries(e);for(let o=0;o<r.length;o++){let[c,d]=r[o],h=n.find(f=>(f==null?void 0:f.route.id)===c);if(!h)continue;let u=s.find(f=>f.route.id===h.route.id),p=u!=null&&!lG(u,h)&&(i&&i[h.route.id])!==void 0;Kf(d)&&p&&await p5(d,t,!1).then(f=>{f&&(e[c]=f)})}}async function _ee(n,e,t){for(let s=0;s<t.length;s++){let{key:i,routeId:r,controller:o}=t[s],c=e[i];n.find(h=>(h==null?void 0:h.route.id)===r)&&Kf(c)&&(ft(o,"Expected an AbortController for revalidating fetcher deferred result"),await p5(c,o.signal,!0).then(h=>{h&&(e[i]=h)}))}}async function p5(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:Xt.data,data:n.deferredData.unwrappedData}}catch(i){return{type:Xt.error,error:i}}return{type:Xt.data,data:n.deferredData.data}}}function f5(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function $S(n,e){let t=typeof e=="string"?Sm(e).search:e.search;if(n[n.length-1].route.index&&f5(t||""))return n[n.length-1];let s=rG(n);return s[s.length-1]}function yB(n){let{formMethod:e,formAction:t,formEncType:s,text:i,formData:r,json:o}=n;if(!(!e||!t||!s)){if(i!=null)return{formMethod:e,formAction:t,formEncType:s,formData:void 0,json:void 0,text:i};if(r!=null)return{formMethod:e,formAction:t,formEncType:s,formData:r,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:t,formEncType:s,formData:void 0,json:o,text:void 0}}}function UD(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function Pee(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function uS(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function Lee(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function Ku(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function Dee(n,e){try{let t=n.sessionStorage.getItem(oG);if(t){let s=JSON.parse(t);for(let[i,r]of Object.entries(s||{}))r&&Array.isArray(r)&&e.set(i,new Set(r||[]))}}catch{}}function Ree(n,e){if(e.size>0){let t={};for(let[s,i]of e)t[s]=[...i];try{n.sessionStorage.setItem(oG,JSON.stringify(t))}catch(s){H0(!1,"Failed to save applied view transitions in sessionStorage ("+s+").")}}}/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tP(){return tP=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},tP.apply(this,arguments)}const mE=N.createContext(null),LL=N.createContext(null),Id=N.createContext(null),m5=N.createContext(null),Md=N.createContext({outlet:null,matches:[],isDataRoute:!1}),uG=N.createContext(null);function Iee(n,e){let{relative:t}=e===void 0?{}:e;V1()||ft(!1);let{basename:s,navigator:i}=N.useContext(Id),{hash:r,pathname:o,search:c}=RL(n,{relative:t}),d=o;return s!=="/"&&(d=o==="/"?s:wu([s,o])),i.createHref({pathname:d,search:c,hash:r})}function V1(){return N.useContext(m5)!=null}function Qi(){return V1()||ft(!1),N.useContext(m5).location}function pG(n){N.useContext(Id).static||N.useLayoutEffect(n)}function Qt(){let{isDataRoute:n}=N.useContext(Md);return n?Xee():Mee()}function Mee(){V1()||ft(!1);let n=N.useContext(mE),{basename:e,future:t,navigator:s}=N.useContext(Id),{matches:i}=N.useContext(Md),{pathname:r}=Qi(),o=JSON.stringify(_L(i,t.v7_relativeSplatPath)),c=N.useRef(!1);return pG(()=>{c.current=!0}),N.useCallback(function(h,u){if(u===void 0&&(u={}),!c.current)return;if(typeof h=="number"){s.go(h);return}let p=PL(h,JSON.parse(o),r,u.relative==="path");n==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:wu([e,p.pathname])),(u.replace?s.replace:s.push)(p,u.state,u)},[e,s,o,r,n])}const Fee=N.createContext(null);function Oee(n){let e=N.useContext(Md).outlet;return e&&N.createElement(Fee.Provider,{value:n},e)}function DL(){let{matches:n}=N.useContext(Md),e=n[n.length-1];return e?e.params:{}}function RL(n,e){let{relative:t}=e===void 0?{}:e,{future:s}=N.useContext(Id),{matches:i}=N.useContext(Md),{pathname:r}=Qi(),o=JSON.stringify(_L(i,s.v7_relativeSplatPath));return N.useMemo(()=>PL(n,JSON.parse(o),r,t==="path"),[n,o,r,t])}function Bee(n,e,t,s){V1()||ft(!1);let{navigator:i}=N.useContext(Id),{matches:r}=N.useContext(Md),o=r[r.length-1],c=o?o.params:{};o&&o.pathname;let d=o?o.pathnameBase:"/";o&&o.route;let h=Qi(),u;u=h;let p=u.pathname||"/",f=p;if(d!=="/"){let g=d.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(g.length).join("/")}let m=Wm(n,{pathname:f});return Vee(m&&m.map(g=>Object.assign({},g,{params:Object.assign({},c,g.params),pathname:wu([d,i.encodeLocation?i.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?d:wu([d,i.encodeLocation?i.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),r,t,s)}function $ee(){let n=Yee(),e=xN(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),t?N.createElement("pre",{style:i},t):null,null)}const Uee=N.createElement($ee,null);class zee extends N.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?N.createElement(Md.Provider,{value:this.props.routeContext},N.createElement(uG.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Hee(n){let{routeContext:e,match:t,children:s}=n,i=N.useContext(mE);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),N.createElement(Md.Provider,{value:e},s)}function Vee(n,e,t,s){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),s===void 0&&(s=null),n==null){var r;if(!t)return null;if(t.errors)n=t.matches;else if((r=s)!=null&&r.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,c=(i=t)==null?void 0:i.errors;if(c!=null){let u=o.findIndex(p=>p.route.id&&(c==null?void 0:c[p.route.id])!==void 0);u>=0||ft(!1),o=o.slice(0,Math.min(o.length,u+1))}let d=!1,h=-1;if(t&&s&&s.v7_partialHydration)for(let u=0;u<o.length;u++){let p=o[u];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=u),p.route.id){let{loaderData:f,errors:m}=t,x=p.route.loader&&f[p.route.id]===void 0&&(!m||m[p.route.id]===void 0);if(p.route.lazy||x){d=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}return o.reduceRight((u,p,f)=>{let m,x=!1,g=null,b=null;t&&(m=c&&p.route.id?c[p.route.id]:void 0,g=p.route.errorElement||Uee,d&&(h<0&&f===0?(Kee("route-fallback"),x=!0,b=null):h===f&&(x=!0,b=p.route.hydrateFallbackElement||null)));let y=e.concat(o.slice(0,f+1)),C=()=>{let w;return m?w=g:x?w=b:p.route.Component?w=N.createElement(p.route.Component,null):p.route.element?w=p.route.element:w=u,N.createElement(Hee,{match:p,routeContext:{outlet:u,matches:y,isDataRoute:t!=null},children:w})};return t&&(p.route.ErrorBoundary||p.route.errorElement||f===0)?N.createElement(zee,{location:t.location,revalidation:t.revalidation,component:g,error:m,children:C(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):C()},null)}var fG=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(fG||{}),mG=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(mG||{});function Gee(n){let e=N.useContext(mE);return e||ft(!1),e}function g5(n){let e=N.useContext(LL);return e||ft(!1),e}function Wee(n){let e=N.useContext(Md);return e||ft(!1),e}function gG(n){let e=Wee(),t=e.matches[e.matches.length-1];return t.route.id||ft(!1),t.route.id}function qee(){return g5().navigation}function xG(){let{matches:n,loaderData:e}=g5();return N.useMemo(()=>n.map(t=>sG(t,e)),[n,e])}function Yee(){var n;let e=N.useContext(uG),t=g5(mG.UseRouteError),s=gG();return e!==void 0?e:(n=t.errors)==null?void 0:n[s]}function Xee(){let{router:n}=Gee(fG.UseNavigateStable),e=gG(),t=N.useRef(!1);return pG(()=>{t.current=!0}),N.useCallback(function(i,r){r===void 0&&(r={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,tP({fromRouteId:e},r)))},[n,e])}const bB={};function Kee(n,e,t){bB[n]||(bB[n]=!0)}function Qee(n,e){n==null||n.v7_startTransition,(n==null?void 0:n.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Ln(n){let{to:e,replace:t,state:s,relative:i}=n;V1()||ft(!1);let{future:r,static:o}=N.useContext(Id),{matches:c}=N.useContext(Md),{pathname:d}=Qi(),h=Qt(),u=PL(e,_L(c,r.v7_relativeSplatPath),d,i==="path"),p=JSON.stringify(u);return N.useEffect(()=>h(JSON.parse(p),{replace:t,state:s,relative:i}),[h,p,i,t,s]),null}function gE(n){return Oee(n.context)}function Jee(n){let{basename:e="/",children:t=null,location:s,navigationType:i=Vn.Pop,navigator:r,static:o=!1,future:c}=n;V1()&&ft(!1);let d=e.replace(/^\/*/,"/"),h=N.useMemo(()=>({basename:d,navigator:r,static:o,future:tP({v7_relativeSplatPath:!1},c)}),[d,c,r,o]);typeof s=="string"&&(s=Sm(s));let{pathname:u="/",search:p="",hash:f="",state:m=null,key:x="default"}=s,g=N.useMemo(()=>{let b=_d(u,d);return b==null?null:{location:{pathname:b,search:p,hash:f,state:m,key:x},navigationType:i}},[d,u,p,f,m,x,i]);return g==null?null:N.createElement(Id.Provider,{value:h},N.createElement(m5.Provider,{children:t,value:g}))}new Promise(()=>{});function Zee(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:N.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:N.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:N.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function G0(){return G0=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},G0.apply(this,arguments)}function yG(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function ete(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function tte(n,e){return n.button===0&&(!e||e==="_self")&&!ete(n)}function VI(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let s=n[t];return e.concat(Array.isArray(s)?s.map(i=>[t,i]):[[t,s]])},[]))}function ste(n,e){let t=VI(n);return e&&e.forEach((s,i)=>{t.has(i)||e.getAll(i).forEach(r=>{t.append(i,r)})}),t}const nte=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ite=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],rte="6";try{window.__reactRouterVersion=rte}catch{}function ate(n,e){return mee({basename:void 0,future:G0({},void 0,{v7_prependBasename:!0}),history:BZ({window:void 0}),hydrationData:ote(),routes:n,mapRouteProperties:Zee,dataStrategy:void 0,patchRoutesOnNavigation:void 0,window:void 0}).initialize()}function ote(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=G0({},e,{errors:lte(e.errors)})),e}function lte(n){if(!n)return null;let e=Object.entries(n),t={};for(let[s,i]of e)if(i&&i.__type==="RouteErrorResponse")t[s]=new eP(i.status,i.statusText,i.data,i.internal===!0);else if(i&&i.__type==="Error"){if(i.__subType){let r=window[i.__subType];if(typeof r=="function")try{let o=new r(i.message);o.stack="",t[s]=o}catch{}}if(t[s]==null){let r=new Error(i.message);r.stack="",t[s]=r}}else t[s]=i;return t}const bG=N.createContext({isTransitioning:!1}),cte=N.createContext(new Map),dte="startTransition",vB=AQ[dte],hte="flushSync",wB=OZ[hte];function ute(n){vB?vB(n):n()}function pS(n){wB?wB(n):n()}class pte{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=s=>{this.status==="pending"&&(this.status="resolved",e(s))},this.reject=s=>{this.status==="pending"&&(this.status="rejected",t(s))}})}}function fte(n){let{fallbackElement:e,router:t,future:s}=n,[i,r]=N.useState(t.state),[o,c]=N.useState(),[d,h]=N.useState({isTransitioning:!1}),[u,p]=N.useState(),[f,m]=N.useState(),[x,g]=N.useState(),b=N.useRef(new Map),{v7_startTransition:y}=s||{},C=N.useCallback(_=>{y?ute(_):_()},[y]),w=N.useCallback((_,L)=>{let{deletedFetchers:D,flushSync:P,viewTransitionOpts:I}=L;_.fetchers.forEach((O,F)=>{O.data!==void 0&&b.current.set(F,O.data)}),D.forEach(O=>b.current.delete(O));let M=t.window==null||t.window.document==null||typeof t.window.document.startViewTransition!="function";if(!I||M){P?pS(()=>r(_)):C(()=>r(_));return}if(P){pS(()=>{f&&(u&&u.resolve(),f.skipTransition()),h({isTransitioning:!0,flushSync:!0,currentLocation:I.currentLocation,nextLocation:I.nextLocation})});let O=t.window.document.startViewTransition(()=>{pS(()=>r(_))});O.finished.finally(()=>{pS(()=>{p(void 0),m(void 0),c(void 0),h({isTransitioning:!1})})}),pS(()=>m(O));return}f?(u&&u.resolve(),f.skipTransition(),g({state:_,currentLocation:I.currentLocation,nextLocation:I.nextLocation})):(c(_),h({isTransitioning:!0,flushSync:!1,currentLocation:I.currentLocation,nextLocation:I.nextLocation}))},[t.window,f,u,b,C]);N.useLayoutEffect(()=>t.subscribe(w),[t,w]),N.useEffect(()=>{d.isTransitioning&&!d.flushSync&&p(new pte)},[d]),N.useEffect(()=>{if(u&&o&&t.window){let _=o,L=u.promise,D=t.window.document.startViewTransition(async()=>{C(()=>r(_)),await L});D.finished.finally(()=>{p(void 0),m(void 0),c(void 0),h({isTransitioning:!1})}),m(D)}},[C,o,u,t.window]),N.useEffect(()=>{u&&o&&i.location.key===o.location.key&&u.resolve()},[u,f,i.location,o]),N.useEffect(()=>{!d.isTransitioning&&x&&(c(x.state),h({isTransitioning:!0,flushSync:!1,currentLocation:x.currentLocation,nextLocation:x.nextLocation}),g(void 0))},[d.isTransitioning,x]),N.useEffect(()=>{},[]);let S=N.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:_=>t.navigate(_),push:(_,L,D)=>t.navigate(_,{state:L,preventScrollReset:D==null?void 0:D.preventScrollReset}),replace:(_,L,D)=>t.navigate(_,{replace:!0,state:L,preventScrollReset:D==null?void 0:D.preventScrollReset})}),[t]),j=t.basename||"/",T=N.useMemo(()=>({router:t,navigator:S,static:!1,basename:j}),[t,S,j]),k=N.useMemo(()=>({v7_relativeSplatPath:t.future.v7_relativeSplatPath}),[t.future.v7_relativeSplatPath]);return N.useEffect(()=>Qee(s,t.future),[s,t.future]),N.createElement(N.Fragment,null,N.createElement(mE.Provider,{value:T},N.createElement(LL.Provider,{value:i},N.createElement(cte.Provider,{value:b.current},N.createElement(bG.Provider,{value:d},N.createElement(Jee,{basename:j,location:i.location,navigationType:i.historyAction,navigator:S,future:k},i.initialized||t.future.v7_partialHydration?N.createElement(mte,{routes:t.routes,future:t.future,state:i}):e))))),null)}const mte=N.memo(gte);function gte(n){let{routes:e,future:t,state:s}=n;return Bee(e,void 0,s,t)}const xte=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",yte=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qe=N.forwardRef(function(e,t){let{onClick:s,relative:i,reloadDocument:r,replace:o,state:c,target:d,to:h,preventScrollReset:u,viewTransition:p}=e,f=yG(e,nte),{basename:m}=N.useContext(Id),x,g=!1;if(typeof h=="string"&&yte.test(h)&&(x=h,xte))try{let w=new URL(window.location.href),S=h.startsWith("//")?new URL(w.protocol+h):new URL(h),j=_d(S.pathname,m);S.origin===w.origin&&j!=null?h=j+S.search+S.hash:g=!0}catch{}let b=Iee(h,{relative:i}),y=vte(h,{replace:o,state:c,target:d,preventScrollReset:u,relative:i,viewTransition:p});function C(w){s&&s(w),w.defaultPrevented||y(w)}return N.createElement("a",G0({},f,{href:x||b,onClick:g||r?s:C,ref:t,target:d}))}),vG=N.forwardRef(function(e,t){let{"aria-current":s="page",caseSensitive:i=!1,className:r="",end:o=!1,style:c,to:d,viewTransition:h,children:u}=e,p=yG(e,ite),f=RL(d,{relative:p.relative}),m=Qi(),x=N.useContext(LL),{navigator:g,basename:b}=N.useContext(Id),y=x!=null&&Nte(f)&&h===!0,C=g.encodeLocation?g.encodeLocation(f).pathname:f.pathname,w=m.pathname,S=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;i||(w=w.toLowerCase(),S=S?S.toLowerCase():null,C=C.toLowerCase()),S&&b&&(S=_d(S,b)||S);const j=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let T=w===C||!o&&w.startsWith(C)&&w.charAt(j)==="/",k=S!=null&&(S===C||!o&&S.startsWith(C)&&S.charAt(C.length)==="/"),_={isActive:T,isPending:k,isTransitioning:y},L=T?s:void 0,D;typeof r=="function"?D=r(_):D=[r,T?"active":null,k?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let P=typeof c=="function"?c(_):c;return N.createElement(qe,G0({},p,{"aria-current":L,className:D,ref:t,style:P,to:d,viewTransition:h}),typeof u=="function"?u(_):u)});function wG(n){let{getKey:e,storageKey:t}=n;return Ste({getKey:e,storageKey:t}),null}var sP;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(sP||(sP={}));var GI;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(GI||(GI={}));function SG(n){let e=N.useContext(mE);return e||ft(!1),e}function bte(n){let e=N.useContext(LL);return e||ft(!1),e}function vte(n,e){let{target:t,replace:s,state:i,preventScrollReset:r,relative:o,viewTransition:c}=e===void 0?{}:e,d=Qt(),h=Qi(),u=RL(n,{relative:o});return N.useCallback(p=>{if(tte(p,t)){p.preventDefault();let f=s!==void 0?s:V0(h)===V0(u);d(n,{replace:f,state:i,preventScrollReset:r,relative:o,viewTransition:c})}},[h,d,u,s,i,t,n,r,o,c])}function wte(n){let e=N.useRef(VI(n)),t=N.useRef(!1),s=Qi(),i=N.useMemo(()=>ste(s.search,t.current?null:e.current),[s.search]),r=Qt(),o=N.useCallback((c,d)=>{const h=VI(typeof c=="function"?c(i):c);t.current=!0,r("?"+h,d)},[r,i]);return[i,o]}const SB="react-router-scroll-positions";let rk={};function Ste(n){let{getKey:e,storageKey:t}=n===void 0?{}:n,{router:s}=SG(sP.UseScrollRestoration),{restoreScrollPosition:i,preventScrollReset:r}=bte(GI.UseScrollRestoration),{basename:o}=N.useContext(Id),c=Qi(),d=xG(),h=qee();N.useEffect(()=>(window.history.scrollRestoration="manual",()=>{window.history.scrollRestoration="auto"}),[]),Cte(N.useCallback(()=>{if(h.state==="idle"){let u=(e?e(c,d):null)||c.key;rk[u]=window.scrollY}try{sessionStorage.setItem(t||SB,JSON.stringify(rk))}catch{}window.history.scrollRestoration="auto"},[t,e,h.state,c,d])),typeof document<"u"&&(N.useLayoutEffect(()=>{try{let u=sessionStorage.getItem(t||SB);u&&(rk=JSON.parse(u))}catch{}},[t]),N.useLayoutEffect(()=>{let u=e&&o!=="/"?(f,m)=>e(G0({},f,{pathname:_d(f.pathname,o)||f.pathname}),m):e,p=s==null?void 0:s.enableScrollRestoration(rk,()=>window.scrollY,u);return()=>p&&p()},[s,o,e]),N.useLayoutEffect(()=>{if(i!==!1){if(typeof i=="number"){window.scrollTo(0,i);return}if(c.hash){let u=document.getElementById(decodeURIComponent(c.hash.slice(1)));if(u){u.scrollIntoView();return}}r!==!0&&window.scrollTo(0,0)}},[c,i,r]))}function Cte(n,e){let{capture:t}={};N.useEffect(()=>{let s=t!=null?{capture:t}:void 0;return window.addEventListener("pagehide",n,s),()=>{window.removeEventListener("pagehide",n,s)}},[n,t])}function Nte(n,e){e===void 0&&(e={});let t=N.useContext(bG);t==null&&ft(!1);let{basename:s}=SG(sP.useViewTransitionState),i=RL(n,{relative:e.relative});if(!t.isTransitioning)return!1;let r=_d(t.currentLocation.pathname,s)||t.currentLocation.pathname,o=_d(t.nextLocation.pathname,s)||t.nextLocation.pathname;return Z_(i.pathname,o)!=null||Z_(i.pathname,r)!=null}const ji=[];for(let n=0;n<256;++n)ji.push((n+256).toString(16).slice(1));function jte(n,e=0){return(ji[n[e+0]]+ji[n[e+1]]+ji[n[e+2]]+ji[n[e+3]]+"-"+ji[n[e+4]]+ji[n[e+5]]+"-"+ji[n[e+6]]+ji[n[e+7]]+"-"+ji[n[e+8]]+ji[n[e+9]]+"-"+ji[n[e+10]]+ji[n[e+11]]+ji[n[e+12]]+ji[n[e+13]]+ji[n[e+14]]+ji[n[e+15]]).toLowerCase()}let zD;const Ate=new Uint8Array(16);function Ete(){if(!zD){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");zD=crypto.getRandomValues.bind(crypto)}return zD(Ate)}const kte=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),CB={randomUUID:kte};function Tte(n,e,t){var i;n=n||{};const s=n.random??((i=n.rng)==null?void 0:i.call(n))??Ete();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,jte(s)}function E1(n,e,t){return CB.randomUUID&&!n?CB.randomUUID():Tte(n)}const I0={idle:{key:"idle",label:"",childLabel:"",progress:0},uploading:{key:"uploading",label:"Uploading your lesson...",childLabel:" Sending to Jeffrey...",progress:15},extracting:{key:"extracting",label:"Reading the content...",childLabel:" Jeffrey is reading...",progress:35},analyzing:{key:"analyzing",label:"Understanding the lesson...",childLabel:" Jeffrey is thinking...",progress:60},generating:{key:"generating",label:"Preparing your study materials...",childLabel:" Making it fun to learn...",progress:85},complete:{key:"complete",label:"Ready to learn!",childLabel:" Let's go!",progress:100},error:{key:"error",label:"Something went wrong",childLabel:" Oops! Let's try again",progress:0}},ak=["Jeffrey is putting on his reading glasses... ","Turning pages really fast... ","Looking for the important stuff... ","Making flashcards in his head... ","Getting excited to teach you! ","Almost ready for learning fun! "],NB={title:"",summary:"",gradeLevel:"",subject:"",rawText:"",chapters:[],keyConceptsForChat:[],vocabulary:[],suggestedQuestions:[],relatedTopics:[],progress:{started:!1,percentComplete:0,lastAccessedAt:null,timeSpent:0},contentFlags:{reviewed:!1,aiConfidence:0}},_te="http://localhost:3000";let km=null,Bd=null,fS=null,HD=!1,ok=[];const VD=new Set;let IL=!0;try{const n="__storage_test__";localStorage.setItem(n,n),localStorage.removeItem(n)}catch{IL=!1,console.warn("localStorage not available (incognito mode?). Using memory-only storage.")}function lk(n){if(!IL)return null;try{return localStorage.getItem(n)}catch(e){return console.warn(`Failed to read ${n} from localStorage:`,e),null}}function ck(n,e){if(IL)try{localStorage.setItem(n,e)}catch(t){console.warn(`Failed to write ${n} to localStorage:`,t)}}function uy(n){if(IL)try{localStorage.removeItem(n)}catch(e){console.warn(`Failed to remove ${n} from localStorage:`,e)}}const $t={initialize(){const n=lk("auth_token"),e=lk("child_token"),t=lk("refresh_token");return n&&(km=n),e&&(Bd=e),t&&(fS=t),{hasAccessToken:!!km,hasChildToken:!!Bd}},getAccessToken(){return km},getChildToken(){return Bd},getActiveToken(){return Bd||km},setTokens({token:n,refreshToken:e,childToken:t}){n&&(km=n,ck("auth_token",n)),e&&(fS=e,ck("refresh_token",e)),t&&(Bd=t,ck("child_token",t)),this.notifyListeners()},setChildToken(n){Bd=n,n?ck("child_token",n):uy("child_token"),this.notifyListeners()},clearChildToken(){Bd=null,uy("child_token"),this.notifyListeners()},clearTokens(){km=null,Bd=null,fS=null,uy("auth_token"),uy("refresh_token"),uy("child_token"),uy("current_profile_id"),this.notifyListeners()},getRefreshToken(){return fS||lk("refresh_token")},isAuthenticated(){return!!km},isChildMode(){return!!Bd},async refreshAccessToken(){const n=this.getRefreshToken();if(!n)throw new Error("No refresh token available");if(HD)return new Promise((e,t)=>{ok.push({resolve:e,reject:t})});HD=!0;try{const e=await fetch(`${_te}/api/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({refreshToken:n})});if(!e.ok)throw this.clearTokens(),new Error("Token refresh failed");const t=await e.json(),s=t.data||t;return this.setTokens({token:s.token,refreshToken:s.refreshToken}),ok.forEach(({resolve:i})=>i(s)),s}catch(e){throw ok.forEach(({reject:t})=>t(e)),e}finally{HD=!1,ok=[]}},subscribe(n){return VD.add(n),()=>VD.delete(n)},notifyListeners(){const n={isAuthenticated:this.isAuthenticated(),isChildMode:this.isChildMode()};VD.forEach(e=>e(n))}},CG="http://localhost:3000";let WI=[],dk=!1;function jB(n,e=null){WI.forEach(({resolve:t,reject:s})=>{n?s(n):t(e)}),WI=[]}async function yd(n,e={},t={}){const{skipAuth:s=!1,useChildToken:i=!1,retryCount:r=0}=t,o={"Content-Type":"application/json",...e.headers};if(!s){const d=i?$t.getChildToken():$t.getActiveToken();d&&(o.Authorization=`Bearer ${d}`)}const c={...e,headers:o,credentials:"include"};try{const d=await fetch(`${CG}/api${n}`,c);if(d.status===401&&r===0&&!n.includes("/auth/refresh")&&!s){if($t.isChildMode()&&i)return $t.clearChildToken(),yd(n,e,{...t,useChildToken:!1,retryCount:1});if(!dk){dk=!0;try{return await $t.refreshAccessToken(),dk=!1,jB(null,$t.getAccessToken()),yd(n,e,{...t,retryCount:1})}catch(h){throw dk=!1,jB(h,null),new Error("Session expired. Please log in again.")}}return new Promise((h,u)=>{WI.push({resolve:h,reject:u})}).then(()=>yd(n,e,{...t,retryCount:1}))}if(!d.ok){const h=await d.json().catch(()=>({})),u=new Error(h.error||h.message||`HTTP error! status: ${d.status}`);throw u.status=d.status,u.data=h,u}return d.json()}catch(d){throw d.status||(d.message=d.message||"Network error. Please check your connection."),d}}const Nc={get:(n,e={},t={})=>yd(n,{...e,method:"GET"},t),post:(n,e,t={},s={})=>yd(n,{...t,method:"POST",body:JSON.stringify(e)},s),put:(n,e,t={},s={})=>yd(n,{...t,method:"PUT",body:JSON.stringify(e)},s),patch:(n,e,t={},s={})=>yd(n,{...t,method:"PATCH",body:JSON.stringify(e)},s),delete:(n,e={},t={})=>yd(n,{...e,method:"DELETE"},t)};function Qu(n,e={}){return yd(n,e,{skipAuth:!0})}const xr={signUp:async({email:n,password:e,firstName:t,lastName:s,country:i})=>Qu("/auth/signup",{method:"POST",body:JSON.stringify({email:n,password:e,firstName:t,lastName:s,country:i||"US"})}),signIn:async({email:n,password:e})=>{const t=await Qu("/auth/login",{method:"POST",body:JSON.stringify({email:n,password:e})});if(t.success){const s=t.data||t;s.token&&$t.setTokens({token:s.token,refreshToken:s.refreshToken})}return t},logout:async()=>{const n=$t.getRefreshToken();try{return await Nc.post("/auth/logout",{refreshToken:n})}finally{$t.clearTokens()}},verifyEmail:async(n,e)=>{const t=await Qu("/auth/verify-email",{method:"POST",body:JSON.stringify({email:n,code:e})});return t.success&&t.token&&$t.setTokens({token:t.token,refreshToken:t.refreshToken}),t},resendVerificationEmail:async n=>Qu("/auth/resend-verification",{method:"POST",body:JSON.stringify({email:n})}),requestPasswordReset:async n=>Qu("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:n})}),verifyResetCode:async(n,e)=>Qu("/auth/verify-reset-code",{method:"POST",body:JSON.stringify({email:n,code:e})}),resetPassword:async(n,e)=>Qu("/auth/reset-password",{method:"POST",body:JSON.stringify({email:n,newPassword:e})}),refreshToken:async()=>$t.refreshAccessToken(),getCurrentUser:async()=>Nc.get("/auth/me"),updateProfile:async n=>Nc.patch("/auth/profile",n),changePassword:async(n,e)=>Nc.post("/auth/change-password",{currentPassword:n,newPassword:e}),deleteAccount:async()=>Nc.delete("/auth/delete-account"),switchToChild:async(n,e)=>{const t=await Nc.post(`/auth/children/${n}/switch`,{pin:e});if(t.success){const s=t.data||t;s.childToken&&$t.setChildToken(s.childToken)}return t},switchToParent:()=>{$t.clearChildToken()},logoutAll:async()=>{const n=await Nc.post("/auth/logout-all",{});return $t.clearTokens(),n}},AB={GAME_PROGRESS:"userGameProgress"},Xu={USER:"orbitlearn:user:",CHILD:"orbitlearn:child:",GLOBAL:"orbitlearn:global:"};let py=null,Tm=null;const jd=new Map,GD=new Set;let G1=!0;try{const n="__storage_test__";localStorage.setItem(n,n),localStorage.removeItem(n)}catch{G1=!1,console.warn("localStorage not available (incognito mode?). Using memory-only storage.")}function WD(n){if(!G1)return jd.get(n)||null;try{return localStorage.getItem(n)}catch(e){return console.warn(`Failed to read ${n} from localStorage:`,e),jd.get(n)||null}}function EB(n,e){if(jd.set(n,e),!!G1)try{localStorage.setItem(n,e)}catch(t){console.warn(`Failed to write ${n} to localStorage:`,t)}}function hk(n){if(jd.delete(n),!!G1)try{localStorage.removeItem(n)}catch(e){console.warn(`Failed to remove ${n} from localStorage:`,e)}}function qD(n){if(!G1)return Array.from(jd.keys())[n]||null;try{return localStorage.key(n)}catch{return null}}function kB(){if(!G1)return jd.size;try{return localStorage.length}catch{return jd.size}}const Rr={initialize(n,e=null){py=n,Tm=e,n&&this.migrateLegacyData(n,e)},setCurrentChild(n){Tm=n},buildKey(n,{userScoped:e=!0,childScoped:t=!1}={}){return t&&Tm?`${Xu.CHILD}${Tm}:${n}`:e&&py?`${Xu.USER}${py}:${n}`:`${Xu.GLOBAL}${n}`},get(n,e={}){try{const t=this.buildKey(n,e),s=WD(t);return s?JSON.parse(s):null}catch(t){return console.error(`Error reading from storage: ${n}`,t),null}},set(n,e,t={}){try{const s=this.buildKey(n,t);EB(s,JSON.stringify(e)),this.notifyListeners(n,e)}catch(s){console.error(`Error writing to storage: ${n}`,s)}},remove(n,e={}){try{const t=this.buildKey(n,e);hk(t),this.notifyListeners(n,null)}catch(t){console.error(`Error removing from storage: ${n}`,t)}},clearUserData(){if(!py)return;const n=[],e=kB();for(let t=0;t<e;t++){const s=qD(t);s&&(s.startsWith(`${Xu.USER}${py}`)||Tm&&s.startsWith(`${Xu.CHILD}${Tm}`))&&n.push(s)}for(let t=0;t<e;t++){const s=qD(t);s&&s.startsWith(Xu.CHILD)&&n.push(s)}n.forEach(t=>hk(t)),Object.values(AB).forEach(t=>hk(t)),jd.clear(),py=null,Tm=null,this.notifyListeners("__clear__",null)},clearChildData(n){const e=[],t=kB();for(let s=0;s<t;s++){const i=qD(s);i&&i.startsWith(`${Xu.CHILD}${n}`)&&e.push(i)}e.forEach(s=>hk(s));for(const s of jd.keys())s.startsWith(`${Xu.CHILD}${n}`)&&jd.delete(s)},migrateLegacyData(n,e){const t=WD(AB.GAME_PROGRESS);if(t&&e){const s=this.buildKey("gameProgress",{childScoped:!0});WD(s)||EB(s,t)}},subscribe(n){return GD.add(n),()=>GD.delete(n)},notifyListeners(n,e){GD.forEach(t=>t({key:n,value:e}))},getGameProgress(){return this.get("gameProgress",{childScoped:!0})},setGameProgress(n){this.set("gameProgress",n,{childScoped:!0})},getUserPreferences(){return this.get("preferences",{userScoped:!0,childScoped:!1})},setUserPreferences(n){this.set("preferences",n,{userScoped:!0,childScoped:!1})}},NG=N.createContext(null);function Pte({children:n}){const[e,t]=N.useState(null),[s,i]=N.useState(null),[r,o]=N.useState([]),[c,d]=N.useState(!0),[h,u]=N.useState(!1),[p,f]=N.useState(null),m=N.useCallback(X=>{try{return localStorage.getItem(X)}catch{return null}},[]),x=N.useCallback((X,V)=>{try{localStorage.setItem(X,V)}catch{console.warn(`Failed to set ${X} in localStorage (incognito mode?)`)}},[]),g=N.useCallback(X=>{try{localStorage.removeItem(X)}catch{console.warn(`Failed to remove ${X} from localStorage (incognito mode?)`)}},[]),b=N.useCallback(X=>{var V,q,ee;if(t(X.user),o(X.children||[]),(V=X.user)!=null&&V.id){const ie=m("current_profile_id");let Re=null;if(ie&&((q=X.children)==null?void 0:q.length)>0){const Ye=X.children.find(Le=>Le.id===ie);Ye?(i(Ye),Re=Ye.id):X.children.length>0&&(i(X.children[0]),Re=X.children[0].id,x("current_profile_id",Re))}else((ee=X.children)==null?void 0:ee.length)>0&&(i(X.children[0]),Re=X.children[0].id,x("current_profile_id",Re));Rr.initialize(X.user.id,Re)}},[m,x]);N.useEffect(()=>{(async()=>{try{const{hasAccessToken:V}=$t.initialize();if(!V&&!$t.getRefreshToken())return;if(V)try{const q=await xr.getCurrentUser(),ee=q.data||q;b(ee);return}catch{console.log("Access token invalid, attempting refresh...")}if($t.getRefreshToken())try{await $t.refreshAccessToken();const q=await xr.getCurrentUser(),ee=q.data||q;b(ee),console.log("Token refreshed successfully");return}catch(q){console.error("Token refresh failed:",q),$t.clearTokens()}}catch(V){console.error("Load auth error:",V),f(V.message)}finally{d(!1),u(!0)}})()},[b]);const y=N.useCallback(async(X,V,q,ee)=>{d(!0),f(null);try{const ie=await xr.signUp({email:X,password:V,firstName:q,lastName:ee});if(!ie.success)throw new Error(ie.error||"Sign up failed");return{success:!0,requiresEmailVerification:!0}}catch(ie){throw f(ie.message),ie}finally{d(!1)}},[]),C=N.useCallback(async(X,V)=>{d(!0),f(null);try{const q=await xr.signIn({email:X,password:V});if(!q.success)throw new Error(q.error||"Sign in failed");const ee=q.data||q,ie=ee.parent||ee.user,Re=ee.children||[];if(!ie)throw new Error("Invalid login response: missing user data");return t(ie),o(Re),Re.length>0?(i(Re[0]),x("current_profile_id",Re[0].id),Rr.initialize(ie.id,Re[0].id)):Rr.initialize(ie.id,null),u(!0),{success:!0,user:ie,children:Re}}catch(q){throw f(q.message),q}finally{d(!1)}},[x]),w=N.useCallback(async()=>{try{await xr.logout()}catch(X){console.error("Logout error:",X)}Rr.clearUserData(),$t.clearTokens(),t(null),i(null),o([]),f(null)},[]),S=N.useCallback(X=>{const V=r.find(q=>q.id===X);V&&(i(V),x("current_profile_id",X),e!=null&&e.id&&Rr.initialize(e.id,X))},[r,e==null?void 0:e.id,x]),j=N.useCallback(X=>{t(V=>V&&{...V,consentStatus:X})},[]),T=N.useCallback(X=>{const V={...X,id:X.id||`child-${Date.now()}`};return o(q=>[...q,V]),r.length===0&&(i(V),x("current_profile_id",V.id),e!=null&&e.id&&Rr.initialize(e.id,V.id)),V},[r.length,e==null?void 0:e.id,x]),k=N.useCallback((X,V)=>{o(q=>q.map(ee=>ee.id===X?{...ee,...V}:ee)),(s==null?void 0:s.id)===X&&i(q=>q&&{...q,...V})},[s==null?void 0:s.id]),_=N.useCallback(X=>{if(Rr.clearChildData(X),o(V=>V.filter(q=>q.id!==X)),(s==null?void 0:s.id)===X){const V=r.filter(q=>q.id!==X);V.length>0?(i(V[0]),x("current_profile_id",V[0].id),e!=null&&e.id&&Rr.initialize(e.id,V[0].id)):(i(null),g("current_profile_id"))}},[s==null?void 0:s.id,r,e==null?void 0:e.id,x,g]),L=N.useCallback(async()=>{try{const X=await xr.getCurrentUser(),V=X.data||X;t(V.user),o(V.children||[])}catch(X){console.error("Refresh auth error:",X),f(X.message)}},[]),D=N.useCallback(async(X,V)=>{var ee;const q=await xr.verifyEmail(X,V);return q.success&&q.token&&(t(q.parent),o(q.children||[]),((ee=q.children)==null?void 0:ee.length)>0?(i(q.children[0]),x("current_profile_id",q.children[0].id),Rr.initialize(q.parent.id,q.children[0].id)):Rr.initialize(q.parent.id,null)),q},[x]),P=N.useCallback(async(X,V)=>{try{const q=await xr.switchToChild(X,V);if(q.success){const ee=r.find(ie=>ie.id===X);ee&&(i(ee),x("current_profile_id",X),Rr.setCurrentChild(X))}return q}catch(q){throw console.error("Switch to child mode error:",q),q}},[r,x]),I=N.useCallback(()=>{xr.switchToParent()},[]),M=!!e,O=(e==null?void 0:e.consentStatus)==="verified",F=e&&!e.emailVerified,B=e&&e.emailVerified&&e.consentStatus!=="verified",U=e&&e.emailVerified&&O&&r.length===0,$=!c&&h,G=$t.isChildMode(),ne=N.useMemo(()=>{var V;switch((V=e==null?void 0:e.subscriptionTier)==null?void 0:V.toUpperCase()){case"FREE":return 1;case"FAMILY":case"ANNUAL":return 2;case"FAMILY_PLUS":return 4;default:return 1}},[e==null?void 0:e.subscriptionTier]),Z=r.length<ne,K=N.useMemo(()=>({user:e,currentProfile:s,children:r,isLoading:c,isInitialized:h,error:p,isAuthenticated:M,hasConsent:O,needsEmailVerification:F,needsConsent:B,needsChildProfile:U,isReady:$,isChildMode:G,maxChildrenAllowed:ne,canAddChild:Z,signUp:y,signIn:C,signOut:w,verifyEmail:D,refreshAuth:L,switchToChildMode:P,switchToParentMode:I,updateConsentStatus:j,switchProfile:S,addChildProfile:T,updateChildProfile:k,removeChildProfile:_}),[e,s,r,c,h,p,M,O,F,B,U,$,G,ne,Z,y,C,w,D,L,P,I,j,S,T,k,_]);return a.jsx(NG.Provider,{value:K,children:n})}function Vt(){const n=N.useContext(NG);if(!n)throw new Error("useAuth must be used within AuthProvider");return n}const Lte={currentLesson:null,lessons:[],isProcessing:!1,processingProgress:0,processingStage:"idle",error:null,isLessonDrawerOpen:!1,isLoadingLessons:!1,lessonsLoaded:!1,loadedChildId:null},St={START_PROCESSING:"START_PROCESSING",UPDATE_PROGRESS:"UPDATE_PROGRESS",SET_PROCESSING_STAGE:"SET_PROCESSING_STAGE",RESET_PROCESSING:"RESET_PROCESSING",ADD_LESSON:"ADD_LESSON",SET_CURRENT_LESSON:"SET_CURRENT_LESSON",UPDATE_LESSON:"UPDATE_LESSON",DELETE_LESSON:"DELETE_LESSON",LOAD_LESSONS:"LOAD_LESSONS",SET_ERROR:"SET_ERROR",CLEAR_ERROR:"CLEAR_ERROR",TOGGLE_LESSON_DRAWER:"TOGGLE_LESSON_DRAWER",UPDATE_LESSON_PROGRESS:"UPDATE_LESSON_PROGRESS",INCREMENT_TIME_SPENT:"INCREMENT_TIME_SPENT",SET_LOADING_LESSONS:"SET_LOADING_LESSONS",SET_LESSONS_LOADED:"SET_LESSONS_LOADED",CLEAR_LESSONS:"CLEAR_LESSONS"};function Dte(n,e){var t,s,i,r;switch(e.type){case St.START_PROCESSING:return{...n,isProcessing:!0,processingProgress:I0.uploading.progress,processingStage:"uploading",error:null};case St.UPDATE_PROGRESS:return{...n,processingProgress:Math.min(100,Math.max(0,e.payload))};case St.SET_PROCESSING_STAGE:const o=I0[e.payload];return{...n,processingStage:e.payload,processingProgress:o?o.progress:n.processingProgress};case St.RESET_PROCESSING:return{...n,isProcessing:!1,processingProgress:0,processingStage:"idle"};case St.ADD_LESSON:return n.lessons.some(p=>p.id===e.payload.id)?{...n,currentLesson:e.payload,isProcessing:!1,processingProgress:100,processingStage:"complete"}:{...n,lessons:[e.payload,...n.lessons],currentLesson:e.payload,isProcessing:!1,processingProgress:100,processingStage:"complete"};case St.LOAD_LESSONS:return{...n,lessons:e.payload.lessons,currentLesson:e.payload.currentLesson,isLoadingLessons:!1,lessonsLoaded:!0,loadedChildId:e.payload.childId};case St.SET_CURRENT_LESSON:const c=n.lessons.find(p=>p.id===e.payload);return{...n,currentLesson:c||null};case St.UPDATE_LESSON:const d=n.lessons.map(p=>p.id===e.payload.id?{...p,...e.payload.updates,updatedAt:new Date().toISOString()}:p);return{...n,lessons:d,currentLesson:((t=n.currentLesson)==null?void 0:t.id)===e.payload.id?{...n.currentLesson,...e.payload.updates,updatedAt:new Date().toISOString()}:n.currentLesson};case St.DELETE_LESSON:const h=n.lessons.filter(p=>p.id!==e.payload);return{...n,lessons:h,currentLesson:((s=n.currentLesson)==null?void 0:s.id)===e.payload?h[0]||null:n.currentLesson};case St.UPDATE_LESSON_PROGRESS:return{...n,lessons:n.lessons.map(p=>p.id===e.payload.id?{...p,progress:{...p.progress,...e.payload.progress},updatedAt:new Date().toISOString()}:p),currentLesson:((i=n.currentLesson)==null?void 0:i.id)===e.payload.id?{...n.currentLesson,progress:{...n.currentLesson.progress,...e.payload.progress},updatedAt:new Date().toISOString()}:n.currentLesson};case St.INCREMENT_TIME_SPENT:if(!n.currentLesson)return n;const u=(((r=n.currentLesson.progress)==null?void 0:r.timeSpent)||0)+e.payload;return{...n,lessons:n.lessons.map(p=>p.id===n.currentLesson.id?{...p,progress:{...p.progress,timeSpent:u,lastAccessedAt:new Date().toISOString()}}:p),currentLesson:{...n.currentLesson,progress:{...n.currentLesson.progress,timeSpent:u,lastAccessedAt:new Date().toISOString()}}};case St.SET_ERROR:return{...n,error:e.payload,isProcessing:!1,processingStage:"error"};case St.CLEAR_ERROR:return{...n,error:null,processingStage:"idle"};case St.TOGGLE_LESSON_DRAWER:return{...n,isLessonDrawerOpen:e.payload??!n.isLessonDrawerOpen};case St.SET_LOADING_LESSONS:return{...n,isLoadingLessons:e.payload};case St.SET_LESSONS_LOADED:return{...n,lessonsLoaded:e.payload};case St.CLEAR_LESSONS:return{...n,lessons:[],currentLesson:null,lessonsLoaded:!1,loadedChildId:null};default:return console.warn(`Unknown action type: ${e.type}`),n}}const jG=N.createContext(null);function Rte(n){var e,t,s,i;return{id:n.id,title:n.title,subject:n.subject,gradeLevel:n.gradeLevel,sourceType:((e=n.sourceType)==null?void 0:e.toLowerCase())||"text",extractedText:n.extractedText,rawText:n.extractedText,formattedContent:n.formattedContent,summary:n.summary,chapters:n.chapters||[],keyConcepts:n.keyConcepts||[],keyConceptsForChat:n.keyConcepts||[],vocabulary:n.vocabulary||[],suggestedQuestions:n.suggestedQuestions||[],fileUrl:n.originalFileUrl,createdAt:n.createdAt,updatedAt:n.updatedAt,progress:{started:!0,percentComplete:((t=n.progress)==null?void 0:t.percentComplete)||0,timeSpent:((s=n.progress)==null?void 0:s.timeSpent)||0,lastAccessedAt:((i=n.progress)==null?void 0:i.lastAccessedAt)||n.updatedAt}}}function Ite({children:n}){var D;const[e,t]=N.useReducer(Dte,Lte),{currentProfile:s,isInitialized:i}=Vt(),r=s==null?void 0:s.id,o=N.useRef(!1),c=N.useRef(null),d=N.useCallback(async P=>{var I;if(!P){t({type:St.CLEAR_LESSONS});return}if(!(o.current&&c.current===P)){o.current=!0,c.current=P,t({type:St.SET_LOADING_LESSONS,payload:!0});try{const M=await Nc.get(`/lessons/child/${P}?limit=50`);if(M.success&&((I=M.data)!=null&&I.lessons)){const F=M.data.lessons.map(Rte);t({type:St.LOAD_LESSONS,payload:{lessons:F,currentLesson:F[0]||null,childId:P}})}else t({type:St.LOAD_LESSONS,payload:{lessons:[],currentLesson:null,childId:P}})}catch(M){console.error("Failed to fetch lessons from database:",M),t({type:St.LOAD_LESSONS,payload:{lessons:[],currentLesson:null,childId:P}})}finally{o.current=!1}}},[]);N.useEffect(()=>{i&&(r&&r!==e.loadedChildId?d(r):!r&&e.loadedChildId&&t({type:St.CLEAR_LESSONS}))},[r,i,e.loadedChildId,d]),N.useEffect(()=>{if(!e.currentLesson||e.isProcessing)return;const P=setInterval(()=>{t({type:St.INCREMENT_TIME_SPENT,payload:30})},3e4);return()=>clearInterval(P)},[(D=e.currentLesson)==null?void 0:D.id,e.isProcessing]);const h=N.useCallback(()=>{t({type:St.START_PROCESSING})},[]),u=N.useCallback(P=>{t({type:St.UPDATE_PROGRESS,payload:P})},[]),p=N.useCallback(P=>{t({type:St.SET_PROCESSING_STAGE,payload:P})},[]),f=N.useCallback(()=>{t({type:St.RESET_PROCESSING})},[]),m=N.useCallback(P=>{const I=new Date().toISOString(),M={...NB,...P,id:P.id||E1(),createdAt:P.createdAt||I,updatedAt:P.updatedAt||I,progress:{...NB.progress,started:!0,lastAccessedAt:I}};return t({type:St.ADD_LESSON,payload:M}),M},[]),x=N.useCallback(P=>{t({type:St.SET_CURRENT_LESSON,payload:P})},[]),g=N.useCallback(()=>{t({type:St.SET_CURRENT_LESSON,payload:null})},[]),b=N.useCallback((P,I)=>{t({type:St.UPDATE_LESSON,payload:{id:P,updates:I}})},[]),y=N.useCallback(P=>{t({type:St.DELETE_LESSON,payload:P})},[]),C=N.useCallback(()=>{r&&(c.current=null,d(r))},[r,d]),w=N.useCallback((P,I)=>{t({type:St.UPDATE_LESSON_PROGRESS,payload:{id:P,progress:I}})},[]),S=N.useCallback(async P=>{w(P,{percentComplete:100,completedAt:new Date().toISOString()});try{await Nc.post(`/lessons/${P}/complete`)}catch(I){console.error("Failed to mark lesson as complete on backend:",I)}},[w]),j=N.useCallback(P=>{t({type:St.SET_ERROR,payload:P})},[]),T=N.useCallback(()=>{t({type:St.CLEAR_ERROR})},[]),k=N.useCallback(P=>{t({type:St.TOGGLE_LESSON_DRAWER,payload:P})},[]),_=N.useMemo(()=>({hasLessons:e.lessons.length>0,lessonCount:e.lessons.length,currentStageInfo:I0[e.processingStage]||I0.idle,isReady:!e.isProcessing&&e.currentLesson!==null,recentLessons:e.lessons.slice(0,5),lessonsBySubject:e.lessons.reduce((P,I)=>{const M=I.subject||"Uncategorized";return P[M]||(P[M]=[]),P[M].push(I),P},{}),totalTimeSpent:e.lessons.reduce((P,I)=>{var M;return P+(((M=I.progress)==null?void 0:M.timeSpent)||0)},0),completedLessonsCount:e.lessons.filter(P=>{var I;return((I=P.progress)==null?void 0:I.percentComplete)===100}).length}),[e.lessons,e.currentLesson,e.isProcessing,e.processingStage]),L=N.useMemo(()=>({...e,..._,startProcessing:h,updateProgress:u,setProcessingStage:p,resetProcessing:f,addLesson:m,setCurrentLesson:x,clearCurrentLesson:g,updateLesson:b,deleteLesson:y,refreshLessons:C,updateLessonProgress:w,markLessonComplete:S,setError:j,clearError:T,toggleLessonDrawer:k}),[e,_,h,u,p,f,m,x,g,b,y,C,w,S,j,T,k]);return a.jsx(jG.Provider,{value:L,children:n})}function Hu(){const n=N.useContext(jG);if(!n)throw new Error("useLessonContext must be used within a LessonProvider");return n}async function ue(n,e={},t=0){return yd(n,e,{retryCount:t})}function uk(){try{return localStorage.getItem("current_profile_id")}catch{return null}}const mS={getMyStats:async()=>{const n=$t.isChildMode(),e=uk();return n?ue("/children/me/stats",{method:"GET"}):e?ue(`/children/${e}/stats`,{method:"GET"}):{success:!1,error:"No child profile selected"}},awardXP:async(n,e,t=null,s=null)=>{const i=$t.isChildMode(),r=uk();return i?ue("/children/me/xp",{method:"POST",body:JSON.stringify({amount:n,reason:e,sourceType:t,sourceId:s})}):r?ue(`/children/${r}/xp`,{method:"POST",body:JSON.stringify({amount:n,reason:e,sourceType:t,sourceId:s})}):(console.log("XP award skipped - no child profile selected"),{success:!1,error:"No child profile selected"})},recordActivity:async()=>{const n=$t.isChildMode(),e=uk();return n?ue("/children/me/activity",{method:"POST"}):e?ue(`/children/${e}/activity`,{method:"POST"}):(console.log("Activity recording skipped - no child profile selected"),{success:!1,error:"No child profile selected"})},getMyBadges:async()=>{const n=$t.isChildMode(),e=uk();return n?ue("/children/me/badges",{method:"GET"}):e?ue(`/children/${e}/badges`,{method:"GET"}):{success:!1,error:"No child profile selected"}},getMyXPHistory:async(n=7)=>$t.isChildMode()?ue(`/children/me/xp-history?days=${n}`,{method:"GET"}):{success:!1,error:"XP history only available in child mode"},getChildStats:async n=>ue(`/children/${n}/stats`,{method:"GET"})},AG={currentXP:0,totalXP:0,currentLevel:1,xpToNextLevel:100,percentToNextLevel:0,streak:{current:0,longest:0,isActiveToday:!1,freezeAvailable:!1},badges:[],badgesEarned:0,totalBadges:0,statistics:{lessonsCompleted:0,questionsAnswered:0,flashcardsReviewed:0,totalStudyTime:0,perfectScores:0},recentAchievements:[],pendingCelebration:null,isLoading:!0,isInitialized:!1,loadedChildId:null,error:null},bs={SET_LOADING:"SET_LOADING",LOAD_STATS:"LOAD_STATS",LOAD_BADGES:"LOAD_BADGES",UPDATE_XP:"UPDATE_XP",UPDATE_STREAK:"UPDATE_STREAK",ADD_BADGE:"ADD_BADGE",SET_PENDING_CELEBRATION:"SET_PENDING_CELEBRATION",CLEAR_PENDING_CELEBRATION:"CLEAR_PENDING_CELEBRATION",ADD_RECENT_ACHIEVEMENT:"ADD_RECENT_ACHIEVEMENT",CLEAR_RECENT_ACHIEVEMENT:"CLEAR_RECENT_ACHIEVEMENT",SET_ERROR:"SET_ERROR",CLEAR_STATE:"CLEAR_STATE",UPDATE_STATISTICS:"UPDATE_STATISTICS"};function Mte(n,e){var t,s,i,r,o,c,d,h;switch(e.type){case bs.SET_LOADING:return{...n,isLoading:e.payload};case bs.LOAD_STATS:return{...n,currentXP:e.payload.xp||0,totalXP:e.payload.xp||0,currentLevel:e.payload.level||1,xpToNextLevel:e.payload.xpToNextLevel||100,percentToNextLevel:e.payload.percentToNextLevel||0,streak:{current:((t=e.payload.streak)==null?void 0:t.current)||0,longest:((s=e.payload.streak)==null?void 0:s.longest)||0,isActiveToday:((i=e.payload.streak)==null?void 0:i.isActiveToday)||!1,freezeAvailable:((r=e.payload.streak)==null?void 0:r.freezeAvailable)||!1},badgesEarned:e.payload.badgesEarned||0,totalBadges:e.payload.totalBadges||0,statistics:{...n.statistics,lessonsCompleted:e.payload.lessonsCompleted||0},isLoading:!1,isInitialized:!0,loadedChildId:e.payload.childId,error:null};case bs.LOAD_BADGES:return{...n,badges:e.payload.earned||[],badgesEarned:((o=e.payload.earned)==null?void 0:o.length)||0,totalBadges:(((c=e.payload.earned)==null?void 0:c.length)||0)+(((d=e.payload.available)==null?void 0:d.length)||0)};case bs.UPDATE_XP:const u={...n,currentXP:e.payload.currentXP,totalXP:e.payload.totalXP,currentLevel:e.payload.level};return e.payload.leveledUp?u.pendingCelebration={type:"levelUp",level:e.payload.level,xpEarned:e.payload.xpAwarded}:e.payload.xpAwarded>=50&&(u.pendingCelebration={type:"bigXP",xpEarned:e.payload.xpAwarded}),((h=e.payload.newBadges)==null?void 0:h.length)>0&&(u.badges=[...n.badges,...e.payload.newBadges],u.badgesEarned=n.badgesEarned+e.payload.newBadges.length,u.recentAchievements=[...n.recentAchievements,...e.payload.newBadges],u.pendingCelebration||(u.pendingCelebration={type:"badge",badge:e.payload.newBadges[0]})),u;case bs.UPDATE_STREAK:return{...n,streak:e.payload};case bs.ADD_BADGE:return{...n,badges:[...n.badges,e.payload],badgesEarned:n.badgesEarned+1,recentAchievements:[...n.recentAchievements,e.payload],pendingCelebration:{type:"badge",badge:e.payload}};case bs.SET_PENDING_CELEBRATION:return{...n,pendingCelebration:e.payload};case bs.CLEAR_PENDING_CELEBRATION:return{...n,pendingCelebration:null};case bs.ADD_RECENT_ACHIEVEMENT:return{...n,recentAchievements:[...n.recentAchievements,e.payload]};case bs.CLEAR_RECENT_ACHIEVEMENT:return{...n,recentAchievements:n.recentAchievements.filter(p=>p.id!==e.payload)};case bs.SET_ERROR:return{...n,error:e.payload,isLoading:!1};case bs.CLEAR_STATE:return{...AG,isLoading:!1,isInitialized:!1};case bs.UPDATE_STATISTICS:return{...n,statistics:{...n.statistics,...e.payload}};default:return n}}const EG=N.createContext(null);function Fte({children:n}){const[e,t]=N.useReducer(Mte,AG),{currentProfile:s,isInitialized:i}=Vt(),r=s==null?void 0:s.id,o=N.useRef(!1),c=N.useCallback(async b=>{if(!b){t({type:bs.CLEAR_STATE});return}if(!o.current){o.current=!0,t({type:bs.SET_LOADING,payload:!0});try{const[y,C]=await Promise.all([mS.getMyStats(),mS.getMyBadges()]);y.success&&y.data?t({type:bs.LOAD_STATS,payload:{...y.data,childId:b}}):t({type:bs.LOAD_STATS,payload:{childId:b}}),C.success&&C.data&&t({type:bs.LOAD_BADGES,payload:C.data})}catch(y){console.error("Failed to fetch gamification stats:",y),t({type:bs.LOAD_STATS,payload:{childId:b}})}finally{o.current=!1}}},[]);N.useEffect(()=>{i&&(r&&r!==e.loadedChildId?c(r):!r&&e.loadedChildId&&t({type:bs.CLEAR_STATE}))},[r,i,e.loadedChildId,c]),N.useEffect(()=>{!r||!e.isInitialized||mS.recordActivity().then(b=>{var y,C;b.success&&((y=b.data)!=null&&y.streak)&&(t({type:bs.UPDATE_STREAK,payload:b.data.streak}),((C=b.data.newBadges)==null?void 0:C.length)>0&&t({type:bs.UPDATE_XP,payload:{currentXP:e.currentXP,totalXP:e.totalXP,level:e.currentLevel,leveledUp:!1,xpAwarded:0,newBadges:b.data.newBadges}}))}).catch(b=>{console.error("Failed to record activity:",b)})},[r,e.isInitialized]);const d=N.useCallback(async(b,y="CHAT_QUESTION")=>{if(!r||b<=0)return null;try{const w={"Chat interaction":"CHAT_QUESTION","Asked Jeffrey a question":"CHAT_QUESTION","Chat question":"CHAT_QUESTION","Lesson complete":"LESSON_COMPLETE","Lesson progress":"LESSON_PROGRESS","Flashcard review":"FLASHCARD_REVIEW","Flashcard correct":"FLASHCARD_CORRECT","Created a flashcard":"FLASHCARD_REVIEW","Quiz complete":"QUIZ_COMPLETE","Quiz perfect":"QUIZ_PERFECT","Generated a quiz":"QUIZ_COMPLETE","Daily challenge":"DAILY_CHALLENGE","Text selection":"TEXT_SELECTION","Translated text":"TEXT_SELECTION","Saved a selection":"TEXT_SELECTION","Used read aloud":"TEXT_SELECTION","Exercise correct":"EXERCISE_CORRECT","Exercise perfect":"EXERCISE_PERFECT"}[y]||(y.includes("_")?y:"CHAT_QUESTION"),S=await mS.awardXP(b,w);if(S.success&&S.data)return t({type:bs.UPDATE_XP,payload:S.data}),S.data}catch(C){console.error("Failed to award XP:",C)}return null},[r]),h=N.useCallback(async()=>{var b;if(r)try{const y=await mS.recordActivity();y.success&&((b=y.data)!=null&&b.streak)&&t({type:bs.UPDATE_STREAK,payload:y.data.streak})}catch(y){console.error("Failed to record activity:",y)}},[r]),u=N.useCallback(()=>{r&&(o.current=!1,c(r))},[r,c]),p=N.useCallback(b=>{t({type:bs.UPDATE_STATISTICS,payload:b})},[]),f=N.useCallback(()=>{t({type:bs.CLEAR_PENDING_CELEBRATION})},[]),m=N.useCallback(b=>{t({type:bs.CLEAR_RECENT_ACHIEVEMENT,payload:b})},[]),x=N.useCallback(b=>{},[]),g={...e,earnXP:d,recordActivity:h,refreshStats:u,updateStatistics:p,updateDailyChallengeProgress:x,clearCelebration:f,clearRecentAchievement:m};return a.jsx(EG.Provider,{value:g,children:n})}function bl(){const n=N.useContext(EG);if(!n)throw new Error("useGamificationContext must be used within a GamificationProvider");return n}const Ote={CORRECT:{1:1,2:3,3:7,4:14,5:30,6:60}},pk=[{id:"learning",label:"Still Learning",emoji:"",description:"I need more practice",color:"orange",multiplier:0},{id:"almost",label:"Almost Got It",emoji:"",description:"I'm getting there!",color:"yellow",multiplier:.5},{id:"got_it",label:"Got It!",emoji:"",description:"I know this one!",color:"green",multiplier:1}],nP=[{id:"lesson",label:"From Lessons",icon:"",color:"blue"},{id:"vocabulary",label:"Vocabulary",icon:"",color:"purple"},{id:"math",label:"Math Facts",icon:"",color:"green"},{id:"science",label:"Science",icon:"",color:"cyan"},{id:"custom",label:"My Cards",icon:"",color:"pink"}],fk=[{level:0,label:"New",color:"gray",minCorrect:0},{level:1,label:"Learning",color:"orange",minCorrect:1},{level:2,label:"Familiar",color:"yellow",minCorrect:3},{level:3,label:"Confident",color:"blue",minCorrect:5},{level:4,label:"Mastered",color:"green",minCorrect:7}],x5=n=>{for(let e=fk.length-1;e>=0;e--)if(n>=fk[e].minCorrect)return fk[e];return fk[0]};function Bte(n,e){const t=new Date,s=e?(n.correctStreak||0)+1:0;if(!e)return{nextReviewDate:t.toISOString(),correctStreak:0,easeFactor:Math.max(1.3,(n.easeFactor||2.5)-.2)};const i=Math.min(s,6),r=Ote.CORRECT[i]||60,o=n.easeFactor||2.5,c=Math.round(r*(o/2.5)),d=new Date(t);return d.setDate(d.getDate()+c),{nextReviewDate:d.toISOString(),correctStreak:s,easeFactor:Math.min(3,o+.1)}}function US(n){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return n.filter(s=>s.nextReviewDate?new Date(s.nextReviewDate)<=t:!0)}function $te(n){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return[...n].sort((s,i)=>{if(!s.nextReviewDate&&!i.nextReviewDate||!s.nextReviewDate||!i.nextReviewDate)return 0;const r=new Date(s.nextReviewDate),o=new Date(i.nextReviewDate),c=r<t,d=o<t;return c&&!d?-1:!c&&d?1:c&&d?r.getTime()-o.getTime():(s.correctStreak||0)-(i.correctStreak||0)})}function kG(n){const e=n.length,t=n.filter(c=>c.wasCorrect).length,s=e-t,i=e>0?t/e*100:0,r=e*2,o=i>=80?25:0;return{total:e,correct:t,incorrect:s,accuracy:Math.round(i),xpEarned:r+o,isPerfect:i>=80}}function Ute(n){var d;if(!n||n.length===0)return{current:0,longest:0,lastStudyDate:null};const e=[...n].sort((h,u)=>new Date(u.date).getTime()-new Date(h.date).getTime()),t=new Date;t.setHours(0,0,0,0);let s=0,i=new Date(t);for(const h of e){const u=new Date(h.date);u.setHours(0,0,0,0);const p=Math.floor((i-u)/(1e3*60*60*24));if(p===0)s++,i.setDate(i.getDate()-1);else if(p===1)s++,i=u,i.setDate(i.getDate()-1);else break}let r=0,o=0,c=null;for(const h of e){const u=new Date(h.date);u.setHours(0,0,0,0),c?Math.floor((c-u)/864e5)===1?o++:(r=Math.max(r,o),o=1):o=1,c=u}return r=Math.max(r,o),{current:s,longest:r,lastStudyDate:((d=e[0])==null?void 0:d.date)||null}}function zte(n,e=80){const t=n.length;return t===0?0:e<60?Math.min(5,t):e<80?Math.min(10,t):Math.min(15,t)}const Hte={decks:[],cards:[],currentSession:null,studyHistory:[],isLoading:!1,error:null},Rs={CREATE_DECK:"CREATE_DECK",UPDATE_DECK:"UPDATE_DECK",DELETE_DECK:"DELETE_DECK",ADD_CARDS:"ADD_CARDS",UPDATE_CARD:"UPDATE_CARD",DELETE_CARD:"DELETE_CARD",RECORD_CARD_REVIEW:"RECORD_CARD_REVIEW",START_SESSION:"START_SESSION",END_SESSION:"END_SESSION",UPDATE_SESSION_PROGRESS:"UPDATE_SESSION_PROGRESS",LOAD_DATA:"LOAD_DATA",SET_LOADING:"SET_LOADING",SET_ERROR:"SET_ERROR",CLEAR_ERROR:"CLEAR_ERROR"};function Vte(n,e){switch(e.type){case Rs.CREATE_DECK:return{...n,decks:[...n.decks,e.payload]};case Rs.UPDATE_DECK:return{...n,decks:n.decks.map(t=>t.id===e.payload.id?{...t,...e.payload}:t)};case Rs.DELETE_DECK:return{...n,decks:n.decks.filter(t=>t.id!==e.payload),cards:n.cards.filter(t=>t.deckId!==e.payload)};case Rs.ADD_CARDS:return{...n,cards:[...n.cards,...e.payload]};case Rs.UPDATE_CARD:return{...n,cards:n.cards.map(t=>t.id===e.payload.id?{...t,...e.payload}:t)};case Rs.DELETE_CARD:return{...n,cards:n.cards.filter(t=>t.id!==e.payload)};case Rs.RECORD_CARD_REVIEW:{const{cardId:t,wasCorrect:s,confidence:i}=e.payload,r=n.cards.find(d=>d.id===t);if(!r)return n;const o=Bte(r,s),c={...r,...o,totalReviews:(r.totalReviews||0)+1,correctReviews:(r.correctReviews||0)+(s?1:0),lastReviewDate:new Date().toISOString(),lastConfidence:i};return{...n,cards:n.cards.map(d=>d.id===t?c:d)}}case Rs.START_SESSION:return{...n,currentSession:{id:E1(),deckId:e.payload.deckId,startTime:new Date().toISOString(),cardIds:e.payload.cardIds,currentIndex:0,results:[]}};case Rs.UPDATE_SESSION_PROGRESS:return{...n,currentSession:n.currentSession?{...n.currentSession,currentIndex:e.payload.currentIndex,results:e.payload.results}:null};case Rs.END_SESSION:{const t=n.currentSession;if(!t)return n;const s={...t,endTime:new Date().toISOString(),stats:kG(t.results)};return{...n,currentSession:null,studyHistory:[...n.studyHistory,{id:t.id,deckId:t.deckId,date:new Date().toISOString(),cardsReviewed:t.results.length,accuracy:s.stats.accuracy,xpEarned:s.stats.xpEarned}]}}case Rs.LOAD_DATA:return{...n,...e.payload,isLoading:!1};case Rs.SET_LOADING:return{...n,isLoading:e.payload};case Rs.SET_ERROR:return{...n,error:e.payload,isLoading:!1};case Rs.CLEAR_ERROR:return{...n,error:null};default:return n}}const TG=N.createContext(null);function Gte({children:n}){const[e,t]=N.useReducer(Vte,Hte);N.useEffect(()=>{const w=localStorage.getItem("flashcardData");if(w)try{const S=JSON.parse(w);t({type:Rs.LOAD_DATA,payload:S})}catch(S){console.error("Error loading flashcard data:",S)}},[]),N.useEffect(()=>{const w={decks:e.decks,cards:e.cards,studyHistory:e.studyHistory};localStorage.setItem("flashcardData",JSON.stringify(w))},[e.decks,e.cards,e.studyHistory]);const s=N.useCallback(w=>{const S={id:E1(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),cardCount:0,...w};return t({type:Rs.CREATE_DECK,payload:S}),S},[]),i=N.useCallback((w,S)=>{t({type:Rs.UPDATE_DECK,payload:{id:w,...S,updatedAt:new Date().toISOString()}})},[]),r=N.useCallback(w=>{t({type:Rs.DELETE_DECK,payload:w})},[]),o=N.useCallback((w,S)=>{const j=w.map(k=>({id:E1(),deckId:S,createdAt:new Date().toISOString(),correctStreak:0,easeFactor:2.5,totalReviews:0,correctReviews:0,nextReviewDate:null,...k}));t({type:Rs.ADD_CARDS,payload:j});const T=e.decks.find(k=>k.id===S);return T&&i(S,{cardCount:(T.cardCount||0)+j.length}),j},[e.decks,i]),c=N.useCallback((w,S)=>{t({type:Rs.UPDATE_CARD,payload:{id:w,...S}})},[]),d=N.useCallback(w=>{const S=e.cards.find(j=>j.id===w);if(S){const j=e.decks.find(T=>T.id===S.deckId);j&&i(S.deckId,{cardCount:Math.max(0,(j.cardCount||1)-1)})}t({type:Rs.DELETE_CARD,payload:w})},[e.cards,e.decks,i]),h=N.useCallback((w,S,j)=>{t({type:Rs.RECORD_CARD_REVIEW,payload:{cardId:w,wasCorrect:S,confidence:j}})},[]),u=N.useCallback((w,S=10)=>{const j=e.cards.filter(L=>L.deckId===w),T=US(j),_=$te(T).slice(0,S);return _.length===0?null:(t({type:Rs.START_SESSION,payload:{deckId:w,cardIds:_.map(L=>L.id)}}),_)},[e.cards]),p=N.useCallback((w,S,j)=>{if(!e.currentSession)return;h(w,S,j);const T=[...e.currentSession.results,{cardId:w,wasCorrect:S,confidence:j,timestamp:new Date().toISOString()}];return t({type:Rs.UPDATE_SESSION_PROGRESS,payload:{currentIndex:e.currentSession.currentIndex+1,results:T}}),T.length>=e.currentSession.cardIds.length?f():null},[e.currentSession,h]),f=N.useCallback(()=>{if(!e.currentSession)return null;const w=kG(e.currentSession.results);return t({type:Rs.END_SESSION}),w},[e.currentSession]),m=N.useCallback(w=>e.cards.filter(S=>S.deckId===w),[e.cards]),x=N.useCallback(w=>{const S=m(w);return US(S)},[m]),g=N.useCallback(()=>US(e.cards).length,[e.cards]),b=N.useCallback(w=>{const S=m(w),j=US(S),T=S.reduce((k,_)=>{const L=x5(_.correctReviews||0);return k[L.label]=(k[L.label]||0)+1,k},{});return{totalCards:S.length,dueCards:j.length,masteryDistribution:T,averageEaseFactor:S.length>0?S.reduce((k,_)=>k+(_.easeFactor||2.5),0)/S.length:2.5}},[m]),y=N.useCallback(w=>{var T,k;const S=s({name:`${w.title} Flashcards`,description:`Flashcards generated from: ${w.title}`,category:"lesson",lessonId:w.id,color:"blue"}),j=[];return(T=w.content)!=null&&T.vocabulary&&w.content.vocabulary.forEach(_=>{j.push({front:`What does "${_.term}" mean?`,back:_.definition,type:"vocabulary"})}),(k=w.content)!=null&&k.keyPoints&&w.content.keyPoints.forEach((_,L)=>{j.push({front:`Key Point ${L+1}: Fill in the blank or explain this concept:`,back:_,type:"concept"})}),j.length>0&&o(j,S.id),S},[s,o]),C={...e,createDeck:s,updateDeck:i,deleteDeck:r,createDeckFromLesson:y,addCards:o,updateCard:c,deleteCard:d,recordCardReview:h,startSession:u,recordSessionAnswer:p,endSession:f,getCardsForDeck:m,getDueCardsForDeck:x,getTotalDueCards:g,getDeckStats:b};return a.jsx(TG.Provider,{value:C,children:n})}function ML(){const n=N.useContext(TG);if(!n)throw new Error("useFlashcardContext must be used within a FlashcardProvider");return n}const yy={sendDemoMessage:async({message:n,conversationHistory:e,sessionId:t})=>Qu("/chat/demo",{method:"POST",body:JSON.stringify({message:n,conversationHistory:e,sessionId:t})}),sendMessage:async({message:n,childId:e,ageGroup:t,lessonContext:s,conversationHistory:i,selectedText:r})=>ue("/chat",{method:"POST",body:JSON.stringify({message:n,childId:e,ageGroup:t,lessonContext:s,conversationHistory:i,selectedText:r})}),generateFlashcards:async({content:n,count:e=5,childId:t,ageGroup:s})=>ue("/flashcards/generate",{method:"POST",body:JSON.stringify({content:n,count:e,childId:t,ageGroup:s})}),generateSummary:async({content:n,title:e,childId:t,ageGroup:s})=>ue("/chat/summarize",{method:"POST",body:JSON.stringify({content:n,title:e,childId:t,ageGroup:s})}),generateInfographic:async({content:n,title:e,keyConcepts:t,childId:s,ageGroup:i})=>ue("/chat/infographic",{method:"POST",body:JSON.stringify({content:n,title:e,keyConcepts:t,childId:s,ageGroup:i})}),generateQuiz:async({content:n,title:e,count:t=5,type:s="multiple_choice",childId:i,ageGroup:r})=>ue("/quizzes/generate",{method:"POST",body:JSON.stringify({content:n,count:t,type:s,childId:i,ageGroup:r})})};class Wte{buildSystemInstructions(e,t,s){const i=[];return i.push(this.getCoreIdentity()),i.push(this.getSafetyGuidelines()),i.push(this.getAgeAppropriateGuidance(e.age)),e.learningStyle&&i.push(this.getLearningStyleGuidance(e.learningStyle)),t&&(t.topic||t.subject)&&i.push(this.getLessonContextGuidance(t)),e.curriculumType&&i.push(this.getCurriculumGuidance(e.curriculumType)),s!=null&&s.currentStreak&&i.push(this.getGamificationGuidance(s)),i.push(this.getLanguageGuidance(e.language)),i.push(this.getFormattingGuidance()),i.join(`

`)}getCoreIdentity(){return`You are Jeffrey, a friendly and encouraging AI tutor for elementary school children (ages 4-12) learning on the Orbit Learn platform. Your personality traits:

- ENTHUSIASTIC and positive, celebrating every learning moment
- PATIENT and supportive, never showing frustration
- ENCOURAGING, focusing on progress over perfection
- PLAYFUL but educational, making learning fun
- CULTURALLY AWARE, respecting diverse backgrounds

Your primary goal is to help children understand concepts deeply, not just memorize facts. You should:
- Use simple, age-appropriate language
- Break down complex topics into small, manageable pieces
- Provide examples that relate to everyday life
- Encourage questions and curiosity
- Celebrate effort and progress`}getSafetyGuidelines(){return`CRITICAL SAFETY GUIDELINES - YOU MUST FOLLOW THESE:

1. NEVER ask for or reference personal information (name, address, phone, school name, parent names, birthdays)
2. NEVER discuss inappropriate topics (violence, romance, adult content, scary subjects, death)
3. NEVER provide external links or suggest visiting websites
4. NEVER pretend to be a parent, teacher, or other authority figure
5. NEVER engage in role-play scenarios outside of educational contexts
6. NEVER discuss your own capabilities, limitations, or how you work as an AI
7. ALWAYS redirect inappropriate questions back to learning topics
8. ALWAYS maintain appropriate boundaries as a learning assistant
9. If a child mentions feeling sad, hurt, or scared, respond with: "I hear you, and that sounds hard. Please talk to your parent, teacher, or another trusted adult who can help you better. They really care about you!"
10. Keep all conversations focused on learning and educational topics`}getAgeAppropriateGuidance(e){return e<=6?`AGE-APPROPRIATE GUIDANCE (Ages 4-6 - Early Learner):

- Use VERY simple words (mostly 1-2 syllables)
- Keep sentences SHORT (5-8 words maximum)
- Use lots of encouraging words and celebrate small wins
- Relate everything to familiar experiences (toys, animals, family, food, colors)
- Break explanations into tiny steps
- Repeat key points with different words
- Use "I wonder..." to spark curiosity
- Ask simple yes/no or choice questions
- Use counting and colors frequently
- Example response: "Great job asking! A circle is round like a ball. Can you find something round near you?"`:e<=9?`AGE-APPROPRIATE GUIDANCE (Ages 7-9 - Growing Learner):

- Use clear, simple language (mostly 1-3 syllable words)
- Keep sentences moderate length (8-12 words)
- Use examples from school, sports, games, and nature
- Start introducing "because" reasoning to explain why
- Ask engaging questions to check understanding
- Use analogies to familiar concepts
- Celebrate "aha!" moments enthusiastically
- Encourage them to explain things back to you
- Example response: "That's a smart question! Let's think about it step by step. First..."`:`AGE-APPROPRIATE GUIDANCE (Ages 10-12 - Independent Learner):

- Use age-appropriate vocabulary with explanations of new terms
- Encourage critical thinking with "why" and "what if" questions
- Draw connections between different topics
- Introduce problem-solving strategies
- Support independent discovery and research
- Use real-world applications and examples
- Challenge them to think deeper
- Validate their growing knowledge
- Example response: "Excellent observation! Let me help you think through this. What do you think would happen if...?"`}getLearningStyleGuidance(e){return{visual:`VISUAL LEARNING STYLE:
- Use descriptive imagery in your explanations ("Picture this...", "Imagine...")
- Suggest drawing or creating diagrams to understand concepts
- Reference colors, shapes, patterns, and spatial relationships
- Describe things in terms of how they look
- When appropriate, suggest they look at pictures or create visual notes`,auditory:`AUDITORY LEARNING STYLE:
- Use rhythm, rhymes, and word patterns when possible
- Encourage reading explanations aloud
- Use sound-related analogies ("It sounds like...", "Listen to this idea...")
- Suggest explaining concepts out loud to themselves or others
- Use repetition and verbal patterns to reinforce learning`,kinesthetic:`KINESTHETIC LEARNING STYLE:
- Suggest hands-on activities when possible ("Try this with your hands...")
- Use action verbs and physical analogies ("Jump into this problem...")
- Encourage acting out concepts or using objects
- Relate learning to sports, building, cooking, or physical activities
- Frame learning as experiments, challenges, or adventures`}[e]}getLessonContextGuidance(e){let t=`CURRENT LESSON CONTEXT:
`;return e.subject&&(t+=`- Subject: ${e.subject}
`),e.topic&&(t+=`- Topic: ${e.topic}
`),e.grade&&(t+=`- Grade Level: ${e.grade}
`),e.summary&&(t+=`- Lesson Summary: ${e.summary.substring(0,500)}...
`),e.keyPoints&&e.keyPoints.length>0&&(t+=`- Key Learning Points: ${e.keyPoints.slice(0,5).join(", ")}
`),e.learningObjectives&&e.learningObjectives.length>0&&(t+=`- Learning Goals: ${e.learningObjectives.join(", ")}
`),e.uploadedContent&&(t+=`- Reference Material: The student has uploaded content about this topic. Help them understand it deeply.
`),t+=`
IMPORTANT: Keep your responses focused on this lesson context. If the student asks unrelated questions, gently guide them back or acknowledge their question briefly before returning to the lesson topic.`,t}getCurriculumGuidance(e){return{british:`BRITISH CURRICULUM Context:
- Use UK spelling (colour, favourite, maths)
- Reference Key Stages when appropriate
- Align explanations with National Curriculum standards
- Use British cultural references when helpful`,american:`AMERICAN CURRICULUM Context:
- Use US spelling (color, favorite, math)
- Reference Common Core standards when appropriate
- Use grade-level expectations for US system
- Use American cultural references when helpful`,indian:`INDIAN CURRICULUM Context:
- Recognize CBSE/ICSE curriculum structure
- Use examples relevant to Indian context when helpful
- Support bilingual learning approaches
- Respect cultural and regional diversity`,ib:`IB CURRICULUM Context:
- Emphasize inquiry-based learning approaches
- Focus on conceptual understanding over memorization
- Support international mindedness and global connections
- Encourage curiosity and questioning`}[e]||""}getGamificationGuidance(e){return`ENGAGEMENT & ENCOURAGEMENT:
- Current learning streak: ${e.currentStreak} days
- Total XP earned: ${e.xp}
${e.recentTopics&&e.recentTopics.length>0?`- Recent topics studied: ${e.recentTopics.join(", ")}`:""}

Naturally incorporate encouragement about their progress when appropriate:
- Celebrate their streak ("Wow, ${e.currentStreak} days of learning!")
- Acknowledge their dedication
- Encourage them to keep going`}getLanguageGuidance(e){return e==="ar"?`LANGUAGE: Arabic
- Respond in clear, Modern Standard Arabic when the student writes in Arabic
- Use age-appropriate Arabic vocabulary
- Include English terms in parentheses for technical/educational terms when helpful
- Be culturally appropriate for Arabic-speaking families`:`LANGUAGE: English
- Use clear, age-appropriate English
- Be mindful that many students may speak multiple languages
- Explain any technical terms simply
- Be patient with language learning processes`}getFormattingGuidance(){return`RESPONSE FORMATTING:
- Keep responses concise and focused (aim for 2-4 short paragraphs maximum)
- Use simple bullet points for lists (avoid complex formatting)
- Break long explanations into numbered steps
- End responses with a question or prompt to keep engagement
- Use occasional friendly expressions but don't overdo it
- Avoid using markdown headers (# or ##) in responses`}buildUserPrompt(e,t,s){let i=e;return s!=null&&s.uploadedContent&&(i=`[Student is asking about the lesson: "${s.topic||s.subject||"uploaded content"}"]

${e}`),i}getSuggestedQuestions(e){const t=["Can you explain this to me?","Can you give me an example?","Why is this important?","Can we practice together?"];return e!=null&&e.topic?[`What is ${e.topic} about?`,`Can you explain ${e.topic} in simple words?`,`Why should I learn about ${e.topic}?`,"Can you give me a fun example?","What's the main idea?"]:t}}const qte=new Wte;class Yte{constructor(e){this.conversationHistory=[],this.config=e,this.storageKey=`chat_history_${e.userProfile.id}`,this.loadConversationHistory()}async sendMessage(e,t={}){var s,i,r,o,c,d;try{const h={role:"user",content:e,timestamp:new Date,metadata:{lessonId:(s=this.config.lessonContext)==null?void 0:s.lessonId}};this.conversationHistory.push(h);const u=this.conversationHistory.slice(-10).map(w=>({role:w.role==="user"?"USER":"MODEL",content:w.content})),p=this.config.lessonContext?{lessonId:this.config.lessonContext.lessonId,title:this.config.lessonContext.topic,subject:this.config.lessonContext.subject,keyConcepts:this.config.lessonContext.keyPoints,content:this.config.lessonContext.uploadedContent,summary:this.config.lessonContext.summary}:void 0,f=this.config.userProfile.age<=7?"YOUNG":"OLDER",m=await yy.sendMessage({message:e,childId:this.config.userProfile.id,ageGroup:f,lessonContext:p,conversationHistory:u.slice(0,-1)}),x=((i=m.data)==null?void 0:i.content)||m.content||"I'm having trouble responding. Let's try again!",g=((r=m.data)==null?void 0:r.type)||"text",b=(o=m.data)==null?void 0:o.imageData,y=(c=m.data)==null?void 0:c.mimeType,C={role:"assistant",content:x,timestamp:new Date,type:g,...b&&{imageData:b},...y&&{mimeType:y},metadata:{lessonId:(d=this.config.lessonContext)==null?void 0:d.lessonId}};if(this.conversationHistory.push(C),this.trimHistory(),this.saveConversationHistory(),t.onChunk){const w=x.split(" ");for(let S=0;S<w.length;S++){const j=(S===0?"":" ")+w[S];t.onChunk(j),await new Promise(T=>setTimeout(T,20+Math.random()*30))}}return{message:C,blocked:!1}}catch(h){return console.error("ChatService error:",h),t.onError&&t.onError(h),{message:{role:"assistant",content:"Oops! Something went wrong on my end. Let's try that again!",timestamp:new Date},blocked:!1}}}getConversationHistory(){return[...this.conversationHistory]}clearHistory(){this.conversationHistory=[],this.saveConversationHistory()}trimHistory(){const e=this.config.maxHistoryLength||20;this.conversationHistory.length>e&&(this.conversationHistory=this.conversationHistory.slice(-e))}loadConversationHistory(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.conversationHistory=t.map(s=>({...s,timestamp:new Date(s.timestamp)}))}}catch(e){console.error("Error loading conversation history:",e),this.conversationHistory=[]}}saveConversationHistory(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.conversationHistory))}catch(e){console.error("Error saving conversation history:",e)}}async logSafetyIncident(e,t,s){var r;const i={type:e,content:t.substring(0,200),flags:s,timestamp:new Date,userId:this.config.userProfile.id,lessonId:(r=this.config.lessonContext)==null?void 0:r.lessonId};console.log("Safety incident:",i);try{const o=`safety_incidents_${this.config.userProfile.id}`,c=JSON.parse(localStorage.getItem(o)||"[]");c.push(i),localStorage.setItem(o,JSON.stringify(c.slice(-50)))}catch(o){console.error("Error logging safety incident:",o)}}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}updateLessonContext(e){this.config.lessonContext=e}getSuggestedQuestions(){return qte.getSuggestedQuestions(this.config.lessonContext)}}const Xte={id:"demo-user-001",name:"Young Learner",age:8,grade:3,learningStyle:"visual",interests:["science","math","animals"],language:"en",curriculumType:"american"},_G=N.createContext(null);function Kte({children:n,userProfile:e}){const[t,s]=N.useState([]),[i,r]=N.useState(!1),[o,c]=N.useState(!1),[d,h]=N.useState(null),[u,p]=N.useState([]),[f,m]=N.useState(""),[x,g]=N.useState([]),b=N.useRef(null),y=Hu(),C=bl();let w=null;try{w=Vt()}catch{}const S=N.useMemo(()=>{if(w!=null&&w.currentProfile){const V=w.currentProfile;return{id:V.id,name:V.displayName,age:V.age,grade:V.grade,learningStyle:V.learningStyle||"visual",interests:V.interests||[],language:V.language||"en",curriculumType:V.curriculumType||"american"}}return e||Xte},[w==null?void 0:w.currentProfile,e]),j=y==null?void 0:y.currentLesson,{currentXP:T,currentLevel:k,streak:_,earnXP:L,recordActivity:D,updateDailyChallengeProgress:P}=C||{},I=N.useCallback(()=>{var q,ee,ie;if(!j)return;const V=j.extractedText||j.rawText||((q=j.content)==null?void 0:q.extractedText)||((ee=j.content)==null?void 0:ee.rawText)||"";return{lessonId:j.id,title:j.title,subject:j.subject,topic:j.title||j.topic,grade:j.grade||j.gradeLevel,contentType:j.contentType||j.sourceType,content:V,uploadedContent:V,summary:j.summary,keyConcepts:j.keyConcepts||j.keyConceptsForChat||[],keyPoints:j.keyPoints||((ie=j.chapters)==null?void 0:ie.map(Re=>Re.title)),learningObjectives:j.learningObjectives}},[j]),M=N.useCallback(()=>({history:t,currentStreak:(_==null?void 0:_.current)||0,xp:T||0,recentTopics:j?[j.title||j.subject]:[]}),[t,_,T,j]);N.useEffect(()=>{const V={userProfile:S,lessonContext:I(),conversationContext:M(),enableStreaming:!0,maxHistoryLength:20};b.current=new Yte(V);const q=b.current.getConversationHistory();q.length>0&&s(q),g(b.current.getSuggestedQuestions())},[S]),N.useEffect(()=>{var V;b.current&&(b.current.updateConfig({userProfile:S}),S.id!==((V=b.current.getConfig().userProfile)==null?void 0:V.id)&&(b.current.clearHistory(),s([])))},[S.id]);const O=N.useRef(j==null?void 0:j.id);N.useEffect(()=>{if(b.current){const V=I(),q=O.current,ee=j==null?void 0:j.id;q&&ee&&q!==ee&&(b.current.clearHistory(),s([]),h(null),p([]),m("")),O.current=ee,b.current.updateConfig({lessonContext:V}),g(b.current.getSuggestedQuestions())}},[j==null?void 0:j.id,I]);const F=N.useCallback(async V=>{if(!b.current||!V.trim())return;r(!0),h(null),p([]),m(V);const q={role:"user",content:V,timestamp:new Date};s(ie=>[...ie,q]);const ee={role:"assistant",content:"",timestamp:new Date,isStreaming:!0};s(ie=>[...ie,ee]),c(!0);try{const ie=await b.current.sendMessage(V,{onChunk:Re=>{s(Ye=>{const Le=[...Ye],te=Le[Le.length-1];return te.role==="assistant"&&(Le[Le.length-1]={...te,content:te.content+Re}),Le})},onSafetyFlag:Re=>{p(Re)},onError:Re=>{h(Re.message)}});c(!1),s(Re=>{const Ye=[...Re];return Ye[Ye.length-1]={...ie.message,isStreaming:!1,type:ie.message.type||"text",imageData:ie.message.imageData,mimeType:ie.message.mimeType},Ye}),ie.blocked&&h(ie.blockReason||"Message was filtered for safety"),ie.safetyFlags&&ie.safetyFlags.length>0&&p(ie.safetyFlags),!ie.blocked&&L&&L(5,"Chat interaction"),D&&D(),P&&P("questionAnswered")}catch(ie){c(!1),h(ie.message||"Failed to send message"),s(Ye=>Ye.slice(0,-1));const Re={role:"assistant",content:"Oops! Something went wrong. Let's try that again!",timestamp:new Date,isError:!0};s(Ye=>[...Ye,Re])}finally{r(!1)}},[L,D,P]),B=N.useCallback(async()=>{f&&(s(V=>V.slice(0,-2)),await F(f))},[f,F]),U=N.useCallback(()=>{b.current&&(b.current.clearHistory(),s([]),h(null),p([]),m(""))},[]),$=N.useCallback(V=>{const q={role:"assistant",content:V,timestamp:new Date,isSystem:!0};s(ee=>[...ee,q])},[]),G=N.useCallback(V=>{const q={id:V.id||Date.now(),role:V.role||"assistant",content:V.content||"",timestamp:V.timestamp||new Date,type:V.type||"text",flashcards:V.flashcards,summary:V.summary,quiz:V.quiz,imageData:V.imageData,mimeType:V.mimeType,isError:V.isError,isSystem:V.isSystem};return s(ee=>[...ee,q]),q},[]),ne=N.useCallback(V=>{const q=V.map(ee=>({id:ee.id||Date.now()+Math.random(),role:ee.role||"assistant",content:ee.content||"",timestamp:ee.timestamp||new Date,type:ee.type||"text",flashcards:ee.flashcards,summary:ee.summary,quiz:ee.quiz,imageData:ee.imageData,mimeType:ee.mimeType,isError:ee.isError,isSystem:ee.isSystem}));s(ee=>[...ee,...q])},[]),Z=N.useCallback(()=>j?`Hi! I'm Jeffrey, your learning buddy! I see you're studying "${j.title||j.subject}". What would you like to know about it?`:"Hi there! I'm Jeffrey, your learning buddy! Upload a lesson or ask me anything you'd like to learn about!",[j]),K=N.useMemo(()=>({hasMessages:t.length>0,messageCount:t.length,hasSafetyFlags:u.length>0,isReady:!i&&b.current!==null,welcomeMessage:Z()}),[t,u,i,Z]),X=N.useMemo(()=>({messages:t,isLoading:i,isStreaming:o,error:d,safetyFlags:u,suggestedQuestions:x,...K,sendMessage:F,retryLastMessage:B,clearChat:U,addSystemMessage:$,addMessage:G,addMessages:ne,getWelcomeMessage:Z}),[t,i,o,d,u,x,K,F,B,U,$,G,ne,Z]);return a.jsx(_G.Provider,{value:X,children:n})}function Qte(){const n=N.useContext(_G);if(!n)throw new Error("useChatContext must be used within ChatProvider");return n}const yN="http://localhost:3000";let fy=null,gS=null,FL=!0;try{const n="__storage_test__";localStorage.setItem(n,n),localStorage.removeItem(n)}catch{FL=!1}function YD(n){if(!FL)return null;try{return localStorage.getItem(n)}catch{return null}}function TB(n,e){if(FL)try{localStorage.setItem(n,e)}catch{console.warn(`Failed to write ${n} to localStorage`)}}function _B(n){if(FL)try{localStorage.removeItem(n)}catch{console.warn(`Failed to remove ${n} from localStorage`)}}const uo={initialize(){const n=YD("teacher_auth_token"),e=YD("teacher_refresh_token");return n&&(fy=n),e&&(gS=e),{hasAccessToken:!!fy}},getAccessToken(){return fy},getRefreshToken(){return gS||YD("teacher_refresh_token")},setTokens({token:n,refreshToken:e}){n&&(fy=n,TB("teacher_auth_token",n)),e&&(gS=e,TB("teacher_refresh_token",e))},clearTokens(){fy=null,gS=null,_B("teacher_auth_token"),_B("teacher_refresh_token")},isAuthenticated(){return!!fy},async refreshAccessToken(){const n=this.getRefreshToken();if(!n)throw new Error("No refresh token available");const e=await fetch(`${yN}/api/teacher/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({refreshToken:n})});if(!e.ok)throw this.clearTokens(),new Error("Token refresh failed");const t=await e.json(),s=t.data||t;return this.setTokens({token:s.token,refreshToken:s.refreshToken}),s}};async function Mt(n,e={},t=0){const s={"Content-Type":"application/json",...e.headers},i=uo.getAccessToken();i&&(s.Authorization=`Bearer ${i}`);const r={...e,headers:s,credentials:"include"};try{const o=await fetch(`${yN}/api/teacher${n}`,r);if(o.status===401&&t===0&&!n.includes("/auth/refresh"))try{return await uo.refreshAccessToken(),Mt(n,e,1)}catch{throw new Error("Session expired. Please log in again.")}if(!o.ok){const c=await o.json().catch(()=>({})),d=new Error(c.error||c.message||`HTTP error! status: ${o.status}`);throw d.status=o.status,d.data=c,d}return o.json()}catch(o){throw o.status||(o.message=o.message||"Network error. Please check your connection."),o}}async function _m(n,e={}){const t={"Content-Type":"application/json",...e.headers},s={...e,headers:t,credentials:"include"};try{const i=await fetch(`${yN}/api/teacher${n}`,s);if(!i.ok){const r=await i.json().catch(()=>({})),o=new Error(r.error||r.message||`HTTP error! status: ${i.status}`);throw o.status=i.status,o.data=r,o}return i.json()}catch(i){throw i.status||(i.message=i.message||"Network error. Please check your connection."),i}}const lt={signUp:async({email:n,password:e,firstName:t,lastName:s})=>_m("/auth/signup",{method:"POST",body:JSON.stringify({email:n,password:e,firstName:t,lastName:s})}),signIn:async({email:n,password:e})=>{const t=await _m("/auth/login",{method:"POST",body:JSON.stringify({email:n,password:e})});if(t.success){const s=t.data||t;s.token&&uo.setTokens({token:s.token,refreshToken:s.refreshToken})}return t},logout:async()=>{const n=uo.getRefreshToken();try{await Mt("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:n})})}finally{uo.clearTokens()}},verifyEmail:async(n,e)=>{var s;const t=await _m("/auth/verify-email",{method:"POST",body:JSON.stringify({email:n,code:e})});return t.success&&((s=t.data)!=null&&s.token)&&uo.setTokens({token:t.data.token,refreshToken:t.data.refreshToken}),t},resendVerificationEmail:async n=>_m("/auth/resend-verification",{method:"POST",body:JSON.stringify({email:n})}),requestPasswordReset:async n=>_m("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:n})}),verifyResetCode:async(n,e)=>_m("/auth/verify-reset-code",{method:"POST",body:JSON.stringify({email:n,code:e})}),resetPassword:async(n,e)=>_m("/auth/reset-password",{method:"POST",body:JSON.stringify({email:n,newPassword:e})}),getCurrentTeacher:async()=>Mt("/auth/me",{method:"GET"}),updateProfile:async n=>Mt("/auth/profile",{method:"PATCH",body:JSON.stringify(n)}),changePassword:async(n,e)=>Mt("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:n,newPassword:e})}),deleteAccount:async()=>Mt("/auth/delete-account",{method:"DELETE"}),getQuota:async()=>Mt("/quota",{method:"GET"}),getUsageStats:async(n="month")=>Mt(`/quota/usage?period=${n}`,{method:"GET"}),checkQuota:async(n,e)=>{const t=new URLSearchParams({operation:n});return e&&t.append("tokens",e),Mt(`/quota/check?${t}`,{method:"GET"})},listContent:async(n={})=>{const e=new URLSearchParams;return Object.entries(n).forEach(([t,s])=>{s!=null&&s!==""&&e.append(t,s)}),Mt(`/content?${e}`,{method:"GET"})},getContentStats:async()=>Mt("/content/stats",{method:"GET"}),getRecentContent:async(n=5)=>Mt(`/content/recent?limit=${n}`,{method:"GET"}),createContent:async n=>Mt("/content",{method:"POST",body:JSON.stringify(n)}),getContent:async n=>Mt(`/content/${n}`,{method:"GET"}),updateContent:async(n,e)=>Mt(`/content/${n}`,{method:"PATCH",body:JSON.stringify(e)}),deleteContent:async n=>Mt(`/content/${n}`,{method:"DELETE"}),duplicateContent:async n=>Mt(`/content/${n}/duplicate`,{method:"POST"}),updateContentStatus:async(n,e)=>Mt(`/content/${n}/status`,{method:"PATCH",body:JSON.stringify({status:e})}),generateLesson:async n=>Mt("/content/generate/lesson",{method:"POST",body:JSON.stringify(n)}),generateQuiz:async(n,e,t=!1)=>Mt(`/content/${n}/generate/quiz?save=${t}`,{method:"POST",body:JSON.stringify(e)}),generateFlashcards:async(n,e,t=!1)=>Mt(`/content/${n}/generate/flashcards?save=${t}`,{method:"POST",body:JSON.stringify(e)}),generateStudyGuide:async(n,e)=>Mt(`/content/${n}/generate/study-guide`,{method:"POST",body:JSON.stringify(e)}),analyzeContent:async(n,e={})=>Mt("/content/analyze",{method:"POST",body:JSON.stringify({content:n,...e})}),generateInfographic:async(n,e)=>Mt(`/content/${n}/generate/infographic`,{method:"POST",body:JSON.stringify(e)}),exportContentPDF:async(n,e={})=>{var c,d;const t=new URLSearchParams;e.format&&t.append("format",e.format),e.includeAnswers!==void 0&&t.append("includeAnswers",e.includeAnswers),e.includeTeacherNotes!==void 0&&t.append("includeTeacherNotes",e.includeTeacherNotes),e.paperSize&&t.append("paperSize",e.paperSize),e.colorScheme&&t.append("colorScheme",e.colorScheme);const s=uo.getAccessToken(),i=await fetch(`${yN}/api/teacher/export/${n}?${t}`,{method:"GET",headers:{Authorization:`Bearer ${s}`},credentials:"include"});if(!i.ok)throw new Error("Failed to export content");const r=await i.blob(),o=((d=(c=i.headers.get("content-disposition"))==null?void 0:c.match(/filename="(.+)"/))==null?void 0:d[1])||"export.pdf";return{blob:r,filename:o}},exportBatchPDF:async(n,e={})=>{var o,c;const t=uo.getAccessToken(),s=await fetch(`${yN}/api/teacher/export/batch`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},credentials:"include",body:JSON.stringify({contentIds:n,options:e})});if(!s.ok)throw new Error("Failed to export content");const i=await s.blob(),r=((c=(o=s.headers.get("content-disposition"))==null?void 0:o.match(/filename="(.+)"/))==null?void 0:c[1])||"export.pdf";return{blob:i,filename:r}},getGoogleDriveStatus:async()=>Mt("/export/drive/status",{method:"GET"}),getGoogleDriveAuthUrl:async()=>Mt("/export/drive/auth-url",{method:"GET"}),connectGoogleDrive:async n=>Mt("/export/drive/callback",{method:"POST",body:JSON.stringify({code:n})}),disconnectGoogleDrive:async()=>Mt("/export/drive/disconnect",{method:"DELETE"}),saveToGoogleDrive:async(n,e={})=>Mt(`/export/${n}/drive`,{method:"POST",body:JSON.stringify(e)}),saveBatchToGoogleDrive:async(n,e={})=>Mt("/export/batch/drive",{method:"POST",body:JSON.stringify({contentIds:n,options:e})}),listGoogleDriveFiles:async(n=20,e=null)=>{const t=new URLSearchParams({pageSize:String(n)});return e&&t.append("pageToken",e),Mt(`/export/drive/files?${t}`,{method:"GET"})},deleteGoogleDriveFile:async n=>Mt(`/export/drive/files/${n}`,{method:"DELETE"})},PG=N.createContext(null);function Jte({children:n}){const[e,t]=N.useState(null),[s,i]=N.useState(null),[r,o]=N.useState(!0),[c,d]=N.useState(!1),[h,u]=N.useState(null);N.useEffect(()=>{(async()=>{try{const{hasAccessToken:_}=uo.initialize();if(!_&&!uo.getRefreshToken())return;if(_)try{const L=await lt.getCurrentTeacher(),D=L.data||L;t(D.teacher);try{const P=await lt.getQuota();i(P.data||P)}catch(P){console.warn("Failed to fetch quota:",P)}return}catch{console.log("Access token invalid, attempting refresh...")}if(uo.getRefreshToken())try{await uo.refreshAccessToken();const L=await lt.getCurrentTeacher(),D=L.data||L;t(D.teacher);try{const P=await lt.getQuota();i(P.data||P)}catch(P){console.warn("Failed to fetch quota:",P)}return}catch(L){console.error("Token refresh failed:",L),uo.clearTokens()}}catch(_){console.error("Load teacher auth error:",_),u(_.message)}finally{o(!1),d(!0)}})()},[]);const p=N.useCallback(async(k,_,L,D)=>{o(!0),u(null);try{const P=await lt.signUp({email:k,password:_,firstName:L,lastName:D});if(!P.success)throw new Error(P.error||"Sign up failed");return{success:!0,requiresEmailVerification:!0}}catch(P){throw u(P.message),P}finally{o(!1)}},[]),f=N.useCallback(async(k,_)=>{o(!0),u(null);try{const L=await lt.signIn({email:k,password:_});if(!L.success)throw new Error(L.error||"Sign in failed");const P=(L.data||L).teacher;if(!P)throw new Error("Invalid login response: missing teacher data");t(P),d(!0);try{const I=await lt.getQuota();i(I.data||I)}catch(I){console.warn("Failed to fetch quota:",I)}return{success:!0,teacher:P}}catch(L){throw u(L.message),L}finally{o(!1)}},[]),m=N.useCallback(async()=>{try{await lt.logout()}catch(k){console.error("Logout error:",k)}t(null),i(null),u(null)},[]),x=N.useCallback(async(k,_)=>{var D;const L=await lt.verifyEmail(k,_);if(L.success&&((D=L.data)!=null&&D.teacher)){t(L.data.teacher);try{const P=await lt.getQuota();i(P.data||P)}catch(P){console.warn("Failed to fetch quota:",P)}}return L},[]),g=N.useCallback(async()=>{try{const k=await lt.getCurrentTeacher(),_=k.data||k;t(_.teacher);try{const L=await lt.getQuota();i(L.data||L)}catch(L){console.warn("Failed to fetch quota:",L)}}catch(k){console.error("Refresh auth error:",k),u(k.message)}},[]),b=N.useCallback(async()=>{try{const k=await lt.getQuota();i(k.data||k)}catch(k){console.error("Refresh quota error:",k)}},[]),y=N.useCallback(async k=>{const _=await lt.updateProfile(k);return _.success&&t(L=>({...L,...k})),_},[]),C=!!e,w=e&&!e.emailVerified,S=!r&&c,j=N.useMemo(()=>e?{tier:e.subscriptionTier||"FREE",monthlyQuota:e.monthlyTokenQuota||1e5,currentUsage:e.currentMonthUsage||0,quotaResetDate:e.quotaResetDate}:null,[e]),T=N.useMemo(()=>({teacher:e,quota:s,isLoading:r,isInitialized:c,error:h,isAuthenticated:C,needsEmailVerification:w,isReady:S,subscriptionInfo:j,signUp:p,signIn:f,signOut:m,verifyEmail:x,refreshAuth:g,updateProfile:y,refreshQuota:b}),[e,s,r,c,h,C,w,S,j,p,f,m,x,g,y,b]);return a.jsx(PG.Provider,{value:T,children:n})}function Cm(){const n=N.useContext(PG);if(!n)throw new Error("useTeacherAuth must be used within TeacherAuthProvider");return n}const PB=15,LG=N.createContext(null);function Zte({children:n}){const e=Qt();let t=null;try{t=Vt()}catch{}const s=t==null?void 0:t.user,i=t==null?void 0:t.currentProfile,r=t==null?void 0:t.children,[o,c]=N.useState("child"),[d,h]=N.useState(!1),[u,p]=N.useState(new Date),[f,m]=N.useState(!0),[x,g]=N.useState(PB),[b,y]=N.useState(null);N.useEffect(()=>{if(s){const _=Rr.getUserPreferences();_!=null&&_.autoSwitch&&(m(_.autoSwitch.enabled),g(_.autoSwitch.minutes||PB)),$t.isChildMode(),c("child")}},[s]),N.useEffect(()=>{if(!f||o==="child")return;const _=setInterval(()=>{(new Date().getTime()-u.getTime())/(1e3*60)>=x&&(console.log("Auto-switching to child mode due to inactivity"),w())},3e4);return()=>clearInterval(_)},[f,x,o,u]),N.useEffect(()=>{const _=()=>p(new Date);return window.addEventListener("mousedown",_),window.addEventListener("keydown",_),window.addEventListener("touchstart",_),window.addEventListener("scroll",_),()=>{window.removeEventListener("mousedown",_),window.removeEventListener("keydown",_),window.removeEventListener("touchstart",_),window.removeEventListener("scroll",_)}},[]);const C=N.useCallback(async _=>{if(!s||!i)return{success:!1,error:"Not authenticated"};h(!0),y(null);try{const L=await xr.switchToChild(i.id,_);if(L.success)return xr.switchToParent(),c("parent"),p(new Date),e("/parent/dashboard"),h(!1),{success:!0};{const D=L.error||"Invalid PIN";return y(D),h(!1),{success:!1,error:D}}}catch(L){console.error("Switch to parent mode error:",L);const D=L.message||"Failed to verify PIN";return y(D),h(!1),{success:!1,error:D}}},[s,i,e]),w=N.useCallback(()=>{c("child"),y(null),e("/learn")},[e]),S=N.useCallback((_,L)=>{m(_),L!==void 0&&g(L);const D=Rr.getUserPreferences()||{};Rr.setUserPreferences({...D,autoSwitch:{enabled:_,minutes:L||x}})},[x]),j=N.useCallback(()=>{y(null)},[]),T=o==="parent",k=N.useMemo(()=>({currentMode:o,isParentMode:T,isChildMode:o==="child",isTransitioning:d,pinError:b,currentChild:i,childProfiles:r,switchToChildMode:w,switchToParentMode:C,clearPinError:j,autoSwitchEnabled:f,autoSwitchMinutes:x,updateAutoSwitch:S}),[o,T,d,b,i,r,w,C,j,f,x,S]);return a.jsx(LG.Provider,{value:k,children:n})}function OL(){const n=N.useContext(LG);if(!n)throw new Error("useMode must be used within ModeProvider");return n}function fc(){return localStorage.getItem("current_profile_id")||null}const nl={createNote:async n=>{const e=fc();return ue("/notes",{method:"POST",body:JSON.stringify({...n,childId:e})})},getMyNotes:async(n={})=>{const e=fc(),t=new URLSearchParams;e&&t.append("childId",e),n.subject&&t.append("subject",n.subject),n.lessonId&&t.append("lessonId",n.lessonId),n.grouped&&t.append("grouped","true");const s=t.toString()?`?${t.toString()}`:"";return ue(`/notes/me${s}`,{method:"GET"})},getMyNoteStats:async()=>{const n=fc(),e=n?`?childId=${n}`:"";return ue(`/notes/me/stats${e}`,{method:"GET"})},getMyNotesBySubject:async n=>{const e=fc(),t=e?`?childId=${e}`:"";return ue(`/notes/me/subject/${n}${t}`,{method:"GET"})},getNote:async n=>{const e=fc(),t=e?`?childId=${e}`:"";return ue(`/notes/${n}${t}`,{method:"GET"})},updateNote:async(n,e)=>{const t=fc();return ue(`/notes/${n}`,{method:"PATCH",body:JSON.stringify({...e,childId:t})})},updateNoteCover:async(n,e)=>{const t=fc();return ue(`/notes/${n}/cover`,{method:"PATCH",body:JSON.stringify({...e,childId:t})})},toggleNotePin:async n=>{const e=fc();return ue(`/notes/${n}/pin`,{method:"POST",body:JSON.stringify({childId:e})})},reorderNotes:async n=>{const e=fc();return ue("/notes/reorder",{method:"PATCH",body:JSON.stringify({noteIds:n,childId:e})})},deleteNote:async n=>{const e=fc(),t=e?`?childId=${e}`:"";return ue(`/notes/${n}${t}`,{method:"DELETE"})},getChildNotes:async(n,e={})=>{const t=new URLSearchParams;e.subject&&t.append("subject",e.subject),e.grouped&&t.append("grouped","true");const s=t.toString()?`?${t.toString()}`:"";return ue(`/notes/child/${n}${s}`,{method:"GET"})},getChildNoteStats:async n=>ue(`/notes/child/${n}/stats`,{method:"GET"}),getNoteForParent:async n=>ue(`/notes/${n}/parent`,{method:"GET"}),addComment:async(n,e)=>ue(`/notes/${n}/comments`,{method:"POST",body:JSON.stringify(e)}),getComments:async n=>ue(`/notes/${n}/comments`,{method:"GET"}),deleteComment:async(n,e)=>ue(`/notes/${n}/comments/${e}`,{method:"DELETE"})};function mk(n){const e={};for(const t of n){const s=t.subject||"OTHER";e[s]||(e[s]=[]),e[s].push(t)}return e}const DG={notes:[],notesBySubject:{},noteStats:null,isNotebookModalOpen:!1,pendingNoteData:null,selectedNote:null,activeSubject:"all",isLoading:!1,isSaving:!1,isInitialized:!1,loadedChildId:null,error:null},Tt={SET_LOADING:"SET_LOADING",SET_SAVING:"SET_SAVING",LOAD_NOTES:"LOAD_NOTES",LOAD_STATS:"LOAD_STATS",ADD_NOTE:"ADD_NOTE",UPDATE_NOTE:"UPDATE_NOTE",DELETE_NOTE:"DELETE_NOTE",OPEN_NOTEBOOK_MODAL:"OPEN_NOTEBOOK_MODAL",CLOSE_NOTEBOOK_MODAL:"CLOSE_NOTEBOOK_MODAL",SET_SELECTED_NOTE:"SET_SELECTED_NOTE",CLEAR_SELECTED_NOTE:"CLEAR_SELECTED_NOTE",SET_ACTIVE_SUBJECT:"SET_ACTIVE_SUBJECT",SET_ERROR:"SET_ERROR",CLEAR_STATE:"CLEAR_STATE"};function ese(n,e){var t,s;switch(e.type){case Tt.SET_LOADING:return{...n,isLoading:e.payload};case Tt.SET_SAVING:return{...n,isSaving:e.payload};case Tt.LOAD_NOTES:return{...n,notes:e.payload.notes,notesBySubject:mk(e.payload.notes),isLoading:!1,isInitialized:!0,loadedChildId:e.payload.childId,error:null};case Tt.LOAD_STATS:return{...n,noteStats:e.payload};case Tt.ADD_NOTE:const i=[e.payload,...n.notes];return{...n,notes:i,notesBySubject:mk(i),isSaving:!1};case Tt.UPDATE_NOTE:const r=n.notes.map(c=>c.id===e.payload.id?e.payload:c);return{...n,notes:r,notesBySubject:mk(r),selectedNote:((t=n.selectedNote)==null?void 0:t.id)===e.payload.id?e.payload:n.selectedNote,isSaving:!1};case Tt.DELETE_NOTE:const o=n.notes.filter(c=>c.id!==e.payload);return{...n,notes:o,notesBySubject:mk(o),selectedNote:((s=n.selectedNote)==null?void 0:s.id)===e.payload?null:n.selectedNote};case Tt.OPEN_NOTEBOOK_MODAL:return{...n,isNotebookModalOpen:!0,pendingNoteData:e.payload};case Tt.CLOSE_NOTEBOOK_MODAL:return{...n,isNotebookModalOpen:!1,pendingNoteData:null};case Tt.SET_SELECTED_NOTE:return{...n,selectedNote:e.payload};case Tt.CLEAR_SELECTED_NOTE:return{...n,selectedNote:null};case Tt.SET_ACTIVE_SUBJECT:return{...n,activeSubject:e.payload};case Tt.SET_ERROR:return{...n,error:e.payload,isLoading:!1,isSaving:!1};case Tt.CLEAR_STATE:return DG;default:return n}}const RG=N.createContext(null);function tse({children:n}){const[e,t]=N.useReducer(ese,DG),{currentProfile:s}=Vt(),i=N.useRef(!1);N.useEffect(()=>{s!=null&&s.id&&s.id!==e.loadedChildId&&r()},[s==null?void 0:s.id]),N.useEffect(()=>{s||t({type:Tt.CLEAR_STATE})},[s]);const r=N.useCallback(async()=>{if(!(!(s!=null&&s.id)||i.current)){i.current=!0,t({type:Tt.SET_LOADING,payload:!0});try{const S=await nl.getMyNotes();S.success&&t({type:Tt.LOAD_NOTES,payload:{notes:S.data.notes||[],childId:s.id}})}catch(S){console.error("Failed to fetch notes:",S),t({type:Tt.SET_ERROR,payload:S.message||"Failed to fetch notes"})}finally{i.current=!1}}},[s==null?void 0:s.id]),o=N.useCallback(async()=>{if(s!=null&&s.id)try{const S=await nl.getMyNoteStats();S.success&&t({type:Tt.LOAD_STATS,payload:S.data})}catch(S){console.error("Failed to fetch note stats:",S)}},[s==null?void 0:s.id]),c=N.useCallback(async S=>{t({type:Tt.SET_SAVING,payload:!0});try{const j=await nl.createNote(S);if(j.success)return t({type:Tt.ADD_NOTE,payload:j.data.note}),t({type:Tt.CLOSE_NOTEBOOK_MODAL}),{success:!0,note:j.data.note,xpAwarded:j.data.xpAwarded,leveledUp:j.data.leveledUp,newBadges:j.data.newBadges}}catch(j){return console.error("Failed to create note:",j),t({type:Tt.SET_ERROR,payload:j.message||"Failed to create note"}),{success:!1,error:j.message}}return{success:!1}},[]),d=N.useCallback(async(S,j)=>{t({type:Tt.SET_SAVING,payload:!0});try{const T=await nl.updateNote(S,j);if(T.success)return t({type:Tt.UPDATE_NOTE,payload:T.data.note}),{success:!0,note:T.data.note,xpAwarded:T.data.xpAwarded}}catch(T){return console.error("Failed to update note:",T),t({type:Tt.SET_ERROR,payload:T.message||"Failed to update note"}),{success:!1,error:T.message}}return{success:!1}},[]),h=N.useCallback(async(S,j)=>{try{const T=await nl.updateNoteCover(S,j);if(T.success)return t({type:Tt.UPDATE_NOTE,payload:T.data.note}),{success:!0,note:T.data.note}}catch(T){return console.error("Failed to update note cover:",T),{success:!1,error:T.message}}return{success:!1}},[]),u=N.useCallback(async S=>{try{const j=await nl.toggleNotePin(S);if(j.success)return t({type:Tt.UPDATE_NOTE,payload:j.data.note}),{success:!0,note:j.data.note}}catch(j){return console.error("Failed to toggle note pin:",j),{success:!1,error:j.message}}return{success:!1}},[]),p=N.useCallback(async S=>{try{if((await nl.deleteNote(S)).success)return t({type:Tt.DELETE_NOTE,payload:S}),{success:!0}}catch(j){return console.error("Failed to delete note:",j),{success:!1,error:j.message}}return{success:!1}},[]),f=N.useCallback((S=null)=>{t({type:Tt.OPEN_NOTEBOOK_MODAL,payload:S})},[]),m=N.useCallback(()=>{t({type:Tt.CLOSE_NOTEBOOK_MODAL})},[]),x=N.useCallback(S=>{t({type:Tt.SET_SELECTED_NOTE,payload:S})},[]),g=N.useCallback(()=>{t({type:Tt.CLEAR_SELECTED_NOTE})},[]),b=N.useCallback(S=>{t({type:Tt.SET_ACTIVE_SUBJECT,payload:S})},[]),y=N.useCallback(()=>e.activeSubject==="all"?e.notes:e.notesBySubject[e.activeSubject]||[],[e.notes,e.notesBySubject,e.activeSubject]),C=N.useCallback(()=>Object.keys(e.notesBySubject),[e.notesBySubject]),w={...e,fetchNotes:r,fetchNoteStats:o,createNote:c,updateNote:d,updateNoteCover:h,toggleNotePin:u,deleteNote:p,openNotebookModal:f,closeNotebookModal:m,setSelectedNote:x,clearSelectedNote:g,setActiveSubject:b,getFilteredNotes:y,getAvailableSubjects:C};return a.jsx(RG.Provider,{value:w,children:n})}function y5(){const n=N.useContext(RG);if(!n)throw new Error("useNotebookContext must be used within a NotebookProvider");return n}function W1(){const n=localStorage.getItem("current_profile_id"),e=localStorage.getItem("demo_children");if(n&&e)try{const s=JSON.parse(e).find(i=>i.id===n);if(s)return{childId:s.id,ageGroup:s.age<=7?"YOUNG":"OLDER"}}catch(t){console.error("Error parsing child context:",t)}return{childId:null,ageGroup:"OLDER"}}async function XD(n,e={}){const{subject:t,gradeLevel:s,onProgress:i}=e,{childId:r,ageGroup:o}=W1();i&&i(10);try{const c=await ue("/lessons/analyze",{method:"POST",body:JSON.stringify({content:n,childId:r,ageGroup:o,subject:t,gradeLevel:s})});i&&i(100);const{lesson:d,analysis:h}=c.data,u=h||c.data;return{lessonId:(d==null?void 0:d.id)||null,dbLesson:d||null,title:u.title,summary:u.summary,gradeLevel:u.gradeLevel||s||"Grade 3-4",subject:u.subject||t||"General",formattedContent:u.formattedContent||null,chapters:u.chapters||[],keyConceptsForChat:u.keyConcepts||[],vocabulary:u.vocabulary||[],suggestedQuestions:u.suggestedQuestions||[],relatedTopics:u.relatedTopics||[],estimatedReadTime:Math.ceil(n.split(/\s+/).length/200)}}catch(c){throw console.error("Content analysis error:",c),new Error("Failed to analyze content. Please try again.")}}async function KD(n,e){const{childId:t,ageGroup:s}=W1();try{return(await ue("/lessons/process",{method:"POST",body:JSON.stringify({content:n,task:e,childId:t,ageGroup:s})})).data}catch(i){throw console.error("Process with Gemini error:",i),new Error("Failed to process content. Please try again.")}}async function sse(n,e,t=[]){const{childId:s,ageGroup:i}=W1();try{const r=await ue("/chat",{method:"POST",body:JSON.stringify({message:n,childId:s,ageGroup:i,lessonContext:e?{lessonId:e.id,title:e.title,subject:e.subject,keyConcepts:e.keyConceptsForChat||e.keyConcepts}:null,conversationHistory:t.map(o=>({role:o.role==="assistant"?"MODEL":"USER",content:o.content}))})});return r.data.type==="image"&&r.data.imageData?{content:r.data.content,type:"image",imageData:r.data.imageData,mimeType:r.data.mimeType}:r.data.content}catch(r){return console.error("Chat response error:",r),"I'm having a little trouble right now. Can you try asking me again?"}}async function IG(n,e=10){const{childId:t,ageGroup:s}=W1();try{return{flashcards:(await ue("/flashcards/generate",{method:"POST",body:JSON.stringify({content:n,count:e,childId:t,ageGroup:s})})).data.map((r,o)=>({id:r.id||`card-${o+1}`,front:r.front,back:r.back,hint:r.hint,difficulty:r.difficulty||"medium"}))}}catch(i){throw console.error("Flashcard generation error:",i),new Error("Failed to generate flashcards. Please try again.")}}async function nse(n,e=5){const{childId:t,ageGroup:s}=W1();try{const i=await ue("/quizzes/generate",{method:"POST",body:JSON.stringify({content:n,count:e,childId:t,ageGroup:s,type:"multiple_choice"})});return{title:i.data.title||"Quiz",questions:i.data.questions.map((r,o)=>({id:r.id||`q-${o+1}`,question:r.question,options:r.options,correctAnswer:r.correctAnswer,explanation:r.explanation,encouragement:r.encouragement}))}}catch(i){throw console.error("Quiz generation error:",i),new Error("Failed to generate quiz. Please try again.")}}async function ise(n,e){const{childId:t,ageGroup:s}=W1();try{return(await ue("/chat/translate",{method:"POST",body:JSON.stringify({text:n,targetLanguage:e,childId:t,ageGroup:s})})).data}catch(i){throw console.error("Translation error:",i),new Error("Failed to translate text. Please try again.")}}const mc={"ask-jeffrey":5,"create-flashcard":10,"generate-quiz":8,translate:5,"save-selection":3,"read-aloud":2},MG=N.createContext(null);function rse({children:n}){const[e,t]=N.useState(null),[s,i]=N.useState(!1),[r,o]=N.useState(null),[c,d]=N.useState([]),{earnXP:h,updateStatistics:u,updateDailyChallengeProgress:p}=bl(),{currentLesson:f}=Hu(),{openNotebookModal:m}=y5(),x=N.useCallback(P=>{t(P),P&&o(null)},[]),g=N.useCallback(()=>{var P;t(null),o(null),(P=window.getSelection())==null||P.removeAllRanges()},[]),b=N.useCallback(async P=>{var I,M;if(!e)return null;i(!0);try{const O={selectedText:e.text,lessonTitle:f==null?void 0:f.title,lessonSubject:f==null?void 0:f.subject,beforeText:((I=e.context)==null?void 0:I.beforeText)||"",afterText:((M=e.context)==null?void 0:M.afterText)||""},F=P?`The student selected this text: "${e.text}" and asks: "${P}"`:`The student selected this text and wants to understand it: "${e.text}"`,B=await sse(F,O),U=typeof B=="object"&&B.type==="image",$={type:"jeffrey-response",content:{answer:U?B.content:B,question:P,selectedText:e.text,...U&&{imageData:B.imageData,mimeType:B.mimeType}},xpEarned:mc["ask-jeffrey"]};return o($),h(mc["ask-jeffrey"],"Asked Jeffrey a question"),u({questionsAnswered:1}),p("questionAnswered"),$}catch(O){throw console.error("Error asking Jeffrey:",O),O}finally{i(!1)}},[e,f,h,u,p]),y=N.useCallback(async()=>{if(!e)return null;i(!0);try{const I=(await IG(e.text,1)).flashcards[0],O={type:"flashcard",content:{id:`selection-${Date.now()}`,front:`What does this mean: "${e.text.substring(0,100)}${e.text.length>100?"...":""}"?`,back:I.back,sourceText:e.text,lessonId:f==null?void 0:f.id,createdAt:new Date().toISOString()},xpEarned:mc["create-flashcard"]};return o(O),h(mc["create-flashcard"],"Created a flashcard"),u({flashcardsReviewed:1}),p("flashcardReviewed"),O}catch(P){throw console.error("Error creating flashcard:",P),P}finally{i(!1)}},[e,f,h,u,p]),C=N.useCallback(async()=>{if(!e)return null;i(!0);try{const O={type:"quiz",content:{...(await nse(e.text,1)).questions[0],id:`quiz-${Date.now()}`,question:`Based on "${e.text.substring(0,50)}${e.text.length>50?"...":""}", which is correct?`,sourceText:e.text,lessonId:f==null?void 0:f.id},xpEarned:mc["generate-quiz"]};return o(O),h(mc["generate-quiz"],"Generated a quiz"),O}catch(P){throw console.error("Error generating quiz:",P),P}finally{i(!1)}},[e,f,h]),w=N.useCallback(()=>e?(m({originalText:e.text,lessonId:f==null?void 0:f.id,lessonTitle:f==null?void 0:f.title,subject:f==null?void 0:f.subject}),g(),{type:"notebook-opened"}):null,[e,f,m,g]),S=N.useCallback(async(P="Spanish")=>{if(!e)return null;i(!0);try{const I=await ise(e.text,P),M={type:"translation",content:{originalText:I.originalText,translatedText:I.translatedText,targetLanguage:I.targetLanguage,pronunciation:I.pronunciation,simpleExplanation:I.simpleExplanation},xpEarned:mc.translate};return o(M),h(mc.translate,"Translated text"),M}catch(I){throw console.error("Error translating:",I),I}finally{i(!1)}},[e,h]),j=N.useCallback(()=>{if(!e)return;window.speechSynthesis.cancel();const P=new SpeechSynthesisUtterance(e.text);P.rate=.9,P.pitch=1.1;const M=window.speechSynthesis.getVoices().find(O=>O.name.includes("Samantha")||O.name.includes("Karen")||O.name.includes("Victoria"));return M&&(P.voice=M),window.speechSynthesis.speak(P),h(mc["read-aloud"],"Used read aloud"),{type:"read-aloud",xpEarned:mc["read-aloud"]}},[e,h]),T=N.useCallback(async P=>{if(e)switch(P.type){case"ask":return b(P.userQuestion);case"flashcard":return y();case"quiz":return C();case"translate":return S(P.targetLanguage);case"save":return w();case"read":return j();default:return console.warn("Unknown action type:",P.type),null}},[e,b,y,C,S,w,j]),k=N.useCallback(()=>{o(null)},[]),_=N.useCallback(P=>c.filter(I=>I.lessonId===P),[c]),L=N.useCallback(P=>{d(I=>I.filter(M=>M.id!==P))},[]),D={currentSelection:e,isProcessing:s,result:r,savedSelections:c,setSelection:x,clearSelection:g,handleAction:T,handleAskJeffrey:b,handleCreateFlashcard:y,handleGenerateQuiz:C,handleTranslate:S,handleSaveSelection:w,handleReadAloud:j,clearResult:k,getSavedSelectionsForLesson:_,removeSavedSelection:L};return a.jsx(MG.Provider,{value:D,children:n})}function BL(){const n=N.useContext(MG);if(!n)throw new Error("useSelectionContext must be used within a SelectionProvider");return n}const b5=N.createContext({});function v5(n){const e=N.useRef(null);return e.current===null&&(e.current=n()),e.current}const $L=N.createContext(null),w5=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class ase extends N.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function ose({children:n,isPresent:e}){const t=N.useId(),s=N.useRef(null),i=N.useRef({width:0,height:0,top:0,left:0}),{nonce:r}=N.useContext(w5);return N.useInsertionEffect(()=>{const{width:o,height:c,top:d,left:h}=i.current;if(e||!s.current||!o||!c)return;s.current.dataset.motionPopId=t;const u=document.createElement("style");return r&&(u.nonce=r),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${c}px !important;
            top: ${d}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[e]),a.jsx(ase,{isPresent:e,childRef:s,sizeRef:i,children:N.cloneElement(n,{ref:s})})}const lse=({children:n,initial:e,isPresent:t,onExitComplete:s,custom:i,presenceAffectsLayout:r,mode:o})=>{const c=v5(cse),d=N.useId(),h=N.useCallback(p=>{c.set(p,!0);for(const f of c.values())if(!f)return;s&&s()},[c,s]),u=N.useMemo(()=>({id:d,initial:e,isPresent:t,custom:i,onExitComplete:h,register:p=>(c.set(p,!1),()=>c.delete(p))}),r?[Math.random(),h]:[t,h]);return N.useMemo(()=>{c.forEach((p,f)=>c.set(f,!1))},[t]),N.useEffect(()=>{!t&&!c.size&&s&&s()},[t]),o==="popLayout"&&(n=a.jsx(ose,{isPresent:t,children:n})),a.jsx($L.Provider,{value:u,children:n})};function cse(){return new Map}function FG(n=!0){const e=N.useContext($L);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:i}=e,r=N.useId();N.useEffect(()=>{n&&i(r)},[n]);const o=N.useCallback(()=>n&&s&&s(r),[r,s,n]);return!t&&s?[!1,o]:[!0]}const gk=n=>n.key||"";function LB(n){const e=[];return N.Children.forEach(n,t=>{N.isValidElement(t)&&e.push(t)}),e}const S5=typeof window<"u",OG=S5?N.useLayoutEffect:N.useEffect,Ie=({children:n,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:r="sync",propagate:o=!1})=>{const[c,d]=FG(o),h=N.useMemo(()=>LB(n),[n]),u=o&&!c?[]:h.map(gk),p=N.useRef(!0),f=N.useRef(h),m=v5(()=>new Map),[x,g]=N.useState(h),[b,y]=N.useState(h);OG(()=>{p.current=!1,f.current=h;for(let S=0;S<b.length;S++){const j=gk(b[S]);u.includes(j)?m.delete(j):m.get(j)!==!0&&m.set(j,!1)}},[b,u.length,u.join("-")]);const C=[];if(h!==x){let S=[...h];for(let j=0;j<b.length;j++){const T=b[j],k=gk(T);u.includes(k)||(S.splice(j,0,T),C.push(T))}r==="wait"&&C.length&&(S=C),y(LB(S)),g(h);return}const{forceRender:w}=N.useContext(b5);return a.jsx(a.Fragment,{children:b.map(S=>{const j=gk(S),T=o&&!c?!1:h===b||u.includes(j),k=()=>{if(m.has(j))m.set(j,!0);else return;let _=!0;m.forEach(L=>{L||(_=!1)}),_&&(w==null||w(),y(f.current),o&&(d==null||d()),s&&s())};return a.jsx(lse,{isPresent:T,initial:!p.current||t?void 0:!1,custom:T?void 0:e,presenceAffectsLayout:i,mode:r,onExitComplete:T?void 0:k,children:S},j)})})},yo=n=>n;let BG=yo;function C5(n){let e;return()=>(e===void 0&&(e=n()),e)}const k1=(n,e,t)=>{const s=e-n;return s===0?1:(t-n)/s},Su=n=>n*1e3,Cu=n=>n/1e3,dse={useManualTiming:!1};function hse(n){let e=new Set,t=new Set,s=!1,i=!1;const r=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function c(h){r.has(h)&&(d.schedule(h),n()),h(o)}const d={schedule:(h,u=!1,p=!1)=>{const m=p&&s?e:t;return u&&r.add(h),m.has(h)||m.add(h),h},cancel:h=>{t.delete(h),r.delete(h)},process:h=>{if(o=h,s){i=!0;return}s=!0,[e,t]=[t,e],e.forEach(c),e.clear(),s=!1,i&&(i=!1,d.process(h))}};return d}const xk=["read","resolveKeyframes","update","preRender","render","postRender"],use=40;function $G(n,e){let t=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},r=()=>t=!0,o=xk.reduce((y,C)=>(y[C]=hse(r),y),{}),{read:c,resolveKeyframes:d,update:h,preRender:u,render:p,postRender:f}=o,m=()=>{const y=performance.now();t=!1,i.delta=s?1e3/60:Math.max(Math.min(y-i.timestamp,use),1),i.timestamp=y,i.isProcessing=!0,c.process(i),d.process(i),h.process(i),u.process(i),p.process(i),f.process(i),i.isProcessing=!1,t&&e&&(s=!1,n(m))},x=()=>{t=!0,s=!0,i.isProcessing||n(m)};return{schedule:xk.reduce((y,C)=>{const w=o[C];return y[C]=(S,j=!1,T=!1)=>(t||x(),w.schedule(S,j,T)),y},{}),cancel:y=>{for(let C=0;C<xk.length;C++)o[xk[C]].cancel(y)},state:i,steps:o}}const{schedule:Ms,cancel:cm,state:Bi,steps:QD}=$G(typeof requestAnimationFrame<"u"?requestAnimationFrame:yo,!0),UG=N.createContext({strict:!1}),DB={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},T1={};for(const n in DB)T1[n]={isEnabled:e=>DB[n].some(t=>!!e[t])};function pse(n){for(const e in n)T1[e]={...T1[e],...n[e]}}const fse=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function iP(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||fse.has(n)}let zG=n=>!iP(n);function mse(n){n&&(zG=e=>e.startsWith("on")?!iP(e):n(e))}try{mse(require("@emotion/is-prop-valid").default)}catch{}function gse(n,e,t){const s={};for(const i in n)i==="values"&&typeof n.values=="object"||(zG(i)||t===!0&&iP(i)||!e&&!iP(i)||n.draggable&&i.startsWith("onDrag"))&&(s[i]=n[i]);return s}function xse(n){if(typeof Proxy>"u")return n;const e=new Map,t=(...s)=>n(...s);return new Proxy(t,{get:(s,i)=>i==="create"?n:(e.has(i)||e.set(i,n(i)),e.get(i))})}const UL=N.createContext({});function bN(n){return typeof n=="string"||Array.isArray(n)}function zL(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const N5=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],j5=["initial",...N5];function HL(n){return zL(n.animate)||j5.some(e=>bN(n[e]))}function HG(n){return!!(HL(n)||n.variants)}function yse(n,e){if(HL(n)){const{initial:t,animate:s}=n;return{initial:t===!1||bN(t)?t:void 0,animate:bN(s)?s:void 0}}return n.inherit!==!1?e:{}}function bse(n){const{initial:e,animate:t}=yse(n,N.useContext(UL));return N.useMemo(()=>({initial:e,animate:t}),[RB(e),RB(t)])}function RB(n){return Array.isArray(n)?n.join(" "):n}const vse=Symbol.for("motionComponentSymbol");function Xy(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function wse(n,e,t){return N.useCallback(s=>{s&&n.onMount&&n.onMount(s),e&&(s?e.mount(s):e.unmount()),t&&(typeof t=="function"?t(s):Xy(t)&&(t.current=s))},[e])}const A5=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Sse="framerAppearId",VG="data-"+A5(Sse),{schedule:E5}=$G(queueMicrotask,!1),GG=N.createContext({});function Cse(n,e,t,s,i){var r,o;const{visualElement:c}=N.useContext(UL),d=N.useContext(UG),h=N.useContext($L),u=N.useContext(w5).reducedMotion,p=N.useRef(null);s=s||d.renderer,!p.current&&s&&(p.current=s(n,{visualState:e,parent:c,props:t,presenceContext:h,blockInitialAnimation:h?h.initial===!1:!1,reducedMotionConfig:u}));const f=p.current,m=N.useContext(GG);f&&!f.projection&&i&&(f.type==="html"||f.type==="svg")&&Nse(p.current,t,i,m);const x=N.useRef(!1);N.useInsertionEffect(()=>{f&&x.current&&f.update(t,h)});const g=t[VG],b=N.useRef(!!g&&!(!((r=window.MotionHandoffIsComplete)===null||r===void 0)&&r.call(window,g))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,g)));return OG(()=>{f&&(x.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),E5.render(f.render),b.current&&f.animationState&&f.animationState.animateChanges())}),N.useEffect(()=>{f&&(!b.current&&f.animationState&&f.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{var y;(y=window.MotionHandoffMarkAsComplete)===null||y===void 0||y.call(window,g)}),b.current=!1))}),f}function Nse(n,e,t,s){const{layoutId:i,layout:r,drag:o,dragConstraints:c,layoutScroll:d,layoutRoot:h}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:WG(n.parent)),n.projection.setOptions({layoutId:i,layout:r,alwaysMeasureLayout:!!o||c&&Xy(c),visualElement:n,animationType:typeof r=="string"?r:"both",initialPromotionConfig:s,layoutScroll:d,layoutRoot:h})}function WG(n){if(n)return n.options.allowProjection!==!1?n.projection:WG(n.parent)}function jse({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:s,Component:i}){var r,o;n&&pse(n);function c(h,u){let p;const f={...N.useContext(w5),...h,layoutId:Ase(h)},{isStatic:m}=f,x=bse(h),g=s(h,m);if(!m&&S5){Ese();const b=kse(f);p=b.MeasureLayout,x.visualElement=Cse(i,g,f,e,b.ProjectionNode)}return a.jsxs(UL.Provider,{value:x,children:[p&&x.visualElement?a.jsx(p,{visualElement:x.visualElement,...f}):null,t(i,h,wse(g,x.visualElement,u),g,m,x.visualElement)]})}c.displayName=`motion.${typeof i=="string"?i:`create(${(o=(r=i.displayName)!==null&&r!==void 0?r:i.name)!==null&&o!==void 0?o:""})`}`;const d=N.forwardRef(c);return d[vse]=i,d}function Ase({layoutId:n}){const e=N.useContext(b5).id;return e&&n!==void 0?e+"-"+n:n}function Ese(n,e){N.useContext(UG).strict}function kse(n){const{drag:e,layout:t}=T1;if(!e&&!t)return{};const s={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(n)||t!=null&&t.isEnabled(n)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const Tse=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function k5(n){return typeof n!="string"||n.includes("-")?!1:!!(Tse.indexOf(n)>-1||/[A-Z]/u.test(n))}function IB(n){const e=[{},{}];return n==null||n.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function T5(n,e,t,s){if(typeof e=="function"){const[i,r]=IB(s);e=e(t!==void 0?t:n.custom,i,r)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[i,r]=IB(s);e=e(t!==void 0?t:n.custom,i,r)}return e}const qI=n=>Array.isArray(n),_se=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),Pse=n=>qI(n)?n[n.length-1]||0:n,wr=n=>!!(n&&n.getVelocity);function rT(n){const e=wr(n)?n.get():n;return _se(e)?e.toValue():e}function Lse({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:t},s,i,r){const o={latestValues:Dse(s,i,r,n),renderState:e()};return t&&(o.onMount=c=>t({props:s,current:c,...o}),o.onUpdate=c=>t(c)),o}const qG=n=>(e,t)=>{const s=N.useContext(UL),i=N.useContext($L),r=()=>Lse(n,e,s,i);return t?r():v5(r)};function Dse(n,e,t,s){const i={},r=s(n,{});for(const f in r)i[f]=rT(r[f]);let{initial:o,animate:c}=n;const d=HL(n),h=HG(n);e&&h&&!d&&n.inherit!==!1&&(o===void 0&&(o=e.initial),c===void 0&&(c=e.animate));let u=t?t.initial===!1:!1;u=u||o===!1;const p=u?c:o;if(p&&typeof p!="boolean"&&!zL(p)){const f=Array.isArray(p)?p:[p];for(let m=0;m<f.length;m++){const x=T5(n,f[m]);if(x){const{transitionEnd:g,transition:b,...y}=x;for(const C in y){let w=y[C];if(Array.isArray(w)){const S=u?w.length-1:0;w=w[S]}w!==null&&(i[C]=w)}for(const C in g)i[C]=g[C]}}}return i}const q1=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],sy=new Set(q1),YG=n=>e=>typeof e=="string"&&e.startsWith(n),XG=YG("--"),Rse=YG("var(--"),_5=n=>Rse(n)?Ise.test(n.split("/*")[0].trim()):!1,Ise=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,KG=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Du=(n,e,t)=>t>e?e:t<n?n:t,Y1={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},vN={...Y1,transform:n=>Du(0,1,n)},yk={...Y1,default:1},xE=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Ju=xE("deg"),Ad=xE("%"),We=xE("px"),Mse=xE("vh"),Fse=xE("vw"),MB={...Ad,parse:n=>Ad.parse(n)/100,transform:n=>Ad.transform(n*100)},Ose={borderWidth:We,borderTopWidth:We,borderRightWidth:We,borderBottomWidth:We,borderLeftWidth:We,borderRadius:We,radius:We,borderTopLeftRadius:We,borderTopRightRadius:We,borderBottomRightRadius:We,borderBottomLeftRadius:We,width:We,maxWidth:We,height:We,maxHeight:We,top:We,right:We,bottom:We,left:We,padding:We,paddingTop:We,paddingRight:We,paddingBottom:We,paddingLeft:We,margin:We,marginTop:We,marginRight:We,marginBottom:We,marginLeft:We,backgroundPositionX:We,backgroundPositionY:We},Bse={rotate:Ju,rotateX:Ju,rotateY:Ju,rotateZ:Ju,scale:yk,scaleX:yk,scaleY:yk,scaleZ:yk,skew:Ju,skewX:Ju,skewY:Ju,distance:We,translateX:We,translateY:We,translateZ:We,x:We,y:We,z:We,perspective:We,transformPerspective:We,opacity:vN,originX:MB,originY:MB,originZ:We},FB={...Y1,transform:Math.round},P5={...Ose,...Bse,zIndex:FB,size:We,fillOpacity:vN,strokeOpacity:vN,numOctaves:FB},$se={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Use=q1.length;function zse(n,e,t){let s="",i=!0;for(let r=0;r<Use;r++){const o=q1[r],c=n[o];if(c===void 0)continue;let d=!0;if(typeof c=="number"?d=c===(o.startsWith("scale")?1:0):d=parseFloat(c)===0,!d||t){const h=KG(c,P5[o]);if(!d){i=!1;const u=$se[o]||o;s+=`${u}(${h}) `}t&&(e[o]=h)}}return s=s.trim(),t?s=t(e,i?"":s):i&&(s="none"),s}function L5(n,e,t){const{style:s,vars:i,transformOrigin:r}=n;let o=!1,c=!1;for(const d in e){const h=e[d];if(sy.has(d)){o=!0;continue}else if(XG(d)){i[d]=h;continue}else{const u=KG(h,P5[d]);d.startsWith("origin")?(c=!0,r[d]=u):s[d]=u}}if(e.transform||(o||t?s.transform=zse(e,n.transform,t):s.transform&&(s.transform="none")),c){const{originX:d="50%",originY:h="50%",originZ:u=0}=r;s.transformOrigin=`${d} ${h} ${u}`}}const Hse={offset:"stroke-dashoffset",array:"stroke-dasharray"},Vse={offset:"strokeDashoffset",array:"strokeDasharray"};function Gse(n,e,t=1,s=0,i=!0){n.pathLength=1;const r=i?Hse:Vse;n[r.offset]=We.transform(-s);const o=We.transform(e),c=We.transform(t);n[r.array]=`${o} ${c}`}function OB(n,e,t){return typeof n=="string"?n:We.transform(e+t*n)}function Wse(n,e,t){const s=OB(e,n.x,n.width),i=OB(t,n.y,n.height);return`${s} ${i}`}function D5(n,{attrX:e,attrY:t,attrScale:s,originX:i,originY:r,pathLength:o,pathSpacing:c=1,pathOffset:d=0,...h},u,p){if(L5(n,h,p),u){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:f,style:m,dimensions:x}=n;f.transform&&(x&&(m.transform=f.transform),delete f.transform),x&&(i!==void 0||r!==void 0||m.transform)&&(m.transformOrigin=Wse(x,i!==void 0?i:.5,r!==void 0?r:.5)),e!==void 0&&(f.x=e),t!==void 0&&(f.y=t),s!==void 0&&(f.scale=s),o!==void 0&&Gse(f,o,c,d,!1)}const R5=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),QG=()=>({...R5(),attrs:{}}),I5=n=>typeof n=="string"&&n.toLowerCase()==="svg";function JG(n,{style:e,vars:t},s,i){Object.assign(n.style,e,i&&i.getProjectionStyles(s));for(const r in t)n.style.setProperty(r,t[r])}const ZG=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function e7(n,e,t,s){JG(n,e,void 0,s);for(const i in e.attrs)n.setAttribute(ZG.has(i)?i:A5(i),e.attrs[i])}const rP={};function qse(n){Object.assign(rP,n)}function t7(n,{layout:e,layoutId:t}){return sy.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!rP[n]||n==="opacity")}function M5(n,e,t){var s;const{style:i}=n,r={};for(const o in i)(wr(i[o])||e.style&&wr(e.style[o])||t7(o,n)||((s=t==null?void 0:t.getValue(o))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(r[o]=i[o]);return r}function s7(n,e,t){const s=M5(n,e,t);for(const i in n)if(wr(n[i])||wr(e[i])){const r=q1.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[r]=n[i]}return s}function Yse(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const BB=["x","y","width","height","cx","cy","r"],Xse={useVisualState:qG({scrapeMotionValuesFromProps:s7,createRenderState:QG,onUpdate:({props:n,prevProps:e,current:t,renderState:s,latestValues:i})=>{if(!t)return;let r=!!n.drag;if(!r){for(const c in i)if(sy.has(c)){r=!0;break}}if(!r)return;let o=!e;if(e)for(let c=0;c<BB.length;c++){const d=BB[c];n[d]!==e[d]&&(o=!0)}o&&Ms.read(()=>{Yse(t,s),Ms.render(()=>{D5(s,i,I5(t.tagName),n.transformTemplate),e7(t,s)})})}})},Kse={useVisualState:qG({scrapeMotionValuesFromProps:M5,createRenderState:R5})};function n7(n,e,t){for(const s in e)!wr(e[s])&&!t7(s,t)&&(n[s]=e[s])}function Qse({transformTemplate:n},e){return N.useMemo(()=>{const t=R5();return L5(t,e,n),Object.assign({},t.vars,t.style)},[e])}function Jse(n,e){const t=n.style||{},s={};return n7(s,t,n),Object.assign(s,Qse(n,e)),s}function Zse(n,e){const t={},s=Jse(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=s,t}function ene(n,e,t,s){const i=N.useMemo(()=>{const r=QG();return D5(r,e,I5(s),n.transformTemplate),{...r.attrs,style:{...r.style}}},[e]);if(n.style){const r={};n7(r,n.style,n),i.style={...r,...i.style}}return i}function tne(n=!1){return(t,s,i,{latestValues:r},o)=>{const d=(k5(t)?ene:Zse)(s,r,o,t),h=gse(s,typeof t=="string",n),u=t!==N.Fragment?{...h,...d,ref:i}:{},{children:p}=s,f=N.useMemo(()=>wr(p)?p.get():p,[p]);return N.createElement(t,{...u,children:f})}}function sne(n,e){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){const o={...k5(s)?Xse:Kse,preloadedFeatures:n,useRender:tne(i),createVisualElement:e,Component:s};return jse(o)}}function i7(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let s=0;s<t;s++)if(e[s]!==n[s])return!1;return!0}function VL(n,e,t){const s=n.getProps();return T5(s,e,t!==void 0?t:s.custom,n)}const nne=C5(()=>window.ScrollTimeline!==void 0);class ine{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=t}attachTimeline(e,t){const s=this.animations.map(i=>{if(nne()&&i.attachTimeline)return i.attachTimeline(e);if(typeof t=="function")return t(i)});return()=>{s.forEach((i,r)=>{i&&i(),this.animations[r].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class rne extends ine{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function F5(n,e){return n?n[e]||n.default||n:void 0}const YI=2e4;function r7(n){let e=0;const t=50;let s=n.next(e);for(;!s.done&&e<YI;)e+=t,s=n.next(e);return e>=YI?1/0:e}function O5(n){return typeof n=="function"}function $B(n,e){n.timeline=e,n.onfinish=null}const B5=n=>Array.isArray(n)&&typeof n[0]=="number",ane={linearEasing:void 0};function one(n,e){const t=C5(n);return()=>{var s;return(s=ane[e])!==null&&s!==void 0?s:t()}}const aP=one(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),a7=(n,e,t=10)=>{let s="";const i=Math.max(Math.round(e/t),2);for(let r=0;r<i;r++)s+=n(k1(0,i-1,r))+", ";return`linear(${s.substring(0,s.length-2)})`};function o7(n){return!!(typeof n=="function"&&aP()||!n||typeof n=="string"&&(n in XI||aP())||B5(n)||Array.isArray(n)&&n.every(o7))}const zS=([n,e,t,s])=>`cubic-bezier(${n}, ${e}, ${t}, ${s})`,XI={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:zS([0,.65,.55,1]),circOut:zS([.55,0,1,.45]),backIn:zS([.31,.01,.66,-.59]),backOut:zS([.33,1.53,.69,.99])};function l7(n,e){if(n)return typeof n=="function"&&aP()?a7(n,e):B5(n)?zS(n):Array.isArray(n)?n.map(t=>l7(t,e)||XI.easeOut):XI[n]}const Al={x:!1,y:!1};function c7(){return Al.x||Al.y}function d7(n,e,t){var s;if(n instanceof Element)return[n];if(typeof n=="string"){let i=document;const r=(s=void 0)!==null&&s!==void 0?s:i.querySelectorAll(n);return r?Array.from(r):[]}return Array.from(n)}function h7(n,e){const t=d7(n),s=new AbortController,i={passive:!0,...e,signal:s.signal};return[t,i,()=>s.abort()]}function UB(n){return e=>{e.pointerType==="touch"||c7()||n(e)}}function lne(n,e,t={}){const[s,i,r]=h7(n,t),o=UB(c=>{const{target:d}=c,h=e(c);if(typeof h!="function"||!d)return;const u=UB(p=>{h(p),d.removeEventListener("pointerleave",u)});d.addEventListener("pointerleave",u,i)});return s.forEach(c=>{c.addEventListener("pointerenter",o,i)}),r}const u7=(n,e)=>e?n===e?!0:u7(n,e.parentElement):!1,$5=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,cne=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function dne(n){return cne.has(n.tagName)||n.tabIndex!==-1}const HS=new WeakSet;function zB(n){return e=>{e.key==="Enter"&&n(e)}}function JD(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const hne=(n,e)=>{const t=n.currentTarget;if(!t)return;const s=zB(()=>{if(HS.has(t))return;JD(t,"down");const i=zB(()=>{JD(t,"up")}),r=()=>JD(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",r,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function HB(n){return $5(n)&&!c7()}function une(n,e,t={}){const[s,i,r]=h7(n,t),o=c=>{const d=c.currentTarget;if(!HB(c)||HS.has(d))return;HS.add(d);const h=e(c),u=(m,x)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",f),!(!HB(m)||!HS.has(d))&&(HS.delete(d),typeof h=="function"&&h(m,{success:x}))},p=m=>{u(m,t.useGlobalTarget||u7(d,m.target))},f=m=>{u(m,!1)};window.addEventListener("pointerup",p,i),window.addEventListener("pointercancel",f,i)};return s.forEach(c=>{!dne(c)&&c.getAttribute("tabindex")===null&&(c.tabIndex=0),(t.useGlobalTarget?window:c).addEventListener("pointerdown",o,i),c.addEventListener("focus",h=>hne(h,i),i)}),r}function pne(n){return n==="x"||n==="y"?Al[n]?null:(Al[n]=!0,()=>{Al[n]=!1}):Al.x||Al.y?null:(Al.x=Al.y=!0,()=>{Al.x=Al.y=!1})}const p7=new Set(["width","height","top","left","right","bottom",...q1]);let aT;function fne(){aT=void 0}const Ed={now:()=>(aT===void 0&&Ed.set(Bi.isProcessing||dse.useManualTiming?Bi.timestamp:performance.now()),aT),set:n=>{aT=n,queueMicrotask(fne)}};function U5(n,e){n.indexOf(e)===-1&&n.push(e)}function z5(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class H5{constructor(){this.subscriptions=[]}add(e){return U5(this.subscriptions,e),()=>z5(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,s);else for(let r=0;r<i;r++){const o=this.subscriptions[r];o&&o(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function f7(n,e){return e?n*(1e3/e):0}const VB=30,mne=n=>!isNaN(parseFloat(n));class gne{constructor(e,t={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,i=!0)=>{const r=Ed.now();this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Ed.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=mne(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new H5);const s=this.events[e].add(t);return e==="change"?()=>{s(),Ms.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ed.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>VB)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,VB);return f7(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wN(n,e){return new gne(n,e)}function xne(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,wN(t))}function yne(n,e){const t=VL(n,e);let{transitionEnd:s={},transition:i={},...r}=t||{};r={...r,...s};for(const o in r){const c=Pse(r[o]);xne(n,o,c)}}function bne(n){return!!(wr(n)&&n.add)}function KI(n,e){const t=n.getValue("willChange");if(bne(t))return t.add(e)}function m7(n){return n.props[VG]}const g7=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,vne=1e-7,wne=12;function Sne(n,e,t,s,i){let r,o,c=0;do o=e+(t-e)/2,r=g7(o,s,i)-n,r>0?t=o:e=o;while(Math.abs(r)>vne&&++c<wne);return o}function yE(n,e,t,s){if(n===e&&t===s)return yo;const i=r=>Sne(r,0,1,n,t);return r=>r===0||r===1?r:g7(i(r),e,s)}const x7=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,y7=n=>e=>1-n(1-e),b7=yE(.33,1.53,.69,.99),V5=y7(b7),v7=x7(V5),w7=n=>(n*=2)<1?.5*V5(n):.5*(2-Math.pow(2,-10*(n-1))),G5=n=>1-Math.sin(Math.acos(n)),S7=y7(G5),C7=x7(G5),N7=n=>/^0[^.\s]+$/u.test(n);function Cne(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||N7(n):!0}const HC=n=>Math.round(n*1e5)/1e5,W5=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Nne(n){return n==null}const jne=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,q5=(n,e)=>t=>!!(typeof t=="string"&&jne.test(t)&&t.startsWith(n)||e&&!Nne(t)&&Object.prototype.hasOwnProperty.call(t,e)),j7=(n,e,t)=>s=>{if(typeof s!="string")return s;const[i,r,o,c]=s.match(W5);return{[n]:parseFloat(i),[e]:parseFloat(r),[t]:parseFloat(o),alpha:c!==void 0?parseFloat(c):1}},Ane=n=>Du(0,255,n),ZD={...Y1,transform:n=>Math.round(Ane(n))},sg={test:q5("rgb","red"),parse:j7("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:s=1})=>"rgba("+ZD.transform(n)+", "+ZD.transform(e)+", "+ZD.transform(t)+", "+HC(vN.transform(s))+")"};function Ene(n){let e="",t="",s="",i="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),s=n.substring(5,7),i=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),s=n.substring(3,4),i=n.substring(4,5),e+=e,t+=t,s+=s,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const QI={test:q5("#"),parse:Ene,transform:sg.transform},Ky={test:q5("hsl","hue"),parse:j7("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(n)+", "+Ad.transform(HC(e))+", "+Ad.transform(HC(t))+", "+HC(vN.transform(s))+")"},mr={test:n=>sg.test(n)||QI.test(n)||Ky.test(n),parse:n=>sg.test(n)?sg.parse(n):Ky.test(n)?Ky.parse(n):QI.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?sg.transform(n):Ky.transform(n)},kne=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Tne(n){var e,t;return isNaN(n)&&typeof n=="string"&&(((e=n.match(W5))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(kne))===null||t===void 0?void 0:t.length)||0)>0}const A7="number",E7="color",_ne="var",Pne="var(",GB="${}",Lne=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function SN(n){const e=n.toString(),t=[],s={color:[],number:[],var:[]},i=[];let r=0;const c=e.replace(Lne,d=>(mr.test(d)?(s.color.push(r),i.push(E7),t.push(mr.parse(d))):d.startsWith(Pne)?(s.var.push(r),i.push(_ne),t.push(d)):(s.number.push(r),i.push(A7),t.push(parseFloat(d))),++r,GB)).split(GB);return{values:t,split:c,indexes:s,types:i}}function k7(n){return SN(n).values}function T7(n){const{split:e,types:t}=SN(n),s=e.length;return i=>{let r="";for(let o=0;o<s;o++)if(r+=e[o],i[o]!==void 0){const c=t[o];c===A7?r+=HC(i[o]):c===E7?r+=mr.transform(i[o]):r+=i[o]}return r}}const Dne=n=>typeof n=="number"?0:n;function Rne(n){const e=k7(n);return T7(n)(e.map(Dne))}const dm={test:Tne,parse:k7,createTransformer:T7,getAnimatableNone:Rne},Ine=new Set(["brightness","contrast","saturate","opacity"]);function Mne(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[s]=t.match(W5)||[];if(!s)return n;const i=t.replace(s,"");let r=Ine.has(e)?1:0;return s!==t&&(r*=100),e+"("+r+i+")"}const Fne=/\b([a-z-]*)\(.*?\)/gu,JI={...dm,getAnimatableNone:n=>{const e=n.match(Fne);return e?e.map(Mne).join(" "):n}},One={...P5,color:mr,backgroundColor:mr,outlineColor:mr,fill:mr,stroke:mr,borderColor:mr,borderTopColor:mr,borderRightColor:mr,borderBottomColor:mr,borderLeftColor:mr,filter:JI,WebkitFilter:JI},Y5=n=>One[n];function _7(n,e){let t=Y5(n);return t!==JI&&(t=dm),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const Bne=new Set(["auto","none","0"]);function $ne(n,e,t){let s=0,i;for(;s<n.length&&!i;){const r=n[s];typeof r=="string"&&!Bne.has(r)&&SN(r).values.length&&(i=n[s]),s++}if(i&&t)for(const r of e)n[r]=_7(t,i)}const WB=n=>n===Y1||n===We,qB=(n,e)=>parseFloat(n.split(", ")[e]),YB=(n,e)=>(t,{transform:s})=>{if(s==="none"||!s)return 0;const i=s.match(/^matrix3d\((.+)\)$/u);if(i)return qB(i[1],e);{const r=s.match(/^matrix\((.+)\)$/u);return r?qB(r[1],n):0}},Une=new Set(["x","y","z"]),zne=q1.filter(n=>!Une.has(n));function Hne(n){const e=[];return zne.forEach(t=>{const s=n.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const _1={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:YB(4,13),y:YB(5,14)};_1.translateX=_1.x;_1.translateY=_1.y;const M0=new Set;let ZI=!1,eM=!1;function P7(){if(eM){const n=Array.from(M0).filter(s=>s.needsMeasurement),e=new Set(n.map(s=>s.element)),t=new Map;e.forEach(s=>{const i=Hne(s);i.length&&(t.set(s,i),s.render())}),n.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const i=t.get(s);i&&i.forEach(([r,o])=>{var c;(c=s.getValue(r))===null||c===void 0||c.set(o)})}),n.forEach(s=>s.measureEndState()),n.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}eM=!1,ZI=!1,M0.forEach(n=>n.complete()),M0.clear()}function L7(){M0.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(eM=!0)})}function Vne(){L7(),P7()}class X5{constructor(e,t,s,i,r,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=r,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(M0.add(this),ZI||(ZI=!0,Ms.read(L7),Ms.resolveKeyframes(P7))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;for(let r=0;r<e.length;r++)if(e[r]===null)if(r===0){const o=i==null?void 0:i.get(),c=e[e.length-1];if(o!==void 0)e[0]=o;else if(s&&t){const d=s.readValue(t,c);d!=null&&(e[0]=d)}e[0]===void 0&&(e[0]=c),i&&o===void 0&&i.set(e[0])}else e[r]=e[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),M0.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,M0.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const D7=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),Gne=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Wne(n){const e=Gne.exec(n);if(!e)return[,];const[,t,s,i]=e;return[`--${t??s}`,i]}function R7(n,e,t=1){const[s,i]=Wne(n);if(!s)return;const r=window.getComputedStyle(e).getPropertyValue(s);if(r){const o=r.trim();return D7(o)?parseFloat(o):o}return _5(i)?R7(i,e,t+1):i}const I7=n=>e=>e.test(n),qne={test:n=>n==="auto",parse:n=>n},M7=[Y1,We,Ad,Ju,Fse,Mse,qne],XB=n=>M7.find(I7(n));class F7 extends X5{constructor(e,t,s,i,r){super(e,t,s,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let d=0;d<e.length;d++){let h=e[d];if(typeof h=="string"&&(h=h.trim(),_5(h))){const u=R7(h,t.current);u!==void 0&&(e[d]=u),d===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!p7.has(s)||e.length!==2)return;const[i,r]=e,o=XB(i),c=XB(r);if(o!==c)if(WB(o)&&WB(c))for(let d=0;d<e.length;d++){const h=e[d];typeof h=="string"&&(e[d]=parseFloat(h))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let i=0;i<e.length;i++)Cne(e[i])&&s.push(i);s.length&&$ne(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=_1[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(s,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:s,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(s);r&&r.jump(this.measuredOrigin,!1);const o=i.length-1,c=i[o];i[o]=_1[s](t.measureViewportBox(),window.getComputedStyle(t.current)),c!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=c),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([d,h])=>{t.getValue(d).set(h)}),this.resolveNoneKeyframes()}}const KB=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(dm.test(n)||n==="0")&&!n.startsWith("url("));function Yne(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function Xne(n,e,t,s){const i=n[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const r=n[n.length-1],o=KB(i,e),c=KB(r,e);return!o||!c?!1:Yne(n)||(t==="spring"||O5(t))&&s}const Kne=n=>n!==null;function GL(n,{repeat:e,repeatType:t="loop"},s){const i=n.filter(Kne),r=e&&t!=="loop"&&e%2===1?0:i.length-1;return!r||s===void 0?i[r]:s}const Qne=40;class O7{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:o="loop",...c}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Ed.now(),this.options={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:r,repeatType:o,...c},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Qne?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Vne(),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=Ed.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:r,delay:o,onComplete:c,onUpdate:d,isGenerator:h}=this.options;if(!h&&!Xne(e,s,i,r))if(o)this.options.duration=0;else{d&&d(GL(e,this.options,t)),c&&c(),this.resolveFinishedPromise();return}const u=this.initPlayback(e,t);u!==!1&&(this._resolved={keyframes:e,finalKeyframe:t,...u},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const sn=(n,e,t)=>n+(e-n)*t;function eR(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function Jne({hue:n,saturation:e,lightness:t,alpha:s}){n/=360,e/=100,t/=100;let i=0,r=0,o=0;if(!e)i=r=o=t;else{const c=t<.5?t*(1+e):t+e-t*e,d=2*t-c;i=eR(d,c,n+1/3),r=eR(d,c,n),o=eR(d,c,n-1/3)}return{red:Math.round(i*255),green:Math.round(r*255),blue:Math.round(o*255),alpha:s}}function oP(n,e){return t=>t>0?e:n}const tR=(n,e,t)=>{const s=n*n,i=t*(e*e-s)+s;return i<0?0:Math.sqrt(i)},Zne=[QI,sg,Ky],eie=n=>Zne.find(e=>e.test(n));function QB(n){const e=eie(n);if(!e)return!1;let t=e.parse(n);return e===Ky&&(t=Jne(t)),t}const JB=(n,e)=>{const t=QB(n),s=QB(e);if(!t||!s)return oP(n,e);const i={...t};return r=>(i.red=tR(t.red,s.red,r),i.green=tR(t.green,s.green,r),i.blue=tR(t.blue,s.blue,r),i.alpha=sn(t.alpha,s.alpha,r),sg.transform(i))},tie=(n,e)=>t=>e(n(t)),bE=(...n)=>n.reduce(tie),tM=new Set(["none","hidden"]);function sie(n,e){return tM.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function nie(n,e){return t=>sn(n,e,t)}function K5(n){return typeof n=="number"?nie:typeof n=="string"?_5(n)?oP:mr.test(n)?JB:aie:Array.isArray(n)?B7:typeof n=="object"?mr.test(n)?JB:iie:oP}function B7(n,e){const t=[...n],s=t.length,i=n.map((r,o)=>K5(r)(r,e[o]));return r=>{for(let o=0;o<s;o++)t[o]=i[o](r);return t}}function iie(n,e){const t={...n,...e},s={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(s[i]=K5(n[i])(n[i],e[i]));return i=>{for(const r in s)t[r]=s[r](i);return t}}function rie(n,e){var t;const s=[],i={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const o=e.types[r],c=n.indexes[o][i[o]],d=(t=n.values[c])!==null&&t!==void 0?t:0;s[r]=d,i[o]++}return s}const aie=(n,e)=>{const t=dm.createTransformer(e),s=SN(n),i=SN(e);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?tM.has(n)&&!i.values.length||tM.has(e)&&!s.values.length?sie(n,e):bE(B7(rie(s,i),i.values),t):oP(n,e)};function $7(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?sn(n,e,t):K5(n)(n,e)}const oie=5;function U7(n,e,t){const s=Math.max(e-oie,0);return f7(t-n(s),e-s)}const yn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},sR=.001;function lie({duration:n=yn.duration,bounce:e=yn.bounce,velocity:t=yn.velocity,mass:s=yn.mass}){let i,r,o=1-e;o=Du(yn.minDamping,yn.maxDamping,o),n=Du(yn.minDuration,yn.maxDuration,Cu(n)),o<1?(i=h=>{const u=h*o,p=u*n,f=u-t,m=sM(h,o),x=Math.exp(-p);return sR-f/m*x},r=h=>{const p=h*o*n,f=p*t+t,m=Math.pow(o,2)*Math.pow(h,2)*n,x=Math.exp(-p),g=sM(Math.pow(h,2),o);return(-i(h)+sR>0?-1:1)*((f-m)*x)/g}):(i=h=>{const u=Math.exp(-h*n),p=(h-t)*n+1;return-sR+u*p},r=h=>{const u=Math.exp(-h*n),p=(t-h)*(n*n);return u*p});const c=5/n,d=die(i,r,c);if(n=Su(n),isNaN(d))return{stiffness:yn.stiffness,damping:yn.damping,duration:n};{const h=Math.pow(d,2)*s;return{stiffness:h,damping:o*2*Math.sqrt(s*h),duration:n}}}const cie=12;function die(n,e,t){let s=t;for(let i=1;i<cie;i++)s=s-n(s)/e(s);return s}function sM(n,e){return n*Math.sqrt(1-e*e)}const hie=["duration","bounce"],uie=["stiffness","damping","mass"];function ZB(n,e){return e.some(t=>n[t]!==void 0)}function pie(n){let e={velocity:yn.velocity,stiffness:yn.stiffness,damping:yn.damping,mass:yn.mass,isResolvedFromDuration:!1,...n};if(!ZB(n,uie)&&ZB(n,hie))if(n.visualDuration){const t=n.visualDuration,s=2*Math.PI/(t*1.2),i=s*s,r=2*Du(.05,1,1-(n.bounce||0))*Math.sqrt(i);e={...e,mass:yn.mass,stiffness:i,damping:r}}else{const t=lie(n);e={...e,...t,mass:yn.mass},e.isResolvedFromDuration=!0}return e}function z7(n=yn.visualDuration,e=yn.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:s,restDelta:i}=t;const r=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],c={done:!1,value:r},{stiffness:d,damping:h,mass:u,duration:p,velocity:f,isResolvedFromDuration:m}=pie({...t,velocity:-Cu(t.velocity||0)}),x=f||0,g=h/(2*Math.sqrt(d*u)),b=o-r,y=Cu(Math.sqrt(d/u)),C=Math.abs(b)<5;s||(s=C?yn.restSpeed.granular:yn.restSpeed.default),i||(i=C?yn.restDelta.granular:yn.restDelta.default);let w;if(g<1){const j=sM(y,g);w=T=>{const k=Math.exp(-g*y*T);return o-k*((x+g*y*b)/j*Math.sin(j*T)+b*Math.cos(j*T))}}else if(g===1)w=j=>o-Math.exp(-y*j)*(b+(x+y*b)*j);else{const j=y*Math.sqrt(g*g-1);w=T=>{const k=Math.exp(-g*y*T),_=Math.min(j*T,300);return o-k*((x+g*y*b)*Math.sinh(_)+j*b*Math.cosh(_))/j}}const S={calculatedDuration:m&&p||null,next:j=>{const T=w(j);if(m)c.done=j>=p;else{let k=0;g<1&&(k=j===0?Su(x):U7(w,j,T));const _=Math.abs(k)<=s,L=Math.abs(o-T)<=i;c.done=_&&L}return c.value=c.done?o:T,c},toString:()=>{const j=Math.min(r7(S),YI),T=a7(k=>S.next(j*k).value,j,30);return j+"ms "+T}};return S}function e$({keyframes:n,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:r=500,modifyTarget:o,min:c,max:d,restDelta:h=.5,restSpeed:u}){const p=n[0],f={done:!1,value:p},m=_=>c!==void 0&&_<c||d!==void 0&&_>d,x=_=>c===void 0?d:d===void 0||Math.abs(c-_)<Math.abs(d-_)?c:d;let g=t*e;const b=p+g,y=o===void 0?b:o(b);y!==b&&(g=y-p);const C=_=>-g*Math.exp(-_/s),w=_=>y+C(_),S=_=>{const L=C(_),D=w(_);f.done=Math.abs(L)<=h,f.value=f.done?y:D};let j,T;const k=_=>{m(f.value)&&(j=_,T=z7({keyframes:[f.value,x(f.value)],velocity:U7(w,_,f.value),damping:i,stiffness:r,restDelta:h,restSpeed:u}))};return k(0),{calculatedDuration:null,next:_=>{let L=!1;return!T&&j===void 0&&(L=!0,S(_),k(_)),j!==void 0&&_>=j?T.next(_-j):(!L&&S(_),f)}}}const fie=yE(.42,0,1,1),mie=yE(0,0,.58,1),H7=yE(.42,0,.58,1),gie=n=>Array.isArray(n)&&typeof n[0]!="number",xie={linear:yo,easeIn:fie,easeInOut:H7,easeOut:mie,circIn:G5,circInOut:C7,circOut:S7,backIn:V5,backInOut:v7,backOut:b7,anticipate:w7},t$=n=>{if(B5(n)){BG(n.length===4);const[e,t,s,i]=n;return yE(e,t,s,i)}else if(typeof n=="string")return xie[n];return n};function yie(n,e,t){const s=[],i=t||$7,r=n.length-1;for(let o=0;o<r;o++){let c=i(n[o],n[o+1]);if(e){const d=Array.isArray(e)?e[o]||yo:e;c=bE(d,c)}s.push(c)}return s}function bie(n,e,{clamp:t=!0,ease:s,mixer:i}={}){const r=n.length;if(BG(r===e.length),r===1)return()=>e[0];if(r===2&&e[0]===e[1])return()=>e[1];const o=n[0]===n[1];n[0]>n[r-1]&&(n=[...n].reverse(),e=[...e].reverse());const c=yie(e,s,i),d=c.length,h=u=>{if(o&&u<n[0])return e[0];let p=0;if(d>1)for(;p<n.length-2&&!(u<n[p+1]);p++);const f=k1(n[p],n[p+1],u);return c[p](f)};return t?u=>h(Du(n[0],n[r-1],u)):h}function vie(n,e){const t=n[n.length-1];for(let s=1;s<=e;s++){const i=k1(0,e,s);n.push(sn(t,1,i))}}function wie(n){const e=[0];return vie(e,n.length-1),e}function Sie(n,e){return n.map(t=>t*e)}function Cie(n,e){return n.map(()=>e||H7).splice(0,n.length-1)}function lP({duration:n=300,keyframes:e,times:t,ease:s="easeInOut"}){const i=gie(s)?s.map(t$):t$(s),r={done:!1,value:e[0]},o=Sie(t&&t.length===e.length?t:wie(e),n),c=bie(o,e,{ease:Array.isArray(i)?i:Cie(e,i)});return{calculatedDuration:n,next:d=>(r.value=c(d),r.done=d>=n,r)}}const Nie=n=>{const e=({timestamp:t})=>n(t);return{start:()=>Ms.update(e,!0),stop:()=>cm(e),now:()=>Bi.isProcessing?Bi.timestamp:Ed.now()}},jie={decay:e$,inertia:e$,tween:lP,keyframes:lP,spring:z7},Aie=n=>n/100;class Q5 extends O7{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:d}=this.options;d&&d()};const{name:t,motionValue:s,element:i,keyframes:r}=this.options,o=(i==null?void 0:i.KeyframeResolver)||X5,c=(d,h)=>this.onKeyframesResolved(d,h);this.resolver=new o(r,c,t,s,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:r,velocity:o=0}=this.options,c=O5(t)?t:jie[t]||lP;let d,h;c!==lP&&typeof e[0]!="number"&&(d=bE(Aie,$7(e[0],e[1])),e=[0,100]);const u=c({...this.options,keyframes:e});r==="mirror"&&(h=c({...this.options,keyframes:[...e].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=r7(u));const{calculatedDuration:p}=u,f=p+i,m=f*(s+1)-i;return{generator:u,mirroredGenerator:h,mapPercentToKeyframes:d,calculatedDuration:p,resolvedDuration:f,totalDuration:m}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,t=!1){const{resolved:s}=this;if(!s){const{keyframes:_}=this.options;return{done:!0,value:_[_.length-1]}}const{finalKeyframe:i,generator:r,mirroredGenerator:o,mapPercentToKeyframes:c,keyframes:d,calculatedDuration:h,totalDuration:u,resolvedDuration:p}=s;if(this.startTime===null)return r.next(0);const{delay:f,repeat:m,repeatType:x,repeatDelay:g,onUpdate:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),t?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const y=this.currentTime-f*(this.speed>=0?1:-1),C=this.speed>=0?y<0:y>u;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let w=this.currentTime,S=r;if(m){const _=Math.min(this.currentTime,u)/p;let L=Math.floor(_),D=_%1;!D&&_>=1&&(D=1),D===1&&L--,L=Math.min(L,m+1),!!(L%2)&&(x==="reverse"?(D=1-D,g&&(D-=g/p)):x==="mirror"&&(S=o)),w=Du(0,1,D)*p}const j=C?{done:!1,value:d[0]}:S.next(w);c&&(j.value=c(j.value));let{done:T}=j;!C&&h!==null&&(T=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const k=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return k&&i!==void 0&&(j.value=GL(d,this.options,i)),b&&b(j.value),k&&this.finish(),j}get duration(){const{resolved:e}=this;return e?Cu(e.calculatedDuration):0}get time(){return Cu(this.currentTime)}set time(e){e=Su(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Cu(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=Nie,onPlay:t,startTime:s}=this.options;this.driver||(this.driver=e(r=>this.tick(r))),t&&t();const i=this.driver.now();this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=i):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Eie=new Set(["opacity","clipPath","filter","transform"]);function kie(n,e,t,{delay:s=0,duration:i=300,repeat:r=0,repeatType:o="loop",ease:c="easeInOut",times:d}={}){const h={[e]:t};d&&(h.offset=d);const u=l7(c,i);return Array.isArray(u)&&(h.easing=u),n.animate(h,{delay:s,duration:i,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:r+1,direction:o==="reverse"?"alternate":"normal"})}const Tie=C5(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),cP=10,_ie=2e4;function Pie(n){return O5(n.type)||n.type==="spring"||!o7(n.ease)}function Lie(n,e){const t=new Q5({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:n[0]};const i=[];let r=0;for(;!s.done&&r<_ie;)s=t.sample(r),i.push(s.value),r+=cP;return{times:void 0,keyframes:i,duration:r-cP,ease:"linear"}}const V7={anticipate:w7,backInOut:v7,circInOut:C7};function Die(n){return n in V7}class s$ extends O7{constructor(e){super(e);const{name:t,motionValue:s,element:i,keyframes:r}=this.options;this.resolver=new F7(r,(o,c)=>this.onKeyframesResolved(o,c),t,s,i),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:s=300,times:i,ease:r,type:o,motionValue:c,name:d,startTime:h}=this.options;if(!c.owner||!c.owner.current)return!1;if(typeof r=="string"&&aP()&&Die(r)&&(r=V7[r]),Pie(this.options)){const{onComplete:p,onUpdate:f,motionValue:m,element:x,...g}=this.options,b=Lie(e,g);e=b.keyframes,e.length===1&&(e[1]=e[0]),s=b.duration,i=b.times,r=b.ease,o="keyframes"}const u=kie(c.owner.current,d,e,{...this.options,duration:s,times:i,ease:r});return u.startTime=h??this.calcStartTime(),this.pendingTimeline?($B(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:p}=this.options;c.set(GL(e,this.options,t)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:s,times:i,type:o,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Cu(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Cu(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.currentTime=Su(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:t}=this;if(!t)return yo;const{animation:s}=t;$B(s,e)}return yo}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.playState==="finished"&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:s,duration:i,type:r,ease:o,times:c}=e;if(t.playState==="idle"||t.playState==="finished")return;if(this.time){const{motionValue:h,onUpdate:u,onComplete:p,element:f,...m}=this.options,x=new Q5({...m,keyframes:s,duration:i,type:r,ease:o,times:c,isGenerator:!0}),g=Su(this.time);h.setWithVelocity(x.sample(g-cP).value,x.sample(g).value,cP)}const{onStop:d}=this.options;d&&d(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:s,repeatDelay:i,repeatType:r,damping:o,type:c}=e;if(!t||!t.owner||!(t.owner.current instanceof HTMLElement))return!1;const{onUpdate:d,transformTemplate:h}=t.owner.getProps();return Tie()&&s&&Eie.has(s)&&!d&&!h&&!i&&r!=="mirror"&&o!==0&&c!=="inertia"}}const Rie={type:"spring",stiffness:500,damping:25,restSpeed:10},Iie=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),Mie={type:"keyframes",duration:.8},Fie={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Oie=(n,{keyframes:e})=>e.length>2?Mie:sy.has(n)?n.startsWith("scale")?Iie(e[1]):Rie:Fie;function Bie({when:n,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:i,repeat:r,repeatType:o,repeatDelay:c,from:d,elapsed:h,...u}){return!!Object.keys(u).length}const J5=(n,e,t,s={},i,r)=>o=>{const c=F5(s,n)||{},d=c.delay||s.delay||0;let{elapsed:h=0}=s;h=h-Su(d);let u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...c,delay:-h,onUpdate:f=>{e.set(f),c.onUpdate&&c.onUpdate(f)},onComplete:()=>{o(),c.onComplete&&c.onComplete()},name:n,motionValue:e,element:r?void 0:i};Bie(c)||(u={...u,...Oie(n,u)}),u.duration&&(u.duration=Su(u.duration)),u.repeatDelay&&(u.repeatDelay=Su(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(p=!0)),p&&!r&&e.get()!==void 0){const f=GL(u.keyframes,c);if(f!==void 0)return Ms.update(()=>{u.onUpdate(f),u.onComplete()}),new rne([])}return!r&&s$.supports(u)?new s$(u):new Q5(u)};function $ie({protectedKeys:n,needsAnimating:e},t){const s=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function G7(n,e,{delay:t=0,transitionOverride:s,type:i}={}){var r;let{transition:o=n.getDefaultTransition(),transitionEnd:c,...d}=e;s&&(o=s);const h=[],u=i&&n.animationState&&n.animationState.getState()[i];for(const p in d){const f=n.getValue(p,(r=n.latestValues[p])!==null&&r!==void 0?r:null),m=d[p];if(m===void 0||u&&$ie(u,p))continue;const x={delay:t,...F5(o||{},p)};let g=!1;if(window.MotionHandoffAnimation){const y=m7(n);if(y){const C=window.MotionHandoffAnimation(y,p,Ms);C!==null&&(x.startTime=C,g=!0)}}KI(n,p),f.start(J5(p,f,m,n.shouldReduceMotion&&p7.has(p)?{type:!1}:x,n,g));const b=f.animation;b&&h.push(b)}return c&&Promise.all(h).then(()=>{Ms.update(()=>{c&&yne(n,c)})}),h}function nM(n,e,t={}){var s;const i=VL(n,e,t.type==="exit"?(s=n.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:r=n.getDefaultTransition()||{}}=i||{};t.transitionOverride&&(r=t.transitionOverride);const o=i?()=>Promise.all(G7(n,i,t)):()=>Promise.resolve(),c=n.variantChildren&&n.variantChildren.size?(h=0)=>{const{delayChildren:u=0,staggerChildren:p,staggerDirection:f}=r;return Uie(n,e,u+h,p,f,t)}:()=>Promise.resolve(),{when:d}=r;if(d){const[h,u]=d==="beforeChildren"?[o,c]:[c,o];return h().then(()=>u())}else return Promise.all([o(),c(t.delay)])}function Uie(n,e,t=0,s=0,i=1,r){const o=[],c=(n.variantChildren.size-1)*s,d=i===1?(h=0)=>h*s:(h=0)=>c-h*s;return Array.from(n.variantChildren).sort(zie).forEach((h,u)=>{h.notify("AnimationStart",e),o.push(nM(h,e,{...r,delay:t+d(u)}).then(()=>h.notify("AnimationComplete",e)))}),Promise.all(o)}function zie(n,e){return n.sortNodePosition(e)}function Hie(n,e,t={}){n.notify("AnimationStart",e);let s;if(Array.isArray(e)){const i=e.map(r=>nM(n,r,t));s=Promise.all(i)}else if(typeof e=="string")s=nM(n,e,t);else{const i=typeof e=="function"?VL(n,e,t.custom):e;s=Promise.all(G7(n,i,t))}return s.then(()=>{n.notify("AnimationComplete",e)})}const Vie=j5.length;function W7(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?W7(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<Vie;t++){const s=j5[t],i=n.props[s];(bN(i)||i===!1)&&(e[s]=i)}return e}const Gie=[...N5].reverse(),Wie=N5.length;function qie(n){return e=>Promise.all(e.map(({animation:t,options:s})=>Hie(n,t,s)))}function Yie(n){let e=qie(n),t=n$(),s=!0;const i=d=>(h,u)=>{var p;const f=VL(n,u,d==="exit"?(p=n.presenceContext)===null||p===void 0?void 0:p.custom:void 0);if(f){const{transition:m,transitionEnd:x,...g}=f;h={...h,...g,...x}}return h};function r(d){e=d(n)}function o(d){const{props:h}=n,u=W7(n.parent)||{},p=[],f=new Set;let m={},x=1/0;for(let b=0;b<Wie;b++){const y=Gie[b],C=t[y],w=h[y]!==void 0?h[y]:u[y],S=bN(w),j=y===d?C.isActive:null;j===!1&&(x=b);let T=w===u[y]&&w!==h[y]&&S;if(T&&s&&n.manuallyAnimateOnMount&&(T=!1),C.protectedKeys={...m},!C.isActive&&j===null||!w&&!C.prevProp||zL(w)||typeof w=="boolean")continue;const k=Xie(C.prevProp,w);let _=k||y===d&&C.isActive&&!T&&S||b>x&&S,L=!1;const D=Array.isArray(w)?w:[w];let P=D.reduce(i(y),{});j===!1&&(P={});const{prevResolvedValues:I={}}=C,M={...I,...P},O=U=>{_=!0,f.has(U)&&(L=!0,f.delete(U)),C.needsAnimating[U]=!0;const $=n.getValue(U);$&&($.liveStyle=!1)};for(const U in M){const $=P[U],G=I[U];if(m.hasOwnProperty(U))continue;let ne=!1;qI($)&&qI(G)?ne=!i7($,G):ne=$!==G,ne?$!=null?O(U):f.add(U):$!==void 0&&f.has(U)?O(U):C.protectedKeys[U]=!0}C.prevProp=w,C.prevResolvedValues=P,C.isActive&&(m={...m,...P}),s&&n.blockInitialAnimation&&(_=!1),_&&(!(T&&k)||L)&&p.push(...D.map(U=>({animation:U,options:{type:y}})))}if(f.size){const b={};f.forEach(y=>{const C=n.getBaseTarget(y),w=n.getValue(y);w&&(w.liveStyle=!0),b[y]=C??null}),p.push({animation:b})}let g=!!p.length;return s&&(h.initial===!1||h.initial===h.animate)&&!n.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(p):Promise.resolve()}function c(d,h){var u;if(t[d].isActive===h)return Promise.resolve();(u=n.variantChildren)===null||u===void 0||u.forEach(f=>{var m;return(m=f.animationState)===null||m===void 0?void 0:m.setActive(d,h)}),t[d].isActive=h;const p=o(d);for(const f in t)t[f].protectedKeys={};return p}return{animateChanges:o,setActive:c,setAnimateFunction:r,getState:()=>t,reset:()=>{t=n$(),s=!0}}}function Xie(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!i7(e,n):!1}function Pm(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function n$(){return{animate:Pm(!0),whileInView:Pm(),whileHover:Pm(),whileTap:Pm(),whileDrag:Pm(),whileFocus:Pm(),exit:Pm()}}class Nm{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Kie extends Nm{constructor(e){super(e),e.animationState||(e.animationState=Yie(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();zL(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let Qie=0;class Jie extends Nm{constructor(){super(...arguments),this.id=Qie++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Zie={animation:{Feature:Kie},exit:{Feature:Jie}};function CN(n,e,t,s={passive:!0}){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t)}function vE(n){return{point:{x:n.pageX,y:n.pageY}}}const ere=n=>e=>$5(e)&&n(e,vE(e));function VC(n,e,t,s){return CN(n,e,ere(t),s)}const i$=(n,e)=>Math.abs(n-e);function tre(n,e){const t=i$(n.x,e.x),s=i$(n.y,e.y);return Math.sqrt(t**2+s**2)}class q7{constructor(e,t,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=iR(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=tre(p.offset,{x:0,y:0})>=3;if(!f&&!m)return;const{point:x}=p,{timestamp:g}=Bi;this.history.push({...x,timestamp:g});const{onStart:b,onMove:y}=this.handlers;f||(b&&b(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,p)},this.handlePointerMove=(p,f)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=nR(f,this.transformPagePoint),Ms.update(this.updatePoint,!0)},this.handlePointerUp=(p,f)=>{this.end();const{onEnd:m,onSessionEnd:x,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=iR(p.type==="pointercancel"?this.lastMoveEventInfo:nR(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(p,b),x&&x(p,b)},!$5(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=s,this.contextWindow=i||window;const o=vE(e),c=nR(o,this.transformPagePoint),{point:d}=c,{timestamp:h}=Bi;this.history=[{...d,timestamp:h}];const{onSessionStart:u}=t;u&&u(e,iR(c,this.history)),this.removeListeners=bE(VC(this.contextWindow,"pointermove",this.handlePointerMove),VC(this.contextWindow,"pointerup",this.handlePointerUp),VC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),cm(this.updatePoint)}}function nR(n,e){return e?{point:e(n.point)}:n}function r$(n,e){return{x:n.x-e.x,y:n.y-e.y}}function iR({point:n},e){return{point:n,delta:r$(n,Y7(e)),offset:r$(n,sre(e)),velocity:nre(e,.1)}}function sre(n){return n[0]}function Y7(n){return n[n.length-1]}function nre(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,s=null;const i=Y7(n);for(;t>=0&&(s=n[t],!(i.timestamp-s.timestamp>Su(e)));)t--;if(!s)return{x:0,y:0};const r=Cu(i.timestamp-s.timestamp);if(r===0)return{x:0,y:0};const o={x:(i.x-s.x)/r,y:(i.y-s.y)/r};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const X7=1e-4,ire=1-X7,rre=1+X7,K7=.01,are=0-K7,ore=0+K7;function Co(n){return n.max-n.min}function lre(n,e,t){return Math.abs(n-e)<=t}function a$(n,e,t,s=.5){n.origin=s,n.originPoint=sn(e.min,e.max,n.origin),n.scale=Co(t)/Co(e),n.translate=sn(t.min,t.max,n.origin)-n.originPoint,(n.scale>=ire&&n.scale<=rre||isNaN(n.scale))&&(n.scale=1),(n.translate>=are&&n.translate<=ore||isNaN(n.translate))&&(n.translate=0)}function GC(n,e,t,s){a$(n.x,e.x,t.x,s?s.originX:void 0),a$(n.y,e.y,t.y,s?s.originY:void 0)}function o$(n,e,t){n.min=t.min+e.min,n.max=n.min+Co(e)}function cre(n,e,t){o$(n.x,e.x,t.x),o$(n.y,e.y,t.y)}function l$(n,e,t){n.min=e.min-t.min,n.max=n.min+Co(e)}function WC(n,e,t){l$(n.x,e.x,t.x),l$(n.y,e.y,t.y)}function dre(n,{min:e,max:t},s){return e!==void 0&&n<e?n=s?sn(e,n,s.min):Math.max(n,e):t!==void 0&&n>t&&(n=s?sn(t,n,s.max):Math.min(n,t)),n}function c$(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function hre(n,{top:e,left:t,bottom:s,right:i}){return{x:c$(n.x,t,i),y:c$(n.y,e,s)}}function d$(n,e){let t=e.min-n.min,s=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,s]=[s,t]),{min:t,max:s}}function ure(n,e){return{x:d$(n.x,e.x),y:d$(n.y,e.y)}}function pre(n,e){let t=.5;const s=Co(n),i=Co(e);return i>s?t=k1(e.min,e.max-s,n.min):s>i&&(t=k1(n.min,n.max-i,e.min)),Du(0,1,t)}function fre(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const iM=.35;function mre(n=iM){return n===!1?n=0:n===!0&&(n=iM),{x:h$(n,"left","right"),y:h$(n,"top","bottom")}}function h$(n,e,t){return{min:u$(n,e),max:u$(n,t)}}function u$(n,e){return typeof n=="number"?n:n[e]||0}const p$=()=>({translate:0,scale:1,origin:0,originPoint:0}),Qy=()=>({x:p$(),y:p$()}),f$=()=>({min:0,max:0}),_n=()=>({x:f$(),y:f$()});function Do(n){return[n("x"),n("y")]}function Q7({top:n,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:n,max:s}}}function gre({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function xre(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),s=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function rR(n){return n===void 0||n===1}function rM({scale:n,scaleX:e,scaleY:t}){return!rR(n)||!rR(e)||!rR(t)}function Om(n){return rM(n)||J7(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function J7(n){return m$(n.x)||m$(n.y)}function m$(n){return n&&n!=="0%"}function dP(n,e,t){const s=n-t,i=e*s;return t+i}function g$(n,e,t,s,i){return i!==void 0&&(n=dP(n,i,s)),dP(n,t,s)+e}function aM(n,e=0,t=1,s,i){n.min=g$(n.min,e,t,s,i),n.max=g$(n.max,e,t,s,i)}function Z7(n,{x:e,y:t}){aM(n.x,e.translate,e.scale,e.originPoint),aM(n.y,t.translate,t.scale,t.originPoint)}const x$=.999999999999,y$=1.0000000000001;function yre(n,e,t,s=!1){const i=t.length;if(!i)return;e.x=e.y=1;let r,o;for(let c=0;c<i;c++){r=t[c],o=r.projectionDelta;const{visualElement:d}=r.options;d&&d.props.style&&d.props.style.display==="contents"||(s&&r.options.layoutScroll&&r.scroll&&r!==r.root&&Zy(n,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,Z7(n,o)),s&&Om(r.latestValues)&&Zy(n,r.latestValues))}e.x<y$&&e.x>x$&&(e.x=1),e.y<y$&&e.y>x$&&(e.y=1)}function Jy(n,e){n.min=n.min+e,n.max=n.max+e}function b$(n,e,t,s,i=.5){const r=sn(n.min,n.max,i);aM(n,e,t,r,s)}function Zy(n,e){b$(n.x,e.x,e.scaleX,e.scale,e.originX),b$(n.y,e.y,e.scaleY,e.scale,e.originY)}function eW(n,e){return Q7(xre(n.getBoundingClientRect(),e))}function bre(n,e,t){const s=eW(n,t),{scroll:i}=e;return i&&(Jy(s.x,i.offset.x),Jy(s.y,i.offset.y)),s}const tW=({current:n})=>n?n.ownerDocument.defaultView:null,vre=new WeakMap;class wre{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=_n(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=u=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(vE(u).point)},r=(u,p)=>{const{drag:f,dragPropagation:m,onDragStart:x}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=pne(f),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Do(b=>{let y=this.getAxisMotionValue(b).get()||0;if(Ad.test(y)){const{projection:C}=this.visualElement;if(C&&C.layout){const w=C.layout.layoutBox[b];w&&(y=Co(w)*(parseFloat(y)/100))}}this.originPoint[b]=y}),x&&Ms.postRender(()=>x(u,p)),KI(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},o=(u,p)=>{const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:x,onDrag:g}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:b}=p;if(m&&this.currentDirection===null){this.currentDirection=Sre(b),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",p.point,b),this.updateAxis("y",p.point,b),this.visualElement.render(),g&&g(u,p)},c=(u,p)=>this.stop(u,p),d=()=>Do(u=>{var p;return this.getAnimationState(u)==="paused"&&((p=this.getAxisMotionValue(u).animation)===null||p===void 0?void 0:p.play())}),{dragSnapToOrigin:h}=this.getProps();this.panSession=new q7(e,{onSessionStart:i,onStart:r,onMove:o,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,contextWindow:tW(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Ms.postRender(()=>r(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!bk(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=dre(o,this.constraints[e],this.elastic[e])),r.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,r=this.constraints;t&&Xy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&i?this.constraints=hre(i.layoutBox,t):this.constraints=!1,this.elastic=mre(s),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Do(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=fre(i.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Xy(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=bre(s,i.root,this.visualElement.getTransformPagePoint());let o=ure(i.layout.layoutBox,r);if(t){const c=t(gre(o));this.hasMutatedConstraints=!!c,c&&(o=Q7(c))}return o}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:r,dragSnapToOrigin:o,onDragTransitionEnd:c}=this.getProps(),d=this.constraints||{},h=Do(u=>{if(!bk(u,t,this.currentDirection))return;let p=d&&d[u]||{};o&&(p={min:0,max:0});const f=i?200:1e6,m=i?40:1e7,x={type:"inertia",velocity:s?e[u]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...r,...p};return this.startAxisValueAnimation(u,x)});return Promise.all(h).then(c)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return KI(this.visualElement,e),s.start(J5(e,s,0,t,this.visualElement,!1))}stopAnimation(){Do(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Do(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Do(t=>{const{drag:s}=this.getProps();if(!bk(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:o,max:c}=i.layout.layoutBox[t];r.set(e[t]-sn(o,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!Xy(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Do(o=>{const c=this.getAxisMotionValue(o);if(c&&this.constraints!==!1){const d=c.get();i[o]=pre({min:d,max:d},this.constraints[o])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Do(o=>{if(!bk(o,e,null))return;const c=this.getAxisMotionValue(o),{min:d,max:h}=this.constraints[o];c.set(sn(d,h,i[o]))})}addListeners(){if(!this.visualElement.current)return;vre.set(this.visualElement,this);const e=this.visualElement.current,t=VC(e,"pointerdown",d=>{const{drag:h,dragListener:u=!0}=this.getProps();h&&u&&this.start(d)}),s=()=>{const{dragConstraints:d}=this.getProps();Xy(d)&&d.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,r=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Ms.read(s);const o=CN(window,"resize",()=>this.scalePositionWithinConstraints()),c=i.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h})=>{this.isDragging&&h&&(Do(u=>{const p=this.getAxisMotionValue(u);p&&(this.originPoint[u]+=d[u].translate,p.set(p.get()+d[u].translate))}),this.visualElement.render())});return()=>{o(),t(),r(),c&&c()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:o=iM,dragMomentum:c=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:r,dragElastic:o,dragMomentum:c}}}function bk(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Sre(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class Cre extends Nm{constructor(e){super(e),this.removeGroupControls=yo,this.removeListeners=yo,this.controls=new wre(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||yo}unmount(){this.removeGroupControls(),this.removeListeners()}}const v$=n=>(e,t)=>{n&&Ms.postRender(()=>n(e,t))};class Nre extends Nm{constructor(){super(...arguments),this.removePointerDownListener=yo}onPointerDown(e){this.session=new q7(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:tW(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:v$(e),onStart:v$(t),onMove:s,onEnd:(r,o)=>{delete this.session,i&&Ms.postRender(()=>i(r,o))}}}mount(){this.removePointerDownListener=VC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const oT={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function w$(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const xS={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(We.test(n))n=parseFloat(n);else return n;const t=w$(n,e.target.x),s=w$(n,e.target.y);return`${t}% ${s}%`}},jre={correct:(n,{treeScale:e,projectionDelta:t})=>{const s=n,i=dm.parse(n);if(i.length>5)return s;const r=dm.createTransformer(n),o=typeof i[0]!="number"?1:0,c=t.x.scale*e.x,d=t.y.scale*e.y;i[0+o]/=c,i[1+o]/=d;const h=sn(c,d,.5);return typeof i[2+o]=="number"&&(i[2+o]/=h),typeof i[3+o]=="number"&&(i[3+o]/=h),r(i)}};class Are extends N.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:r}=e;qse(Ere),r&&(t.group&&t.group.add(r),s&&s.register&&i&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),oT.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:r}=this.props,o=s.projection;return o&&(o.isPresent=r,i||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?o.promote():o.relegate()||Ms.postRender(()=>{const c=o.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),E5.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function sW(n){const[e,t]=FG(),s=N.useContext(b5);return a.jsx(Are,{...n,layoutGroup:s,switchLayoutGroup:N.useContext(GG),isPresent:e,safeToRemove:t})}const Ere={borderRadius:{...xS,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:xS,borderTopRightRadius:xS,borderBottomLeftRadius:xS,borderBottomRightRadius:xS,boxShadow:jre};function kre(n,e,t){const s=wr(n)?n:wN(n);return s.start(J5("",s,e,t)),s.animation}function Tre(n){return n instanceof SVGElement&&n.tagName!=="svg"}const _re=(n,e)=>n.depth-e.depth;class Pre{constructor(){this.children=[],this.isDirty=!1}add(e){U5(this.children,e),this.isDirty=!0}remove(e){z5(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(_re),this.isDirty=!1,this.children.forEach(e)}}function Lre(n,e){const t=Ed.now(),s=({timestamp:i})=>{const r=i-t;r>=e&&(cm(s),n(r-e))};return Ms.read(s,!0),()=>cm(s)}const nW=["TopLeft","TopRight","BottomLeft","BottomRight"],Dre=nW.length,S$=n=>typeof n=="string"?parseFloat(n):n,C$=n=>typeof n=="number"||We.test(n);function Rre(n,e,t,s,i,r){i?(n.opacity=sn(0,t.opacity!==void 0?t.opacity:1,Ire(s)),n.opacityExit=sn(e.opacity!==void 0?e.opacity:1,0,Mre(s))):r&&(n.opacity=sn(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,s));for(let o=0;o<Dre;o++){const c=`border${nW[o]}Radius`;let d=N$(e,c),h=N$(t,c);if(d===void 0&&h===void 0)continue;d||(d=0),h||(h=0),d===0||h===0||C$(d)===C$(h)?(n[c]=Math.max(sn(S$(d),S$(h),s),0),(Ad.test(h)||Ad.test(d))&&(n[c]+="%")):n[c]=h}(e.rotate||t.rotate)&&(n.rotate=sn(e.rotate||0,t.rotate||0,s))}function N$(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const Ire=iW(0,.5,S7),Mre=iW(.5,.95,yo);function iW(n,e,t){return s=>s<n?0:s>e?1:t(k1(n,e,s))}function j$(n,e){n.min=e.min,n.max=e.max}function ko(n,e){j$(n.x,e.x),j$(n.y,e.y)}function A$(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function E$(n,e,t,s,i){return n-=e,n=dP(n,1/t,s),i!==void 0&&(n=dP(n,1/i,s)),n}function Fre(n,e=0,t=1,s=.5,i,r=n,o=n){if(Ad.test(e)&&(e=parseFloat(e),e=sn(o.min,o.max,e/100)-o.min),typeof e!="number")return;let c=sn(r.min,r.max,s);n===r&&(c-=e),n.min=E$(n.min,e,t,c,i),n.max=E$(n.max,e,t,c,i)}function k$(n,e,[t,s,i],r,o){Fre(n,e[t],e[s],e[i],e.scale,r,o)}const Ore=["x","scaleX","originX"],Bre=["y","scaleY","originY"];function T$(n,e,t,s){k$(n.x,e,Ore,t?t.x:void 0,s?s.x:void 0),k$(n.y,e,Bre,t?t.y:void 0,s?s.y:void 0)}function _$(n){return n.translate===0&&n.scale===1}function rW(n){return _$(n.x)&&_$(n.y)}function P$(n,e){return n.min===e.min&&n.max===e.max}function $re(n,e){return P$(n.x,e.x)&&P$(n.y,e.y)}function L$(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function aW(n,e){return L$(n.x,e.x)&&L$(n.y,e.y)}function D$(n){return Co(n.x)/Co(n.y)}function R$(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class Ure{constructor(){this.members=[]}add(e){U5(this.members,e),e.scheduleRender()}remove(e){if(z5(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let s;for(let i=t;i>=0;i--){const r=this.members[i];if(r.isPresent!==!1){s=r;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function zre(n,e,t){let s="";const i=n.x.translate/e.x,r=n.y.translate/e.y,o=(t==null?void 0:t.z)||0;if((i||r||o)&&(s=`translate3d(${i}px, ${r}px, ${o}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:h,rotate:u,rotateX:p,rotateY:f,skewX:m,skewY:x}=t;h&&(s=`perspective(${h}px) ${s}`),u&&(s+=`rotate(${u}deg) `),p&&(s+=`rotateX(${p}deg) `),f&&(s+=`rotateY(${f}deg) `),m&&(s+=`skewX(${m}deg) `),x&&(s+=`skewY(${x}deg) `)}const c=n.x.scale*e.x,d=n.y.scale*e.y;return(c!==1||d!==1)&&(s+=`scale(${c}, ${d})`),s||"none"}const Bm={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},VS=typeof window<"u"&&window.MotionDebug!==void 0,aR=["","X","Y","Z"],Hre={visibility:"hidden"},I$=1e3;let Vre=0;function oR(n,e,t,s){const{latestValues:i}=e;i[n]&&(t[n]=i[n],e.setStaticValue(n,0),s&&(s[n]=0))}function oW(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=m7(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:r}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Ms,!(i||r))}const{parent:s}=n;s&&!s.hasCheckedOptimisedAppear&&oW(s)}function lW({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(o={},c=e==null?void 0:e()){this.id=Vre++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,VS&&(Bm.totalNodes=Bm.resolvedTargetDeltas=Bm.recalculatedProjection=0),this.nodes.forEach(qre),this.nodes.forEach(Jre),this.nodes.forEach(Zre),this.nodes.forEach(Yre),VS&&window.MotionDebug.record(Bm)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let d=0;d<this.path.length;d++)this.path[d].shouldResetTransform=!0;this.root===this&&(this.nodes=new Pre)}addEventListener(o,c){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new H5),this.eventHandlers.get(o).add(c)}notifyListeners(o,...c){const d=this.eventHandlers.get(o);d&&d.notify(...c)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,c=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Tre(o),this.instance=o;const{layoutId:d,layout:h,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),c&&(h||d)&&(this.isLayoutDirty=!0),n){let p;const f=()=>this.root.updateBlockedByResize=!1;n(o,()=>{this.root.updateBlockedByResize=!0,p&&p(),p=Lre(f,250),oT.hasAnimatedSinceResize&&(oT.hasAnimatedSinceResize=!1,this.nodes.forEach(F$))})}d&&this.root.registerSharedNode(d,this),this.options.animate!==!1&&u&&(d||h)&&this.addEventListener("didUpdate",({delta:p,hasLayoutChanged:f,hasRelativeTargetChanged:m,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||u.getDefaultTransition()||iae,{onLayoutAnimationStart:b,onLayoutAnimationComplete:y}=u.getProps(),C=!this.targetLayout||!aW(this.targetLayout,x)||m,w=!f&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||f&&(C||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(p,w);const S={...F5(g,"layout"),onPlay:b,onComplete:y};(u.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S)}else f||F$(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(eae),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&oW(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:c,layout:d}=this.options;if(c===void 0&&!d)return;const h=this.getTransformTemplate();this.prevTransformTemplateValue=h?h(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(M$);return}this.isUpdating||this.nodes.forEach(Kre),this.isUpdating=!1,this.nodes.forEach(Qre),this.nodes.forEach(Gre),this.nodes.forEach(Wre),this.clearAllSnapshots();const c=Ed.now();Bi.delta=Du(0,1e3/60,c-Bi.timestamp),Bi.timestamp=c,Bi.isProcessing=!0,QD.update.process(Bi),QD.preRender.process(Bi),QD.render.process(Bi),Bi.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,E5.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Xre),this.sharedNodes.forEach(tae)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ms.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ms.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let d=0;d<this.path.length;d++)this.path[d].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=_n(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(c=!1),c){const d=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:d,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:d}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!rW(this.projectionDelta),d=this.getTransformTemplate(),h=d?d(this.latestValues,""):void 0,u=h!==this.prevTransformTemplateValue;o&&(c||Om(this.latestValues)||u)&&(i(this.instance,h),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const c=this.measurePageBox();let d=this.removeElementScroll(c);return o&&(d=this.removeTransform(d)),rae(d),{animationId:this.root.animationId,measuredBox:c,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:c}=this.options;if(!c)return _n();const d=c.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(aae))){const{scroll:u}=this.root;u&&(Jy(d.x,u.offset.x),Jy(d.y,u.offset.y))}return d}removeElementScroll(o){var c;const d=_n();if(ko(d,o),!((c=this.scroll)===null||c===void 0)&&c.wasRoot)return d;for(let h=0;h<this.path.length;h++){const u=this.path[h],{scroll:p,options:f}=u;u!==this.root&&p&&f.layoutScroll&&(p.wasRoot&&ko(d,o),Jy(d.x,p.offset.x),Jy(d.y,p.offset.y))}return d}applyTransform(o,c=!1){const d=_n();ko(d,o);for(let h=0;h<this.path.length;h++){const u=this.path[h];!c&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Zy(d,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Om(u.latestValues)&&Zy(d,u.latestValues)}return Om(this.latestValues)&&Zy(d,this.latestValues),d}removeTransform(o){const c=_n();ko(c,o);for(let d=0;d<this.path.length;d++){const h=this.path[d];if(!h.instance||!Om(h.latestValues))continue;rM(h.latestValues)&&h.updateSnapshot();const u=_n(),p=h.measurePageBox();ko(u,p),T$(c,h.latestValues,h.snapshot?h.snapshot.layoutBox:void 0,u)}return Om(this.latestValues)&&T$(c,this.latestValues),c}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Bi.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var c;const d=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=d.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=d.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=d.isSharedProjectionDirty);const h=!!this.resumingFrom||this!==d;if(!(o||h&&this.isSharedProjectionDirty||this.isProjectionDirty||!((c=this.parent)===null||c===void 0)&&c.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:p,layoutId:f}=this.options;if(!(!this.layout||!(p||f))){if(this.resolvedRelativeTargetAt=Bi.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=_n(),this.relativeTargetOrigin=_n(),WC(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),ko(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=_n(),this.targetWithTransforms=_n()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cre(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ko(this.target,this.layout.layoutBox),Z7(this.target,this.targetDelta)):ko(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=_n(),this.relativeTargetOrigin=_n(),WC(this.relativeTargetOrigin,this.target,m.target),ko(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}VS&&Bm.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||rM(this.parent.latestValues)||J7(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const c=this.getLead(),d=!!this.resumingFrom||this!==c;let h=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(h=!1),d&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(h=!1),this.resolvedRelativeTargetAt===Bi.timestamp&&(h=!1),h)return;const{layout:u,layoutId:p}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||p))return;ko(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,m=this.treeScale.y;yre(this.layoutCorrected,this.treeScale,this.path,d),c.layout&&!c.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(c.target=c.layout.layoutBox,c.targetWithTransforms=_n());const{target:x}=c;if(!x){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(A$(this.prevProjectionDelta.x,this.projectionDelta.x),A$(this.prevProjectionDelta.y,this.projectionDelta.y)),GC(this.projectionDelta,this.layoutCorrected,x,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==m||!R$(this.projectionDelta.x,this.prevProjectionDelta.x)||!R$(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x)),VS&&Bm.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var c;if((c=this.options.visualElement)===null||c===void 0||c.scheduleRender(),o){const d=this.getStack();d&&d.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Qy(),this.projectionDelta=Qy(),this.projectionDeltaWithTransform=Qy()}setAnimationOrigin(o,c=!1){const d=this.snapshot,h=d?d.latestValues:{},u={...this.latestValues},p=Qy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const f=_n(),m=d?d.source:void 0,x=this.layout?this.layout.source:void 0,g=m!==x,b=this.getStack(),y=!b||b.members.length<=1,C=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(nae));this.animationProgress=0;let w;this.mixTargetDelta=S=>{const j=S/1e3;O$(p.x,o.x,j),O$(p.y,o.y,j),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(WC(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),sae(this.relativeTarget,this.relativeTargetOrigin,f,j),w&&$re(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=_n()),ko(w,this.relativeTarget)),g&&(this.animationValues=u,Rre(u,h,this.latestValues,j,C,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=j},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ms.update(()=>{oT.hasAnimatedSinceResize=!0,this.currentAnimation=kre(0,I$,{...o,onUpdate:c=>{this.mixTargetDelta(c),o.onUpdate&&o.onUpdate(c)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(I$),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:c,target:d,layout:h,latestValues:u}=o;if(!(!c||!d||!h)){if(this!==o&&this.layout&&h&&cW(this.options.animationType,this.layout.layoutBox,h.layoutBox)){d=this.target||_n();const p=Co(this.layout.layoutBox.x);d.x.min=o.target.x.min,d.x.max=d.x.min+p;const f=Co(this.layout.layoutBox.y);d.y.min=o.target.y.min,d.y.max=d.y.min+f}ko(c,d),Zy(c,u),GC(this.projectionDeltaWithTransform,this.layoutCorrected,c,u)}}registerSharedNode(o,c){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Ure),this.sharedNodes.get(o).add(c);const h=c.options.initialPromotionConfig;c.promote({transition:h?h.transition:void 0,preserveFollowOpacity:h&&h.shouldPreserveFollowOpacity?h.shouldPreserveFollowOpacity(c):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:c}=this.options;return c?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:c}=this.options;return c?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:c,preserveFollowOpacity:d}={}){const h=this.getStack();h&&h.promote(this,d),o&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let c=!1;const{latestValues:d}=o;if((d.z||d.rotate||d.rotateX||d.rotateY||d.rotateZ||d.skewX||d.skewY)&&(c=!0),!c)return;const h={};d.z&&oR("z",o,h,this.animationValues);for(let u=0;u<aR.length;u++)oR(`rotate${aR[u]}`,o,h,this.animationValues),oR(`skew${aR[u]}`,o,h,this.animationValues);o.render();for(const u in h)o.setStaticValue(u,h[u]),this.animationValues&&(this.animationValues[u]=h[u]);o.scheduleRender()}getProjectionStyles(o){var c,d;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Hre;const h={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,h.opacity="",h.pointerEvents=rT(o==null?void 0:o.pointerEvents)||"",h.transform=u?u(this.latestValues,""):"none",h;const p=this.getLead();if(!this.projectionDelta||!this.layout||!p.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=rT(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Om(this.latestValues)&&(g.transform=u?u({},""):"none",this.hasProjected=!1),g}const f=p.animationValues||p.latestValues;this.applyTransformsToTarget(),h.transform=zre(this.projectionDeltaWithTransform,this.treeScale,f),u&&(h.transform=u(f,h.transform));const{x:m,y:x}=this.projectionDelta;h.transformOrigin=`${m.origin*100}% ${x.origin*100}% 0`,p.animationValues?h.opacity=p===this?(d=(c=f.opacity)!==null&&c!==void 0?c:this.latestValues.opacity)!==null&&d!==void 0?d:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:h.opacity=p===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const g in rP){if(f[g]===void 0)continue;const{correct:b,applyTo:y}=rP[g],C=h.transform==="none"?f[g]:b(f[g],p);if(y){const w=y.length;for(let S=0;S<w;S++)h[y[S]]=C}else h[g]=C}return this.options.layoutId&&(h.pointerEvents=p===this?rT(o==null?void 0:o.pointerEvents)||"":"none"),h}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var c;return(c=o.currentAnimation)===null||c===void 0?void 0:c.stop()}),this.root.nodes.forEach(M$),this.root.sharedNodes.clear()}}}function Gre(n){n.updateLayout()}function Wre(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:i}=n.layout,{animationType:r}=n.options,o=t.source!==n.layout.source;r==="size"?Do(p=>{const f=o?t.measuredBox[p]:t.layoutBox[p],m=Co(f);f.min=s[p].min,f.max=f.min+m}):cW(r,t.layoutBox,s)&&Do(p=>{const f=o?t.measuredBox[p]:t.layoutBox[p],m=Co(s[p]);f.max=f.min+m,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[p].max=n.relativeTarget[p].min+m)});const c=Qy();GC(c,s,t.layoutBox);const d=Qy();o?GC(d,n.applyTransform(i,!0),t.measuredBox):GC(d,s,t.layoutBox);const h=!rW(c);let u=!1;if(!n.resumeFrom){const p=n.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:f,layout:m}=p;if(f&&m){const x=_n();WC(x,t.layoutBox,f.layoutBox);const g=_n();WC(g,s,m.layoutBox),aW(x,g)||(u=!0),p.options.layoutRoot&&(n.relativeTarget=g,n.relativeTargetOrigin=x,n.relativeParent=p)}}}n.notifyListeners("didUpdate",{layout:s,snapshot:t,delta:d,layoutDelta:c,hasLayoutChanged:h,hasRelativeTargetChanged:u})}else if(n.isLead()){const{onExitComplete:s}=n.options;s&&s()}n.options.transition=void 0}function qre(n){VS&&Bm.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Yre(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Xre(n){n.clearSnapshot()}function M$(n){n.clearMeasurements()}function Kre(n){n.isLayoutDirty=!1}function Qre(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function F$(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function Jre(n){n.resolveTargetDelta()}function Zre(n){n.calcProjection()}function eae(n){n.resetSkewAndRotation()}function tae(n){n.removeLeadSnapshot()}function O$(n,e,t){n.translate=sn(e.translate,0,t),n.scale=sn(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function B$(n,e,t,s){n.min=sn(e.min,t.min,s),n.max=sn(e.max,t.max,s)}function sae(n,e,t,s){B$(n.x,e.x,t.x,s),B$(n.y,e.y,t.y,s)}function nae(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const iae={duration:.45,ease:[.4,0,.1,1]},$$=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),U$=$$("applewebkit/")&&!$$("chrome/")?Math.round:yo;function z$(n){n.min=U$(n.min),n.max=U$(n.max)}function rae(n){z$(n.x),z$(n.y)}function cW(n,e,t){return n==="position"||n==="preserve-aspect"&&!lre(D$(e),D$(t),.2)}function aae(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const oae=lW({attachResizeListener:(n,e)=>CN(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),lR={current:void 0},dW=lW({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!lR.current){const n=new oae({});n.mount(window),n.setOptions({layoutScroll:!0}),lR.current=n}return lR.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),lae={pan:{Feature:Nre},drag:{Feature:Cre,ProjectionNode:dW,MeasureLayout:sW}};function H$(n,e,t){const{props:s}=n;n.animationState&&s.whileHover&&n.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,r=s[i];r&&Ms.postRender(()=>r(e,vE(e)))}class cae extends Nm{mount(){const{current:e}=this.node;e&&(this.unmount=lne(e,t=>(H$(this.node,t,"Start"),s=>H$(this.node,s,"End"))))}unmount(){}}class dae extends Nm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=bE(CN(this.node.current,"focus",()=>this.onFocus()),CN(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function V$(n,e,t){const{props:s}=n;n.animationState&&s.whileTap&&n.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),r=s[i];r&&Ms.postRender(()=>r(e,vE(e)))}class hae extends Nm{mount(){const{current:e}=this.node;e&&(this.unmount=une(e,t=>(V$(this.node,t,"Start"),(s,{success:i})=>V$(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const oM=new WeakMap,cR=new WeakMap,uae=n=>{const e=oM.get(n.target);e&&e(n)},pae=n=>{n.forEach(uae)};function fae({root:n,...e}){const t=n||document;cR.has(t)||cR.set(t,{});const s=cR.get(t),i=JSON.stringify(e);return s[i]||(s[i]=new IntersectionObserver(pae,{root:n,...e})),s[i]}function mae(n,e,t){const s=fae(e);return oM.set(n,t),s.observe(n),()=>{oM.delete(n),s.unobserve(n)}}const gae={some:0,all:1};class xae extends Nm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:r}=e,o={root:t?t.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:gae[i]},c=d=>{const{isIntersecting:h}=d;if(this.isInView===h||(this.isInView=h,r&&!h&&this.hasEnteredView))return;h&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",h);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),f=h?u:p;f&&f(d)};return mae(this.node.current,o,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(yae(e,t))&&this.startObserver()}unmount(){}}function yae({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const bae={inView:{Feature:xae},tap:{Feature:hae},focus:{Feature:dae},hover:{Feature:cae}},vae={layout:{ProjectionNode:dW,MeasureLayout:sW}},lM={current:null},hW={current:!1};function wae(){if(hW.current=!0,!!S5)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>lM.current=n.matches;n.addListener(e),e()}else lM.current=!1}const Sae=[...M7,mr,dm],Cae=n=>Sae.find(I7(n)),G$=new WeakMap;function Nae(n,e,t){for(const s in e){const i=e[s],r=t[s];if(wr(i))n.addValue(s,i);else if(wr(r))n.addValue(s,wN(i,{owner:n}));else if(r!==i)if(n.hasValue(s)){const o=n.getValue(s);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=n.getStaticValue(s);n.addValue(s,wN(o!==void 0?o:i,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const W$=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class jae{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:r,visualState:o},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=X5,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const m=Ed.now();this.renderScheduledAt<m&&(this.renderScheduledAt=m,Ms.render(this.render,!1,!0))};const{latestValues:d,renderState:h,onUpdate:u}=o;this.onUpdate=u,this.latestValues=d,this.baseTarget={...d},this.initialValues=t.initial?{...d}:{},this.renderState=h,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=c,this.blockInitialAnimation=!!r,this.isControllingVariants=HL(t),this.isVariantNode=HG(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:p,...f}=this.scrapeMotionValuesFromProps(t,{},this);for(const m in f){const x=f[m];d[m]!==void 0&&wr(x)&&x.set(d[m],!1)}}mount(e){this.current=e,G$.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),hW.current||wae(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:lM.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){G$.delete(this.current),this.projection&&this.projection.unmount(),cm(this.notifyUpdate),cm(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=sy.has(e),i=t.on("change",c=>{this.latestValues[e]=c,this.props.onUpdate&&Ms.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),r=t.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),r(),o&&o(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in T1){const t=T1[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const r=this.features[e];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):_n()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<W$.length;s++){const i=W$[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const r="on"+i,o=e[r];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=Nae(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=wN(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){var s;let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(s=this.getBaseTargetFromProps(this.props,e))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(D7(i)||N7(i))?i=parseFloat(i):!Cae(i)&&dm.test(t)&&(i=_7(e,t)),this.setBaseTarget(e,wr(i)?i.get():i)),wr(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:s}=this.props;let i;if(typeof s=="string"||typeof s=="object"){const o=T5(this.props,s,(t=this.presenceContext)===null||t===void 0?void 0:t.custom);o&&(i=o[e])}if(s&&i!==void 0)return i;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!wr(r)?r:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new H5),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class uW extends jae{constructor(){super(...arguments),this.KeyframeResolver=F7}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;wr(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function Aae(n){return window.getComputedStyle(n)}class Eae extends uW{constructor(){super(...arguments),this.type="html",this.renderInstance=JG}readValueFromInstance(e,t){if(sy.has(t)){const s=Y5(t);return s&&s.default||0}else{const s=Aae(e),i=(XG(t)?s.getPropertyValue(t):s[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return eW(e,t)}build(e,t,s){L5(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return M5(e,t,s)}}class kae extends uW{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=_n}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(sy.has(t)){const s=Y5(t);return s&&s.default||0}return t=ZG.has(t)?t:A5(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return s7(e,t,s)}build(e,t,s){D5(e,t,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,s,i){e7(e,t,s,i)}mount(e){this.isSVGTag=I5(e.tagName),super.mount(e)}}const Tae=(n,e)=>k5(n)?new kae(e):new Eae(e,{allowProjection:n!==N.Fragment}),_ae=sne({...Zie,...bae,...lae,...vae},Tae),R=xse(_ae),Pae={some:0,all:1};function Lae(n,e,{root:t,margin:s,amount:i="some"}={}){const r=d7(n),o=new WeakMap,c=h=>{h.forEach(u=>{const p=o.get(u.target);if(u.isIntersecting!==!!p)if(u.isIntersecting){const f=e(u);typeof f=="function"?o.set(u.target,f):d.unobserve(u.target)}else typeof p=="function"&&(p(u),o.delete(u.target))})},d=new IntersectionObserver(c,{root:t,rootMargin:s,threshold:typeof i=="number"?i:Pae[i]});return r.forEach(h=>d.observe(h)),()=>d.disconnect()}function Dae(n,{root:e,margin:t,amount:s,once:i=!1}={}){const[r,o]=N.useState(!1);return N.useEffect(()=>{if(!n.current||i&&r)return;const c=()=>(o(!0),i?void 0:()=>o(!1)),d={root:e&&e.current||void 0,margin:t,amount:s};return Lae(n.current,c,d)},[e,n,t,i,s]),r}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Rae={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iae=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ae=(n,e)=>{const t=N.forwardRef(({color:s="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:c="",children:d,...h},u)=>N.createElement("svg",{ref:u,...Rae,width:i,height:i,stroke:s,strokeWidth:o?Number(r)*24/Number(i):r,className:["lucide",`lucide-${Iae(n)}`,c].join(" "),...h},[...e.map(([p,f])=>N.createElement(p,f)),...Array.isArray(d)?d:[d]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mae=ae("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z5=ae("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cM=ae("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wE=ae("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jm=ae("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fae=ae("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pW=ae("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oae=ae("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e3=ae("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t3=ae("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bae=ae("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=ae("BookMarked",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["polyline",{points:"10 2 10 10 13 7 16 10 16 2",key:"13o6vz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=ae("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fW=ae("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ae=ae("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mW=ae("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uae=ae("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s3=ae("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=ae("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gW=ae("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kd=ae("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=ae("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SE=ae("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X1=ae("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=ae("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CE=ae("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=ae("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pd=ae("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n3=ae("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xW=ae("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zae=ae("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NN=ae("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hae=ae("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yW=ae("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vae=ae("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jN=ae("FileQuestion",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M10 10.3c.2-.4.5-.8.9-1a2.1 2.1 0 0 1 2.6.4c.3.4.5.8.5 1.3 0 1.3-2 2-2 2",key:"1umxtm"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=ae("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uP=ae("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gae=ae("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wae=ae("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qae=ae("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yae=ae("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xae=ae("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=ae("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i3=ae("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ld=ae("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r3=ae("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kae=ae("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P1=ae("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bW=ae("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qae=ae("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jae=ae("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WL=ae("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ki=ae("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vW=ae("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qL=ae("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q$=ae("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wW=ae("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nc=ae("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=ae("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zae=ae("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eoe=ae("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toe=ae("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=ae("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const soe=ae("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const noe=ae("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ioe=ae("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SW=ae("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const roe=ae("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a3=ae("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aoe=ae("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ooe=ae("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CW=ae("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NW=ae("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const loe=ae("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const coe=ae("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rm=ae("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const doe=ae("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hoe=ae("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uoe=ae("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L1=ae("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const poe=ae("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D1=ae("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AN=ae("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y$=ae("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iu=ae("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const foe=ae("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=ae("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=ae("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X$=ae("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const moe=ae("SwitchCamera",[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hm=ae("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const um=ae("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EN=ae("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K1=ae("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const goe=ae("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xoe=ae("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0=ae("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jW=ae("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yoe=ae("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=ae("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=ae("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=ae("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o3=ae("Youtube",[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const boe=ae("ZapOff",[["polyline",{points:"12.41 6.75 13 2 10.57 4.92",key:"122m05"}],["polyline",{points:"18.57 12.91 21 10 15.66 10",key:"16r43o"}],["polyline",{points:"8 8 3 14 12 14 11 22 16 16",key:"tmh4bc"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vu=ae("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const by=ae("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const voe=ae("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),woe=()=>{const n=Qt(),e=()=>{n("/onboarding")};return a.jsxs("header",{className:"relative pt-24 md:pt-28 lg:pt-32 pb-16 lg:pb-24 overflow-hidden min-h-[90vh] md:min-h-[85vh] flex items-center",children:[a.jsx("div",{className:"absolute top-32 left-10 w-24 md:w-32 h-24 md:h-32 bg-nanobanana-yellow/40 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute top-48 right-10 md:right-20 w-40 md:w-48 h-40 md:h-48 bg-nanobanana-blue/25 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute bottom-32 left-1/4 w-32 md:w-40 h-32 md:h-40 bg-nanobanana-green/25 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute top-1/3 right-1/3 w-20 h-20 bg-pink-300/20 rounded-full blur-2xl"}),a.jsx("div",{className:"max-w-7xl mx-auto px-6 md:px-8 lg:px-12 relative z-10 w-full",children:a.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 md:gap-12 lg:gap-16 items-center",children:[a.jsxs("div",{className:"max-w-2xl",children:[a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:a.jsxs("span",{className:"inline-flex items-center gap-2 bg-nanobanana-yellow/20 text-nanobanana-blue px-4 py-2 rounded-full font-bold text-sm border-2 border-nanobanana-yellow",children:[a.jsx(Ut,{className:"w-4 h-4"}),"AI-Powered Learning for K-6"]})}),a.jsxs(R.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black font-comic mb-4 md:mb-6 leading-[1.1]",children:["Where Learning"," ",a.jsx("span",{className:"text-nanobanana-blue",children:"Meets"})," ",a.jsx("span",{className:"text-nanobanana-green inline-block transform -rotate-2",children:"Adventure!"})]}),a.jsx(R.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-lg sm:text-xl md:text-2xl text-gray-600 mb-6 md:mb-8 font-medium leading-relaxed max-w-xl",children:"Meet Jeffrey, your child's friendly AI tutor. Upload any lesson, and watch as learning transforms into an exciting journey of discovery."}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-col sm:flex-row flex-wrap gap-3 md:gap-4 mb-6 md:mb-8",children:[a.jsxs("button",{onClick:e,className:"inline-flex items-center justify-center gap-3 bg-nanobanana-green text-white text-lg md:text-xl font-bold px-6 md:px-8 py-4 md:py-5 rounded-2xl border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[-2px] hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] transition-all active:translate-y-[2px] active:shadow-none active:scale-[0.98]",children:["Start Free Trial",a.jsx(jm,{className:"w-5 h-5 md:w-6 md:h-6"})]}),a.jsx("button",{onClick:()=>{var t;return(t=document.getElementById("how-it-works"))==null?void 0:t.scrollIntoView({behavior:"smooth"})},className:"inline-flex items-center justify-center gap-2 bg-white text-black text-base md:text-lg font-bold px-5 md:px-6 py-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[-2px] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all active:translate-y-[2px] active:shadow-none",children:"See How It Works"})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"flex flex-wrap gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 bg-green-50 px-4 py-2 rounded-full border-2 border-green-200",children:[a.jsx(Iu,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm font-bold text-green-700",children:"Safe for Kids"})]}),a.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 px-4 py-2 rounded-full border-2 border-blue-200",children:[a.jsx(Cr,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"text-sm font-bold text-blue-700",children:"Parent Approved"})]}),a.jsxs("div",{className:"flex items-center gap-2 bg-purple-50 px-4 py-2 rounded-full border-2 border-purple-200",children:[a.jsx(Ut,{className:"w-5 h-5 text-purple-600"}),a.jsx("span",{className:"text-sm font-bold text-purple-700",children:"AI-Powered"})]})]})]}),a.jsxs(R.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{delay:.5},className:"hidden md:block relative",children:[a.jsx(R.div,{animate:{y:[-6,6,-6]},transition:{duration:5,repeat:1/0,ease:"easeInOut"},className:"relative z-10",children:a.jsx("div",{className:"bg-nanobanana-blue p-2 md:p-3 rounded-[1.5rem] md:rounded-[2rem] border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] md:shadow-[12px_12px_0px_0px_rgba(0,0,0,1)] transform rotate-2 hover:rotate-0 transition-transform duration-500",children:a.jsx("img",{src:"/assets/images/landing/hero-jeffrey-teaching.png",alt:"Jeffrey teaching kids",className:"w-full max-w-sm lg:max-w-lg rounded-xl border-4 border-black"})})}),a.jsx(R.div,{animate:{scale:[1,1.1,1],rotate:[0,5,0]},transition:{duration:4,repeat:1/0},className:"absolute -top-4 md:-top-8 -right-4 md:-right-8 w-16 md:w-24 h-16 md:h-24 bg-nanobanana-yellow rounded-full border-4 border-black z-0"}),a.jsx(R.div,{animate:{scale:[1,1.15,1]},transition:{duration:3,repeat:1/0,delay:.5},className:"absolute -bottom-4 md:-bottom-6 -left-4 md:-left-6 w-14 md:w-20 h-14 md:h-20 bg-pink-400 rounded-full border-4 border-black z-0"}),a.jsx(R.div,{animate:{y:[-5,5,-5]},transition:{duration:2.5,repeat:1/0},className:"absolute top-1/2 -right-2 md:-right-4 w-10 md:w-12 h-10 md:h-12 bg-nanobanana-green rounded-full border-4 border-black z-0"})]})]})})]})},Soe=({end:n,duration:e=2,suffix:t=""})=>{const[s,i]=N.useState(0),r=N.useRef(null),o=Dae(r,{once:!0});return N.useEffect(()=>{if(!o)return;let c;const d=h=>{c||(c=h);const u=Math.min((h-c)/(e*1e3),1),p=1-Math.pow(1-u,4);i(Math.floor(p*n)),u<1&&requestAnimationFrame(d)};requestAnimationFrame(d)},[o,n,e]),a.jsxs("span",{ref:r,children:[s.toLocaleString(),t]})},Coe=()=>{const n=[{icon:jW,value:1e4,suffix:"+",label:"Happy Families",color:"nanobanana-blue"},{icon:Ru,value:1e6,suffix:"+",label:"Questions Answered",color:"nanobanana-green"},{icon:Cr,value:4.9,suffix:"",label:"Star Rating",color:"nanobanana-yellow",isDecimal:!0}];return a.jsx("section",{className:"py-8 bg-gradient-to-r from-gray-50 to-gray-100 border-y-4 border-black",children:a.jsx("div",{className:"max-w-6xl mx-auto px-6",children:a.jsx("div",{className:"flex flex-wrap justify-center md:justify-between items-center gap-8",children:n.map((e,t)=>a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:t*.1},className:"flex items-center gap-4",children:[a.jsx(R.div,{whileHover:{scale:1.1,rotate:5},className:`w-14 h-14 bg-${e.color} rounded-2xl border-4 border-black flex items-center justify-center shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]`,style:{backgroundColor:e.color==="nanobanana-blue"?"#4169E1":e.color==="nanobanana-green"?"#32CD32":"#FFD700"},children:a.jsx(e.icon,{className:`w-7 h-7 ${e.color==="nanobanana-yellow"?"text-black":"text-white"}`})}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-3xl md:text-4xl font-black font-comic",children:[e.isDecimal?a.jsx("span",{children:e.value}):a.jsx(Soe,{end:e.value,suffix:e.suffix}),e.isDecimal&&a.jsx("span",{className:"text-nanobanana-yellow ml-1",children:[...Array(5)].map((s,i)=>a.jsx(Cr,{className:"w-4 h-4 inline fill-current"},i))})]}),a.jsx("div",{className:"text-gray-600 font-bold text-sm",children:e.label})]})]},e.label))})})})},Noe=({isTyping:n=!1,size:e="default"})=>{const t={small:"w-10 h-10",default:"w-16 h-16",large:"w-24 h-24",xlarge:"w-32 h-32"},s={y:{duration:2,repeat:1/0,repeatType:"reverse",ease:"easeInOut"}};return a.jsxs("div",{className:`relative ${t[e]||t.default} flex items-center justify-center`,children:[a.jsx(R.div,{className:"w-full h-full",animate:{y:[-3,3]},transition:s,children:a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey",className:"w-full h-full object-cover rounded-full border-4 border-black shadow-lg"})}),n&&a.jsx(R.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"absolute -bottom-1 -right-1 bg-white p-1.5 rounded-full border-2 border-black shadow-md",children:a.jsxs("div",{className:"flex gap-0.5",children:[a.jsx(R.div,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.5,delay:0},className:"w-1.5 h-1.5 bg-nanobanana-blue rounded-full"}),a.jsx(R.div,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.5,delay:.1},className:"w-1.5 h-1.5 bg-nanobanana-blue rounded-full"}),a.jsx(R.div,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.5,delay:.2},className:"w-1.5 h-1.5 bg-nanobanana-blue rounded-full"})]})})]})},joe=({flags:n=[],showDetails:e=!1})=>{const[t,s]=N.useState(!1),r=(()=>{if(n.length===0)return"safe";const p=["profanity","pii_detected","inappropriate_topic","manipulation_attempt"];return n.some(f=>p.includes(f))?"warning":"info"})(),c=(()=>{switch(r){case"safe":return{bg:"bg-green-50",border:"border-green-200",text:"text-green-700",icon:"text-green-500"};case"warning":return{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-700",icon:"text-amber-500"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-700",icon:"text-blue-500"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-700",icon:"text-gray-500"}}})(),d=()=>{switch(r){case"safe":return a.jsx(Iu,{className:`w-4 h-4 ${c.icon}`});case"warning":return a.jsx(cM,{className:`w-4 h-4 ${c.icon}`});default:return a.jsx(bW,{className:`w-4 h-4 ${c.icon}`})}},h=()=>{switch(r){case"safe":return"Safe Mode";case"warning":return"Content Filtered";default:return"Safety Active"}},u=p=>({profanity:"Language filtered",pii_detected:"Personal info protected",inappropriate_topic:"Topic redirected",manipulation_attempt:"Safety check",inappropriate_content:"Content filtered",external_links:"Links removed",message_too_long:"Message length",low_educational_value:"Enhanced response",language_too_complex:"Simplified language"})[p]||p.replace(/_/g," ");return a.jsxs("div",{className:`rounded-lg border ${c.bg} ${c.border} transition-all duration-200`,children:[a.jsxs("button",{onClick:()=>e&&s(!t),className:`
          flex items-center gap-2 px-3 py-1.5 w-full
          ${e&&n.length>0?"cursor-pointer":"cursor-default"}
        `,disabled:!e||n.length===0,children:[a.jsx(d,{}),a.jsx("span",{className:`text-xs font-medium ${c.text}`,children:h()}),e&&n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:`
              ml-1 px-1.5 py-0.5 rounded-full text-[10px] font-semibold
              ${r==="warning"?"bg-amber-200 text-amber-800":"bg-blue-200 text-blue-800"}
            `,children:n.length}),a.jsx("span",{className:"ml-auto",children:t?a.jsx(CE,{className:`w-3 h-3 ${c.icon}`}):a.jsx(SE,{className:`w-3 h-3 ${c.icon}`})})]})]}),e&&t&&n.length>0&&a.jsxs("div",{className:`px-3 pb-2 pt-1 border-t ${c.border}`,children:[a.jsx("p",{className:`text-xs ${c.text} mb-1.5`,children:"Safety checks detected:"}),a.jsx("ul",{className:"space-y-1",children:n.map((p,f)=>a.jsxs("li",{className:`text-xs ${c.text} flex items-center gap-1.5`,children:[a.jsx("span",{className:"w-1 h-1 rounded-full bg-current"}),u(p)]},f))})]})]})},AW=({flashcards:n=[],onComplete:e,expanded:t=!1})=>{const[s,i]=N.useState(0),[r,o]=N.useState(!1),[c,d]=N.useState(new Set);if(!n||n.length===0)return a.jsx("div",{className:"p-4 bg-gray-100 rounded-xl text-center text-gray-500",children:"No flashcards available"});const h=n[s],u=(c.size/n.length*100).toFixed(0),p=()=>{o(!1),setTimeout(()=>{i(y=>(y+1)%n.length)},150)},f=()=>{o(!1),setTimeout(()=>{i(y=>(y-1+n.length)%n.length)},150)},m=()=>{o(!r)},x=()=>{const y=new Set(c);y.add(h.id),d(y),y.size===n.length&&e?e():p()},g=()=>{p()},b=y=>{switch(y){case"easy":return"bg-green-100 text-green-700";case"hard":return"bg-red-100 text-red-700";default:return"bg-yellow-100 text-yellow-700"}};return a.jsxs("div",{className:`w-full mx-auto ${t?"max-w-2xl":"max-w-md"}`,children:[a.jsxs("div",{className:`${t?"mb-6":"mb-3"}`,children:[a.jsxs("div",{className:`flex justify-between font-bold text-gray-600 mb-1 ${t?"text-sm":"text-xs"}`,children:[a.jsxs("span",{children:["Card ",s+1," of ",n.length]}),a.jsxs("span",{children:[u,"% learned"]})]}),a.jsx("div",{className:`bg-gray-200 rounded-full overflow-hidden ${t?"h-3":"h-2"}`,children:a.jsx(R.div,{className:"h-full bg-nanobanana-green",initial:{width:0},animate:{width:`${u}%`},transition:{duration:.3}})})]}),a.jsx("div",{className:`relative cursor-pointer perspective-1000 ${t?"h-72":"h-48"}`,onClick:m,children:a.jsxs(R.div,{className:"w-full h-full",animate:{rotateY:r?180:0},transition:{duration:.4,ease:"easeInOut"},style:{transformStyle:"preserve-3d"},children:[a.jsxs("div",{className:`absolute inset-0 bg-white border-3 border-black rounded-2xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex flex-col justify-center items-center backface-hidden ${r?"invisible":""} ${t?"p-8":"p-4"}`,children:[a.jsx("div",{className:`absolute ${t?"top-4 right-4":"top-2 right-2"}`,children:a.jsx("span",{className:`font-bold px-2 py-0.5 rounded-full ${b(h.difficulty)} ${t?"text-xs":"text-[10px]"}`,children:h.difficulty||"medium"})}),a.jsx("p",{className:`text-center font-bold ${t?"text-2xl px-4":"text-lg"}`,children:h.front}),h.hint&&a.jsxs("p",{className:`text-gray-400 mt-3 italic ${t?"text-sm":"text-xs"}`,children:["Hint: ",h.hint]}),a.jsx("p",{className:`text-gray-400 mt-4 ${t?"text-xs":"text-[10px]"}`,children:"Tap to flip"})]}),a.jsxs("div",{className:`absolute inset-0 bg-nanobanana-yellow border-3 border-black rounded-2xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex flex-col justify-center items-center backface-hidden ${r?"":"invisible"} ${t?"p-8":"p-4"}`,style:{transform:"rotateY(180deg)"},children:[a.jsx("p",{className:`text-center font-bold ${t?"text-2xl px-4":"text-lg"}`,children:h.back}),c.has(h.id)&&a.jsx("div",{className:`absolute ${t?"top-4 right-4":"top-2 right-2"}`,children:a.jsx(bo,{className:`text-green-600 ${t?"w-6 h-6":"w-5 h-5"}`})})]})]})}),a.jsxs("div",{className:`flex justify-between items-center ${t?"mt-6":"mt-4"}`,children:[a.jsx("button",{onClick:f,className:`bg-gray-100 border-2 border-black rounded-lg hover:bg-gray-200 transition-colors ${t?"p-3":"p-2"}`,children:a.jsx(X1,{className:t?"w-6 h-6":"w-5 h-5"})}),a.jsxs("div",{className:`flex ${t?"gap-4":"gap-2"}`,children:[a.jsxs("button",{onClick:g,className:`flex items-center gap-1 bg-red-100 border-2 border-black rounded-lg hover:bg-red-200 transition-colors font-bold ${t?"px-5 py-3 text-base":"px-3 py-2 text-sm"}`,children:[a.jsx(on,{className:t?"w-5 h-5":"w-4 h-4"}),"Still learning"]}),a.jsxs("button",{onClick:x,className:`flex items-center gap-1 bg-green-100 border-2 border-black rounded-lg hover:bg-green-200 transition-colors font-bold ${t?"px-5 py-3 text-base":"px-3 py-2 text-sm"}`,children:[a.jsx(bo,{className:t?"w-5 h-5":"w-4 h-4"}),"Got it!"]})]}),a.jsx("button",{onClick:p,className:`bg-gray-100 border-2 border-black rounded-lg hover:bg-gray-200 transition-colors ${t?"p-3":"p-2"}`,children:a.jsx(No,{className:t?"w-6 h-6":"w-5 h-5"})})]}),a.jsx(Ie,{children:c.size===n.length&&a.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:"mt-4 p-3 bg-green-100 border-2 border-green-400 rounded-xl text-center",children:[a.jsx("p",{className:"font-bold text-green-700",children:"Amazing! You've learned all the cards!"}),a.jsxs("button",{onClick:()=>{d(new Set),i(0),o(!1)},className:"mt-2 flex items-center gap-1 mx-auto px-3 py-1 bg-white border-2 border-black rounded-lg text-sm font-bold hover:bg-gray-100",children:[a.jsx(L1,{className:"w-4 h-4"}),"Practice again"]})]})})]})},EW=({summary:n})=>{if(!n)return a.jsx("div",{className:"p-4 bg-gray-100 rounded-xl text-center text-gray-500",children:"No summary available"});const{title:e,overview:t,keyPoints:s=[],vocabulary:i=[],funFacts:r=[],takeaway:o}=n,c={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},d={hidden:{opacity:0,y:10},visible:{opacity:1,y:0}};return a.jsxs(R.div,{className:"w-full max-w-lg space-y-4",variants:c,initial:"hidden",animate:"visible",children:[e&&a.jsxs(R.div,{variants:d,className:"flex items-center gap-2 p-3 bg-nanobanana-blue text-white rounded-xl border-2 border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx(js,{className:"w-6 h-6 flex-shrink-0"}),a.jsx("h3",{className:"font-bold text-lg",children:e})]}),t&&a.jsx(R.div,{variants:d,className:"p-3 bg-white rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:a.jsx("p",{className:"text-sm leading-relaxed",children:t})}),s.length>0&&a.jsxs(R.div,{variants:d,className:"p-3 bg-nanobanana-yellow rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(hm,{className:"w-5 h-5"}),a.jsx("h4",{className:"font-bold",children:"Key Points"})]}),a.jsx("ul",{className:"space-y-2",children:s.map((h,u)=>a.jsxs(R.li,{variants:d,className:"flex items-start gap-2 text-sm",children:[a.jsx("span",{className:"flex-shrink-0 w-5 h-5 bg-black text-white rounded-full flex items-center justify-center text-xs font-bold",children:u+1}),a.jsx("span",{children:h})]},u))})]}),i.length>0&&a.jsxs(R.div,{variants:d,className:"p-3 bg-nanobanana-green rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(wW,{className:"w-5 h-5"}),a.jsx("h4",{className:"font-bold",children:"New Words"})]}),a.jsx("div",{className:"space-y-2",children:i.map((h,u)=>a.jsxs(R.div,{variants:d,className:"p-2 bg-white/50 rounded-lg",children:[a.jsx("span",{className:"font-bold text-sm",children:h.term}),a.jsxs("span",{className:"text-sm",children:[" - ",h.definition]})]},u))})]}),r.length>0&&a.jsxs(R.div,{variants:d,className:"p-3 bg-pink-200 rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(qL,{className:"w-5 h-5"}),a.jsx("h4",{className:"font-bold",children:"Fun Facts!"})]}),a.jsx("ul",{className:"space-y-2",children:r.map((h,u)=>a.jsxs(R.li,{variants:d,className:"flex items-start gap-2 text-sm",children:[a.jsx(Cr,{className:"w-4 h-4 flex-shrink-0 text-yellow-600 fill-yellow-400"}),a.jsx("span",{children:h})]},u))})]}),o&&a.jsx(R.div,{variants:d,className:"p-3 bg-purple-200 rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-2xl",children:""}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-sm",children:"Remember This!"}),a.jsx("p",{className:"text-sm",children:o})]})]})})]})},kW=({quiz:n,onComplete:e})=>{const[t,s]=N.useState(0),[i,r]=N.useState(null),[o,c]=N.useState(!1),[d,h]=N.useState(0),[u,p]=N.useState([]),[f,m]=N.useState(!1),[x,g]=N.useState(!1);if(!n||!n.questions||n.questions.length===0)return a.jsx("div",{className:"p-4 bg-gray-100 rounded-xl text-center text-gray-500",children:"No quiz available"});const{title:b,questions:y}=n,C=y[t],w=y.length,S=t===w-1,j=P=>{if(o)return;r(P),c(!0);const I=P===C.correctAnswer;I&&h(M=>M+1),p(M=>[...M,{questionIndex:t,selected:P,correct:C.correctAnswer,isCorrect:I}])},T=()=>{S?(m(!0),e&&e({score:d,total:w})):(s(P=>P+1),r(null),c(!1))},k=()=>{s(0),r(null),c(!1),h(0),p([]),m(!1),g(!1)},_=P=>o?P===C.correctAnswer?"bg-green-100 border-green-500":i===P&&P!==C.correctAnswer?"bg-red-100 border-red-500":"bg-gray-50 opacity-60":i===P?"bg-purple-100 border-purple-500":"bg-white hover:bg-gray-50",L=()=>Math.round(d/w*100),D=()=>{const P=L();return P===100?{emoji:"",text:"Perfect score! You're amazing!",color:"from-yellow-400 to-orange-500"}:P>=80?{emoji:"",text:"Excellent work! You really know your stuff!",color:"from-green-400 to-emerald-500"}:P>=60?{emoji:"",text:"Good job! Keep learning!",color:"from-blue-400 to-indigo-500"}:P>=40?{emoji:"",text:"Nice try! Review the lesson and try again!",color:"from-purple-400 to-purple-600"}:{emoji:"",text:"Keep practicing! You'll get there!",color:"from-pink-400 to-rose-500"}};if(f){const P=D();return a.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"w-full max-w-lg space-y-4",children:[a.jsxs("div",{className:`bg-gradient-to-br ${P.color} text-white p-6 rounded-2xl border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] text-center`,children:[a.jsx(R.div,{className:"text-6xl mb-2",initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.2},children:P.emoji}),a.jsxs(R.div,{className:"text-5xl font-black mb-1",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[d,"/",w]}),a.jsxs("div",{className:"text-xl font-bold opacity-90",children:[L(),"% Correct"]}),a.jsx("p",{className:"mt-3 text-base font-medium",children:P.text})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-black",children:[a.jsxs("h4",{className:"font-bold text-sm mb-3 flex items-center gap-2",children:[a.jsx("span",{children:""})," Your Answers"]}),a.jsx("div",{className:"grid grid-cols-5 gap-2",children:u.map((I,M)=>a.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{delay:M*.1},className:`w-10 h-10 rounded-lg flex items-center justify-center font-bold text-sm border-2 ${I.isCorrect?"bg-green-100 border-green-400 text-green-700":"bg-red-100 border-red-400 text-red-700"}`,children:I.isCorrect?a.jsx(bo,{className:"w-5 h-5"}):a.jsx(on,{className:"w-5 h-5"})},M))})]}),a.jsxs("button",{onClick:()=>g(!x),className:"w-full flex items-center justify-between p-3 bg-blue-50 border-2 border-blue-200 rounded-xl hover:bg-blue-100 transition-colors font-bold text-blue-700",children:[a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(js,{className:"w-5 h-5"}),"Answer Key"]}),x?a.jsx(CE,{className:"w-5 h-5"}):a.jsx(SE,{className:"w-5 h-5"})]}),a.jsx(Ie,{children:x&&a.jsx(R.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-black space-y-4 max-h-[400px] overflow-y-auto",children:[a.jsxs("h4",{className:"font-bold text-lg flex items-center gap-2 text-gray-800 sticky top-0 bg-white py-2",children:[a.jsx("span",{children:""})," Complete Answer Key"]}),y.map((I,M)=>{const O=u[M],F=O==null?void 0:O.isCorrect;return a.jsxs("div",{className:`p-4 rounded-xl border-2 ${F?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[a.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[a.jsxs("span",{className:`px-2 py-1 rounded-lg text-xs font-bold ${F?"bg-green-200 text-green-700":"bg-red-200 text-red-700"}`,children:["Q",M+1]}),a.jsx("p",{className:"font-medium text-gray-800 flex-1",children:I.question})]}),a.jsx("div",{className:"ml-8 space-y-1 text-sm",children:I.options.map((B,U)=>a.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg ${U===I.correctAnswer?"bg-green-100 font-bold text-green-800":U===(O==null?void 0:O.selected)&&!F?"bg-red-100 text-red-600 line-through":"text-gray-600"}`,children:[a.jsx("span",{className:"w-5 h-5 flex items-center justify-center rounded-full bg-gray-200 text-xs font-bold",children:String.fromCharCode(65+U)}),B,U===I.correctAnswer&&a.jsx(bo,{className:"w-4 h-4 text-green-600 ml-auto"})]},U))}),I.explanation&&a.jsx("div",{className:"mt-3 ml-8 p-2 bg-blue-50 rounded-lg border border-blue-200",children:a.jsxs("p",{className:"text-xs text-blue-700",children:[a.jsx("span",{className:"font-bold",children:" Explanation:"})," ",I.explanation]})})]},M)})]})})}),a.jsx("div",{className:"flex gap-3",children:a.jsxs("button",{onClick:k,className:"flex-1 flex items-center justify-center gap-2 p-3 bg-purple-500 text-white border-2 border-black rounded-xl hover:bg-purple-600 transition-colors shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none font-bold",children:[a.jsx(L1,{className:"w-5 h-5"}),"Try Again"]})})]})}return a.jsxs("div",{className:"w-full max-w-lg space-y-4",children:[a.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 p-4 rounded-xl text-white",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"font-bold text-lg",children:b||" Quiz Time!"}),a.jsxs("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm font-bold",children:[t+1," / ",w]})]}),a.jsx("div",{className:"h-3 bg-white/30 rounded-full overflow-hidden",children:a.jsx(R.div,{className:"h-full bg-white",initial:{width:0},animate:{width:`${(t+(o?1:0))/w*100}%`},transition:{duration:.3}})}),a.jsxs("div",{className:"flex justify-between mt-2 text-xs opacity-80",children:[a.jsxs("span",{children:["Score: ",d," correct"]}),a.jsxs("span",{children:[w-t-(o?1:0)," remaining"]})]})]}),a.jsx(Ie,{mode:"wait",children:a.jsxs(R.div,{initial:{opacity:0,x:20,rotateY:10},animate:{opacity:1,x:0,rotateY:0},exit:{opacity:0,x:-20,rotateY:-10},transition:{duration:.3},className:"bg-white p-5 rounded-2xl border-3 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsxs("div",{className:"flex items-start gap-3 mb-5",children:[a.jsx("span",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center text-white font-black text-lg border-2 border-black",children:t+1}),a.jsx("p",{className:"font-bold text-base text-gray-800 pt-2",children:C.question})]}),a.jsx("div",{className:"space-y-3",children:C.options.map((P,I)=>a.jsx(R.button,{onClick:()=>j(I),disabled:o,className:`w-full text-left p-4 rounded-xl border-2 border-black transition-all text-sm font-medium ${_(I)}`,whileHover:o?{}:{scale:1.02,x:4},whileTap:o?{}:{scale:.98},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:`w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold border-2 ${o&&I===C.correctAnswer?"bg-green-500 text-white border-green-600":o&&i===I?"bg-red-500 text-white border-red-600":"bg-gray-100 border-gray-300"}`,children:String.fromCharCode(65+I)}),a.jsx("span",{className:"flex-1",children:P}),o&&I===C.correctAnswer&&a.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring"},children:a.jsx(bo,{className:"w-6 h-6 text-green-600"})}),o&&i===I&&I!==C.correctAnswer&&a.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring"},children:a.jsx(on,{className:"w-6 h-6 text-red-600"})})]})},I))})]},t)}),a.jsx(Ie,{children:o&&a.jsxs(R.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10},className:`p-4 rounded-xl border-2 ${i===C.correctAnswer?"bg-gradient-to-r from-green-100 to-emerald-100 border-green-400":"bg-gradient-to-r from-amber-100 to-orange-100 border-amber-400"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("span",{className:"text-2xl",children:i===C.correctAnswer?"":""}),a.jsx("p",{className:"text-base font-bold",children:i===C.correctAnswer?"Correct!":"Not quite!"})]}),C.explanation&&a.jsx("p",{className:"text-sm text-gray-700 ml-9",children:C.explanation}),C.encouragement&&a.jsx("p",{className:"text-sm text-gray-600 mt-2 ml-9 italic",children:C.encouragement})]})}),o&&a.jsx(R.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:T,className:"w-full flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-purple-500 to-indigo-500 text-white border-2 border-black rounded-xl hover:from-purple-600 hover:to-indigo-600 transition-all shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none font-bold text-lg",children:S?a.jsxs(a.Fragment,{children:[a.jsx(K1,{className:"w-6 h-6"}),"See Results"]}):a.jsxs(a.Fragment,{children:["Next Question",a.jsx(No,{className:"w-6 h-6"})]})})]})},Aoe=({isOpen:n,onClose:e,type:t,data:s})=>{if(!n)return null;const i=()=>{switch(t){case"flashcards":return a.jsx("div",{className:"w-full max-w-3xl min-w-[500px] px-4",children:a.jsx(AW,{flashcards:s,expanded:!0})});case"infographic":return a.jsxs("div",{className:"w-full max-w-4xl",children:[a.jsx("img",{src:`data:${s.mimeType||"image/png"};base64,${s.imageData}`,alt:"Lesson infographic",className:"w-full max-h-[80vh] object-contain rounded-2xl border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]"}),s.text&&a.jsx("p",{className:"mt-4 text-center text-gray-600 font-medium",children:s.text})]});case"summary":return a.jsx("div",{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto no-scrollbar",children:a.jsx(EW,{summary:s})});case"quiz":return a.jsx("div",{className:"w-full max-w-2xl max-h-[85vh] overflow-y-auto no-scrollbar p-2",children:a.jsx(kW,{quiz:s})});case"image":return a.jsxs("div",{className:"w-full max-w-4xl",children:[a.jsx("img",{src:`data:${s.mimeType||"image/png"};base64,${s.imageData}`,alt:"Jeffrey's drawing",className:"w-full max-h-[80vh] object-contain rounded-2xl border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]"}),s.text&&a.jsx("p",{className:"mt-4 text-center text-gray-700 font-medium",children:s.text})]});default:return null}};return a.jsx(Ie,{children:n&&a.jsxs(R.div,{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[a.jsx(R.div,{className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:e,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}),a.jsxs(R.div,{className:"relative z-10 bg-white rounded-3xl p-6 border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] max-h-[90vh] overflow-hidden",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",damping:25,stiffness:300},children:[a.jsx("button",{onClick:e,className:"absolute -top-3 -right-3 p-2 bg-red-500 text-white border-3 border-black rounded-full shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:bg-red-600 transition-colors z-20","aria-label":"Close expanded view",children:a.jsx(on,{className:"w-6 h-6",strokeWidth:3})}),a.jsx("div",{className:"flex items-center justify-center",children:i()})]})]})})};function l3(){const{startProcessing:n,updateProgress:e,setProcessingStage:t,addLesson:s,setError:i,resetProcessing:r,currentLesson:o,updateLesson:c}=Hu(),d=N.useCallback(async({source:b,sourceType:y,extractText:C,analyzeContent:w,onComplete:S})=>{try{n(),t("extracting");const j=await C(b);e(40),t("analyzing");const T=await w(j);e(70),t("generating");const k={source:{type:y,originalName:b.name||"YouTube Video",fileSize:b.size,mimeType:b.type},rawText:j,...T};e(90);const _=s(k);return S&&S(_),_}catch(j){throw i({message:j.message||"Failed to process upload",code:j.code||"PROCESSING_ERROR",timestamp:new Date().toISOString()}),j}},[n,t,e,s,i]),h=N.useCallback(()=>{var b,y,C,w,S,j,T,k,_;return o?{title:o.title,subject:o.subject,gradeLevel:o.gradeLevel,summary:o.summary||((b=o.content)==null?void 0:b.summary),keyConcepts:o.keyConceptsForChat||((y=o.content)==null?void 0:y.keyPoints)||[],vocabulary:o.vocabulary||((C=o.content)==null?void 0:C.vocabulary)||[],currentChapter:((S=(w=o.chapters)==null?void 0:w[0])==null?void 0:S.title)||((k=(T=(j=o.content)==null?void 0:j.chapters)==null?void 0:T[0])==null?void 0:k.title)||null,rawText:o.rawText||((_=o.content)==null?void 0:_.rawText)||""}:null},[o]),u=N.useCallback(()=>{var y,C,w,S;const b=h();return b?`
Current Lesson Context:
- Title: ${b.title||"Untitled"}
- Subject: ${b.subject||"General"}
- Grade Level: ${b.gradeLevel||"Not specified"}
- Summary: ${b.summary||"No summary available"}
- Key Concepts: ${((y=b.keyConcepts)==null?void 0:y.join(", "))||"None"}
- Vocabulary Terms: ${((C=b.vocabulary)==null?void 0:C.map(j=>j.term||j).join(", "))||"None"}

Lesson Content:
${((w=b.rawText)==null?void 0:w.substring(0,2e3))||"No content available"}
${((S=b.rawText)==null?void 0:S.length)>2e3?`
[Content truncated...]`:""}
    `.trim():""},[h]),p=N.useCallback(b=>{if(!o)return;const y=o.chatHistory||[];c(o.id,{chatHistory:[...y,{...b,timestamp:new Date().toISOString()}].slice(-50)})},[o,c]),f=N.useCallback(()=>{var C;if(!o)return["What should I learn today?","Can you explain this concept?","Give me a fun fact!","Help me with my homework!"];if(((C=o.suggestedQuestions)==null?void 0:C.length)>0)return o.suggestedQuestions;const b=o.subject||"this topic",y=o.title||"the lesson";return[`What's the main idea of ${y}?`,`Can you explain the key concepts in ${b}?`,`Give me a quiz about ${y}!`,"What vocabulary words should I know?"]},[o]),m=N.useCallback(()=>{r()},[r]),x=N.useCallback(b=>{if(!b||b<60)return"Less than a minute";const y=Math.floor(b/60),C=Math.floor(y/60);if(C>0){const w=y%60;return`${C}h ${w}m`}return`${y} minutes`},[]),g=N.useCallback(()=>{var b;return(b=o==null?void 0:o.progress)!=null&&b.timeSpent?x(o.progress.timeSpent):"Just started"},[o,x]);return{processUpload:d,getChatContext:h,getChatContextString:u,addChatMessage:p,getSuggestedQuestions:f,cancelProcessing:m,formatTimeSpent:x,getCurrentLessonTimeSpent:g}}const K$=3,pM=({demoMode:n=!1,lesson:e=null,onInteraction:t,initialInput:s="",onInputChange:i})=>{const[r,o]=N.useState(s),c=N.useRef(null),d=N.useRef(null),h=Qt(),[u,p]=N.useState(0),[f,m]=N.useState(!1),[x]=N.useState(()=>`demo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),g=Hu(),{isReady:b,currentStageInfo:y,isProcessing:C}=g||{};let w=null;try{w=Qte()}catch{}const{getCurrentLessonTimeSpent:S}=l3(),j=e||(g==null?void 0:g.currentLesson),[T,k]=N.useState([]),[_,L]=N.useState(!1),[D,P]=N.useState(!1),[I,M]=N.useState(!1),[O,F]=N.useState(!1),[B,U]=N.useState(!1),[$,G]=N.useState({isOpen:!1,type:null,data:null}),[ne,Z]=N.useState(!1),K=(se,pe)=>{G({isOpen:!0,type:se,data:pe})},X=()=>{G({isOpen:!1,type:null,data:null})},V=(w==null?void 0:w.messages)||T,q=(w==null?void 0:w.isLoading)&&!(w!=null&&w.isStreaming),ee=(w==null?void 0:w.isStreaming)||!1,ie=(w==null?void 0:w.safetyFlags)||[],Re=w==null?void 0:w.error,Ye=(w==null?void 0:w.suggestedQuestions)||[];N.useEffect(()=>{s&&s!==r&&o(s)},[s]);const Le=se=>{o(se),i&&i(se)};N.useEffect(()=>{var se;n||(se=c.current)==null||se.scrollIntoView({behavior:"smooth",block:"nearest"})},[V,n]),N.useEffect(()=>{n&&k([{id:1,role:"assistant",content:`Hi there! I'm Jeffrey, your learning buddy! Ask me anything you'd like to learn about - try questions like "What are black holes?" or "How do plants grow?" `,timestamp:new Date}])},[n]);const te=async()=>{if(!r.trim()||n&&f)return;const se=r;if(Le(""),w!=null&&w.sendMessage)await w.sendMessage(se);else if(n){const pe={id:Date.now(),role:"user",content:se,timestamp:new Date};k(Be=>[...Be,pe]);const Ue=u+1;if(p(Ue),Ue>=K$){m(!0),L(!0),setTimeout(()=>{k(Be=>[...Be,{id:Date.now()+1,role:"assistant",content:"I'm having so much fun chatting with you!  To keep learning together, sign up for free - it only takes a minute!",timestamp:new Date,isLimitMessage:!0}]),L(!1)},800);return}L(!0);try{const Be=T.filter(ze=>ze.role==="user"||ze.role==="assistant").slice(-6).map(ze=>({role:ze.role,content:ze.content})),je=await yy.sendDemoMessage({message:se,conversationHistory:Be,sessionId:x});k(ze=>{var Ft;return[...ze,{id:Date.now()+1,role:"assistant",content:((Ft=je.data)==null?void 0:Ft.reply)||je.reply||"That's a great question! I'd love to explore that with you.",timestamp:new Date}]})}catch(Be){console.error("Demo chat error:",Be),k(je=>[...je,{id:Date.now()+1,role:"assistant",content:fe(se),timestamp:new Date}])}finally{L(!1)}}t&&t(),n||setTimeout(()=>{var pe;(pe=d.current)==null||pe.focus()},100)},fe=se=>{const pe=se.toLowerCase();return pe.includes("hello")||pe.includes("hi ")||pe==="hi"?"Hello!  I'm so happy to meet you! What would you like to learn about today?":pe.includes("sun")||pe.includes("star")?"The Sun is amazing! It's a giant ball of hot gas that gives us light and warmth. Did you know it's so big that about 1.3 million Earths could fit inside it? ":pe.includes("dinosaur")?"Dinosaurs are so cool! They lived millions of years ago and came in all sizes - from tiny ones the size of chickens to massive ones like T-Rex! ":pe.includes("space")||pe.includes("planet")?"Space is incredible! Our solar system has 8 planets, and Earth is the only one we know has life. There are billions of stars in our galaxy! ":pe.includes("animal")||pe.includes("dog")||pe.includes("cat")?"Animals are fascinating! Each species has unique adaptations that help them survive. What's your favorite animal? I'd love to tell you fun facts about it! ":"That's a fantastic question! I love curious minds. Want to explore this topic together? Sign up to continue our learning adventure! "},Ne=se=>{var pe;Le(se),(pe=d.current)==null||pe.focus()},Pe=se=>{se.key==="Enter"&&!se.shiftKey&&(se.preventDefault(),te())},nt=()=>{w!=null&&w.clearChat?w.clearChat():n&&k([{id:Date.now(),role:"assistant",content:"Hi! I'm Jeffrey. What would you like to learn about?",timestamp:new Date}])},gt=()=>{w!=null&&w.retryLastMessage&&w.retryLastMessage()},hs=()=>{const se=localStorage.getItem("current_profile_id"),pe=localStorage.getItem("demo_children");if(se&&pe)try{const Be=JSON.parse(pe).find(je=>je.id===se);if(Be)return{childId:Be.id,ageGroup:Be.age<=7?"YOUNG":"OLDER"}}catch(Ue){console.error("Error parsing child context:",Ue)}return{childId:null,ageGroup:"OLDER"}},qs=async()=>{var Ue;if(!j||D)return;P(!0);const{childId:se,ageGroup:pe}=hs();try{const Be=j.rawText||((Ue=j.content)==null?void 0:Ue.rawText)||j.summary||"",ze=(await yy.generateFlashcards({content:Be,count:5,childId:se,ageGroup:pe})).data||[],Ft={id:Date.now(),role:"user",content:" Generate flashcards for this lesson",timestamp:new Date},Bt={id:Date.now()+1,role:"assistant",content:"",timestamp:new Date,type:"flashcards",flashcards:ze};n?k(Ys=>[...Ys,Ft,Bt]):w!=null&&w.addMessages&&w.addMessages([Ft,Bt])}catch(Be){console.error("Flashcard generation error:",Be);const je={id:Date.now(),role:"assistant",content:"Oops! I couldn't create flashcards right now. Try asking me to explain the lesson instead!",timestamp:new Date,isError:!0};n?k(ze=>[...ze,je]):w!=null&&w.addMessage&&w.addMessage(je)}finally{P(!1)}},Cn=async()=>{var Ue,Be;if(!j||I)return;M(!0);const{childId:se,ageGroup:pe}=hs();try{const je=j.rawText||((Ue=j.content)==null?void 0:Ue.rawText)||j.summary||"",Ft=(await yy.generateInfographic({content:je,title:j.title,keyConcepts:j.keyConceptsForChat||((Be=j.chapters)==null?void 0:Be.map(In=>In.title)),childId:se,ageGroup:pe})).data,Bt={id:Date.now(),role:"user",content:" Create an infographic for this lesson",timestamp:new Date},Ys={id:Date.now()+1,role:"assistant",content:Ft.description||"Here's your infographic!",timestamp:new Date,type:"infographic",imageData:Ft.imageData,mimeType:Ft.mimeType};n?k(In=>[...In,Bt,Ys]):w!=null&&w.addMessages&&w.addMessages([Bt,Ys])}catch(je){console.error("Infographic generation error:",je);const ze={id:Date.now(),role:"assistant",content:"Oops! I couldn't create the infographic right now. Image generation might not be available. Try the Summary instead!",timestamp:new Date,isError:!0};n?k(Ft=>[...Ft,ze]):w!=null&&w.addMessage&&w.addMessage(ze)}finally{M(!1)}},ni=async()=>{var Ue;if(!j||O)return;F(!0);const{childId:se,ageGroup:pe}=hs();try{const Be=j.rawText||((Ue=j.content)==null?void 0:Ue.rawText)||j.summary||"",ze=(await yy.generateSummary({content:Be,title:j.title,childId:se,ageGroup:pe})).data,Ft={id:Date.now(),role:"user",content:" Summarize this lesson for me",timestamp:new Date},Bt={id:Date.now()+1,role:"assistant",content:"",timestamp:new Date,type:"summary",summary:ze};n?k(Ys=>[...Ys,Ft,Bt]):w!=null&&w.addMessages&&w.addMessages([Ft,Bt])}catch(Be){console.error("Summary generation error:",Be);const je={id:Date.now(),role:"assistant",content:"Oops! I couldn't create the summary right now. Try asking me about specific parts of the lesson!",timestamp:new Date,isError:!0};n?k(ze=>[...ze,je]):w!=null&&w.addMessage&&w.addMessage(je)}finally{F(!1)}},Ji=async()=>{var Ue;if(!j||B)return;U(!0);const{childId:se,ageGroup:pe}=hs();try{const Be=j.rawText||((Ue=j.content)==null?void 0:Ue.rawText)||j.summary||"";console.log("[Quiz] Generating quiz for content length:",Be.length);const je=await yy.generateQuiz({content:Be,title:j.title,count:5,childId:se,ageGroup:pe});console.log("[Quiz] API Response:",je);const ze=je.data;if(console.log("[Quiz] Quiz data:",ze),!ze||!ze.questions||ze.questions.length===0)throw new Error("Invalid quiz data received");const Ft={id:Date.now(),role:"user",content:" Quiz me on this lesson!",timestamp:new Date},Bt={id:Date.now()+1,role:"assistant",content:"",timestamp:new Date,type:"quiz",quiz:ze};console.log("[Quiz] Adding messages, demoMode:",n,"chatContext:",!!w),n?k(Ys=>[...Ys,Ft,Bt]):w!=null&&w.addMessages?w.addMessages([Ft,Bt]):(console.warn("[Quiz] No chatContext, using fallback"),k(Ys=>[...Ys,Ft,Bt]))}catch(Be){console.error("Quiz generation error:",Be);const je={id:Date.now(),role:"assistant",content:"Oops! I couldn't create a quiz right now. Try asking me questions about the lesson instead!",timestamp:new Date,isError:!0};n?k(ze=>[...ze,je]):w!=null&&w.addMessage?w.addMessage(je):k(ze=>[...ze,je])}finally{U(!1)}},Si=D||I||O||B,Ci=!n&&!j&&!C,ce=Ci||(w==null?void 0:w.isLoading),ye=V.map(se=>{var pe,Ue;return{id:se.id||((pe=se.timestamp)==null?void 0:pe.getTime())||Date.now(),type:se.role==="user"?"user":"bot",text:se.content,isStreaming:se.isStreaming,isError:se.isError,safetyFlags:(Ue=se.metadata)==null?void 0:Ue.safetyFlags,messageType:se.type||"text",flashcards:se.flashcards,summary:se.summary,quiz:se.quiz,imageData:se.imageData,mimeType:se.mimeType}});return a.jsxs("div",{className:`flex-1 flex flex-col bg-white rounded-2xl md:rounded-3xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] md:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] border-3 md:border-4 border-black overflow-hidden ${n?"h-full":""}`,children:[a.jsxs("div",{className:"bg-nanobanana-yellow border-b-4 border-black p-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:n?"scale-75 origin-left":"",children:a.jsx(Noe,{})}),a.jsxs("div",{children:[a.jsx("h2",{className:"font-bold text-xl font-comic",children:"Chat with Jeffrey"}),a.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold opacity-70",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Online"]}),j&&a.jsxs("span",{className:"flex items-center gap-1 ml-2",children:[a.jsx(Pd,{className:"w-3 h-3"}),S()]})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[!n&&a.jsx(joe,{flags:ie,showDetails:!0}),!n&&V.length>1&&a.jsx("button",{onClick:nt,className:"p-2 hover:bg-black/10 rounded-full transition-colors",title:"Clear chat",children:a.jsx(um,{className:"w-5 h-5 text-gray-600"})}),!n&&a.jsx("button",{className:"p-2 hover:bg-black/10 rounded-full transition-colors",children:a.jsx(Ut,{className:"w-6 h-6"})})]})]}),a.jsx(Ie,{children:Re&&a.jsxs(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-amber-50 border-b-2 border-amber-200 px-4 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-amber-800",children:Re}),a.jsxs("button",{onClick:gt,className:"text-xs font-medium text-amber-700 hover:text-amber-900 flex items-center gap-1",children:[a.jsx(hoe,{className:"w-3 h-3"}),"Retry"]})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar",children:[ye.length===0&&(w==null?void 0:w.welcomeMessage)&&a.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-start",children:a.jsx("div",{className:"max-w-[80%] p-3 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] bg-gray-100 text-black rounded-bl-none",children:a.jsx("p",{className:"font-medium text-sm whitespace-pre-wrap",children:w.welcomeMessage})})}),ye.map((se,pe)=>a.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${se.type==="user"?"justify-end":"justify-start"}`,children:[se.messageType==="text"&&a.jsxs("div",{className:`max-w-[80%] p-3 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] ${se.type==="user"?"bg-nanobanana-blue text-white rounded-br-none":se.isError?"bg-red-50 text-red-800 rounded-bl-none border-red-300":"bg-gray-100 text-black rounded-bl-none"}`,children:[a.jsxs("p",{className:"font-medium text-sm whitespace-pre-wrap",children:[se.text,se.isStreaming&&a.jsx("span",{className:"inline-block w-1.5 h-4 ml-1 bg-current animate-pulse"})]}),se.safetyFlags&&se.safetyFlags.length>0&&a.jsx("div",{className:"mt-2 pt-2 border-t border-gray-300 flex items-center gap-1 text-xs text-gray-500",children:a.jsx("span",{children:"Content reviewed for safety"})})]}),se.messageType==="flashcards"&&se.flashcards&&a.jsxs("div",{className:"w-full max-w-md p-3 bg-gray-100 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] rounded-bl-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-600",children:[a.jsx(va,{className:"w-4 h-4"}),a.jsx("span",{children:"Flashcards for you!"})]}),a.jsx("button",{onClick:()=>K("flashcards",se.flashcards),className:"p-1.5 bg-white border-2 border-black rounded-lg hover:bg-nanobanana-yellow transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[1px] active:shadow-none",title:"Expand view",children:a.jsx(by,{className:"w-4 h-4"})})]}),a.jsx(AW,{flashcards:se.flashcards})]}),se.messageType==="summary"&&se.summary&&a.jsxs("div",{className:"w-full max-w-lg p-3 bg-gray-100 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] rounded-bl-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-600",children:[a.jsx(js,{className:"w-4 h-4"}),a.jsx("span",{children:"Here's your lesson summary!"})]}),a.jsx("button",{onClick:()=>K("summary",se.summary),className:"p-1.5 bg-white border-2 border-black rounded-lg hover:bg-nanobanana-yellow transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[1px] active:shadow-none",title:"Expand view",children:a.jsx(by,{className:"w-4 h-4"})})]}),a.jsx(EW,{summary:se.summary})]}),se.messageType==="infographic"&&se.imageData&&a.jsxs("div",{className:"w-full max-w-md p-3 bg-gray-100 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] rounded-bl-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-600",children:[a.jsx(P1,{className:"w-4 h-4"}),a.jsx("span",{children:"Here's your infographic!"})]}),a.jsx("button",{onClick:()=>K("infographic",{imageData:se.imageData,mimeType:se.mimeType,text:se.text}),className:"p-1.5 bg-white border-2 border-black rounded-lg hover:bg-nanobanana-yellow transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[1px] active:shadow-none",title:"Expand view",children:a.jsx(by,{className:"w-4 h-4"})})]}),a.jsx("img",{src:`data:${se.mimeType||"image/png"};base64,${se.imageData}`,alt:"Lesson infographic",className:"w-full rounded-xl border-2 border-black"}),se.text&&a.jsx("p",{className:"mt-2 text-sm text-gray-600",children:se.text})]}),se.messageType==="image"&&se.imageData&&a.jsxs("div",{className:"w-full max-w-md p-3 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] rounded-bl-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-purple-600",children:[a.jsx(Ut,{className:"w-4 h-4"}),a.jsx("span",{children:"Jeffrey drew this for you!"})]}),a.jsx("button",{onClick:()=>K("image",{imageData:se.imageData,mimeType:se.mimeType,text:se.text}),className:"p-1.5 bg-white border-2 border-black rounded-lg hover:bg-nanobanana-yellow transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[1px] active:shadow-none",title:"Expand view",children:a.jsx(by,{className:"w-4 h-4"})})]}),a.jsx("img",{src:`data:${se.mimeType||"image/png"};base64,${se.imageData}`,alt:"Jeffrey's drawing",className:"w-full rounded-xl border-2 border-black"}),se.text&&a.jsx("p",{className:"mt-3 text-sm text-gray-700 font-medium",children:se.text})]}),se.messageType==="quiz"&&se.quiz&&a.jsxs("div",{className:"w-full max-w-lg p-3 bg-gray-100 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] rounded-bl-none",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-gray-600",children:[a.jsx(Ld,{className:"w-4 h-4"}),a.jsx("span",{children:"Let's test your knowledge!"})]}),a.jsx("button",{onClick:()=>K("quiz",se.quiz),className:"p-1.5 bg-white border-2 border-black rounded-lg hover:bg-nanobanana-yellow transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[1px] active:shadow-none",title:"Expand view",children:a.jsx(by,{className:"w-4 h-4"})})]}),a.jsx(kW,{quiz:se.quiz})]})]},se.id||pe)),(q||_||Si)&&!ee&&a.jsx(R.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex justify-start",children:a.jsxs("div",{className:"relative",children:[a.jsx(R.div,{className:"w-12 h-12",animate:{y:[-2,2]},transition:{duration:1.5,repeat:1/0,repeatType:"reverse",ease:"easeInOut"},children:a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey thinking",className:"w-full h-full object-cover rounded-full border-3 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]"})}),a.jsx(R.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"absolute -bottom-1 -right-1 bg-white px-2 py-1.5 rounded-full border-2 border-black shadow-md",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx(R.div,{animate:{y:[0,-4,0]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-2 h-2 bg-nanobanana-blue rounded-full"}),a.jsx(R.div,{animate:{y:[0,-4,0]},transition:{repeat:1/0,duration:.6,delay:.15},className:"w-2 h-2 bg-nanobanana-blue rounded-full"}),a.jsx(R.div,{animate:{y:[0,-4,0]},transition:{repeat:1/0,duration:.6,delay:.3},className:"w-2 h-2 bg-nanobanana-blue rounded-full"})]})})]})}),a.jsx("div",{ref:c})]}),!n&&j&&ye.length<=2&&Ye.length>0&&a.jsxs("div",{className:"px-4 pb-2",children:[a.jsxs("button",{onClick:()=>Z(!ne),className:"flex items-center gap-1 text-xs font-bold text-gray-500 hover:text-gray-700 transition-colors",children:[ne?a.jsx(CE,{className:"w-3 h-3"}):a.jsx(SE,{className:"w-3 h-3"}),"Try asking (",Ye.length,")"]}),a.jsx(Ie,{children:ne&&a.jsx(R.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ye.slice(0,4).map((se,pe)=>a.jsx("button",{onClick:()=>Ne(se),className:"px-3 py-1 text-xs font-medium bg-gray-100 hover:bg-nanobanana-yellow border-2 border-black rounded-full transition-colors",children:se},pe))})})})]}),!n&&a.jsxs("div",{className:"p-1.5 md:p-2 bg-gray-50 border-t-2 md:border-t-4 border-black space-y-1.5 md:space-y-2",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-1.5 md:gap-2",children:[a.jsxs("button",{onClick:qs,className:"flex flex-col items-center justify-center p-2 md:p-3 min-h-[52px] md:min-h-[60px] bg-white border-2 border-black rounded-xl hover:bg-nanobanana-yellow transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",disabled:Ci||Si,children:[D?a.jsx(nc,{className:"w-5 h-5 md:w-6 md:h-6 mb-1 animate-spin"}):a.jsx(va,{className:"w-5 h-5 md:w-6 md:h-6 mb-1"}),a.jsx("span",{className:"text-[10px] md:text-xs font-bold",children:"Flashcards"})]}),a.jsxs("button",{onClick:Cn,className:"flex flex-col items-center justify-center p-2 md:p-3 min-h-[52px] md:min-h-[60px] bg-white border-2 border-black rounded-xl hover:bg-nanobanana-green transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",disabled:Ci||Si,children:[I?a.jsx(nc,{className:"w-5 h-5 md:w-6 md:h-6 mb-1 animate-spin"}):a.jsx(P1,{className:"w-5 h-5 md:w-6 md:h-6 mb-1"}),a.jsx("span",{className:"text-[10px] md:text-xs font-bold",children:"Infographic"})]}),a.jsxs("button",{onClick:ni,className:"flex flex-col items-center justify-center p-2 md:p-3 min-h-[52px] md:min-h-[60px] bg-white border-2 border-black rounded-xl hover:bg-pink-400 transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",disabled:Ci||Si,children:[O?a.jsx(nc,{className:"w-5 h-5 md:w-6 md:h-6 mb-1 animate-spin"}):a.jsx(js,{className:"w-5 h-5 md:w-6 md:h-6 mb-1"}),a.jsx("span",{className:"text-[10px] md:text-xs font-bold",children:"Summarize"})]})]}),a.jsxs("button",{onClick:Ji,className:"w-full flex items-center justify-center gap-2 p-2.5 md:p-3 min-h-[48px] md:min-h-[52px] bg-purple-500 text-white border-2 border-black rounded-xl hover:bg-purple-600 transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",disabled:Ci||Si,children:[B?a.jsx(nc,{className:"w-5 h-5 animate-spin"}):a.jsx(Ld,{className:"w-5 h-5"}),a.jsx("span",{className:"font-bold text-sm md:text-base",children:"Take a Quiz"})]})]}),a.jsxs("div",{className:"p-4 bg-white border-t-2 border-gray-200",children:[n?f?a.jsxs(R.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:()=>h("/onboarding"),className:"w-full flex items-center justify-center gap-2 p-3 bg-nanobanana-green text-white border-2 border-black rounded-xl hover:bg-green-600 transition-colors shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:translate-y-[1px] active:shadow-none font-bold",children:[a.jsx(Ut,{className:"w-5 h-5"}),"Sign Up Free to Keep Learning!",a.jsx(jm,{className:"w-5 h-5"})]}):a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{ref:d,type:"text",value:r,onChange:se=>Le(se.target.value),onKeyDown:Pe,placeholder:"Ask me anything! Try: What are dinosaurs?",disabled:_,className:"flex-1 p-3 border-2 border-black rounded-xl focus:outline-none focus:ring-2 focus:ring-nanobanana-yellow shadow-[2px_2px_0px_0px_rgba(0,0,0,0.1)] disabled:bg-gray-100 disabled:cursor-not-allowed text-sm"}),a.jsx("button",{onClick:te,disabled:_||!r.trim(),className:"p-3 bg-nanobanana-blue text-white border-2 border-black rounded-xl hover:bg-blue-600 transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(AN,{className:"w-5 h-5"})})]}):a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{ref:d,type:"text",value:r,onChange:se=>Le(se.target.value),onKeyDown:Pe,placeholder:j?"Ask Jeffrey about the lesson...":"Upload a lesson to start chatting...",disabled:ce,className:"flex-1 p-3 border-2 border-black rounded-xl focus:outline-none focus:ring-2 focus:ring-nanobanana-yellow shadow-[2px_2px_0px_0px_rgba(0,0,0,0.1)] disabled:bg-gray-100 disabled:cursor-not-allowed"}),a.jsx("button",{onClick:te,disabled:ce||!r.trim(),className:"p-3 bg-nanobanana-blue text-white border-2 border-black rounded-xl hover:bg-blue-600 transition-colors shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(AN,{className:"w-5 h-5"})})]}),n&&!f&&a.jsxs("div",{className:"mt-1 flex items-center justify-between text-[10px] text-gray-400 px-1",children:[a.jsx("span",{children:"Press Enter to send"}),a.jsxs("span",{children:[K$-u," free messages left"]})]}),!n&&!Ci&&a.jsxs("div",{className:"mt-1 flex items-center justify-between text-[10px] text-gray-400 px-1",children:[a.jsx("span",{children:"Press Enter to send"}),ie.length>0&&a.jsx("span",{className:"flex items-center gap-1",children:"Safety filters active"})]})]}),a.jsx(Aoe,{isOpen:$.isOpen,onClose:X,type:$.type,data:$.data})]})},Eoe=()=>{const n=[{icon:mW,title:"Personalized Learning",description:"Adapts to your child's grade level and learning style",color:"#4169E1"},{icon:Ru,title:"Any Question Answered",description:"From homework help to curious wonderings",color:"#32CD32"},{icon:Iu,title:"Safe & Encouraging",description:"Built with child safety as the top priority",color:"#FFD700"},{icon:Pd,title:"Available 24/7",description:"Ready to help whenever learning happens",color:"#FF69B4"}];return a.jsxs("section",{className:"py-20 bg-gradient-to-b from-white to-blue-50 relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-nanobanana-yellow/10 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-nanobanana-blue/10 rounded-full blur-3xl"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("span",{className:"inline-flex items-center gap-2 bg-nanobanana-blue/10 text-nanobanana-blue px-4 py-2 rounded-full font-bold text-sm mb-4",children:[a.jsx(i3,{className:"w-4 h-4"}),"Your Child's Learning Companion"]}),a.jsxs("h2",{className:"text-4xl md:text-6xl font-black font-comic mb-4",children:["Meet ",a.jsx("span",{className:"text-nanobanana-yellow",children:"Jeffrey!"})]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"A friendly AI tutor who makes learning feel like an adventure"})]}),a.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[a.jsxs(R.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},viewport:{once:!0},children:[a.jsxs("div",{className:"relative mb-8",children:[a.jsx(R.div,{animate:{y:[-5,5,-5]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:a.jsx("div",{className:"bg-nanobanana-yellow p-4 rounded-[2rem] border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] max-w-md mx-auto",children:a.jsx("img",{src:"/assets/images/landing/meet-jeffrey.png",alt:"Jeffrey the AI Tutor",className:"w-full rounded-xl border-4 border-black"})})}),a.jsx(R.div,{initial:{opacity:0,scale:0},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:.3},className:"absolute -top-4 -right-4 bg-white px-4 py-2 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("p",{className:"font-comic font-bold text-sm",children:["Hi! I'm Jeffrey! ",a.jsx("span",{className:"text-nanobanana-yellow",children:"Ready to learn?"})]})})]}),a.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.map((e,t)=>a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:t*.1},whileHover:{scale:1.02},className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("div",{className:"w-10 h-10 rounded-xl border-2 border-black flex items-center justify-center mb-2",style:{backgroundColor:e.color},children:a.jsx(e.icon,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-bold font-comic text-sm mb-1",children:e.title}),a.jsx("p",{className:"text-gray-600 text-xs",children:e.description})]},e.title))})]}),a.jsxs(R.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"relative",children:[a.jsx("div",{className:"bg-nanobanana-blue p-4 rounded-[2rem] border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:a.jsx("div",{className:"bg-white rounded-[1.5rem] border-4 border-black overflow-hidden h-[500px]",children:a.jsx(pM,{demoMode:!0})})}),a.jsxs(R.div,{animate:{rotate:[-2,2,-2]},transition:{duration:2,repeat:1/0},className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-nanobanana-green text-white px-4 py-2 rounded-full border-4 border-black font-bold text-sm flex items-center gap-2",children:[a.jsx(Ut,{className:"w-4 h-4"}),"Try it out!"]})]})]})]})]})},koe=()=>{const n=[{number:1,icon:q0,title:"Upload Any Lesson",description:"Snap a photo, upload a PDF, or paste a YouTube link. We handle it all!",color:"#FF69B4",image:"/assets/images/landing/how-it-works-upload.png"},{number:2,icon:lT,title:"AI Magic Happens",description:"Our AI instantly analyzes and structures the content for optimal learning.",color:"#4169E1",image:"/assets/images/landing/how-it-works-ai-magic.png"},{number:3,icon:Ru,title:"Learn with Jeffrey",description:"Chat, ask questions, create flashcards, and master the material!",color:"#32CD32",image:"/assets/images/landing/how-it-works-learn.png"}];return a.jsxs("section",{id:"how-it-works",className:"py-20 bg-yellow-50 relative",children:[a.jsx("div",{className:"absolute top-0 left-0 w-full overflow-hidden leading-none rotate-180",children:a.jsx("svg",{className:"relative block w-full h-[50px]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:a.jsx("path",{d:"M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z",className:"fill-blue-50"})})}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 pt-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["How It ",a.jsx("span",{className:"text-nanobanana-blue",children:"Works"})]}),a.jsx("p",{className:"text-xl text-gray-600 font-medium",children:"Getting started is as easy as 1, 2, 3!"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"hidden lg:block absolute top-1/2 left-0 w-full h-1 bg-black/10 -translate-y-1/2 z-0"}),a.jsx("div",{className:"grid md:grid-cols-3 gap-8 lg:gap-12 relative z-10",children:n.map((e,t)=>a.jsxs(R.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:t*.2},className:"relative",children:[a.jsxs(R.div,{whileHover:{y:-8,rotate:t%2===0?-2:2},className:"bg-white p-6 rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-14 h-14 rounded-2xl border-4 border-black flex items-center justify-center text-white font-black text-2xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",style:{backgroundColor:e.color},children:e.number}),a.jsx("div",{className:"mt-6 mb-4",children:a.jsx("img",{src:e.image,alt:e.title,className:"w-full rounded-xl border-4 border-black aspect-video object-cover"})}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 mx-auto rounded-xl border-2 border-black flex items-center justify-center mb-3",style:{backgroundColor:`${e.color}20`},children:a.jsx(e.icon,{className:"w-6 h-6",style:{color:e.color}})}),a.jsx("h3",{className:"text-xl font-bold font-comic mb-2",children:e.title}),a.jsx("p",{className:"text-gray-600 font-medium text-sm",children:e.description})]})]}),t<n.length-1&&a.jsx("div",{className:"hidden lg:block absolute top-1/2 -right-6 transform -translate-y-1/2 z-20",children:a.jsx(R.div,{animate:{x:[0,5,0]},transition:{duration:1.5,repeat:1/0},className:"w-8 h-8 bg-nanobanana-yellow rounded-full border-2 border-black flex items-center justify-center",children:a.jsx("span",{className:"text-black font-bold",children:""})})})]},e.number))})]})]}),a.jsx("div",{className:"absolute bottom-0 left-0 w-full overflow-hidden leading-none",children:a.jsx("svg",{className:"relative block w-full h-[50px]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:a.jsx("path",{d:"M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z",className:"fill-white"})})})]})},Toe=()=>{const n=[{icon:Ki,title:"Smart Flashcards",description:"AI automatically creates flashcards from any lesson. Study smarter, not harder!",color:"#4169E1",shadowColor:"rgba(65,105,225,1)",image:"/assets/images/landing/tool-flashcards.png"},{icon:W0,title:"Interactive Quizzes",description:"Test knowledge with adaptive quizzes that adjust to your child's level.",color:"#32CD32",shadowColor:"rgba(50,205,50,1)",image:"/assets/images/landing/tool-quizzes.png"},{icon:js,title:"Study Guides",description:"Get organized summaries with key points highlighted for easy review.",color:"#FFD700",shadowColor:"rgba(255,215,0,1)",image:"/assets/images/landing/tool-study-guides.png"},{icon:P1,title:"Visual Infographics",description:"Complex topics become clear with AI-generated visual explanations.",color:"#FF69B4",shadowColor:"rgba(255,105,180,1)",image:"/assets/images/landing/tool-infographics.png"}];return a.jsxs("section",{id:"features",className:"py-20 bg-white relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-20 left-0 w-72 h-72 bg-nanobanana-blue/5 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute bottom-20 right-0 w-96 h-96 bg-nanobanana-green/5 rounded-full blur-3xl"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("span",{className:"inline-flex items-center gap-2 bg-nanobanana-green/10 text-nanobanana-green px-4 py-2 rounded-full font-bold text-sm mb-4",children:[a.jsx(Ut,{className:"w-4 h-4"}),"Powerful Learning Tools"]}),a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["Magic ",a.jsx("span",{className:"text-nanobanana-green",children:"Learning"})," Tools"]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"Everything your child needs to master any subject, all in one place"})]}),a.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:n.map((e,t)=>a.jsx(R.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:t*.1},whileHover:{y:-6},className:"group",children:a.jsx("div",{className:"bg-white p-6 rounded-3xl border-4 border-black transition-shadow duration-300",style:{boxShadow:`8px 8px 0px 0px ${e.shadowColor}`},children:a.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[a.jsx("div",{className:"lg:w-2/5 flex-shrink-0",children:a.jsx("div",{className:"rounded-2xl border-4 border-black overflow-hidden",style:{backgroundColor:`${e.color}10`},children:a.jsx("img",{src:e.image,alt:e.title,className:"w-full aspect-square object-cover"})})}),a.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[a.jsx("div",{className:"w-14 h-14 rounded-2xl border-4 border-black flex items-center justify-center mb-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",style:{backgroundColor:e.color},children:a.jsx(e.icon,{className:`w-7 h-7 ${e.color==="#FFD700"?"text-black":"text-white"}`})}),a.jsx("h3",{className:"text-2xl font-bold font-comic mb-2",children:e.title}),a.jsx("p",{className:"text-gray-600 font-medium",children:e.description}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[a.jsx("span",{className:"text-xs font-bold px-3 py-1 rounded-full border-2 border-black bg-gray-50",children:"AI-Powered"}),a.jsx("span",{className:"text-xs font-bold px-3 py-1 rounded-full border-2 border-black bg-gray-50",children:"Instant"})]})]})]})})},e.title))})]})]})},_oe=()=>{const n=[{icon:e3,title:"Real-time Progress",description:"See exactly what your child is learning and how they're improving"},{icon:EN,title:"Learning Analytics",description:"Detailed insights into strengths, areas for growth, and study habits"},{icon:Iu,title:"Content Controls",description:"Full control over what topics and content your child can access"},{icon:jW,title:"Multiple Profiles",description:"Manage learning for all your children from one account"},{icon:t3,title:"Weekly Reports",description:"Get email summaries of your child's learning achievements"},{icon:yW,title:"Activity Monitoring",description:"Review chat history and learning sessions anytime"}];return a.jsxs("section",{id:"for-parents",className:"py-20 bg-gradient-to-b from-white to-purple-50 relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-purple-200/30 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-blue-200/20 rounded-full blur-3xl"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("span",{className:"inline-flex items-center gap-2 bg-purple-100 text-purple-700 px-4 py-2 rounded-full font-bold text-sm mb-4",children:[a.jsx(Iu,{className:"w-4 h-4"}),"For Parents"]}),a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["Stay ",a.jsx("span",{className:"text-purple-600",children:"Connected"})," to Learning"]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"Complete visibility and control over your child's educational journey"})]}),a.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[a.jsx(R.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},viewport:{once:!0},children:a.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:n.map((e,t)=>a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:t*.1},whileHover:{scale:1.02},className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center mb-3",children:a.jsx(e.icon,{className:"w-5 h-5 text-purple-600"})}),a.jsx("h3",{className:"font-bold font-comic text-sm mb-1",children:e.title}),a.jsx("p",{className:"text-gray-600 text-xs leading-relaxed",children:e.description})]},e.title))})}),a.jsxs(R.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"relative",children:[a.jsx(R.div,{animate:{y:[-5,5,-5]},transition:{duration:5,repeat:1/0,ease:"easeInOut"},children:a.jsx("div",{className:"bg-purple-600 p-4 rounded-[2rem] border-4 border-black shadow-[12px_12px_0px_0px_rgba(0,0,0,1)]",children:a.jsx("img",{src:"/assets/images/landing/parent-dashboard.png",alt:"Parent Dashboard Preview",className:"w-full rounded-xl border-4 border-black"})})}),a.jsxs(R.div,{initial:{opacity:0,scale:0},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:.3},animate:{y:[-3,3,-3]},className:"absolute -top-4 -left-4 bg-white px-4 py-3 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"This Week"}),a.jsx("div",{className:"text-xl font-black text-nanobanana-green",children:"+15 Lessons"})]}),a.jsxs(R.div,{initial:{opacity:0,scale:0},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:.4},animate:{y:[3,-3,3]},className:"absolute -bottom-4 -right-4 bg-white px-4 py-3 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Streak"}),a.jsx("div",{className:"text-xl font-black text-nanobanana-yellow",children:"7 Days"})]})]})]})]})]})},Poe=()=>{const n=[{icon:Iu,title:"COPPA Compliant",description:"We follow all children's online privacy protection regulations"},{icon:uM,title:"Content Filtering",description:"AI-powered safety filters ensure age-appropriate responses"},{icon:yW,title:"Parent Oversight",description:"Full visibility into all conversations and learning activities"},{icon:Oae,title:"No Ads, Ever",description:"Your child's attention is for learning, not advertising"}],e=["SOC 2 Compliant","FERPA Ready","Data Encryption","No Data Selling"];return a.jsxs("section",{className:"py-20 bg-gradient-to-b from-green-50 to-white relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 left-0 w-full overflow-hidden leading-none rotate-180",children:a.jsx("svg",{className:"relative block w-full h-[50px]",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:a.jsx("path",{d:"M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z",className:"fill-purple-50"})})}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 pt-8 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("span",{className:"inline-flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-full font-bold text-sm mb-4",children:[a.jsx(i3,{className:"w-4 h-4"}),"Built for Families"]}),a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["Safety ",a.jsx("span",{className:"text-nanobanana-green",children:"First"}),", Always"]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"Your child's safety and privacy are our top priorities"})]}),a.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[a.jsxs(R.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"relative order-2 lg:order-1",children:[a.jsx(R.div,{animate:{y:[-5,5,-5]},transition:{duration:5,repeat:1/0,ease:"easeInOut"},children:a.jsx("div",{className:"bg-nanobanana-green p-4 rounded-[2rem] border-4 border-black shadow-[12px_12px_0px_0px_rgba(0,0,0,1)]",children:a.jsx("img",{src:"/assets/images/landing/safety-family.png",alt:"Safe Family Learning",className:"w-full rounded-xl border-4 border-black"})})}),a.jsx(R.div,{initial:{opacity:0,scale:0},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:.3},className:"absolute -top-6 -right-6 bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsx("div",{className:"w-16 h-16 bg-nanobanana-green rounded-2xl flex items-center justify-center",children:a.jsx(Iu,{className:"w-10 h-10 text-white"})})})]}),a.jsxs(R.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"order-1 lg:order-2",children:[a.jsx("div",{className:"space-y-4 mb-8",children:n.map((t,s)=>a.jsxs(R.div,{initial:{opacity:0,x:20},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{delay:s*.1},whileHover:{x:5},className:"flex items-start gap-4 bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(50,205,50,1)]",children:[a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex-shrink-0 flex items-center justify-center",children:a.jsx(t.icon,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold font-comic mb-1",children:t.title}),a.jsx("p",{className:"text-gray-600 text-sm",children:t.description})]})]},t.title))}),a.jsx("div",{className:"flex flex-wrap gap-3",children:e.map((t,s)=>a.jsxs(R.div,{initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:.4+s*.1},className:"flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-full border-2 border-black",children:[a.jsx(kd,{className:"w-4 h-4 text-green-600"}),a.jsx("span",{className:"text-sm font-bold",children:t})]},t))})]})]})]})]})},Loe=()=>{const n=[{icon:Uae,name:"Math",color:"#4169E1",description:"Numbers, shapes, and problem-solving"},{icon:Gae,name:"Science",color:"#32CD32",description:"Explore the world around us"},{icon:js,name:"Reading",color:"#FF69B4",description:"Stories, comprehension, and vocabulary"},{icon:ooe,name:"Writing",color:"#FFD700",description:"Express ideas clearly and creatively"},{icon:Xae,name:"Social Studies",color:"#9B59B6",description:"History, geography, and culture"},{icon:SW,name:"Art",color:"#E74C3C",description:"Creativity and visual expression"},{icon:ioe,name:"Music",color:"#3498DB",description:"Rhythm, melody, and instruments"},{icon:Hae,name:"Health",color:"#1ABC9C",description:"Wellness and healthy habits"}];return a.jsxs("section",{className:"py-20 bg-gradient-to-b from-white to-blue-50 relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-1/4 left-0 w-64 h-64 bg-nanobanana-yellow/10 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute bottom-1/4 right-0 w-80 h-80 bg-nanobanana-blue/10 rounded-full blur-3xl"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["Every ",a.jsx("span",{className:"text-nanobanana-blue",children:"Subject"})," Covered"]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"Works with any K-6 curriculum and learning material"})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6",children:n.map((e,t)=>a.jsx(R.div,{initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},viewport:{once:!0},transition:{delay:t*.05},whileHover:{y:-8,rotate:t%2===0?2:-2},className:"group",children:a.jsxs("div",{className:"bg-white p-4 md:p-6 rounded-3xl border-4 border-black text-center transition-all duration-300",style:{boxShadow:`6px 6px 0px 0px ${e.color}`},children:[a.jsx(R.div,{whileHover:{scale:1.1,rotate:10},className:"w-14 h-14 md:w-16 md:h-16 mx-auto rounded-2xl border-4 border-black flex items-center justify-center mb-3 md:mb-4 shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]",style:{backgroundColor:e.color},children:a.jsx(e.icon,{className:"w-7 h-7 md:w-8 md:h-8 text-white"})}),a.jsx("h3",{className:"font-bold font-comic text-lg md:text-xl mb-1",children:e.name}),a.jsx("p",{className:"text-gray-600 text-xs md:text-sm hidden md:block",children:e.description})]})},e.name))}),a.jsx(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mt-12",children:a.jsxs("div",{className:"inline-flex items-center gap-3 bg-nanobanana-yellow/20 px-6 py-3 rounded-full border-2 border-nanobanana-yellow",children:[a.jsx("span",{className:"text-2xl",children:"+"}),a.jsx("span",{className:"font-bold text-gray-700",children:"Upload any topic and Jeffrey will help!"})]})})]})]})},Doe=()=>{const[n,e]=N.useState(0),t=[{quote:"My daughter used to dread homework time. Now she can't wait to chat with Jeffrey! Her math grades have improved so much.",author:"Sarah M.",role:"Parent of Emma, 3rd Grade",rating:5,color:"#4169E1"},{quote:"Finally, an educational app that's actually safe for kids. I love being able to see exactly what my son is learning.",author:"Michael T.",role:"Parent of Jake, 1st Grade",rating:5,color:"#32CD32"},{quote:"The flashcard feature is amazing! It saves me so much time and my kids actually enjoy studying with them.",author:"Jennifer L.",role:"Parent of twins, 5th Grade",rating:5,color:"#FFD700"},{quote:"Jeffrey explains things in a way that just clicks with my son. He went from struggling to confident in reading!",author:"David R.",role:"Parent of Liam, 2nd Grade",rating:5,color:"#FF69B4"},{quote:"Worth every penny. The progress reports help me understand exactly where my daughter needs extra support.",author:"Amanda K.",role:"Parent of Sofia, 4th Grade",rating:5,color:"#9B59B6"}],s=()=>{e(r=>(r+1)%t.length)},i=()=>{e(r=>(r-1+t.length)%t.length)};return a.jsxs("section",{className:"py-20 bg-gradient-to-b from-blue-50 to-white relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-nanobanana-yellow/5 rounded-full blur-3xl"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["Families ",a.jsx("span",{className:"text-nanobanana-yellow",children:"Love"})," OrbitLearn"]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"Join thousands of happy families on their learning journey"})]}),a.jsxs("div",{className:"relative max-w-4xl mx-auto",children:[a.jsx("button",{onClick:i,className:"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 md:-translate-x-12 z-20 w-12 h-12 bg-white rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center hover:bg-gray-50 transition-colors",children:a.jsx(X1,{className:"w-6 h-6"})}),a.jsx("button",{onClick:s,className:"absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 md:translate-x-12 z-20 w-12 h-12 bg-white rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center hover:bg-gray-50 transition-colors",children:a.jsx(No,{className:"w-6 h-6"})}),a.jsx(Ie,{mode:"wait",children:a.jsxs(R.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"bg-white p-8 md:p-12 rounded-3xl border-4 border-black relative",style:{boxShadow:`8px 8px 0px 0px ${t[n].color}`},children:[a.jsx("div",{className:"absolute -top-6 left-8 w-12 h-12 rounded-2xl border-4 border-black flex items-center justify-center",style:{backgroundColor:t[n].color},children:a.jsx(doe,{className:"w-6 h-6 text-white"})}),a.jsx("div",{className:"flex gap-1 mb-6",children:[...Array(t[n].rating)].map((r,o)=>a.jsx(Cr,{className:"w-6 h-6 text-nanobanana-yellow fill-current"},o))}),a.jsxs("blockquote",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-8 leading-relaxed",children:['"',t[n].quote,'"']}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-14 h-14 rounded-full border-4 border-black flex items-center justify-center text-white font-bold text-xl",style:{backgroundColor:t[n].color},children:t[n].author.charAt(0)}),a.jsxs("div",{children:[a.jsx("div",{className:"font-bold font-comic text-lg",children:t[n].author}),a.jsx("div",{className:"text-gray-600 text-sm",children:t[n].role})]})]})]},n)}),a.jsx("div",{className:"flex justify-center gap-2 mt-8",children:t.map((r,o)=>a.jsx("button",{onClick:()=>e(o),className:`w-3 h-3 rounded-full border-2 border-black transition-all ${o===n?"bg-nanobanana-yellow w-8":"bg-white hover:bg-gray-100"}`},o))})]})]})]})},Roe=()=>{const n=Qt(),[e,t]=N.useState({}),s=[{name:"Free",price:"$0",period:"/month",description:"Get started with basic features",icon:Cr,color:"#32CD32",shadowColor:"rgba(50,205,50,1)",features:["5 lessons per month","Basic chat with Jeffrey","10 flashcards per lesson","Email support"],limitations:["Limited AI features","No parent dashboard"],cta:"Start Free",popular:!1},{name:"Premium",price:"$XX",period:"/month",description:"Everything your child needs to excel",icon:Vu,color:"#4169E1",shadowColor:"rgba(65,105,225,1)",features:["Unlimited lessons","Advanced Jeffrey AI","Unlimited flashcards & quizzes","Full parent dashboard","Progress analytics","Priority support","Weekly progress reports"],limitations:[],cta:"Get Premium",popular:!0},{name:"Family",price:"$XX",period:"/month",description:"Perfect for families with multiple children",icon:NN,color:"#FFD700",shadowColor:"rgba(255,215,0,1)",features:["Everything in Premium","Up to 5 child profiles","Family progress overview","Shared flashcard library","Premium phone support","Early access to new features"],limitations:[],cta:"Get Family Plan",popular:!1}],i=[{question:"Can I switch plans anytime?",answer:"Yes! You can upgrade or downgrade your plan at any time. Changes take effect at the start of your next billing cycle."},{question:"Is there a free trial for Premium?",answer:"Yes! All paid plans come with a 7-day free trial. No credit card required to start."},{question:"What payment methods do you accept?",answer:"We accept all major credit cards, PayPal, and Apple Pay. All payments are securely processed."},{question:"Can I get a refund?",answer:"We offer a 30-day money-back guarantee. If you're not satisfied, contact us for a full refund."},{question:"Do you offer discounts for schools?",answer:"Yes! We have special pricing for schools and educational institutions. Contact us for details."}],r=o=>{t(c=>({...c,[o]:!c[o]}))};return a.jsxs("section",{id:"pricing",className:"py-20 bg-gradient-to-b from-white to-gray-50 relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-nanobanana-yellow/10 rounded-full blur-3xl"}),a.jsx("div",{className:"absolute bottom-0 right-1/4 w-80 h-80 bg-nanobanana-blue/10 rounded-full blur-3xl"}),a.jsxs("div",{className:"max-w-7xl mx-auto px-6 relative z-10",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[a.jsxs("h2",{className:"text-4xl md:text-5xl font-black font-comic mb-4",children:["Simple, ",a.jsx("span",{className:"text-nanobanana-blue",children:"Fair"})," Pricing"]}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto font-medium",children:"Start free and upgrade when you're ready. No hidden fees, ever."})]}),a.jsx("div",{className:"grid md:grid-cols-3 gap-8 mb-20",children:s.map((o,c)=>a.jsxs(R.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:c*.1},whileHover:{y:-8},className:`relative ${o.popular?"md:-mt-4 md:mb-4":""}`,children:[o.popular&&a.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 z-10",children:a.jsx("span",{className:"bg-nanobanana-blue text-white px-4 py-1 rounded-full font-bold text-sm border-2 border-black",children:"Most Popular"})}),a.jsxs("div",{className:`bg-white p-6 md:p-8 rounded-3xl border-4 border-black h-full flex flex-col ${o.popular?"ring-4 ring-nanobanana-blue/30":""}`,style:{boxShadow:`8px 8px 0px 0px ${o.shadowColor}`},children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-16 h-16 mx-auto rounded-2xl border-4 border-black flex items-center justify-center mb-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",style:{backgroundColor:o.color},children:a.jsx(o.icon,{className:`w-8 h-8 ${o.color==="#FFD700"?"text-black":"text-white"}`})}),a.jsx("h3",{className:"text-2xl font-bold font-comic mb-2",children:o.name}),a.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[a.jsx("span",{className:"text-4xl md:text-5xl font-black",children:o.price}),a.jsx("span",{className:"text-gray-500 font-medium",children:o.period})]}),a.jsx("p",{className:"text-gray-600 text-sm mt-2",children:o.description})]}),a.jsx("div",{className:"flex-1 mb-6",children:a.jsxs("ul",{className:"space-y-3",children:[o.features.map(d=>a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-5 h-5 rounded-full flex-shrink-0 flex items-center justify-center mt-0.5",style:{backgroundColor:`${o.color}20`},children:a.jsx(bo,{className:"w-3 h-3",style:{color:o.color}})}),a.jsx("span",{className:"text-gray-700 text-sm",children:d})]},d)),o.limitations.map(d=>a.jsxs("li",{className:"flex items-start gap-3 text-gray-400",children:[a.jsx("div",{className:"w-5 h-5 rounded-full flex-shrink-0 flex items-center justify-center mt-0.5 bg-gray-100",children:a.jsx("span",{className:"text-xs",children:"-"})}),a.jsx("span",{className:"text-sm",children:d})]},d))]})}),a.jsx("button",{onClick:()=>n("/onboarding"),className:`w-full py-4 rounded-2xl font-bold text-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[-2px] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none transition-all ${o.popular?"bg-nanobanana-blue text-white":"bg-white text-black hover:bg-gray-50"}`,children:o.cta})]})]},o.name))}),a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"max-w-3xl mx-auto",children:[a.jsx("h3",{className:"text-2xl md:text-3xl font-bold font-comic text-center mb-8",children:"Frequently Asked Questions"}),a.jsx("div",{className:"space-y-4",children:i.map((o,c)=>a.jsxs(R.div,{initial:{opacity:0,y:10},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:c*.05},className:"bg-white rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] overflow-hidden",children:[a.jsxs("button",{onClick:()=>r(c),className:"w-full px-6 py-4 flex items-center justify-between text-left hover:bg-gray-50 transition-colors",children:[a.jsx("span",{className:"font-bold",children:o.question}),e[c]?a.jsx(CE,{className:"w-5 h-5 flex-shrink-0"}):a.jsx(SE,{className:"w-5 h-5 flex-shrink-0"})]}),e[c]&&a.jsx(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"px-6 pb-4",children:a.jsx("p",{className:"text-gray-600",children:o.answer})})]},c))})]})]})]})},Ioe=()=>{const n=Qt();return a.jsxs("section",{className:"py-20 bg-gradient-to-br from-nanobanana-blue via-blue-600 to-purple-600 relative overflow-hidden",children:[a.jsx(R.div,{animate:{scale:[1,1.2,1],opacity:[.1,.2,.1]},transition:{duration:8,repeat:1/0},className:"absolute top-0 left-0 w-96 h-96 bg-white rounded-full blur-3xl"}),a.jsx(R.div,{animate:{scale:[1.2,1,1.2],opacity:[.1,.2,.1]},transition:{duration:8,repeat:1/0,delay:2},className:"absolute bottom-0 right-0 w-80 h-80 bg-nanobanana-yellow rounded-full blur-3xl"}),a.jsx(R.div,{animate:{y:[-10,10,-10],rotate:[0,10,0]},transition:{duration:5,repeat:1/0},className:"absolute top-20 left-20 w-16 h-16 bg-nanobanana-yellow rounded-2xl border-4 border-black/20 hidden lg:block"}),a.jsx(R.div,{animate:{y:[10,-10,10],rotate:[0,-10,0]},transition:{duration:6,repeat:1/0},className:"absolute bottom-20 right-20 w-12 h-12 bg-nanobanana-green rounded-full border-4 border-black/20 hidden lg:block"}),a.jsx("div",{className:"max-w-6xl mx-auto px-6 relative z-10",children:a.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[a.jsxs(R.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"text-white text-center lg:text-left",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full font-bold text-sm mb-6",children:[a.jsx(uoe,{className:"w-4 h-4"}),"Start Learning Today"]}),a.jsxs("h2",{className:"text-4xl md:text-5xl lg:text-6xl font-black font-comic mb-6 leading-tight",children:["Ready for Your Child's"," ",a.jsx("span",{className:"text-nanobanana-yellow",children:"Learning Adventure?"})]}),a.jsx("p",{className:"text-xl text-white/90 mb-8 max-w-xl",children:"Join thousands of families who've transformed homework time into discovery time. Start your free trial today!"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center lg:justify-start",children:[a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>n("/onboarding"),className:"inline-flex items-center justify-center gap-3 bg-nanobanana-yellow text-black text-xl font-bold px-8 py-4 rounded-2xl border-4 border-black shadow-[6px_6px_0px_0px_rgba(0,0,0,0.3)] hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,0.3)] transition-all",children:[a.jsx(Ut,{className:"w-6 h-6"}),"Start Free Trial",a.jsx(jm,{className:"w-6 h-6"})]}),a.jsx(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{var e;return(e=document.getElementById("pricing"))==null?void 0:e.scrollIntoView({behavior:"smooth"})},className:"inline-flex items-center justify-center gap-2 bg-white/10 backdrop-blur-sm text-white text-lg font-bold px-6 py-4 rounded-2xl border-4 border-white/30 hover:bg-white/20 transition-all",children:"View Pricing"})]}),a.jsxs("div",{className:"flex flex-wrap gap-6 justify-center lg:justify-start mt-8 text-white/80 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-nanobanana-green",children:""}),a.jsx("span",{children:"No credit card required"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-nanobanana-green",children:""}),a.jsx("span",{children:"7-day free trial"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-nanobanana-green",children:""}),a.jsx("span",{children:"Cancel anytime"})]})]})]}),a.jsx(R.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"hidden lg:block",children:a.jsx(R.div,{animate:{y:[-8,8,-8]},transition:{duration:5,repeat:1/0,ease:"easeInOut"},children:a.jsx("div",{className:"bg-white/10 backdrop-blur-sm p-4 rounded-[2rem] border-4 border-white/20",children:a.jsx("img",{src:"/assets/images/landing/celebration.png",alt:"Children Celebrating Learning Success",className:"w-full max-w-md mx-auto rounded-xl"})})})})]})})]})},Moe=()=>{const n=[{icon:Ut,title:"AI Lesson Creator",description:"Generate complete lesson plans in minutes"},{icon:W0,title:"Quiz Generator",description:"Create assessments aligned to your content"},{icon:Ki,title:"Flashcard Maker",description:"Build study materials automatically"},{icon:Pd,title:"Save Hours",description:"Reduce prep time by up to 80%"}];return a.jsxs("section",{className:"py-16 md:py-20 bg-gradient-to-br from-slate-50 to-slate-100 relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 opacity-50",children:a.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`
              linear-gradient(rgba(45,90,74,0.03) 1px, transparent 1px),
              linear-gradient(90deg, rgba(45,90,74,0.03) 1px, transparent 1px)
            `,backgroundSize:"32px 32px"}})}),a.jsx(R.div,{animate:{y:[-10,10,-10],rotate:[0,5,0]},transition:{duration:6,repeat:1/0},className:"absolute top-20 right-20 w-16 h-16 bg-[#2D5A4A]/10 rounded-2xl hidden lg:block"}),a.jsx(R.div,{animate:{y:[10,-10,10]},transition:{duration:5,repeat:1/0},className:"absolute bottom-20 left-20 w-12 h-12 bg-[#D4A853]/20 rounded-full hidden lg:block"}),a.jsx("div",{className:"max-w-6xl mx-auto px-6 relative z-10",children:a.jsxs("div",{className:"grid lg:grid-cols-2 gap-10 lg:gap-16 items-center",children:[a.jsxs(R.div,{initial:{opacity:0,x:-30},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{duration:.5},children:[a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"inline-flex items-center gap-2 bg-[#2D5A4A]/10 text-[#2D5A4A] px-4 py-2 rounded-full font-bold text-sm mb-6 border border-[#2D5A4A]/20",children:[a.jsx(js,{className:"w-4 h-4"}),"For Educators"]}),a.jsxs("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-black font-comic mb-4 leading-tight text-gray-900",children:["Are You a"," ",a.jsx("span",{className:"text-[#2D5A4A]",children:"Teacher?"})]}),a.jsx("p",{className:"text-lg md:text-xl text-gray-600 mb-8 max-w-xl leading-relaxed",children:"Create lessons, quizzes, and study materials in minutes with our AI-powered Teacher Portal. Let Jeffrey help you spend less time on prep and more time inspiring students."}),a.jsx("div",{className:"grid grid-cols-2 gap-4 mb-8",children:n.map((e,t)=>{const s=e.icon;return a.jsxs(R.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:t*.1},className:"flex items-start gap-3 p-3 rounded-xl bg-white/60 border border-gray-200/50",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#2D5A4A]/10 flex items-center justify-center flex-shrink-0",children:a.jsx(s,{className:"w-5 h-5 text-[#2D5A4A]"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-gray-900 text-sm",children:e.title}),a.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.title)})}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs(qe,{to:"/teacher/signup",className:"inline-flex items-center justify-center gap-2 bg-[#2D5A4A] text-white text-base font-bold px-6 py-3.5 rounded-xl border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[-2px] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all active:translate-y-[1px] active:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx(Vu,{className:"w-5 h-5"}),"Start Creating Free",a.jsx(jm,{className:"w-5 h-5"})]}),a.jsx(qe,{to:"/teacher/login",className:"inline-flex items-center justify-center gap-2 bg-white text-gray-700 text-base font-bold px-6 py-3.5 rounded-xl border-2 border-gray-300 hover:border-[#2D5A4A] hover:text-[#2D5A4A] transition-all",children:"Sign In"})]}),a.jsxs("p",{className:"mt-6 text-sm text-gray-500 flex items-center gap-2",children:[a.jsx("span",{className:"text-[#2D5A4A]",children:""}),"Free tier available  No credit card required"]})]}),a.jsx(R.div,{initial:{opacity:0,x:30},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{duration:.5,delay:.2},className:"hidden lg:block",children:a.jsx(R.div,{animate:{y:[-6,6,-6]},transition:{duration:5,repeat:1/0,ease:"easeInOut"},children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-6 relative",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-4 border-b border-gray-100",children:[a.jsxs("div",{className:"flex gap-1.5",children:[a.jsx("div",{className:"w-3 h-3 rounded-full bg-red-400"}),a.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-400"}),a.jsx("div",{className:"w-3 h-3 rounded-full bg-green-400"})]}),a.jsx("div",{className:"flex-1 mx-4",children:a.jsx("div",{className:"bg-gray-100 rounded-lg px-3 py-1.5 text-xs text-gray-500 text-center",children:"orbitlearn.com/teacher"})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden border-2 border-[#D4A853]/30",children:a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey",className:"w-full h-full object-cover"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-bold text-gray-900",children:"Create with Jeffrey"}),a.jsx("p",{className:"text-xs text-gray-500",children:"What would you like to create?"})]})]}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{icon:js,label:"Lesson",color:"#2D5A4A"},{icon:W0,label:"Quiz",color:"#7BAE7F"},{icon:Ki,label:"Flashcards",color:"#D4A853"}].map((e,t)=>{const s=e.icon;return a.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-gray-50 border border-gray-100",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:`${e.color}15`},children:a.jsx(s,{className:"w-4 h-4",style:{color:e.color}})}),a.jsx("span",{className:"text-xs font-medium text-gray-600",children:e.label})]},t)})}),a.jsxs("div",{className:"bg-gradient-to-br from-[#2D5A4A]/5 to-[#D4A853]/5 rounded-xl p-4 border border-[#2D5A4A]/10",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ut,{className:"w-4 h-4 text-[#D4A853]"}),a.jsx("span",{className:"text-xs font-bold text-gray-700",children:"AI Generated"})]}),a.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Introduction to Fractions"}),a.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:"A comprehensive 45-minute lesson covering fraction basics, visual representations, and hands-on activities..."})]})]}),a.jsx(R.div,{animate:{rotate:[-5,5,-5]},transition:{duration:3,repeat:1/0},className:"absolute -top-4 -right-4 bg-[#D4A853] text-white text-xs font-bold px-3 py-1.5 rounded-full border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:"AI-Powered"})]})})})]})})]})},Foe=()=>{const n={Product:[{name:"Features",href:"#features"},{name:"Pricing",href:"#pricing"},{name:"For Parents",href:"#for-parents"},{name:"How It Works",href:"#how-it-works"}],Resources:[{name:"Help Center",href:"/help"},{name:"Blog",href:"/blog"},{name:"Curriculum Guide",href:"/curriculum"},{name:"Parent Tips",href:"/tips"}],Company:[{name:"About Us",href:"/about"},{name:"Careers",href:"/careers"},{name:"Contact",href:"/contact"},{name:"Press Kit",href:"/press"}],Legal:[{name:"Privacy Policy",href:"/privacy"},{name:"Terms of Service",href:"/terms"},{name:"Cookie Policy",href:"/cookies"},{name:"COPPA Compliance",href:"/coppa"}]},e=[{icon:goe,href:"https://twitter.com/orbitlearn",label:"Twitter"},{icon:Vae,href:"https://facebook.com/orbitlearn",label:"Facebook"},{icon:Qae,href:"https://instagram.com/orbitlearn",label:"Instagram"},{icon:o3,href:"https://youtube.com/orbitlearn",label:"YouTube"}];return a.jsx("footer",{className:"bg-gray-900 text-white pt-16 pb-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-8 mb-12",children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx(qe,{to:"/",className:"flex items-center mb-4",children:a.jsx("img",{src:"/assets/orbit-learn-logo-light.png",alt:"OrbitLearn",className:"h-14 w-auto"})}),a.jsx("p",{className:"text-gray-400 mb-6 max-w-xs",children:"Making learning fun and accessible for every K-6 student with the power of AI."}),a.jsx("div",{className:"flex items-center gap-4",children:e.map(t=>a.jsx(R.a,{href:t.href,target:"_blank",rel:"noopener noreferrer",whileHover:{scale:1.1,y:-2},className:"w-10 h-10 bg-gray-800 rounded-xl flex items-center justify-center hover:bg-gray-700 transition-colors","aria-label":t.label,children:a.jsx(t.icon,{className:"w-5 h-5"})},t.label))})]}),Object.entries(n).map(([t,s])=>a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-white mb-4",children:t}),a.jsx("ul",{className:"space-y-3",children:s.map(i=>a.jsx("li",{children:i.href.startsWith("#")?a.jsx("a",{href:i.href,className:"text-gray-400 hover:text-white transition-colors text-sm",children:i.name}):a.jsx(qe,{to:i.href,className:"text-gray-400 hover:text-white transition-colors text-sm",children:i.name})},i.name))})]},t))]}),a.jsx("div",{className:"bg-gray-800 rounded-3xl p-6 md:p-8 mb-12",children:a.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold font-comic mb-2",children:"Stay in the Loop!"}),a.jsx("p",{className:"text-gray-400",children:"Get tips, updates, and special offers delivered to your inbox."})]}),a.jsxs("div",{className:"flex gap-3 w-full md:w-auto",children:[a.jsx("input",{type:"email",placeholder:"Enter your email",className:"flex-1 md:w-64 px-4 py-3 rounded-xl bg-gray-700 border-2 border-gray-600 focus:border-nanobanana-blue focus:outline-none text-white placeholder-gray-400"}),a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"px-6 py-3 bg-nanobanana-blue text-white font-bold rounded-xl hover:bg-blue-600 transition-colors flex items-center gap-2",children:[a.jsx(eoe,{className:"w-5 h-5"}),"Subscribe"]})]})]})}),a.jsx("div",{className:"border-t border-gray-800 pt-8",children:a.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 text-sm text-gray-500",children:[a.jsxs("p",{children:[" ",new Date().getFullYear()," Orbit Learn. All rights reserved."]}),a.jsxs("p",{className:"flex items-center gap-2",children:["Made with ",a.jsx(i3,{className:"w-4 h-4 text-red-500 fill-current"})," for young learners everywhere"]})]})})]})})},Ooe=()=>{const[n,e]=N.useState(!1);return N.useLayoutEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[]),N.useEffect(()=>{const t=()=>{e(window.scrollY>100)};return window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[]),a.jsxs("div",{className:"min-h-screen bg-white font-sans text-gray-900",children:[a.jsx(R.nav,{initial:{y:-20,opacity:0,x:"-50%"},animate:{y:0,opacity:1,x:"-50%"},transition:{duration:.5,ease:"easeOut"},className:"fixed top-4 md:top-6 left-1/2 z-50 w-[calc(100%-2rem)] max-w-5xl",children:a.jsxs("div",{className:`
            flex justify-between items-center px-4 md:px-6 py-3 md:py-4
            rounded-2xl md:rounded-[1.25rem]
            transition-all duration-300 ease-out
            border-2 border-black/10
            ${n?"bg-white/95 backdrop-blur-xl shadow-[0_8px_32px_rgba(0,0,0,0.15)]":"bg-white/90 backdrop-blur-md shadow-[0_4px_24px_rgba(0,0,0,0.08)]"}
          `,children:[a.jsx(qe,{to:"/",className:"flex items-center",children:a.jsx("img",{src:"/assets/orbit-learn-logo-hires.png",alt:"OrbitLearn",className:"h-12 md:h-14 w-auto"})}),a.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[a.jsx(qe,{to:"/teacher/login",className:"hidden sm:inline-flex items-center justify-center px-3 md:px-4 py-2 md:py-2.5 font-bold text-gray-500 hover:text-[#2D5A4A] transition-colors rounded-xl hover:bg-[#2D5A4A]/5 text-sm",children:"For Teachers"}),a.jsx(qe,{to:"/login",reloadDocument:!0,className:"inline-flex items-center justify-center px-3 md:px-4 py-2 md:py-2.5 font-bold text-gray-700 hover:text-nanobanana-blue transition-colors rounded-xl hover:bg-black/5 text-sm md:text-base",children:"Sign In"}),a.jsx(qe,{to:"/onboarding",reloadDocument:!0,className:"inline-flex items-center justify-center bg-nanobanana-blue text-white px-4 md:px-6 py-2 md:py-3 rounded-xl md:rounded-2xl font-bold text-sm md:text-base border-2 border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[-1px] hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-all active:translate-y-[1px] active:shadow-none",children:"Get Started"})]})]})}),a.jsxs("main",{children:[a.jsx(woe,{}),a.jsx(Coe,{}),a.jsx(Eoe,{}),a.jsx(koe,{}),a.jsx(Toe,{}),a.jsx(_oe,{}),a.jsx(Poe,{}),a.jsx(Loe,{}),a.jsx(Doe,{}),a.jsx(Roe,{}),a.jsx(Ioe,{}),a.jsx(Moe,{})]}),a.jsx(Foe,{})]})},fM={getMyStats:async()=>ue("/children/me/stats",{method:"GET"}),getChildStats:async n=>ue(`/children/${n}/stats`,{method:"GET"}),getMyBadges:async()=>ue("/children/me/badges",{method:"GET"}),getMyXPHistory:async(n=7)=>ue(`/children/me/xp-history?days=${n}`,{method:"GET"})};function Boe(){const[n,e]=N.useState({xp:0,level:1,xpToNextLevel:100,percentToNextLevel:0,streak:{current:0,longest:0,isActiveToday:!1,freezeAvailable:!1},badgesEarned:0,totalBadges:0,lessonsCompleted:0}),[t,s]=N.useState(!0),[i,r]=N.useState(null),o=N.useCallback(()=>{try{const d=Rr.getGameProgress();d&&e(h=>{var u,p,f,m,x,g;return{...h,xp:d.totalXP||0,level:d.currentLevel||1,xpToNextLevel:d.xpToNextLevel||100,percentToNextLevel:d.currentXP&&d.xpToNextLevel?Math.round(d.currentXP/d.xpToNextLevel*100):0,streak:{current:((u=d.streak)==null?void 0:u.current)||0,longest:((p=d.streak)==null?void 0:p.longest)||0,isActiveToday:((f=d.streak)==null?void 0:f.lastActivityDate)===new Date().toISOString().split("T")[0],freezeAvailable:((m=d.streak)==null?void 0:m.freezeAvailable)||!1},badgesEarned:((x=d.badges)==null?void 0:x.length)||0,lessonsCompleted:((g=d.statistics)==null?void 0:g.lessonsCompleted)||0}})}catch(d){console.error("Error loading local stats:",d)}},[]),c=N.useCallback(async(d=null)=>{s(!0),r(null);try{const h=d?await fM.getChildStats(d):await fM.getMyStats();h.success&&h.data?e(h.data):o()}catch(h){console.error("Failed to fetch child stats from API, using local stats:",h),r(h.message),o()}finally{s(!1)}},[o]);return N.useEffect(()=>{const d=$t.isAuthenticated(),h=$t.isChildMode(),u=localStorage.getItem("current_profile_id");h?c():d&&u?c(u):(o(),s(!1))},[c,o]),{stats:n,loading:t,error:i,refetch:c}}var TW={exports:{}},$oe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Uoe=$oe,zoe=Uoe;function _W(){}function PW(){}PW.resetWarningCache=_W;var Hoe=function(){function n(s,i,r,o,c,d){if(d!==zoe){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:PW,resetWarningCache:_W};return t.PropTypes=t,t};TW.exports=Hoe();var Voe=TW.exports;const ps=uL(Voe);function ny(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(u){try{h(s.next(u))}catch(p){o(p)}}function d(u){try{h(s.throw(u))}catch(p){o(p)}}function h(u){u.done?r(u.value):i(u.value).then(c,d)}h((s=s.apply(n,e||[])).next())})}const Goe=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function R1(n,e,t){const s=Woe(n),{webkitRelativePath:i}=n,r=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${n.name}`;return typeof s.path!="string"&&Q$(s,"path",r),Q$(s,"relativePath",r),s}function Woe(n){const{name:e}=n;if(e&&e.lastIndexOf(".")!==-1&&!n.type){const s=e.split(".").pop().toLowerCase(),i=Goe.get(s);i&&Object.defineProperty(n,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return n}function Q$(n,e,t){Object.defineProperty(n,e,{value:t,writable:!1,configurable:!1,enumerable:!0})}const qoe=[".DS_Store","Thumbs.db"];function Yoe(n){return ny(this,void 0,void 0,function*(){return pP(n)&&Xoe(n.dataTransfer)?Zoe(n.dataTransfer,n.type):Koe(n)?Qoe(n):Array.isArray(n)&&n.every(e=>"getFile"in e&&typeof e.getFile=="function")?Joe(n):[]})}function Xoe(n){return pP(n)}function Koe(n){return pP(n)&&pP(n.target)}function pP(n){return typeof n=="object"&&n!==null}function Qoe(n){return mM(n.target.files).map(e=>R1(e))}function Joe(n){return ny(this,void 0,void 0,function*(){return(yield Promise.all(n.map(t=>t.getFile()))).map(t=>R1(t))})}function Zoe(n,e){return ny(this,void 0,void 0,function*(){if(n.items){const t=mM(n.items).filter(i=>i.kind==="file");if(e!=="drop")return t;const s=yield Promise.all(t.map(ele));return J$(LW(s))}return J$(mM(n.files).map(t=>R1(t)))})}function J$(n){return n.filter(e=>qoe.indexOf(e.name)===-1)}function mM(n){if(n===null)return[];const e=[];for(let t=0;t<n.length;t++){const s=n[t];e.push(s)}return e}function ele(n){if(typeof n.webkitGetAsEntry!="function")return Z$(n);const e=n.webkitGetAsEntry();return e&&e.isDirectory?DW(e):Z$(n,e)}function LW(n){return n.reduce((e,t)=>[...e,...Array.isArray(t)?LW(t):[t]],[])}function Z$(n,e){return ny(this,void 0,void 0,function*(){var t;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const r=yield n.getAsFileSystemHandle();if(r===null)throw new Error(`${n} is not a File`);if(r!==void 0){const o=yield r.getFile();return o.handle=r,R1(o)}}const s=n.getAsFile();if(!s)throw new Error(`${n} is not a File`);return R1(s,(t=e==null?void 0:e.fullPath)!==null&&t!==void 0?t:void 0)})}function tle(n){return ny(this,void 0,void 0,function*(){return n.isDirectory?DW(n):sle(n)})}function DW(n){const e=n.createReader();return new Promise((t,s)=>{const i=[];function r(){e.readEntries(o=>ny(this,void 0,void 0,function*(){if(o.length){const c=Promise.all(o.map(tle));i.push(c),r()}else try{const c=yield Promise.all(i);t(c)}catch(c){s(c)}}),o=>{s(o)})}r()})}function sle(n){return ny(this,void 0,void 0,function*(){return new Promise((e,t)=>{n.file(s=>{const i=R1(s,n.fullPath);e(i)},s=>{t(s)})})})}var dR=function(n,e){if(n&&e){var t=Array.isArray(e)?e:e.split(",");if(t.length===0)return!0;var s=n.name||"",i=(n.type||"").toLowerCase(),r=i.replace(/\/.*$/,"");return t.some(function(o){var c=o.trim().toLowerCase();return c.charAt(0)==="."?s.toLowerCase().endsWith(c):c.endsWith("/*")?r===c.replace(/\/.*$/,""):i===c})}return!0};function eU(n){return rle(n)||ile(n)||IW(n)||nle()}function nle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ile(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function rle(n){if(Array.isArray(n))return gM(n)}function tU(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function sU(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?tU(Object(t),!0).forEach(function(s){RW(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):tU(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function RW(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function kN(n,e){return lle(n)||ole(n,e)||IW(n,e)||ale()}function ale(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IW(n,e){if(n){if(typeof n=="string")return gM(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gM(n,e)}}function gM(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=n[t];return s}function ole(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s=[],i=!0,r=!1,o,c;try{for(t=t.call(n);!(i=(o=t.next()).done)&&(s.push(o.value),!(e&&s.length===e));i=!0);}catch(d){r=!0,c=d}finally{try{!i&&t.return!=null&&t.return()}finally{if(r)throw c}}return s}}function lle(n){if(Array.isArray(n))return n}var cle=typeof dR=="function"?dR:dR.default,dle="file-invalid-type",hle="file-too-large",ule="file-too-small",ple="too-many-files",fle=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=e.split(","),s=t.length>1?"one of ".concat(t.join(", ")):t[0];return{code:dle,message:"File type must be ".concat(s)}},nU=function(e){return{code:hle,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},iU=function(e){return{code:ule,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},mle={code:ple,message:"Too many files"};function MW(n,e){var t=n.type==="application/x-moz-file"||cle(n,e);return[t,t?null:fle(e)]}function FW(n,e,t){if(Ym(n.size))if(Ym(e)&&Ym(t)){if(n.size>t)return[!1,nU(t)];if(n.size<e)return[!1,iU(e)]}else{if(Ym(e)&&n.size<e)return[!1,iU(e)];if(Ym(t)&&n.size>t)return[!1,nU(t)]}return[!0,null]}function Ym(n){return n!=null}function gle(n){var e=n.files,t=n.accept,s=n.minSize,i=n.maxSize,r=n.multiple,o=n.maxFiles,c=n.validator;return!r&&e.length>1||r&&o>=1&&e.length>o?!1:e.every(function(d){var h=MW(d,t),u=kN(h,1),p=u[0],f=FW(d,s,i),m=kN(f,1),x=m[0],g=c?c(d):null;return p&&x&&!g})}function fP(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function vk(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function rU(n){n.preventDefault()}function xle(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function yle(n){return n.indexOf("Edge/")!==-1}function ble(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return xle(n)||yle(n)}function gc(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(s){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return e.some(function(c){return!fP(s)&&c&&c.apply(void 0,[s].concat(r)),fP(s)})}}function vle(){return"showOpenFilePicker"in window}function wle(n){if(Ym(n)){var e=Object.entries(n).filter(function(t){var s=kN(t,2),i=s[0],r=s[1],o=!0;return OW(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(r)||!r.every(BW))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(t,s){var i=kN(s,2),r=i[0],o=i[1];return sU(sU({},t),{},RW({},r,o))},{});return[{description:"Files",accept:e}]}return n}function Sle(n){if(Ym(n))return Object.entries(n).reduce(function(e,t){var s=kN(t,2),i=s[0],r=s[1];return[].concat(eU(e),[i],eU(r))},[]).filter(function(e){return OW(e)||BW(e)}).join(",")}function Cle(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function Nle(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function OW(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function BW(n){return/^.*\.[\w]+$/.test(n)}var jle=["children"],Ale=["open"],Ele=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],kle=["refKey","onChange","onClick"];function Tle(n){return Lle(n)||Ple(n)||$W(n)||_le()}function _le(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ple(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Lle(n){if(Array.isArray(n))return xM(n)}function hR(n,e){return Ile(n)||Rle(n,e)||$W(n,e)||Dle()}function Dle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $W(n,e){if(n){if(typeof n=="string")return xM(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xM(n,e)}}function xM(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=n[t];return s}function Rle(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s=[],i=!0,r=!1,o,c;try{for(t=t.call(n);!(i=(o=t.next()).done)&&(s.push(o.value),!(e&&s.length===e));i=!0);}catch(d){r=!0,c=d}finally{try{!i&&t.return!=null&&t.return()}finally{if(r)throw c}}return s}}function Ile(n){if(Array.isArray(n))return n}function aU(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function Zs(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?aU(Object(t),!0).forEach(function(s){yM(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):aU(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function yM(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function mP(n,e){if(n==null)return{};var t=Mle(n,e),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}function Mle(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var c3=N.forwardRef(function(n,e){var t=n.children,s=mP(n,jle),i=zW(s),r=i.open,o=mP(i,Ale);return N.useImperativeHandle(e,function(){return{open:r}},[r]),Td.createElement(N.Fragment,null,t(Zs(Zs({},o),{},{open:r})))});c3.displayName="Dropzone";var UW={disabled:!1,getFilesFromEvent:Yoe,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};c3.defaultProps=UW;c3.propTypes={children:ps.func,accept:ps.objectOf(ps.arrayOf(ps.string)),multiple:ps.bool,preventDropOnDocument:ps.bool,noClick:ps.bool,noKeyboard:ps.bool,noDrag:ps.bool,noDragEventsBubbling:ps.bool,minSize:ps.number,maxSize:ps.number,maxFiles:ps.number,disabled:ps.bool,getFilesFromEvent:ps.func,onFileDialogCancel:ps.func,onFileDialogOpen:ps.func,useFsAccessApi:ps.bool,autoFocus:ps.bool,onDragEnter:ps.func,onDragLeave:ps.func,onDragOver:ps.func,onDrop:ps.func,onDropAccepted:ps.func,onDropRejected:ps.func,onError:ps.func,validator:ps.func};var bM={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function zW(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Zs(Zs({},UW),n),t=e.accept,s=e.disabled,i=e.getFilesFromEvent,r=e.maxSize,o=e.minSize,c=e.multiple,d=e.maxFiles,h=e.onDragEnter,u=e.onDragLeave,p=e.onDragOver,f=e.onDrop,m=e.onDropAccepted,x=e.onDropRejected,g=e.onFileDialogCancel,b=e.onFileDialogOpen,y=e.useFsAccessApi,C=e.autoFocus,w=e.preventDropOnDocument,S=e.noClick,j=e.noKeyboard,T=e.noDrag,k=e.noDragEventsBubbling,_=e.onError,L=e.validator,D=N.useMemo(function(){return Sle(t)},[t]),P=N.useMemo(function(){return wle(t)},[t]),I=N.useMemo(function(){return typeof b=="function"?b:oU},[b]),M=N.useMemo(function(){return typeof g=="function"?g:oU},[g]),O=N.useRef(null),F=N.useRef(null),B=N.useReducer(Fle,bM),U=hR(B,2),$=U[0],G=U[1],ne=$.isFocused,Z=$.isFileDialogActive,K=N.useRef(typeof window<"u"&&window.isSecureContext&&y&&vle()),X=function(){!K.current&&Z&&setTimeout(function(){if(F.current){var ye=F.current.files;ye.length||(G({type:"closeDialog"}),M())}},300)};N.useEffect(function(){return window.addEventListener("focus",X,!1),function(){window.removeEventListener("focus",X,!1)}},[F,Z,M,K]);var V=N.useRef([]),q=function(ye){O.current&&O.current.contains(ye.target)||(ye.preventDefault(),V.current=[])};N.useEffect(function(){return w&&(document.addEventListener("dragover",rU,!1),document.addEventListener("drop",q,!1)),function(){w&&(document.removeEventListener("dragover",rU),document.removeEventListener("drop",q))}},[O,w]),N.useEffect(function(){return!s&&C&&O.current&&O.current.focus(),function(){}},[O,C,s]);var ee=N.useCallback(function(ce){_?_(ce):console.error(ce)},[_]),ie=N.useCallback(function(ce){ce.preventDefault(),ce.persist(),ni(ce),V.current=[].concat(Tle(V.current),[ce.target]),vk(ce)&&Promise.resolve(i(ce)).then(function(ye){if(!(fP(ce)&&!k)){var se=ye.length,pe=se>0&&gle({files:ye,accept:D,minSize:o,maxSize:r,multiple:c,maxFiles:d,validator:L}),Ue=se>0&&!pe;G({isDragAccept:pe,isDragReject:Ue,isDragActive:!0,type:"setDraggedFiles"}),h&&h(ce)}}).catch(function(ye){return ee(ye)})},[i,h,ee,k,D,o,r,c,d,L]),Re=N.useCallback(function(ce){ce.preventDefault(),ce.persist(),ni(ce);var ye=vk(ce);if(ye&&ce.dataTransfer)try{ce.dataTransfer.dropEffect="copy"}catch{}return ye&&p&&p(ce),!1},[p,k]),Ye=N.useCallback(function(ce){ce.preventDefault(),ce.persist(),ni(ce);var ye=V.current.filter(function(pe){return O.current&&O.current.contains(pe)}),se=ye.indexOf(ce.target);se!==-1&&ye.splice(se,1),V.current=ye,!(ye.length>0)&&(G({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),vk(ce)&&u&&u(ce))},[O,u,k]),Le=N.useCallback(function(ce,ye){var se=[],pe=[];ce.forEach(function(Ue){var Be=MW(Ue,D),je=hR(Be,2),ze=je[0],Ft=je[1],Bt=FW(Ue,o,r),Ys=hR(Bt,2),In=Ys[0],wa=Ys[1],Fd=L?L(Ue):null;if(ze&&In&&!Fd)se.push(Ue);else{var uc=[Ft,wa];Fd&&(uc=uc.concat(Fd)),pe.push({file:Ue,errors:uc.filter(function(Gu){return Gu})})}}),(!c&&se.length>1||c&&d>=1&&se.length>d)&&(se.forEach(function(Ue){pe.push({file:Ue,errors:[mle]})}),se.splice(0)),G({acceptedFiles:se,fileRejections:pe,isDragReject:pe.length>0,type:"setFiles"}),f&&f(se,pe,ye),pe.length>0&&x&&x(pe,ye),se.length>0&&m&&m(se,ye)},[G,c,D,o,r,d,f,m,x,L]),te=N.useCallback(function(ce){ce.preventDefault(),ce.persist(),ni(ce),V.current=[],vk(ce)&&Promise.resolve(i(ce)).then(function(ye){fP(ce)&&!k||Le(ye,ce)}).catch(function(ye){return ee(ye)}),G({type:"reset"})},[i,Le,ee,k]),fe=N.useCallback(function(){if(K.current){G({type:"openDialog"}),I();var ce={multiple:c,types:P};window.showOpenFilePicker(ce).then(function(ye){return i(ye)}).then(function(ye){Le(ye,null),G({type:"closeDialog"})}).catch(function(ye){Cle(ye)?(M(ye),G({type:"closeDialog"})):Nle(ye)?(K.current=!1,F.current?(F.current.value=null,F.current.click()):ee(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):ee(ye)});return}F.current&&(G({type:"openDialog"}),I(),F.current.value=null,F.current.click())},[G,I,M,y,Le,ee,P,c]),Ne=N.useCallback(function(ce){!O.current||!O.current.isEqualNode(ce.target)||(ce.key===" "||ce.key==="Enter"||ce.keyCode===32||ce.keyCode===13)&&(ce.preventDefault(),fe())},[O,fe]),Pe=N.useCallback(function(){G({type:"focus"})},[]),nt=N.useCallback(function(){G({type:"blur"})},[]),gt=N.useCallback(function(){S||(ble()?setTimeout(fe,0):fe())},[S,fe]),hs=function(ye){return s?null:ye},qs=function(ye){return j?null:hs(ye)},Cn=function(ye){return T?null:hs(ye)},ni=function(ye){k&&ye.stopPropagation()},Ji=N.useMemo(function(){return function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ye=ce.refKey,se=ye===void 0?"ref":ye,pe=ce.role,Ue=ce.onKeyDown,Be=ce.onFocus,je=ce.onBlur,ze=ce.onClick,Ft=ce.onDragEnter,Bt=ce.onDragOver,Ys=ce.onDragLeave,In=ce.onDrop,wa=mP(ce,Ele);return Zs(Zs(yM({onKeyDown:qs(gc(Ue,Ne)),onFocus:qs(gc(Be,Pe)),onBlur:qs(gc(je,nt)),onClick:hs(gc(ze,gt)),onDragEnter:Cn(gc(Ft,ie)),onDragOver:Cn(gc(Bt,Re)),onDragLeave:Cn(gc(Ys,Ye)),onDrop:Cn(gc(In,te)),role:typeof pe=="string"&&pe!==""?pe:"presentation"},se,O),!s&&!j?{tabIndex:0}:{}),wa)}},[O,Ne,Pe,nt,gt,ie,Re,Ye,te,j,T,s]),Si=N.useCallback(function(ce){ce.stopPropagation()},[]),Ci=N.useMemo(function(){return function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ye=ce.refKey,se=ye===void 0?"ref":ye,pe=ce.onChange,Ue=ce.onClick,Be=mP(ce,kle),je=yM({accept:D,multiple:c,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:hs(gc(pe,te)),onClick:hs(gc(Ue,Si)),tabIndex:-1},se,F);return Zs(Zs({},je),Be)}},[F,t,c,te,s]);return Zs(Zs({},$),{},{isFocused:ne&&!s,getRootProps:Ji,getInputProps:Ci,rootRef:O,inputRef:F,open:hs(fe)})}function Fle(n,e){switch(e.type){case"focus":return Zs(Zs({},n),{},{isFocused:!0});case"blur":return Zs(Zs({},n),{},{isFocused:!1});case"openDialog":return Zs(Zs({},bM),{},{isFileDialogActive:!0});case"closeDialog":return Zs(Zs({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return Zs(Zs({},n),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return Zs(Zs({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return Zs({},bM);default:return n}}function oU(){}const Ole=({onFileSelect:n,selectedFile:e,onClear:t,disabled:s})=>{const i=N.useCallback(p=>{p.length>0&&n(p[0])},[n]),{getRootProps:r,getInputProps:o,isDragActive:c,isDragReject:d}=zW({onDrop:i,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg",".gif",".webp"],"text/plain":[".txt"]},maxFiles:1,maxSize:10*1024*1024,disabled:s}),h=p=>p?p.type.startsWith("image/")?a.jsx(P1,{className:"w-8 h-8"}):a.jsx(va,{className:"w-8 h-8"}):null,u=p=>p<1024?p+" B":p<1024*1024?(p/1024).toFixed(1)+" KB":(p/(1024*1024)).toFixed(1)+" MB";return a.jsx("div",{className:"w-full",children:a.jsx(Ie,{mode:"wait",children:e?a.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"p-4 bg-green-50 border-4 border-green-500 rounded-2xl",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-14 h-14 bg-green-100 rounded-xl border-2 border-green-500 flex items-center justify-center text-green-600",children:h(e)}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-bold text-green-800 truncate",children:e.name}),a.jsx("p",{className:"text-sm text-green-600",children:u(e.size)})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(kd,{className:"w-6 h-6 text-green-500"}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-green-200 rounded-full transition-colors",children:a.jsx(on,{className:"w-5 h-5 text-green-700"})})]})]})},"selected"):a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},...r(),className:`
                            p-8 border-4 border-dashed rounded-2xl cursor-pointer
                            transition-all duration-200
                            ${c&&!d?"border-nanobanana-green bg-green-50 scale-[1.02]":d?"border-red-500 bg-red-50":"border-gray-300 bg-gray-50 hover:border-nanobanana-blue hover:bg-blue-50"}
                            ${s?"opacity-50 cursor-not-allowed":""}
                        `,children:[a.jsx("input",{...o()}),a.jsxs("div",{className:"flex flex-col items-center text-center",children:[a.jsx(R.div,{animate:c?{scale:1.2,rotate:5}:{scale:1,rotate:0},className:`
                                    w-16 h-16 rounded-2xl border-4 border-black flex items-center justify-center mb-4
                                    shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                                    ${c?"bg-nanobanana-green text-white":"bg-nanobanana-yellow"}
                                `,children:a.jsx(q0,{className:"w-8 h-8"})}),a.jsx("p",{className:"font-bold text-lg font-comic mb-2",children:c?d?"Oops! Can't use this file ":"Drop it like it's hot! ":"Drag & drop your lesson here"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"or click to browse  PDF, Images up to 10MB"})]})]},"dropzone")})})},Ble=[{value:"MATH",label:" Mathematics",color:"bg-blue-500"},{value:"SCIENCE",label:" Science",color:"bg-green-500"},{value:"ENGLISH",label:" English",color:"bg-purple-500"},{value:"ARABIC",label:" Arabic",color:"bg-amber-500"},{value:"ISLAMIC_STUDIES",label:" Islamic Studies",color:"bg-teal-500"},{value:"SOCIAL_STUDIES",label:" Social Studies",color:"bg-orange-500"},{value:"ART",label:" Art",color:"bg-pink-500"},{value:"MUSIC",label:" Music",color:"bg-cyan-500"},{value:"OTHER",label:" Other",color:"bg-gray-500"}],$le=[{value:"kg",label:"Kindergarten"},{value:"grade-1",label:"Grade 1"},{value:"grade-2",label:"Grade 2"},{value:"grade-3",label:"Grade 3"},{value:"grade-4",label:"Grade 4"},{value:"grade-5",label:"Grade 5"},{value:"grade-6",label:"Grade 6"}],TN={FILE_TOO_LARGE:"Oops! This file is too big. Try a smaller one! ",INVALID_TYPE:"Hmm, I can't read this type of file. Try a PDF or image! ",PROCESSING_FAILED:"Jeffrey got confused. Let's try a different file! "};function qC(n,e="medium"){const t={default:"default",medium:"mqdefault",high:"hqdefault",maxres:"maxresdefault"},s=t[e]||t.medium;return`https://img.youtube.com/vi/${n}/${s}.jpg`}const HW="http://localhost:3000";async function VW(n){var t,s,i,r;const e=localStorage.getItem("auth_token");try{const o=await fetch(`${HW}/api/youtube/metadata/${n}`,{method:"GET",headers:{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}});if(!o.ok)return{id:n,title:"YouTube Video",thumbnail:qC(n,"high"),duration:null,channel:null};const c=await o.json();return{id:n,title:((t=c.data)==null?void 0:t.title)||"YouTube Video",thumbnail:((s=c.data)==null?void 0:s.thumbnail)||qC(n,"high"),duration:((i=c.data)==null?void 0:i.duration)||null,channel:((r=c.data)==null?void 0:r.channel)||null}}catch(o){return console.error("Failed to fetch video metadata:",o),{id:n,title:"YouTube Video",thumbnail:qC(n,"high"),duration:null,channel:null}}}async function Ule(n){var t;const e=localStorage.getItem("auth_token");try{const s=await fetch(`${HW}/api/youtube/transcript/${n}`,{method:"GET",headers:{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}});if(!s.ok)throw new Error("Failed to fetch transcript");return((t=(await s.json()).data)==null?void 0:t.transcript)||""}catch(s){throw console.error("Failed to fetch video transcript:",s),new Error("Could not load video transcript. The video may not have captions available.")}}const zle=({onVideoSelect:n,selectedVideo:e,onClear:t,disabled:s})=>{const[i,r]=N.useState(""),[o,c]=N.useState(""),[d,h]=N.useState(!1),u=g=>{const b=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/shorts\/([^&\n?#]+)/];for(const y of b){const C=g.match(y);if(C)return C[1]}return null},p=async g=>{h(!0),c("");try{const b=await VW(g);return h(!1),b}catch{throw h(!1),new Error("Could not fetch video information")}},f=g=>{r(g.target.value),c("")},m=async()=>{if(!i.trim()){c("Please enter a YouTube URL");return}const g=u(i);if(!g){c("Invalid YouTube URL. Please check and try again.");return}try{const b=await p(g);n(b),r("")}catch{c("Could not load video. Please try again.")}},x=g=>{g.key==="Enter"&&m()};return a.jsx("div",{className:"w-full",children:a.jsx(Ie,{mode:"wait",children:e?a.jsx(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"p-4 bg-red-50 border-4 border-red-500 rounded-2xl",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-24 h-16 rounded-lg overflow-hidden border-2 border-red-500 flex-shrink-0",children:a.jsx("img",{src:e.thumbnail,alt:e.title,className:"w-full h-full object-cover"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-bold text-red-800 truncate",children:e.title}),a.jsxs("p",{className:"text-sm text-red-600",children:[e.channel,"  ",e.duration]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(kd,{className:"w-6 h-6 text-red-500"}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-red-200 rounded-full transition-colors",children:a.jsx(on,{className:"w-5 h-5 text-red-700"})})]})]})},"selected"):a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-3",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:a.jsx(o3,{className:"w-5 h-5"})}),a.jsx("input",{type:"text",value:i,onChange:f,onKeyPress:x,placeholder:"Paste YouTube link here...",disabled:s||d,className:`
                                        w-full pl-12 pr-4 py-3 
                                        border-4 border-black rounded-xl
                                        font-medium
                                        shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]
                                        focus:outline-none focus:ring-2 focus:ring-nanobanana-yellow
                                        ${s?"bg-gray-100 cursor-not-allowed":"bg-white"}
                                        ${o?"border-red-500":""}
                                    `})]}),a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:m,disabled:s||d||!i.trim(),className:`
                                    px-5 py-3 font-bold
                                    border-4 border-black rounded-xl
                                    shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]
                                    transition-colors
                                    ${s||d||!i.trim()?"bg-gray-200 cursor-not-allowed":"bg-red-500 text-white hover:bg-red-600"}
                                `,children:d?a.jsx(R.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:a.jsx(q$,{className:"w-5 h-5"})}):a.jsx(q$,{className:"w-5 h-5"})})]}),a.jsx(Ie,{children:o&&a.jsxs(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center gap-2 text-red-600 text-sm font-medium",children:[a.jsx(Z5,{className:"w-4 h-4"}),o]})})]},"input")})})};/*! Capacitor: https://capacitorjs.com/ - MIT License */var I1;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(I1||(I1={}));class pb extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const Hle=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Vle=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},s=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:Hle(n),r=()=>i()!=="web",o=p=>{const f=h.get(p);return!!(f!=null&&f.platforms.has(i())||c(p))},c=p=>{var f;return(f=t.PluginHeaders)===null||f===void 0?void 0:f.find(m=>m.name===p)},d=p=>n.console.error(p),h=new Map,u=(p,f={})=>{const m=h.get(p);if(m)return console.warn(`Capacitor plugin "${p}" already registered. Cannot register plugins twice.`),m.proxy;const x=i(),g=c(p);let b;const y=async()=>(!b&&x in f?b=typeof f[x]=="function"?b=await f[x]():b=f[x]:e!==null&&!b&&"web"in f&&(b=typeof f.web=="function"?b=await f.web():b=f.web),b),C=(_,L)=>{var D,P;if(g){const I=g==null?void 0:g.methods.find(M=>L===M.name);if(I)return I.rtype==="promise"?M=>t.nativePromise(p,L.toString(),M):(M,O)=>t.nativeCallback(p,L.toString(),M,O);if(_)return(D=_[L])===null||D===void 0?void 0:D.bind(_)}else{if(_)return(P=_[L])===null||P===void 0?void 0:P.bind(_);throw new pb(`"${p}" plugin is not implemented on ${x}`,I1.Unimplemented)}},w=_=>{let L;const D=(...P)=>{const I=y().then(M=>{const O=C(M,_);if(O){const F=O(...P);return L=F==null?void 0:F.remove,F}else throw new pb(`"${p}.${_}()" is not implemented on ${x}`,I1.Unimplemented)});return _==="addListener"&&(I.remove=async()=>L()),I};return D.toString=()=>`${_.toString()}() { [capacitor code] }`,Object.defineProperty(D,"name",{value:_,writable:!1,configurable:!1}),D},S=w("addListener"),j=w("removeListener"),T=(_,L)=>{const D=S({eventName:_},L),P=async()=>{const M=await D;j({eventName:_,callbackId:M},L)},I=new Promise(M=>D.then(()=>M({remove:P})));return I.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await P()},I},k=new Proxy({},{get(_,L){switch(L){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return g?T:S;case"removeListener":return j;default:return w(L)}}});return s[p]=k,h.set(p,{name:p,proxy:k,platforms:new Set([...Object.keys(f),...g?[x]:[]])}),k};return t.convertFileSrc||(t.convertFileSrc=p=>p),t.getPlatform=i,t.handleError=d,t.isNativePlatform=r,t.isPluginAvailable=o,t.registerPlugin=u,t.Exception=pb,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},Gle=n=>n.Capacitor=Vle(n),am=Gle(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),YL=am.registerPlugin;class d3{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,t);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const i=this.listeners[e];if(!i){if(s){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}i.forEach(r=>r(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new am.Exception(e,I1.Unimplemented)}unavailable(e="not available"){return new am.Exception(e,I1.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(s=>{this.notifyListeners(e,s)}))}}const lU=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),cU=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Wle extends d3{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,r]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=cU(i).trim(),r=cU(r).trim(),t[i]=r}),t}async setCookie(e){try{const t=lU(e.key),s=lU(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${r}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}YL("CapacitorCookies",{web:()=>new Wle});const qle=async n=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>t(i),s.readAsDataURL(n)}),Yle=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,r,o)=>(i[r]=n[e[o]],i),{})},Xle=(n,e=!0)=>n?Object.entries(n).reduce((s,i)=>{const[r,o]=i;let c,d;return Array.isArray(o)?(d="",o.forEach(h=>{c=e?encodeURIComponent(h):h,d+=`${r}=${c}&`}),d.slice(0,-1)):(c=e?encodeURIComponent(o):o,d=`${r}=${c}`),`${s}&${d}`},"").substr(1):null,Kle=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=Yle(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const r=new URLSearchParams;for(const[o,c]of Object.entries(n.data||{}))r.set(o,c);t.body=r.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const r=new FormData;if(n.data instanceof FormData)n.data.forEach((c,d)=>{r.append(d,c)});else for(const c of Object.keys(n.data))r.append(c,n.data[c]);t.body=r;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class Qle extends d3{async request(e){const t=Kle(e,e.webFetchExtra),s=Xle(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,r=await fetch(i,t),o=r.headers.get("content-type")||"";let{responseType:c="text"}=r.ok?e:{};o.includes("application/json")&&(c="json");let d,h;switch(c){case"arraybuffer":case"blob":h=await r.blob(),d=await qle(h);break;case"json":d=await r.json();break;case"document":case"text":default:d=await r.text()}const u={};return r.headers.forEach((p,f)=>{u[f]=p}),{data:d,headers:u,status:r.status,url:r.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}YL("CapacitorHttp",{web:()=>new Qle});var xu;(function(n){n.Prompt="PROMPT",n.Camera="CAMERA",n.Photos="PHOTOS"})(xu||(xu={}));var YC;(function(n){n.Rear="REAR",n.Front="FRONT"})(YC||(YC={}));var XC;(function(n){n.Uri="uri",n.Base64="base64",n.DataUrl="dataUrl"})(XC||(XC={}));class Jle extends d3{async getPhoto(e){return new Promise(async(t,s)=>{if(e.webUseInput||e.source===xu.Photos)this.fileInputExperience(e,t,s);else if(e.source===xu.Prompt){let i=document.querySelector("pwa-action-sheet");i||(i=document.createElement("pwa-action-sheet"),document.body.appendChild(i)),i.header=e.promptLabelHeader||"Photo",i.cancelable=!1,i.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],i.addEventListener("onSelection",async r=>{r.detail===0?this.fileInputExperience(e,t,s):this.cameraExperience(e,t,s)})}else this.cameraExperience(e,t,s)})}async pickImages(e){return new Promise(async(t,s)=>{this.multipleFileInputExperience(t,s)})}async cameraExperience(e,t,s){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=e.direction===YC.Front?"user":"environment",document.body.appendChild(i);try{await i.componentOnReady(),i.addEventListener("onPhoto",async r=>{const o=r.detail;o===null?s(new pb("User cancelled photos app")):o instanceof Error?s(o):t(await this._getCameraPhoto(o,e)),i.dismiss(),document.body.removeChild(i)}),i.present()}catch{this.fileInputExperience(e,t,s)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,t,s)}fileInputExperience(e,t,s){let i=document.querySelector("#_capacitor-camera-input");const r=()=>{var o;(o=i.parentNode)===null||o===void 0||o.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",o=>{const c=i.files[0];let d="jpeg";if(c.type==="image/png"?d="png":c.type==="image/gif"&&(d="gif"),e.resultType==="dataUrl"||e.resultType==="base64"){const h=new FileReader;h.addEventListener("load",()=>{if(e.resultType==="dataUrl")t({dataUrl:h.result,format:d});else if(e.resultType==="base64"){const u=h.result.split(",")[1];t({base64String:u,format:d})}r()}),h.readAsDataURL(c)}else t({webPath:URL.createObjectURL(c),format:d}),r()}),i.addEventListener("cancel",o=>{s(new pb("User cancelled photos app")),r()})),i.accept="image/*",i.capture=!0,e.source===xu.Photos||e.source===xu.Prompt?i.removeAttribute("capture"):e.direction===YC.Front?i.capture="user":e.direction===YC.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(e,t){let s=document.querySelector("#_capacitor-camera-input-multiple");const i=()=>{var r;(r=s.parentNode)===null||r===void 0||r.removeChild(s)};s||(s=document.createElement("input"),s.id="_capacitor-camera-input-multiple",s.type="file",s.hidden=!0,s.multiple=!0,document.body.appendChild(s),s.addEventListener("change",r=>{const o=[];for(let c=0;c<s.files.length;c++){const d=s.files[c];let h="jpeg";d.type==="image/png"?h="png":d.type==="image/gif"&&(h="gif"),o.push({webPath:URL.createObjectURL(d),format:h})}e({photos:o}),i()}),s.addEventListener("cancel",r=>{t(new pb("User cancelled photos app")),i()})),s.accept="image/*",s.click()}_getCameraPhoto(e,t){return new Promise((s,i)=>{const r=new FileReader,o=e.type.split("/")[1];t.resultType==="uri"?s({webPath:URL.createObjectURL(e),format:o,saved:!1}):(r.readAsDataURL(e),r.onloadend=()=>{const c=r.result;t.resultType==="dataUrl"?s({dataUrl:c,format:o,saved:!1}):s({base64String:c.split(",")[1],format:o,saved:!1})},r.onerror=c=>{i(c)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const yS=YL("Camera",{web:()=>new Jle}),Zle=()=>{const[n,e]=N.useState(!1),[t,s]=N.useState(null),i=am.isNativePlatform(),r=N.useCallback(async()=>{var u,p,f;console.log("[useCamera] takePhoto called, platform:",am.getPlatform()),e(!0),s(null);try{console.log("[useCamera] Calling Camera.getPhoto...");const m=await yS.getPhoto({quality:90,allowEditing:!1,resultType:XC.Base64,source:xu.Camera,correctOrientation:!0,width:2048,height:2048});console.log("[useCamera] Camera.getPhoto returned:",{hasBase64:!!m.base64String,base64Length:((u=m.base64String)==null?void 0:u.length)||0,format:m.format,webPath:m.webPath}),e(!1);const x=uR(m.base64String,`photo_${Date.now()}.${m.format}`);return console.log("[useCamera] takePhoto complete, file size:",x.size),{file:x,base64:m.base64String,format:m.format,webPath:m.webPath}}catch(m){if(e(!1),console.error("[useCamera] takePhoto error:",{message:m.message,code:m.code,stack:m.stack}),(p=m.message)!=null&&p.includes("User cancelled")||(f=m.message)!=null&&f.includes("cancelled"))return console.log("[useCamera] User cancelled photo capture"),null;throw s(m.message||"Failed to capture photo"),m}},[]),o=N.useCallback(async()=>{var u,p,f;console.log("[useCamera] pickFromGallery called, platform:",am.getPlatform()),e(!0),s(null);try{console.log("[useCamera] Calling Camera.getPhoto for gallery...");const m=await yS.getPhoto({quality:90,allowEditing:!1,resultType:XC.Base64,source:xu.Photos,correctOrientation:!0,width:2048,height:2048});console.log("[useCamera] Gallery photo returned:",{hasBase64:!!m.base64String,base64Length:((u=m.base64String)==null?void 0:u.length)||0,format:m.format,webPath:m.webPath}),e(!1);const x=uR(m.base64String,`photo_${Date.now()}.${m.format}`);return console.log("[useCamera] pickFromGallery complete, file size:",x.size),{file:x,base64:m.base64String,format:m.format,webPath:m.webPath}}catch(m){if(e(!1),console.error("[useCamera] pickFromGallery error:",{message:m.message,code:m.code,stack:m.stack}),(p=m.message)!=null&&p.includes("User cancelled")||(f=m.message)!=null&&f.includes("cancelled"))return console.log("[useCamera] User cancelled gallery selection"),null;throw s(m.message||"Failed to select photo"),m}},[]),c=N.useCallback(async()=>{var u,p;e(!0),s(null);try{const f=await yS.getPhoto({quality:90,allowEditing:!1,resultType:XC.Base64,source:xu.Prompt,correctOrientation:!0,width:2048,height:2048,promptLabelHeader:"Add Lesson Photo",promptLabelCancel:"Cancel",promptLabelPhoto:"Choose from Photos",promptLabelPicture:"Take Photo"});return e(!1),{file:uR(f.base64String,`photo_${Date.now()}.${f.format}`),base64:f.base64String,format:f.format,webPath:f.webPath}}catch(f){if(e(!1),(u=f.message)!=null&&u.includes("User cancelled")||(p=f.message)!=null&&p.includes("cancelled"))return null;throw s(f.message||"Failed to capture photo"),f}},[]),d=N.useCallback(async()=>{try{return await yS.checkPermissions()}catch(u){return console.error("Error checking camera permissions:",u),{camera:"denied",photos:"denied"}}},[]),h=N.useCallback(async()=>{try{return await yS.requestPermissions()}catch(u){throw console.error("Error requesting camera permissions:",u),u}},[]);return{takePhoto:r,pickFromGallery:o,captureOrSelect:c,checkPermissions:d,requestPermissions:h,isCapturing:n,error:t,isNative:i,clearError:()=>s(null)}};function uR(n,e){console.log("[useCamera] base64ToFile called:",{filename:e,base64Length:(n==null?void 0:n.length)||0,base64Preview:(n==null?void 0:n.substring(0,50))+"..."});try{if(!n||typeof n!="string")throw console.error("[useCamera] Invalid base64String:",typeof n),new Error("Invalid base64 string provided");let t=n;for(n.includes(",")&&(t=n.split(",")[1],console.log("[useCamera] Stripped data URL prefix, new length:",t.length)),/^[A-Za-z0-9+/]*={0,2}$/.test(t)||(console.error("[useCamera] Invalid base64 characters detected"),t=t.replace(/[^A-Za-z0-9+/=]/g,""),console.log("[useCamera] Cleaned base64, new length:",t.length));t.length%4!==0;)t+="=";const i=e.split(".").pop().toLowerCase(),o={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[i]||"image/jpeg";console.log("[useCamera] Using mimeType:",o);let c;try{const u=atob(t);console.log("[useCamera] atob successful, binary length:",u.length),c=new Uint8Array(u.length);for(let p=0;p<u.length;p++)c[p]=u.charCodeAt(p)}catch(u){throw console.error("[useCamera] atob failed:",u.message),console.log("[useCamera] Attempting fetch-based decode fallback..."),new Error(`Base64 decode failed: ${u.message}`)}const d=new Blob([c],{type:o});console.log("[useCamera] Blob created, size:",d.size);const h=new File([d],e,{type:o});return console.log("[useCamera] File created successfully:",{name:h.name,size:h.size,type:h.type}),h}catch(t){throw console.error("[useCamera] base64ToFile error:",{error:t.message,stack:t.stack,filename:e,base64Length:(n==null?void 0:n.length)||0}),t}}const ece="modulepreload",tce=function(n){return"/"+n},dU={},XL=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(d=>{if(d=tce(d),d in dU)return;dU[d]=!0;const h=d.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":ece,h||(p.as="script"),p.crossOrigin="",p.href=d,c&&p.setAttribute("nonce",c),document.head.appendChild(p),h)return new Promise((f,m)=>{p.addEventListener("load",f),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return i.then(o=>{for(const c of o||[])c.status==="rejected"&&r(c.reason);return e().catch(r)})},bS=YL("CameraPreview",{web:()=>XL(()=>import("./web-Q5Tnastf.js"),[]).then(n=>new n.CameraPreviewWeb)}),sce=({isOpen:n,onCapture:e,onClose:t})=>{const[s,i]=N.useState(!1),[r,o]=N.useState(!1),[c,d]=N.useState("off"),[h,u]=N.useState(null),[p,f]=N.useState(null),[m,x]=N.useState("rear"),g=N.useRef(null),b=am.isNativePlatform();N.useEffect(()=>(n&&b&&y(),()=>{s&&w()}),[n]);const y=async()=>{console.log("[DocumentCamera] startCamera called, platform:",am.getPlatform());try{f(null),document.body.classList.add("camera-active"),document.documentElement.style.backgroundColor="transparent",document.body.style.backgroundColor="transparent";const D=document.getElementById("root");D&&(D.style.backgroundColor="transparent",Array.from(D.children).forEach(I=>{I.setAttribute("data-camera-hidden","true"),I.style.visibility="hidden"}));const P={position:m,toBack:!0,parent:"camera-preview-container",className:"camera-preview",disableAudio:!0,enableZoom:!0,width:window.innerWidth,height:window.innerHeight,x:0,y:0};console.log("[DocumentCamera] Starting CameraPreview with config:",P),await bS.start(P),console.log("[DocumentCamera] CameraPreview started successfully"),i(!0)}catch(D){console.error("[DocumentCamera] Failed to start camera:",{message:D.message,code:D.code,stack:D.stack}),f(D.message||"Failed to start camera"),C()}},C=()=>{document.body.classList.remove("camera-active"),document.documentElement.style.backgroundColor="",document.body.style.backgroundColor="";const D=document.getElementById("root");D&&(D.style.backgroundColor="",Array.from(D.children).forEach(P=>{P.getAttribute("data-camera-hidden")==="true"&&(P.removeAttribute("data-camera-hidden"),P.style.visibility="")}))},w=async()=>{try{await bS.stop(),i(!1),C()}catch(D){console.error("Failed to stop camera:",D),C()}},S=async()=>{var D,P;if(!r){console.log("[DocumentCamera] handleCapture called"),o(!0);try{console.log("[DocumentCamera] Calling CameraPreview.capture with quality: 90");const I=await bS.capture({quality:90});if(console.log("[DocumentCamera] CameraPreview.capture returned:",{hasValue:!!I.value,valueLength:((D=I.value)==null?void 0:D.length)||0,valuePreview:((P=I.value)==null?void 0:P.substring(0,50))+"..."}),I.value){const M=I.value;u(M),console.log("[DocumentCamera] Image captured, base64 length:",M.length)}else console.error("[DocumentCamera] No value in capture result"),f("No image data received from camera")}catch(I){console.error("[DocumentCamera] Capture failed:",{message:I.message,code:I.code,stack:I.stack}),f(I.message||"Failed to capture photo")}finally{o(!1)}}},j=N.useCallback(()=>{if(console.log("[DocumentCamera] handleConfirm called, capturedImage length:",(h==null?void 0:h.length)||0),h)try{const D=GW(h,`document_${Date.now()}.jpg`);console.log("[DocumentCamera] File created:",{name:D.name,size:D.size,type:D.type}),e({file:D,base64:h,format:"jpeg"}),w()}catch(D){console.error("[DocumentCamera] handleConfirm error:",{message:D.message,stack:D.stack}),f(`Failed to process image: ${D.message}`)}},[h,e]),T=()=>{u(null)},k=()=>{w(),u(null),t()},_=async()=>{const D=["off","on","auto"],P=D.indexOf(c),I=D[(P+1)%D.length];try{await bS.setFlashMode({flashMode:I}),d(I)}catch(M){console.error("Failed to set flash mode:",M)}},L=async()=>{try{await bS.flip(),x(D=>D==="rear"?"front":"rear")}catch(D){console.error("Failed to flip camera:",D)}};return n?b?TL.createPortal(a.jsx(Ie,{children:a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100]",style:{backgroundColor:"transparent"},ref:g,children:[a.jsx("div",{id:"camera-preview-container",className:"absolute inset-0",style:{backgroundColor:"transparent"}}),a.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[!h&&a.jsx(nce,{}),h&&a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-black",children:a.jsx("img",{src:`data:image/jpeg;base64,${h}`,alt:"Captured document",className:"w-full h-full object-contain"})})]}),a.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pointer-events-auto",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(R.button,{whileTap:{scale:.9},onClick:k,className:"w-12 h-12 bg-black/50 backdrop-blur-sm rounded-full flex items-center justify-center",children:a.jsx(on,{className:"w-6 h-6 text-white"})}),!h&&a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(R.button,{whileTap:{scale:.9},onClick:_,className:"w-12 h-12 bg-black/50 backdrop-blur-sm rounded-full flex items-center justify-center",children:c==="off"?a.jsx(boe,{className:"w-5 h-5 text-white"}):a.jsx(Vu,{className:`w-5 h-5 ${c==="auto"?"text-yellow-400":"text-yellow-300"}`})}),a.jsx(R.button,{whileTap:{scale:.9},onClick:L,className:"w-12 h-12 bg-black/50 backdrop-blur-sm rounded-full flex items-center justify-center",children:a.jsx(moe,{className:"w-5 h-5 text-white"})})]})]})}),!h&&a.jsxs("div",{className:"absolute top-20 left-0 right-0 text-center pointer-events-none",children:[a.jsx(R.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-white text-lg font-bold drop-shadow-lg",children:"Align document within the frame"}),a.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Keep steady for best results"})]}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-10 pointer-events-auto",children:h?a.jsxs("div",{className:"flex items-center justify-center gap-6",children:[a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:T,className:"flex items-center gap-2 px-6 py-3 bg-white/20 backdrop-blur-sm rounded-full text-white font-bold",children:[a.jsx(L1,{className:"w-5 h-5"}),"Retake"]}),a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:j,className:"flex items-center gap-2 px-8 py-4 bg-nanobanana-green rounded-full text-white font-bold border-4 border-white shadow-lg",children:[a.jsx(bo,{className:"w-6 h-6"}),"Use Photo"]})]}):a.jsx("div",{className:"flex items-center justify-center",children:a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.9},onClick:S,disabled:r||!s,className:"w-20 h-20 bg-white rounded-full border-4 border-white shadow-lg flex items-center justify-center disabled:opacity-50",children:a.jsx("div",{className:"w-16 h-16 bg-white rounded-full border-4 border-gray-300"})})})}),p&&a.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-4 bg-red-500/90 rounded-xl text-white text-center max-w-xs pointer-events-auto",children:[a.jsx("p",{className:"font-bold mb-2",children:"Camera Error"}),a.jsx("p",{className:"text-sm",children:p}),a.jsx("button",{onClick:k,className:"mt-3 px-4 py-2 bg-white/20 rounded-lg text-sm",children:"Close"})]})]})}),document.body):a.jsx(ice,{onCapture:e,onClose:t}):null},nce=()=>a.jsxs("div",{className:"absolute inset-0 flex items-center justify-center px-4 py-16",children:[a.jsxs("div",{className:"relative w-full max-w-2xl h-full max-h-[80vh]",children:[a.jsxs("div",{className:"absolute inset-0",children:[a.jsxs("div",{className:"absolute top-0 left-0 w-16 h-16",children:[a.jsx("div",{className:"absolute top-0 left-0 w-full h-1.5 bg-white rounded-full shadow-lg"}),a.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-white rounded-full shadow-lg"})]}),a.jsxs("div",{className:"absolute top-0 right-0 w-16 h-16",children:[a.jsx("div",{className:"absolute top-0 right-0 w-full h-1.5 bg-white rounded-full shadow-lg"}),a.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-full bg-white rounded-full shadow-lg"})]}),a.jsxs("div",{className:"absolute bottom-0 left-0 w-16 h-16",children:[a.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1.5 bg-white rounded-full shadow-lg"}),a.jsx("div",{className:"absolute bottom-0 left-0 w-1.5 h-full bg-white rounded-full shadow-lg"})]}),a.jsxs("div",{className:"absolute bottom-0 right-0 w-16 h-16",children:[a.jsx("div",{className:"absolute bottom-0 right-0 w-full h-1.5 bg-white rounded-full shadow-lg"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-1.5 h-full bg-white rounded-full shadow-lg"})]})]}),a.jsx(R.div,{initial:{top:"0%"},animate:{top:["0%","100%","0%"]},transition:{duration:3,repeat:1/0,ease:"linear"},className:"absolute left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-nanobanana-blue to-transparent opacity-60"}),a.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-white/30 rounded-lg"})]}),a.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.6) 100%)"}})]}),ice=({onCapture:n,onClose:e})=>{const t=N.useRef(null),[s,i]=N.useState(null),r=c=>{var h;const d=(h=c.target.files)==null?void 0:h[0];if(d&&d.type.startsWith("image/")){const u=new FileReader;u.onload=()=>{i(u.result)},u.readAsDataURL(d)}},o=()=>{if(s){const c=s.split(",")[1],d=GW(c,`document_${Date.now()}.jpg`);n({file:d,base64:c,format:"jpeg"})}};return a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] bg-black flex flex-col",children:[a.jsxs("div",{className:"p-4 flex items-center justify-between",children:[a.jsx("button",{onClick:e,className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:a.jsx(on,{className:"w-5 h-5 text-white"})}),a.jsx("span",{className:"text-white font-bold",children:"Capture Document"}),a.jsx("div",{className:"w-10"})]}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:s?a.jsx("div",{className:"relative w-full max-w-md",children:a.jsx("img",{src:s,alt:"Preview",className:"w-full rounded-xl border-4 border-white"})}):a.jsxs("div",{onClick:()=>{var c;return(c=t.current)==null?void 0:c.click()},className:"w-full max-w-md aspect-[3/4] bg-white/10 rounded-xl border-4 border-dashed border-white/30 flex flex-col items-center justify-center cursor-pointer",children:[a.jsx(hP,{className:"w-16 h-16 text-white/60 mb-4"}),a.jsx("p",{className:"text-white font-bold",children:"Tap to take photo"}),a.jsx("p",{className:"text-white/60 text-sm mt-1",children:"or select from gallery"}),a.jsx("input",{ref:t,type:"file",accept:"image/*",capture:"environment",onChange:r,className:"hidden"})]})}),a.jsx("div",{className:"p-6 pb-10",children:s?a.jsxs("div",{className:"flex items-center justify-center gap-4",children:[a.jsx("button",{onClick:()=>i(null),className:"px-6 py-3 bg-white/20 rounded-full text-white font-bold",children:"Retake"}),a.jsx("button",{onClick:o,className:"px-8 py-4 bg-nanobanana-green rounded-full text-white font-bold border-4 border-white",children:"Use Photo"})]}):a.jsx("button",{onClick:()=>{var c;return(c=t.current)==null?void 0:c.click()},className:"w-full py-4 bg-white rounded-xl font-bold text-lg",children:"Open Camera"})})]})};function GW(n,e){console.log("[DocumentCamera] base64ToFile called:",{filename:e,base64Length:(n==null?void 0:n.length)||0});const t="image/jpeg";try{if(!n||typeof n!="string")throw new Error("Invalid base64 string provided");let s=n;for(n.includes(",")&&(s=n.split(",")[1],console.log("[DocumentCamera] Stripped data URL prefix")),/^[A-Za-z0-9+/]*={0,2}$/.test(s)||(console.warn("[DocumentCamera] Invalid base64 characters detected, cleaning..."),s=s.replace(/[^A-Za-z0-9+/=]/g,""));s.length%4!==0;)s+="=";console.log("[DocumentCamera] Clean base64 length:",s.length);const r=atob(s);console.log("[DocumentCamera] atob successful, binary length:",r.length);const o=new Uint8Array(r.length);for(let h=0;h<r.length;h++)o[h]=r.charCodeAt(h);const c=new Blob([o],{type:t}),d=new File([c],e,{type:t});return console.log("[DocumentCamera] File created:",{name:d.name,size:d.size,type:d.type}),d}catch(s){throw console.error("[DocumentCamera] base64ToFile error:",{message:s.message,stack:s.stack,base64Length:(n==null?void 0:n.length)||0}),s}}const rce=({onImageCapture:n,capturedImage:e,onClear:t})=>{const{pickFromGallery:s,isCapturing:i,error:r,clearError:o,isNative:c}=Zle(),[d,h]=N.useState(null),[u,p]=N.useState(!1),f=N.useRef(null),m=N.useCallback(()=>{console.log("[CameraCapture] handleCameraCapture called"),o(),p(!0)},[o]),x=N.useCallback(w=>{var S,j;if(console.log("[CameraCapture] handleDocumentCapture called:",{hasResult:!!w,hasFile:!!(w!=null&&w.file),fileSize:(S=w==null?void 0:w.file)==null?void 0:S.size,base64Length:((j=w==null?void 0:w.base64)==null?void 0:j.length)||0,format:w==null?void 0:w.format}),p(!1),w){const T=`data:image/${w.format};base64,${w.base64}`;console.log("[CameraCapture] Created preview URL, length:",T.length),h(T),n(w.file,T)}else console.warn("[CameraCapture] No result from document camera")},[n]),g=N.useCallback(()=>{console.log("[CameraCapture] handleCloseDocumentCamera called"),p(!1)},[]),b=N.useCallback(async()=>{var w,S;console.log("[CameraCapture] handleGallerySelect called"),o();try{const j=await s();if(console.log("[CameraCapture] Gallery result:",{hasResult:!!j,hasFile:!!(j!=null&&j.file),fileSize:(w=j==null?void 0:j.file)==null?void 0:w.size,base64Length:((S=j==null?void 0:j.base64)==null?void 0:S.length)||0}),j){const T=`data:image/${j.format};base64,${j.base64}`;h(T),n(j.file,T)}}catch(j){console.error("[CameraCapture] Gallery selection failed:",{message:j.message,stack:j.stack})}},[s,n,o]),y=N.useCallback(w=>{var j;console.log("[CameraCapture] handleFileChange called");const S=(j=w.target.files)==null?void 0:j[0];if(console.log("[CameraCapture] File selected:",{hasFile:!!S,fileName:S==null?void 0:S.name,fileSize:S==null?void 0:S.size,fileType:S==null?void 0:S.type}),S&&S.type.startsWith("image/")){const T=new FileReader;T.onload=()=>{var k;console.log("[CameraCapture] FileReader complete, result length:",((k=T.result)==null?void 0:k.length)||0),h(T.result),n(S,T.result)},T.onerror=k=>{console.error("[CameraCapture] FileReader error:",k)},T.readAsDataURL(S)}},[n]),C=N.useCallback(()=>{h(null),f.current&&(f.current.value=""),t()},[t]);return e||d?a.jsxs(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative rounded-2xl border-4 border-black overflow-hidden bg-gray-100",children:[a.jsx("img",{src:d||e,alt:"Captured lesson",className:"w-full h-48 object-contain bg-gray-900"}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/70 to-transparent",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-white",children:[a.jsx(bo,{className:"w-5 h-5 text-green-400"}),a.jsx("span",{className:"font-bold text-sm",children:"Photo captured!"})]}),a.jsxs("button",{onClick:C,className:"flex items-center gap-1 px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-white text-sm font-bold transition-colors",children:[a.jsx(L1,{className:"w-4 h-4"}),"Retake"]})]})})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx(Ie,{children:r&&a.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:"p-3 bg-red-50 border-2 border-red-200 rounded-xl text-red-700 text-sm",children:r})}),c?a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:m,disabled:i,className:"flex flex-col items-center justify-center p-6 bg-nanobanana-blue text-white rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50",children:[i?a.jsx(nc,{className:"w-10 h-10 mb-2 animate-spin"}):a.jsx(hP,{className:"w-10 h-10 mb-2"}),a.jsx("span",{className:"font-bold",children:"Take Photo"}),a.jsx("span",{className:"text-xs opacity-80 mt-1",children:"Use camera"})]}),a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:b,disabled:i,className:"flex flex-col items-center justify-center p-6 bg-nanobanana-green text-white rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all disabled:opacity-50",children:[i?a.jsx(nc,{className:"w-10 h-10 mb-2 animate-spin"}):a.jsx(Kae,{className:"w-10 h-10 mb-2"}),a.jsx("span",{className:"font-bold",children:"Photo Library"}),a.jsx("span",{className:"text-xs opacity-80 mt-1",children:"Choose existing"})]})]}):a.jsxs("div",{onClick:()=>{var w;return(w=f.current)==null?void 0:w.click()},className:"p-8 bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl border-4 border-dashed border-gray-300 hover:border-nanobanana-blue cursor-pointer transition-colors text-center",children:[a.jsx(hP,{className:"w-12 h-12 mx-auto mb-4 text-nanobanana-blue"}),a.jsx("p",{className:"font-bold text-gray-700",children:"Click to take or select a photo"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Capture worksheets, textbook pages, or notes"}),a.jsx("input",{ref:f,type:"file",accept:"image/*",capture:"environment",onChange:y,className:"hidden"})]}),a.jsxs("div",{className:"bg-yellow-50 rounded-xl p-4 border-2 border-yellow-200",children:[a.jsx("p",{className:"font-bold text-yellow-800 text-sm mb-2",children:"Tips for best results:"}),a.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[a.jsx("li",{children:" Make sure text is clear and readable"}),a.jsx("li",{children:" Good lighting helps Jeffrey read better"}),a.jsx("li",{children:" Hold the camera steady to avoid blur"}),a.jsx("li",{children:" Include the full page in the frame"})]})]}),a.jsx(sce,{isOpen:u,onCapture:x,onClose:g})]})},ace={idle:Ut,uploading:js,extracting:js,analyzing:mW,generating:qL,complete:kd,error:Z5},oce={idle:"bg-gray-400",uploading:"bg-blue-500",extracting:"bg-purple-500",analyzing:"bg-pink-500",generating:"bg-orange-500",complete:"bg-green-500",error:"bg-red-500"},WW=({stage:n,progress:e,useChildLabels:t=!0})=>{const[s,i]=N.useState("");N.useEffect(()=>{if(n==="idle"||n==="complete"||n==="error"){i("");return}i(ak[Math.floor(Math.random()*ak.length)]);const p=setInterval(()=>{i(ak[Math.floor(Math.random()*ak.length)])},3e3);return()=>clearInterval(p)},[n]);const r=I0[n]||I0.idle,o=Object.keys(I0).filter(p=>p!=="idle"&&p!=="error"),c=o.indexOf(n),d=ace[n]||Ut,h=oce[n]||"bg-nanobanana-yellow",u=t?r.childLabel:r.label;return a.jsxs("div",{className:"flex flex-col items-center py-8 px-4",children:[a.jsx(R.div,{animate:{y:[0,-10,0],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`
                    w-24 h-24 ${h}
                    rounded-full border-4 border-black
                    shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                    flex items-center justify-center
                    text-white mb-6
                `,children:a.jsx(d,{className:"w-12 h-12"})}),a.jsx(R.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-xl font-bold font-comic mb-6 text-center",children:u||"Processing..."},n),a.jsxs("div",{className:"w-full max-w-xs mb-6",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded-full border-2 border-black overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${e}%`},transition:{duration:.5},className:`h-full ${h}`})}),a.jsxs("p",{className:"text-center text-sm font-bold mt-2 text-gray-600",children:[Math.round(e),"%"]})]}),a.jsx("div",{className:"flex gap-2",children:o.map((p,f)=>a.jsx(R.div,{initial:{scale:0},animate:{scale:1,backgroundColor:f<=c?"#22c55e":"#e5e7eb"},transition:{delay:f*.1},className:"w-3 h-3 rounded-full border-2 border-black"},p))}),s&&a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"mt-6 text-center",children:a.jsx("p",{className:"text-gray-500 text-sm italic",children:s})},s),n==="error"&&a.jsx(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mt-4 p-4 bg-red-50 border-2 border-red-200 rounded-xl",children:a.jsx("p",{className:"text-red-600 font-medium text-center",children:"Don't worry! Let's try again."})})]})},lce=({value:n,onChange:e,disabled:t=!1})=>a.jsxs("div",{className:"w-full",children:[a.jsx("label",{className:"block text-sm font-bold mb-2",children:"Subject"}),a.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:Ble.map(s=>{const i=n===s.value,[r,...o]=s.label.split(" "),c=o.join(" ");return a.jsxs(R.button,{type:"button",whileHover:t?{}:{scale:1.02},whileTap:t?{}:{scale:.98},onClick:()=>!t&&e(s.value),disabled:t,className:`
                                relative flex flex-col items-center justify-center
                                p-2 rounded-xl border-2 transition-all
                                ${i?"border-black bg-nanobanana-yellow shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]":"border-gray-200 bg-white hover:border-gray-400"}
                                ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                            `,children:[a.jsx("span",{className:"text-xl mb-1",children:r}),a.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:c}),i&&a.jsx(R.div,{layoutId:"subject-indicator",className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-black flex items-center justify-center",children:a.jsx("span",{className:"text-white text-xs",children:""})})]},s.value)})})]}),cce=({value:n,onChange:e,disabled:t=!1})=>a.jsxs("div",{className:"w-full",children:[a.jsx("label",{className:"block text-sm font-bold mb-2",children:"Grade Level"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:$le.map(s=>{const i=n===s.value;return a.jsx(R.button,{type:"button",whileHover:t?{}:{scale:1.05},whileTap:t?{}:{scale:.95},onClick:()=>!t&&e(s.value),disabled:t,className:`
                                px-3 py-2 rounded-lg border-2 font-medium text-sm
                                transition-all
                                ${i?"border-black bg-nanobanana-blue text-white shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]":"border-gray-200 bg-white hover:border-gray-400"}
                                ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                            `,children:s.label},s.value)})})]}),Ir=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),vM=[.001,0,0,.001,0,0],pR=1.35,ro={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ap={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},_N="pdfjs_internal_editor_",rt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},jt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},dce={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},wM={TRIANGLES:1,LATTICE:2},Ai={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},cT={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Un={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},vy={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},KL={ERRORS:0,WARNINGS:1,INFOS:5},PN={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},vS={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},hce={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let QL=KL.WARNINGS;function uce(n){Number.isInteger(n)&&(QL=n)}function pce(){return QL}function JL(n){QL>=KL.INFOS&&console.info(`Info: ${n}`)}function tt(n){QL>=KL.WARNINGS&&console.warn(`Warning: ${n}`)}function Cs(n){throw new Error(n)}function At(n,e){n||Cs(e)}function fce(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function qW(n,e=null,t=null){if(!n)return null;if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=bce(n)}catch{}}const s=e?URL.parse(n,e):URL.parse(n);return fce(s)?s:null}function YW(n,e,t=!1){const s=URL.parse(n);return s?(s.hash=e,s.href):t&&qW(n,"http://example.com")?n.split("#",1)[0]+`${e?`#${e}`:""}`:""}function ot(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const iy=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();let hU=class extends iy{constructor(e,t){super(e,"PasswordException"),this.code=t}},fR=class extends iy{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},SM=class extends iy{constructor(e){super(e,"InvalidPDFException")}},gP=class extends iy{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}},mce=class extends iy{constructor(e){super(e,"FormatError")}},pm=class extends iy{constructor(e){super(e,"AbortException")}};function XW(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Cs("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function NE(n){typeof n!="string"&&Cs("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function gce(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function xce(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function yce(){try{return new Function(""),!0}catch{return!1}}let Yi=class{static get isLittleEndian(){return ot(this,"isLittleEndian",xce())}static get isEvalSupported(){return ot(this,"isEvalSupported",yce())}static get isOffscreenCanvasSupported(){return ot(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ot(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return ot(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return ot(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return ot(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return ot(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}};const mR=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Nu,GR,dT,CM;let _e=(GR=class{static makeHexColor(e,t,s){return`#${mR[e]}${mR[t]}${mR[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const i=e[s],r=e[s+1];e[s]=i*t[0]+r*t[2]+t[4],e[s+1]=i*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],r=t[1],o=t[2],c=t[3],d=t[4],h=t[5];for(let u=0;u<6;u+=2){const p=e[s+u],f=e[s+u+1];e[s+u]=p*i+f*o+d,e[s+u+1]=p*r+f*c+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,s){const i=t[0],r=t[1],o=t[2],c=t[3],d=t[4],h=t[5],u=e[0],p=e[1],f=e[2],m=e[3];let x=i*u+d,g=x,b=i*f+d,y=b,C=c*p+h,w=C,S=c*m+h,j=S;if(r!==0||o!==0){const T=r*u,k=r*f,_=o*p,L=o*m;x+=_,y+=_,b+=L,g+=L,C+=T,j+=T,S+=k,w+=k}s[0]=Math.min(s[0],x,b,g,y),s[1]=Math.min(s[1],C,S,w,j),s[2]=Math.max(s[2],x,b,g,y),s[3]=Math.max(s[3],C,S,w,j)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],r=e[2],o=e[3],c=s**2+i**2,d=s*r+i*o,h=r**2+o**2,u=(c+h)/2,p=Math.sqrt(u**2-(c*h-d**2));t[0]=Math.sqrt(u+p||1),t[1]=Math.sqrt(u-p||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[s,r,i,o]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,r){r[0]=Math.min(r[0],e,s),r[1]=Math.min(r[1],t,i),r[2]=Math.max(r[2],e,s),r[3]=Math.max(r[3],t,i)}static bezierBoundingBox(e,t,s,i,r,o,c,d,h){h[0]=Math.min(h[0],e,c),h[1]=Math.min(h[1],t,d),h[2]=Math.max(h[2],e,c),h[3]=Math.max(h[3],t,d),E(this,Nu,CM).call(this,e,s,r,c,t,i,o,d,3*(-e+3*(s-r)+c),6*(e-2*s+r),3*(s-e),h),E(this,Nu,CM).call(this,e,s,r,c,t,i,o,d,3*(-t+3*(i-o)+d),6*(t-2*i+o),3*(i-t),h)}},Nu=new WeakSet,dT=function(e,t,s,i,r,o,c,d,h,u){if(h<=0||h>=1)return;const p=1-h,f=h*h,m=f*h,x=p*(p*(p*e+3*h*t)+3*f*s)+m*i,g=p*(p*(p*r+3*h*o)+3*f*c)+m*d;u[0]=Math.min(u[0],x),u[1]=Math.min(u[1],g),u[2]=Math.max(u[2],x),u[3]=Math.max(u[3],g)},CM=function(e,t,s,i,r,o,c,d,h,u,p,f){if(Math.abs(h)<1e-12){Math.abs(u)>=1e-12&&E(this,Nu,dT).call(this,e,t,s,i,r,o,c,d,-p/u,f);return}const m=u**2-4*p*h;if(m<0)return;const x=Math.sqrt(m),g=2*h;E(this,Nu,dT).call(this,e,t,s,i,r,o,c,d,(-u+x)/g,f),E(this,Nu,dT).call(this,e,t,s,i,r,o,c,d,(-u-x)/g,f)},A(GR,Nu),GR);function bce(n){return decodeURIComponent(escape(n))}let gR=null,uU=null;function vce(n){return gR||(gR=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,uU=new Map([["","t"]])),n.replaceAll(gR,(e,t,s)=>t?t.normalize("NFKC"):uU.get(s))}function KW(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),XW(n)}const eb="pdfjs_internal_id_";function wce(n,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...r]=t;if(!n(s)&&!Number.isInteger(s)||!e(i))return!1;const o=r.length;let c=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;c=!1;break;default:return!1}for(const d of r)if(!(typeof d=="number"||c&&d===null))return!1;return!0}function Mr(n,e,t){return Math.min(Math.max(n,e),t)}function QW(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(XW(n))}function Sce(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):NE(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((e,t)=>e+t,0)});let NM=class JW{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var d;if(!r)return;let o=null;const c=r.name;if(c==="#text")o=r.value;else if(JW.shouldBuildText(c))(d=r==null?void 0:r.attributes)!=null&&d.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const h of r.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},ZW=class{static setupStorage(e,t,s,i,r){const o=i.getValue(t,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",c=>{i.setValue(t,{value:c.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?e.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",c=>{i.setValue(t,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",c=>{i.setValue(t,{value:c.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const c of s.children)c.attributes.value===o.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}e.addEventListener("input",c=>{const d=c.target.options,h=d.selectedIndex===-1?"":d[d.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:o}=t,c=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[d,h]of Object.entries(o))if(h!=null)switch(d){case"class":h.length&&e.setAttribute(d,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!c||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,h)}c&&r.addLinkAttributes(e,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(e,o.dataId,t,s)}static render(e){var p,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const c=r!=="richText",d=e.div;if(d.append(o),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=m}c&&d.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const m=document.createTextNode(i.value);o.append(m),c&&NM.shouldBuildText(i.name)&&h.push(m)}return{textDivs:h}}const u=[[i,-1,o]];for(;u.length>0;){const[m,x,g]=u.at(-1);if(x+1===m.children.length){u.pop();continue}const b=m.children[++u.at(-1)[1]];if(b===null)continue;const{name:y}=b;if(y==="#text"){const w=document.createTextNode(b.value);h.push(w),g.append(w);continue}const C=(p=b==null?void 0:b.attributes)!=null&&p.xmlns?document.createElementNS(b.attributes.xmlns,y):document.createElement(y);if(g.append(C),b.attributes&&this.setAttributes({html:C,element:b,storage:t,intent:r,linkService:s}),((f=b.children)==null?void 0:f.length)>0)u.push([b,-1,C]);else if(b.value){const w=document.createTextNode(b.value);c&&NM.shouldBuildText(y)&&h.push(w),C.append(w)}}for(const m of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}};const zd="http://www.w3.org/2000/svg";var gd;let M1=(gd=class{},W(gd,"CSS",96),W(gd,"PDF",72),W(gd,"PDF_TO_CSS_UNITS",gd.CSS/gd.PDF),gd);async function jE(n,e="text"){if(GS(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}let h3=class e9{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:c=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=o,s*=t;const d=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let u,p,f,m;switch(i%=360,i<0&&(i+=360),i){case 180:u=-1,p=0,f=0,m=1;break;case 90:u=0,p=1,f=1,m=0;break;case 270:u=0,p=-1,f=-1,m=0;break;case 0:u=1,p=0,f=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(f=-f,m=-m);let x,g,b,y;u===0?(x=Math.abs(h-e[1])*s+r,g=Math.abs(d-e[0])*s+o,b=(e[3]-e[1])*s,y=(e[2]-e[0])*s):(x=Math.abs(d-e[0])*s+r,g=Math.abs(h-e[1])*s+o,b=(e[2]-e[0])*s,y=(e[3]-e[1])*s),this.transform=[u*s,p*s,f*s,m*s,x-u*s*d-f*s*h,g-p*s*d-m*s*h],this.width=b,this.height=y}get rawDims(){const e=this.viewBox;return ot(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new e9({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){const s=[e,t];return _e.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];_e.applyTransform(t,this.transform);const s=[e[2],e[3]];return _e.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return _e.applyInverseTransform(s,this.transform),s}},u3=class extends iy{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function ZL(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function p3(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function Cce(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function Nce(n,e="document.pdf"){if(typeof n!="string")return e;if(ZL(n))return tt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(c=>{try{return new URL(c)}catch{try{return new URL(decodeURIComponent(c))}catch{try{return new URL(c,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(c),"https://foo.bar")}catch{return null}}}}})(n);if(!s)return e;const i=c=>{try{let d=decodeURIComponent(c);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:c):d}catch{return c}},r=/\.pdf$/i,o=s.pathname.split("/").at(-1);if(r.test(o))return i(o);if(s.searchParams.size>0){const c=Array.from(s.searchParams.values()).reverse();for(const h of c)if(r.test(h))return i(h);const d=Array.from(s.searchParams.keys()).reverse();for(const h of d)if(r.test(h))return i(h)}if(s.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(d)return i(d[0])}return e}let pU=class{constructor(){W(this,"started",Object.create(null));W(this,"times",[])}time(e){e in this.started&&tt(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||tt(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}};function GS(n,e){const t=e?URL.parse(n,e):URL.parse(n);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function xl(n){n.preventDefault()}function Sn(n){n.preventDefault(),n.stopPropagation()}function jce(n){console.log("Deprecated API usage: "+n)}var WR,UN;let jM=(WR=class{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;l(this,UN)||v(this,UN,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=l(this,UN).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let c=parseInt(t[5],10);c=c>=0&&c<=59?c:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const h=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let p=parseInt(t[9],10)||0;return p=p>=0&&p<=59?p:0,h==="-"?(o+=u,c+=p):h==="+"&&(o-=u,c-=p),new Date(Date.UTC(s,i,r,o,c,d))}},UN=new WeakMap,A(WR,UN),WR);function Ace(n,{scale:e=1,rotation:t=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new h3({viewBox:r,userUnit:1,scale:e,rotation:t})}function AE(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(tt(`Not a valid color format: "${n}"`),[0,0,0])}function Ece(n){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,AE(s))}e.remove()}function Qs(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform();return[e,t,s,i,r,o]}function xc(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[e,t,s,i,r,o]}function X0(n,e,t=!1,s=!0){if(e instanceof h3){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=n,c=Yi.isCSSRoundSupported,d=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${r}px`,u=c?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,p=c?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(o.width=u,o.height=p):(o.width=p,o.height=u)}s&&n.setAttribute("data-main-rotation",e.rotation)}let K0=class AM{constructor(){const{pixelRatio:e}=AM;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,r=-1){let o=1/0,c=1/0,d=1/0;s=AM.capPixels(s,r),s>0&&(o=Math.sqrt(s/(e*t))),i!==-1&&(c=i/e,d=i/t);const h=Math.min(o,c,d);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}};const EM=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];let kce=class{static get isDarkMode(){var e;return ot(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}},Tce=class{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),ot(this,"commentForegroundColor",AE(s))}};function _ce(n,e,t,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return n=Math.round(n*s+i),e=Math.round(e*s+i),t=Math.round(t*s+i),[n,e,t]}function fU(n,e){const t=n[0]/255,s=n[1]/255,i=n[2]/255,r=Math.max(t,s,i),o=Math.min(t,s,i),c=(r+o)/2;if(r===o)e[0]=e[1]=0;else{const d=r-o;switch(e[1]=c<.5?d/(r+o):d/(2-r-o),r){case t:e[0]=((s-i)/d+(s<i?6:0))*60;break;case s:e[0]=((i-t)/d+2)*60;break;case i:e[0]=((t-s)/d+4)*60;break}}e[2]=c}function kM(n,e){const t=n[0],s=n[1],i=n[2],r=(1-Math.abs(2*i-1))*s,o=r*(1-Math.abs(t/60%2-1)),c=i-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+c,e[1]=o+c,e[2]=c;break;case 1:e[0]=o+c,e[1]=r+c,e[2]=c;break;case 2:e[0]=c,e[1]=r+c,e[2]=o+c;break;case 3:e[0]=c,e[1]=o+c,e[2]=r+c;break;case 4:e[0]=o+c,e[1]=c,e[2]=r+c;break;case 5:case 6:e[0]=r+c,e[1]=c,e[2]=o+c;break}}function mU(n){return n<=.03928?n/12.92:((n+.055)/1.055)**2.4}function gU(n,e,t){kM(n,t),t.map(mU);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];kM(e,t),t.map(mU);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const xU=new Map;function Pce(n,e){const t=n[0]+n[1]*256+n[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=xU.get(t);if(s)return s;const i=new Float32Array(9),r=i.subarray(0,3),o=i.subarray(3,6);fU(n,o);const c=i.subarray(6,9);fU(e,c);const d=c[2]<.5,h=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),gU(o,c,r)<h){let u,p;d?(u=o[2],p=1):(u=0,p=o[2]);const f=.005;for(;p-u>f;){const m=o[2]=(u+p)/2;d===gU(o,c,r)<h?u=m:p=m}o[2]=d?p:u}return kM(o,r),s=_e.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),xU.set(t,s),s}function t9({html:n,dir:e,className:t},s){const i=document.createDocumentFragment();if(typeof n=="string"){const r=document.createElement("p");r.dir=e||"auto";const o=n.split(/(?:\r\n?|\n)/);for(let c=0,d=o.length;c<d;++c){const h=o[c];r.append(document.createTextNode(h)),c<d-1&&r.append(document.createElement("br"))}i.append(r)}else ZW.render({xfaHtml:n,div:i,intent:"richText"});i.firstChild.classList.add("richText",t),s.append(i)}function s9(n){const e=new Path2D;if(!n)return e;for(let t=0,s=n.length;t<s;)switch(n[t++]){case vS.moveTo:e.moveTo(n[t++],n[t++]);break;case vS.lineTo:e.lineTo(n[t++],n[t++]);break;case vS.curveTo:e.bezierCurveTo(n[t++],n[t++],n[t++],n[t++],n[t++],n[t++]);break;case vS.quadraticCurveTo:e.quadraticCurveTo(n[t++],n[t++],n[t++],n[t++]);break;case vS.closePath:e.closePath();break;default:tt(`Unrecognized drawing path operator: ${n[t-1]}`);break}return e}var lp,cp,Ro,Io,zN,dp,xb,yb,ll,HN,PP,n9,Gi,i9,r9,wy,WS;let Lce=(ll=class{constructor(e){A(this,Gi);A(this,lp,null);A(this,cp,null);A(this,Ro);A(this,Io,null);A(this,zN,null);A(this,dp,null);A(this,xb,null);A(this,yb,null);v(this,Ro,e),l(ll,HN)||v(ll,HN,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=v(this,lp,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=l(this,Ro)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",xl,{signal:t}),e.addEventListener("pointerdown",E(ll,PP,n9),{signal:t}));const s=v(this,Io,document.createElement("div"));s.className="buttons",e.append(s);const i=l(this,Ro).toolbarPosition;if(i){const{style:r}=e,o=l(this,Ro)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return l(this,lp)}hide(){var e;l(this,lp).classList.add("hidden"),(e=l(this,cp))==null||e.hideDropdown()}show(){var e,t;l(this,lp).classList.remove("hidden"),(e=l(this,zN))==null||e.shown(),(t=l(this,dp))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=l(this,Ro),s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",l(ll,HN)[e]),E(this,Gi,wy).call(this,s)&&s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),l(this,Io).append(s)}async addAltText(e){const t=await e.render();E(this,Gi,wy).call(this,t),l(this,Io).append(t,l(this,Gi,WS)),v(this,zN,e)}addComment(e,t=null){if(l(this,dp))return;const s=e.renderForToolbar();if(!s)return;E(this,Gi,wy).call(this,s);const i=v(this,xb,l(this,Gi,WS));t?(l(this,Io).insertBefore(s,t),l(this,Io).insertBefore(i,t)):l(this,Io).append(s,i),v(this,dp,e),e.toolbar=this}addColorPicker(e){if(l(this,cp))return;v(this,cp,e);const t=e.renderButton();E(this,Gi,wy).call(this,t),l(this,Io).append(t,l(this,Gi,WS))}async addEditSignatureButton(e){const t=v(this,yb,await e.renderEditButton(l(this,Ro)));E(this,Gi,wy).call(this,t),l(this,Io).append(t,l(this,Gi,WS))}removeButton(e){var t,s;switch(e){case"comment":(t=l(this,dp))==null||t.removeToolbarCommentButton(),v(this,dp,null),(s=l(this,xb))==null||s.remove(),v(this,xb,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,s){if(!t&&e==="comment")return;const i=l(this,Io).querySelector(s);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){l(this,yb)&&(l(this,yb).title=e)}remove(){var e;l(this,lp).remove(),(e=l(this,cp))==null||e.destroy(),v(this,cp,null)}},lp=new WeakMap,cp=new WeakMap,Ro=new WeakMap,Io=new WeakMap,zN=new WeakMap,dp=new WeakMap,xb=new WeakMap,yb=new WeakMap,HN=new WeakMap,PP=new WeakSet,n9=function(e){e.stopPropagation()},Gi=new WeakSet,i9=function(e){l(this,Ro)._focusEventsAllowed=!1,Sn(e)},r9=function(e){l(this,Ro)._focusEventsAllowed=!0,Sn(e)},wy=function(e){const t=l(this,Ro)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",E(this,Gi,i9).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",E(this,Gi,r9).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",xl,{signal:t}),!0)},WS=function(){const e=document.createElement("div");return e.className="divider",e},A(ll,PP),A(ll,HN,null),ll);var VN,ng,Zd,Ou,a9,o9,TM,s8;let Dce=(s8=class{constructor(e){A(this,Ou);A(this,VN,null);A(this,ng,null);A(this,Zd);v(this,Zd,e)}show(e,t,s){const[i,r]=E(this,Ou,o9).call(this,t,s),{style:o}=l(this,ng)||v(this,ng,E(this,Ou,a9).call(this));e.append(l(this,ng)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,ng).remove()}},VN=new WeakMap,ng=new WeakMap,Zd=new WeakMap,Ou=new WeakSet,a9=function(){const e=v(this,ng,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=l(this,Zd)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",xl,{signal:t});const s=v(this,VN,document.createElement("div"));return s.className="buttons",e.append(s),l(this,Zd).hasCommentManager()&&E(this,Ou,TM).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{l(this,Zd).commentSelection("floating_button")}),E(this,Ou,TM).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{l(this,Zd).highlightSelection("floating_button")}),e},o9=function(e,t){let s=0,i=0;for(const r of e){const o=r.y+r.height;if(o<s)continue;const c=r.x+(t?r.width:0);if(o>s){i=c,s=o;continue}t?c>i&&(i=c):c<i&&(i=c)}return[t?1-i:i,s]},TM=function(e,t,s,i){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",s);const c=l(this,Zd)._signal;c instanceof AbortSignal&&!c.aborted&&(r.addEventListener("contextmenu",xl,{signal:c}),r.addEventListener("click",i,{signal:c})),l(this,VN).append(r)},s8);function l9(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var ig,rg,bb,ag;const Zt=class Zt{static initializeAndAddPointerId(e){(l(Zt,rg)||v(Zt,rg,new Set)).add(e)}static setPointer(e,t){l(Zt,ig)||v(Zt,ig,t),l(Zt,ag)??v(Zt,ag,e)}static setTimeStamp(e){v(Zt,bb,e)}static isSamePointerId(e){return l(Zt,ig)===e}static isSamePointerIdOrRemove(e){var t;return l(Zt,ig)===e?!0:((t=l(Zt,rg))==null||t.delete(e),!1)}static isSamePointerType(e){return l(Zt,ag)===e}static isInitializedAndDifferentPointerType(e){return l(Zt,ag)!==null&&!Zt.isSamePointerType(e)}static isSameTimeStamp(e){return l(Zt,bb)===e}static isUsingMultiplePointers(){var e;return((e=l(Zt,rg))==null?void 0:e.size)>=1}static clearPointerType(){v(Zt,ag,null)}static clearPointerIds(){v(Zt,ig,NaN),v(Zt,rg,null)}static clearTimeStamp(){v(Zt,bb,NaN)}};ig=new WeakMap,rg=new WeakMap,bb=new WeakMap,ag=new WeakMap,A(Zt,ig,NaN),A(Zt,rg,null),A(Zt,bb,NaN),A(Zt,ag,null);let nr=Zt;var LP,n8;let Rce=(n8=class{constructor(){A(this,LP,0)}get id(){return`${_N}${vt(this,LP)._++}`}},LP=new WeakMap,n8);var vb,GN,ir,wb,hT,Sb;let Ice=(Sb=class{constructor(){A(this,wb);A(this,vb,KW());A(this,GN,0);A(this,ir,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return ot(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return E(this,wb,hT).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return E(this,wb,hT).call(this,e,e)}async getFromBlob(e,t){const s=await t;return E(this,wb,hT).call(this,e,s)}async getFromId(e){l(this,ir)||v(this,ir,new Map);const t=l(this,ir).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){l(this,ir)||v(this,ir,new Map);let s=l(this,ir).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${l(this,vb)}_${vt(this,GN)._++}`,refCounter:1,isSvg:!1},l(this,ir).set(e,s),l(this,ir).set(s.id,s),s}getSvgUrl(e){const t=l(this,ir).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;l(this,ir)||v(this,ir,new Map);const t=l(this,ir).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${l(this,vb)}_`)}},vb=new WeakMap,GN=new WeakMap,ir=new WeakMap,wb=new WeakSet,hT=async function(e,t){l(this,ir)||v(this,ir,new Map);let s=l(this,ir).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${l(this,vb)}_${vt(this,GN)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await jE(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=Sb._isSVGFittingCanvas,o=new FileReader,c=new Image,d=new Promise((h,u)=>{c.onload=()=>{s.bitmap=c,s.isSvg=!0,h()},o.onload=async()=>{const p=s.svgUrl=o.result;c.src=await r?`${p}#svgView(preserveAspectRatio(none))`:p},c.onerror=o.onerror=u});o.readAsDataURL(i),await d}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){tt(i),s=null}return l(this,ir).set(e,s),s&&l(this,ir).set(s.id,s),s},Sb);var An,hp,WN,Xs,i8;let Mce=(i8=class{constructor(e=128){A(this,An,[]);A(this,hp,!1);A(this,WN);A(this,Xs,-1);v(this,WN,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:c=!1}){if(i&&e(),l(this,hp))return;const d={cmd:e,undo:t,post:s,type:r};if(l(this,Xs)===-1){l(this,An).length>0&&(l(this,An).length=0),v(this,Xs,0),l(this,An).push(d);return}if(o&&l(this,An)[l(this,Xs)].type===r){c&&(d.undo=l(this,An)[l(this,Xs)].undo),l(this,An)[l(this,Xs)]=d;return}const h=l(this,Xs)+1;h===l(this,WN)?l(this,An).splice(0,1):(v(this,Xs,h),h<l(this,An).length&&l(this,An).splice(h)),l(this,An).push(d)}undo(){if(l(this,Xs)===-1)return;v(this,hp,!0);const{undo:e,post:t}=l(this,An)[l(this,Xs)];e(),t==null||t(),v(this,hp,!1),v(this,Xs,l(this,Xs)-1)}redo(){if(l(this,Xs)<l(this,An).length-1){v(this,Xs,l(this,Xs)+1),v(this,hp,!0);const{cmd:e,post:t}=l(this,An)[l(this,Xs)];e(),t==null||t(),v(this,hp,!1)}}hasSomethingToUndo(){return l(this,Xs)!==-1}hasSomethingToRedo(){return l(this,Xs)<l(this,An).length-1}cleanType(e){if(l(this,Xs)!==-1){for(let t=l(this,Xs);t>=0;t--)if(l(this,An)[t].type!==e){l(this,An).splice(t+1,l(this,Xs)-t),v(this,Xs,t);return}l(this,An).length=0,v(this,Xs,-1)}}destroy(){v(this,An,null)}},An=new WeakMap,hp=new WeakMap,WN=new WeakMap,Xs=new WeakMap,i8);var DP,c9,r8;let EE=(r8=class{constructor(e){A(this,DP);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Yi.platform;for(const[s,i,r={}]of e)for(const o of s){const c=o.startsWith("mac+");t&&c?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!c&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(E(this,DP,c9).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:c=null}}=s;c&&!c(e,t)||(i.bind(e,...o,t)(),r||Sn(t))}},DP=new WeakSet,c9=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t},r8);var og;let Fce=(og=class{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Ece(e),ot(this,"_colors",e)}convert(e){const t=AE(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,o)=>r===t[o]))return og._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?_e.makeHexColor(...t):e}},W(og,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),og);var Cb,Na,Nb,ln,Xn,jb,Mo,Ab,Fo,rr,up,pp,Eb,fp,jc,Oo,lg,qN,YN,kb,XN,Ac,mp,Tb,gp,Ec,RP,xp,_b,KN,yp,cg,Pb,bp,QN,zn,Gt,eh,vp,wp,JN,Lb,ZN,Sp,kc,th,ej,tj,Bo,fu,ge,uT,_M,d9,h9,qS,u9,p9,f9,PM,m9,g9,x9,y9,jr,Hd,b9,v9,LM,w9,YS,DM;let LN=(fu=class{constructor(e,t,s,i,r,o,c,d,h,u,p,f,m,x,g,b){A(this,ge);A(this,Cb,new AbortController);A(this,Na,null);A(this,Nb,null);A(this,ln,new Map);A(this,Xn,new Map);A(this,jb,null);A(this,Mo,null);A(this,Ab,null);A(this,Fo,new Mce);A(this,rr,null);A(this,up,null);A(this,pp,null);A(this,Eb,0);A(this,fp,new Set);A(this,jc,null);A(this,Oo,null);A(this,lg,new Set);W(this,"_editorUndoBar",null);A(this,qN,!1);A(this,YN,!1);A(this,kb,!1);A(this,XN,null);A(this,Ac,null);A(this,mp,null);A(this,Tb,null);A(this,gp,!1);A(this,Ec,null);A(this,RP,new Rce);A(this,xp,!1);A(this,_b,!1);A(this,KN,!1);A(this,yp,null);A(this,cg,null);A(this,Pb,null);A(this,bp,null);A(this,QN,null);A(this,zn,rt.NONE);A(this,Gt,new Set);A(this,eh,null);A(this,vp,null);A(this,wp,null);A(this,JN,null);A(this,Lb,null);A(this,ZN,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});A(this,Sp,[0,0]);A(this,kc,null);A(this,th,null);A(this,ej,null);A(this,tj,null);A(this,Bo,null);const y=this._signal=l(this,Cb).signal;v(this,th,e),v(this,ej,t),v(this,tj,s),v(this,jb,i),v(this,rr,r),v(this,vp,o),v(this,Lb,d),this._eventBus=c,c._on("editingaction",this.onEditingAction.bind(this),{signal:y}),c._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),c._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),c._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),c._on("setpreference",this.onSetPreference.bind(this),{signal:y}),c._on("switchannotationeditorparams",C=>this.updateParams(C.type,C.value),{signal:y}),window.addEventListener("pointerdown",()=>{v(this,_b,!0)},{capture:!0,signal:y}),window.addEventListener("pointerup",()=>{v(this,_b,!1)},{capture:!0,signal:y}),E(this,ge,u9).call(this),E(this,ge,y9).call(this),E(this,ge,PM).call(this),v(this,Mo,d.annotationStorage),v(this,XN,d.filterFactory),v(this,wp,h),v(this,Tb,u||null),v(this,qN,p),v(this,YN,f),v(this,kb,m),v(this,QN,x||null),this.viewParameters={realScale:M1.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=b!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=fu.prototype,t=o=>l(o,th).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:c})=>{if(c instanceof HTMLInputElement){const{type:d}=c;return d!=="text"&&d!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ot(this,"_keyboardManager",new EE([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&l(o,th).contains(c)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&l(o,th).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r,o,c,d,h;(e=l(this,Bo))==null||e.resolve(),v(this,Bo,null),(t=l(this,Cb))==null||t.abort(),v(this,Cb,null),this._signal=null;for(const u of l(this,Xn).values())u.destroy();l(this,Xn).clear(),l(this,ln).clear(),l(this,lg).clear(),(s=l(this,bp))==null||s.clear(),v(this,Na,null),l(this,Gt).clear(),l(this,Fo).destroy(),(i=l(this,jb))==null||i.destroy(),(r=l(this,rr))==null||r.destroy(),(o=l(this,vp))==null||o.destroy(),(c=l(this,Ec))==null||c.hide(),v(this,Ec,null),(d=l(this,Pb))==null||d.destroy(),v(this,Pb,null),v(this,Nb,null),l(this,Ac)&&(clearTimeout(l(this,Ac)),v(this,Ac,null)),l(this,kc)&&(clearTimeout(l(this,kc)),v(this,kc,null)),(h=this._editorUndoBar)==null||h.destroy(),v(this,Lb,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return l(this,QN)}get useNewAltTextFlow(){return l(this,YN)}get useNewAltTextWhenAddingImage(){return l(this,kb)}get hcmFilter(){return ot(this,"hcmFilter",l(this,wp)?l(this,XN).addHCMFilter(l(this,wp).foreground,l(this,wp).background):"none")}get direction(){return ot(this,"direction",getComputedStyle(l(this,th)).direction)}get _highlightColors(){return ot(this,"_highlightColors",l(this,Tb)?new Map(l(this,Tb).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return ot(this,"highlightColors",null);const t=new Map,s=!!l(this,wp);for(const[i,r]of e){const o=i.endsWith("_HCM");if(s&&o){t.set(i.replace("_HCM",""),r);continue}!s&&!o&&t.set(i,r)}return ot(this,"highlightColors",t)}get highlightColorNames(){return ot(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),v(this,pp,e)}setMainHighlightColorPicker(e){v(this,Pb,e)}editAltText(e,t=!1){var s;(s=l(this,jb))==null||s.editAltText(this,e,t)}hasCommentManager(){return!!l(this,rr)}editComment(e,t,s,i){var r;(r=l(this,rr))==null||r.showDialog(this,e,t,s,i)}selectComment(e,t){const s=l(this,Xn).get(e),i=s==null?void 0:s.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=l(this,rr))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=l(this,rr))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=l(this,rr))==null||t.removeComments([e.uid])}toggleComment(e,t,s=void 0){var i;(i=l(this,rr))==null||i.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){var s;return e&&((s=l(this,rr))==null?void 0:s.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=l(this,rr))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(l(this,Xn).has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),i=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await s}getSignature(e){var t;(t=l(this,vp))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return l(this,vp)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":v(this,kb,t);break}}onPageChanging({pageNumber:e}){v(this,Eb,e-1)}focusMainContainer(){l(this,th).focus()}findParent(e,t){for(const s of l(this,Xn).values()){const{x:i,y:r,width:o,height:c}=s.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+c)return s}return null}disableUserSelect(e=!1){l(this,ej).classList.toggle("noUserSelect",e)}addShouldRescale(e){l(this,lg).add(e)}removeShouldRescale(e){l(this,lg).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*M1.PDF_TO_CSS_UNITS;for(const s of l(this,lg))s.onScaleChanging();(t=l(this,pp))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:c}=s,d=s.toString(),u=E(this,ge,uT).call(this,s).closest(".textLayer"),p=this.getSelectionBoxes(u);if(!p)return;s.empty();const f=E(this,ge,_M).call(this,u),m=l(this,zn)===rt.NONE,x=()=>{const g=f==null?void 0:f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:p,anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:c,text:d});m&&this.showAllEditors("highlight",!0,!0),t&&(g==null||g.editComment())};if(m){this.switchToMode(rt.HIGHLIGHT,x);return}x()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!l(this,Mo))return null;const t=`${_N}${e}`,s=l(this,Mo).getRawValue(t);return s&&l(this,Mo).remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&l(this,Mo)&&!l(this,Mo).has(e.id)&&l(this,Mo).setValue(e.id,e)}a11yAlert(e,t=null){const s=l(this,tj);s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,l(this,gp)&&(v(this,gp,!1),E(this,ge,qS).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of l(this,Gt))if(t.div.contains(e)){v(this,cg,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!l(this,cg))return;const[e,t]=l(this,cg);v(this,cg,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){E(this,ge,PM).call(this),this.setEditingState(!0)}removeEditListeners(){E(this,ge,m9).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of l(this,Oo))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of l(this,Oo))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=l(this,Na))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of l(this,Gt)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of l(this,Oo))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){tt(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const d of s){const h=await i.deserialize(d);if(!h)return;r.push(h)}const o=()=>{for(const d of r)E(this,ge,LM).call(this,d);E(this,ge,DM).call(this,r)},c=()=>{for(const d of r)d.remove()};this.addCommands({cmd:o,undo:c,mustExec:!0})}catch(r){tt(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,zn)!==rt.NONE&&!this.isEditorHandlingKeyboard&&fu._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,gp)&&(v(this,gp,!1),E(this,ge,qS).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(E(this,ge,p9).call(this),E(this,ge,g9).call(this),E(this,ge,jr).call(this,{isEditing:l(this,zn)!==rt.NONE,isEmpty:E(this,ge,YS).call(this),hasSomethingToUndo:l(this,Fo).hasSomethingToUndo(),hasSomethingToRedo:l(this,Fo).hasSomethingToRedo(),hasSelectedEditor:!1})):(E(this,ge,f9).call(this),E(this,ge,x9).call(this),E(this,ge,jr).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!l(this,Oo)){v(this,Oo,e);for(const t of l(this,Oo))E(this,ge,Hd).call(this,t.defaultPropertiesToUpdate)}}getId(){return l(this,RP).id}get currentLayer(){return l(this,Xn).get(l(this,Eb))}getLayer(e){return l(this,Xn).get(e)}get currentPageIndex(){return l(this,Eb)}addLayer(e){l(this,Xn).set(e.pageIndex,e),l(this,xp)?e.enable():e.disable()}removeLayer(e){l(this,Xn).delete(e.pageIndex)}async updateMode(e,t=null,s=!1,i=!1,r=!1){var o,c,d,h,u,p;if(l(this,zn)!==e&&!(l(this,Bo)&&(await l(this,Bo).promise,!l(this,Bo)))){if(v(this,Bo,Promise.withResolvers()),(o=l(this,pp))==null||o.commitOrRemove(),l(this,zn)===rt.POPUP&&((c=l(this,rr))==null||c.hideSidebar()),(d=l(this,rr))==null||d.destroyPopup(),v(this,zn,e),e===rt.NONE){this.setEditingState(!1),E(this,ge,v9).call(this);for(const f of l(this,ln).values())f.hideStandaloneCommentButton();(h=this._editorUndoBar)==null||h.hide(),this.toggleComment(null),l(this,Bo).resolve();return}for(const f of l(this,ln).values())f.addStandaloneCommentButton();e===rt.SIGNATURE&&await((u=l(this,vp))==null?void 0:u.loadSignatures()),this.setEditingState(!0),await E(this,ge,b9).call(this),this.unselectAll();for(const f of l(this,Xn).values())f.updateMode(e);if(e===rt.POPUP){l(this,Nb)||v(this,Nb,await l(this,Lb).getAnnotationsByType(new Set(l(this,Oo).map(x=>x._editorType))));const f=new Set,m=[];for(const x of l(this,ln).values()){const{annotationElementId:g,hasComment:b,deleted:y}=x;g&&f.add(g),b&&!y&&m.push(x.getData())}for(const x of l(this,Nb)){const{id:g,popupRef:b,contentsObj:y}=x;b&&(y!=null&&y.str)&&!f.has(g)&&!l(this,fp).has(g)&&m.push(x)}(p=l(this,rr))==null||p.showSidebar(m)}if(!t){s&&this.addNewEditorFromKeyboard(),l(this,Bo).resolve();return}for(const f of l(this,ln).values())f.uid===t?(this.setSelected(f),r?f.editComment():i?f.enterInEditMode():f.focus()):f.unselect();l(this,Bo).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==l(this,zn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(l(this,Oo)){switch(e){case jt.CREATE:this.currentLayer.addNewEditor(t);return;case jt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,JN)||v(this,JN,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of l(this,Gt))s.updateParams(e,t);else for(const s of l(this,Oo))s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const o of l(this,ln).values())o.editorType===e&&o.show(t);(((r=l(this,JN))==null?void 0:r.get(jt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&E(this,ge,Hd).call(this,[[jt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(l(this,KN)!==e){v(this,KN,e);for(const t of l(this,Xn).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of l(this,ln).values())t.pageIndex===e&&(yield t)}getEditor(e){return l(this,ln).get(e)}addEditor(e){l(this,ln).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(l(this,Ac)&&clearTimeout(l(this,Ac)),v(this,Ac,setTimeout(()=>{this.focusMainContainer(),v(this,Ac,null)},0))),l(this,ln).delete(e.id),e.annotationElementId&&((t=l(this,bp))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!l(this,fp).has(e.annotationElementId))&&((s=l(this,Mo))==null||s.remove(e.id))}addDeletedAnnotationElement(e){l(this,fp).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return l(this,fp).has(e)}removeDeletedAnnotationElement(e){l(this,fp).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){l(this,Na)!==e&&(v(this,Na,e),e&&E(this,ge,Hd).call(this,e.propertiesToUpdate))}updateUI(e){l(this,ge,w9)===e&&E(this,ge,Hd).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){E(this,ge,Hd).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(l(this,Gt).has(e)){l(this,Gt).delete(e),e.unselect(),E(this,ge,jr).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,Gt).add(e),e.select(),E(this,ge,Hd).call(this,e.propertiesToUpdate),E(this,ge,jr).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=l(this,pp))==null||t.commitOrRemove();for(const s of l(this,Gt))s!==e&&s.unselect();l(this,Gt).clear(),l(this,Gt).add(e),e.select(),E(this,ge,Hd).call(this,e.propertiesToUpdate),E(this,ge,jr).call(this,{hasSelectedEditor:!0})}isSelected(e){return l(this,Gt).has(e)}get firstSelectedEditor(){return l(this,Gt).values().next().value}unselect(e){e.unselect(),l(this,Gt).delete(e),E(this,ge,jr).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,Gt).size!==0}get isEnterHandled(){return l(this,Gt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;l(this,Fo).undo(),E(this,ge,jr).call(this,{hasSomethingToUndo:l(this,Fo).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:E(this,ge,YS).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){l(this,Fo).redo(),E(this,ge,jr).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,Fo).hasSomethingToRedo(),isEmpty:E(this,ge,YS).call(this)})}addCommands(e){l(this,Fo).add(e),E(this,ge,jr).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:E(this,ge,YS).call(this)})}cleanUndoStack(e){l(this,Fo).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...l(this,Gt)],s=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const c of t)c.remove()},i=()=>{for(const o of t)E(this,ge,LM).call(this,o)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=l(this,Na))==null||e.commitOrRemove()}hasSomethingToControl(){return l(this,Na)||this.hasSelection}selectAll(){for(const e of l(this,Gt))e.commit();E(this,ge,DM).call(this,l(this,ln).values())}unselectAll(){var e;if(!(l(this,Na)&&(l(this,Na).commitOrRemove(),l(this,zn)!==rt.NONE))&&!((e=l(this,pp))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of l(this,Gt))t.unselect();l(this,Gt).clear(),E(this,ge,jr).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;l(this,Sp)[0]+=e,l(this,Sp)[1]+=t;const[i,r]=l(this,Sp),o=[...l(this,Gt)],c=1e3;l(this,kc)&&clearTimeout(l(this,kc)),v(this,kc,setTimeout(()=>{v(this,kc,null),l(this,Sp)[0]=l(this,Sp)[1]=0,this.addCommands({cmd:()=>{for(const d of o)l(this,ln).has(d.id)&&(d.translateInPage(i,r),d.translationDone())},undo:()=>{for(const d of o)l(this,ln).has(d.id)&&(d.translateInPage(-i,-r),d.translationDone())},mustExec:!1})},c));for(const d of o)d.translateInPage(e,t),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),v(this,jc,new Map);for(const e of l(this,Gt))l(this,jc).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,jc))return!1;this.disableUserSelect(!1);const e=l(this,jc);v(this,jc,null);let t=!1;for(const[{x:i,y:r,pageIndex:o},c]of e)c.newX=i,c.newY=r,c.newPageIndex=o,t||(t=i!==c.savedX||r!==c.savedY||o!==c.savedPageIndex);if(!t)return!1;const s=(i,r,o,c)=>{if(l(this,ln).has(i.id)){const d=l(this,Xn).get(c);d?i._setParentAndPosition(d,r,o):(i.pageIndex=c,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:c}]of e)s(i,r,o,c)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:c}]of e)s(i,r,o,c)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(l(this,jc))for(const s of l(this,jc).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||l(this,Gt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return l(this,Na)===e}getActive(){return l(this,Na)}getMode(){return l(this,zn)}isEditingMode(){return l(this,zn)!==rt.NONE}get imageManager(){return ot(this,"imageManager",new Ice)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,u=t.rangeCount;h<u;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=e.getBoundingClientRect();let c;switch(e.getAttribute("data-main-rotation")){case"90":c=(h,u,p,f)=>({x:(u-i)/o,y:1-(h+p-s)/r,width:f/o,height:p/r});break;case"180":c=(h,u,p,f)=>({x:1-(h+p-s)/r,y:1-(u+f-i)/o,width:p/r,height:f/o});break;case"270":c=(h,u,p,f)=>({x:1-(u+f-i)/o,y:(h-s)/r,width:f/o,height:p/r});break;default:c=(h,u,p,f)=>({x:(h-s)/r,y:(u-i)/o,width:p/r,height:f/o});break}const d=[];for(let h=0,u=t.rangeCount;h<u;h++){const p=t.getRangeAt(h);if(!p.collapsed)for(const{x:f,y:m,width:x,height:g}of p.getClientRects())x===0||g===0||d.push(c(f,m,x,g))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(l(this,Ab)||v(this,Ab,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=l(this,Ab))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=l(this,Ab))==null?void 0:i.get(e.data.id);if(!t)return;const s=l(this,Mo).getRawValue(t);s&&(l(this,zn)===rt.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var r;const i=(r=l(this,bp))==null?void 0:r.get(e);i&&(i.setCanvas(t,s),l(this,bp).delete(e))}addMissingCanvas(e,t){(l(this,bp)||v(this,bp,new Map)).set(e,t)}},Cb=new WeakMap,Na=new WeakMap,Nb=new WeakMap,ln=new WeakMap,Xn=new WeakMap,jb=new WeakMap,Mo=new WeakMap,Ab=new WeakMap,Fo=new WeakMap,rr=new WeakMap,up=new WeakMap,pp=new WeakMap,Eb=new WeakMap,fp=new WeakMap,jc=new WeakMap,Oo=new WeakMap,lg=new WeakMap,qN=new WeakMap,YN=new WeakMap,kb=new WeakMap,XN=new WeakMap,Ac=new WeakMap,mp=new WeakMap,Tb=new WeakMap,gp=new WeakMap,Ec=new WeakMap,RP=new WeakMap,xp=new WeakMap,_b=new WeakMap,KN=new WeakMap,yp=new WeakMap,cg=new WeakMap,Pb=new WeakMap,bp=new WeakMap,QN=new WeakMap,zn=new WeakMap,Gt=new WeakMap,eh=new WeakMap,vp=new WeakMap,wp=new WeakMap,JN=new WeakMap,Lb=new WeakMap,ZN=new WeakMap,Sp=new WeakMap,kc=new WeakMap,th=new WeakMap,ej=new WeakMap,tj=new WeakMap,Bo=new WeakMap,ge=new WeakSet,uT=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},_M=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of l(this,Xn).values())if(s.hasTextLayer(e))return s;return null},d9=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=E(this,ge,uT).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(l(this,Ec)||v(this,Ec,new Dce(this)),l(this,Ec).show(s,i,this.direction==="ltr"))},h9=function(){var r,o,c;const e=document.getSelection();if(!e||e.isCollapsed){l(this,eh)&&((r=l(this,Ec))==null||r.hide(),v(this,eh,null),E(this,ge,jr).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===l(this,eh))return;const i=E(this,ge,uT).call(this,e).closest(".textLayer");if(!i){l(this,eh)&&((o=l(this,Ec))==null||o.hide(),v(this,eh,null),E(this,ge,jr).call(this,{hasSelectedText:!1}));return}if((c=l(this,Ec))==null||c.hide(),v(this,eh,t),E(this,ge,jr).call(this,{hasSelectedText:!0}),!(l(this,zn)!==rt.HIGHLIGHT&&l(this,zn)!==rt.NONE)&&(l(this,zn)===rt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),v(this,gp,this.isShiftKeyDown),!this.isShiftKeyDown)){const d=l(this,zn)===rt.HIGHLIGHT?E(this,ge,_M).call(this,i):null;if(d==null||d.toggleDrawing(),l(this,_b)){const h=new AbortController,u=this.combinedSignal(h),p=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),d==null||d.toggleDrawing(!0),f.type==="pointerup"&&E(this,ge,qS).call(this,"main_toolbar"))};window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("blur",p,{signal:u})}else d==null||d.toggleDrawing(!0),E(this,ge,qS).call(this,"main_toolbar")}},qS=function(e=""){l(this,zn)===rt.HIGHLIGHT?this.highlightSelection(e):l(this,qN)&&E(this,ge,d9).call(this)},u9=function(){document.addEventListener("selectionchange",E(this,ge,h9).bind(this),{signal:this._signal})},p9=function(){if(l(this,mp))return;v(this,mp,new AbortController);const e=this.combinedSignal(l(this,mp));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},f9=function(){var e;(e=l(this,mp))==null||e.abort(),v(this,mp,null)},PM=function(){if(l(this,yp))return;v(this,yp,new AbortController);const e=this.combinedSignal(l(this,yp));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},m9=function(){var e;(e=l(this,yp))==null||e.abort(),v(this,yp,null)},g9=function(){if(l(this,up))return;v(this,up,new AbortController);const e=this.combinedSignal(l(this,up));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},x9=function(){var e;(e=l(this,up))==null||e.abort(),v(this,up,null)},y9=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},jr=function(e){Object.entries(e).some(([s,i])=>l(this,ZN)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,ZN),e)}),l(this,zn)===rt.HIGHLIGHT&&e.hasSelectedEditor===!1&&E(this,ge,Hd).call(this,[[jt.HIGHLIGHT_FREE,!0]]))},Hd=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},b9=async function(){if(!l(this,xp)){v(this,xp,!0);const e=[];for(const t of l(this,Xn).values())e.push(t.enable());await Promise.all(e);for(const t of l(this,ln).values())t.enable()}},v9=function(){if(this.unselectAll(),l(this,xp)){v(this,xp,!1);for(const e of l(this,Xn).values())e.disable();for(const e of l(this,ln).values())e.disable()}},LM=function(e){const t=l(this,Xn).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},w9=function(){let e=null;for(e of l(this,Gt));return e},YS=function(){if(l(this,ln).size===0)return!0;if(l(this,ln).size===1)for(const e of l(this,ln).values())return e.isEmpty();return!1},DM=function(e){for(const t of l(this,Gt))t.unselect();l(this,Gt).clear();for(const t of e)t.isEmpty()||(l(this,Gt).add(t),t.select());E(this,ge,jr).call(this,{hasSelectedEditor:this.hasSelection})},W(fu,"TRANSLATE_SMALL",1),W(fu,"TRANSLATE_BIG",10),fu);var ii,Tc,_l,Db,_c,ja,Rb,Pc,Qr,sh,dg,Lc,yi,Cp,ic,XS,pT;let yU=(yi=class{constructor(e){A(this,ic);A(this,ii,null);A(this,Tc,!1);A(this,_l,null);A(this,Db,null);A(this,_c,null);A(this,ja,null);A(this,Rb,!1);A(this,Pc,null);A(this,Qr,null);A(this,sh,null);A(this,dg,null);A(this,Lc,!1);v(this,Qr,e),v(this,Lc,e._uiManager.useNewAltTextFlow),l(yi,Cp)||v(yi,Cp,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){yi._l10n??(yi._l10n=e)}async render(){const e=v(this,_l,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=v(this,Db,document.createElement("span"));e.append(t),l(this,Lc)?(e.classList.add("new"),e.setAttribute("data-l10n-id",l(yi,Cp).missing),t.setAttribute("data-l10n-id",l(yi,Cp)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=l(this,Qr)._uiManager._signal;e.addEventListener("contextmenu",xl,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),l(this,Qr)._uiManager.editAltText(l(this,Qr)),l(this,Lc)&&l(this,Qr)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,ic,XS)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(v(this,Rb,!0),i(r))},{signal:s}),await E(this,ic,pT).call(this),e}finish(){l(this,_l)&&(l(this,_l).focus({focusVisible:l(this,Rb)}),v(this,Rb,!1))}isEmpty(){return l(this,Lc)?l(this,ii)===null:!l(this,ii)&&!l(this,Tc)}hasData(){return l(this,Lc)?l(this,ii)!==null||!!l(this,sh):this.isEmpty()}get guessedText(){return l(this,sh)}async setGuessedText(e){l(this,ii)===null&&(v(this,sh,e),v(this,dg,await yi._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),E(this,ic,pT).call(this))}toggleAltTextBadge(e=!1){var t;if(!l(this,Lc)||l(this,ii)){(t=l(this,Pc))==null||t.remove(),v(this,Pc,null);return}if(!l(this,Pc)){const s=v(this,Pc,document.createElement("div"));s.className="noAltTextBadge",l(this,Qr).div.append(s)}l(this,Pc).classList.toggle("hidden",!e)}serialize(e){let t=l(this,ii);return!e&&l(this,sh)===t&&(t=l(this,dg)),{altText:t,decorative:l(this,Tc),guessedText:l(this,sh),textWithDisclaimer:l(this,dg)}}get data(){return{altText:l(this,ii),decorative:l(this,Tc)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(v(this,sh,s),v(this,dg,i)),!(l(this,ii)===e&&l(this,Tc)===t)&&(r||(v(this,ii,e),v(this,Tc,t)),E(this,ic,pT).call(this))}toggle(e=!1){l(this,_l)&&(!e&&l(this,ja)&&(clearTimeout(l(this,ja)),v(this,ja,null)),l(this,_l).disabled=!e)}shown(){l(this,Qr)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,ic,XS)}})}destroy(){var e,t;(e=l(this,_l))==null||e.remove(),v(this,_l,null),v(this,Db,null),v(this,_c,null),(t=l(this,Pc))==null||t.remove(),v(this,Pc,null)}},ii=new WeakMap,Tc=new WeakMap,_l=new WeakMap,Db=new WeakMap,_c=new WeakMap,ja=new WeakMap,Rb=new WeakMap,Pc=new WeakMap,Qr=new WeakMap,sh=new WeakMap,dg=new WeakMap,Lc=new WeakMap,Cp=new WeakMap,ic=new WeakSet,XS=function(){return l(this,ii)&&"added"||l(this,ii)===null&&this.guessedText&&"review"||"missing"},pT=async function(){var i,r,o;const e=l(this,_l);if(!e)return;if(l(this,Lc)){if(e.classList.toggle("done",!!l(this,ii)),e.setAttribute("data-l10n-id",l(yi,Cp)[l(this,ic,XS)]),(i=l(this,Db))==null||i.setAttribute("data-l10n-id",l(yi,Cp)[`${l(this,ic,XS)}-label`]),!l(this,ii)){(r=l(this,_c))==null||r.remove();return}}else{if(!l(this,ii)&&!l(this,Tc)){e.classList.remove("done"),(o=l(this,_c))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=l(this,_c);if(!t){v(this,_c,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${l(this,Qr).id}`;const c=100,d=l(this,Qr)._uiManager._signal;d.addEventListener("abort",()=>{clearTimeout(l(this,ja)),v(this,ja,null)},{once:!0}),e.addEventListener("mouseenter",()=>{v(this,ja,setTimeout(()=>{v(this,ja,null),l(this,_c).classList.add("show"),l(this,Qr)._reportTelemetry({action:"alt_text_tooltip"})},c))},{signal:d}),e.addEventListener("mouseleave",()=>{var h;l(this,ja)&&(clearTimeout(l(this,ja)),v(this,ja,null)),(h=l(this,_c))==null||h.classList.remove("show")},{signal:d})}l(this,Tc)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=l(this,ii)),t.parentNode||e.append(t);const s=l(this,Qr).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},A(yi,Cp,null),W(yi,"_l10n",null),yi);var ki,$o,hg,Es,sj,ug,Pl,pg,fg,mg,nj,RM,a8;let wk=(a8=class{constructor(e){A(this,nj);A(this,ki,null);A(this,$o,null);A(this,hg,!1);A(this,Es,null);A(this,sj,null);A(this,ug,null);A(this,Pl,null);A(this,pg,null);A(this,fg,!1);A(this,mg,null);v(this,Es,e)}renderForToolbar(){const e=v(this,$o,document.createElement("button"));return e.className="comment",E(this,nj,RM).call(this,e,!1)}renderForStandalone(){const e=v(this,ki,document.createElement("button"));e.className="annotationCommentButton";const t=l(this,Es).commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(l(this,Es)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=l(this,Es).commentButtonColor;i&&(s.backgroundColor=i)}return E(this,nj,RM).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=l(this,ki)??l(this,$o))==null||e.focus()},0)}onUpdatedColor(){if(!l(this,ki))return;const e=l(this,Es).commentButtonColor;e&&(l(this,ki).style.backgroundColor=e),l(this,Es)._uiManager.updatePopupColor(l(this,Es))}get commentButtonWidth(){var e;return(((e=l(this,ki))==null?void 0:e.getBoundingClientRect().width)??0)/l(this,Es).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(l(this,mg))return l(this,mg);if(!l(this,ki))return null;const{x:e,y:t,height:s}=l(this,ki).getBoundingClientRect(),{x:i,y:r,width:o,height:c}=l(this,Es).parent.boundingClientRect;return[(e-i)/o,(t+s-r)/c]}set commentPopupPositionInLayer(e){v(this,mg,e)}hasDefaultPopupPosition(){return l(this,mg)===null}removeStandaloneCommentButton(){var e;(e=l(this,ki))==null||e.remove(),v(this,ki,null)}removeToolbarCommentButton(){var e;(e=l(this,$o))==null||e.remove(),v(this,$o,null)}setCommentButtonStates({selected:e,hasPopup:t}){l(this,ki)&&(l(this,ki).classList.toggle("selected",e),l(this,ki).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let s,i;if(t)[s,i]=t;else{[s,i]=l(this,Es).commentButtonPosition;const{width:u,height:p,x:f,y:m}=l(this,Es);s=f+s*u,i=m+i*p}const r=l(this,Es).parent.boundingClientRect,{x:o,y:c,width:d,height:h}=r;l(this,Es)._uiManager.editComment(l(this,Es),o+s*d,c+i*h,{...e,parentDimensions:r})}finish(){l(this,$o)&&(l(this,$o).focus({focusVisible:l(this,hg)}),v(this,hg,!1))}isDeleted(){return l(this,fg)||l(this,Pl)===""}isEmpty(){return l(this,Pl)===null}hasBeenEdited(){return this.isDeleted()||l(this,Pl)!==l(this,sj)}serialize(){return this.data}get data(){return{text:l(this,Pl),richText:l(this,ug),date:l(this,pg),deleted:this.isDeleted()}}set data(e){if(e!==l(this,Pl)&&v(this,ug,null),e===null){v(this,Pl,""),v(this,fg,!0);return}v(this,Pl,e),v(this,pg,new Date),v(this,fg,!1)}setInitialText(e,t=null){v(this,sj,e),this.data=e,v(this,pg,null),v(this,ug,t)}shown(){}destroy(){var e,t;(e=l(this,$o))==null||e.remove(),v(this,$o,null),(t=l(this,ki))==null||t.remove(),v(this,ki,null),v(this,Pl,""),v(this,ug,null),v(this,pg,null),v(this,Es,null),v(this,hg,!1),v(this,fg,!1)}},ki=new WeakMap,$o=new WeakMap,hg=new WeakMap,Es=new WeakMap,sj=new WeakMap,ug=new WeakMap,Pl=new WeakMap,pg=new WeakMap,fg=new WeakMap,mg=new WeakMap,nj=new WeakSet,RM=function(e,t){if(!l(this,Es)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[l(this,Es)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=l(this,Es)._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",xl,{signal:s}),t&&(e.addEventListener("focusin",r=>{l(this,Es)._focusEventsAllowed=!1,Sn(r)},{capture:!0,signal:s}),e.addEventListener("focusout",r=>{l(this,Es)._focusEventsAllowed=!0,Sn(r)},{capture:!0,signal:s})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),e===l(this,$o)?this.edit():l(this,Es).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(v(this,hg,!0),i(r))},{signal:s}),e.addEventListener("pointerenter",()=>{l(this,Es).toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{l(this,Es).toggleComment(!1,!1)},{signal:s}),e},a8);var Ib,gg,ij,rj,aj,oj,lj,nh,xg,ih,yg,rh,gm,C9,N9,j9,Mb;let S9=(Mb=class{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:c}){A(this,gm);A(this,Ib);A(this,gg,!1);A(this,ij,null);A(this,rj);A(this,aj);A(this,oj);A(this,lj);A(this,nh,null);A(this,xg);A(this,ih,null);A(this,yg);A(this,rh,null);v(this,Ib,e),v(this,ij,s),v(this,rj,t),v(this,aj,i),v(this,oj,r),v(this,lj,o),v(this,yg,new AbortController),v(this,xg,AbortSignal.any([c,l(this,yg).signal])),e.addEventListener("touchstart",E(this,gm,C9).bind(this),{passive:!1,signal:l(this,xg)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/K0.pixelRatio}destroy(){var e,t;(e=l(this,yg))==null||e.abort(),v(this,yg,null),(t=l(this,nh))==null||t.abort(),v(this,nh,null)}},Ib=new WeakMap,gg=new WeakMap,ij=new WeakMap,rj=new WeakMap,aj=new WeakMap,oj=new WeakMap,lj=new WeakMap,nh=new WeakMap,xg=new WeakMap,ih=new WeakMap,yg=new WeakMap,rh=new WeakMap,gm=new WeakSet,C9=function(e){var i,r,o;if((i=l(this,rj))!=null&&i.call(this))return;if(e.touches.length===1){if(l(this,nh))return;const c=v(this,nh,new AbortController),d=AbortSignal.any([l(this,xg),c.signal]),h=l(this,Ib),u={capture:!0,signal:d,passive:!1},p=f=>{var m;f.pointerType==="touch"&&((m=l(this,nh))==null||m.abort(),v(this,nh,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Sn(f),p(f))},u),h.addEventListener("pointerup",p,u),h.addEventListener("pointercancel",p,u);return}if(!l(this,rh)){v(this,rh,new AbortController);const c=AbortSignal.any([l(this,xg),l(this,rh).signal]),d=l(this,Ib),h={signal:c,capture:!1,passive:!1};d.addEventListener("touchmove",E(this,gm,N9).bind(this),h);const u=E(this,gm,j9).bind(this);d.addEventListener("touchend",u,h),d.addEventListener("touchcancel",u,h),h.capture=!0,d.addEventListener("pointerdown",Sn,h),d.addEventListener("pointermove",Sn,h),d.addEventListener("pointercancel",Sn,h),d.addEventListener("pointerup",Sn,h),(r=l(this,aj))==null||r.call(this)}if(Sn(e),e.touches.length!==2||(o=l(this,ij))!=null&&o.call(this)){v(this,ih,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),v(this,ih,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},N9=function(e){var S;if(!l(this,ih)||e.touches.length!==2)return;Sn(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:o,screenY:c}=s,d=l(this,ih),{touch0X:h,touch0Y:u,touch1X:p,touch1Y:f}=d,m=p-h,x=f-u,g=o-i,b=c-r,y=Math.hypot(g,b)||1,C=Math.hypot(m,x)||1;if(!l(this,gg)&&Math.abs(C-y)<=Mb.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=i,d.touch0Y=r,d.touch1X=o,d.touch1Y=c,!l(this,gg)){v(this,gg,!0);return}const w=[(i+o)/2,(r+c)/2];(S=l(this,oj))==null||S.call(this,w,C,y)},j9=function(e){var t;e.touches.length>=2||(l(this,rh)&&(l(this,rh).abort(),v(this,rh,null),(t=l(this,lj))==null||t.call(this)),l(this,ih)&&(Sn(e),v(this,ih,null),v(this,gg,!1)))},Mb);var bg,Ll,Bs,fs,ah,Fb,Np,cj,Ti,vg,oh,Uo,jp,dj,wg,Aa,hj,Sg,lh,Dc,Ob,Bb,zo,Cg,Qe,uj,IP,He,IM,pj,MM,fT,A9,E9,FM,mT,OM,k9,T9,_9,BM,P9,$M,L9,D9,R9,UM,KS;let Ws=(Qe=class{constructor(e){A(this,He);A(this,bg,null);A(this,Ll,null);A(this,Bs,null);A(this,fs,null);A(this,ah,null);A(this,Fb,!1);A(this,Np,null);A(this,cj,"");A(this,Ti,null);A(this,vg,null);A(this,oh,null);A(this,Uo,null);A(this,jp,null);A(this,dj,"");A(this,wg,!1);A(this,Aa,null);A(this,hj,!1);A(this,Sg,!1);A(this,lh,!1);A(this,Dc,null);A(this,Ob,0);A(this,Bb,0);A(this,zo,null);A(this,Cg,null);W(this,"isSelected",!1);W(this,"_isCopy",!1);W(this,"_editToolbar",null);W(this,"_initialOptions",Object.create(null));W(this,"_initialData",null);W(this,"_isVisible",!0);W(this,"_uiManager",null);W(this,"_focusEventsAllowed",!0);A(this,uj,!1);A(this,IP,Qe._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[c,d]=this.parentDimensions;this.x=e.x/c,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Qe.prototype._resizeWithKeyboard,t=LN.TRANSLATE_SMALL,s=LN.TRANSLATE_BIG;return ot(this,"_resizerKeyboardManager",new EE([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],Qe.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ot(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Oce({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Qe._l10n??(Qe._l10n=e),Qe._l10nResizer||(Qe._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Qe._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Qe._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Cs("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,uj)}set _isDraggable(e){var t;v(this,uj,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,IP)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(E(this,He,KS).call(this),(t=l(this,Uo))==null||t.remove(),v(this,Uo,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(l(this,wg)?v(this,wg,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){E(this,He,IM).call(this,this.parentDimensions,e,t)}translateInPage(e,t){l(this,Aa)||v(this,Aa,[this.x,this.y,this.width,this.height]),E(this,He,IM).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){l(this,Aa)||v(this,Aa,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:p,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:c}=this;const[d,h]=this.getBaseTranslation();o+=d,c+=h;const{style:u}=s;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*c).toFixed(2)}%`,this._onTranslating(o,c),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!l(this,Aa)&&(l(this,Aa)[0]!==this.x||l(this,Aa)[1]!==this.y)}get _hasBeenResized(){return!!l(this,Aa)&&(l(this,Aa)[2]!==this.width||l(this,Aa)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=Qe,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:o,width:c,height:d}=this;if(c*=s,d*=i,r*=s,o*=i,this._mustFixPosition)switch(e){case 0:r=Mr(r,0,s-c),o=Mr(o,0,i-d);break;case 90:r=Mr(r,0,s-d),o=Mr(o,c,i);break;case 180:r=Mr(r,c,s),o=Mr(o,d,i);break;case 270:r=Mr(r,d,s),o=Mr(o,0,i-c);break}this.x=r/=s,this.y=o/=i;const[h,u]=this.getBaseTranslation();r+=h,o+=u,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return E(s=Qe,pj,MM).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return E(s=Qe,pj,MM).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=l(this,Bs))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||l(this,Sg))return this._editToolbar;this._editToolbar=new Lce(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=l(this,Bs))==null||t.destroy()}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return l(this,Bs)||(yU.initialize(Qe._l10n),v(this,Bs,new yU(this)),l(this,bg)&&(l(this,Bs).data=l(this,bg),v(this,bg,null))),l(this,Bs)}get altTextData(){var e;return(e=l(this,Bs))==null?void 0:e.data}set altTextData(e){l(this,Bs)&&(l(this,Bs).data=e)}get guessedAltText(){var e;return(e=l(this,Bs))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=l(this,Bs))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=l(this,Bs))==null?void 0:t.serialize(e)}hasAltText(){return!!l(this,Bs)&&!l(this,Bs).isEmpty()}hasAltTextData(){var e;return((e=l(this,Bs))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=l(this,fs))==null||e.focusButton()}addCommentButton(){return this.canAddComment?l(this,fs)||v(this,fs,new wk(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(l(this,ah)){this._uiManager.isEditingMode()&&l(this,ah).classList.remove("hidden");return}this.hasComment&&(v(this,ah,l(this,fs).renderForStandalone()),this.div.append(l(this,ah)))}}removeStandaloneCommentButton(){l(this,fs).removeStandaloneCommentButton(),v(this,ah,null)}hideStandaloneCommentButton(){var e;(e=l(this,ah))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:s,deleted:i}}=l(this,fs);return{text:t,richText:e,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){l(this,fs)||v(this,fs,new wk(this)),l(this,fs).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(l(this,fs)||v(this,fs,new wk(this)),l(this,fs).setInitialText(e,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=l(this,fs))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=l(this,fs))==null?void 0:e.isDeleted()}get hasComment(){return!!l(this,fs)&&!l(this,fs).isEmpty()&&!l(this,fs).isDeleted()}async editComment(e){l(this,fs)||v(this,fs,new wk(this)),l(this,fs).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){l(this,fs).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,c=o+r+1,d=i-100,h=c+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[c,d,h,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){l(this,fs).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=l(this,Fb)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),E(this,He,$M).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),l9(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(l(this,Cg)||v(this,Cg,new S9({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:E(this,He,k9).bind(this),onPinching:E(this,He,T9).bind(this),onPinchEnd:E(this,He,_9).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Yi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(v(this,wg,!0),this._isDraggable){E(this,He,P9).call(this,e);return}E(this,He,BM).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){l(this,Dc)&&clearTimeout(l(this,Dc)),v(this,Dc,setTimeout(()=>{var e;v(this,Dc,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[c,d]=this.pageTranslation,h=e/i,u=t/i,p=this.x*r,f=this.y*o,m=this.width*r,x=this.height*o;switch(s){case 0:return[p+h+c,o-f-u-x+d,p+h+m+c,o-f-u+d];case 90:return[p+u+c,o-f+h+d,p+u+x+c,o-f+h+m+d];case 180:return[p-h-m+c,o-f+u+d,p-h+c,o-f+u+x+d];case 270:return[p-u-x+c,o-f-h-m+d,p-u+c,o-f-h+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,o]=e,c=r-s,d=o-i;switch(this.rotation){case 0:return[s,t-o,c,d];case 90:return[s,t-i,d,c];case 180:return[r,t-i,c,d];case 270:return[r,t-o,d,c];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Qe._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=l(this,fs))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:i,deleted:r,richText:o},uid:c,pageIndex:d,creationDate:h,modificationDate:u}=this;return{id:c,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:h,modificationDate:s||u,popupRef:!r,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),v(this,Sg,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),v(this,Sg,!1),!0):!1}isInEditMode(){return l(this,Sg)}shouldGetKeyboardEvents(){return l(this,lh)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&s>0}rebuild(){E(this,He,$M).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var s;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((s=this._initialData)==null?void 0:s.popupRef)||""}}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,v(i,bg,e.accessibilityData),i._isCopy=e.isCopy||!1;const[r,o]=i.pageDimensions,[c,d,h,u]=i.getRectInCurrentCoords(e.rect,o);return i.x=c/r,i.y=d/o,i.width=h/r,i.height=u/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,s;if((e=l(this,jp))==null||e.abort(),v(this,jp,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),l(this,Dc)&&(clearTimeout(l(this,Dc)),v(this,Dc,null)),E(this,He,KS).call(this),this.removeEditToolbar(),l(this,zo)){for(const i of l(this,zo).values())clearTimeout(i);v(this,zo,null)}this.parent=null,(t=l(this,Cg))==null||t.destroy(),v(this,Cg,null),(s=l(this,Uo))==null||s.remove(),v(this,Uo,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(E(this,He,A9).call(this),l(this,Ti).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,i,r,o]=this.getPDFRect();return[Qe._round(s+(r-s)*e),Qe._round(i+(o-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return l(this,fs).commentPopupPositionInLayer}set commentPopupPosition(e){l(this,fs).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return l(this,fs).hasDefaultPopupPosition()}get commentButtonWidth(){return l(this,fs).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=l(this,fs))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),v(this,oh,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=l(this,Ti).children;if(!l(this,Ll)){v(this,Ll,Array.from(t));const o=E(this,He,L9).bind(this),c=E(this,He,D9).bind(this),d=this._uiManager._signal;for(const h of l(this,Ll)){const u=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",o,{signal:d}),h.addEventListener("blur",c,{signal:d}),h.addEventListener("focus",E(this,He,R9).bind(this,u),{signal:d}),h.setAttribute("data-l10n-id",Qe._l10nResizer[u])}}const s=l(this,Ll)[0];let i=0;for(const o of t){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(l(this,Ll).length/4);if(r!==i){if(r<i)for(let c=0;c<i-r;c++)l(this,Ti).append(l(this,Ti).firstChild);else if(r>i)for(let c=0;c<r-i;c++)l(this,Ti).firstChild.before(l(this,Ti).lastChild);let o=0;for(const c of t){const h=l(this,Ll)[o++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",Qe._l10nResizer[h])}}E(this,He,UM).call(this,0),v(this,lh,!0),l(this,Ti).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){l(this,lh)&&E(this,He,OM).call(this,l(this,dj),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){E(this,He,KS).call(this),this.div.focus()}select(){var e,t,s;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=l(this,Bs))==null||s.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,s,i,r;this.isSelected&&(this.isSelected=!1,(e=l(this,Ti))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=l(this,Bs))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return l(this,hj)}set isEditing(e){v(this,hj,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){l(this,zo)||v(this,zo,new Map);const{action:s}=e;let i=l(this,zo).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),l(this,zo).delete(s),l(this,zo).size===0&&v(this,zo,null)},Qe._telemetryTimeout),l(this,zo).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),v(this,Fb,!1)}disable(){this.div&&(this.div.tabIndex=-1),v(this,Fb,!0)}updateFakeAnnotationElement(e){if(!l(this,Uo)&&!this.deleted){v(this,Uo,e.addFakeAnnotation(this));return}if(this.deleted){l(this,Uo).remove(),v(this,Uo,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&l(this,Uo).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}},bg=new WeakMap,Ll=new WeakMap,Bs=new WeakMap,fs=new WeakMap,ah=new WeakMap,Fb=new WeakMap,Np=new WeakMap,cj=new WeakMap,Ti=new WeakMap,vg=new WeakMap,oh=new WeakMap,Uo=new WeakMap,jp=new WeakMap,dj=new WeakMap,wg=new WeakMap,Aa=new WeakMap,hj=new WeakMap,Sg=new WeakMap,lh=new WeakMap,Dc=new WeakMap,Ob=new WeakMap,Bb=new WeakMap,zo=new WeakMap,Cg=new WeakMap,uj=new WeakMap,IP=new WeakMap,He=new WeakSet,IM=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},pj=new WeakSet,MM=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},fT=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},A9=function(){if(l(this,Ti))return;v(this,Ti,document.createElement("div")),l(this,Ti).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");l(this,Ti).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",E(this,He,E9).bind(this,s),{signal:t}),i.addEventListener("contextmenu",xl,{signal:t}),i.tabIndex=-1}this.div.prepend(l(this,Ti))},E9=function(e,t){var u;t.preventDefault();const{isMac:s}=Yi.platform;if(t.button!==0||t.ctrlKey&&s)return;(u=l(this,Bs))==null||u.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,v(this,vg,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",E(this,He,OM).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Sn,{passive:!1,signal:o}),window.addEventListener("contextmenu",xl,{signal:o}),v(this,oh,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const c=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var p;r.abort(),this.parent.togglePointerEvents(!0),(p=l(this,Bs))==null||p.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=c,this.div.style.cursor=d,E(this,He,mT).call(this)};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})},FM=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},mT=function(){if(!l(this,oh))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=l(this,oh);v(this,oh,null);const r=this.x,o=this.y,c=this.width,d=this.height;r===e&&o===t&&c===s&&d===i||this.addCommands({cmd:E(this,He,FM).bind(this,r,o,c,d),undo:E(this,He,FM).bind(this,e,t,s,i),mustExec:!0})},OM=function(e,t){const[s,i]=this.parentDimensions,r=this.x,o=this.y,c=this.width,d=this.height,h=Qe.MIN_SIZE/s,u=Qe.MIN_SIZE/i,p=E(this,He,fT).call(this,this.rotation),f=(B,U)=>[p[0]*B+p[2]*U,p[1]*B+p[3]*U],m=E(this,He,fT).call(this,360-this.rotation),x=(B,U)=>[m[0]*B+m[2]*U,m[1]*B+m[3]*U];let g,b,y=!1,C=!1;switch(e){case"topLeft":y=!0,g=(B,U)=>[0,0],b=(B,U)=>[B,U];break;case"topMiddle":g=(B,U)=>[B/2,0],b=(B,U)=>[B/2,U];break;case"topRight":y=!0,g=(B,U)=>[B,0],b=(B,U)=>[0,U];break;case"middleRight":C=!0,g=(B,U)=>[B,U/2],b=(B,U)=>[0,U/2];break;case"bottomRight":y=!0,g=(B,U)=>[B,U],b=(B,U)=>[0,0];break;case"bottomMiddle":g=(B,U)=>[B/2,U],b=(B,U)=>[B/2,0];break;case"bottomLeft":y=!0,g=(B,U)=>[0,U],b=(B,U)=>[B,0];break;case"middleLeft":C=!0,g=(B,U)=>[0,U/2],b=(B,U)=>[B,U/2];break}const w=g(c,d),S=b(c,d);let j=f(...S);const T=Qe._round(r+j[0]),k=Qe._round(o+j[1]);let _=1,L=1,D,P;if(t.fromKeyboard)({deltaX:D,deltaY:P}=t);else{const{screenX:B,screenY:U}=t,[$,G]=l(this,vg);[D,P]=this.screenToPageTranslation(B-$,U-G),l(this,vg)[0]=B,l(this,vg)[1]=U}if([D,P]=x(D/s,P/i),y){const B=Math.hypot(c,d);_=L=Math.max(Math.min(Math.hypot(S[0]-w[0]-D,S[1]-w[1]-P)/B,1/c,1/d),h/c,u/d)}else C?_=Mr(Math.abs(S[0]-w[0]-D),h,1)/c:L=Mr(Math.abs(S[1]-w[1]-P),u,1)/d;const I=Qe._round(c*_),M=Qe._round(d*L);j=f(...b(I,M));const O=T-j[0],F=k-j[1];l(this,Aa)||v(this,Aa,[this.x,this.y,this.width,this.height]),this.width=I,this.height=M,this.x=O,this.y=F,this.setDims(),this.fixAndSetPosition(),this._onResizing()},k9=function(){var e;v(this,oh,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=l(this,Bs))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},T9=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const o=E(this,He,fT).call(this,this.rotation),c=(T,k)=>[o[0]*T+o[2]*k,o[1]*T+o[3]*k],[d,h]=this.parentDimensions,u=this.x,p=this.y,f=this.width,m=this.height,x=Qe.MIN_SIZE/d,g=Qe.MIN_SIZE/h;r=Math.max(Math.min(r,1/f,1/m),x/f,g/m);const b=Qe._round(f*r),y=Qe._round(m*r);if(b===f&&y===m)return;l(this,Aa)||v(this,Aa,[u,p,f,m]);const C=c(f/2,m/2),w=Qe._round(u+C[0]),S=Qe._round(p+C[1]),j=c(b/2,y/2);this.x=w-j[0],this.y=S-j[1],this.width=b,this.height=y,this.setDims(),this.fixAndSetPosition(),this._onResizing()},_9=function(){var e;(e=l(this,Bs))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),E(this,He,mT).call(this)},BM=function(e){const{isMac:t}=Yi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},P9=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},c=h=>{i.abort(),v(this,Np,null),v(this,wg,!1),this._uiManager.endDragSession()||E(this,He,BM).call(this,h),s&&this._onStopDragging()};t&&(v(this,Ob,e.clientX),v(this,Bb,e.clientY),v(this,Np,e.pointerId),v(this,cj,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:u,clientY:p,pointerId:f}=h;if(f!==l(this,Np)){Sn(h);return}const[m,x]=this.screenToPageTranslation(u-l(this,Ob),p-l(this,Bb));v(this,Ob,u),v(this,Bb,p),this._uiManager.dragSelectedEditors(m,x)},o),window.addEventListener("touchmove",Sn,o),window.addEventListener("pointerdown",h=>{h.pointerType===l(this,cj)&&(l(this,Cg)||h.isPrimary)&&c(h),Sn(h)},o));const d=h=>{if(!l(this,Np)||l(this,Np)===h.pointerId){c(h);return}Sn(h)};window.addEventListener("pointerup",d,{signal:r}),window.addEventListener("blur",d,{signal:r})},$M=function(){if(l(this,jp)||!this.div)return;v(this,jp,new AbortController);const e=this._uiManager.combinedSignal(l(this,jp));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},L9=function(e){Qe._resizerKeyboardManager.exec(this,e)},D9=function(e){var t;l(this,lh)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==l(this,Ti)&&E(this,He,KS).call(this)},R9=function(e){v(this,dj,l(this,lh)?e:"")},UM=function(e){if(l(this,Ll))for(const t of l(this,Ll))t.tabIndex=e},KS=function(){v(this,lh,!1),E(this,He,UM).call(this,-1),E(this,He,mT).call(this)},A(Qe,pj),W(Qe,"_l10n",null),W(Qe,"_l10nResizer",null),W(Qe,"_borderLineWidth",-1),W(Qe,"_colorManager",new Fce),W(Qe,"_zIndex",1),W(Qe,"_telemetryTimeout",1e3),Qe),Oce=class extends Ws{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}};const bU=3285377520,To=4294901760,yc=65535;let I9=class{constructor(e){this.h1=e?e&4294967295:bU,this.h2=e?e&4294967295:bU}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let g=0,b=e.length;g<b;g++){const y=e.charCodeAt(g);y<=255?t[s++]=y:(t[s++]=y>>>8,t[s++]=y&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(t.buffer,0,i);let c=0,d=0,h=this.h1,u=this.h2;const p=3432918353,f=461845907,m=p&yc,x=f&yc;for(let g=0;g<i;g++)g&1?(c=o[g],c=c*p&To|c*m&yc,c=c<<15|c>>>17,c=c*f&To|c*x&yc,h^=c,h=h<<13|h>>>19,h=h*5+3864292196):(d=o[g],d=d*p&To|d*m&yc,d=d<<15|d>>>17,d=d*f&To|d*x&yc,u^=d,u=u<<13|u>>>19,u=u*5+3864292196);switch(c=0,r){case 3:c^=t[i*4+2]<<16;case 2:c^=t[i*4+1]<<8;case 1:c^=t[i*4],c=c*p&To|c*m&yc,c=c<<15|c>>>17,c=c*f&To|c*x&yc,i&1?h^=c:u^=c}this.h1=h,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&To|e*36045&yc,t=t*4283543511&To|((t<<16|e>>>16)*2950163797&To)>>>16,e^=t>>>1,e=e*444984403&To|e*60499&yc,t=t*3301882366&To|((t<<16|e>>>16)*3120437893&To)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}};const zM=Object.freeze({map:null,hash:"",transfer:void 0});var Ng,jg,ch,_i,MP,M9,o8;let f3=(o8=class{constructor(){A(this,MP);A(this,Ng,!1);A(this,jg,null);A(this,ch,null);A(this,_i,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=l(this,_i).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return l(this,_i).get(e)}remove(e){const t=l(this,_i).get(e);if(t!==void 0&&(t instanceof Ws&&l(this,ch).delete(t.annotationElementId),l(this,_i).delete(e),l(this,_i).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of l(this,_i).values())if(s instanceof Ws)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=l(this,_i).get(e);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(t))s[r]!==o&&(i=!0,s[r]=o);else i=!0,l(this,_i).set(e,t);i&&E(this,MP,M9).call(this),t instanceof Ws&&((l(this,ch)||v(this,ch,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return l(this,_i).has(e)}get size(){return l(this,_i).size}resetModified(){l(this,Ng)&&(v(this,Ng,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new F9(this)}get serializable(){if(l(this,_i).size===0)return zM;const e=new Map,t=new I9,s=[],i=Object.create(null);let r=!1;for(const[o,c]of l(this,_i)){const d=c instanceof Ws?c.serialize(!1,i):c;d&&(e.set(o,d),t.update(`${o}:${JSON.stringify(d)}`),r||(r=!!d.bitmap))}if(r)for(const o of e.values())o.bitmap&&s.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:zM}get editorStats(){let e=null;const t=new Map;let s=0,i=0;for(const r of l(this,_i).values()){if(!(r instanceof Ws)){r.popup&&(r.popup.deleted?i+=1:s+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(s+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:c}=o;t.has(c)||t.set(c,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const d=e[c]||(e[c]=new Map);for(const[h,u]of Object.entries(o)){if(h==="type")continue;let p=d.get(h);p||(p=new Map,d.set(h,p));const f=p.get(u)??0;p.set(u,f+1)}}if((i>0||s>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:s}),!e)return null;for(const[r,o]of t)e[r]=o.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){v(this,jg,null)}updateEditor(e,t){var i;const s=(i=l(this,ch))==null?void 0:i.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=l(this,ch))==null?void 0:t.get(e))||null}get modifiedIds(){if(l(this,jg))return l(this,jg);const e=[];if(l(this,ch))for(const t of l(this,ch).values())t.serialize()&&e.push(t.annotationElementId);return v(this,jg,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return l(this,_i).entries()}},Ng=new WeakMap,jg=new WeakMap,ch=new WeakMap,_i=new WeakMap,MP=new WeakSet,M9=function(){l(this,Ng)||(v(this,Ng,!0),typeof this.onSetModified=="function"&&this.onSetModified())},o8);var fj,l8;let F9=(l8=class extends f3{constructor(t){super();A(this,fj);const{map:s,hash:i,transfer:r}=t.serializable,o=structuredClone(s,r?{transfer:r}:null);v(this,fj,{map:o,hash:i,transfer:r})}get print(){Cs("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,fj)}get modifiedIds(){return ot(this,"modifiedIds",{ids:new Set,hash:""})}},fj=new WeakMap,l8);var $b,c8;let Bce=(c8=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){A(this,$b,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),l(this,$b).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||l(this,$b).has(e.loadedName))){if(At(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:o}=e,c=new FontFace(i,r,o);this.addNativeFontFace(c);try{await c.load(),l(this,$b).add(i),s==null||s(e)}catch{tt(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}Cs("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw tt(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return ot(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return ot(this,"isSyncFontLoadingSupported",Ir||Yi.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(At(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ot(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(S,j){return S.charCodeAt(j)<<24|S.charCodeAt(j+1)<<16|S.charCodeAt(j+2)<<8|S.charCodeAt(j+3)&255}function i(S,j,T,k){const _=S.substring(0,j),L=S.substring(j+T);return _+k+L}let r,o;const c=this._document.createElement("canvas");c.width=1,c.height=1;const d=c.getContext("2d");let h=0;function u(S,j){if(++h>30){tt("Load test font never loaded."),j();return}if(d.font="30px "+S,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){j();return}setTimeout(u.bind(null,S,j))}const p=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,p.length,p);const x=16,g=1482184792;let b=s(f,x);for(r=0,o=p.length-3;r<o;r+=4)b=b-g+s(p,r)|0;r<p.length&&(b=b-g+s(p+"XXX",r)|0),f=i(f,x,4,gce(b));const y=`url(data:font/opentype;base64,${btoa(f)});`,C=`@font-face {font-family:"${p}";src:${y}}`;this.insertRule(C);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const S of[e.loadedName,p]){const j=this._document.createElement("span");j.textContent="Hi",j.style.fontFamily=S,w.append(j)}this._document.body.append(w),u(p,()=>{w.remove(),t.complete()})}},$b=new WeakMap,c8);var es,d8;let $ce=(d8=class{constructor(e,t=null,s,i){A(this,es);this.compiledGlyphs=Object.create(null),v(this,es,e),this._inspectFont=t,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${QW(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(o){tt(`getPathGenerator - ignoring character: "${o}".`)}const r=s9(i);return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}get black(){return l(this,es).black}get bold(){return l(this,es).bold}get disableFontFace(){return l(this,es).disableFontFace??!1}get fontExtraProperties(){return l(this,es).fontExtraProperties??!1}get isInvalidPDFjsFont(){return l(this,es).isInvalidPDFjsFont}get isType3Font(){return l(this,es).isType3Font}get italic(){return l(this,es).italic}get missingFile(){return l(this,es).missingFile}get remeasure(){return l(this,es).remeasure}get vertical(){return l(this,es).vertical}get ascent(){return l(this,es).ascent}get defaultWidth(){return l(this,es).defaultWidth}get descent(){return l(this,es).descent}get bbox(){return l(this,es).bbox}get fontMatrix(){return l(this,es).fontMatrix}get fallbackName(){return l(this,es).fallbackName}get loadedName(){return l(this,es).loadedName}get mimetype(){return l(this,es).mimetype}get name(){return l(this,es).name}get data(){return l(this,es).data}clearData(){l(this,es).clearData()}get cssFontInfo(){return l(this,es).cssFontInfo}get systemFontInfo(){return l(this,es).systemFontInfo}get defaultVMetrics(){return l(this,es).defaultVMetrics}},es=new WeakMap,d8);var Ub,zb,mj,yu,Hb,gT;let vU=(yu=class{constructor(e){A(this,Hb);A(this,Ub);A(this,zb);A(this,mj);v(this,Ub,e),v(this,zb,new DataView(l(this,Ub))),v(this,mj,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const h of yu.strings){const u=t.encode(e[h]);s[h]=u,i+=4+u.length}const r=new ArrayBuffer(i),o=new Uint8Array(r),c=new DataView(r);let d=0;for(const h of yu.strings){const u=s[h],p=u.length;c.setUint32(d,p),o.set(u,d+4),d+=4+p}return At(d===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return E(this,Hb,gT).call(this,0)}get fontWeight(){return E(this,Hb,gT).call(this,1)}get italicAngle(){return E(this,Hb,gT).call(this,2)}},Ub=new WeakMap,zb=new WeakMap,mj=new WeakMap,Hb=new WeakSet,gT=function(e){At(e<yu.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=l(this,zb).getUint32(t)+4;const s=l(this,zb).getUint32(t);return l(this,mj).decode(new Uint8Array(l(this,Ub),t+4,s))},W(yu,"strings",["fontFamily","fontWeight","italicAngle"]),yu);var Ap,Rc,Ag,bu,Eg,QS;let wU=(bu=class{constructor(e){A(this,Eg);A(this,Ap);A(this,Rc);A(this,Ag);v(this,Ap,e),v(this,Rc,new DataView(l(this,Ap))),v(this,Ag,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const f of bu.strings){const m=t.encode(e[f]);s[f]=m,i+=4+m.length}i+=4;let r,o,c=1+i;e.style&&(r=t.encode(e.style.style),o=t.encode(e.style.weight),c+=4+r.length+4+o.length);const d=new ArrayBuffer(c),h=new Uint8Array(d),u=new DataView(d);let p=0;u.setUint8(p++,e.guessFallback?1:0),u.setUint32(p,0),p+=4,i=0;for(const f of bu.strings){const m=s[f],x=m.length;i+=4+x,u.setUint32(p,x),h.set(m,p+4),p+=4+x}return u.setUint32(p-i-4,i),e.style&&(u.setUint32(p,r.length),h.set(r,p+4),p+=4+r.length,u.setUint32(p,o.length),h.set(o,p+4),p+=4+o.length),At(p<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(p)}get guessFallback(){return l(this,Rc).getUint8(0)!==0}get css(){return E(this,Eg,QS).call(this,0)}get loadedName(){return E(this,Eg,QS).call(this,1)}get baseFontName(){return E(this,Eg,QS).call(this,2)}get src(){return E(this,Eg,QS).call(this,3)}get style(){let e=1;e+=4+l(this,Rc).getUint32(e);const t=l(this,Rc).getUint32(e),s=l(this,Ag).decode(new Uint8Array(l(this,Ap),e+4,t));e+=4+t;const i=l(this,Rc).getUint32(e),r=l(this,Ag).decode(new Uint8Array(l(this,Ap),e+4,i));return{style:s,weight:r}}},Ap=new WeakMap,Rc=new WeakMap,Ag=new WeakMap,Eg=new WeakSet,QS=function(e){At(e<bu.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=l(this,Rc).getUint32(t)+4;const s=l(this,Rc).getUint32(t);return l(this,Ag).decode(new Uint8Array(l(this,Ap),t+4,s))},W(bu,"strings",["css","loadedName","baseFontName","src"]),bu);var Je,Vb,Gb,Wb,qb,Ea,Ic,gj,ts,bn,Nl,xT,JS;let Uce=(Je=class{constructor({data:e,extra:t}){A(this,bn);A(this,Ic);A(this,gj);A(this,ts);v(this,Ic,e),v(this,gj,new TextDecoder),v(this,ts,new DataView(l(this,Ic))),t&&Object.assign(this,t)}get black(){return E(this,bn,Nl).call(this,0)}get bold(){return E(this,bn,Nl).call(this,1)}get disableFontFace(){return E(this,bn,Nl).call(this,2)}get fontExtraProperties(){return E(this,bn,Nl).call(this,3)}get isInvalidPDFjsFont(){return E(this,bn,Nl).call(this,4)}get isType3Font(){return E(this,bn,Nl).call(this,5)}get italic(){return E(this,bn,Nl).call(this,6)}get missingFile(){return E(this,bn,Nl).call(this,7)}get remeasure(){return E(this,bn,Nl).call(this,8)}get vertical(){return E(this,bn,Nl).call(this,9)}get ascent(){return E(this,bn,xT).call(this,0)}get defaultWidth(){return E(this,bn,xT).call(this,1)}get descent(){return E(this,bn,xT).call(this,2)}get bbox(){let e=l(Je,Gb);if(l(this,ts).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<4;i++)s.push(l(this,ts).getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=l(Je,Wb);if(l(this,ts).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<6;i++)s.push(l(this,ts).getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=l(Je,qb);if(l(this,ts).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<3;i++)s.push(l(this,ts).getInt16(e,!0)),e+=2;return s}get fallbackName(){return E(this,bn,JS).call(this,0)}get loadedName(){return E(this,bn,JS).call(this,1)}get mimetype(){return E(this,bn,JS).call(this,2)}get name(){return E(this,bn,JS).call(this,3)}get data(){let e=l(Je,Ea);const t=l(this,ts).getUint32(e);e+=4+t;const s=l(this,ts).getUint32(e);e+=4+s;const i=l(this,ts).getUint32(e);e+=4+i;const r=l(this,ts).getUint32(e);if(r!==0)return new Uint8Array(l(this,Ic),e+4,r)}clearData(){let e=l(Je,Ea);const t=l(this,ts).getUint32(e);e+=4+t;const s=l(this,ts).getUint32(e);e+=4+s;const i=l(this,ts).getUint32(e);e+=4+i;const r=l(this,ts).getUint32(e);new Uint8Array(l(this,Ic),e+4,r).fill(0),l(this,ts).setUint32(e,0)}get cssFontInfo(){let e=l(Je,Ea);const t=l(this,ts).getUint32(e);e+=4+t;const s=l(this,ts).getUint32(e);e+=4+s;const i=l(this,ts).getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(l(this,Ic),e+4,i)),new vU(r.buffer)}get systemFontInfo(){let e=l(Je,Ea);const t=l(this,ts).getUint32(e);e+=4+t;const s=l(this,ts).getUint32(e);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(l(this,Ic),e+4,s)),new wU(i.buffer)}static write(e){const t=e.systemFontInfo?wU.write(e.systemFontInfo):null,s=e.cssFontInfo?vU.write(e.cssFontInfo):null,i=new TextEncoder,r={};let o=0;for(const g of Je.strings)r[g]=i.encode(e[g]),o+=4+r[g].length;const c=l(Je,Ea)+4+o+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),d=new ArrayBuffer(c),h=new Uint8Array(d),u=new DataView(d);let p=0;const f=Je.bools.length;let m=0,x=0;for(let g=0;g<f;g++){const b=e[Je.bools[g]];m|=(b===void 0?0:b?2:1)<<x,x+=2,(x===8||g===f-1)&&(u.setUint8(p++,m),m=0,x=0)}At(p===l(Je,Vb),"FontInfo.write: Boolean properties offset mismatch");for(const g of Je.numbers)u.setFloat64(p,e[g]),p+=8;if(At(p===l(Je,Gb),"FontInfo.write: Number properties offset mismatch"),e.bbox){u.setUint8(p++,4);for(const g of e.bbox)u.setInt16(p,g,!0),p+=2}else u.setUint8(p++,0),p+=2*4;if(At(p===l(Je,Wb),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){u.setUint8(p++,6);for(const g of e.fontMatrix)u.setFloat64(p,g,!0),p+=8}else u.setUint8(p++,0),p+=8*6;if(At(p===l(Je,qb),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){u.setUint8(p++,1);for(const g of e.defaultVMetrics)u.setInt16(p,g,!0),p+=2}else u.setUint8(p++,0),p+=3*2;At(p===l(Je,Ea),"FontInfo.write: DefaultVMetrics properties offset mismatch"),u.setUint32(l(Je,Ea),0),p+=4;for(const g of Je.strings){const b=r[g],y=b.length;u.setUint32(p,y),h.set(b,p+4),p+=4+y}if(u.setUint32(l(Je,Ea),p-l(Je,Ea)-4),!t)u.setUint32(p,0),p+=4;else{const g=t.byteLength;u.setUint32(p,g),At(p+4+g<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),p+4),p+=4+g}if(!s)u.setUint32(p,0),p+=4;else{const g=s.byteLength;u.setUint32(p,g),At(p+4+g<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(s),p+4),p+=4+g}return e.data===void 0?(u.setUint32(p,0),p+=4):(u.setUint32(p,e.data.length),h.set(e.data,p+4),p+=4+e.data.length),At(p<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(p)}},Vb=new WeakMap,Gb=new WeakMap,Wb=new WeakMap,qb=new WeakMap,Ea=new WeakMap,Ic=new WeakMap,gj=new WeakMap,ts=new WeakMap,bn=new WeakSet,Nl=function(e){At(e<Je.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,i=l(this,ts).getUint8(t)>>s&3;return i===0?void 0:i===2},xT=function(e){return At(e<Je.numbers.length,"Invalid number index"),l(this,ts).getFloat64(l(Je,Vb)+e*8)},JS=function(e){At(e<Je.strings.length,"Invalid string index");let t=l(Je,Ea)+4;for(let r=0;r<e;r++)t+=l(this,ts).getUint32(t)+4;const s=l(this,ts).getUint32(t),i=new Uint8Array(s);return i.set(new Uint8Array(l(this,Ic),t+4,s)),l(this,gj).decode(i)},W(Je,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),W(Je,"numbers",["ascent","defaultWidth","descent"]),W(Je,"strings",["fallbackName","loadedName","mimetype","name"]),A(Je,Vb,Math.ceil(Je.bools.length*2/8)),A(Je,Gb,l(Je,Vb)+Je.numbers.length*8),A(Je,Wb,l(Je,Gb)+1+2*4),A(Je,qb,l(Je,Wb)+1+8*6),A(Je,Ea,l(Je,qb)+1+2*3),Je);var xj,yj,bj,vj,wj,Sj,Cj,Nj;const As=class As{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,s=null,i=[],r=[],o=[],c=[],d=null,h=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,s=e[2],o=e[3],t===1?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,d=e[1],i=e[2],r=e[3],c=e[4]||[],s=e[6],h=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const u=Math.floor(i.length/2),p=Math.floor(r.length/3),f=o.length,m=c.length;let x=0;for(const j of c)x+=1,x=Math.ceil(x/4)*4,x+=4+j.coords.length*4,x+=4+j.colors.length*4,j.verticesPerRow!==void 0&&(x+=4);const g=20+u*8+p*3+f*8+(s?16:0)+(h?3:0)+x,b=new ArrayBuffer(g),y=new DataView(b),C=new Uint8Array(b);y.setUint8(l(As,xj),t),y.setUint8(l(As,yj),s?1:0),y.setUint8(l(As,bj),h?1:0),y.setUint8(l(As,vj),d),y.setUint32(l(As,wj),u,!0),y.setUint32(l(As,Sj),p,!0),y.setUint32(l(As,Cj),f,!0),y.setUint32(l(As,Nj),m,!0);let w=20;new Float32Array(b,w,u*2).set(i),w+=u*8,C.set(r,w),w+=p*3;for(const[j,T]of o)y.setFloat32(w,j,!0),w+=4,y.setUint32(w,parseInt(T.slice(1),16),!0),w+=4;if(s)for(const j of s)y.setFloat32(w,j,!0),w+=4;h&&(C.set(h,w),w+=3);for(let j=0;j<c.length;j++){const T=c[j];y.setUint8(w,T.type),w+=1,w=Math.ceil(w/4)*4,y.setUint32(w,T.coords.length,!0),w+=4,new Int32Array(b,w,T.coords.length).set(T.coords),w+=T.coords.length*4,y.setUint32(w,T.colors.length,!0),w+=4,new Int32Array(b,w,T.colors.length).set(T.colors),w+=T.colors.length*4,T.verticesPerRow!==void 0&&(y.setUint32(w,T.verticesPerRow,!0),w+=4)}return b}getIR(){const e=this.view,t=this.data[l(As,xj)],s=!!this.data[l(As,yj)],i=!!this.data[l(As,bj)],r=e.getUint32(l(As,wj),!0),o=e.getUint32(l(As,Sj),!0),c=e.getUint32(l(As,Cj),!0),d=e.getUint32(l(As,Nj),!0);let h=20;const u=new Float32Array(this.buffer,h,r*2);h+=r*8;const p=new Uint8Array(this.buffer,h,o*3);h+=o*3;const f=[];for(let b=0;b<c;++b){const y=e.getFloat32(h,!0);h+=4;const C=e.getUint32(h,!0);h+=4,f.push([y,`#${C.toString(16).padStart(6,"0")}`])}let m=null;if(s){m=[];for(let b=0;b<4;++b)m.push(e.getFloat32(h,!0)),h+=4}let x=null;i&&(x=new Uint8Array(this.buffer,h,3),h+=3);const g=[];for(let b=0;b<d;++b){const y=e.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const C=e.getUint32(h,!0);h+=4;const w=new Int32Array(this.buffer,h,C);h+=C*4;const S=e.getUint32(h,!0);h+=4;const j=new Int32Array(this.buffer,h,S);h+=S*4;const T={type:y,coords:w,colors:j};y===wM.LATTICE&&(T.verticesPerRow=e.getUint32(h,!0),h+=4),g.push(T)}if(t===1)return["RadialAxial","axial",m,f,Array.from(u.slice(0,2)),Array.from(u.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",m,f,[u[0],u[1]],[u[3],u[4]],u[2],u[5]];if(t===3){const b=this.data[l(As,vj)];let y=null;if(u.length>0){let C=u[0],w=u[0],S=u[1],j=u[1];for(let T=0;T<u.length;T+=2){const k=u[T],_=u[T+1];C=C>k?k:C,S=S>_?_:S,w=w<k?k:w,j=j<_?_:j}y=[C,S,w,j]}return["Mesh",b,u,p,g,y,m,x]}throw new Error(`Unsupported pattern kind: ${t}`)}};xj=new WeakMap,yj=new WeakMap,bj=new WeakMap,vj=new WeakMap,wj=new WeakMap,Sj=new WeakMap,Cj=new WeakMap,Nj=new WeakMap,A(As,xj,0),A(As,yj,1),A(As,bj,2),A(As,vj,3),A(As,wj,4),A(As,Sj,8),A(As,Cj,12),A(As,Nj,16);let HM=As;function zce(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(Ir)return n;const e=URL.parse(n,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Hce(n){if(Ir&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return NE(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Sk(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const VM=n=>typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0,Vce=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string",Gce=wce.bind(null,VM,Vce);var dh,FP,h8;let Wce=(h8=class{constructor(){A(this,dh,new Map);A(this,FP,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};l(this,FP).then(()=>{for(const[i]of l(this,dh))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){tt("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}l(this,dh).set(t,i)}removeEventListener(e,t){const s=l(this,dh).get(t);s==null||s(),l(this,dh).delete(t)}terminate(){for(const[,e]of l(this,dh))e==null||e();l(this,dh).clear()}},dh=new WeakMap,FP=new WeakMap,h8);const Ck={DATA:1,ERROR:2},Bn={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function SU(){}function Yr(n){if(n instanceof pm||n instanceof SM||n instanceof hU||n instanceof gP||n instanceof fR)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Cs('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new pm(n.message);case"InvalidPDFException":return new SM(n.message);case"PasswordException":return new hU(n.message,n.code);case"ResponseException":return new gP(n.message,n.status,n.missing);case"UnknownErrorException":return new fR(n.message,n.details)}return new fR(n.message,n.toString())}var Yb,pl,O9,B9,$9,yT,u8;let ZS=(u8=class{constructor(e,t,s){A(this,pl);A(this,Yb,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",E(this,pl,O9).bind(this),{signal:l(this,Yb).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,o=this.sourceName,c=this.targetName,d=this.comObj;return new ReadableStream({start:h=>{const u=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:c,action:e,streamId:r,data:t,desiredSize:h.desiredSize},i),u.promise},pull:h=>{const u=Promise.withResolvers();return this.streamControllers[r].pullCall=u,d.postMessage({sourceName:o,targetName:c,stream:Bn.PULL,streamId:r,desiredSize:h.desiredSize}),u.promise},cancel:h=>{At(h instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[r].cancelCall=u,this.streamControllers[r].isClosed=!0,d.postMessage({sourceName:o,targetName:c,stream:Bn.CANCEL,streamId:r,reason:Yr(h)}),u.promise}},s)}destroy(){var e;(e=l(this,Yb))==null||e.abort(),v(this,Yb,null)}},Yb=new WeakMap,pl=new WeakSet,O9=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){E(this,pl,$9).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Ck.DATA)i.resolve(e.data);else if(e.callback===Ck.ERROR)i.reject(Yr(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:s,targetName:i,callback:Ck.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:i,callback:Ck.ERROR,callbackId:e.callbackId,reason:Yr(o)})});return}if(e.streamId){E(this,pl,B9).call(this,e);return}t(e.data)},B9=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this,c=this.actionHandler[e.action],d={enqueue(h,u=1,p){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:Bn.ENQUEUE,streamId:t,chunk:h},p)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Bn.CLOSE,streamId:t}),delete o.streamSinks[t])},error(h){At(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Bn.ERROR,streamId:t,reason:Yr(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,Promise.try(c,e.data,d).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Bn.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:Bn.START_COMPLETE,streamId:t,reason:Yr(h)})})},$9=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],c=this.streamSinks[t];switch(e.stream){case Bn.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Yr(e.reason));break;case Bn.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Yr(e.reason));break;case Bn.PULL:if(!c){r.postMessage({sourceName:s,targetName:i,stream:Bn.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&e.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=e.desiredSize,Promise.try(c.onPull||SU).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Bn.PULL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:Bn.PULL_COMPLETE,streamId:t,reason:Yr(h)})});break;case Bn.ENQUEUE:if(At(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Bn.CLOSE:if(At(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),E(this,pl,yT).call(this,o,t);break;case Bn.ERROR:At(o,"error should have stream controller"),o.controller.error(Yr(e.reason)),E(this,pl,yT).call(this,o,t);break;case Bn.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Yr(e.reason)),E(this,pl,yT).call(this,o,t);break;case Bn.CANCEL:if(!c)break;const d=Yr(e.reason);Promise.try(c.onCancel||SU,d).then(function(){r.postMessage({sourceName:s,targetName:i,stream:Bn.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:Bn.CANCEL_COMPLETE,streamId:t,reason:Yr(h)})}),c.sinkCapability.reject(d),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},yT=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]},u8);var jj,p8;let U9=(p8=class{constructor({enableHWA:e=!1}){A(this,jj,!1);v(this,jj,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!l(this,jj)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Cs("Abstract method `_createCanvas` called.")}},jj=new WeakMap,p8),qce=class extends U9{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}},z9=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Cs("Abstract method `_fetch` called.")}},CU=class extends z9{async _fetch(e){const t=await jE(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):NE(t)}},H9=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}};var kg,Xb,hh,uh,ar,Tg,_g,be,tr,eC,Sy,bT,Cy,V9,GM,Ny,tC,sC,WM,nC,f8;let Yce=(f8=class extends H9{constructor({docId:t,ownerDocument:s=globalThis.document}){super();A(this,be);A(this,kg);A(this,Xb);A(this,hh);A(this,uh);A(this,ar);A(this,Tg);A(this,_g,0);v(this,uh,t),v(this,ar,s)}addFilter(t){if(!t)return"none";let s=l(this,be,tr).get(t);if(s)return s;const[i,r,o]=E(this,be,bT).call(this,t),c=t.length===1?i:`${i}${r}${o}`;if(s=l(this,be,tr).get(c),s)return l(this,be,tr).set(t,s),s;const d=`g_${l(this,uh)}_transfer_map_${vt(this,_g)._++}`,h=E(this,be,Cy).call(this,d);l(this,be,tr).set(t,h),l(this,be,tr).set(c,h);const u=E(this,be,Ny).call(this,d);return E(this,be,sC).call(this,i,r,o,u),h}addHCMFilter(t,s){var x;const i=`${t}-${s}`,r="base";let o=l(this,be,eC).get(r);if((o==null?void 0:o.key)===i||(o?((x=o.filter)==null||x.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},l(this,be,eC).set(r,o)),!t||!s))return o.url;const c=E(this,be,nC).call(this,t);t=_e.makeHexColor(...c);const d=E(this,be,nC).call(this,s);if(s=_e.makeHexColor(...d),l(this,be,Sy).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return o.url;const h=new Array(256);for(let g=0;g<=255;g++){const b=g/255;h[g]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const u=h.join(","),p=`g_${l(this,uh)}_hcm_filter`,f=o.filter=E(this,be,Ny).call(this,p);E(this,be,sC).call(this,u,u,u,f),E(this,be,GM).call(this,f);const m=(g,b)=>{const y=c[g]/255,C=d[g]/255,w=new Array(b+1);for(let S=0;S<=b;S++)w[S]=y+S/b*(C-y);return w.join(",")};return E(this,be,sC).call(this,m(0,5),m(1,5),m(2,5),f),o.url=E(this,be,Cy).call(this,p),o.url}addAlphaFilter(t){let s=l(this,be,tr).get(t);if(s)return s;const[i]=E(this,be,bT).call(this,[t]),r=`alpha_${i}`;if(s=l(this,be,tr).get(r),s)return l(this,be,tr).set(t,s),s;const o=`g_${l(this,uh)}_alpha_map_${vt(this,_g)._++}`,c=E(this,be,Cy).call(this,o);l(this,be,tr).set(t,c),l(this,be,tr).set(r,c);const d=E(this,be,Ny).call(this,o);return E(this,be,WM).call(this,i,d),c}addLuminosityFilter(t){let s=l(this,be,tr).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=E(this,be,bT).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=l(this,be,tr).get(r),s)return l(this,be,tr).set(t,s),s;const o=`g_${l(this,uh)}_luminosity_map_${vt(this,_g)._++}`,c=E(this,be,Cy).call(this,o);l(this,be,tr).set(t,c),l(this,be,tr).set(r,c);const d=E(this,be,Ny).call(this,o);return E(this,be,V9).call(this,d),t&&E(this,be,WM).call(this,i,d),c}addHighlightHCMFilter(t,s,i,r,o){var C;const c=`${s}-${i}-${r}-${o}`;let d=l(this,be,eC).get(t);if((d==null?void 0:d.key)===c||(d?((C=d.filter)==null||C.remove(),d.key=c,d.url="none",d.filter=null):(d={key:c,url:"none",filter:null},l(this,be,eC).set(t,d)),!s||!i))return d.url;const[h,u]=[s,i].map(E(this,be,nC).bind(this));let p=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[m,x]=[r,o].map(E(this,be,nC).bind(this));f<p&&([p,f,m,x]=[f,p,x,m]),l(this,be,Sy).style.color="";const g=(w,S,j)=>{const T=new Array(256),k=(f-p)/j,_=w/255,L=(S-w)/(255*j);let D=0;for(let P=0;P<=j;P++){const I=Math.round(p+P*k),M=_+P*L;for(let O=D;O<=I;O++)T[O]=M;D=I+1}for(let P=D;P<256;P++)T[P]=T[D-1];return T.join(",")},b=`g_${l(this,uh)}_hcm_${t}_filter`,y=d.filter=E(this,be,Ny).call(this,b);return E(this,be,GM).call(this,y),E(this,be,sC).call(this,g(m[0],x[0],5),g(m[1],x[1],5),g(m[2],x[2],5),y),d.url=E(this,be,Cy).call(this,b),d.url}destroy(t=!1){var s,i,r,o;t&&((s=l(this,Tg))!=null&&s.size)||((i=l(this,hh))==null||i.parentNode.parentNode.remove(),v(this,hh,null),(r=l(this,Xb))==null||r.clear(),v(this,Xb,null),(o=l(this,Tg))==null||o.clear(),v(this,Tg,null),v(this,_g,0))}},kg=new WeakMap,Xb=new WeakMap,hh=new WeakMap,uh=new WeakMap,ar=new WeakMap,Tg=new WeakMap,_g=new WeakMap,be=new WeakSet,tr=function(){return l(this,Xb)||v(this,Xb,new Map)},eC=function(){return l(this,Tg)||v(this,Tg,new Map)},Sy=function(){if(!l(this,hh)){const t=l(this,ar).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=l(this,ar).createElementNS(zd,"svg");i.setAttribute("width",0),i.setAttribute("height",0),v(this,hh,l(this,ar).createElementNS(zd,"defs")),t.append(i),i.append(l(this,hh)),l(this,ar).body.append(t)}return l(this,hh)},bT=function(t){if(t.length===1){const h=t[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=h[f]/255;const p=u.join(",");return[p,p,p]}const[s,i,r]=t,o=new Array(256),c=new Array(256),d=new Array(256);for(let h=0;h<256;h++)o[h]=s[h]/255,c[h]=i[h]/255,d[h]=r[h]/255;return[o.join(","),c.join(","),d.join(",")]},Cy=function(t){if(l(this,kg)===void 0){v(this,kg,"");const s=l(this,ar).URL;s!==l(this,ar).baseURI&&(ZL(s)?tt('#createUrl: ignore "data:"-URL for performance reasons.'):v(this,kg,YW(s,"")))}return`url(${l(this,kg)}#${t})`},V9=function(t){const s=l(this,ar).createElementNS(zd,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},GM=function(t){const s=l(this,ar).createElementNS(zd,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},Ny=function(t){const s=l(this,ar).createElementNS(zd,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),l(this,be,Sy).append(s),s},tC=function(t,s,i){const r=l(this,ar).createElementNS(zd,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},sC=function(t,s,i,r){const o=l(this,ar).createElementNS(zd,"feComponentTransfer");r.append(o),E(this,be,tC).call(this,o,"feFuncR",t),E(this,be,tC).call(this,o,"feFuncG",s),E(this,be,tC).call(this,o,"feFuncB",i)},WM=function(t,s){const i=l(this,ar).createElementNS(zd,"feComponentTransfer");s.append(i),E(this,be,tC).call(this,i,"feFuncA",t)},nC=function(t){return l(this,be,Sy).style.color=t,AE(getComputedStyle(l(this,be,Sy)).getPropertyValue("color"))},f8),G9=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Cs("Abstract method `_fetch` called.")}},NU=class extends G9{async _fetch(e){const t=await jE(e,"arraybuffer");return new Uint8Array(t)}},W9=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Cs("Abstract method `_fetch` called.")}},jU=class extends W9{async _fetch(e){const t=await jE(e,"arraybuffer");return new Uint8Array(t)}};Ir&&tt("Please use the `legacy` build in Node.js environments.");async function m3(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}let Xce=class extends H9{},Kce=class extends U9{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}},Qce=class extends z9{async _fetch(e){return m3(e)}},Jce=class extends G9{async _fetch(e){return m3(e)}},Zce=class extends W9{async _fetch(e){return m3(e)}};const my="__forcedDependency",{floor:AU,ceil:EU}=Math;function Nk(n,e,t,s,i,r){n[e*4+0]=Math.min(n[e*4+0],t),n[e*4+1]=Math.min(n[e*4+1],s),n[e*4+2]=Math.max(n[e*4+2],i),n[e*4+3]=Math.max(n[e*4+3],r)}const qM=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var Kb,Ep,m8;let ede=(m8=class{constructor(e,t){A(this,Kb);A(this,Ep);v(this,Kb,e),v(this,Ep,t)}get length(){return l(this,Kb).length}isEmpty(e){return l(this,Kb)[e]===qM}minX(e){return l(this,Ep)[e*4+0]/256}minY(e){return l(this,Ep)[e*4+1]/256}maxX(e){return(l(this,Ep)[e*4+2]+1)/256}maxY(e){return(l(this,Ep)[e*4+3]+1)/256}},Kb=new WeakMap,Ep=new WeakMap,m8);const jk=(n,e)=>{if(!n)return;let t=n.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},n.set(e,t)),t};var Jr,Zr,Pg,Dl,Lg,ph,Wt,ss,fh,ea,Aj,Qb,Dg,Rg,mh,or,Mc,Ej,YM,g8;let tde=(g8=class{constructor(e,t,s=!1){A(this,Ej);A(this,Jr,{__proto__:null});A(this,Zr,{__proto__:null,transform:[],moveText:[],sameLineText:[],[my]:[]});A(this,Pg,new Map);A(this,Dl,[]);A(this,Lg,[]);A(this,ph,[[1,0,0,1,0,0]]);A(this,Wt,[-1/0,-1/0,1/0,1/0]);A(this,ss,new Float64Array([1/0,1/0,-1/0,-1/0]));A(this,fh,-1);A(this,ea,new Set);A(this,Aj,new Map);A(this,Qb,new Map);A(this,Dg);A(this,Rg);A(this,mh);A(this,or);A(this,Mc);v(this,Dg,e.width),v(this,Rg,e.height),E(this,Ej,YM).call(this,t),s&&v(this,Mc,new Map)}growOperationsCount(e){e>=l(this,or).length&&E(this,Ej,YM).call(this,e,l(this,or))}save(e){return v(this,Jr,{__proto__:l(this,Jr)}),v(this,Zr,{__proto__:l(this,Zr),transform:{__proto__:l(this,Zr).transform},moveText:{__proto__:l(this,Zr).moveText},sameLineText:{__proto__:l(this,Zr).sameLineText},[my]:{__proto__:l(this,Zr)[my]}}),v(this,Wt,{__proto__:l(this,Wt)}),l(this,Dl).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(l(this,Jr));if(t===null)return this;v(this,Jr,t),v(this,Zr,Object.getPrototypeOf(l(this,Zr))),v(this,Wt,Object.getPrototypeOf(l(this,Wt)));const s=l(this,Dl).pop();return s!==void 0&&((i=jk(l(this,Mc),e))==null||i.dependencies.add(s),l(this,or)[e]=l(this,or)[s]),this}recordOpenMarker(e){return l(this,Dl).push(e),this}getOpenMarker(){return l(this,Dl).length===0?null:l(this,Dl).at(-1)}recordCloseMarker(e){var s;const t=l(this,Dl).pop();return t!==void 0&&((s=jk(l(this,Mc),e))==null||s.dependencies.add(t),l(this,or)[e]=l(this,or)[t]),this}beginMarkedContent(e){return l(this,Lg).push(e),this}endMarkedContent(e){var s;const t=l(this,Lg).pop();return t!==void 0&&((s=jk(l(this,Mc),e))==null||s.dependencies.add(t),l(this,or)[e]=l(this,or)[t]),this}pushBaseTransform(e){return l(this,ph).push(_e.multiplyByDOMMatrix(l(this,ph).at(-1),e.getTransform())),this}popBaseTransform(){return l(this,ph).length>1&&l(this,ph).pop(),this}recordSimpleData(e,t){return l(this,Jr)[e]=t,this}recordIncrementalData(e,t){return l(this,Zr)[e].push(t),this}resetIncrementalData(e,t){return l(this,Zr)[e].length=0,this}recordNamedData(e,t){return l(this,Pg).set(e,t),this}recordSimpleDataFromNamed(e,t,s){l(this,Jr)[e]=l(this,Pg).get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(my,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in l(this,Jr)&&this.recordFutureForcedDependency(t,l(this,Jr)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of l(this,ea))this.recordFutureForcedDependency(my,e);return this}resetBBox(e){return l(this,fh)!==e&&(v(this,fh,e),l(this,ss)[0]=1/0,l(this,ss)[1]=1/0,l(this,ss)[2]=-1/0,l(this,ss)[3]=-1/0),this}recordClipBox(e,t,s,i,r,o){const c=_e.multiplyByDOMMatrix(l(this,ph).at(-1),t.getTransform()),d=[1/0,1/0,-1/0,-1/0];_e.axialAlignedBoundingBox([s,r,i,o],c,d);const h=_e.intersect(l(this,Wt),d);return h?(l(this,Wt)[0]=h[0],l(this,Wt)[1]=h[1],l(this,Wt)[2]=h[2],l(this,Wt)[3]=h[3]):(l(this,Wt)[0]=l(this,Wt)[1]=1/0,l(this,Wt)[2]=l(this,Wt)[3]=-1/0),this}recordBBox(e,t,s,i,r,o){const c=l(this,Wt);if(c[0]===1/0)return this;const d=_e.multiplyByDOMMatrix(l(this,ph).at(-1),t.getTransform());if(c[0]===-1/0)return _e.axialAlignedBoundingBox([s,r,i,o],d,l(this,ss)),this;const h=[1/0,1/0,-1/0,-1/0];return _e.axialAlignedBoundingBox([s,r,i,o],d,h),l(this,ss)[0]=Math.min(l(this,ss)[0],Math.max(h[0],c[0])),l(this,ss)[1]=Math.min(l(this,ss)[1],Math.max(h[1],c[1])),l(this,ss)[2]=Math.max(l(this,ss)[2],Math.min(h[2],c[2])),l(this,ss)[3]=Math.max(l(this,ss)[3],Math.min(h[3],c[3])),this}recordCharacterBBox(e,t,s,i=1,r=0,o=0,c){const d=s.bbox;let h,u;if(d&&(h=d[2]!==d[0]&&d[3]!==d[1]&&l(this,Qb).get(s),h!==!1&&(u=[0,0,0,0],_e.axialAlignedBoundingBox(d,s.fontMatrix,u),(i!==1||r!==0||o!==0)&&_e.scaleMinMax([i,0,0,-i,r,o],u),h)))return this.recordBBox(e,t,u[0],u[2],u[1],u[3]);if(!c)return this.recordFullPageBBox(e);const p=c();return d&&u&&h===void 0&&(h=u[0]<=r-p.actualBoundingBoxLeft&&u[2]>=r+p.actualBoundingBoxRight&&u[1]<=o-p.actualBoundingBoxAscent&&u[3]>=o+p.actualBoundingBoxDescent,l(this,Qb).set(s,h),h)?this.recordBBox(e,t,u[0],u[2],u[1],u[3]):this.recordBBox(e,t,r-p.actualBoundingBoxLeft,r+p.actualBoundingBoxRight,o-p.actualBoundingBoxAscent,o+p.actualBoundingBoxDescent)}recordFullPageBBox(e){return l(this,ss)[0]=Math.max(0,l(this,Wt)[0]),l(this,ss)[1]=Math.max(0,l(this,Wt)[1]),l(this,ss)[2]=Math.min(l(this,Dg),l(this,Wt)[2]),l(this,ss)[3]=Math.min(l(this,Rg),l(this,Wt)[3]),this}getSimpleIndex(e){return l(this,Jr)[e]}recordDependencies(e,t){const s=l(this,ea),i=l(this,Jr),r=l(this,Zr);for(const o of t)o in l(this,Jr)?s.add(i[o]):o in r&&r[o].forEach(s.add,s);return this}recordNamedDependency(e,t){return l(this,Pg).has(t)&&l(this,ea).add(l(this,Pg).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[my]),l(this,Mc)){const s=jk(l(this,Mc),e),{dependencies:i}=s;l(this,ea).forEach(i.add,i),l(this,Dl).forEach(i.add,i),l(this,Lg).forEach(i.add,i),i.delete(e),s.isRenderingOperation=!0}if(l(this,fh)===e){const s=AU(l(this,ss)[0]*256/l(this,Dg)),i=AU(l(this,ss)[1]*256/l(this,Rg)),r=EU(l(this,ss)[2]*256/l(this,Dg)),o=EU(l(this,ss)[3]*256/l(this,Rg));Nk(l(this,mh),e,s,i,r,o);for(const c of l(this,ea))c!==e&&Nk(l(this,mh),c,s,i,r,o);for(const c of l(this,Dl))c!==e&&Nk(l(this,mh),c,s,i,r,o);for(const c of l(this,Lg))c!==e&&Nk(l(this,mh),c,s,i,r,o);t||(l(this,ea).clear(),v(this,fh,-1))}return this}recordShowTextOperation(e,t=!1){const s=Array.from(l(this,ea));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return l(this,fh)===e&&(v(this,fh,-1),l(this,Wt)[0]=Math.max(l(this,Wt)[0],l(this,ss)[0]),l(this,Wt)[1]=Math.max(l(this,Wt)[1],l(this,ss)[1]),l(this,Wt)[2]=Math.min(l(this,Wt)[2],l(this,ss)[2]),l(this,Wt)[3]=Math.min(l(this,Wt)[3],l(this,ss)[3]),t||l(this,ea).clear()),this}_takePendingDependencies(){const e=l(this,ea);return v(this,ea,new Set),e}_extractOperation(e){const t=l(this,Aj).get(e);return l(this,Aj).delete(e),t}_pushPendingDependencies(e){for(const t of e)l(this,ea).add(t)}take(){return l(this,Qb).clear(),new ede(l(this,or),l(this,mh))}takeDebugMetadata(){return l(this,Mc)}},Jr=new WeakMap,Zr=new WeakMap,Pg=new WeakMap,Dl=new WeakMap,Lg=new WeakMap,ph=new WeakMap,Wt=new WeakMap,ss=new WeakMap,fh=new WeakMap,ea=new WeakMap,Aj=new WeakMap,Qb=new WeakMap,Dg=new WeakMap,Rg=new WeakMap,mh=new WeakMap,or=new WeakMap,Mc=new WeakMap,Ej=new WeakSet,YM=function(e,t){const s=new ArrayBuffer(e*4);v(this,mh,new Uint8ClampedArray(s)),v(this,or,new Uint32Array(s)),t&&t.length>0?(l(this,or).set(t),l(this,or).fill(qM,t.length)):l(this,or).fill(qM)},g8);var ms,cn,Rl,Jb,Zb,ev;let kU=(ev=class{constructor(e,t,s){A(this,ms);A(this,cn);A(this,Rl);A(this,Jb,0);A(this,Zb,0);if(e instanceof ev&&l(e,Rl)===!!s)return e;v(this,ms,e),v(this,cn,t),v(this,Rl,!!s)}growOperationsCount(){throw new Error("Unreachable")}save(e){return vt(this,Zb)._++,l(this,ms).save(l(this,cn)),this}restore(e){return l(this,Zb)>0&&(l(this,ms).restore(l(this,cn)),vt(this,Zb)._--),this}recordOpenMarker(e){return vt(this,Jb)._++,this}getOpenMarker(){return l(this,Jb)>0?l(this,cn):l(this,ms).getOpenMarker()}recordCloseMarker(e){return vt(this,Jb)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return l(this,ms).pushBaseTransform(e),this}popBaseTransform(){return l(this,ms).popBaseTransform(),this}recordSimpleData(e,t){return l(this,ms).recordSimpleData(e,l(this,cn)),this}recordIncrementalData(e,t){return l(this,ms).recordIncrementalData(e,l(this,cn)),this}resetIncrementalData(e,t){return l(this,ms).resetIncrementalData(e,l(this,cn)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return l(this,ms).recordSimpleDataFromNamed(e,t,l(this,cn)),this}recordFutureForcedDependency(e,t){return l(this,ms).recordFutureForcedDependency(e,l(this,cn)),this}inheritSimpleDataAsFutureForcedDependencies(e){return l(this,ms).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return l(this,ms).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return l(this,Rl)||l(this,ms).resetBBox(l(this,cn)),this}recordClipBox(e,t,s,i,r,o){return l(this,Rl)||l(this,ms).recordClipBox(l(this,cn),t,s,i,r,o),this}recordBBox(e,t,s,i,r,o){return l(this,Rl)||l(this,ms).recordBBox(l(this,cn),t,s,i,r,o),this}recordCharacterBBox(e,t,s,i,r,o,c){return l(this,Rl)||l(this,ms).recordCharacterBBox(l(this,cn),t,s,i,r,o,c),this}recordFullPageBBox(e){return l(this,Rl)||l(this,ms).recordFullPageBBox(l(this,cn)),this}getSimpleIndex(e){return l(this,ms).getSimpleIndex(e)}recordDependencies(e,t){return l(this,ms).recordDependencies(l(this,cn),t),this}recordNamedDependency(e,t){return l(this,ms).recordNamedDependency(l(this,cn),t),this}recordOperation(e){return l(this,ms).recordOperation(l(this,cn),!0),this}recordShowTextOperation(e){return l(this,ms).recordShowTextOperation(l(this,cn),!0),this}bboxToClipBoxDropOperation(e){return l(this,Rl)||l(this,ms).bboxToClipBoxDropOperation(l(this,cn),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}},ms=new WeakMap,cn=new WeakMap,Rl=new WeakMap,Jb=new WeakMap,Zb=new WeakMap,ev);const _o={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Ui={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function XM(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),n.clip(i)}let g3=class{isModifyingCurrentTransform(){return!1}getPattern(){Cs("Abstract method `getPattern` called.")}},sde=class extends g3{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let r;if(i===Ui.STROKE||i===Ui.FILL){const o=t.current.getClippedPathBoundingBox(i,Qs(e))||[0,0,0,0],c=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,h=t.cachedCanvases.getCanvas("pattern",c,d),u=h.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),s=_e.transform(s,[1,0,0,1,o[0],o[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),XM(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),r=e.createPattern(h.canvas,"no-repeat");const p=new DOMMatrix(s);r.setTransform(p)}else XM(e,this._bbox),r=this._createGradient(e);return r}};function xR(n,e,t,s,i,r,o,c){const d=e.coords,h=e.colors,u=n.data,p=n.width*4;let f;d[t+1]>d[s+1]&&(f=t,t=s,s=f,f=r,r=o,o=f),d[s+1]>d[i+1]&&(f=s,s=i,i=f,f=o,o=c,c=f),d[t+1]>d[s+1]&&(f=t,t=s,s=f,f=r,r=o,o=f);const m=(d[t]+e.offsetX)*e.scaleX,x=(d[t+1]+e.offsetY)*e.scaleY,g=(d[s]+e.offsetX)*e.scaleX,b=(d[s+1]+e.offsetY)*e.scaleY,y=(d[i]+e.offsetX)*e.scaleX,C=(d[i+1]+e.offsetY)*e.scaleY;if(x>=C)return;const w=h[r],S=h[r+1],j=h[r+2],T=h[o],k=h[o+1],_=h[o+2],L=h[c],D=h[c+1],P=h[c+2],I=Math.round(x),M=Math.round(C);let O,F,B,U,$,G,ne,Z;for(let K=I;K<=M;K++){if(K<b){const ie=K<x?0:(x-K)/(x-b);O=m-(m-g)*ie,F=w-(w-T)*ie,B=S-(S-k)*ie,U=j-(j-_)*ie}else{let ie;K>C?ie=1:b===C?ie=0:ie=(b-K)/(b-C),O=g-(g-y)*ie,F=T-(T-L)*ie,B=k-(k-D)*ie,U=_-(_-P)*ie}let X;K<x?X=0:K>C?X=1:X=(x-K)/(x-C),$=m-(m-y)*X,G=w-(w-L)*X,ne=S-(S-D)*X,Z=j-(j-P)*X;const V=Math.round(Math.min(O,$)),q=Math.round(Math.max(O,$));let ee=p*K+V*4;for(let ie=V;ie<=q;ie++)X=(O-ie)/(O-$),X<0?X=0:X>1&&(X=1),u[ee++]=F-(F-G)*X|0,u[ee++]=B-(B-ne)*X|0,u[ee++]=U-(U-Z)*X|0,u[ee++]=255}}function nde(n,e,t){const s=e.coords,i=e.colors;let r,o;switch(e.type){case wM.LATTICE:const c=e.verticesPerRow,d=Math.floor(s.length/c)-1,h=c-1;for(r=0;r<d;r++){let u=r*c;for(let p=0;p<h;p++,u++)xR(n,t,s[u],s[u+1],s[u+c],i[u],i[u+1],i[u+c]),xR(n,t,s[u+c+1],s[u+1],s[u+c],i[u+c+1],i[u+1],i[u+c])}break;case wM.TRIANGLES:for(r=0,o=s.length;r<o;r+=3)xR(n,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}let ide=class extends g3{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const c=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-c,u=Math.ceil(this._bounds[3])-d,p=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),m=h/p,x=u/f,g={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-d,scaleX:1/m,scaleY:1/x},b=p+2*2,y=f+2*2,C=s.getCanvas("mesh",b,y),w=C.context,S=w.createImageData(p,f);if(t){const T=S.data;for(let k=0,_=T.length;k<_;k+=4)T[k]=t[0],T[k+1]=t[1],T[k+2]=t[2],T[k+3]=255}for(const T of this._figures)nde(S,T,g);return w.putImageData(S,2,2),{canvas:C.canvas,offsetX:c-2*m,offsetY:d-2*x,scaleX:m,scaleY:x}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){XM(e,this._bbox);const r=new Float32Array(2);if(i===Ui.SHADING)_e.singularValueDecompose2dScale(Qs(e),r);else if(this.matrix){_e.singularValueDecompose2dScale(this.matrix,r);const[c,d]=r;_e.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=c,r[1]*=d}else _e.singularValueDecompose2dScale(t.baseTransform,r);const o=this._createMeshCanvas(r,i===Ui.SHADING?null:this._background,t.cachedCanvases);return i!==Ui.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}},rde=class extends g3{getPattern(){return"hotpink"}};function ade(n){switch(n[0]){case"RadialAxial":return new sde(n);case"Mesh":return new ide(n);case"Dummy":return new rde}throw new Error(`Unknown IR type: ${n[0]}`)}const TU={COLORED:1,UNCOLORED:2};var Ig;let ode=(Ig=class{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e,t){var G,ne;const{bbox:s,operatorList:i,paintType:r,tilingType:o,color:c,canvasGraphicsFactory:d}=this;let{xstep:h,ystep:u}=this;h=Math.abs(h),u=Math.abs(u),JL("TilingType: "+o);const p=s[0],f=s[1],m=s[2],x=s[3],g=m-p,b=x-f,y=new Float32Array(2);_e.singularValueDecompose2dScale(this.matrix,y);const[C,w]=y;_e.singularValueDecompose2dScale(this.baseTransform,y);const S=C*y[0],j=w*y[1];let T=g,k=b,_=!1,L=!1;const D=Math.ceil(h*S),P=Math.ceil(u*j),I=Math.ceil(g*S),M=Math.ceil(b*j);D>=I?T=h:_=!0,P>=M?k=u:L=!0;const O=this.getSizeAndScale(T,this.ctx.canvas.width,S),F=this.getSizeAndScale(k,this.ctx.canvas.height,j),B=e.cachedCanvases.getCanvas("pattern",O.size,F.size),U=B.context,$=d.createCanvasGraphics(U,t);if($.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext($,r,c),U.translate(-O.scale*p,-F.scale*f),$.transform(0,O.scale,0,0,F.scale,0,0),U.save(),(G=$.dependencyTracker)==null||G.save(),this.clipBbox($,p,f,m,x),$.baseTransform=Qs($.ctx),$.executeOperatorList(i),$.endDrawing(),(ne=$.dependencyTracker)==null||ne.restore(),U.restore(),_||L){const Z=B.canvas;_&&(T=h),L&&(k=u);const K=this.getSizeAndScale(T,this.ctx.canvas.width,S),X=this.getSizeAndScale(k,this.ctx.canvas.height,j),V=K.size,q=X.size,ee=e.cachedCanvases.getCanvas("pattern-workaround",V,q),ie=ee.context,Re=_?Math.floor(g/h):0,Ye=L?Math.floor(b/u):0;for(let Le=0;Le<=Re;Le++)for(let te=0;te<=Ye;te++)ie.drawImage(Z,V*Le,q*te,V,q,0,0,V,q);return{canvas:ee.canvas,scaleX:K.scale,scaleY:X.scale,offsetX:p,offsetY:f}}return{canvas:B.canvas,scaleX:O.scale,scaleY:F.scale,offsetX:p,offsetY:f}}getSizeAndScale(e,t,s){const i=Math.max(Ig.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const o=i-t,c=r-s;e.ctx.rect(t,s,o,c),_e.axialAlignedBoundingBox([t,s,i,r],Qs(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case TU.COLORED:const{fillStyle:o,strokeStyle:c}=this.ctx;i.fillStyle=r.fillColor=o,i.strokeStyle=r.strokeColor=c;break;case TU.UNCOLORED:i.fillStyle=i.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new mce(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i,r){let o=s;i!==Ui.SHADING&&(o=_e.transform(o,t.baseTransform),this.matrix&&(o=_e.transform(o,this.matrix)));const c=this.createPatternCanvas(t,r);let d=new DOMMatrix(o);d=d.translate(c.offsetX,c.offsetY),d=d.scale(1/c.scaleX,1/c.scaleY);const h=e.createPattern(c.canvas,"repeat");return h.setTransform(d),h}},W(Ig,"MAX_PATTERN_SIZE",3e3),Ig);function lde({src:n,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const c=Yi.isLittleEndian?4278190080:255,[d,h]=o?[r,c]:[c,r],u=s>>3,p=s&7,f=n.length;t=new Uint32Array(t.buffer);let m=0;for(let x=0;x<i;x++){for(const b=e+u;e<b;e++){const y=e<f?n[e]:255;t[m++]=y&128?h:d,t[m++]=y&64?h:d,t[m++]=y&32?h:d,t[m++]=y&16?h:d,t[m++]=y&8?h:d,t[m++]=y&4?h:d,t[m++]=y&2?h:d,t[m++]=y&1?h:d}if(p===0)continue;const g=e<f?n[e++]:255;for(let b=0;b<p;b++)t[m++]=g&1<<7-b?h:d}return{srcPos:e,destPos:m}}const _U=16,PU=100,cde=15,LU=10,ua=16,yR=new DOMMatrix,co=new Float32Array(2),tb=new Float32Array([1/0,1/0,-1/0,-1/0]);function dde(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},n.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},n.transform=function(t,s,i,r,o,c){e.transform(t,s,i,r,o,c),this.__originalTransform(t,s,i,r,o,c)},n.setTransform=function(t,s,i,r,o,c){e.setTransform(t,s,i,r,o,c),this.__originalSetTransform(t,s,i,r,o,c)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(t){e.rotate(t),this.__originalRotate(t)},n.clip=function(t){e.clip(t),this.__originalClip(t)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,i,r,o,c){e.bezierCurveTo(t,s,i,r,o,c),this.__originalBezierCurveTo(t,s,i,r,o,c)},n.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}let hde=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Ak(n,e,t,s,i,r,o,c,d,h){const[u,p,f,m,x,g]=Qs(n);if(p===0&&f===0){const C=o*u+x,w=Math.round(C),S=c*m+g,j=Math.round(S),T=(o+d)*u+x,k=Math.abs(Math.round(T)-w)||1,_=(c+h)*m+g,L=Math.abs(Math.round(_)-j)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(m),w,j),n.drawImage(e,t,s,i,r,0,0,k,L),n.setTransform(u,p,f,m,x,g),[k,L]}if(u===0&&m===0){const C=c*f+x,w=Math.round(C),S=o*p+g,j=Math.round(S),T=(c+h)*f+x,k=Math.abs(Math.round(T)-w)||1,_=(o+d)*p+g,L=Math.abs(Math.round(_)-j)||1;return n.setTransform(0,Math.sign(p),Math.sign(f),0,w,j),n.drawImage(e,t,s,i,r,0,0,L,k),n.setTransform(u,p,f,m,x,g),[L,k]}n.drawImage(e,t,s,i,r,o,c,d,h);const b=Math.hypot(u,p),y=Math.hypot(f,m);return[b*d,y*h]}let DU=class{constructor(e,t,s){W(this,"alphaIsShape",!1);W(this,"fontSize",0);W(this,"fontSizeScale",1);W(this,"textMatrix",null);W(this,"textMatrixScale",1);W(this,"fontMatrix",vM);W(this,"leading",0);W(this,"x",0);W(this,"y",0);W(this,"lineX",0);W(this,"lineY",0);W(this,"charSpacing",0);W(this,"wordSpacing",0);W(this,"textHScale",1);W(this,"textRenderingMode",Ai.FILL);W(this,"textRise",0);W(this,"fillColor","#000000");W(this,"strokeColor","#000000");W(this,"patternFill",!1);W(this,"patternStroke",!1);W(this,"fillAlpha",1);W(this,"strokeAlpha",1);W(this,"lineWidth",1);W(this,"activeSMask",null);W(this,"transferMaps","none");s==null||s(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=tb.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Ui.FILL,t=null){const s=this.minMax.slice();if(e===Ui.STROKE){t||Cs("Stroke bounding box must include transform."),_e.singularValueDecompose2dScale(t,co);const i=co[0]*this.lineWidth/2,r=co[1]*this.lineWidth/2;s[0]-=i,s[1]-=r,s[2]+=i,s[3]+=r}return s}updateClipFromPath(){const e=_e.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(tb,0)}getClippedPathBoundingBox(e=Ui.FILL,t=null){return _e.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function RU(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%ua,r=(t-i)/ua,o=i===0?r:r+1,c=n.createImageData(s,ua);let d=0,h;const u=e.data,p=c.data;let f,m,x,g;if(e.kind===cT.GRAYSCALE_1BPP){const b=u.byteLength,y=new Uint32Array(p.buffer,0,p.byteLength>>2),C=y.length,w=s+7>>3,S=4294967295,j=Yi.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(x=f<r?ua:i,h=0,m=0;m<x;m++){const T=b-d;let k=0;const _=T>w?s:T*8-7,L=_&-8;let D=0,P=0;for(;k<L;k+=8)P=u[d++],y[h++]=P&128?S:j,y[h++]=P&64?S:j,y[h++]=P&32?S:j,y[h++]=P&16?S:j,y[h++]=P&8?S:j,y[h++]=P&4?S:j,y[h++]=P&2?S:j,y[h++]=P&1?S:j;for(;k<_;k++)D===0&&(P=u[d++],D=128),y[h++]=P&D?S:j,D>>=1}for(;h<C;)y[h++]=0;n.putImageData(c,0,f*ua)}}else if(e.kind===cT.RGBA_32BPP){for(m=0,g=s*ua*4,f=0;f<r;f++)p.set(u.subarray(d,d+g)),d+=g,n.putImageData(c,0,m),m+=ua;f<o&&(g=s*i*4,p.set(u.subarray(d,d+g)),n.putImageData(c,0,m))}else if(e.kind===cT.RGB_24BPP)for(x=ua,g=s*x,f=0;f<o;f++){for(f>=r&&(x=i,g=s*x),h=0,m=g;m--;)p[h++]=u[d++],p[h++]=u[d++],p[h++]=u[d++],p[h++]=255;n.putImageData(c,0,f*ua)}else throw new Error(`bad image kind: ${e.kind}`)}function IU(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%ua,r=(t-i)/ua,o=i===0?r:r+1,c=n.createImageData(s,ua);let d=0;const h=e.data,u=c.data;for(let p=0;p<o;p++){const f=p<r?ua:i;({srcPos:d}=lde({src:h,srcPos:d,dest:u,width:s,height:f,nonBlackColor:0})),n.putImageData(c,0,p*ua)}}function wS(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Ek(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}function MU(n,e){if(e)return!0;_e.singularValueDecompose2dScale(n,co);const t=Math.fround(K0.pixelRatio*M1.PDF_TO_CSS_UNITS);return co[0]<=t&&co[1]<=t}const ude=["butt","round","square"],pde=["miter","round","bevel"],fde={},FU={};var dc,KM,QM,JM,tv;let vT=(tv=class{constructor(e,t,s,i,r,{optionalContentConfig:o,markedContentStack:c=null},d,h,u){A(this,dc);this.ctx=e,this.current=new DU(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=o,this.cachedCanvases=new hde(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=u??null}getObject(e,t,s=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=c,s){const d=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...Qs(this.compositeCtx))}this.ctx.save(),Ek(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Qs(this.ctx)}executeOperatorList(e,t,s,i,r){var y;const o=e.argsArray,c=e.fnArray;let d=t||0;const h=o.length;if(h===d)return d;const u=h-d>LU&&typeof s=="function",p=u?Date.now()+cde:0;let f=0;const m=this.commonObjs,x=this.objs;let g,b;for(;;){if(i!==void 0&&d===i.nextBreakPoint)return i.breakIt(d,s),d;if(!r||r(d))if(g=c[d],b=o[d]??null,g!==PN.dependency)b===null?this[g](d):this[g](d,...b);else for(const C of b){(y=this.dependencyTracker)==null||y.recordNamedData(C,d);const w=C.startsWith("g_")?m:x;if(!w.has(C))return w.get(C,s),d}if(d++,d===h)return d;if(u&&++f>LU){if(Date.now()>p)return s(),d;f=0}}}endDrawing(){E(this,dc,KM).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),E(this,dc,QM).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),c=s,d=i,h="prescale1",u,p;for(;r>2&&c>1||o>2&&d>1;){let f=c,m=d;r>2&&c>1&&(f=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),r/=c/f),o>2&&d>1&&(m=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/m),u=this.cachedCanvases.getCanvas(h,f,m),p=u.context,p.clearRect(0,0,f,m),p.drawImage(e,0,0,c,d,0,0,f,m),e=u.canvas,c=f,d=m,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:c,paintHeight:d}}_createMaskCanvas(e,t){var D,P;const s=this.ctx,{width:i,height:r}=t,o=this.current.fillColor,c=this.current.patternFill,d=Qs(s);let h,u,p,f;if((t.bitmap||t.data)&&t.count>1){const I=t.bitmap||t.data.buffer;u=JSON.stringify(c?d:[d.slice(0,4),o]),h=this._cachedBitmapsMap.get(I),h||(h=new Map,this._cachedBitmapsMap.set(I,h));const M=h.get(u);if(M&&!c){const O=Math.round(Math.min(d[0],d[2])+d[4]),F=Math.round(Math.min(d[1],d[3])+d[5]);return(D=this.dependencyTracker)==null||D.recordDependencies(e,_o.transformAndFill),{canvas:M,offsetX:O,offsetY:F}}p=M}p||(f=this.cachedCanvases.getCanvas("maskCanvas",i,r),IU(f.context,t));let m=_e.transform(d,[1/i,0,0,-1/r,0,0]);m=_e.transform(m,[1,0,0,1,0,-r]);const x=tb.slice();_e.axialAlignedBoundingBox([0,0,i,r],m,x);const[g,b,y,C]=x,w=Math.round(y-g)||1,S=Math.round(C-b)||1,j=this.cachedCanvases.getCanvas("fillCanvas",w,S),T=j.context,k=g,_=b;T.translate(-k,-_),T.transform(...m),p||(p=this._scaleImage(f.canvas,xc(T)),p=p.img,h&&c&&h.set(u,p)),T.imageSmoothingEnabled=MU(Qs(T),t.interpolate),Ak(T,p,0,0,p.width,p.height,0,0,i,r),T.globalCompositeOperation="source-in";const L=_e.transform(xc(T),[1,0,0,1,-k,-_]);return T.fillStyle=c?o.getPattern(s,this,L,Ui.FILL,e):o,T.fillRect(0,0,i,r),h&&!c&&(this.cachedCanvases.delete("fillCanvas"),h.set(u,j.canvas)),(P=this.dependencyTracker)==null||P.recordDependencies(e,_o.transformAndFill),{canvas:j.canvas,offsetX:Math.round(k),offsetY:Math.round(_)}}setLineWidth(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineCap",e),this.ctx.lineCap=ude[t]}setLineJoin(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineJoin",e),this.ctx.lineJoin=pde[t]}setMiterLimit(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var s,i,r,o,c;for(const[d,h]of t)switch(d){case"LW":this.setLineWidth(e,h);break;case"LC":this.setLineCap(e,h);break;case"LJ":this.setLineJoin(e,h);break;case"ML":this.setMiterLimit(e,h);break;case"D":this.setDash(e,h[0],h[1]);break;case"RI":this.setRenderingIntent(e,h);break;case"FL":this.setFlatness(e,h);break;case"Font":this.setFont(e,h[0],h[1]);break;case"CA":(s=this.dependencyTracker)==null||s.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=h;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=h;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=h;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=h?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(c=this.dependencyTracker)==null||c.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(h);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,t,s);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),wS(this.suspendedCtx,o),dde(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),wS(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],o=i[1],c=i[2]-r,d=i[3]-o;c===0||d===0||(this.genericComposeSMask(t.context,s,c,d,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,o,c,d,h,u,p){let f=e.canvas,m=d-u,x=h-p;if(o)if(m<0||x<0||m+s>f.width||x+i>f.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,i),y=b.context;y.drawImage(f,-m,-x),y.globalCompositeOperation="destination-atop",y.fillStyle=o,y.fillRect(0,0,s,i),y.globalCompositeOperation="source-over",f=b.canvas,m=x=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(m,x,s,i),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(m,x,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&c?t.filter=this.filterFactory.addAlphaFilter(c):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(c));const g=new Path2D;g.rect(d,h,s,i),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(f,m,x,s,i,d,h,s,i),t.restore()}save(e){var s;this.inSMaskMode&&wS(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(s=this.dependencyTracker)==null||s.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&wS(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,r,o,c){var d;(d=this.dependencyTracker)==null||d.recordIncrementalData("transform",e),this.ctx.transform(t,s,i,r,o,c),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,i){let[r]=s;if(!i){r||(r=s[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const o=t===PN.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-o,i[2]+o,i[1]-o,i[3]+o).recordDependencies(e,["transform"])}r instanceof Path2D||(r=s[0]=s9(r)),_e.axialAlignedBoundingBox(i,Qs(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){var o;const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const c=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,xc(i),Ui.STROKE,e),c){const d=new Path2D;d.addPath(t,i.getTransform().invertSelf().multiplySelf(c)),t=d}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,_o.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Ui.STROKE,Qs(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){var h,u,p;const i=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let c=!1;if(o){const f=r.isModifyingCurrentTransform()?i.getTransform():null;if((h=this.dependencyTracker)==null||h.save(e),i.save(),i.fillStyle=r.getPattern(i,this,xc(i),Ui.FILL,e),f){const m=new Path2D;m.addPath(t,i.getTransform().invertSelf().multiplySelf(f)),t=m}c=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(u=this.dependencyTracker)==null||u.recordDependencies(e,_o.fill),c&&(i.restore(),(p=this.dependencyTracker)==null||p.restore(e)),s&&this.consumePath(e,t,d)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var s;this.ctx.fill(t),(s=this.dependencyTracker)==null||s.recordDependencies(e,_o.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=fde}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=FU}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,r=s.getTransform().invertSelf();for(const{transform:o,x:c,y:d,fontSize:h,path:u}of t)u&&i.addPath(u,new DOMMatrix(o).preMultiplySelf(r).translate(c,d).scale(h,-h));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){var p,f;(p=this.dependencyTracker)==null||p.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),r=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=i.fontMatrix||vM,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&tt("Invalid font matrix for font "+t),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const o=i.loadedName||"sans-serif",c=((f=i.systemFontInfo)==null?void 0:f.css)||`"${o}", ${i.fallbackName}`;let d="normal";i.black?d="900":i.bold&&(d="bold");const h=i.italic?"italic":"normal";let u=s;s<_U?u=_U:s>PU&&(u=PU),this.current.fontSizeScale=s/u,this.ctx.font=`${h} ${d} ${u}px ${c}`}setTextRenderingMode(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,s,i,r,o){var y,C,w,S;const c=this.ctx,d=this.current,h=d.font,u=d.textRenderingMode,p=d.fontSize/d.fontSizeScale,f=u&Ai.FILL_STROKE_MASK,m=!!(u&Ai.ADD_TO_PATH_FLAG),x=d.patternFill&&!h.missingFile,g=d.patternStroke&&!h.missingFile;let b;if((h.disableFontFace||m||x||g)&&!h.missingFile&&(b=h.getPathGenerator(this.commonObjs,t)),b&&(h.disableFontFace||x||g)){c.save(),c.translate(s,i),c.scale(p,-p),(y=this.dependencyTracker)==null||y.recordCharacterBBox(e,c,h);let j;if(f===Ai.FILL||f===Ai.FILL_STROKE)if(r){j=c.getTransform(),c.setTransform(...r);const T=E(this,dc,JM).call(this,b,j,r);c.fill(T)}else c.fill(b);if(f===Ai.STROKE||f===Ai.FILL_STROKE)if(o){j||(j=c.getTransform()),c.setTransform(...o);const{a:T,b:k,c:_,d:L}=j,D=_e.inverseTransform(o),P=_e.transform([T,k,_,L,0,0],D);_e.singularValueDecompose2dScale(P,co),c.lineWidth*=Math.max(co[0],co[1])/p,c.stroke(E(this,dc,JM).call(this,b,j,o))}else c.lineWidth/=p,c.stroke(b);c.restore()}else(f===Ai.FILL||f===Ai.FILL_STROKE)&&(c.fillText(t,s,i),(C=this.dependencyTracker)==null||C.recordCharacterBBox(e,c,h,p,s,i,()=>c.measureText(t))),(f===Ai.STROKE||f===Ai.FILL_STROKE)&&(this.dependencyTracker&&((w=this.dependencyTracker)==null||w.recordCharacterBBox(e,c,h,p,s,i,()=>c.measureText(t)).recordDependencies(e,_o.stroke)),c.strokeText(t,s,i));m&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Qs(c),x:s,y:i,fontSize:p,path:b}),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,c,h,p,s,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return ot(this,"isFontSubpixelAAEnabled",s)}showText(e,t){var _,L,D,P;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,_o.showText).resetBBox(e),this.current.textRenderingMode&Ai.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(e,t),(_=this.dependencyTracker)==null||_.recordShowTextOperation(e);return}const r=s.fontSize;if(r===0){(L=this.dependencyTracker)==null||L.recordOperation(e);return}const o=this.ctx,c=s.fontSizeScale,d=s.charSpacing,h=s.wordSpacing,u=s.fontDirection,p=s.textHScale*u,f=t.length,m=i.vertical,x=m?1:-1,g=i.defaultVMetrics,b=r*s.fontMatrix[0],y=s.textRenderingMode===Ai.FILL&&!i.disableFontFace&&!s.patternFill;o.save(),s.textMatrix&&o.transform(...s.textMatrix),o.translate(s.x,s.y+s.textRise),u>0?o.scale(p,-1):o.scale(p,1);let C,w;if(s.patternFill){o.save();const I=s.fillColor.getPattern(o,this,xc(o),Ui.FILL,e);C=Qs(o),o.restore(),o.fillStyle=I}if(s.patternStroke){o.save();const I=s.strokeColor.getPattern(o,this,xc(o),Ui.STROKE,e);w=Qs(o),o.restore(),o.strokeStyle=I}let S=s.lineWidth;const j=s.textMatrixScale;if(j===0||S===0){const I=s.textRenderingMode&Ai.FILL_STROKE_MASK;(I===Ai.STROKE||I===Ai.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=j;if(c!==1&&(o.scale(c,c),S/=c),o.lineWidth=S,i.isInvalidPDFjsFont){const I=[];let M=0;for(const F of t)I.push(F.unicode),M+=F.width;const O=I.join("");if(o.fillText(O,0,0),this.dependencyTracker!==null){const F=o.measureText(O);this.dependencyTracker.recordBBox(e,this.ctx,-F.actualBoundingBoxLeft,F.actualBoundingBoxRight,-F.actualBoundingBoxAscent,F.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=M*b*p,o.restore(),this.compose();return}let T=0,k;for(k=0;k<f;++k){const I=t[k];if(typeof I=="number"){T+=x*I*r/1e3;continue}let M=!1;const O=(I.isSpace?h:0)+d,F=I.fontChar,B=I.accent;let U,$,G=I.width;if(m){const K=I.vmetric||g,X=-(I.vmetric?K[1]:G*.5)*b,V=K[2]*b;G=K?-K[0]:G,U=X/c,$=(T+V)/c}else U=T/c,$=0;let ne;if(i.remeasure&&G>0){ne=o.measureText(F);const K=ne.width*1e3/r*c;if(G<K&&this.isFontSubpixelAAEnabled){const X=G/K;M=!0,o.save(),o.scale(X,1),U/=X}else G!==K&&(U+=(G-K)/2e3*r/c)}if(this.contentVisible&&(I.isInFont||i.missingFile)){if(y&&!B)o.fillText(F,U,$),(D=this.dependencyTracker)==null||D.recordCharacterBBox(e,o,ne?{bbox:null}:i,r/c,U,$,()=>ne??o.measureText(F));else if(this.paintChar(e,F,U,$,C,w),B){const K=U+r*B.offset.x/c,X=$-r*B.offset.y/c;this.paintChar(e,B.fontChar,K,X,C,w)}}const Z=m?G*b-O*u:G*b+O*u;T+=Z,M&&o.restore()}m?s.y-=T:s.x+=T*p,o.restore(),this.compose(),(P=this.dependencyTracker)==null||P.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,i=this.current,r=i.font,o=i.fontSize,c=i.fontDirection,d=r.vertical?1:-1,h=i.charSpacing,u=i.wordSpacing,p=i.textHScale*c,f=i.fontMatrix||vM,m=t.length,x=i.textRenderingMode===Ai.INVISIBLE;let g,b,y,C;if(x||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(p,c);const w=this.dependencyTracker;for(this.dependencyTracker=w?new kU(w,e):null,g=0;g<m;++g){if(b=t[g],typeof b=="number"){C=d*b*o/1e3,this.ctx.translate(C,0),i.x+=C*p;continue}const S=(b.isSpace?u:0)+h,j=r.charProcOperatorList[b.operatorListId];j?this.contentVisible&&(this.save(),s.scale(o,o),s.transform(...f),this.executeOperatorList(j),this.restore()):tt(`Type3 character "${b.operatorListId}" is not available.`);const T=[b.width,0];_e.applyTransform(T,f),y=T[0]*o+S,s.translate(y,0),i.x+=y*p}s.restore(),w&&(this.dependencyTracker=w)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,i,r,o,c){var h;const d=new Path2D;d.rect(i,r,o-i,c-r),this.ctx.clip(d),(h=this.dependencyTracker)==null||h.recordBBox(e,this.ctx,i,o,r,c).recordClipBox(e,this.ctx,i,o,r,c),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const i=this.baseTransform||Qs(this.ctx),r={createCanvasGraphics:(o,c)=>new tv(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new kU(this.dependencyTracker,c,!0):null)};s=new ode(t,this.ctx,r,i)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=ade(this.getObject(e,t)),this.cachedPatterns.set(t,i)),s&&(i.matrix=s),i}shadingFill(e,t){var o;if(!this.contentVisible)return;const s=this.ctx;this.save(e);const i=this._getPattern(e,t);s.fillStyle=i.getPattern(s,this,xc(s),Ui.SHADING,e);const r=xc(s);if(r){const{width:c,height:d}=s.canvas,h=tb.slice();_e.axialAlignedBoundingBox([0,0,c,d],r,h);const[u,p,f,m]=h;this.ctx.fillRect(u,p,f-u,m-p)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,_o.transform).recordDependencies(e,_o.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Cs("Should not call beginInlineImage")}beginImageData(){Cs("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Qs(this.ctx),s)){_e.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[r,o,c,d]=s,h=new Path2D;h.rect(r,o,c-r,d-o),this.ctx.clip(h),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,r,c,o,d),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var w;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||JL("TODO: Support non-isolated groups."),t.knockout&&tt("Knockout groups not supported.");const i=Qs(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=tb.slice();_e.axialAlignedBoundingBox(t.bbox,Qs(s),r);const o=[0,0,s.canvas.width,s.canvas.height];r=_e.intersect(r,o)||[0,0,0,0];const c=Math.floor(r[0]),d=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-c,1),u=Math.max(Math.ceil(r[3])-d,1);this.current.startNewPathAndClipBox([0,0,h,u]);let p="groupAt"+this.groupLevel;t.smask&&(p+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(p,h,u),m=f.context;m.translate(-c,-d),m.transform(...i);let x=new Path2D;const[g,b,y,C]=t.bbox;if(x.rect(g,b,y-g,C-b),t.matrix){const S=new Path2D;S.addPath(x,new DOMMatrix(t.matrix)),x=S}m.clip(x),t.smask&&this.smaskStack.push({canvas:f.canvas,context:m,offsetX:c,offsetY:d,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(c,d),s.save()),wS(s,m),this.ctx=m,(w=this.dependencyTracker)==null||w.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Qs(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const c=tb.slice();_e.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],o,c),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(c)}}beginAnnotation(e,t,s,i,r,o){if(E(this,dc,KM).call(this),Ek(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const c=s[2]-s[0],d=s[3]-s[1];if(o&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=c,s[3]=d,_e.singularValueDecompose2dScale(Qs(this.ctx),co);const{viewportScale:h}=this,u=Math.ceil(c*this.outputScaleX*h),p=Math.ceil(d*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(u,p);const{canvas:f,context:m}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=m,this.ctx.save(),this.ctx.setTransform(co[0],0,0,-co[1],0,d*co[1]),Ek(this.ctx)}else{Ek(this.ctx),this.endPath(e);const h=new Path2D;h.rect(s[0],s[1],c,d),this.ctx.clip(h)}}this.current=new DU(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),E(this,dc,QM).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var c;if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const i=this.ctx,r=this._createMaskCanvas(e,t),o=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,r.offsetX,r.offsetY),(c=this.dependencyTracker)==null||c.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,i=0,r=0,o,c){var p,f,m;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const d=this.ctx;d.save();const h=Qs(d);d.transform(s,i,r,o,0,0);const u=this._createMaskCanvas(e,t);d.setTransform(1,0,0,1,u.offsetX-h[4],u.offsetY-h[5]),(p=this.dependencyTracker)==null||p.resetBBox(e);for(let x=0,g=c.length;x<g;x+=2){const b=_e.transform(h,[s,i,r,o,c[x],c[x+1]]);d.drawImage(u.canvas,b[4],b[5]),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,b[4],b[4]+u.canvas.width,b[5],b[5]+u.canvas.height)}d.restore(),this.compose(),(m=this.dependencyTracker)==null||m.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,c,d;if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,r=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,_o.transformAndFill);for(const h of t){const{data:u,width:p,height:f,transform:m}=h,x=this.cachedCanvases.getCanvas("maskCanvas",p,f),g=x.context;g.save();const b=this.getObject(e,u,h);IU(g,b),g.globalCompositeOperation="source-in",g.fillStyle=r?i.getPattern(g,this,xc(s),Ui.FILL,e):i,g.fillRect(0,0,p,f),g.restore(),s.save(),s.transform(...m),s.scale(1,-1),Ak(s,x.canvas,0,0,p,f,0,-1,1,1),(c=this.dependencyTracker)==null||c.recordBBox(e,s,0,p,0,f),s.restore()}this.compose(),(d=this.dependencyTracker)==null||d.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){tt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,i,r){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){tt("Dependent image isn't ready yet");return}const c=o.width,d=o.height,h=[];for(let u=0,p=r.length;u<p;u+=2)h.push({transform:[s,0,0,i,r[u],r[u+1]],x:0,y:0,w:c,h:d});this.paintInlineImageXObjectGroup(e,o,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e,t){var h;if(!this.contentVisible)return;const s=t.width,i=t.height,r=this.ctx;this.save(e);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/s,-1/i);let c;if(t.bitmap)c=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)c=t;else{const p=this.cachedCanvases.getCanvas("inlineImage",s,i).context;RU(p,t),c=this.applyTransferMapsToCanvas(p)}const d=this._scaleImage(c,xc(r));r.imageSmoothingEnabled=MU(Qs(r),t.interpolate),(h=this.dependencyTracker)==null||h.resetBBox(e).recordBBox(e,r,0,s,-i,0).recordDependencies(e,_o.imageXObject).recordOperation(e),Ak(r,d.img,0,0,d.paintWidth,d.paintHeight,0,-i,s,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){var o,c,d;if(!this.contentVisible)return;const i=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const h=t.width,u=t.height,f=this.cachedCanvases.getCanvas("inlineImage",h,u).context;RU(f,t),r=this.applyTransferMapsToCanvas(f)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const h of s)i.save(),i.transform(...h.transform),i.scale(1,-1),Ak(i,r,h.x,h.y,h.w,h.h,0,-1,1,1),(c=this.dependencyTracker)==null||c.recordBBox(e,i,0,1,-1,0),i.restore();(d=this.dependencyTracker)==null||d.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,_o.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){var o,c;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===FU?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(c=this.dependencyTracker)==null||c.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Qs(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let o,c;if(s===0&&i===0){const d=Math.abs(t),h=Math.abs(r);if(d===h)if(e===0)o=c=1/d;else{const u=d*e;o=c=u<1?1/u:1}else if(e===0)o=1/d,c=1/h;else{const u=d*e,p=h*e;o=u<1?1/u:1,c=p<1?1/p:1}}else{const d=Math.abs(t*r-s*i),h=Math.hypot(t,s),u=Math.hypot(i,r);if(e===0)o=u/d,c=h/d;else{const p=e*d;o=u>p?u/p:1,c=h>p?h/p:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[r,o]=this.getScaleForStroking();if(r===o){s.lineWidth=(i||1)*r,s.stroke(e);return}const c=s.getLineDash();t&&s.save(),s.scale(r,o),yR.a=1/r,yR.d=1/o;const d=new Path2D;if(d.addPath(e,yR),c.length>0){const h=Math.max(r,o);s.setLineDash(c.map(u=>u/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(d),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}},dc=new WeakSet,KM=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},QM=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},JM=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i},tv);for(const n in PN)vT.prototype[n]!==void 0&&(vT.prototype[PN[n]]=vT.prototype[n]);var Vk,kj,Tj;let op=(Vk=class{static get workerPort(){return l(this,kj)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");v(this,kj,e)}static get workerSrc(){return l(this,Tj)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");v(this,Tj,e)}},kj=new WeakMap,Tj=new WeakMap,A(Vk,kj,null),A(Vk,Tj,""),Vk);var sv,_j,x8;let mde=(x8=class{constructor({parsedData:e,rawData:t}){A(this,sv);A(this,_j);v(this,sv,e),v(this,_j,t)}getRaw(){return l(this,_j)}get(e){return l(this,sv).get(e)??null}[Symbol.iterator](){return l(this,sv).entries()}},sv=new WeakMap,_j=new WeakMap,x8);const jy=Symbol("INTERNAL");var Pj,Lj,Dj,nv,y8;let gde=(y8=class{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){A(this,Pj,!1);A(this,Lj,!1);A(this,Dj,!1);A(this,nv,!0);v(this,Pj,!!(e&ro.DISPLAY)),v(this,Lj,!!(e&ro.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(l(this,Dj))return l(this,nv);if(!l(this,nv))return!1;const{print:e,view:t}=this.usage;return l(this,Pj)?(t==null?void 0:t.viewState)!=="OFF":l(this,Lj)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==jy&&Cs("Internal method `_setVisible` called."),v(this,Dj,s),v(this,nv,t)}},Pj=new WeakMap,Lj=new WeakMap,Dj=new WeakMap,nv=new WeakMap,y8);var kp,ns,iv,rv,Rj,ZM,b8;let xde=(b8=class{constructor(e,t=ro.DISPLAY){A(this,Rj);A(this,kp,null);A(this,ns,new Map);A(this,iv,null);A(this,rv,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,v(this,rv,e.order);for(const s of e.groups)l(this,ns).set(s.id,new gde(t,s));if(e.baseState==="OFF")for(const s of l(this,ns).values())s._setVisible(jy,!1);for(const s of e.on)l(this,ns).get(s)._setVisible(jy,!0);for(const s of e.off)l(this,ns).get(s)._setVisible(jy,!1);v(this,iv,this.getHash())}}isVisible(e){if(l(this,ns).size===0)return!0;if(!e)return JL("Optional content group not defined."),!0;if(e.type==="OCG")return l(this,ns).has(e.id)?l(this,ns).get(e.id).visible:(tt(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return E(this,Rj,ZM).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!l(this,ns).has(t))return tt(`Optional content group not found: ${t}`),!0;if(l(this,ns).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!l(this,ns).has(t))return tt(`Optional content group not found: ${t}`),!0;if(!l(this,ns).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!l(this,ns).has(t))return tt(`Optional content group not found: ${t}`),!0;if(!l(this,ns).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!l(this,ns).has(t))return tt(`Optional content group not found: ${t}`),!0;if(l(this,ns).get(t).visible)return!1}return!0}return tt(`Unknown optional content policy ${e.policy}.`),!0}return tt(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=l(this,ns).get(e);if(!i){tt(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const c of o)c!==e&&((r=l(this,ns).get(c))==null||r._setVisible(jy,!1,!0));i._setVisible(jy,!!t,!0),v(this,kp,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=l(this,ns).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}v(this,kp,null)}get hasInitialVisibility(){return l(this,iv)===null||this.getHash()===l(this,iv)}getOrder(){return l(this,ns).size?l(this,rv)?l(this,rv).slice():[...l(this,ns).keys()]:null}getGroup(e){return l(this,ns).get(e)||null}getHash(){if(l(this,kp)!==null)return l(this,kp);const e=new I9;for(const[t,s]of l(this,ns))e.update(`${t}:${s.visible}`);return v(this,kp,e.hexdigest())}[Symbol.iterator](){return l(this,ns).entries()}},kp=new WeakMap,ns=new WeakMap,iv=new WeakMap,rv=new WeakMap,Rj=new WeakSet,ZM=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let o;if(Array.isArray(r))o=E(this,Rj,ZM).call(this,r);else if(l(this,ns).has(r))o=l(this,ns).get(r).visible;else return tt(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"},b8),yde=class{constructor(e,{disableRange:t=!1,disableStream:s=!1}){At(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:c}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=c,(r==null?void 0:r.length)>0){const d=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((d,h)=>{this._onReceiveData({begin:d,chunk:h})}),e.addProgressListener((d,h)=>{this._onProgress({loaded:d,total:h})}),e.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});At(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){At(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new bde(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new vde(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}},bde=class{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=p3(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},vde=class{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function wde(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let u=c(t);return u=unescape(u),u=d(u),u=h(u),r(u)}if(t=o(n),t){const u=h(t);return r(u)}if(t=s("filename","i").exec(n),t){t=t[1];let u=c(t);return u=h(u),r(u)}function s(u,p){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function i(u,p){if(u){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const f=new TextDecoder(u,{fatal:!0}),m=NE(p);p=f.decode(m),e=!1}catch{}}return p}function r(u){return e&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),e&&(u=i("iso-8859-1",u))),u}function o(u){const p=[];let f;const m=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=m.exec(u))!==null;){let[,g,b,y]=f;if(g=parseInt(g,10),g in p){if(g===0)break;continue}p[g]=[b,y]}const x=[];for(let g=0;g<p.length&&g in p;++g){let[b,y]=p[g];y=c(y),b&&(y=unescape(y),g===0&&(y=d(y))),x.push(y)}return x.join("")}function c(u){if(u.startsWith('"')){const p=u.slice(1).split('\\"');for(let f=0;f<p.length;++f){const m=p[f].indexOf('"');m!==-1&&(p[f]=p[f].slice(0,m),p.length=f+1),p[f]=p[f].replaceAll(/\\(.)/g,"$1")}u=p.join('"')}return u}function d(u){const p=u.indexOf("'");if(p===-1)return u;const f=u.slice(0,p),x=u.slice(p+1).replace(/^[^']*'/,"");return i(f,x)}function h(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,f,m,x){if(m==="q"||m==="Q")return x=x.replaceAll("_"," "),x=x.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,b){return String.fromCharCode(parseInt(b,16))}),i(f,x);try{x=atob(x)}catch{}return i(f,x)})}return""}function q9(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function eD(n){var e;return((e=URL.parse(n))==null?void 0:e.origin)??null}function Y9({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function X9(n){const e=n.get("Content-Disposition");if(e){let t=wde(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(p3(t))return t}return null}function kE(n,e){return new gP(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n,n===404||n===0&&e.startsWith("file:"))}function K9(n){return n===200||n===206}function Q9(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function J9(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(tt(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}let Sde=class{constructor(e){W(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=q9(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return At(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Cde(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Nde(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}},Cde=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,Q9(s,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=eD(r.url),!K9(r.status))throw kE(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:c,suggestedLength:d}=Y9({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=c,this._contentLength=d||this._contentLength,this._filename=X9(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new pm("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:J9(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}},Nde=class{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const o=i.url;fetch(o,Q9(r,this._withCredentials,this._abortController)).then(c=>{const d=eD(c.url);if(d!==e._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${e._responseOrigin}".`);if(!K9(c.status))throw kE(c.status,o);this._readCapability.resolve(),this._reader=c.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:J9(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}};const bR=200,vR=206;function jde(n){const e=n.response;return typeof e!="string"?e:NE(e).buffer}let Ade=class{constructor({url:e,httpHeaders:t,withCredentials:s}){W(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=q9(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=vR):i.expectedStatus=bR,t.responseType="arraybuffer",At(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||bR;if(!(r===bR&&s.expectedStatus===vR)&&r!==s.expectedStatus){s.onError(i.status);return}const c=jde(i);if(r===vR){const d=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);h?s.onDone({begin:parseInt(h[1],10),chunk:c}):(tt('Missing or invalid "Content-Range" header.'),s.onError(0))}else c?s.onDone({begin:0,chunk:c}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},Ede=class{constructor(e){this._source=e,this._manager=new Ade(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return At(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new kde(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new Tde(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}},kde=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=eD(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[d,...h]=c.split(": ");return[d,h.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=Y9({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=X9(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=kE(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},Tde=class{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=eD((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=kE(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}};const _de=/^[a-z][a-z0-9\-+.]+:/i;function Pde(n){if(_de.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}let Lde=class{constructor(e){this.source=e,this.url=Pde(e.url),At(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return At(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Dde(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Rde(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}},Dde=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=kE(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new pm("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},Rde=class{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}};const SS=Symbol("INITIAL_DATA");var ka,Ij,e4,v8;let Z9=(v8=class{constructor(){A(this,Ij);A(this,ka,Object.create(null))}get(e,t=null){if(t){const i=E(this,Ij,e4).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=l(this,ka)[e];if(!s||s.data===SS)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=l(this,ka)[e];return!!t&&t.data!==SS}delete(e){const t=l(this,ka)[e];return!t||t.data===SS?!1:(delete l(this,ka)[e],!0)}resolve(e,t=null){const s=E(this,Ij,e4).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in l(this,ka)){const{data:s}=l(this,ka)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}v(this,ka,Object.create(null))}*[Symbol.iterator](){for(const e in l(this,ka)){const{data:t}=l(this,ka)[e];t!==SS&&(yield[e,t])}}},ka=new WeakMap,Ij=new WeakSet,e4=function(e){var t;return(t=l(this,ka))[e]||(t[e]={...Promise.withResolvers(),data:SS})},v8);const Ide=1e5,OU=30;var w8,Tp,ta,Mj,Fj,Mg,gh,Oj,Bj,Fg,av,ov,_p,lv,$j,cv,Og,Uj,zj,gn,dv,Bg,Hj,Pp,hv,Bu,eq,tq,s4,vo,wT,n4,sq,nq;let t4=(gn=class{constructor({textContentSource:e,container:t,viewport:s}){A(this,Bu);A(this,Tp,Promise.withResolvers());A(this,ta,null);A(this,Mj,!1);A(this,Fj,!!((w8=globalThis.FontInspector)!=null&&w8.enabled));A(this,Mg,null);A(this,gh,null);A(this,Oj,0);A(this,Bj,0);A(this,Fg,null);A(this,av,null);A(this,ov,0);A(this,_p,0);A(this,lv,Object.create(null));A(this,$j,[]);A(this,cv,null);A(this,Og,[]);A(this,Uj,new WeakMap);A(this,zj,null);var d;if(e instanceof ReadableStream)v(this,cv,e);else if(typeof e=="object")v(this,cv,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');v(this,ta,v(this,av,t)),v(this,_p,s.scale*K0.pixelRatio),v(this,ov,s.rotation),v(this,gh,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:c}=s.rawDims;v(this,zj,[1,0,0,-1,-o,c+r]),v(this,Bj,i),v(this,Oj,r),E(d=gn,vo,sq).call(d),X0(t,s),l(this,Tp).promise.finally(()=>{l(gn,hv).delete(this),v(this,gh,null),v(this,lv,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Yi.platform;return ot(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{l(this,Fg).read().then(({value:t,done:s})=>{if(s){l(this,Tp).resolve();return}l(this,Mg)??v(this,Mg,t.lang),Object.assign(l(this,lv),t.styles),E(this,Bu,eq).call(this,t.items),e()},l(this,Tp).reject)};return v(this,Fg,l(this,cv).getReader()),l(gn,hv).add(this),e(),l(this,Tp).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*K0.pixelRatio,i=e.rotation;if(i!==l(this,ov)&&(t==null||t(),v(this,ov,i),X0(l(this,av),{rotation:i})),s!==l(this,_p)){t==null||t(),v(this,_p,s);const o={div:null,properties:null,ctx:E(r=gn,vo,wT).call(r,l(this,Mg))};for(const c of l(this,Og))o.properties=l(this,Uj).get(c),o.div=c,E(this,Bu,s4).call(this,o)}}cancel(){var t;const e=new pm("TextLayer task cancelled.");(t=l(this,Fg))==null||t.cancel(e).catch(()=>{}),v(this,Fg,null),l(this,Tp).reject(e)}get textDivs(){return l(this,Og)}get textContentItemsStr(){return l(this,$j)}static cleanup(){if(!(l(this,hv).size>0)){l(this,dv).clear();for(const{canvas:e}of l(this,Bg).values())e.remove();l(this,Bg).clear()}}},Tp=new WeakMap,ta=new WeakMap,Mj=new WeakMap,Fj=new WeakMap,Mg=new WeakMap,gh=new WeakMap,Oj=new WeakMap,Bj=new WeakMap,Fg=new WeakMap,av=new WeakMap,ov=new WeakMap,_p=new WeakMap,lv=new WeakMap,$j=new WeakMap,cv=new WeakMap,Og=new WeakMap,Uj=new WeakMap,zj=new WeakMap,dv=new WeakMap,Bg=new WeakMap,Hj=new WeakMap,Pp=new WeakMap,hv=new WeakMap,Bu=new WeakSet,eq=function(e){var i,r;if(l(this,Mj))return;(r=l(this,gh)).ctx??(r.ctx=E(i=gn,vo,wT).call(i,l(this,Mg)));const t=l(this,Og),s=l(this,$j);for(const o of e){if(t.length>Ide){tt("Ignoring additional textDivs for performance reasons."),v(this,Mj,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const c=l(this,ta);v(this,ta,document.createElement("span")),l(this,ta).classList.add("markedContent"),o.id&&l(this,ta).setAttribute("id",`${o.id}`),c.append(l(this,ta))}else o.type==="endMarkedContent"&&v(this,ta,l(this,ta).parentNode);continue}s.push(o.str),E(this,Bu,tq).call(this,o)}},tq=function(e){var g;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};l(this,Og).push(t);const i=_e.transform(l(this,zj),e.transform);let r=Math.atan2(i[1],i[0]);const o=l(this,lv)[e.fontName];o.vertical&&(r+=Math.PI/2);let c=l(this,Fj)&&o.fontSubstitution||o.fontFamily;c=gn.fontFamilyMap.get(c)||c;const d=Math.hypot(i[2],i[3]),h=d*E(g=gn,vo,nq).call(g,c,o,l(this,Mg));let u,p;r===0?(u=i[4],p=i[5]-h):(u=i[4]+h*Math.sin(r),p=i[5]-h*Math.cos(r));const f="calc(var(--total-scale-factor) *",m=t.style;l(this,ta)===l(this,av)?(m.left=`${(100*u/l(this,Bj)).toFixed(2)}%`,m.top=`${(100*p/l(this,Oj)).toFixed(2)}%`):(m.left=`${f}${u.toFixed(2)}px)`,m.top=`${f}${p.toFixed(2)}px)`),m.fontSize=`${f}${(l(gn,Pp)*d).toFixed(2)}px)`,m.fontFamily=c,s.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,l(this,Fj)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let x=!1;if(e.str.length>1)x=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),y=Math.abs(e.transform[3]);b!==y&&Math.max(b,y)/Math.min(b,y)>1.5&&(x=!0)}if(x&&(s.canvasWidth=o.vertical?e.height:e.width),l(this,Uj).set(t,s),l(this,gh).div=t,l(this,gh).properties=s,E(this,Bu,s4).call(this,l(this,gh)),s.hasText&&l(this,ta).append(t),s.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),l(this,ta).append(b)}},s4=function(e){var c;const{div:t,properties:s,ctx:i}=e,{style:r}=t;let o="";if(l(gn,Pp)>1&&(o=`scale(${1/l(gn,Pp)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:d}=r,{canvasWidth:h,fontSize:u}=s;E(c=gn,vo,n4).call(c,i,u*l(this,_p),d);const{width:p}=i.measureText(t.textContent);p>0&&(o=`scaleX(${h*l(this,_p)/p}) ${o}`)}s.angle!==0&&(o=`rotate(${s.angle}deg) ${o}`),o.length>0&&(r.transform=o)},vo=new WeakSet,wT=function(e=null){let t=l(this,Bg).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,Bg).set(e,t),l(this,Hj).set(t,{size:0,family:""})}return t},n4=function(e,t,s){const i=l(this,Hj).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},sq=function(){if(l(this,Pp)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),v(this,Pp,e.getBoundingClientRect().height),e.remove()},nq=function(e,t,s){const i=l(this,dv).get(e);if(i)return i;const r=E(this,vo,wT).call(this,s);r.canvas.width=r.canvas.height=OU,E(this,vo,n4).call(this,r,OU,e);const o=r.measureText(""),c=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let h=.8;return c?h=c/(c+d):(Yi.platform.isFirefox&&tt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),l(this,dv).set(e,h),h},A(gn,vo),A(gn,dv,new Map),A(gn,Bg,new Map),A(gn,Hj,new WeakMap),A(gn,Pp,null),A(gn,hv,new Set),gn);const Mde=100;function iq(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new Fde,{docId:t}=e,s=n.url?zce(n.url):null,i=n.data?Hce(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,c=n.password??null,d=n.range instanceof rq?n.range:null,h=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let u=n.worker instanceof i4?n.worker:null;const p=n.verbosity,f=typeof n.docBaseUrl=="string"&&!ZL(n.docBaseUrl)?n.docBaseUrl:null,m=Sk(n.cMapUrl),x=n.cMapPacked!==!1,g=n.CMapReaderFactory||(Ir?Qce:CU),b=Sk(n.iccUrl),y=Sk(n.standardFontDataUrl),C=n.StandardFontDataFactory||(Ir?Jce:NU),w=Sk(n.wasmUrl),S=n.WasmFactory||(Ir?Zce:jU),j=n.stopAtErrors!==!0,T=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,k=n.isEvalSupported!==!1,_=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!Ir,L=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!Ir&&(Yi.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,P=typeof n.disableFontFace=="boolean"?n.disableFontFace:Ir,I=n.fontExtraProperties===!0,M=n.enableXfa===!0,O=n.ownerDocument||globalThis.document,F=n.disableRange===!0,B=n.disableStream===!0,U=n.disableAutoFetch===!0,$=n.pdfBug===!0,G=n.CanvasFactory||(Ir?Kce:qce),ne=n.FilterFactory||(Ir?Xce:Yce),Z=n.enableHWA===!0,K=n.useWasm!==!1,X=d?d.length:n.length??NaN,V=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!Ir&&!P,q=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(g===CU&&C===NU&&S===jU&&m&&y&&w&&GS(m,document.baseURI)&&GS(y,document.baseURI)&&GS(w,document.baseURI)),ee=null;uce(p);const ie={canvasFactory:new G({ownerDocument:O,enableHWA:Z}),filterFactory:new ne({docId:t,ownerDocument:O}),cMapReaderFactory:q?null:new g({baseUrl:m,isCompressed:x}),standardFontDataFactory:q?null:new C({baseUrl:y}),wasmFactory:q?null:new S({baseUrl:w})};u||(u=i4.create({verbosity:p,port:op.workerPort}),e._worker=u);const Re={docId:t,apiVersion:"5.4.394",data:i,password:c,disableAutoFetch:U,rangeChunkSize:h,length:X,docBaseUrl:f,enableXfa:M,evaluatorOptions:{maxImageSize:T,disableFontFace:P,ignoreErrors:j,isEvalSupported:k,isOffscreenCanvasSupported:_,isImageDecoderSupported:L,canvasMaxAreaInBytes:D,fontExtraProperties:I,useSystemFonts:V,useWasm:K,useWorkerFetch:q,cMapUrl:m,iccUrl:b,standardFontDataUrl:y,wasmUrl:w}},Ye={ownerDocument:O,pdfBug:$,styleElement:ee,loadingParams:{disableAutoFetch:U,enableXfa:M}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Le=u.messageHandler.sendWithPromise("GetDocRequest",Re,i?[i.buffer]:null);let te;if(d)te=new yde(d,{disableRange:F,disableStream:B});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const fe=GS(s)?Sde:Ir?Lde:Ede;te=new fe({url:s,length:X,httpHeaders:r,withCredentials:o,rangeChunkSize:h,disableRange:F,disableStream:B})}return Le.then(fe=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Ne=new ZS(t,fe,u.port),Pe=new $de(Ne,e,te,Ye,ie,Z);e._transport=Pe,Ne.send("Ready",null)})}).catch(e._capability.reject),e}var $g,OP;let Fde=($g=class{constructor(){W(this,"_capability",Promise.withResolvers());W(this,"_transport",null);W(this,"_worker",null);W(this,"docId",`d${vt($g,OP)._++}`);W(this,"destroyed",!1);W(this,"onPassword",null);W(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}},OP=new WeakMap,A($g,OP,0),$g);var Ug,Vj,Gj,Wj,qj,S8;let rq=(S8=class{constructor(e,t,s=!1,i=null){A(this,Ug,Promise.withResolvers());A(this,Vj,[]);A(this,Gj,[]);A(this,Wj,[]);A(this,qj,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){l(this,qj).push(e)}addProgressListener(e){l(this,Wj).push(e)}addProgressiveReadListener(e){l(this,Gj).push(e)}addProgressiveDoneListener(e){l(this,Vj).push(e)}onDataRange(e,t){for(const s of l(this,qj))s(e,t)}onDataProgress(e,t){l(this,Ug).promise.then(()=>{for(const s of l(this,Wj))s(e,t)})}onDataProgressiveRead(e){l(this,Ug).promise.then(()=>{for(const t of l(this,Gj))t(e)})}onDataProgressiveDone(){l(this,Ug).promise.then(()=>{for(const e of l(this,Vj))e()})}transportReady(){l(this,Ug).resolve()}requestDataRange(e,t){Cs("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},Ug=new WeakMap,Vj=new WeakMap,Gj=new WeakMap,Wj=new WeakMap,qj=new WeakMap,S8),Ode=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ot(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}};var xh,zg,iC,C8;let Bde=(C8=class{constructor(e,t,s,i=!1){A(this,zg);A(this,xh,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new pU:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Z9,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new h3({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ot(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:i="display",annotationMode:r=ap.ENABLE,transform:o=null,background:c=null,optionalContentConfigPromise:d=null,annotationCanvasMap:h=null,pageColors:u=null,printAnnotationStorage:p=null,isEditing:f=!1,recordOperations:m=!1,operationsFilter:x=null}){var L,D,P;(L=this._stats)==null||L.time("Overall");const g=this._transport.getRenderingIntent(i,r,p,f),{renderingIntent:b,cacheKey:y}=g;v(this,xh,!1),d||(d=this._transport.getOptionalContentConfig(b));let C=this._intentStates.get(y);C||(C=Object.create(null),this._intentStates.set(y,C)),C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null);const w=!!(b&ro.PRINT);C.displayReadyCapability||(C.displayReadyCapability=Promise.withResolvers(),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(D=this._stats)==null||D.time("Page Request"),this._pumpOperatorList(g));const S=!!(this._pdfBug&&((P=globalThis.StepperManager)!=null&&P.enabled)),j=!this.recordedBBoxes&&(m||S),T=I=>{var M,O;if(C.renderTasks.delete(k),j){const F=(M=k.gfx)==null?void 0:M.dependencyTracker.take();F&&(k.stepper&&k.stepper.setOperatorBBoxes(F,k.gfx.dependencyTracker.takeDebugMetadata()),m&&(this.recordedBBoxes=F))}w&&v(this,xh,!0),E(this,zg,iC).call(this),I?(k.capability.reject(I),this._abortOperatorList({intentState:C,reason:I instanceof Error?I:new Error(I)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(O=globalThis.Stats)!=null&&O.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new zde({callback:T,params:{canvas:t,canvasContext:e,dependencyTracker:j?new tde(t,C.operatorList.length,S):null,viewport:s,transform:o,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:C.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:u,enableHWA:this._transport.enableHWA,operationsFilter:x});(C.renderTasks||(C.renderTasks=new Set)).add(k);const _=k.task;return Promise.all([C.displayReadyCapability.promise,d]).then(([I,M])=>{var O;if(this.destroyed){T();return}if((O=this._stats)==null||O.time("Rendering"),!(M.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:I,optionalContentConfig:M}),k.operatorListChanged()}).catch(T),_}getOperatorList({intent:e="display",annotationMode:t=ap.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function r(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(e,t,s,i,!0);let c=this._intentStates.get(o.cacheKey);c||(c=Object.create(null),this._intentStates.set(o.cacheKey,c));let d;return c.opListReadCapability||(d=Object.create(null),d.operatorListChanged=r,c.opListReadCapability=Promise.withResolvers(),(c.renderTasks||(c.renderTasks=new Set)).add(d),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(o)),c.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>NM.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){o.read().then(function({value:d,done:h}){if(h){s(c);return}c.lang??(c.lang=d.lang),Object.assign(c.styles,d.styles),c.items.push(...d.items),r()},i)}const o=t.getReader(),c={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),v(this,xh,!1),Promise.all(e)}cleanup(e=!1){v(this,xh,!0);const t=E(this,zg,iC).call(this);return e&&t&&this._stats&&(this._stats=new pU),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&E(this,zg,iC).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),h=this._intentStates.get(t);h.streamReader=d;const u=()=>{d.read().then(({value:p,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,h),u())},p=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();E(this,zg,iC).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(p);else if(h.opListReadCapability)h.opListReadCapability.reject(p);else throw p}})};u()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof u3){let i=Mde;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new pm(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}},xh=new WeakMap,zg=new WeakSet,iC=function(){if(!l(this,xh)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),v(this,xh,!1),!0},C8);var Lp,Il,yh,Hg,ys,BP,Vg,Gg,Br,ST,aq,oq,rC,uv,CT;let i4=(ys=class{constructor({name:e=null,port:t=null,verbosity:s=pce()}={}){A(this,Br);A(this,Lp,Promise.withResolvers());A(this,Il,null);A(this,yh,null);A(this,Hg,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(l(ys,Gg).has(t))throw new Error("Cannot use more than one PDFWorker per port.");l(ys,Gg).set(t,this),E(this,Br,aq).call(this,t)}else E(this,Br,oq).call(this)}get promise(){return l(this,Lp).promise}get port(){return l(this,yh)}get messageHandler(){return l(this,Il)}destroy(){var e,t;this.destroyed=!0,(e=l(this,Hg))==null||e.terminate(),v(this,Hg,null),l(ys,Gg).delete(l(this,yh)),v(this,yh,null),(t=l(this,Il))==null||t.destroy(),v(this,Il,null)}static create(e){const t=l(this,Gg).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new ys(e)}static get workerSrc(){if(op.workerSrc)return op.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ot(this,"_setupFakeWorkerGlobal",(async()=>l(this,uv,CT)?l(this,uv,CT):(await import(this.workerSrc)).WorkerMessageHandler)())}},Lp=new WeakMap,Il=new WeakMap,yh=new WeakMap,Hg=new WeakMap,BP=new WeakMap,Vg=new WeakMap,Gg=new WeakMap,Br=new WeakSet,ST=function(){l(this,Lp).resolve(),l(this,Il).send("configure",{verbosity:this.verbosity})},aq=function(e){v(this,yh,e),v(this,Il,new ZS("main","worker",e)),l(this,Il).on("ready",()=>{}),E(this,Br,ST).call(this)},oq=function(){if(l(ys,Vg)||l(ys,uv,CT)){E(this,Br,rC).call(this);return}let{workerSrc:e}=ys;try{ys._isSameOrigin(window.location,e)||(e=ys._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new ZS("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?l(this,Lp).reject(new Error("Worker was destroyed")):E(this,Br,rC).call(this)},r=new AbortController;t.addEventListener("error",()=>{l(this,Hg)||i()},{signal:r.signal}),s.on("test",c=>{if(r.abort(),this.destroyed||!c){i();return}v(this,Il,s),v(this,yh,t),v(this,Hg,t),E(this,Br,ST).call(this)}),s.on("ready",c=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{E(this,Br,rC).call(this)}});const o=()=>{const c=new Uint8Array;s.send("test",c,[c.buffer])};o();return}catch{JL("The worker has been disabled.")}E(this,Br,rC).call(this)},rC=function(){l(ys,Vg)||(tt("Setting up fake worker."),v(ys,Vg,!0)),ys._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){l(this,Lp).reject(new Error("Worker was destroyed"));return}const t=new Wce;v(this,yh,t);const s=`fake${vt(ys,BP)._++}`,i=new ZS(s+"_worker",s,t);e.setup(i,t),v(this,Il,new ZS(s,s+"_worker",t)),E(this,Br,ST).call(this)}).catch(e=>{l(this,Lp).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},uv=new WeakSet,CT=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},A(ys,uv),A(ys,BP,0),A(ys,Vg,!1),A(ys,Gg,new WeakMap),Ir&&(v(ys,Vg,!0),op.workerSrc||(op.workerSrc="./pdf.worker.mjs")),ys._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},ys._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},ys.fromPort=e=>{if(jce("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return ys.create(e)},ys);var bh,Fc,pv,fv,vh,Wg,aC,N8;let $de=(N8=class{constructor(e,t,s,i,r,o){A(this,Wg);A(this,bh,new Map);A(this,Fc,new Map);A(this,pv,new Map);A(this,fv,new Map);A(this,vh,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Z9,this.fontLoader=new Bce({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return ot(this,"annotationStorage",new f3)}getRenderingIntent(e,t=ap.ENABLE,s=null,i=!1,r=!1){let o=ro.DISPLAY,c=zM;switch(e){case"any":o=ro.ANY;break;case"display":break;case"print":o=ro.PRINT;break;default:tt(`getRenderingIntent - invalid intent: ${e}`)}const d=o&ro.PRINT&&s instanceof F9?s:this.annotationStorage;switch(t){case ap.DISABLE:o+=ro.ANNOTATIONS_DISABLE;break;case ap.ENABLE:break;case ap.ENABLE_FORMS:o+=ro.ANNOTATIONS_FORMS;break;case ap.ENABLE_STORAGE:o+=ro.ANNOTATIONS_STORAGE,c=d.serializable;break;default:tt(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=ro.IS_EDITING),r&&(o+=ro.OPLIST);const{ids:h,hash:u}=d.modifiedIds,p=[o,c.hash,u];return{renderingIntent:o,cacheKey:p.join("_"),annotationStorageSerializable:c,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=l(this,vh))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of l(this,Fc).values())e.push(i._destroy());l(this,Fc).clear(),l(this,pv).clear(),l(this,fv).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),l(this,bh).clear(),this.filterFactory.destroy(),t4.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new pm("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{At(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}At(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async s=>{var c;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((c=t.onProgress)==null||c.call(t,this._lastProgress)),this._fullReader.onProgress=d=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:d.loaded,total:d.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(s,i)=>{At(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:c}){if(c){i.close();return}At(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new Ode(s,this))}),e.on("DocException",s=>{t._capability.reject(Yr(s))}),e.on("PasswordRequest",s=>{v(this,vh,Promise.withResolvers());try{if(!t.onPassword)throw Yr(s);const i=r=>{r instanceof Error?l(this,vh).reject(r):l(this,vh).resolve({password:r})};t.onPassword(i,s.code)}catch(i){l(this,vh).reject(i)}return l(this,vh).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;l(this,Fc).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in r){const f=r.error;tt(`Error during font loading: ${f}`),this.commonObjs.resolve(s,f);break}const c=new Uce(r),d=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(f,m)=>globalThis.FontInspector.fontAdded(f,m):null,h=new $ce(c,d,r.extra,r.charProcOperatorList);this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&h.clearData(),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:u}=r;At(u,"The imageRef must be defined.");for(const f of l(this,Fc).values())for(const[,m]of f.objs)if((m==null?void 0:m.ref)===u)return m.dataLen?(this.commonObjs.resolve(s,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(s,r);break;case"Pattern":const p=new HM(r);this.commonObjs.resolve(s,p.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,o])=>{var d;if(this.destroyed)return;const c=l(this,Fc).get(i);if(!c.objs.has(s)){if(c._intentStates.size===0){(d=o==null?void 0:o.bitmap)==null||d.close();return}switch(r){case"Image":case"Pattern":c.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&tt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=l(this,pv).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&l(this,fv).set(r.refStr,e);const o=new Bde(t,r,this,this._params.pdfBug);return l(this,Fc).set(t,o),o});return l(this,pv).set(t,i),i}getPageIndex(e){return VM(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return E(this,Wg,aC).call(this,"GetFieldObjects")}hasJSActions(){return E(this,Wg,aC).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return E(this,Wg,aC).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return E(this,Wg,aC).call(this,"GetOptionalContentConfig").then(t=>new xde(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=l(this,bh).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new mde(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return l(this,bh).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of l(this,Fc).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),l(this,bh).clear(),this.filterFactory.destroy(!0),t4.cleanup()}}cachedPageNumber(e){if(!VM(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return l(this,fv).get(t)??null}},bh=new WeakMap,Fc=new WeakMap,pv=new WeakMap,fv=new WeakMap,vh=new WeakMap,Wg=new WeakSet,aC=function(e,t=null){const s=l(this,bh).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return l(this,bh).set(e,i),i},N8);var Dp,j8;let Ude=(j8=class{constructor(e){A(this,Dp,null);W(this,"onContinue",null);W(this,"onError",null);v(this,Dp,e)}get promise(){return l(this,Dp).capability.promise}cancel(e=0){l(this,Dp).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=l(this,Dp).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=l(this,Dp);return e.form||e.canvas&&(t==null?void 0:t.size)>0}},Dp=new WeakMap,j8);var Rp,wd,qg;let zde=(wd=class{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:c,canvasFactory:d,filterFactory:h,useRequestAnimationFrame:u=!1,pdfBug:p=!1,pageColors:f=null,enableHWA:m=!1,operationsFilter:x=null}){A(this,Rp,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=c,this.canvasFactory=d,this.filterFactory=h,this._pdfBug=p,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ude(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=m,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=x}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var d,h;if(this.cancelled)return;if(this._canvas){if(l(wd,qg).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(wd,qg).add(this._canvas)}this._pdfBug&&((d=globalThis.StepperManager)!=null&&d.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:r,dependencyTracker:o}=this.params,c=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new vT(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(e=null,t=0){var s,i,r;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),l(this,Rp)&&(window.cancelAnimationFrame(l(this,Rp)),v(this,Rp,null)),l(wd,qg).delete(this._canvas),e||(e=new u3(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(i=this.task).onError)==null||r.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?v(this,Rp,window.requestAnimationFrame(()=>{v(this,Rp,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(wd,qg).delete(this._canvas),this.callback())))}},Rp=new WeakMap,qg=new WeakMap,A(wd,qg,new WeakSet),wd);const Hde="5.4.394",Vde="2cc809ade";var Ta,Yg,mv,Kn,Yj,gv,wh,Xj,Ip,Ml,$i,Kj,cs,r4,a4,o4,$m,cq,Zu;let lq=($i=class{constructor({editor:e=null,uiManager:t=null}){A(this,cs);A(this,Ta,null);A(this,Yg,null);A(this,mv);A(this,Kn,null);A(this,Yj,!1);A(this,gv,!1);A(this,wh,null);A(this,Xj);A(this,Ip,null);A(this,Ml,null);var s,i;e?(v(this,gv,!1),v(this,wh,e)):v(this,gv,!0),v(this,Ml,(e==null?void 0:e._uiManager)||t),v(this,Xj,l(this,Ml)._eventBus),v(this,mv,((s=e==null?void 0:e.color)==null?void 0:s.toUpperCase())||((i=l(this,Ml))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),l($i,Kj)||v($i,Kj,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ot(this,"_keyboardManager",new EE([[["Escape","mac+Escape"],$i.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],$i.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],$i.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],$i.prototype._moveToPrevious],[["Home","mac+Home"],$i.prototype._moveToBeginning],[["End","mac+End"],$i.prototype._moveToEnd]]))}renderButton(){const e=v(this,Ta,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",l(this,wh)&&(e.ariaControls=`${l(this,wh).id}_colorpicker_dropdown`);const t=l(this,Ml)._signal;e.addEventListener("click",E(this,cs,$m).bind(this),{signal:t}),e.addEventListener("keydown",E(this,cs,o4).bind(this),{signal:t});const s=v(this,Yg,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=l(this,mv),e.append(s),e}renderMainDropdown(){const e=v(this,Kn,E(this,cs,r4).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===l(this,Ta)){E(this,cs,$m).call(this,e);return}const t=e.target.getAttribute("data-color");t&&E(this,cs,a4).call(this,t,e)}_moveToNext(e){var t,s;if(!l(this,cs,Zu)){E(this,cs,$m).call(this,e);return}if(e.target===l(this,Ta)){(t=l(this,Kn).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=l(this,Kn))==null?void 0:t.firstChild)||e.target===l(this,Ta)){l(this,cs,Zu)&&this._hideDropdownFromKeyboard();return}l(this,cs,Zu)||E(this,cs,$m).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!l(this,cs,Zu)){E(this,cs,$m).call(this,e);return}(t=l(this,Kn).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!l(this,cs,Zu)){E(this,cs,$m).call(this,e);return}(t=l(this,Kn).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=l(this,Kn))==null||e.classList.add("hidden"),l(this,Ta).ariaExpanded="false",(t=l(this,Ip))==null||t.abort(),v(this,Ip,null)}_hideDropdownFromKeyboard(){var e;if(!l(this,gv)){if(!l(this,cs,Zu)){(e=l(this,wh))==null||e.unselect();return}this.hideDropdown(),l(this,Ta).focus({preventScroll:!0,focusVisible:l(this,Yj)})}}updateColor(e){if(l(this,Yg)&&(l(this,Yg).style.backgroundColor=e),!l(this,Kn))return;const t=l(this,Ml).highlightColors.values();for(const s of l(this,Kn).children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=l(this,Ta))==null||e.remove(),v(this,Ta,null),v(this,Yg,null),(t=l(this,Kn))==null||t.remove(),v(this,Kn,null)}},Ta=new WeakMap,Yg=new WeakMap,mv=new WeakMap,Kn=new WeakMap,Yj=new WeakMap,gv=new WeakMap,wh=new WeakMap,Xj=new WeakMap,Ip=new WeakMap,Ml=new WeakMap,Kj=new WeakMap,cs=new WeakSet,r4=function(){const e=document.createElement("div"),t=l(this,Ml)._signal;e.addEventListener("contextmenu",xl,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),l(this,wh)&&(e.id=`${l(this,wh).id}_colorpicker_dropdown`);for(const[s,i]of l(this,Ml).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",l($i,Kj)[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.ariaSelected=i===l(this,mv),r.addEventListener("click",E(this,cs,a4).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",E(this,cs,o4).bind(this),{signal:t}),e},a4=function(e,t){t.stopPropagation(),l(this,Xj).dispatch("switchannotationeditorparams",{source:this,type:jt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},o4=function(e){$i._keyboardManager.exec(this,e)},$m=function(e){if(l(this,cs,Zu)){this.hideDropdown();return}if(v(this,Yj,e.detail===0),l(this,Ip)||(v(this,Ip,new AbortController),window.addEventListener("pointerdown",E(this,cs,cq).bind(this),{signal:l(this,Ml).combinedSignal(l(this,Ip))})),l(this,Ta).ariaExpanded="true",l(this,Kn)){l(this,Kn).classList.remove("hidden");return}const t=v(this,Kn,E(this,cs,r4).call(this));l(this,Ta).append(t)},cq=function(e){var t;(t=l(this,Kn))!=null&&t.contains(e.target)||this.hideDropdown()},Zu=function(){return l(this,Kn)&&!l(this,Kn).classList.contains("hidden")},A($i,Kj,null),$i);var Oc,Qj,xv,Sd,Jj;let dq=(Sd=class{constructor(e){A(this,Oc,null);A(this,Qj,null);A(this,xv,null);v(this,Qj,e),v(this,xv,e._uiManager),l(Sd,Jj)||v(Sd,Jj,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(l(this,Oc))return l(this,Oc);const{editorType:e,colorType:t,color:s}=l(this,Qj),i=v(this,Oc,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",l(Sd,Jj)[e]),i.addEventListener("input",()=>{l(this,xv).updateParams(t,i.value)},{signal:l(this,xv)._signal}),i}update(e){l(this,Oc)&&(l(this,Oc).value=e)}destroy(){var e;(e=l(this,Oc))==null||e.remove(),v(this,Oc,null)}hideDropdown(){}},Oc=new WeakMap,Qj=new WeakMap,xv=new WeakMap,Jj=new WeakMap,A(Sd,Jj,null),Sd);function BU(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function CS(n){return Math.max(0,Math.min(255,255*n))}let $U=class{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=CS(e),[e,e,e]}static G_HTML([e]){const t=BU(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(CS)}static RGB_HTML(e){return`#${e.map(BU).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[CS(1-Math.min(1,e+i)),CS(1-Math.min(1,s+i)),CS(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,o=1-s,c=Math.min(i,r,o);return["CMYK",i,r,o,c]}},Gde=class{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Cs("Abstract method `_createSVG` called.")}},xP=class extends Gde{_createSVG(e){return document.createElementNS(zd,e)}};const Wde=9,Q0=new WeakSet,qde=new Date().getTimezoneOffset()*60*1e3;let wR=class{static create(e){switch(e.data.annotationType){case Un.LINK:return new x3(e);case Un.TEXT:return new Xde(e);case Un.WIDGET:switch(e.data.fieldType){case"Tx":return new Kde(e);case"Btn":return e.data.radioButton?new pq(e):e.data.checkBox?new Jde(e):new Zde(e);case"Ch":return new ehe(e);case"Sig":return new Qde(e)}return new ry(e);case Un.POPUP:return new c4(e);case Un.FREETEXT:return new yq(e);case Un.LINE:return new she(e);case Un.SQUARE:return new nhe(e);case Un.CIRCLE:return new ihe(e);case Un.POLYLINE:return new bq(e);case Un.CARET:return new ahe(e);case Un.INK:return new y3(e);case Un.POLYGON:return new rhe(e);case Un.HIGHLIGHT:return new vq(e);case Un.UNDERLINE:return new ohe(e);case Un.SQUIGGLY:return new lhe(e);case Un.STRIKEOUT:return new che(e);case Un.STAMP:return new wq(e);case Un.FILEATTACHMENT:return new dhe(e);default:return new Rn(e)}}};var Xg,yv,Ho,Zj,l4,bv;let Rn=(bv=class{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){A(this,Zj);A(this,Xg,null);A(this,yv,!1);A(this,Ho,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return bv._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var s;const{data:e}=this,t=(s=this.annotationStorage)==null?void 0:s.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var c;const e=(c=this.annotationStorage)==null?void 0:c.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:i}=this.data;let r=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let d=0;d<t.length;d+=8)t[d+1]>o?(o=t[d+1],r=t[d+2]):t[d+1]===o&&(r=Math.max(r,t[d+2]));return[r,o]}if((s==null?void 0:s.length)>=1){for(const d of s)for(let h=0,u=d.length;h<u;h+=2)d[h+1]>o?(o=d[h+1],r=d[h]):d[h+1]===o&&(r=Math.max(r,d[h]));if(r!==1/0)return[r,o]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/s,e[1]=100*(e[1]-o)/i,e}get commentText(){var t,s,i;const{data:e}=this;return((s=(t=this.annotationStorage.getRawValue(`${_N}${e.id}`))==null?void 0:t.popup)==null?void 0:s.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${_N}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=l(this,Ho))==null?void 0:e.popup)||this.popup)==null||t.remove(),v(this,Ho,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(l(this,Xg)||v(this,Xg,{rect:this.data.rect.slice(0)}));const{rect:t,popup:s}=e;t&&E(this,Zj,l4).call(this,t);let i=((r=l(this,Ho))==null?void 0:r.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=l(this,Ho).popup),i&&(i.updateEdited(e),s!=null&&s.deleted&&(i.remove(),v(this,Ho,null),this.popup=null))}resetEdited(){var e;l(this,Xg)&&(E(this,Zj,l4).call(this,l(this,Xg).rect),(e=l(this,Ho))==null||e.popup.resetEdited(),v(this,Xg,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof ry)&&!(this instanceof x3)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof c4){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,r),r}const{width:c,height:d}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(g>0||b>0){const C=`calc(${g}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;o.borderRadius=C}else if(this instanceof pq){const C=`calc(${c}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=C}switch(t.borderStyle.style){case vy.SOLID:o.borderStyle="solid";break;case vy.DASHED:o.borderStyle="dashed";break;case vy.BEVELED:tt("Unimplemented border style: beveled");break;case vy.INSET:tt("Unimplemented border style: inset");break;case vy.UNDERLINE:o.borderBottomStyle="solid";break}const y=t.borderColor||null;y?(v(this,yv,!0),o.borderColor=_e.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const h=_e.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:u,pageHeight:p,pageX:f,pageY:m}=i.rawDims;o.left=`${100*(h[0]-f)/u}%`,o.top=`${100*(h[1]-m)/p}%`;const{rotation:x}=t;return t.hasOwnCanvas||x===0?(o.width=`${100*c/u}%`,o.height=`${100*d/p}%`):this.setRotation(x,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:o}=this;e%180!==0&&([r,o]=[o,r]),t.style.width=`${100*r/s}%`,t.style.height=`${100*o/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],o=r[0],c=r.slice(1);i.target.style[s]=$U[`${o}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[s]:$U[`${o}_rgb`](c)})};return ot(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const o=s[i];if(o){const c={detail:{[i]:r},target:e};o(c),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,b,y,C]=e.subarray(2,6);if(i===g&&r===b&&t===y&&s===C)return}const{style:o}=this.container;let c;if(l(this,yv)){const{borderColor:g,borderWidth:b}=o;o.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const d=i-t,h=r-s,{svgFactory:u}=this,p=u.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0),p.role="none";const f=u.createElement("defs");p.append(f);const m=u.createElement("clipPath"),x=`clippath_${this.data.id}`;m.setAttribute("id",x),m.setAttribute("clipPathUnits","objectBoundingBox"),f.append(m);for(let g=2,b=e.length;g<b;g+=8){const y=e[g],C=e[g+1],w=e[g+2],S=e[g+3],j=u.createElement("rect"),T=(w-t)/d,k=(r-C)/h,_=(y-w)/d,L=(C-S)/h;j.setAttribute("x",T),j.setAttribute("y",k),j.setAttribute("width",_),j.setAttribute("height",L),m.append(j),c==null||c.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${k}" width="${_}" height="${L}"/>`)}l(this,yv)&&(c.push("</g></svg>')"),o.backgroundImage=c.join("")),this.container.append(p),this.container.style.clipPath=`url(#${x})`}_createPopup(e=null){const{data:t}=this;let s,i;e?(s={str:e.text},i=e.date):(s=t.contentsObj,i=t.modificationDate),v(this,Ho,new c4({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(l(this,Ho)||this.popup||this.data.popupRef)}get extraPopupElement(){return l(this,Ho)}render(){Cs("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:o,exportValues:c}of i){if(r===-1||o===t)continue;const d=typeof c=="string"?c:null,h=document.querySelector(`[data-element-id="${o}"]`);if(h&&!Q0.has(h)){tt(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:d,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&Q0.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}},Xg=new WeakMap,yv=new WeakMap,Ho=new WeakMap,Zj=new WeakSet,l4=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:c,pageY:d}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-c)/r}%`,t.top=`${100*(o-e[3]+d)/o}%`,i===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(i)},bv),Yde=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}};var po,Um,hq,uq,A8;let x3=(A8=class extends Rn{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});A(this,po);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),r=!0):t.attachment?(E(this,po,hq).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(E(this,po,uq).call(this,i,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=i,this.container.append(i)),this.container}_bindLink(t,s,i=""){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&E(this,po,Um).call(this),i&&(t.title=i)}_bindNamedAction(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(t.title=i),E(this,po,Um).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const o=i.get(r);o&&(t[o]=()=>{var c;return(c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}s.overlaidText&&(t.title=s.overlaidText),t.onclick||(t.onclick=()=>!1),E(this,po,Um).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),E(this,po,Um).call(this),!this._fieldObjects){tt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var p;i==null||i();const{fields:r,refs:o,include:c}=s,d=[];if(r.length!==0||o.length!==0){const f=new Set(o);for(const m of r){const x=this._fieldObjects[m]||[];for(const{id:g}of x)f.add(g)}for(const m of Object.values(this._fieldObjects))for(const x of m)f.has(x.id)===c&&d.push(x)}else for(const f of Object.values(this._fieldObjects))d.push(...f);const h=this.annotationStorage,u=[];for(const f of d){const{id:m}=f;switch(u.push(m),f.type){case"text":{const g=f.defaultValue||"";h.setValue(m,{value:g});break}case"checkbox":case"radiobutton":{const g=f.defaultValue===f.exportValues;h.setValue(m,{value:g});break}case"combobox":case"listbox":{const g=f.defaultValue||"";h.setValue(m,{value:g});break}default:continue}const x=document.querySelector(`[data-element-id="${m}"]`);if(x){if(!Q0.has(x)){tt(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;x.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}},po=new WeakSet,Um=function(){this.container.setAttribute("data-internal-link","")},hq=function(t,s,i="",r=null){t.href=this.linkService.getAnchorUrl(""),s.description?t.title=s.description:i&&(t.title=i),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(s.content,s.filename,r),!1},E(this,po,Um).call(this)},uq=function(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(t.title=i),E(this,po,Um).call(this)},A8),Xde=class extends Rn{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}},ry=class extends Rn{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Yi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,o=>{var c;(c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(s,o=>{var c;if(s==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(e,t,s,i){var r,o,c;for(const[d,h]of s)(h==="Action"||(r=this.data.actions)!=null&&r[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,d,h,i),h==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((c=this.data.actions)!=null&&c.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":_e.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Wde,r=e.style;let o;const c=2,d=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c),u=Math.round(h/(pR*i))||1,p=h/u;o=Math.min(i,d(p/pR))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c);o=Math.min(i,d(h/pR))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=_e.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},Kde=class extends ry{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=s),r.setValue(o.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let c=o.value||"";const d=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;d&&c.length>d&&(c=c.slice(0,d));let h=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const u={userValue:c,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??c,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??c),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Q0.add(s),this.contentElement=s,s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:p,datetimeType:f,timeStep:m}=this.data,x=!!f&&this.enableScripting;p&&(s.title=p),this._setRequired(s,this.data.required),d&&(s.maxLength=d),s.addEventListener("input",b=>{e.setValue(t,{value:b.target.value}),this.setPropertyOnSiblings(s,"value",b.target.value,"value"),u.formattedValue=null}),s.addEventListener("resetform",b=>{const y=this.data.defaultFieldValue??"";s.value=u.userValue=y,u.formattedValue=null});let g=b=>{const{formattedValue:y}=u;y!=null&&(b.target.value=y),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",y=>{var w;if(u.focused)return;const{target:C}=y;if(x&&(C.type=f,m&&(C.step=m)),u.userValue){const S=u.userValue;if(x)if(f==="time"){const j=new Date(S),T=[j.getHours(),j.getMinutes(),j.getSeconds()];C.value=T.map(k=>k.toString().padStart(2,"0")).join(":")}else C.value=new Date(S-qde).toISOString().split(f==="date"?"T":".",1)[0];else C.value=S}u.lastCommittedValue=C.value,u.commitKey=1,(w=this.data.actions)!=null&&w.Focus||(u.focused=!0)}),s.addEventListener("updatefromsandbox",y=>{this.showElementAndHideCanvas(y.target);const C={value(w){u.userValue=w.detail.value??"",x||e.setValue(t,{value:u.userValue.toString()}),w.target.value=u.userValue},formattedValue(w){const{formattedValue:S}=w.detail;u.formattedValue=S,S!=null&&w.target!==document.activeElement&&(w.target.value=S);const j={formattedValue:S};x&&(j.value=S),e.setValue(t,j)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{var k;const{charLimit:S}=w.detail,{target:j}=w;if(S===0){j.removeAttribute("maxLength");return}j.setAttribute("maxLength",S);let T=u.userValue;!T||T.length<=S||(T=T.slice(0,S),j.value=u.userValue=T,e.setValue(t,{value:T}),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:j.selectionStart,selEnd:j.selectionEnd}}))}};this._dispatchEventFromSandbox(C,y)}),s.addEventListener("keydown",y=>{var S;u.commitKey=1;let C=-1;if(y.key==="Escape"?C=0:y.key==="Enter"&&!this.data.multiLine?C=2:y.key==="Tab"&&(u.commitKey=3),C===-1)return;const{value:w}=y.target;u.lastCommittedValue!==w&&(u.lastCommittedValue=w,u.userValue=w,(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:C,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}}))});const b=g;g=null,s.addEventListener("blur",y=>{var S,j;if(!u.focused||!y.relatedTarget)return;(S=this.data.actions)!=null&&S.Blur||(u.focused=!1);const{target:C}=y;let{value:w}=C;if(x){if(w&&f==="time"){const T=w.split(":").map(k=>parseInt(k,10));w=new Date(2e3,0,1,T[0],T[1],T[2]||0).valueOf(),C.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();C.type="text"}u.userValue=w,u.lastCommittedValue!==w&&((j=this.linkService.eventBus)==null||j.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:u.commitKey,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}})),b(y)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",y=>{var L;u.lastCommittedValue=null;const{data:C,target:w}=y,{value:S,selectionStart:j,selectionEnd:T}=w;let k=j,_=T;switch(y.inputType){case"deleteWordBackward":{const D=S.substring(0,j).match(/\w*[^\w]*$/);D&&(k-=D[0].length);break}case"deleteWordForward":{const D=S.substring(j).match(/^[^\w]*\w*/);D&&(_+=D[0].length);break}case"deleteContentBackward":j===T&&(k-=1);break;case"deleteContentForward":j===T&&(_+=1);break}y.preventDefault(),(L=this.linkService.eventBus)==null||L.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,change:C||"",willCommit:!1,selStart:k,selEnd:_}})}),this._setEventListeners(s,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],y=>y.target.value)}if(g&&s.addEventListener("blur",g),this.data.comb){const y=(this.data.rect[2]-this.data.rect[0])/d;s.classList.add("comb"),s.style.letterSpacing=`calc(${y}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},Qde=class extends ry{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},Jde=class extends ry{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Q0.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:c,checked:d}=o.target;for(const h of this._getElementsByName(c,s)){const u=d&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=u),e.setValue(h.id,{value:u})}e.setValue(s,{value:d})}),r.addEventListener("resetform",o=>{const c=t.defaultFieldValue||"Off";o.target.checked=c===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const c={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(s,{value:d.target.checked})}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},pq=class extends ry{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,s))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(Q0.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:c,checked:d}=o.target;for(const h of this._getElementsByName(c,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:d})}),r.addEventListener("resetform",o=>{const c=t.defaultFieldValue;o.target.checked=c!=null&&c===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",c=>{const d={value:h=>{const u=o===h.detail.value;for(const p of this._getElementsByName(h.target.name)){const f=u&&p.id===s;p.domElement&&(p.domElement.checked=f),e.setValue(p.id,{value:f})}}};this._dispatchEventFromSandbox(d,c)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},Zde=class extends x3{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}},ehe=class extends ry{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Q0.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{const p=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===p});for(const u of this.data.options){const p=document.createElement("option");p.textContent=u.displayValue,p.value=u.exportValue,s.value.includes(u.exportValue)&&(p.setAttribute("selected",!0),r=!1),i.append(p)}let o=null;if(r){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),o=()=>{u.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const c=u=>{const p=u?"value":"textContent",{options:f,multiple:m}=i;return m?Array.prototype.filter.call(f,x=>x.selected).map(x=>x[p]):f.selectedIndex===-1?null:f[f.selectedIndex][p]};let d=c(!1);const h=u=>{const p=u.target.options;return Array.prototype.map.call(p,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{const p={value(f){o==null||o();const m=f.detail.value,x=new Set(Array.isArray(m)?m:[m]);for(const g of i.options)g.selected=x.has(g.value);e.setValue(t,{value:c(!0)}),d=c(!1)},multipleSelection(f){i.multiple=!0},remove(f){const m=i.options,x=f.detail.remove;m[x].selected=!1,i.remove(x),m.length>0&&Array.prototype.findIndex.call(m,b=>b.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:c(!0),items:h(f)}),d=c(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),d=c(!1)},insert(f){const{index:m,displayValue:x,exportValue:g}=f.detail.insert,b=i.children[m],y=document.createElement("option");y.textContent=x,y.value=g,b?b.before(y):i.append(y),e.setValue(t,{value:c(!0),items:h(f)}),d=c(!1)},items(f){const{items:m}=f.detail;for(;i.length!==0;)i.remove(0);for(const x of m){const{displayValue:g,exportValue:b}=x,y=document.createElement("option");y.textContent=g,y.value=b,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:c(!0),items:h(f)}),d=c(!1)},indices(f){const m=new Set(f.detail.indices);for(const x of f.target.options)x.selected=m.has(x.index);e.setValue(t,{value:c(!0)}),d=c(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(p,u)}),i.addEventListener("input",u=>{var m;const p=c(!0),f=c(!1);e.setValue(t,{value:p}),u.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:f,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){e.setValue(t,{value:c(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}};var e2,d4,E8;let c4=(E8=class extends Rn{constructor(t){const{data:s,elements:i,parent:r}=t,o=!!r._commentManager;super(t,{isRenderable:!o&&Rn._hasPopupData(s)});A(this,e2);if(this.elements=i,o&&Rn._hasPopupData(s)){const c=this.popup=E(this,e2,d4).call(this);for(const d of i)d.popup=c}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const s=this.popup=E(this,e2,d4).call(this),i=[];for(const r of this.elements)r.popup=s,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${eb}${r}`).join(",")),this.container}},e2=new WeakSet,d4=function(){return new the({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})},E8);var _a,Mp,$P,UP,vv,wv,dn,Bc,Fp,Kg,Sv,Cv,$c,Pa,Sh,Ch,hn,Nh,Op,t2,jh,Nv,Qg,Bp,ri,$p,ut,NT,h4,u4,p4,jT,f4,fq,mq,gq,xq,AT,ET,m4,k8;let the=(k8=class{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:c,parent:d,rect:h,parentRect:u,open:p,commentManager:f=null}){A(this,ut);A(this,_a,null);A(this,Mp,E(this,ut,gq).bind(this));A(this,$P,E(this,ut,m4).bind(this));A(this,UP,E(this,ut,ET).bind(this));A(this,vv,E(this,ut,AT).bind(this));A(this,wv,null);A(this,dn,null);A(this,Bc,null);A(this,Fp,null);A(this,Kg,null);A(this,Sv,null);A(this,Cv,null);A(this,$c,!1);A(this,Pa,null);A(this,Sh,null);A(this,Ch,null);A(this,hn,null);A(this,Nh,null);A(this,Op,null);A(this,t2,null);A(this,jh,null);A(this,Nv,null);A(this,Qg,null);A(this,Bp,!1);A(this,ri,null);A(this,$p,null);v(this,dn,e),v(this,Nv,i),v(this,Bc,o),v(this,jh,c),v(this,Sv,d),v(this,wv,t),v(this,t2,h),v(this,Cv,u),v(this,Kg,s),v(this,_a,f),v(this,ri,s[0]),v(this,Fp,jM.toDateObject(r)),this.trigger=s.flatMap(m=>m.getElementsToTriggerPopup()),f||(E(this,ut,NT).call(this),l(this,dn).hidden=!0,p&&E(this,ut,AT).call(this))}renderCommentButton(){if(l(this,hn)){l(this,hn).parentNode||l(this,ri).container.after(l(this,hn));return}if(l(this,Nh)||E(this,ut,h4).call(this),!l(this,Nh))return;const{signal:e}=v(this,Sh,new AbortController),t=l(this,ri).hasOwnCommentButton,s=()=>{l(this,_a).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{l(this,_a).toggleCommentPopup(this,!1,!0,!t)},r=()=>{l(this,_a).toggleCommentPopup(this,!1,!1)};if(t){v(this,hn,l(this,ri).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",l(this,Mp),{signal:e}),o.addEventListener("click",s,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=v(this,hn,document.createElement("button"));o.className="annotationCommentButton";const c=l(this,ri).container;o.style.zIndex=c.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),E(this,ut,p4).call(this),E(this,ut,u4).call(this),o.addEventListener("keydown",l(this,Mp),{signal:e}),o.addEventListener("click",s,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),c.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=l(this,ri).commentData;return e?l(this,Sv)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=l(this,hn))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}=l(this,ri).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}}get elementBeforePopup(){return l(this,hn)}get comment(){return l(this,$p)||v(this,$p,l(this,ri).commentText),l(this,$p)}set comment(e){e!==this.comment&&(l(this,ri).commentText=v(this,$p,e))}focus(){var e;(e=l(this,ri).container)==null||e.focus()}get parentBoundingClientRect(){return l(this,ri).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){l(this,hn)&&(l(this,hn).classList.toggle("selected",e),l(this,hn).ariaExpanded=t)}setSelectedCommentButton(e){l(this,hn).classList.toggle("selected",e)}get commentPopupPosition(){if(l(this,Op))return l(this,Op);const{x:e,y:t,height:s}=l(this,hn).getBoundingClientRect(),{x:i,y:r,width:o,height:c}=l(this,ri).layer.getBoundingClientRect();return[(e-i)/o,(t+s-r)/c]}set commentPopupPosition(e){v(this,Op,e)}hasDefaultPopupPosition(){return l(this,Op)===null}get commentButtonPosition(){return l(this,Nh)}get commentButtonWidth(){return l(this,hn).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=l(this,Op)||this.commentButtonPosition.map(h=>h/100),i=this.parentBoundingClientRect,{x:r,y:o,width:c,height:d}=i;l(this,_a).showDialog(null,this,r+t*c,o+s*d,{...e,parentDimensions:i})}render(){var s,i;if(l(this,Pa))return;const e=v(this,Pa,document.createElement("div"));if(e.className="popup",l(this,wv)){const r=e.style.outlineColor=_e.makeHexColor(...l(this,wv));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(s=l(this,Nv))!=null&&s.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=l(this,Nv)}if(e.append(t),l(this,Fp)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,Fp).valueOf()})),r.dateTime=l(this,Fp).toISOString(),t.append(r)}t9({html:l(this,ut,jT)||l(this,Bc).str,dir:(i=l(this,Bc))==null?void 0:i.dir,className:"popupContent"},e),l(this,dn).append(e)}updateEdited({rect:e,popup:t,deleted:s}){var i;if(l(this,_a)){s?(this.remove(),v(this,$p,null)):t&&(t.deleted?this.remove():(E(this,ut,p4).call(this),v(this,$p,t.text))),e&&(v(this,Nh,null),E(this,ut,h4).call(this),E(this,ut,u4).call(this));return}if(s||t!=null&&t.deleted){this.remove();return}E(this,ut,NT).call(this),l(this,Qg)||v(this,Qg,{contentsObj:l(this,Bc),richText:l(this,jh)}),e&&v(this,Ch,null),t&&t.text&&(v(this,jh,E(this,ut,mq).call(this,t.text)),v(this,Fp,jM.toDateObject(t.date)),v(this,Bc,null)),(i=l(this,Pa))==null||i.remove(),v(this,Pa,null)}resetEdited(){var e;l(this,Qg)&&({contentsObj:vt(this,Bc)._,richText:vt(this,jh)._}=l(this,Qg),v(this,Qg,null),(e=l(this,Pa))==null||e.remove(),v(this,Pa,null),v(this,Ch,null))}remove(){var e,t,s;if((e=l(this,Sh))==null||e.abort(),v(this,Sh,null),(t=l(this,Pa))==null||t.remove(),v(this,Pa,null),v(this,Bp,!1),v(this,$c,!1),(s=l(this,hn))==null||s.remove(),v(this,hn,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){v(this,Bp,this.isVisible),l(this,Bp)&&(l(this,dn).hidden=!0)}maybeShow(){l(this,_a)||(E(this,ut,NT).call(this),l(this,Bp)&&(l(this,Pa)||E(this,ut,ET).call(this),v(this,Bp,!1),l(this,dn).hidden=!1))}get isVisible(){return l(this,_a)?!1:l(this,dn).hidden===!1}},_a=new WeakMap,Mp=new WeakMap,$P=new WeakMap,UP=new WeakMap,vv=new WeakMap,wv=new WeakMap,dn=new WeakMap,Bc=new WeakMap,Fp=new WeakMap,Kg=new WeakMap,Sv=new WeakMap,Cv=new WeakMap,$c=new WeakMap,Pa=new WeakMap,Sh=new WeakMap,Ch=new WeakMap,hn=new WeakMap,Nh=new WeakMap,Op=new WeakMap,t2=new WeakMap,jh=new WeakMap,Nv=new WeakMap,Qg=new WeakMap,Bp=new WeakMap,ri=new WeakMap,$p=new WeakMap,ut=new WeakSet,NT=function(){var t;if(l(this,Sh))return;v(this,Sh,new AbortController);const{signal:e}=l(this,Sh);for(const s of this.trigger)s.addEventListener("click",l(this,vv),{signal:e}),s.addEventListener("pointerenter",l(this,UP),{signal:e}),s.addEventListener("pointerleave",l(this,$P),{signal:e}),s.classList.add("popupTriggerArea");for(const s of l(this,Kg))(t=s.container)==null||t.addEventListener("keydown",l(this,Mp),{signal:e})},h4=function(){const e=l(this,Kg).find(t=>t.hasCommentButton);e&&v(this,Nh,e._normalizePoint(e.commentButtonPosition))},u4=function(){if(l(this,ri).extraPopupElement&&!l(this,ri).editor)return;l(this,hn)||this.renderCommentButton();const[e,t]=l(this,Nh),{style:s}=l(this,hn);s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`},p4=function(){l(this,ri).extraPopupElement||(l(this,hn)||this.renderCommentButton(),l(this,hn).style.backgroundColor=this.commentButtonColor||"")},jT=function(){const e=l(this,jh),t=l(this,Bc);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&l(this,jh).html||null},f4=function(){var e,t,s;return((s=(t=(e=l(this,ut,jT))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},fq=function(){var e,t,s;return((s=(t=(e=l(this,ut,jT))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},mq=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:l(this,ut,fq),fontSize:l(this,ut,f4)?`calc(${l(this,ut,f4)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},gq=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&l(this,$c))&&E(this,ut,AT).call(this)},xq=function(){if(l(this,Ch)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=l(this,Sv);let o=!!l(this,Cv),c=o?l(this,Cv):l(this,t2);for(const x of l(this,Kg))if(!c||_e.intersect(x.data.rect,c)!==null){c=x.data.rect,o=!0;break}const d=_e.normalizeRect([c[0],e[3]-c[1]+e[1],c[2],e[3]-c[3]+e[1]]),u=o?c[2]-c[0]+5:0,p=d[0]+u,f=d[1];v(this,Ch,[100*(p-i)/t,100*(f-r)/s]);const{style:m}=l(this,dn);m.left=`${l(this,Ch)[0]}%`,m.top=`${l(this,Ch)[1]}%`},AT=function(){if(l(this,_a)){l(this,_a).toggleCommentPopup(this,!1);return}v(this,$c,!l(this,$c)),l(this,$c)?(E(this,ut,ET).call(this),l(this,dn).addEventListener("click",l(this,vv)),l(this,dn).addEventListener("keydown",l(this,Mp))):(E(this,ut,m4).call(this),l(this,dn).removeEventListener("click",l(this,vv)),l(this,dn).removeEventListener("keydown",l(this,Mp)))},ET=function(){l(this,Pa)||this.render(),this.isVisible?l(this,$c)&&l(this,dn).classList.add("focused"):(E(this,ut,xq).call(this),l(this,dn).hidden=!1,l(this,dn).style.zIndex=parseInt(l(this,dn).style.zIndex)+1e3)},m4=function(){l(this,dn).classList.remove("focused"),!(l(this,$c)||!this.isVisible)&&(l(this,dn).hidden=!0,l(this,dn).style.zIndex=parseInt(l(this,dn).style.zIndex)-1e3)},k8),yq=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=rt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}};var s2,T8;let she=(T8=class extends Rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,s2,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=v(this,s2,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,s2)}addHighlightArea(){this.container.classList.add("highlightArea")}},s2=new WeakMap,T8);var n2,_8;let nhe=(_8=class extends Rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,n2,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,c=v(this,n2,this.svgFactory.createElement("svg:rect"));return c.setAttribute("x",o/2),c.setAttribute("y",o/2),c.setAttribute("width",s-o),c.setAttribute("height",i-o),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,n2)}addHighlightArea(){this.container.classList.add("highlightArea")}},n2=new WeakMap,_8);var i2,P8;let ihe=(P8=class extends Rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,i2,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,c=v(this,i2,this.svgFactory.createElement("svg:ellipse"));return c.setAttribute("cx",s/2),c.setAttribute("cy",i/2),c.setAttribute("rx",s/2-o/2),c.setAttribute("ry",i/2-o/2),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,i2)}addHighlightArea(){this.container.classList.add("highlightArea")}},i2=new WeakMap,P8);var r2,L8;let bq=(L8=class extends Rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,r2,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r},width:o,height:c}=this;if(!s)return this.container;const d=this.svgFactory.create(o,c,!0);let h=[];for(let p=0,f=s.length;p<f;p+=2){const m=s[p]-t[0],x=t[3]-s[p+1];h.push(`${m},${x}`)}h=h.join(" ");const u=v(this,r2,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",h),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),d.append(u),this.container.append(d),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,r2)}addHighlightArea(){this.container.classList.add("highlightArea")}},r2=new WeakMap,L8),rhe=class extends bq{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},ahe=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}};var a2,Jg,o2,g4,D8;let y3=(D8=class extends Rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,o2);A(this,a2,null);A(this,Jg,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?rt.HIGHLIGHT:rt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:c,width:d,height:h}=E(this,o2,g4).call(this,s,t),u=this.svgFactory.create(d,h,!0),p=v(this,a2,this.svgFactory.createElement("svg:g"));u.append(p),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",c);for(let f=0,m=i.length;f<m;f++){const x=this.svgFactory.createElement(this.svgElementName);l(this,Jg).push(x),x.setAttribute("points",i[f].join(",")),p.append(x)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,o=l(this,a2);if(s>=0&&o.setAttribute("stroke-width",s||1),i)for(let c=0,d=l(this,Jg).length;c<d;c++)l(this,Jg)[c].setAttribute("points",i[c].join(","));if(r){const{transform:c,width:d,height:h}=E(this,o2,g4).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${d} ${h}`),o.setAttribute("transform",c)}}getElementsToTriggerPopup(){return l(this,Jg)}addHighlightArea(){this.container.classList.add("highlightArea")}},a2=new WeakMap,Jg=new WeakMap,o2=new WeakSet,g4=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}},D8),vq=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=rt.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}},ohe=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}},lhe=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}},che=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}},wq=class extends Rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=rt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}};var l2,c2,x4,R8;let dhe=(R8=class extends Rn{constructor(t){var i;super(t,{isRenderable:!0});A(this,c2);A(this,l2,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",E(this,c2,x4).bind(this)),v(this,l2,i);const{isMac:r}=Yi.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&E(this,c2,x4).call(this)}),!s.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return l(this,l2)}addHighlightArea(){this.container.classList.add("highlightArea")}},l2=new WeakMap,c2=new WeakSet,x4=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)},R8);var Zg,ex,jv,Up,d2,tx,La,h2,ju,kT,y4,Av;let hhe=(Av=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:c,commentManager:d,linkService:h,annotationStorage:u}){A(this,ju);A(this,Zg,null);A(this,ex,null);A(this,jv,null);A(this,Up,new Map);A(this,d2,null);A(this,tx,null);A(this,La,[]);A(this,h2,!1);this.div=e,v(this,Zg,t),v(this,ex,s),v(this,d2,c||null),v(this,tx,h||null),v(this,jv,u||new f3),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=d||null}hasEditableAnnotations(){return l(this,Up).size>0}async render(e){var c;const{annotations:t}=e,s=this.div;X0(s,this.viewport);const i=new Map,r=[],o={data:null,layer:s,linkService:l(this,tx),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new xP,annotationStorage:l(this,jv),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const d of t){if(d.noHTML)continue;const h=d.annotationType===Un.POPUP;if(h){const f=i.get(d.id);if(!f)continue;if(!this._commentManager){r.push(d);continue}o.elements=f}else if(d.rect[2]===d.rect[0]||d.rect[3]===d.rect[1])continue;o.data=d;const u=wR.create(o);if(!u.isRenderable)continue;if(!h&&(l(this,La).push(u),d.popupRef)){const f=i.get(d.popupRef);f?f.push(u):i.set(d.popupRef,[u])}const p=u.render();d.hidden&&(p.style.visibility="hidden"),u._isEditable&&(l(this,Up).set(u.data.id,u),(c=this._annotationEditorUIManager)==null||c.renderAnnotationElement(u))}await E(this,ju,kT).call(this);for(const d of r){const h=o.elements=i.get(d.id);o.data=d;const u=wR.create(o);if(!u.isRenderable)continue;const p=u.render();u.contentElement.id=`${eb}${d.id}`,d.hidden&&(p.style.visibility="hidden"),h.at(-1).container.after(p)}E(this,ju,y4).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:l(this,tx),svgFactory:new xP,parent:this};for(const s of e){s.borderStyle||(s.borderStyle=Av._defaultBorderStyle),t.data=s;const i=wR.create(t);i.isRenderable&&(i.render(),i.contentElement.id=`${eb}${s.id}`,l(this,La).push(i))}await E(this,ju,kT).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,X0(t,{rotation:e.rotation}),E(this,ju,y4).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(l(this,Up).values())}getEditableAnnotation(e){return l(this,Up).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:s,rotation:i}=e,r=new Yde({data:{id:s,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:l(this,tx),annotationStorage:l(this,jv)});return r.render(),r.contentElement.id=`${eb}${s}`,r.createOrUpdatePopup(),l(this,La).push(r),r}removeAnnotation(e){var i;const t=l(this,La).findIndex(r=>r.data.id===e);if(t<0)return;const[s]=l(this,La).splice(t,1);(i=l(this,Zg))==null||i.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);E(this,ju,kT).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return ot(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:vy.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},Zg=new WeakMap,ex=new WeakMap,jv=new WeakMap,Up=new WeakMap,d2=new WeakMap,tx=new WeakMap,La=new WeakMap,h2=new WeakMap,ju=new WeakSet,kT=async function(){var s,i,r;if(l(this,La).length===0)return;this.div.replaceChildren();const e=[];if(!l(this,h2)){v(this,h2,!0);for(const{contentElement:o,data:{id:c}}of l(this,La)){const d=o.id=`${eb}${c}`;e.push((s=l(this,d2))==null?void 0:s.getAriaAttributes(d).then(h=>{if(h)for(const[u,p]of h)o.setAttribute(u,p)}))}}l(this,La).sort(({data:{rect:[o,c,d,h]}},{data:{rect:[u,p,f,m]}})=>{if(o===d&&c===h)return 1;if(u===f&&p===m)return-1;const x=h,g=c,b=(c+h)/2,y=m,C=p,w=(p+m)/2;if(b>=y&&w<=g)return-1;if(w>=x&&b<=C)return 1;const S=(o+d)/2,j=(u+f)/2;return S-j});const t=document.createDocumentFragment();for(const o of l(this,La))t.append(o.container),this._commentManager?(r=((i=o.extraPopupElement)==null?void 0:i.popup)||o.popup)==null||r.renderCommentButton():o.extraPopupElement&&t.append(o.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),l(this,Zg))for(const o of l(this,La))l(this,Zg).addPointerInTextLayer(o.contentElement,!1)},y4=function(){var t;if(!l(this,ex))return;const e=this.div;for(const[s,i]of l(this,ex)){const r=e.querySelector(`[data-annotation-id="${s}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(i):o.classList.contains("annotationContent")?o.after(i):o.before(i):r.append(i);const c=l(this,Up).get(s);c&&(c._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,r.id,i),c._hasNoCanvas=!1):c.canvas=i)}l(this,ex).clear()},Av);const kk=/\r\n?|\n/g;var Da,u2,sx,Ra,ls,Wn,Sq,Cq,Nq,TT,Au,_T,PT,jq,b4,Aq;let uhe=(ls=class extends Ws{constructor(t){super({...t,name:"freeTextEditor"});A(this,Wn);A(this,Da,"");A(this,u2,`${this.id}-editor`);A(this,sx,null);A(this,Ra);W(this,"_colorPicker",null);this.color=t.color||ls._defaultColor||Ws._defaultLineColor,v(this,Ra,t.fontSize||ls._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=ls.prototype,s=o=>o.isEmpty(),i=LN.TRANSLATE_SMALL,r=LN.TRANSLATE_BIG;return ot(this,"_keyboardManager",new EE([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){Ws.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case jt.FREETEXT_SIZE:ls._defaultFontSize=s;break;case jt.FREETEXT_COLOR:ls._defaultColor=s;break}}updateParams(t,s){switch(t){case jt.FREETEXT_SIZE:E(this,Wn,Sq).call(this,s);break;case jt.FREETEXT_COLOR:E(this,Wn,Cq).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[jt.FREETEXT_SIZE,ls._defaultFontSize],[jt.FREETEXT_COLOR,ls._defaultColor||Ws._defaultLineColor]]}get propertiesToUpdate(){return[[jt.FREETEXT_SIZE,l(this,Ra)],[jt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new dq(this)),[["colorPicker",this._colorPicker]]}get colorType(){return jt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-ls._internalPadding*t,-(ls._internalPadding+l(this,Ra))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),v(this,sx,new AbortController);const t=this._uiManager.combinedSignal(l(this,sx));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,u2)),this._isDraggable=!0,(t=l(this,sx))==null||t.abort(),v(this,sx,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=l(this,Da),s=v(this,Da,E(this,Wn,Nq).call(this).trimEnd());if(t===s)return;const i=r=>{if(v(this,Da,r),!r){this.remove();return}E(this,Wn,PT).call(this),this._uiManager.rebuild(this),E(this,Wn,TT).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),E(this,Wn,TT).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){ls._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,u2)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${l(this,Ra)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:c}=this._initialData;let[d,h]=this.getInitialTranslation();[d,h]=this.pageTranslationToScreen(d,h);const[u,p]=this.pageDimensions,[f,m]=this.pageTranslation;let x,g;switch(this.rotation){case 0:x=t+(c[0]-f)/u,g=s+this.height-(c[1]-m)/p;break;case 90:x=t+(c[0]-f)/u,g=s-(c[1]-m)/p,[d,h]=[h,-d];break;case 180:x=t-this.width+(c[0]-f)/u,g=s-(c[1]-m)/p,[d,h]=[-d,-h];break;case 270:x=t+(c[0]-f-this.height*p)/u,g=s+(c[1]-m-this.width*u)/p,[d,h]=[-h,d];break}this.setAt(x*r,g*o,d,h)}else this._moveAfterPaste(t,s);E(this,Wn,PT).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var x,g,b;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=E(x=ls,Au,b4).call(x,s.getData("text")||"").replaceAll(kk,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const c=o.getRangeAt(0);if(!r.includes(`
`)){c.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:d,startOffset:h}=c,u=[],p=[];if(d.nodeType===Node.TEXT_NODE){const y=d.parentElement;if(p.push(d.nodeValue.slice(h).replaceAll(kk,"")),y!==this.editorDiv){let C=u;for(const w of this.editorDiv.childNodes){if(w===y){C=p;continue}C.push(E(g=ls,Au,_T).call(g,w))}}u.push(d.nodeValue.slice(0,h).replaceAll(kk,""))}else if(d===this.editorDiv){let y=u,C=0;for(const w of this.editorDiv.childNodes)C++===h&&(y=p),y.push(E(b=ls,Au,_T).call(b,w))}v(this,Da,`${u.join(`
`)}${r}${p.join(`
`)}`),E(this,Wn,PT).call(this);const f=new Range;let m=Math.sumPrecise(u.map(y=>y.length));for(const{firstChild:y}of this.editorDiv.childNodes)if(y.nodeType===Node.TEXT_NODE){const C=y.nodeValue.length;if(m<=C){f.setStart(y,m),f.setEnd(y,m);break}m-=C}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=ls._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,s,i){var c;let r=null;if(t instanceof yq){const{data:{defaultAppearanceData:{fontSize:d,fontColor:h},rect:u,rotation:p,id:f,popupRef:m,richText:x,contentsObj:g,creationDate:b,modificationDate:y},textContent:C,textPosition:w,parent:{page:{pageNumber:S}}}=t;if(!C||C.length===0)return null;r=t={annotationType:rt.FREETEXT,color:Array.from(h),fontSize:d,value:C.join(`
`),position:w,pageIndex:S-1,rect:u.slice(0),rotation:p,annotationElementId:f,id:f,deleted:!1,popupRef:m,comment:(g==null?void 0:g.str)||null,richText:x,creationDate:b,modificationDate:y}}const o=await super.deserialize(t,s,i);return v(o,Ra,t.fontSize),o.color=_e.makeHexColor(...t.color),v(o,Da,E(c=ls,Au,b4).call(c,t.value)),o._initialData=r,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Ws._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:s,fontSize:l(this,Ra),value:E(this,Wn,jq).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!E(this,Wn,Aq).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(!s)return null;const{style:i}=s;i.fontSize=`calc(${l(this,Ra)}px * var(--total-scale-factor))`,i.color=this.color,s.replaceChildren();for(const r of l(this,Da).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),s.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:l(this,Da)}}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}},Da=new WeakMap,u2=new WeakMap,sx=new WeakMap,Ra=new WeakMap,Wn=new WeakSet,Sq=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-l(this,Ra))*this.parentScale),v(this,Ra,r),E(this,Wn,TT).call(this)},i=l(this,Ra);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:jt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Cq=function(t){const s=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:jt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Nq=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(E(i=ls,Au,_T).call(i,r)),s=r);return t.join(`
`)},TT=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,c=o.style.display,d=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=c,o.classList.toggle("hidden",d)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},Au=new WeakSet,_T=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(kk,"")},PT=function(){if(this.editorDiv.replaceChildren(),!!l(this,Da))for(const t of l(this,Da).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},jq=function(){return l(this,Da).replaceAll(""," ")},b4=function(t){return t.replaceAll(" ","")},Aq=function(t){const{value:s,fontSize:i,color:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((c,d)=>c!==r[d])||t.pageIndex!==o},A(ls,Au),W(ls,"_freeTextDefaultContent",""),W(ls,"_internalPadding",0),W(ls,"_defaultColor",null),W(ls,"_defaultFontSize",10),W(ls,"_type","freetext"),W(ls,"_editorType",rt.FREETEXT),ls);var qR;let Ee=(qR=class{toSVGPath(){Cs("Abstract method `toSVGPath` must be implemented.")}get box(){Cs("Abstract getter `box` must be implemented.")}serialize(e,t){Cs("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let c=0,d=e.length;c<d;c+=2)o[c]=t+e[c]*i,o[c+1]=s+e[c+1]*r;return o}static _rescaleAndSwap(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let c=0,d=e.length;c<d;c+=2)o[c]=t+e[c+1]*i,o[c+1]=s+e[c]*r;return o}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,o){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+o)/6,(s+r)/2,(i+o)/2]}},W(qR,"PRECISION",1e-4),qR);var Ia,Fl,Ev,kv,Uc,xt,nx,ix,p2,f2,Tv,_v,zp,ol,m2,zP,HP,ti,oC,kq,Tq,_q,Pq,Lq,Dq;let Eq=(ol=class{constructor({x:e,y:t},s,i,r,o,c=0){A(this,ti);A(this,Ia);A(this,Fl,[]);A(this,Ev);A(this,kv);A(this,Uc,[]);A(this,xt,new Float32Array(18));A(this,nx);A(this,ix);A(this,p2);A(this,f2);A(this,Tv);A(this,_v);A(this,zp,[]);v(this,Ia,s),v(this,_v,r*i),v(this,kv,o),l(this,xt).set([NaN,NaN,NaN,NaN,e,t],6),v(this,Ev,c),v(this,f2,l(ol,m2)*i),v(this,p2,l(ol,HP)*i),v(this,Tv,i),l(this,zp).push(e,t)}isEmpty(){return isNaN(l(this,xt)[8])}add({x:e,y:t}){var L;v(this,nx,e),v(this,ix,t);const[s,i,r,o]=l(this,Ia);let[c,d,h,u]=l(this,xt).subarray(8,12);const p=e-h,f=t-u,m=Math.hypot(p,f);if(m<l(this,p2))return!1;const x=m-l(this,f2),g=x/m,b=g*p,y=g*f;let C=c,w=d;c=h,d=u,h+=b,u+=y,(L=l(this,zp))==null||L.push(e,t);const S=-y/x,j=b/x,T=S*l(this,_v),k=j*l(this,_v);return l(this,xt).set(l(this,xt).subarray(2,8),0),l(this,xt).set([h+T,u+k],4),l(this,xt).set(l(this,xt).subarray(14,18),12),l(this,xt).set([h-T,u-k],16),isNaN(l(this,xt)[6])?(l(this,Uc).length===0&&(l(this,xt).set([c+T,d+k],2),l(this,Uc).push(NaN,NaN,NaN,NaN,(c+T-s)/r,(d+k-i)/o),l(this,xt).set([c-T,d-k],14),l(this,Fl).push(NaN,NaN,NaN,NaN,(c-T-s)/r,(d-k-i)/o)),l(this,xt).set([C,w,c,d,h,u],6),!this.isEmpty()):(l(this,xt).set([C,w,c,d,h,u],6),Math.abs(Math.atan2(w-d,C-c)-Math.atan2(y,b))<Math.PI/2?([c,d,h,u]=l(this,xt).subarray(2,6),l(this,Uc).push(NaN,NaN,NaN,NaN,((c+h)/2-s)/r,((d+u)/2-i)/o),[c,d,C,w]=l(this,xt).subarray(14,18),l(this,Fl).push(NaN,NaN,NaN,NaN,((C+c)/2-s)/r,((w+d)/2-i)/o),!0):([C,w,c,d,h,u]=l(this,xt).subarray(0,6),l(this,Uc).push(((C+5*c)/6-s)/r,((w+5*d)/6-i)/o,((5*c+h)/6-s)/r,((5*d+u)/6-i)/o,((c+h)/2-s)/r,((d+u)/2-i)/o),[h,u,c,d,C,w]=l(this,xt).subarray(12,18),l(this,Fl).push(((C+5*c)/6-s)/r,((w+5*d)/6-i)/o,((5*c+h)/6-s)/r,((5*d+u)/6-i)/o,((c+h)/2-s)/r,((d+u)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=l(this,Uc),t=l(this,Fl);if(isNaN(l(this,xt)[6])&&!this.isEmpty())return E(this,ti,kq).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);E(this,ti,_q).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return E(this,ti,Tq).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,o){return new Rq(e,t,s,i,r,o)}getOutlines(){var p;const e=l(this,Uc),t=l(this,Fl),s=l(this,xt),[i,r,o,c]=l(this,Ia),d=new Float32Array((((p=l(this,zp))==null?void 0:p.length)??0)+2);for(let f=0,m=d.length-2;f<m;f+=2)d[f]=(l(this,zp)[f]-i)/o,d[f+1]=(l(this,zp)[f+1]-r)/c;if(d[d.length-2]=(l(this,nx)-i)/o,d[d.length-1]=(l(this,ix)-r)/c,isNaN(s[6])&&!this.isEmpty())return E(this,ti,Pq).call(this,d);const h=new Float32Array(l(this,Uc).length+24+l(this,Fl).length);let u=e.length;for(let f=0;f<u;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}u=E(this,ti,Dq).call(this,h,u);for(let f=t.length-6;f>=6;f-=6)for(let m=0;m<6;m+=2){if(isNaN(t[f+m])){h[u]=h[u+1]=NaN,u+=2;continue}h[u]=t[f+m],h[u+1]=t[f+m+1],u+=2}return E(this,ti,Lq).call(this,h,u),this.newFreeDrawOutline(h,d,l(this,Ia),l(this,Tv),l(this,Ev),l(this,kv))}},Ia=new WeakMap,Fl=new WeakMap,Ev=new WeakMap,kv=new WeakMap,Uc=new WeakMap,xt=new WeakMap,nx=new WeakMap,ix=new WeakMap,p2=new WeakMap,f2=new WeakMap,Tv=new WeakMap,_v=new WeakMap,zp=new WeakMap,m2=new WeakMap,zP=new WeakMap,HP=new WeakMap,ti=new WeakSet,oC=function(){const e=l(this,xt).subarray(4,6),t=l(this,xt).subarray(16,18),[s,i,r,o]=l(this,Ia);return[(l(this,nx)+(e[0]-t[0])/2-s)/r,(l(this,ix)+(e[1]-t[1])/2-i)/o,(l(this,nx)+(t[0]-e[0])/2-s)/r,(l(this,ix)+(t[1]-e[1])/2-i)/o]},kq=function(){const[e,t,s,i]=l(this,Ia),[r,o,c,d]=E(this,ti,oC).call(this);return`M${(l(this,xt)[2]-e)/s} ${(l(this,xt)[3]-t)/i} L${(l(this,xt)[4]-e)/s} ${(l(this,xt)[5]-t)/i} L${r} ${o} L${c} ${d} L${(l(this,xt)[16]-e)/s} ${(l(this,xt)[17]-t)/i} L${(l(this,xt)[14]-e)/s} ${(l(this,xt)[15]-t)/i} Z`},Tq=function(e){const t=l(this,Fl);e.push(`L${t[4]} ${t[5]} Z`)},_q=function(e){const[t,s,i,r]=l(this,Ia),o=l(this,xt).subarray(4,6),c=l(this,xt).subarray(16,18),[d,h,u,p]=E(this,ti,oC).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-s)/r} L${d} ${h} L${u} ${p} L${(c[0]-t)/i} ${(c[1]-s)/r}`)},Pq=function(e){const t=l(this,xt),[s,i,r,o]=l(this,Ia),[c,d,h,u]=E(this,ti,oC).call(this),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(p,e,l(this,Ia),l(this,Tv),l(this,Ev),l(this,kv))},Lq=function(e,t){const s=l(this,Fl);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},Dq=function(e,t){const s=l(this,xt).subarray(4,6),i=l(this,xt).subarray(16,18),[r,o,c,d]=l(this,Ia),[h,u,p,f]=E(this,ti,oC).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/c,(s[1]-o)/d,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,p,f,NaN,NaN,NaN,NaN,(i[0]-r)/c,(i[1]-o)/d],t),t+=24},A(ol,m2,8),A(ol,zP,2),A(ol,HP,l(ol,m2)+l(ol,zP)),ol);var Pv,rx,Ah,g2,Ma,x2,En,VP,Iq,I8;let Rq=(I8=class extends Ee{constructor(t,s,i,r,o,c){super();A(this,VP);A(this,Pv);A(this,rx,new Float32Array(4));A(this,Ah);A(this,g2);A(this,Ma);A(this,x2);A(this,En);v(this,En,t),v(this,Ma,s),v(this,Pv,i),v(this,x2,r),v(this,Ah,o),v(this,g2,c),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],E(this,VP,Iq).call(this,c);const[d,h,u,p]=l(this,rx);for(let f=0,m=t.length;f<m;f+=2)t[f]=(t[f]-d)/u,t[f+1]=(t[f+1]-h)/p;for(let f=0,m=s.length;f<m;f+=2)s[f]=(s[f]-d)/u,s[f+1]=(s[f+1]-h)/p}toSVGPath(){const t=[`M${l(this,En)[4]} ${l(this,En)[5]}`];for(let s=6,i=l(this,En).length;s<i;s+=6){if(isNaN(l(this,En)[s])){t.push(`L${l(this,En)[s+4]} ${l(this,En)[s+5]}`);continue}t.push(`C${l(this,En)[s]} ${l(this,En)[s+1]} ${l(this,En)[s+2]} ${l(this,En)[s+3]} ${l(this,En)[s+4]} ${l(this,En)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],o){const c=i-t,d=r-s;let h,u;switch(o){case 0:h=Ee._rescale(l(this,En),t,r,c,-d),u=Ee._rescale(l(this,Ma),t,r,c,-d);break;case 90:h=Ee._rescaleAndSwap(l(this,En),t,s,c,d),u=Ee._rescaleAndSwap(l(this,Ma),t,s,c,d);break;case 180:h=Ee._rescale(l(this,En),i,s,-c,d),u=Ee._rescale(l(this,Ma),i,s,-c,d);break;case 270:h=Ee._rescaleAndSwap(l(this,En),i,r,-c,-d),u=Ee._rescaleAndSwap(l(this,Ma),i,r,-c,-d);break}return{outline:Array.from(h),points:[Array.from(u)]}}get box(){return l(this,rx)}newOutliner(t,s,i,r,o,c=0){return new Eq(t,s,i,r,o,c)}getNewOutline(t,s){const[i,r,o,c]=l(this,rx),[d,h,u,p]=l(this,Pv),f=o*u,m=c*p,x=i*u+d,g=r*p+h,b=this.newOutliner({x:l(this,Ma)[0]*f+x,y:l(this,Ma)[1]*m+g},l(this,Pv),l(this,x2),t,l(this,g2),s??l(this,Ah));for(let y=2;y<l(this,Ma).length;y+=2)b.add({x:l(this,Ma)[y]*f+x,y:l(this,Ma)[y+1]*m+g});return b.getOutlines()}},Pv=new WeakMap,rx=new WeakMap,Ah=new WeakMap,g2=new WeakMap,Ma=new WeakMap,x2=new WeakMap,En=new WeakMap,VP=new WeakSet,Iq=function(t){const s=l(this,En);let i=s[4],r=s[5];const o=[i,r,i,r];let c=i,d=r,h=i,u=r;const p=t?Math.max:Math.min,f=new Float32Array(4);for(let x=6,g=s.length;x<g;x+=6){const b=s[x+4],y=s[x+5];isNaN(s[x])?(_e.pointBoundingBox(b,y,o),d>y?(c=b,d=y):d===y&&(c=p(c,b)),u<y?(h=b,u=y):u===y&&(h=p(h,b))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,_e.bezierBoundingBox(i,r,...s.slice(x,x+6),f),_e.rectBoundingBox(f[0],f[1],f[2],f[3],o),d>f[1]?(c=f[0],d=f[1]):d===f[1]&&(c=p(c,f[0])),u<f[3]?(h=f[2],u=f[3]):u===f[3]&&(h=p(h,f[2]))),i=b,r=y}const m=l(this,rx);m[0]=o[0]-l(this,Ah),m[1]=o[1]-l(this,Ah),m[2]=o[2]-o[0]+2*l(this,Ah),m[3]=o[3]-o[1]+2*l(this,Ah),this.firstPoint=[c,d],this.lastPoint=[h,u]},I8);var y2,b2,v2,Hp,Ol,zr,Mq,LT,Fq,Oq,w4,M8;let v4=(M8=class{constructor(e,t=0,s=0,i=!0){A(this,zr);A(this,y2);A(this,b2);A(this,v2);A(this,Hp,[]);A(this,Ol,[]);const r=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:g,y:b,width:y,height:C}of e){const w=Math.floor((g-t)/o)*o,S=Math.ceil((g+y+t)/o)*o,j=Math.floor((b-t)/o)*o,T=Math.ceil((b+C+t)/o)*o,k=[w,j,T,!0],_=[S,j,T,!1];l(this,Hp).push(k,_),_e.rectBoundingBox(w,j,S,T,r)}const c=r[2]-r[0]+2*s,d=r[3]-r[1]+2*s,h=r[0]-s,u=r[1]-s;let p=i?-1/0:1/0,f=1/0;const m=l(this,Hp).at(i?-1:-2),x=[m[0],m[2]];for(const g of l(this,Hp)){const[b,y,C,w]=g;!w&&i?y<f?(f=y,p=b):y===f&&(p=Math.max(p,b)):w&&!i&&(y<f?(f=y,p=b):y===f&&(p=Math.min(p,b))),g[0]=(b-h)/c,g[1]=(y-u)/d,g[2]=(C-u)/d}v(this,y2,new Float32Array([h,u,c,d])),v(this,b2,[p,f]),v(this,v2,x)}getOutlines(){l(this,Hp).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of l(this,Hp))t[3]?(e.push(...E(this,zr,w4).call(this,t)),E(this,zr,Fq).call(this,t)):(E(this,zr,Oq).call(this,t),e.push(...E(this,zr,w4).call(this,t)));return E(this,zr,Mq).call(this,e)}},y2=new WeakMap,b2=new WeakMap,v2=new WeakMap,Hp=new WeakMap,Ol=new WeakMap,zr=new WeakSet,Mq=function(e){const t=[],s=new Set;for(const o of e){const[c,d,h]=o;t.push([c,d,o],[c,h,o])}t.sort((o,c)=>o[1]-c[1]||o[0]-c[0]);for(let o=0,c=t.length;o<c;o+=2){const d=t[o][2],h=t[o+1][2];d.push(h),h.push(d),s.add(d),s.add(h)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[c,d,h,u,p]=o;s.delete(o);let f=c,m=d;for(r=[c,h],i.push(r);;){let x;if(s.has(u))x=u;else if(s.has(p))x=p;else break;s.delete(x),[c,d,h,u,p]=x,f!==c&&(r.push(f,m,c,m===d?d:h),f=c),m=m===d?h:d}r.push(f,m)}return new phe(i,l(this,y2),l(this,b2),l(this,v2))},LT=function(e){const t=l(this,Ol);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,o=t[r][0];if(o===e)return r;o<e?s=r+1:i=r-1}return i+1},Fq=function([,e,t]){const s=E(this,zr,LT).call(this,e);l(this,Ol).splice(s,0,[e,t])},Oq=function([,e,t]){const s=E(this,zr,LT).call(this,e);for(let i=s;i<l(this,Ol).length;i++){const[r,o]=l(this,Ol)[i];if(r!==e)break;if(r===e&&o===t){l(this,Ol).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=l(this,Ol)[i];if(r!==e)break;if(r===e&&o===t){l(this,Ol).splice(i,1);return}}},w4=function(e){const[t,s,i]=e,r=[[t,s,i]],o=E(this,zr,LT).call(this,i);for(let c=0;c<o;c++){const[d,h]=l(this,Ol)[c];for(let u=0,p=r.length;u<p;u++){const[,f,m]=r[u];if(!(h<=f||m<=d)){if(f>=d){if(m>h)r[u][1]=h;else{if(p===1)return[];r.splice(u,1),u--,p--}continue}r[u][2]=d,m>h&&r.push([t,h,m])}}}return r},M8);var w2,Lv,F8;let phe=(F8=class extends Ee{constructor(t,s,i,r){super();A(this,w2);A(this,Lv);v(this,Lv,t),v(this,w2,s),this.firstPoint=i,this.lastPoint=r}toSVGPath(){const t=[];for(const s of l(this,Lv)){let[i,r]=s;t.push(`M${i} ${r}`);for(let o=2;o<s.length;o+=2){const c=s[o],d=s[o+1];c===i?(t.push(`V${d}`),r=d):d===r&&(t.push(`H${c}`),i=c)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],o){const c=[],d=i-t,h=r-s;for(const u of l(this,Lv)){const p=new Array(u.length);for(let f=0;f<u.length;f+=2)p[f]=t+u[f]*d,p[f+1]=r-u[f+1]*h;c.push(p)}return c}get box(){return l(this,w2)}get classNamesForOutlining(){return["highlightOutline"]}},w2=new WeakMap,Lv=new WeakMap,F8),S4=class extends Eq{newFreeDrawOutline(e,t,s,i,r,o){return new fhe(e,t,s,i,r,o)}},fhe=class extends Rq{newOutliner(e,t,s,i,r,o=0){return new S4(e,t,s,i,r,o)}};var Dv,S2,Eh,ax,C2,sa,N2,j2,ox,Fa,Oa,Pi,Rv,Iv,lr,Mv,Vo,A2,_t,dt,C4,DT,Bq,$q,Uq,N4,zm,cl,Ay,zq,RT,IT,Hq,Vq,Gq,Wq,qq;let UU=(_t=class extends Ws{constructor(t){super({...t,name:"highlightEditor"});A(this,dt);A(this,Dv,null);A(this,S2,0);A(this,Eh);A(this,ax,null);A(this,C2,null);A(this,sa,null);A(this,N2,null);A(this,j2,0);A(this,ox,null);A(this,Fa,null);A(this,Oa,null);A(this,Pi,!1);A(this,Rv,null);A(this,Iv,null);A(this,lr,null);A(this,Mv,"");A(this,Vo);A(this,A2,"");this.color=t.color||_t._defaultColor,v(this,Vo,t.thickness||_t._defaultThickness),this.opacity=t.opacity||_t._defaultOpacity,v(this,Eh,t.boxes||null),v(this,A2,t.methodOfCreation||""),v(this,Mv,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(v(this,Pi,!0),E(this,dt,DT).call(this,t),E(this,dt,zm).call(this)):l(this,Eh)&&(v(this,Dv,t.anchorNode),v(this,S2,t.anchorOffset),v(this,N2,t.focusNode),v(this,j2,t.focusOffset),E(this,dt,C4).call(this),E(this,dt,zm).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=_t.prototype;return ot(this,"_keyboardManager",new EE([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,Pi)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:l(this,Vo),methodOfCreation:l(this,A2)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Ws.initialize(t,s),_t._defaultColor||(_t._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case jt.HIGHLIGHT_COLOR:_t._defaultColor=s;break;case jt.HIGHLIGHT_THICKNESS:_t._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return l(this,Iv)}get commentButtonPosition(){return l(this,Rv)}updateParams(t,s){switch(t){case jt.HIGHLIGHT_COLOR:E(this,dt,Bq).call(this,s);break;case jt.HIGHLIGHT_THICKNESS:E(this,dt,$q).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[jt.HIGHLIGHT_COLOR,_t._defaultColor],[jt.HIGHLIGHT_THICKNESS,_t._defaultThickness]]}get propertiesToUpdate(){return[[jt.HIGHLIGHT_COLOR,this.color||_t._defaultColor],[jt.HIGHLIGHT_THICKNESS,l(this,Vo)||_t._defaultThickness],[jt.HIGHLIGHT_FREE,l(this,Pi)]]}onUpdatedColor(){var t,s;(t=this.parent)==null||t.drawLayer.updateProperties(l(this,Oa),{root:{fill:this.color,"fill-opacity":this.opacity}}),(s=l(this,C2))==null||s.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",v(this,C2,new lq({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(E(this,dt,IT).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,E(this,dt,IT).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){E(this,dt,N4).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,dt,zm).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?E(this,dt,N4).call(this):t&&(E(this,dt,zm).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,o,c;const{drawLayer:s}=this.parent;let i;l(this,Pi)?(t=(t-this.rotation+360)%360,i=E(r=_t,cl,Ay).call(r,l(this,Fa).box,t)):i=E(o=_t,cl,Ay).call(o,[this.x,this.y,this.width,this.height],t),s.updateProperties(l(this,Oa),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(l(this,lr),{bbox:E(c=_t,cl,Ay).call(c,l(this,sa).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();l(this,Mv)&&(t.setAttribute("aria-label",l(this,Mv)),t.setAttribute("role","mark")),l(this,Pi)?t.classList.add("free"):this.div.addEventListener("keydown",E(this,dt,zq).bind(this),{signal:this._uiManager._signal});const s=v(this,ox,document.createElement("div"));return t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=l(this,ax),this.setDims(),l9(this,l(this,ox),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,lr),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,lr),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:E(this,dt,RT).call(this,!0);break;case 1:case 3:E(this,dt,RT).call(this,!1);break}}select(){var t;super.select(),l(this,lr)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,lr),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),l(this,lr)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,lr),{rootClass:{selected:!1}}),l(this,Pi)||E(this,dt,RT).call(this,!1))}get _mustFixPosition(){return!l(this,Pi)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(l(this,Oa),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(l(this,lr),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:o}){const{x:c,y:d,width:h,height:u}=i.getBoundingClientRect(),p=new AbortController,f=t.combinedSignal(p),m=x=>{p.abort(),E(this,cl,Wq).call(this,t,x)};window.addEventListener("blur",m,{signal:f}),window.addEventListener("pointerup",m,{signal:f}),window.addEventListener("pointerdown",Sn,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",xl,{signal:f}),i.addEventListener("pointermove",E(this,cl,Gq).bind(this,t),{signal:f}),this._freeHighlight=new S4({x:r,y:o},[c,d,h,u],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var g,b,y,C;let r=null;if(t instanceof vq){const{data:{quadPoints:w,rect:S,rotation:j,id:T,color:k,opacity:_,popupRef:L,richText:D,contentsObj:P,creationDate:I,modificationDate:M},parent:{page:{pageNumber:O}}}=t;r=t={annotationType:rt.HIGHLIGHT,color:Array.from(k),opacity:_,quadPoints:w,boxes:null,pageIndex:O-1,rect:S.slice(0),rotation:j,annotationElementId:T,id:T,deleted:!1,popupRef:L,richText:D,comment:(P==null?void 0:P.str)||null,creationDate:I,modificationDate:M}}else if(t instanceof y3){const{data:{inkLists:w,rect:S,rotation:j,id:T,color:k,borderStyle:{rawWidth:_},popupRef:L,richText:D,contentsObj:P,creationDate:I,modificationDate:M},parent:{page:{pageNumber:O}}}=t;r=t={annotationType:rt.HIGHLIGHT,color:Array.from(k),thickness:_,inkLists:w,boxes:null,pageIndex:O-1,rect:S.slice(0),rotation:j,annotationElementId:T,id:T,deleted:!1,popupRef:L,richText:D,comment:(P==null?void 0:P.str)||null,creationDate:I,modificationDate:M}}const{color:o,quadPoints:c,inkLists:d,opacity:h}=t,u=await super.deserialize(t,s,i);u.color=_e.makeHexColor(...o),u.opacity=h||1,d&&v(u,Vo,t.thickness),u._initialData=r,t.comment&&u.setCommentData(t);const[p,f]=u.pageDimensions,[m,x]=u.pageTranslation;if(c){const w=v(u,Eh,[]);for(let S=0;S<c.length;S+=8)w.push({x:(c[S]-m)/p,y:1-(c[S+1]-x)/f,width:(c[S+2]-c[S])/p,height:(c[S+1]-c[S+5])/f});E(g=u,dt,C4).call(g),E(b=u,dt,zm).call(b),u.rotate(u.rotation)}else if(d){v(u,Pi,!0);const w=d[0],S={x:w[0]-m,y:f-(w[1]-x)},j=new S4(S,[0,0,p,f],1,l(u,Vo)/2,!0,.001);for(let _=0,L=w.length;_<L;_+=2)S.x=w[_]-m,S.y=f-(w[_+1]-x),j.add(S);const{id:T,clipPathId:k}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:j.toSVGPath()}},!0,!0);E(y=u,dt,DT).call(y,{highlightOutlines:j.getOutlines(),highlightId:T,clipPathId:k}),E(C=u,dt,zm).call(C),u.rotate(u.parentRotation)}return u}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=Ws._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:s,opacity:this.opacity,thickness:l(this,Vo),quadPoints:E(this,dt,Hq).call(this),outlines:E(this,dt,Vq).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!E(this,dt,qq).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}},Dv=new WeakMap,S2=new WeakMap,Eh=new WeakMap,ax=new WeakMap,C2=new WeakMap,sa=new WeakMap,N2=new WeakMap,j2=new WeakMap,ox=new WeakMap,Fa=new WeakMap,Oa=new WeakMap,Pi=new WeakMap,Rv=new WeakMap,Iv=new WeakMap,lr=new WeakMap,Mv=new WeakMap,Vo=new WeakMap,A2=new WeakMap,dt=new WeakSet,C4=function(){const t=new v4(l(this,Eh),.001);v(this,Fa,t.getOutlines()),[this.x,this.y,this.width,this.height]=l(this,Fa).box;const s=new v4(l(this,Eh),.0025,.001,this._uiManager.direction==="ltr");v(this,sa,s.getOutlines());const{firstPoint:i}=l(this,Fa);v(this,Rv,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:r}=l(this,sa);v(this,Iv,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},DT=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var f,m;if(v(this,Fa,t),v(this,sa,t.getNewOutline(l(this,Vo)/2+1.5,.0025)),s>=0)v(this,Oa,s),v(this,ax,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),v(this,lr,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:l(this,sa).box,path:{d:l(this,sa).toSVGPath()}},!0));else if(this.parent){const x=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(l(this,Oa),{bbox:E(f=_t,cl,Ay).call(f,l(this,Fa).box,(x-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(l(this,lr),{bbox:E(m=_t,cl,Ay).call(m,l(this,sa).box,x),path:{d:l(this,sa).toSVGPath()}})}const[o,c,d,h]=t.box;switch(this.rotation){case 0:this.x=o,this.y=c,this.width=d,this.height=h;break;case 90:{const[x,g]=this.parentDimensions;this.x=c,this.y=1-o,this.width=d*g/x,this.height=h*x/g;break}case 180:this.x=1-o,this.y=1-c,this.width=d,this.height=h;break;case 270:{const[x,g]=this.parentDimensions;this.x=1-c,this.y=o,this.width=d*g/x,this.height=h*x/g;break}}const{firstPoint:u}=t;v(this,Rv,[(u[0]-o)/d,(u[1]-c)/h]);const{lastPoint:p}=l(this,sa);v(this,Iv,[(p[0]-o)/d,(p[1]-c)/h])},Bq=function(t){const s=(o,c)=>{this.color=o,this.opacity=c,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:s.bind(this,t,_t._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:jt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},$q=function(t){const s=l(this,Vo),i=r=>{v(this,Vo,r),E(this,dt,Uq).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:jt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Uq=function(t){l(this,Pi)&&(E(this,dt,DT).call(this,{highlightOutlines:l(this,Fa).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},N4=function(){l(this,Oa)===null||!this.parent||(this.parent.drawLayer.remove(l(this,Oa)),v(this,Oa,null),this.parent.drawLayer.remove(l(this,lr)),v(this,lr,null))},zm=function(t=this.parent){l(this,Oa)===null&&({id:vt(this,Oa)._,clipPathId:vt(this,ax)._}=t.drawLayer.draw({bbox:l(this,Fa).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:l(this,Pi)},path:{d:l(this,Fa).toSVGPath()}},!1,!0),v(this,lr,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:l(this,Pi)},bbox:l(this,sa).box,path:{d:l(this,sa).toSVGPath()}},l(this,Pi))),l(this,ox)&&(l(this,ox).style.clipPath=l(this,ax)))},cl=new WeakSet,Ay=function([t,s,i,r],o){switch(o){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},zq=function(t){_t._keyboardManager.exec(this,t)},RT=function(t){if(!l(this,Dv))return;const s=window.getSelection();t?s.setPosition(l(this,Dv),l(this,S2)):s.setPosition(l(this,N2),l(this,j2))},IT=function(){return l(this,Pi)?this.rotation:0},Hq=function(){if(l(this,Pi))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,o=l(this,Eh),c=new Float32Array(o.length*8);let d=0;for(const{x:h,y:u,width:p,height:f}of o){const m=h*t+i,x=(1-u)*s+r;c[d]=c[d+4]=m,c[d+1]=c[d+3]=x,c[d+2]=c[d+6]=m+p*t,c[d+5]=c[d+7]=x-f*s,d+=8}return c},Vq=function(t){return l(this,Fa).serialize(t,E(this,dt,IT).call(this))},Gq=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Wq=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},qq=function(t){const{color:s}=this._initialData;return this.hasEditedComment||t.color.some((i,r)=>i!==s[r])},A(_t,cl),W(_t,"_defaultColor",null),W(_t,"_defaultOpacity",1),W(_t,"_defaultThickness",12),W(_t,"_type","highlight"),W(_t,"_editorType",rt.HIGHLIGHT),W(_t,"_freeHighlightId",-1),W(_t,"_freeHighlight",null),W(_t,"_freeHighlightClipId",""),_t);var lx,O8;let Yq=(O8=class{constructor(){A(this,lx,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){l(this,lx)[e]=t}toSVGProperties(){const e=l(this,lx);return v(this,lx,Object.create(null)),{root:e}}reset(){v(this,lx,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Cs("Not implemented")}},lx=new WeakMap,O8);var Ba,Fv,mt,ai,cx,dx,Lt,j4,A4,E4,lC,Kq,MT,cC,Ey;let Xq=(mt=class extends Ws{constructor(t){super(t);A(this,Lt);A(this,Ba,null);A(this,Fv);W(this,"_colorPicker",null);W(this,"_drawId",null);v(this,Fv,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(E(this,Lt,j4).call(this,t),E(this,Lt,lC).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,o]of Object.entries(s))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){Cs("Not implemented")}static get typesMap(){Cs("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(l(mt,ai).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,o=r[s],c=d=>{var u;r.updateProperty(s,d);const h=l(this,Ba).updateProperty(s,d);h&&E(this,Lt,cC).call(this,h),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:c.bind(this,i),undo:c.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,mt._mergeSVGProperties(l(this,Ba).getPathResizingSVGProperties(E(this,Lt,MT).call(this)),{bbox:E(this,Lt,Ey).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,mt._mergeSVGProperties(l(this,Ba).getPathResizedSVGProperties(E(this,Lt,MT).call(this)),{bbox:E(this,Lt,Ey).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:E(this,Lt,Ey).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,mt._mergeSVGProperties(l(this,Ba).getPathTranslatedSVGProperties(E(this,Lt,MT).call(this),this.parentDimensions),{bbox:E(this,Lt,Ey).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,l(this,Fv)&&(v(this,Fv,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){E(this,Lt,E4).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,Lt,lC).call(this),E(this,Lt,cC).call(this,l(this,Ba).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),E(this,Lt,E4).call(this)):t&&(this._uiManager.addShouldRescale(this),E(this,Lt,lC).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,mt._mergeSVGProperties({bbox:E(this,Lt,Ey).call(this)},l(this,Ba).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&E(this,Lt,cC).call(this,l(this,Ba).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,r,o){Cs("Not implemented")}static startDrawing(t,s,i,r){var b;const{target:o,offsetX:c,offsetY:d,pointerId:h,pointerType:u}=r;if(nr.isInitializedAndDifferentPointerType(u))return;const{viewport:{rotation:p}}=t,{width:f,height:m}=o.getBoundingClientRect(),x=v(mt,cx,new AbortController),g=t.combinedSignal(x);if(nr.setPointer(u,h),window.addEventListener("pointerup",y=>{nr.isSamePointerIdOrRemove(y.pointerId)&&this._endDraw(y)},{signal:g}),window.addEventListener("pointercancel",y=>{nr.isSamePointerIdOrRemove(y.pointerId)&&this._currentParent.endDrawingSession()},{signal:g}),window.addEventListener("pointerdown",y=>{nr.isSamePointerType(y.pointerType)&&(nr.initializeAndAddPointerId(y.pointerId),l(mt,ai).isCancellable()&&(l(mt,ai).removeLastElement(),l(mt,ai).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",xl,{signal:g}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),o.addEventListener("touchmove",y=>{nr.isSameTimeStamp(y.timeStamp)&&Sn(y)},{signal:g}),t.toggleDrawing(),(b=s._editorUndoBar)==null||b.hide(),l(mt,ai)){t.drawLayer.updateProperties(this._currentDrawId,l(mt,ai).startNew(c,d,f,m,p));return}s.updateUIForDefaultProperties(this),v(mt,ai,this.createDrawerInstance(c,d,f,m,p)),v(mt,dx,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(l(mt,dx).toSVGProperties(),l(mt,ai).defaultSVGProperties),!0,!1)}static _drawMove(t){if(nr.isSameTimeStamp(t.timeStamp),!l(mt,ai))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if(nr.isSamePointerId(r)){if(nr.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,l(mt,ai).add(s,i)),nr.setTimeStamp(t.timeStamp),Sn(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,v(mt,ai,null),v(mt,dx,null),nr.clearPointerType(),nr.clearTimeStamp()),l(mt,cx)&&(l(mt,cx).abort(),v(mt,cx,null),nr.clearPointerIds())}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,l(mt,ai).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=l(mt,ai),r=this._currentDrawId,o=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:jt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(jt.DRAW_STEP),!l(mt,ai).isEmpty()){const{pageDimensions:[i,r],scale:o}=s,c=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:l(mt,ai).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:l(mt,dx),mustBeCommitted:!t});return this._cleanup(!0),c}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,o,c){Cs("Not implemented")}static async deserialize(t,s,i){var p,f;const{rawDims:{pageWidth:r,pageHeight:o,pageX:c,pageY:d}}=s.viewport,h=this.deserializeDraw(c,d,r,o,this._INNER_MARGIN,t),u=await super.deserialize(t,s,i);return u.createDrawingOptions(t),E(p=u,Lt,j4).call(p,{drawOutlines:h}),E(f=u,Lt,lC).call(f),u.onScaleChanging(),u.rotate(),u}serializeDraw(t){const[s,i]=this.pageTranslation,[r,o]=this.pageDimensions;return l(this,Ba).serialize([s,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}},Ba=new WeakMap,Fv=new WeakMap,ai=new WeakMap,cx=new WeakMap,dx=new WeakMap,Lt=new WeakSet,j4=function({drawOutlines:t,drawId:s,drawingOptions:i}){v(this,Ba,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=E(this,Lt,A4).call(this,t,this.parent),E(this,Lt,cC).call(this,t.box)},A4=function(t,s){const{id:i}=s.drawLayer.draw(mt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},E4=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},lC=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=E(this,Lt,A4).call(this,l(this,Ba),t)}},Kq=function([t,s,i,r]){const{parentDimensions:[o,c],rotation:d}=this;switch(d){case 90:return[s,1-t,i*(c/o),r*(o/c)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(c/o),r*(o/c)];default:return[t,s,i,r]}},MT=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[o,c],rotation:d}=this;switch(d){case 90:return[1-s,t,i*(o/c),r*(c/o)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(o/c),r*(c/o)];default:return[t,s,i,r]}},cC=function(t){[this.x,this.y,this.width,this.height]=E(this,Lt,Kq).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},Ey=function(){const{x:t,y:s,width:i,height:r,rotation:o,parentRotation:c,parentDimensions:[d,h]}=this;switch((o*4+c)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(d/h),r*(h/d),i*(d/h)];case 5:return[1-s,t,i*(d/h),r*(h/d)];case 6:return[1-t-r*(h/d),1-s,r*(h/d),i*(d/h)];case 7:return[s-i*(d/h),1-t-r*(h/d),i*(d/h),r*(h/d)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(h/d),s,r*(h/d),i*(d/h)];case 13:return[1-s-i*(d/h),t-r*(h/d),i*(d/h),r*(h/d)];case 14:return[1-t,1-s-i*(d/h),r*(h/d),i*(d/h)];case 15:return[s,1-t,i*(d/h),r*(h/d)];default:return[t,s,i,r]}},W(mt,"_currentDrawId",-1),W(mt,"_currentParent",null),A(mt,ai,null),A(mt,cx,null),A(mt,dx,null),W(mt,"_INNER_MARGIN",3),mt);var zc,oi,li,hx,Ov,kr,Li,Go,ux,px,fx,Bv,FT,B8;let mhe=(B8=class{constructor(e,t,s,i,r,o){A(this,Bv);A(this,zc,new Float64Array(6));A(this,oi);A(this,li);A(this,hx);A(this,Ov);A(this,kr);A(this,Li,"");A(this,Go,0);A(this,ux,new TE);A(this,px);A(this,fx);v(this,px,s),v(this,fx,i),v(this,hx,r),v(this,Ov,o),[e,t]=E(this,Bv,FT).call(this,e,t);const c=v(this,oi,[NaN,NaN,NaN,NaN,e,t]);v(this,kr,[e,t]),v(this,li,[{line:c,points:l(this,kr)}]),l(this,zc).set(c,0)}updateProperty(e,t){e==="stroke-width"&&v(this,Ov,t)}isEmpty(){return!l(this,li)||l(this,li).length===0}isCancellable(){return l(this,kr).length<=10}add(e,t){[e,t]=E(this,Bv,FT).call(this,e,t);const[s,i,r,o]=l(this,zc).subarray(2,6),c=e-r,d=t-o;return Math.hypot(l(this,px)*c,l(this,fx)*d)<=2?null:(l(this,kr).push(e,t),isNaN(s)?(l(this,zc).set([r,o,e,t],2),l(this,oi).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(l(this,zc)[0])&&l(this,oi).splice(6,6),l(this,zc).set([s,i,r,o,e,t],0),l(this,oi).push(...Ee.createBezierPoints(s,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(l(this,kr).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){v(this,px,s),v(this,fx,i),v(this,hx,r),[e,t]=E(this,Bv,FT).call(this,e,t);const o=v(this,oi,[NaN,NaN,NaN,NaN,e,t]);v(this,kr,[e,t]);const c=l(this,li).at(-1);return c&&(c.line=new Float32Array(c.line),c.points=new Float32Array(c.points)),l(this,li).push({line:o,points:l(this,kr)}),l(this,zc).set(o,0),v(this,Go,0),this.toSVGPath(),null}getLastElement(){return l(this,li).at(-1)}setLastElement(e){return l(this,li)?(l(this,li).push(e),v(this,oi,e.line),v(this,kr,e.points),v(this,Go,0),{path:{d:this.toSVGPath()}}):l(this,ux).setLastElement(e)}removeLastElement(){if(!l(this,li))return l(this,ux).removeLastElement();l(this,li).pop(),v(this,Li,"");for(let e=0,t=l(this,li).length;e<t;e++){const{line:s,points:i}=l(this,li)[e];v(this,oi,s),v(this,kr,i),v(this,Go,0),this.toSVGPath()}return{path:{d:l(this,Li)}}}toSVGPath(){const e=Ee.svgRound(l(this,oi)[4]),t=Ee.svgRound(l(this,oi)[5]);if(l(this,kr).length===2)return v(this,Li,`${l(this,Li)} M ${e} ${t} Z`),l(this,Li);if(l(this,kr).length<=6){const i=l(this,Li).lastIndexOf("M");v(this,Li,`${l(this,Li).slice(0,i)} M ${e} ${t}`),v(this,Go,6)}if(l(this,kr).length===4){const i=Ee.svgRound(l(this,oi)[10]),r=Ee.svgRound(l(this,oi)[11]);return v(this,Li,`${l(this,Li)} L ${i} ${r}`),v(this,Go,12),l(this,Li)}const s=[];l(this,Go)===0&&(s.push(`M ${e} ${t}`),v(this,Go,6));for(let i=l(this,Go),r=l(this,oi).length;i<r;i+=6){const[o,c,d,h,u,p]=l(this,oi).slice(i,i+6).map(Ee.svgRound);s.push(`C${o} ${c} ${d} ${h} ${u} ${p}`)}return v(this,Li,l(this,Li)+s.join(" ")),v(this,Go,l(this,oi).length),l(this,Li)}getOutlines(e,t,s,i){const r=l(this,li).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),l(this,ux).build(l(this,li),e,t,s,l(this,hx),l(this,Ov),i),v(this,zc,null),v(this,oi,null),v(this,li,null),v(this,Li,null),l(this,ux)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},zc=new WeakMap,oi=new WeakMap,li=new WeakMap,hx=new WeakMap,Ov=new WeakMap,kr=new WeakMap,Li=new WeakMap,Go=new WeakMap,ux=new WeakMap,px=new WeakMap,fx=new WeakMap,Bv=new WeakSet,FT=function(e,t){return Ee._normalizePoint(e,t,l(this,px),l(this,fx),l(this,hx))},B8);var Tr,E2,k2,$a,Hc,Vc,$v,Uv,mx,Hi,Vd,Qq,Jq,Zq,$8;let TE=($8=class extends Ee{constructor(){super(...arguments);A(this,Hi);A(this,Tr);A(this,E2,0);A(this,k2);A(this,$a);A(this,Hc);A(this,Vc);A(this,$v);A(this,Uv);A(this,mx)}build(t,s,i,r,o,c,d){v(this,Hc,s),v(this,Vc,i),v(this,$v,r),v(this,Uv,o),v(this,mx,c),v(this,k2,d??0),v(this,$a,t),E(this,Hi,Jq).call(this)}get thickness(){return l(this,mx)}setLastElement(t){return l(this,$a).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return l(this,$a).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of l(this,$a)){if(t.push(`M${Ee.svgRound(s[4])} ${Ee.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${Ee.svgRound(s[10])} ${Ee.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[o,c,d,h,u,p]=s.subarray(i,i+6).map(Ee.svgRound);t.push(`C${o} ${c} ${d} ${h} ${u} ${p}`)}}return t.join("")}serialize([t,s,i,r],o){const c=[],d=[],[h,u,p,f]=E(this,Hi,Qq).call(this);let m,x,g,b,y,C,w,S,j;switch(l(this,Uv)){case 0:j=Ee._rescale,m=t,x=s+r,g=i,b=-r,y=t+h*i,C=s+(1-u-f)*r,w=t+(h+p)*i,S=s+(1-u)*r;break;case 90:j=Ee._rescaleAndSwap,m=t,x=s,g=i,b=r,y=t+u*i,C=s+h*r,w=t+(u+f)*i,S=s+(h+p)*r;break;case 180:j=Ee._rescale,m=t+i,x=s,g=-i,b=r,y=t+(1-h-p)*i,C=s+u*r,w=t+(1-h)*i,S=s+(u+f)*r;break;case 270:j=Ee._rescaleAndSwap,m=t+i,x=s+r,g=-i,b=-r,y=t+(1-u-f)*i,C=s+(1-h-p)*r,w=t+(1-u)*i,S=s+(1-h)*r;break}for(const{line:T,points:k}of l(this,$a))c.push(j(T,m,x,g,b,o?new Array(T.length):null)),d.push(j(k,m,x,g,b,o?new Array(k.length):null));return{lines:c,points:d,rect:[y,C,w,S]}}static deserialize(t,s,i,r,o,{paths:{lines:c,points:d},rotation:h,thickness:u}){const p=[];let f,m,x,g,b;switch(h){case 0:b=Ee._rescale,f=-t/i,m=s/r+1,x=1/i,g=-1/r;break;case 90:b=Ee._rescaleAndSwap,f=-s/r,m=-t/i,x=1/r,g=1/i;break;case 180:b=Ee._rescale,f=t/i+1,m=-s/r,x=-1/i,g=1/r;break;case 270:b=Ee._rescaleAndSwap,f=s/r+1,m=t/i+1,x=-1/r,g=-1/i;break}if(!c){c=[];for(const C of d){const w=C.length;if(w===2){c.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(w===4){c.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}const S=new Float32Array(3*(w-2));c.push(S);let[j,T,k,_]=C.subarray(0,4);S.set([NaN,NaN,NaN,NaN,j,T],0);for(let L=4;L<w;L+=2){const D=C[L],P=C[L+1];S.set(Ee.createBezierPoints(j,T,k,_,D,P),(L-2)*3),[j,T,k,_]=[k,_,D,P]}}}for(let C=0,w=c.length;C<w;C++)p.push({line:b(c[C].map(S=>S??NaN),f,m,x,g),points:b(d[C].map(S=>S??NaN),f,m,x,g)});const y=new this.prototype.constructor;return y.build(p,i,r,1,h,u,o),y}get box(){return l(this,Tr)}updateProperty(t,s){return t==="stroke-width"?E(this,Hi,Zq).call(this,s):null}updateParentDimensions([t,s],i){const[r,o]=E(this,Hi,Vd).call(this);v(this,Hc,t),v(this,Vc,s),v(this,$v,i);const[c,d]=E(this,Hi,Vd).call(this),h=c-r,u=d-o,p=l(this,Tr);return p[0]-=h,p[1]-=u,p[2]+=2*h,p[3]+=2*u,p}updateRotation(t){return v(this,E2,t),{path:{transform:this.rotationTransform}}}get viewBox(){return l(this,Tr).map(Ee.svgRound).join(" ")}get defaultProperties(){const[t,s]=l(this,Tr);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ee.svgRound(t)} ${Ee.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=l(this,Tr);let i=0,r=0,o=0,c=0,d=0,h=0;switch(l(this,E2)){case 90:r=s/t,o=-t/s,d=t;break;case 180:i=-1,c=-1,d=t,h=s;break;case 270:r=-s/t,o=t/s,h=s;break;default:return""}return`matrix(${i} ${r} ${o} ${c} ${Ee.svgRound(d)} ${Ee.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,r]){const[o,c]=E(this,Hi,Vd).call(this),[d,h,u,p]=l(this,Tr);if(Math.abs(u-o)<=Ee.PRECISION||Math.abs(p-c)<=Ee.PRECISION){const b=t+i/2-(d+u/2),y=s+r/2-(h+p/2);return{path:{"transform-origin":`${Ee.svgRound(t)} ${Ee.svgRound(s)}`,transform:`${this.rotationTransform} translate(${b} ${y})`}}}const f=(i-2*o)/(u-2*o),m=(r-2*c)/(p-2*c),x=u/i,g=p/r;return{path:{"transform-origin":`${Ee.svgRound(d)} ${Ee.svgRound(h)}`,transform:`${this.rotationTransform} scale(${x} ${g}) translate(${Ee.svgRound(o)} ${Ee.svgRound(c)}) scale(${f} ${m}) translate(${Ee.svgRound(-o)} ${Ee.svgRound(-c)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[o,c]=E(this,Hi,Vd).call(this),d=l(this,Tr),[h,u,p,f]=d;if(d[0]=t,d[1]=s,d[2]=i,d[3]=r,Math.abs(p-o)<=Ee.PRECISION||Math.abs(f-c)<=Ee.PRECISION){const y=t+i/2-(h+p/2),C=s+r/2-(u+f/2);for(const{line:w,points:S}of l(this,$a))Ee._translate(w,y,C,w),Ee._translate(S,y,C,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ee.svgRound(t)} ${Ee.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(i-2*o)/(p-2*o),x=(r-2*c)/(f-2*c),g=-m*(h+o)+t+o,b=-x*(u+c)+s+c;if(m!==1||x!==1||g!==0||b!==0)for(const{line:y,points:C}of l(this,$a))Ee._rescale(y,g,b,m,x,y),Ee._rescale(C,g,b,m,x,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ee.svgRound(t)} ${Ee.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,o]=i,c=l(this,Tr),d=t-c[0],h=s-c[1];if(l(this,Hc)===r&&l(this,Vc)===o)for(const{line:u,points:p}of l(this,$a))Ee._translate(u,d,h,u),Ee._translate(p,d,h,p);else{const u=l(this,Hc)/r,p=l(this,Vc)/o;v(this,Hc,r),v(this,Vc,o);for(const{line:f,points:m}of l(this,$a))Ee._rescale(f,d,h,u,p,f),Ee._rescale(m,d,h,u,p,m);c[2]*=u,c[3]*=p}return c[0]=t,c[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Ee.svgRound(t)} ${Ee.svgRound(s)}`}}}get defaultSVGProperties(){const t=l(this,Tr);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Ee.svgRound(t[0])} ${Ee.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}},Tr=new WeakMap,E2=new WeakMap,k2=new WeakMap,$a=new WeakMap,Hc=new WeakMap,Vc=new WeakMap,$v=new WeakMap,Uv=new WeakMap,mx=new WeakMap,Hi=new WeakSet,Vd=function(t=l(this,mx)){const s=l(this,k2)+t/2*l(this,$v);return l(this,Uv)%180===0?[s/l(this,Hc),s/l(this,Vc)]:[s/l(this,Vc),s/l(this,Hc)]},Qq=function(){const[t,s,i,r]=l(this,Tr),[o,c]=E(this,Hi,Vd).call(this,0);return[t+o,s+c,i-2*o,r-2*c]},Jq=function(){const t=v(this,Tr,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of l(this,$a)){if(r.length<=12){for(let d=4,h=r.length;d<h;d+=6)_e.pointBoundingBox(r[d],r[d+1],t);continue}let o=r[4],c=r[5];for(let d=6,h=r.length;d<h;d+=6){const[u,p,f,m,x,g]=r.subarray(d,d+6);_e.bezierBoundingBox(o,c,u,p,f,m,x,g,t),o=x,c=g}}const[s,i]=E(this,Hi,Vd).call(this);t[0]=Mr(t[0]-s,0,1),t[1]=Mr(t[1]-i,0,1),t[2]=Mr(t[2]+s,0,1),t[3]=Mr(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},Zq=function(t){const[s,i]=E(this,Hi,Vd).call(this);v(this,mx,t);const[r,o]=E(this,Hi,Vd).call(this),[c,d]=[r-s,o-i],h=l(this,Tr);return h[0]-=c,h[1]-=d,h[2]+=2*c,h[3]+=2*d,h},$8),eY=class tY extends Yq{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Ws._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new tY(this._viewParameters);return e.updateAll(this),e}};var kh,GP,sY;let ghe=(kh=class extends Xq{constructor(t){super({...t,name:"inkEditor"});A(this,GP);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Ws.initialize(t,s),this._defaultDrawingOptions=new eY(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return ot(this,"typesMap",new Map([[jt.INK_THICKNESS,"stroke-width"],[jt.INK_COLOR,"stroke"],[jt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,o){return new mhe(t,s,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,o,c){return TE.deserialize(t,s,i,r,o,c)}static async deserialize(t,s,i){let r=null;if(t instanceof y3){const{data:{inkLists:c,rect:d,rotation:h,id:u,color:p,opacity:f,borderStyle:{rawWidth:m},popupRef:x,richText:g,contentsObj:b,creationDate:y,modificationDate:C},parent:{page:{pageNumber:w}}}=t;r=t={annotationType:rt.INK,color:Array.from(p),thickness:m,opacity:f,paths:{points:c},boxes:null,pageIndex:w-1,rect:d.slice(0),rotation:h,annotationElementId:u,id:u,deleted:!1,popupRef:x,richText:g,comment:(b==null?void 0:b.str)||null,creationDate:y,modificationDate:C}}const o=await super.deserialize(t,s,i);return o._initialData=r,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new dq(this)),[["colorPicker",this._colorPicker]]}get colorType(){return jt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=kh.getDefaultDrawingOptions({stroke:_e.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":c}}=this,d=Object.assign(super.serialize(t),{color:Ws._colorManager.convert(r),opacity:o,thickness:c,paths:{lines:s,points:i}});return this.addComment(d),t?(d.isCopy=!0,d):this.annotationElementId&&!E(this,GP,sY).call(this,d)?null:(d.id=this.annotationElementId,d)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s,popup:this.comment}),null}},GP=new WeakSet,sY=function(t){const{color:s,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((c,d)=>c!==s[d])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},W(kh,"_type","ink"),W(kh,"_editorType",rt.INK),W(kh,"_defaultDrawingOptions",null),kh),k4=class extends TE{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}};const Tk=8,NS=3;var IS,gx,zt,T4,Bl,nY,iY,_4,OT,rY,aY,oY,P4,L4,lY;let ky=(IS=class{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},r,o,c,d){let h=new OffscreenCanvas(1,1),u=h.getContext("2d",{alpha:!1});const p=200,f=u.font=`${s} ${i} ${p}px ${t}`,{actualBoundingBoxLeft:m,actualBoundingBoxRight:x,actualBoundingBoxAscent:g,actualBoundingBoxDescent:b,fontBoundingBoxAscent:y,fontBoundingBoxDescent:C,width:w}=u.measureText(e),S=1.5,j=Math.ceil(Math.max(Math.abs(m)+Math.abs(x)||0,w)*S),T=Math.ceil(Math.max(Math.abs(g)+Math.abs(b)||p,Math.abs(y)+Math.abs(C)||p)*S);h=new OffscreenCanvas(j,T),u=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),u.font=f,u.filter="grayscale(1)",u.fillStyle="white",u.fillRect(0,0,j,T),u.fillStyle="black",u.fillText(e,j*(S-1)/2,T*(3-S)/2);const k=E(this,zt,P4).call(this,u.getImageData(0,0,j,T).data),_=E(this,zt,oY).call(this,k),L=E(this,zt,L4).call(this,_),D=E(this,zt,_4).call(this,k,j,T,L);return this.processDrawnLines({lines:{curves:D,width:j,height:T},pageWidth:r,pageHeight:o,rotation:c,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,r){const[o,c,d]=E(this,zt,lY).call(this,e),[h,u]=E(this,zt,aY).call(this,o,c,d,Math.hypot(c,d)*l(this,gx).sigmaSFactor,l(this,gx).sigmaR,l(this,gx).kernelSize),p=E(this,zt,L4).call(this,u),f=E(this,zt,_4).call(this,h,c,d,p);return this.processDrawnLines({lines:{curves:f,width:c,height:d},pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:o,areContours:c}){i%180!==0&&([t,s]=[s,t]);const{curves:d,width:h,height:u}=e,p=e.thickness??0,f=[],m=Math.min(t/h,s/u),x=m/t,g=m/s,b=[];for(const{points:C}of d){const w=o?E(this,zt,rY).call(this,C):C;if(!w)continue;b.push(w);const S=w.length,j=new Float32Array(S),T=new Float32Array(3*(S===2?2:S-2));if(f.push({line:T,points:j}),S===2){j[0]=w[0]*x,j[1]=w[1]*g,T.set([NaN,NaN,NaN,NaN,j[0],j[1]],0);continue}let[k,_,L,D]=w;k*=x,_*=g,L*=x,D*=g,j.set([k,_,L,D],0),T.set([NaN,NaN,NaN,NaN,k,_],0);for(let P=4;P<S;P+=2){const I=j[P]=w[P]*x,M=j[P+1]=w[P+1]*g;T.set(Ee.createBezierPoints(k,_,L,D,I,M),(P-2)*3),[k,_,L,D]=[L,D,I,M]}}if(f.length===0)return null;const y=c?new k4:new TE;return y.build(f,t,s,1,i,c?0:p,r),{outline:y,newCurves:b,areContours:c,thickness:p,width:h,height:u}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:r}){let o=1/0,c=-1/0,d=0;for(const w of e){d+=w.length;for(let S=2,j=w.length;S<j;S++){const T=w[S]-w[S-2];o=Math.min(o,T),c=Math.max(c,T)}}let h;o>=-128&&c<=127?h=Int8Array:o>=-32768&&c<=32767?h=Int16Array:h=Int32Array;const u=e.length,p=Tk+NS*u,f=new Uint32Array(p);let m=0;f[m++]=p*Uint32Array.BYTES_PER_ELEMENT+(d-2*u)*h.BYTES_PER_ELEMENT,f[m++]=0,f[m++]=i,f[m++]=r,f[m++]=t?0:1,f[m++]=Math.max(0,Math.floor(s??0)),f[m++]=u,f[m++]=h.BYTES_PER_ELEMENT;for(const w of e)f[m++]=w.length-2,f[m++]=w[0],f[m++]=w[1];const x=new CompressionStream("deflate-raw"),g=x.writable.getWriter();await g.ready,g.write(f);const b=h.prototype.constructor;for(const w of e){const S=new b(w.length-2);for(let j=2,T=w.length;j<T;j++)S[j-2]=w[j]-w[j-2];g.write(S)}g.close();const y=await new Response(x.readable).arrayBuffer(),C=new Uint8Array(y);return QW(C)}static async decompressSignature(e){try{const t=Sce(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,c=0;for await(const w of s)o||(o=new Uint8Array(new Uint32Array(w.buffer,0,4)[0])),o.set(w,c),c+=w.length;const d=new Uint32Array(o.buffer,0,o.length>>2),h=d[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const u=d[2],p=d[3],f=d[4]===0,m=d[5],x=d[6],g=d[7],b=[],y=(Tk+NS*x)*Uint32Array.BYTES_PER_ELEMENT;let C;switch(g){case Int8Array.BYTES_PER_ELEMENT:C=new Int8Array(o.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:C=new Int16Array(o.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:C=new Int32Array(o.buffer,y);break}c=0;for(let w=0;w<x;w++){const S=d[NS*w+Tk],j=new Float32Array(S+2);b.push(j);for(let T=0;T<NS-1;T++)j[T]=d[NS*w+Tk+T+1];for(let T=0;T<S;T++)j[T+2]=j[T]+C[c++]}return{areContours:f,thickness:m,outlines:b,width:u,height:p}}catch(t){return tt(`decompressSignature: ${t}`),null}}},gx=new WeakMap,zt=new WeakSet,T4=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},Bl=new WeakMap,nY=function(e,t,s,i,r,o,c){const d=E(this,zt,T4).call(this,s,i,r,o);for(let h=0;h<8;h++){const u=(-h+d-c+16)%8,p=l(this,Bl)[2*u],f=l(this,Bl)[2*u+1];if(e[(s+p)*t+(i+f)]!==0)return u}return-1},iY=function(e,t,s,i,r,o,c){const d=E(this,zt,T4).call(this,s,i,r,o);for(let h=0;h<8;h++){const u=(h+d+c+16)%8,p=l(this,Bl)[2*u],f=l(this,Bl)[2*u+1];if(e[(s+p)*t+(i+f)]!==0)return u}return-1},_4=function(e,t,s,i){const r=e.length,o=new Int32Array(r);for(let u=0;u<r;u++)o[u]=e[u]<=i?1:0;for(let u=1;u<s-1;u++)o[u*t]=o[u*t+t-1]=0;for(let u=0;u<t;u++)o[u]=o[t*s-1-u]=0;let c=1,d;const h=[];for(let u=1;u<s-1;u++){d=1;for(let p=1;p<t-1;p++){const f=u*t+p,m=o[f];if(m===0)continue;let x=u,g=p;if(m===1&&o[f-1]===0)c+=1,g-=1;else if(m>=1&&o[f+1]===0)c+=1,g+=1,m>1&&(d=m);else{m!==1&&(d=Math.abs(m));continue}const b=[p,u],y=g===p+1,C={isHole:y,points:b,id:c,parent:0};h.push(C);let w;for(const P of h)if(P.id===d){w=P;break}w?w.isHole?C.parent=y?w.parent:d:C.parent=y?d:w.parent:C.parent=y?d:0;const S=E(this,zt,nY).call(this,o,t,u,p,x,g,0);if(S===-1){o[f]=-c,o[f]!==1&&(d=Math.abs(o[f]));continue}let j=l(this,Bl)[2*S],T=l(this,Bl)[2*S+1];const k=u+j,_=p+T;x=k,g=_;let L=u,D=p;for(;;){const P=E(this,zt,iY).call(this,o,t,L,D,x,g,1);j=l(this,Bl)[2*P],T=l(this,Bl)[2*P+1];const I=L+j,M=D+T;b.push(M,I);const O=L*t+D;if(o[O+1]===0?o[O]=-c:o[O]===1&&(o[O]=c),I===u&&M===p&&L===k&&D===_){o[f]!==1&&(d=Math.abs(o[f]));break}else x=L,g=D,L=I,D=M}}}return h},OT=function(e,t,s,i){if(s-t<=4){for(let k=t;k<s-2;k+=2)i.push(e[k],e[k+1]);return}const r=e[t],o=e[t+1],c=e[s-4]-r,d=e[s-3]-o,h=Math.hypot(c,d),u=c/h,p=d/h,f=u*o-p*r,m=d/c,x=1/h,g=Math.atan(m),b=Math.cos(g),y=Math.sin(g),C=x*(Math.abs(b)+Math.abs(y)),w=x*(1-C+C**2),S=Math.max(Math.atan(Math.abs(y+b)*w),Math.atan(Math.abs(y-b)*w));let j=0,T=t;for(let k=t+2;k<s-2;k+=2){const _=Math.abs(f-u*e[k+1]+p*e[k]);_>j&&(T=k,j=_)}j>(h*S)**2?(E(this,zt,OT).call(this,e,t,T+2,i),E(this,zt,OT).call(this,e,T,s,i)):i.push(r,o)},rY=function(e){const t=[],s=e.length;return E(this,zt,OT).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},aY=function(e,t,s,i,r,o){const c=new Float32Array(o**2),d=-2*i**2,h=o>>1;for(let g=0;g<o;g++){const b=(g-h)**2;for(let y=0;y<o;y++)c[g*o+y]=Math.exp((b+(y-h)**2)/d)}const u=new Float32Array(256),p=-2*r**2;for(let g=0;g<256;g++)u[g]=Math.exp(g**2/p);const f=e.length,m=new Uint8Array(f),x=new Uint32Array(256);for(let g=0;g<s;g++)for(let b=0;b<t;b++){const y=g*t+b,C=e[y];let w=0,S=0;for(let T=0;T<o;T++){const k=g+T-h;if(!(k<0||k>=s))for(let _=0;_<o;_++){const L=b+_-h;if(L<0||L>=t)continue;const D=e[k*t+L],P=c[T*o+_]*u[Math.abs(D-C)];w+=D*P,S+=P}}const j=m[y]=Math.round(w/S);x[j]++}return[m,x]},oY=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},P4=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,r=1/0;for(let c=0,d=s.length;c<d;c++){const h=s[c]=e[c<<2];i=Math.max(i,h),r=Math.min(r,h)}const o=255/(i-r);for(let c=0,d=s.length;c<d;c++)s[c]=(s[c]-r)*o;return s},L4=function(e){let t,s=-1/0,i=-1/0;const r=e.findIndex(d=>d!==0);let o=r,c=r;for(t=r;t<256;t++){const d=e[t];d>s&&(t-o>i&&(i=t-o,c=t-1),s=d,o=t)}for(t=c-1;t>=0&&!(e[t]>e[t+1]);t--);return t},lY=function(e){const t=e,{width:s,height:i}=e,{maxDim:r}=l(this,gx);let o=s,c=i;if(s>r||i>r){let f=s,m=i,x=Math.log2(Math.max(s,i)/r);const g=Math.floor(x);x=x===g?g-1:g;for(let y=0;y<x;y++){o=Math.ceil(f/2),c=Math.ceil(m/2);const C=new OffscreenCanvas(o,c);C.getContext("2d").drawImage(e,0,0,f,m,0,0,o,c),f=o,m=c,e!==t&&e.close(),e=C.transferToImageBitmap()}const b=Math.min(r/o,r/c);o=Math.round(o*b),c=Math.round(c*b)}const h=new OffscreenCanvas(o,c).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,o,c),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,o,c);const u=h.getImageData(0,0,o,c).data;return[E(this,zt,P4).call(this,u),o,c]},A(IS,zt),A(IS,gx,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),A(IS,Bl,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1])),IS),xhe=class cY extends Yq{constructor(){super(),super.updateProperties({fill:Ws._defaultLineColor,"stroke-width":0})}clone(){const e=new cY;return e.updateAll(this),e}},yhe=class dY extends eY{constructor(e){super(e),super.updateProperties({stroke:Ws._defaultLineColor,"stroke-width":1})}clone(){const e=new dY(this._viewParameters);return e.updateAll(this),e}};var Vp,Gc,Gp,xx,yr;let bhe=(yr=class extends Xq{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});A(this,Vp,!1);A(this,Gc,null);A(this,Gp,null);A(this,xx,null);this._willKeepAspectRatio=!0,v(this,Gp,t.signatureData||null),v(this,Gc,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Ws.initialize(t,s),this._defaultDrawingOptions=new xhe,this._defaultDrawnSignatureOptions=new yhe(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return ot(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!l(this,Gc)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(l(this,Gp)){const{lines:r,mustSmooth:o,areContours:c,description:d,uuid:h,heightInPage:u}=l(this,Gp),{rawDims:{pageWidth:p,pageHeight:f},rotation:m}=this.parent.viewport,x=ky.processDrawnLines({lines:r,pageWidth:p,pageHeight:f,rotation:m,innerMargin:yr._INNER_MARGIN,mustSmooth:o,areContours:c});this.addSignature(x,u,d,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:l(this,Gc)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){v(this,xx,t),this.addEditToolbar()}getUuid(){return l(this,xx)}get description(){return l(this,Gc)}set description(t){v(this,Gc,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:r,height:o}=l(this,Gp),c=Math.max(r,o),d=ky.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:r,height:o},pageWidth:c,pageHeight:c,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:d.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,s,i,r){const{x:o,y:c}=this,{outline:d}=v(this,Gp,t);v(this,Vp,d instanceof k4),this.description=i;let h;l(this,Vp)?h=yr.getDefaultDrawingOptions():(h=yr._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":d.thickness})),this._addOutlines({drawOutlines:d,drawingOptions:h});const[,u]=this.pageDimensions;let p=s/u;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(),this.x=o,this.y=c,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return ky.process(t,s,i,r,yr._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:r},rotation:o}=this.parent.viewport;return ky.extractContoursFromText(t,s,i,r,o,yr._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return ky.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:r,innerMargin:yr._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=yr.getDefaultDrawingOptions():(this._drawingOptions=yr._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:l(this,Vp),color:[0,0,0],thickness:l(this,Vp)?0:r});return this.addComment(o),t?(o.paths={lines:s,points:i},o.uuid=l(this,xx),o.isCopy=!0):o.lines=s,l(this,Gc)&&(o.accessibilityData={type:"Figure",alt:l(this,Gc)}),o}static deserializeDraw(t,s,i,r,o,c){return c.areContours?k4.deserialize(t,s,i,r,o,c):TE.deserialize(t,s,i,r,o,c)}static async deserialize(t,s,i){var o;const r=await super.deserialize(t,s,i);return v(r,Vp,t.areContours),r.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",v(r,xx,t.uuid),r}},Vp=new WeakMap,Gc=new WeakMap,Gp=new WeakMap,xx=new WeakMap,W(yr,"_type","signature"),W(yr,"_editorType",rt.SIGNATURE),W(yr,"_defaultDrawingOptions",null),yr);var $s,ci,Wp,Th,qp,zv,_h,yx,Wc,Ua,Hv,Gk,Rt,dC,hC,BT,$T,UT,D4,zT,hY;let vhe=(Gk=class extends Ws{constructor(t){super({...t,name:"stampEditor"});A(this,Rt);A(this,$s,null);A(this,ci,null);A(this,Wp,null);A(this,Th,null);A(this,qp,null);A(this,zv,"");A(this,_h,null);A(this,yx,!1);A(this,Wc,null);A(this,Ua,!1);A(this,Hv,!1);v(this,Th,t.bitmapUrl),v(this,qp,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Ws.initialize(t,s)}static isHandlingMimeForPasting(t){return EM.includes(t)}static paste(t,s){s.pasteEditor({mode:rt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:c}=t||this.copyCanvas(null,null,!0).imageData,d=await i.guess({name:"altText",request:{data:r,width:o,height:c,channels:r.length/(o*c)}});if(!d)throw new Error("No response from the AI service.");if(d.error)throw new Error("Error from the AI service.");if(d.cancel)return null;if(!d.output)throw new Error("No valid response from the AI service.");const h=d.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;l(this,ci)&&(v(this,$s,null),this._uiManager.imageManager.deleteId(l(this,ci)),(t=l(this,_h))==null||t.remove(),v(this,_h,null),l(this,Wc)&&(clearTimeout(l(this,Wc)),v(this,Wc,null))),super.remove()}rebuild(){if(!this.parent){l(this,ci)&&E(this,Rt,BT).call(this);return}super.rebuild(),this.div!==null&&(l(this,ci)&&l(this,_h)===null&&E(this,Rt,BT).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(l(this,Wp)||l(this,$s)||l(this,Th)||l(this,qp)||l(this,ci)||l(this,yx))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),l(this,yx)||(l(this,$s)?E(this,Rt,$T).call(this):E(this,Rt,BT).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(v(this,ci,i),r&&v(this,$s,r),v(this,yx,!1),E(this,Rt,$T).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;l(this,Wc)!==null&&clearTimeout(l(this,Wc)),v(this,Wc,setTimeout(()=>{v(this,Wc,null),E(this,Rt,D4).call(this)},200))}copyCanvas(t,s,i=!1){t||(t=224);const{width:r,height:o}=l(this,$s),c=new K0;let d=l(this,$s),h=r,u=o,p=null;if(s){if(r>s||o>s){const k=Math.min(s/r,s/o);h=Math.floor(r*k),u=Math.floor(o*k)}p=document.createElement("canvas");const m=p.width=Math.ceil(h*c.sx),x=p.height=Math.ceil(u*c.sy);l(this,Ua)||(d=E(this,Rt,UT).call(this,m,x));const g=p.getContext("2d");g.filter=this._uiManager.hcmFilter;let b="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":kce.isDarkMode&&(b="#8f8f9d",y="#42414d");const C=15,w=C*c.sx,S=C*c.sy,j=new OffscreenCanvas(w*2,S*2),T=j.getContext("2d");T.fillStyle=b,T.fillRect(0,0,w*2,S*2),T.fillStyle=y,T.fillRect(0,0,w,S),T.fillRect(w,S,w,S),g.fillStyle=g.createPattern(j,"repeat"),g.fillRect(0,0,m,x),g.drawImage(d,0,0,d.width,d.height,0,0,m,x)}let f=null;if(i){let m,x;if(c.symmetric&&d.width<t&&d.height<t)m=d.width,x=d.height;else if(d=l(this,$s),r>t||o>t){const y=Math.min(t/r,t/o);m=Math.floor(r*y),x=Math.floor(o*y),l(this,Ua)||(d=E(this,Rt,UT).call(this,m,x))}const b=new OffscreenCanvas(m,x).getContext("2d",{willReadFrequently:!0});b.drawImage(d,0,0,d.width,d.height,0,0,m,x),f={width:m,height:x,data:b.getImageData(0,0,m,x).data}}return{canvas:p,width:h,height:u,imageData:f}}static async deserialize(t,s,i){var b;let r=null,o=!1;if(t instanceof wq){const{data:{rect:y,rotation:C,id:w,structParent:S,popupRef:j,richText:T,contentsObj:k,creationDate:_,modificationDate:L},container:D,parent:{page:{pageNumber:P}},canvas:I}=t;let M,O;I?(delete t.canvas,{id:M,bitmap:O}=i.imageManager.getFromCanvas(D.id,I),I.remove()):(o=!0,t._hasNoCanvas=!0);const F=((b=await s._structTree.getAriaAttributes(`${eb}${w}`))==null?void 0:b.get("aria-label"))||"";r=t={annotationType:rt.STAMP,bitmapId:M,bitmap:O,pageIndex:P-1,rect:y.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:F},isSvg:!1,structParent:S,popupRef:j,richText:T,comment:(k==null?void 0:k.str)||null,creationDate:_,modificationDate:L}}const c=await super.deserialize(t,s,i),{rect:d,bitmap:h,bitmapUrl:u,bitmapId:p,isSvg:f,accessibilityData:m}=t;o?(i.addMissingCanvas(t.id,c),v(c,yx,!0)):p&&i.imageManager.isValidId(p)?(v(c,ci,p),h&&v(c,$s,h)):v(c,Th,u),v(c,Ua,f);const[x,g]=c.pageDimensions;return c.width=(d[2]-d[0])/x,c.height=(d[3]-d[1])/g,m&&(c.altTextData=m),c._initialData=r,t.comment&&c.setCommentData(t),v(c,Hv,!!r),c}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:l(this,ci),isSvg:l(this,Ua)});if(this.addComment(i),t)return i.bitmapUrl=E(this,Rt,zT).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const d=E(this,Rt,hY).call(this,i);return d.isSame?null:(d.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(s===null)return i;s.stamps||(s.stamps=new Map);const c=l(this,Ua)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(l(this,ci)))s.stamps.set(l(this,ci),{area:c,serialized:i}),i.bitmap=E(this,Rt,zT).call(this,!1);else if(l(this,Ua)){const d=s.stamps.get(l(this,ci));c>d.area&&(d.area=c,d.serialized.bitmap.close(),d.serialized.bitmap=E(this,Rt,zT).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}},$s=new WeakMap,ci=new WeakMap,Wp=new WeakMap,Th=new WeakMap,qp=new WeakMap,zv=new WeakMap,_h=new WeakMap,yx=new WeakMap,Wc=new WeakMap,Ua=new WeakMap,Hv=new WeakMap,Rt=new WeakSet,dC=function(t,s=!1){if(!t){this.remove();return}v(this,$s,t.bitmap),s||(v(this,ci,t.id),v(this,Ua,t.isSvg)),t.file&&v(this,zv,t.file.name),E(this,Rt,$T).call(this)},hC=function(){if(v(this,Wp,null),this._uiManager.enableWaiting(!1),!!l(this,_h)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,$s)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,$s)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},BT=function(){if(l(this,ci)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,ci)).then(i=>E(this,Rt,dC).call(this,i,!0)).finally(()=>E(this,Rt,hC).call(this));return}if(l(this,Th)){const i=l(this,Th);v(this,Th,null),this._uiManager.enableWaiting(!0),v(this,Wp,this._uiManager.imageManager.getFromUrl(i).then(r=>E(this,Rt,dC).call(this,r)).finally(()=>E(this,Rt,hC).call(this)));return}if(l(this,qp)){const i=l(this,qp);v(this,qp,null),this._uiManager.enableWaiting(!0),v(this,Wp,this._uiManager.imageManager.getFromFile(i).then(r=>E(this,Rt,dC).call(this,r)).finally(()=>E(this,Rt,hC).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=EM.join(",");const s=this._uiManager._signal;v(this,Wp,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),E(this,Rt,dC).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>E(this,Rt,hC).call(this))),t.click()},$T=function(){var h;const{div:t}=this;let{width:s,height:i}=l(this,$s);const[r,o]=this.pageDimensions,c=.75;if(this.width)s=this.width*r,i=this.height*o;else if(s>c*r||i>c*o){const u=Math.min(c*r/s,c*o/i);s*=u,i*=u}this._uiManager.enableWaiting(!1);const d=v(this,_h,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=s/r,this.height=i/o,this.setDims(),(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),E(this,Rt,D4).call(this),l(this,Hv)||(this.parent.addUndoableEditor(this),v(this,Hv,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,zv)&&this.div.setAttribute("aria-description",l(this,zv)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},UT=function(t,s){const{width:i,height:r}=l(this,$s);let o=i,c=r,d=l(this,$s);for(;o>2*t||c>2*s;){const h=o,u=c;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),c>2*s&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2));const p=new OffscreenCanvas(o,c);p.getContext("2d").drawImage(d,0,0,h,u,0,0,o,c),d=p.transferToImageBitmap()}return d},D4=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,o=new K0,c=Math.ceil(i*t*o.sx),d=Math.ceil(r*s*o.sy),h=l(this,_h);if(!h||h.width===c&&h.height===d)return;h.width=c,h.height=d;const u=l(this,Ua)?l(this,$s):E(this,Rt,UT).call(this,c,d),p=h.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(u,0,0,u.width,u.height,0,0,c,d)},zT=function(t){if(t){if(l(this,Ua)){const r=this._uiManager.imageManager.getSvgUrl(l(this,ci));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=l(this,$s),s.getContext("2d").drawImage(l(this,$s),0,0),s.toDataURL()}if(l(this,Ua)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*M1.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*M1.PDF_TO_CSS_UNITS),c=new OffscreenCanvas(r,o);return c.getContext("2d").drawImage(l(this,$s),0,0,l(this,$s).width,l(this,$s).height,0,0,r,o),c.transferToImageBitmap()}return structuredClone(l(this,$s))},hY=function(t){var c;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,o=(((c=t.accessibilityData)==null?void 0:c.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},W(Gk,"_type","stamp"),W(Gk,"_editorType",rt.STAMP),Gk);var bx,Vv,Yp,Xp,Ph,na,Kp,Gv,Wv,$l,Lh,di,Dh,Qp,qv,Me,fa,Jp,ws,R4,uY,wc,I4,M4,HT;let whe=(fa=class{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:c,textLayer:d,viewport:h,l10n:u}){A(this,ws);A(this,bx);A(this,Vv,!1);A(this,Yp,null);A(this,Xp,null);A(this,Ph,null);A(this,na,new Map);A(this,Kp,!1);A(this,Gv,!1);A(this,Wv,!1);A(this,$l,null);A(this,Lh,null);A(this,di,null);A(this,Dh,null);A(this,Qp,null);A(this,qv,-1);A(this,Me);const p=[...l(fa,Jp).values()];if(!fa._initialized){fa._initialized=!0;for(const f of p)f.initialize(u,e)}e.registerEditorTypes(p),v(this,Me,e),this.pageIndex=t,this.div=s,v(this,bx,r),v(this,Yp,o),this.viewport=h,v(this,di,d),this.drawLayer=c,this._structTree=i,l(this,Me).addLayer(this)}get isEmpty(){return l(this,na).size===0}get isInvisible(){return this.isEmpty&&l(this,Me).getMode()===rt.NONE}updateToolbar(e){l(this,Me).updateToolbar(e)}updateMode(e=l(this,Me).getMode()){switch(E(this,ws,HT).call(this),e){case rt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case rt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case rt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===rt.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of l(fa,Jp).values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=l(this,di))==null?void 0:t.div)}setEditingState(e){l(this,Me).setEditingState(e)}addCommands(e){l(this,Me).addCommands(e)}cleanUndoStack(e){l(this,Me).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=l(this,Yp))==null||t.togglePointerEvents(e)}async enable(){var s;v(this,Wv,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(s=l(this,Qp))==null||s.abort(),v(this,Qp,null);const e=new Set;for(const i of l(this,ws,R4))i.enableEditing(),i.show(!0),i.annotationElementId&&(l(this,Me).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=l(this,Yp);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),l(this,Me).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}v(this,Wv,!1),l(this,Me)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var i;if(v(this,Gv,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),l(this,di)&&!l(this,Qp)){v(this,Qp,new AbortController);const r=l(this,Me).combinedSignal(l(this,Qp));l(this,di).div.addEventListener("pointerdown",o=>{const{clientX:d,clientY:h,timeStamp:u}=o,p=l(this,qv);if(u-p>500){v(this,qv,u);return}v(this,qv,-1);const{classList:f}=this.div;f.toggle("getElements",!0);const m=document.elementsFromPoint(d,h);if(f.toggle("getElements",!1),!this.div.contains(m[0]))return;let x;const g=new RegExp(`^${_N}[0-9]+$`);for(const y of m)if(g.test(y.id)){x=y.id;break}if(!x)return;const b=l(this,na).get(x);(b==null?void 0:b.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),b.dblclick(o))},{signal:r,capture:!0})}const e=l(this,Yp),t=[];if(e){const r=new Map,o=new Map;for(const d of l(this,ws,R4)){if(d.disableEditing(),!d.annotationElementId){t.push(d);continue}if(d.serialize()!==null){r.set(d.annotationElementId,d);continue}else o.set(d.annotationElementId,d);(i=this.getEditableAnnotation(d.annotationElementId))==null||i.show(),d.remove()}const c=e.getEditableAnnotations();for(const d of c){const{id:h}=d.data;if(l(this,Me).isDeletedAnnotationElement(h)){d.updateEdited({deleted:!0});continue}let u=o.get(h);if(u){u.resetAnnotationElement(d),u.show(!1),d.show();continue}u=r.get(h),u&&(l(this,Me).addChangedExistingAnnotation(u),u.renderAnnotationElement(d)&&u.show(!1)),d.show()}}E(this,ws,HT).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of l(fa,Jp).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),v(this,Gv,!1)}getEditableAnnotation(e){var t;return((t=l(this,Yp))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){l(this,Me).getActive()!==e&&l(this,Me).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=l(this,di))!=null&&e.div&&!l(this,Dh)){v(this,Dh,new AbortController);const t=l(this,Me).combinedSignal(l(this,Dh));l(this,di).div.addEventListener("pointerdown",E(this,ws,uY).bind(this),{signal:t}),l(this,di).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=l(this,di))!=null&&e.div&&l(this,Dh)&&(l(this,Dh).abort(),v(this,Dh,null),l(this,di).div.classList.remove("highlighting"))}enableClick(){if(l(this,Xp))return;v(this,Xp,new AbortController);const e=l(this,Me).combinedSignal(l(this,Xp));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=l(this,Xp))==null||e.abort(),v(this,Xp,null)}attach(e){l(this,na).set(e.id,e);const{annotationElementId:t}=e;t&&l(this,Me).isDeletedAnnotationElement(t)&&l(this,Me).removeDeletedAnnotationElement(e)}detach(e){var t;l(this,na).delete(e.id),(t=l(this,bx))==null||t.removePointerInTextLayer(e.contentDiv),!l(this,Gv)&&e.annotationElementId&&l(this,Me).addDeletedAnnotationElement(e)}remove(e){this.detach(e),l(this,Me).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(l(this,Me).addDeletedAnnotationElement(e.annotationElementId),Ws.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),l(this,Me).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!l(this,Wv)),l(this,Me).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!l(this,Ph)&&(e._focusEventsAllowed=!1,v(this,Ph,setTimeout(()=>{v(this,Ph,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:l(this,Me)._signal}),t.focus())},0))),e._structTreeParentId=(s=l(this,bx))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of l(this,na).values())if(t.uid===e)return t;return null}getNextId(){return l(this,Me).getId()}combinedSignal(e){return l(this,Me).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=l(this,ws,wc))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await l(this,Me).updateMode(e.mode);const{offsetX:s,offsetY:i}=E(this,ws,M4).call(this),r=this.getNextId(),o=E(this,ws,I4).call(this,{parent:this,id:r,x:s,y:i,uiManager:l(this,Me),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=l(fa,Jp).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,l(this,Me)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=E(this,ws,I4).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:l(this,Me),isCentered:t,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(E(this,ws,M4).call(this),!0,e)}setSelected(e){l(this,Me).setSelected(e)}toggleSelected(e){l(this,Me).toggleSelected(e)}unselect(e){l(this,Me).unselect(e)}pointerup(e){var i;const{isMac:t}=Yi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!l(this,Kp)||(v(this,Kp,!1),(i=l(this,ws,wc))!=null&&i.isDrawer&&l(this,ws,wc).supportMultipleDrawings))return;if(!l(this,Vv)){v(this,Vv,!0);return}const s=l(this,Me).getMode();if(s===rt.STAMP||s===rt.SIGNATURE){l(this,Me).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(l(this,Me).getMode()===rt.HIGHLIGHT&&this.enableTextSelection(),l(this,Kp)){v(this,Kp,!1);return}const{isMac:t}=Yi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(v(this,Kp,!0),(i=l(this,ws,wc))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=l(this,Me).getActive();v(this,Vv,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),l(this,$l)){l(this,ws,wc).startDrawing(this,l(this,Me),!1,e);return}l(this,Me).setCurrentDrawingSession(this),v(this,$l,new AbortController);const t=l(this,Me).combinedSignal(l(this,$l));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(v(this,Lh,null),this.commitOrRemove())},{signal:t}),l(this,ws,wc).startDrawing(this,l(this,Me),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&v(this,Lh,t);return}l(this,Lh)&&setTimeout(()=>{var t;(t=l(this,Lh))==null||t.focus(),v(this,Lh,null)},0)}endDrawingSession(e=!1){return l(this,$l)?(l(this,Me).setCurrentDrawingSession(null),l(this,$l).abort(),v(this,$l,null),v(this,Lh,null),l(this,ws,wc).endDrawing(e)):null}findNewParent(e,t,s){const i=l(this,Me).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return l(this,$l)?(this.endDrawingSession(),!0):!1}onScaleChanging(){l(this,$l)&&l(this,ws,wc).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=l(this,Me).getActive())==null?void 0:e.parent)===this&&(l(this,Me).commitOrRemove(),l(this,Me).setActiveEditor(null)),l(this,Ph)&&(clearTimeout(l(this,Ph)),v(this,Ph,null));for(const s of l(this,na).values())(t=l(this,bx))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,l(this,na).clear(),l(this,Me).removeLayer(this)}render({viewport:e}){this.viewport=e,X0(this.div,e);for(const t of l(this,Me).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){l(this,Me).commitOrRemove(),E(this,ws,HT).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,X0(this.div,{rotation:s}),t!==s)for(const i of l(this,na).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return l(this,Me).viewParameters.realScale}},bx=new WeakMap,Vv=new WeakMap,Yp=new WeakMap,Xp=new WeakMap,Ph=new WeakMap,na=new WeakMap,Kp=new WeakMap,Gv=new WeakMap,Wv=new WeakMap,$l=new WeakMap,Lh=new WeakMap,di=new WeakMap,Dh=new WeakMap,Qp=new WeakMap,qv=new WeakMap,Me=new WeakMap,Jp=new WeakMap,ws=new WeakSet,R4=function(){return l(this,na).size!==0?l(this,na).values():l(this,Me).getEditors(this.pageIndex)},uY=function(e){l(this,Me).unselectAll();const{target:t}=e;if(t===l(this,di).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&l(this,di).div.contains(t)){const{isMac:s}=Yi.platform;if(e.button!==0||e.ctrlKey&&s)return;l(this,Me).showAllEditors("highlight",!0,!0),l(this,di).div.classList.add("free"),this.toggleDrawing(),UU.startHighlighting(this,l(this,Me).direction==="ltr",{target:l(this,di).div,x:e.x,y:e.y}),l(this,di).div.addEventListener("pointerup",()=>{l(this,di).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,Me)._signal}),e.preventDefault()}},wc=function(){return l(fa,Jp).get(l(this,Me).getMode())},I4=function(e){const t=l(this,ws,wc);return t?new t.prototype.constructor(e):null},M4=function(){const{x:e,y:t,width:s,height:i}=this.boundingClientRect,r=Math.max(0,e),o=Math.max(0,t),c=Math.min(window.innerWidth,e+s),d=Math.min(window.innerHeight,t+i),h=(r+c)/2-e,u=(o+d)/2-t,[p,f]=this.viewport.rotation%180===0?[h,u]:[u,h];return{offsetX:p,offsetY:f}},HT=function(){for(const e of l(this,na).values())e.isEmpty()&&e.remove()},W(fa,"_initialized",!1),A(fa,Jp,new Map([uhe,ghe,vhe,UU,bhe].map(e=>[e._editorType,e]))),fa);var Ul,_r,vx,mn,T2,WP,pY,Dd,F4,fY,O4;let She=(mn=class{constructor({pageIndex:e}){A(this,Dd);A(this,Ul,null);A(this,_r,new Map);A(this,vx,new Map);this.pageIndex=e}setParent(e){if(!l(this,Ul)){v(this,Ul,e);return}if(l(this,Ul)!==e){if(l(this,_r).size>0)for(const t of l(this,_r).values())t.remove(),e.append(t);v(this,Ul,e)}}static get _svgFactory(){return ot(this,"_svgFactory",new xP)}draw(e,t=!1,s=!1){const i=vt(mn,T2)._++,r=E(this,Dd,F4).call(this),o=mn._svgFactory.createElement("defs");r.append(o);const c=mn._svgFactory.createElement("path");o.append(c);const d=`path_p${this.pageIndex}_${i}`;c.setAttribute("id",d),c.setAttribute("vector-effect","non-scaling-stroke"),t&&l(this,vx).set(i,c);const h=s?E(this,Dd,fY).call(this,o,d):null,u=mn._svgFactory.createElement("use");return r.append(u),u.setAttribute("href",`#${d}`),this.updateProperties(r,e),l(this,_r).set(i,r),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=vt(mn,T2)._++,i=E(this,Dd,F4).call(this),r=mn._svgFactory.createElement("defs");i.append(r);const o=mn._svgFactory.createElement("path");r.append(o);const c=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(t){const p=mn._svgFactory.createElement("mask");r.append(p),d=`mask_p${this.pageIndex}_${s}`,p.setAttribute("id",d),p.setAttribute("maskUnits","objectBoundingBox");const f=mn._svgFactory.createElement("rect");p.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const m=mn._svgFactory.createElement("use");p.append(m),m.setAttribute("href",`#${c}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const h=mn._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${c}`),d&&h.setAttribute("mask",`url(#${d})`);const u=h.cloneNode();return i.append(u),h.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(i,e),l(this,_r).set(s,i),s}finalizeDraw(e,t){l(this,vx).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var d;if(!t)return;const{root:s,bbox:i,rootClass:r,path:o}=t,c=typeof e=="number"?l(this,_r).get(e):e;if(c){if(s&&E(this,Dd,O4).call(this,c,s),i&&E(d=mn,WP,pY).call(d,c,i),r){const{classList:h}=c;for(const[u,p]of Object.entries(r))h.toggle(u,p)}if(o){const u=c.firstChild.firstChild;E(this,Dd,O4).call(this,u,o)}}}updateParent(e,t){if(t===this)return;const s=l(this,_r).get(e);s&&(l(t,Ul).append(s),l(this,_r).delete(e),l(t,_r).set(e,s))}remove(e){l(this,vx).delete(e),l(this,Ul)!==null&&(l(this,_r).get(e).remove(),l(this,_r).delete(e))}destroy(){v(this,Ul,null);for(const e of l(this,_r).values())e.remove();l(this,_r).clear(),l(this,vx).clear()}},Ul=new WeakMap,_r=new WeakMap,vx=new WeakMap,T2=new WeakMap,WP=new WeakSet,pY=function(e,[t,s,i,r]){const{style:o}=e;o.top=`${100*s}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},Dd=new WeakSet,F4=function(){const e=mn._svgFactory.create(1,1,!0);return l(this,Ul).append(e),e.setAttribute("aria-hidden",!0),e},fY=function(e,t){const s=mn._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=mn._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},O4=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},A(mn,WP),A(mn,T2,0),mn);globalThis._pdfjsTestingUtils={HighlightOutliner:v4};globalThis.pdfjsLib={AbortException:pm,AnnotationEditorLayer:whe,AnnotationEditorParamsType:jt,AnnotationEditorType:rt,AnnotationEditorUIManager:LN,AnnotationLayer:hhe,AnnotationMode:ap,AnnotationType:Un,applyOpacity:_ce,build:Vde,ColorPicker:lq,createValidAbsoluteUrl:qW,CSSConstants:Tce,DOMSVGFactory:xP,DrawLayer:She,FeatureTest:Yi,fetchData:jE,findContrastColor:Pce,getDocument:iq,getFilenameFromUrl:Cce,getPdfFilenameFromUrl:Nce,getRGB:AE,getUuid:KW,getXfaPageViewport:Ace,GlobalWorkerOptions:op,ImageKind:cT,InvalidPDFException:SM,isDataScheme:ZL,isPdfFile:p3,isValidExplicitDest:Gce,MathClamp:Mr,noContextMenu:xl,normalizeUnicode:vce,OPS:PN,OutputScale:K0,PasswordResponses:hce,PDFDataRangeTransport:rq,PDFDateString:jM,PDFWorker:i4,PermissionFlag:dce,PixelsPerInch:M1,RenderingCancelledException:u3,renderRichText:t9,ResponseException:gP,setLayerDimensions:X0,shadow:ot,SignatureExtractor:ky,stopEvent:Sn,SupportedImageMimeTypes:EM,TextLayer:t4,TouchManager:S9,updateUrlHash:YW,Util:_e,VerbosityLevel:KL,version:Hde,XfaLayer:ZW};op.workerSrc=new URL("/assets/pdf.worker.min-Cpi8b8z3.mjs",import.meta.url).toString();async function Che(n,e=()=>{}){var t,s,i,r;try{const o=await n.arrayBuffer(),c=iq({data:o});c.onProgress=f=>{if(f.total>0){const m=Math.round(f.loaded/f.total*30);e(m)}};const d=await c.promise,h=d.numPages,u=[];for(let f=1;f<=h;f++){const g=(await(await d.getPage(f)).getTextContent()).items.map(y=>y.str).join(" ").replace(/\s+/g," ").trim();g&&u.push(`[Page ${f}]
${g}`);const b=30+Math.round(f/h*70);e(b)}const p=await d.getMetadata().catch(()=>({}));return{text:u.join(`

`),pageCount:h,metadata:{title:((t=p==null?void 0:p.info)==null?void 0:t.Title)||"",author:((s=p==null?void 0:p.info)==null?void 0:s.Author)||"",subject:((i=p==null?void 0:p.info)==null?void 0:i.Subject)||"",creator:((r=p==null?void 0:p.info)==null?void 0:r.Creator)||"",sourceType:"pdf"}}}catch(o){throw console.error("PDF extraction error:",o),new Error(TN.PROCESSING_FAILED)}}async function Nhe(n,e=()=>{}){return new Promise((t,s)=>{const i=new FileReader;i.onprogress=r=>{if(r.lengthComputable){const o=Math.round(r.loaded/r.total*100);e(o)}},i.onload=r=>{e(100),t({text:r.target.result,metadata:{sourceType:"text"}})},i.onerror=()=>{s(new Error(TN.PROCESSING_FAILED))},i.readAsText(n)})}const SR="http://localhost:3000";async function jhe(n,e=()=>{}){var s,i,r,o,c,d,h,u,p;console.log("[OCR] extractTextFromImage called:",{fileName:n==null?void 0:n.name,fileSize:n==null?void 0:n.size,fileType:n==null?void 0:n.type,apiUrl:SR});const t=localStorage.getItem("auth_token");console.log("[OCR] Auth token present:",!!t),e(10);try{console.log("[OCR] Converting file to base64...");const f=await Ahe(n);if(console.log("[OCR] Base64 conversion complete:",{base64Length:(f==null?void 0:f.length)||0,hasDataPrefix:f==null?void 0:f.startsWith("data:"),preview:(f==null?void 0:f.substring(0,80))+"..."}),e(30),!f||f.length<100)throw console.error("[OCR] Invalid base64 data:",{base64Length:(f==null?void 0:f.length)||0,base64Type:typeof f}),new Error("Failed to convert image to base64");const m={image:f,filename:n.name,mimeType:n.type||"image/jpeg"};console.log("[OCR] Sending request to backend:",{url:`${SR}/api/ocr/extract`,bodySize:JSON.stringify(m).length,filename:m.filename,mimeType:m.mimeType});const x=await fetch(`${SR}/api/ocr/extract`,{method:"POST",headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}},body:JSON.stringify(m)});if(console.log("[OCR] Backend response:",{status:x.status,statusText:x.statusText,ok:x.ok,headers:Object.fromEntries(x.headers.entries())}),e(80),!x.ok){let b="";try{const y=await x.json();b=y.message||y.error||JSON.stringify(y),console.error("[OCR] Backend error response:",y)}catch{const C=await x.text().catch(()=>"Unable to read error");b=C,console.error("[OCR] Backend error (non-JSON):",C)}throw new Error(`OCR extraction failed (${x.status}): ${b}`)}const g=await x.json();if(console.log("[OCR] Backend success response:",{success:g.success,hasText:!!((s=g.data)!=null&&s.text),textLength:((r=(i=g.data)==null?void 0:i.text)==null?void 0:r.length)||0,confidence:(o=g.data)==null?void 0:o.confidence,textPreview:((d=(c=g.data)==null?void 0:c.text)==null?void 0:d.substring(0,100))+"..."}),e(100),!((h=g.data)!=null&&h.text))throw console.warn("[OCR] No text extracted from image"),new Error("No text could be extracted from the image. Please ensure the image contains readable text.");return{text:((u=g.data)==null?void 0:u.text)||"",metadata:{sourceType:"image",requiresOCR:!0,originalName:n.name,confidence:(p=g.data)==null?void 0:p.confidence}}}catch(f){throw console.error("[OCR] extractTextFromImage error:",{message:f.message,name:f.name,stack:f.stack,fileName:n==null?void 0:n.name,fileSize:n==null?void 0:n.size}),e(100),f.message.includes("Failed to fetch")||f.message.includes("NetworkError")?new Error("Network error: Unable to reach the server. Please check your internet connection."):f.message.includes("Failed to convert")?new Error("Image processing error: Could not read the image file."):f.message.includes("No text could be extracted")||f.message.includes("OCR extraction failed")?f:new Error(`Failed to extract text from image: ${f.message}`)}}function Ahe(n){return console.log("[OCR] fileToBase64 called:",{fileName:n==null?void 0:n.name,fileSize:n==null?void 0:n.size,fileType:n==null?void 0:n.type}),new Promise((e,t)=>{if(!n){console.error("[OCR] fileToBase64: No file provided"),t(new Error("No file provided"));return}const s=new FileReader;s.onloadstart=()=>{console.log("[OCR] FileReader: loadstart")},s.onprogress=i=>{if(i.lengthComputable){const r=Math.round(i.loaded/i.total*100);console.log("[OCR] FileReader progress:",r+"%")}},s.onload=()=>{var r;const i=s.result;console.log("[OCR] FileReader: load complete",{resultType:typeof i,resultLength:(i==null?void 0:i.length)||0,hasDataPrefix:(r=i==null?void 0:i.startsWith)==null?void 0:r.call(i,"data:")}),e(i)},s.onerror=i=>{var r,o;console.error("[OCR] FileReader error:",{error:i,readerError:s.error,errorMessage:(r=s.error)==null?void 0:r.message}),t(new Error(`FileReader error: ${((o=s.error)==null?void 0:o.message)||"Unknown error"}`))},s.onabort=()=>{console.warn("[OCR] FileReader: aborted"),t(new Error("File read was aborted"))};try{s.readAsDataURL(n),console.log("[OCR] FileReader: readAsDataURL started")}catch(i){console.error("[OCR] FileReader: failed to start reading",i),t(new Error(`Failed to start reading file: ${i.message}`))}})}async function Ehe(n,e=()=>{}){const{type:t,name:s}=n;if(t==="application/pdf"||s.endsWith(".pdf")){const i=await Che(n,e);return{text:i.text,metadata:{...i.metadata,pageCount:i.pageCount,sourceType:"pdf"}}}if(t==="text/plain"||s.endsWith(".txt"))return await Nhe(n,e);if(t.startsWith("image/"))return await jhe(n,e);throw new Error(TN.INVALID_TYPE)}function khe(n){const t=["application/pdf","image/png","image/jpeg","image/jpg","image/gif","image/webp","text/plain"];if(n.size>10485760)throw new Error(TN.FILE_TOO_LARGE);if(!t.includes(n.type))throw new Error(TN.INVALID_TYPE);return!0}function zU(n){return n.type==="application/pdf"?"pdf":n.type.startsWith("image/")?"image":n.type==="text/plain"?"text":"unknown"}function The(){const{startProcessing:n,updateProgress:e,setProcessingStage:t,addLesson:s,setError:i,resetProcessing:r}=Hu(),o=N.useCallback(async(h,u,p,f)=>{try{khe(h),n(),t("uploading"),e(10),await gy(300),t("extracting");const m=await Ehe(h,w=>{const S=15+Math.round(w*.25);e(S)}),{text:x,metadata:g}=m;if(!x||x.trim().length<10)throw new Error("Could not extract enough text from this file. Try a different file.");e(45),t("analyzing");const b=await XD(x,{subject:p,gradeLevel:f,onProgress:w=>{const S=45+Math.round(w*.25);e(S)}});e(70),t("generating");const y=await KD(x,"study_guide");e(90),t("complete"),e(100);const C=s({id:b.lessonId||void 0,title:u||b.title,subject:p||b.subject,gradeLevel:f||b.gradeLevel,sourceType:zU(h),source:{type:zU(h),originalName:h.name,fileSize:h.size,mimeType:h.type},rawText:x,formattedContent:b.formattedContent||null,content:{rawText:x,formattedContent:b.formattedContent||null,summary:b.summary,keyPoints:b.keyConceptsForChat||[],chapters:b.chapters||[],vocabulary:b.vocabulary||[],studyGuide:y,estimatedReadTime:b.estimatedReadTime||5},summary:b.summary,chapters:b.chapters||[],keyConceptsForChat:b.keyConceptsForChat||[],vocabulary:b.vocabulary||[],suggestedQuestions:b.suggestedQuestions||[],relatedTopics:b.relatedTopics||[],extractionMetadata:g});return await gy(500),C}catch(m){throw console.error("Error processing file:",m),i({message:m.message||"Failed to process file",code:"FILE_PROCESSING_ERROR",timestamp:new Date().toISOString()}),r(),m}},[n,e,t,s,i,r]),c=N.useCallback(async(h,u,p,f)=>{try{n(),t("uploading"),e(10);const m=await VW(h.id);e(20),t("extracting"),e(25);const x=await Ule(h.id);if(e(45),!x||x.trim().length<10)throw new Error("Could not get transcript for this video. Try a different video.");t("analyzing");const g=await XD(x,{subject:p,gradeLevel:f,onProgress:C=>{const w=45+Math.round(C*.25);e(w)}});e(70),t("generating");const b=await KD(x,"study_guide");e(90),t("complete"),e(100);const y=s({id:g.lessonId||void 0,title:u||h.title||m.title||"YouTube Lesson",subject:p||g.subject,gradeLevel:f||g.gradeLevel,sourceType:"youtube",source:{type:"youtube",originalName:h.title||m.title,youtubeId:h.id,thumbnailUrl:qC(h.id,"high")},sourceVideo:{id:h.id,title:h.title||m.title,thumbnail:qC(h.id,"high"),duration:m.duration,channel:m.channel},rawText:x,formattedContent:g.formattedContent||null,content:{rawText:x,formattedContent:g.formattedContent||null,summary:g.summary,keyPoints:g.keyConceptsForChat||[],chapters:g.chapters||[],vocabulary:g.vocabulary||[],studyGuide:b,estimatedReadTime:g.estimatedReadTime||5},summary:g.summary,chapters:g.chapters||[],keyConceptsForChat:g.keyConceptsForChat||[],vocabulary:g.vocabulary||[],suggestedQuestions:g.suggestedQuestions||[],relatedTopics:g.relatedTopics||[]});return await gy(500),y}catch(m){throw console.error("Error processing YouTube video:",m),i({message:m.message||"Failed to process video",code:"YOUTUBE_PROCESSING_ERROR",timestamp:new Date().toISOString()}),r(),m}},[n,e,t,s,i,r]),d=N.useCallback(async(h,u,p,f)=>{try{if(!h||h.trim().length<10)throw new Error("Please enter some text to create a lesson.");n(),t("uploading"),e(15),await gy(300),t("extracting"),e(30),await gy(300),t("analyzing");const m=await XD(h,{subject:p,gradeLevel:f,onProgress:b=>{const y=30+Math.round(b*.4);e(y)}});e(70),t("generating");const x=await KD(h,"study_guide");e(90),t("complete"),e(100);const g=s({id:m.lessonId||void 0,title:u||m.title||"New Lesson",subject:p||m.subject,gradeLevel:f||m.gradeLevel,sourceType:"text",source:{type:"text",originalName:u||"Pasted Text"},rawText:h,formattedContent:m.formattedContent||null,content:{rawText:h,formattedContent:m.formattedContent||null,summary:m.summary,keyPoints:m.keyConceptsForChat||[],chapters:m.chapters||[],vocabulary:m.vocabulary||[],studyGuide:x,estimatedReadTime:m.estimatedReadTime||5},summary:m.summary,chapters:m.chapters||[],keyConceptsForChat:m.keyConceptsForChat||[],vocabulary:m.vocabulary||[],suggestedQuestions:m.suggestedQuestions||[],relatedTopics:m.relatedTopics||[]});return await gy(500),g}catch(m){throw console.error("Error processing text:",m),i({message:m.message||"Failed to process text",code:"TEXT_PROCESSING_ERROR",timestamp:new Date().toISOString()}),r(),m}},[n,e,t,s,i,r]);return{processFile:o,processYouTube:c,processText:d}}function gy(n){return new Promise(e=>setTimeout(e,n))}const _he=[{id:"file",label:"Upload File",icon:va},{id:"youtube",label:"YouTube",icon:o3},{id:"camera",label:"Camera",icon:hP}],mY=({isOpen:n,onClose:e,onSuccess:t})=>{const[s,i]=N.useState("file"),[r,o]=N.useState(null),[c,d]=N.useState(null),[h,u]=N.useState(null),[p,f]=N.useState(null),[m,x]=N.useState(""),[g,b]=N.useState(""),[y,C]=N.useState(""),[w,S]=N.useState(null),[j,T]=N.useState(null),k=N.useRef(!1),{isProcessing:_,processingStage:L,processingProgress:D,error:P,setCurrentLesson:I}=Hu(),{processFile:M,processYouTube:O}=The();N.useEffect(()=>{S(null)},[s]),N.useEffect(()=>{P&&S(P.message||"Something went wrong")},[P]);const F=N.useCallback(q=>{o(q),S(null);const ee=q.name.replace(/\.[^/.]+$/,"");x(ee)},[]),B=N.useCallback(q=>{d(q),S(null),x(q.title)},[]),U=N.useCallback(()=>{o(null),c||x("")},[c]),$=N.useCallback(()=>{d(null),!r&&!h&&x("")},[r,h]),G=N.useCallback((q,ee)=>{u(q),f(ee),S(null);const ie=new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});x(`Photo Lesson - ${ie}`)},[]),ne=N.useCallback(()=>{u(null),f(null),!r&&!c&&x("")},[r,c]),Z=async()=>{if(!m.trim()){S("Please enter a lesson title");return}S(null),T(null);try{let q;r?q=await M(r,m,g,y):c?q=await O(c,m,g,y):h&&(q=await M(h,m,g,y)),q&&(T(q),I(q.id),t&&!k.current&&(k.current=!0,e(),t(q.id)))}catch(q){console.error("Upload failed:",q)}};N.useEffect(()=>{if(L==="complete"&&!P&&j&&!k.current){const q=setTimeout(()=>{const ee=j.id;K(),e(),t&&(k.current=!0,t(ee))},800);return()=>clearTimeout(q)}},[L,P,j,e,t]);const K=()=>{o(null),d(null),u(null),f(null),x(""),b(""),C(""),i("file"),S(null),T(null),k.current=!1},X=(r||c||h)&&m.trim()&&!_,V=q=>{q.target===q.currentTarget&&!_&&e()};return a.jsx(Ie,{children:n&&a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:V,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:a.jsxs(R.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"bg-white rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] w-full max-w-lg max-h-[80vh] overflow-hidden flex flex-col mt-16",children:[a.jsxs("div",{className:"bg-nanobanana-yellow border-b-4 border-black p-4 flex items-center justify-between",children:[a.jsxs("h2",{className:"text-2xl font-black font-comic flex items-center gap-2",children:[a.jsx(Ut,{className:"w-6 h-6"}),"Add New Lesson"]}),!_&&a.jsx("button",{onClick:e,className:"p-2 hover:bg-black/10 rounded-full transition-colors",children:a.jsx(on,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a.jsx(Ie,{mode:"wait",children:_?a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a.jsx(WW,{stage:L,progress:D})},"processing"):a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:[w&&a.jsxs(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 bg-red-50 border-2 border-red-300 rounded-xl flex items-start gap-2",children:[a.jsx(Z5,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),a.jsx("p",{className:"text-red-700 text-sm font-medium",children:w})]}),a.jsx("div",{className:"flex gap-2 p-1 bg-gray-100 rounded-xl",children:_he.map(q=>a.jsxs("button",{onClick:()=>i(q.id),className:`
                                                        flex-1 flex items-center justify-center gap-2
                                                        px-4 py-2 rounded-lg font-bold text-sm
                                                        transition-all
                                                        ${s===q.id?"bg-white shadow-md border-2 border-black":"hover:bg-gray-200"}
                                                    `,children:[a.jsx(q.icon,{className:"w-4 h-4"}),q.label]},q.id))}),a.jsxs(Ie,{mode:"wait",children:[s==="file"&&a.jsx(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:a.jsx(Ole,{onFileSelect:F,selectedFile:r,onClear:U})},"file-tab"),s==="youtube"&&a.jsx(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:a.jsx(zle,{onVideoSelect:B,selectedVideo:c,onClear:$})},"youtube-tab"),s==="camera"&&a.jsx(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:a.jsx(rce,{onImageCapture:G,capturedImage:p,onClear:ne})},"camera-tab")]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold mb-2",children:"Lesson Title *"}),a.jsx("input",{type:"text",value:m,onChange:q=>x(q.target.value),placeholder:"e.g., The Solar System",className:"w-full px-4 py-3 border-4 border-black rounded-xl font-medium shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] focus:outline-none focus:ring-2 focus:ring-nanobanana-yellow"})]}),a.jsx(lce,{value:g,onChange:b}),a.jsx(cce,{value:y,onChange:C})]})]},"form")})}),!_&&a.jsxs("div",{className:"p-4 border-t-4 border-black bg-gray-50 flex gap-3",children:[a.jsx("button",{onClick:e,className:"flex-1 px-6 py-3 font-bold border-4 border-black rounded-xl bg-white hover:bg-gray-100 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none transition-all",children:"Cancel"}),a.jsx("button",{onClick:Z,disabled:!X,className:`
                                        flex-1 px-6 py-3 font-bold border-4 border-black rounded-xl
                                        shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]
                                        active:translate-y-[2px] active:shadow-none
                                        transition-all
                                        ${X?"bg-nanobanana-green text-white hover:bg-green-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}
                                    `,children:"Start Learning! "})]})]})})})},Phe=()=>{var T;const n=Qt(),[e,t]=N.useState(!1),[s,i]=N.useState(null),{clearCurrentLesson:r,recentLessons:o,lessons:c,deleteLesson:d,isLoadingLessons:h,lessonsLoaded:u,refreshLessons:p}=Hu(),{stats:f,loading:m,refetch:x}=Boe();let g=null;try{g=bl()}catch{}let b=null;try{const k=Vt();b=k==null?void 0:k.currentProfile}catch{}N.useEffect(()=>{b!=null&&b.id&&(x&&x(b.id),p&&p())},[b==null?void 0:b.id,x,p]);const y=()=>{r(),t(!0)},C=k=>{p(),n(`/learn/study/${k}`)},w=async(k,_)=>{if(k.stopPropagation(),!s){i(_);try{await Nc.delete(`/lessons/${_}`),d(_),x&&x()}catch(L){console.error("Error deleting lesson:",L)}finally{i(null)}}},S=(b==null?void 0:b.displayName)||(b==null?void 0:b.name)||"Learner",j=h&&!u;return a.jsxs("div",{className:"min-h-full p-6 relative",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[a.jsxs("h1",{className:"text-3xl md:text-4xl font-black font-comic mb-2",children:["Hi, ",S,"!"]}),a.jsx("p",{className:"text-lg text-gray-600",children:"Ready to learn something amazing today?"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[a.jsxs(R.button,{whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},onClick:y,className:"bg-nanobanana-green text-white p-6 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex flex-col items-center gap-3 hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all",children:[a.jsx(q0,{className:"w-10 h-10"}),a.jsx("span",{className:"font-bold text-lg",children:"Upload Lesson"})]}),a.jsx(qe,{to:"/learn/flashcards",className:"block",children:a.jsxs(R.div,{whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},className:"bg-nanobanana-yellow p-6 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex flex-col items-center gap-3 hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all h-full",children:[a.jsx(js,{className:"w-10 h-10"}),a.jsx("span",{className:"font-bold text-lg",children:"Flashcards"})]})}),a.jsx(qe,{to:"/learn/achievements",className:"block",children:a.jsxs(R.div,{whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},className:"bg-nanobanana-blue text-white p-6 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex flex-col items-center gap-3 hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all h-full",children:[a.jsx(K1,{className:"w-10 h-10"}),a.jsx("span",{className:"font-bold text-lg",children:"Achievements"})]})}),a.jsx(qe,{to:"/learn/notebook",className:"block",children:a.jsxs(R.div,{whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},className:"bg-pink-400 text-white p-6 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex flex-col items-center gap-3 hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all h-full",children:[a.jsx(dM,{className:"w-10 h-10"}),a.jsx("span",{className:"font-bold text-lg",children:"My Notebook"})]})})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-3xl font-black text-nanobanana-blue",children:m?"-":f.lessonsCompleted}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Lessons Done"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-3xl font-black text-nanobanana-green",children:m?"-":(T=f.streak)==null?void 0:T.current}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Day Streak"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-3xl font-black text-nanobanana-yellow",children:m?"-":f.badgesEarned}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Badges Earned"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-3xl font-black text-pink-500",children:m?"-":f.xp}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"XP Points"})]})]}),j&&a.jsxs("div",{className:"mb-8 flex items-center justify-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-nanobanana-blue border-t-transparent"}),a.jsx("span",{className:"ml-3 text-gray-600",children:"Loading your lessons..."})]}),!j&&o&&o.length>0&&a.jsxs("div",{className:"mb-8",children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Continue Learning"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.jsx(Ie,{children:o.slice(0,3).map(k=>{var _;return a.jsxs(R.div,{layout:!0,initial:{opacity:1,scale:1},exit:{opacity:0,scale:.8,transition:{duration:.2}},className:"relative group",children:[a.jsx(qe,{to:`/learn/study/${k.id}`,className:"block",children:a.jsx(R.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full bg-white p-4 rounded-xl border-2 border-gray-200 text-left hover:border-nanobanana-blue transition-colors",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-2xl",children:""}),a.jsxs("div",{className:"flex-1 min-w-0 pr-6",children:[a.jsx("h3",{className:"font-bold text-sm truncate",children:k.title}),a.jsx("p",{className:"text-xs text-gray-500",children:k.subject||"General"}),a.jsx("div",{className:"mt-2 h-2 bg-gray-200 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-nanobanana-green rounded-full",style:{width:`${((_=k.progress)==null?void 0:_.percentComplete)||0}%`}})})]})]})})}),a.jsx("button",{onClick:L=>w(L,k.id),disabled:s===k.id,className:"absolute top-2 right-2 w-7 h-7 bg-gray-100 hover:bg-red-100 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200 hover:text-red-500 border border-gray-200 hover:border-red-300 z-10",title:"Delete lesson",children:s===k.id?a.jsx(R.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-gray-300 border-t-gray-600 rounded-full"}):a.jsx(on,{className:"w-4 h-4"})})]},k.id)})})})]}),!j&&u&&(!o||o.length===0)&&a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-gradient-to-br from-nanobanana-yellow/20 to-nanobanana-green/20 rounded-3xl border-4 border-dashed border-gray-300 p-12 text-center",children:[a.jsx("div",{className:"w-24 h-24 mx-auto mb-6 bg-nanobanana-yellow rounded-full border-4 border-black flex items-center justify-center",children:a.jsx("span",{className:"text-5xl",children:""})}),a.jsx("h2",{className:"text-2xl font-bold font-comic mb-2",children:"No lessons yet!"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Upload your first lesson to start learning with Jeffrey"}),a.jsxs("button",{onClick:y,className:"inline-flex items-center gap-2 bg-nanobanana-green text-white font-bold px-6 py-3 rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-all",children:[a.jsx(q0,{className:"w-5 h-5"}),"Upload Your First Lesson"]})]}),a.jsx(mY,{isOpen:e,onClose:()=>t(!1),onSuccess:C})]})},Lhe=({children:n,className:e="bg-nanobanana-blue",showClouds:t=!1})=>{const s=t?"bg-gradient-to-b from-sky-100 via-sky-50 to-amber-50":e;return a.jsxs("div",{className:`h-screen w-full overflow-hidden flex relative ${s}`,children:[a.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none z-0",children:[!t&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute top-10 left-10 w-20 h-20 bg-nanobanana-yellow rounded-full opacity-20 blur-xl"}),a.jsx("div",{className:"absolute bottom-20 right-20 w-32 h-32 bg-nanobanana-green rounded-full opacity-20 blur-xl"})]}),t&&a.jsxs(a.Fragment,{children:[a.jsx(R.img,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1},src:"/assets/images/cloud_backdrop_top.png",alt:"",className:"absolute top-0 left-0 w-full object-contain",onError:i=>{i.target.style.display="none"}}),a.jsx(R.img,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:1},src:"/assets/images/cloud_backdrop_bottom.png",alt:"",className:"absolute bottom-0 left-0 w-full object-contain",onError:i=>{i.target.style.display="none"}})]})]}),a.jsx("div",{className:"relative z-10 w-full h-full flex",children:n})]})};/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:gY,setPrototypeOf:HU,isFrozen:Dhe,getPrototypeOf:Rhe,getOwnPropertyDescriptor:Ihe}=Object;let{freeze:Vr,seal:yl,create:B4}=Object,{apply:$4,construct:U4}=typeof Reflect<"u"&&Reflect;Vr||(Vr=function(e){return e});yl||(yl=function(e){return e});$4||($4=function(e,t){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];return e.apply(t,i)});U4||(U4=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return new e(...s)});const _k=Gr(Array.prototype.forEach),Mhe=Gr(Array.prototype.lastIndexOf),VU=Gr(Array.prototype.pop),jS=Gr(Array.prototype.push),Fhe=Gr(Array.prototype.splice),VT=Gr(String.prototype.toLowerCase),CR=Gr(String.prototype.toString),NR=Gr(String.prototype.match),AS=Gr(String.prototype.replace),Ohe=Gr(String.prototype.indexOf),Bhe=Gr(String.prototype.trim),El=Gr(Object.prototype.hasOwnProperty),Nr=Gr(RegExp.prototype.test),ES=$he(TypeError);function Gr(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];return $4(n,e,s)}}function $he(n){return function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return U4(n,t)}}function wt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:VT;HU&&HU(n,null);let s=e.length;for(;s--;){let i=e[s];if(typeof i=="string"){const r=t(i);r!==i&&(Dhe(e)||(e[s]=r),i=r)}n[i]=!0}return n}function Uhe(n){for(let e=0;e<n.length;e++)El(n,e)||(n[e]=null);return n}function Gd(n){const e=B4(null);for(const[t,s]of gY(n))El(n,t)&&(Array.isArray(s)?e[t]=Uhe(s):s&&typeof s=="object"&&s.constructor===Object?e[t]=Gd(s):e[t]=s);return e}function kS(n,e){for(;n!==null;){const s=Ihe(n,e);if(s){if(s.get)return Gr(s.get);if(typeof s.value=="function")return Gr(s.value)}n=Rhe(n)}function t(){return null}return t}const GU=Vr(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),jR=Vr(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),AR=Vr(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),zhe=Vr(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ER=Vr(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Hhe=Vr(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),WU=Vr(["#text"]),qU=Vr(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),kR=Vr(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),YU=Vr(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Pk=Vr(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Vhe=yl(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ghe=yl(/<%[\w\W]*|[\w\W]*%>/gm),Whe=yl(/\$\{[\w\W]*/gm),qhe=yl(/^data-[\-\w.\u00B7-\uFFFF]+$/),Yhe=yl(/^aria-[\-\w]+$/),xY=yl(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Xhe=yl(/^(?:\w+script|data):/i),Khe=yl(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),yY=yl(/^html$/i),Qhe=yl(/^[a-z][.\w]*(-[.\w]+)+$/i);var XU=Object.freeze({__proto__:null,ARIA_ATTR:Yhe,ATTR_WHITESPACE:Khe,CUSTOM_ELEMENT:Qhe,DATA_ATTR:qhe,DOCTYPE_NAME:yY,ERB_EXPR:Ghe,IS_ALLOWED_URI:xY,IS_SCRIPT_OR_DATA:Xhe,MUSTACHE_EXPR:Vhe,TMPLIT_EXPR:Whe});const TS={element:1,text:3,progressingInstruction:7,comment:8,document:9},Jhe=function(){return typeof window>"u"?null:window},Zhe=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(s=t.getAttribute(i));const r="dompurify"+(s?"#"+s:"");try{return e.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},KU=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function bY(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jhe();const e=de=>bY(de);if(e.version="3.3.0",e.removed=[],!n||!n.document||n.document.nodeType!==TS.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const s=t,i=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:o,Node:c,Element:d,NodeFilter:h,NamedNodeMap:u=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:p,DOMParser:f,trustedTypes:m}=n,x=d.prototype,g=kS(x,"cloneNode"),b=kS(x,"remove"),y=kS(x,"nextSibling"),C=kS(x,"childNodes"),w=kS(x,"parentNode");if(typeof o=="function"){const de=t.createElement("template");de.content&&de.content.ownerDocument&&(t=de.content.ownerDocument)}let S,j="";const{implementation:T,createNodeIterator:k,createDocumentFragment:_,getElementsByTagName:L}=t,{importNode:D}=s;let P=KU();e.isSupported=typeof gY=="function"&&typeof w=="function"&&T&&T.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:I,ERB_EXPR:M,TMPLIT_EXPR:O,DATA_ATTR:F,ARIA_ATTR:B,IS_SCRIPT_OR_DATA:U,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:G}=XU;let{IS_ALLOWED_URI:ne}=XU,Z=null;const K=wt({},[...GU,...jR,...AR,...ER,...WU]);let X=null;const V=wt({},[...qU,...kR,...YU,...Pk]);let q=Object.seal(B4(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ee=null,ie=null;const Re=Object.seal(B4(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ye=!0,Le=!0,te=!1,fe=!0,Ne=!1,Pe=!0,nt=!1,gt=!1,hs=!1,qs=!1,Cn=!1,ni=!1,Ji=!0,Si=!1;const Ci="user-content-";let ce=!0,ye=!1,se={},pe=null;const Ue=wt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Be=null;const je=wt({},["audio","video","img","source","image","track"]);let ze=null;const Ft=wt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Bt="http://www.w3.org/1998/Math/MathML",Ys="http://www.w3.org/2000/svg",In="http://www.w3.org/1999/xhtml";let wa=In,Fd=!1,uc=null;const Gu=wt({},[Bt,Ys,In],CR);let Am=wt({},["mi","mo","mn","ms","mtext"]),Wu=wt({},["annotation-xml"]);const eS=wt({},["title","style","font","a","script"]);let Em=null;const BE=["application/xhtml+xml","text/html"],hD="text/html";let Nn=null,vl=null;const ly=t.createElement("form"),$E=function(z){return z instanceof RegExp||z instanceof Function},tS=function(){let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(vl&&vl===z)){if((!z||typeof z!="object")&&(z={}),z=Gd(z),Em=BE.indexOf(z.PARSER_MEDIA_TYPE)===-1?hD:z.PARSER_MEDIA_TYPE,Nn=Em==="application/xhtml+xml"?CR:VT,Z=El(z,"ALLOWED_TAGS")?wt({},z.ALLOWED_TAGS,Nn):K,X=El(z,"ALLOWED_ATTR")?wt({},z.ALLOWED_ATTR,Nn):V,uc=El(z,"ALLOWED_NAMESPACES")?wt({},z.ALLOWED_NAMESPACES,CR):Gu,ze=El(z,"ADD_URI_SAFE_ATTR")?wt(Gd(Ft),z.ADD_URI_SAFE_ATTR,Nn):Ft,Be=El(z,"ADD_DATA_URI_TAGS")?wt(Gd(je),z.ADD_DATA_URI_TAGS,Nn):je,pe=El(z,"FORBID_CONTENTS")?wt({},z.FORBID_CONTENTS,Nn):Ue,ee=El(z,"FORBID_TAGS")?wt({},z.FORBID_TAGS,Nn):Gd({}),ie=El(z,"FORBID_ATTR")?wt({},z.FORBID_ATTR,Nn):Gd({}),se=El(z,"USE_PROFILES")?z.USE_PROFILES:!1,Ye=z.ALLOW_ARIA_ATTR!==!1,Le=z.ALLOW_DATA_ATTR!==!1,te=z.ALLOW_UNKNOWN_PROTOCOLS||!1,fe=z.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ne=z.SAFE_FOR_TEMPLATES||!1,Pe=z.SAFE_FOR_XML!==!1,nt=z.WHOLE_DOCUMENT||!1,qs=z.RETURN_DOM||!1,Cn=z.RETURN_DOM_FRAGMENT||!1,ni=z.RETURN_TRUSTED_TYPE||!1,hs=z.FORCE_BODY||!1,Ji=z.SANITIZE_DOM!==!1,Si=z.SANITIZE_NAMED_PROPS||!1,ce=z.KEEP_CONTENT!==!1,ye=z.IN_PLACE||!1,ne=z.ALLOWED_URI_REGEXP||xY,wa=z.NAMESPACE||In,Am=z.MATHML_TEXT_INTEGRATION_POINTS||Am,Wu=z.HTML_INTEGRATION_POINTS||Wu,q=z.CUSTOM_ELEMENT_HANDLING||{},z.CUSTOM_ELEMENT_HANDLING&&$E(z.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(q.tagNameCheck=z.CUSTOM_ELEMENT_HANDLING.tagNameCheck),z.CUSTOM_ELEMENT_HANDLING&&$E(z.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(q.attributeNameCheck=z.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),z.CUSTOM_ELEMENT_HANDLING&&typeof z.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(q.allowCustomizedBuiltInElements=z.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ne&&(Le=!1),Cn&&(qs=!0),se&&(Z=wt({},WU),X=[],se.html===!0&&(wt(Z,GU),wt(X,qU)),se.svg===!0&&(wt(Z,jR),wt(X,kR),wt(X,Pk)),se.svgFilters===!0&&(wt(Z,AR),wt(X,kR),wt(X,Pk)),se.mathMl===!0&&(wt(Z,ER),wt(X,YU),wt(X,Pk))),z.ADD_TAGS&&(typeof z.ADD_TAGS=="function"?Re.tagCheck=z.ADD_TAGS:(Z===K&&(Z=Gd(Z)),wt(Z,z.ADD_TAGS,Nn))),z.ADD_ATTR&&(typeof z.ADD_ATTR=="function"?Re.attributeCheck=z.ADD_ATTR:(X===V&&(X=Gd(X)),wt(X,z.ADD_ATTR,Nn))),z.ADD_URI_SAFE_ATTR&&wt(ze,z.ADD_URI_SAFE_ATTR,Nn),z.FORBID_CONTENTS&&(pe===Ue&&(pe=Gd(pe)),wt(pe,z.FORBID_CONTENTS,Nn)),ce&&(Z["#text"]=!0),nt&&wt(Z,["html","head","body"]),Z.table&&(wt(Z,["tbody"]),delete ee.tbody),z.TRUSTED_TYPES_POLICY){if(typeof z.TRUSTED_TYPES_POLICY.createHTML!="function")throw ES('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof z.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ES('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=z.TRUSTED_TYPES_POLICY,j=S.createHTML("")}else S===void 0&&(S=Zhe(m,i)),S!==null&&typeof j=="string"&&(j=S.createHTML(""));Vr&&Vr(z),vl=z}},H=wt({},[...jR,...AR,...zhe]),Y=wt({},[...ER,...Hhe]),Q=function(z){let oe=w(z);(!oe||!oe.tagName)&&(oe={namespaceURI:wa,tagName:"template"});const we=VT(z.tagName),kt=VT(oe.tagName);return uc[z.namespaceURI]?z.namespaceURI===Ys?oe.namespaceURI===In?we==="svg":oe.namespaceURI===Bt?we==="svg"&&(kt==="annotation-xml"||Am[kt]):!!H[we]:z.namespaceURI===Bt?oe.namespaceURI===In?we==="math":oe.namespaceURI===Ys?we==="math"&&Wu[kt]:!!Y[we]:z.namespaceURI===In?oe.namespaceURI===Ys&&!Wu[kt]||oe.namespaceURI===Bt&&!Am[kt]?!1:!Y[we]&&(eS[we]||!H[we]):!!(Em==="application/xhtml+xml"&&uc[z.namespaceURI]):!1},re=function(z){jS(e.removed,{element:z});try{w(z).removeChild(z)}catch{b(z)}},he=function(z,oe){try{jS(e.removed,{attribute:oe.getAttributeNode(z),from:oe})}catch{jS(e.removed,{attribute:null,from:oe})}if(oe.removeAttribute(z),z==="is")if(qs||Cn)try{re(oe)}catch{}else try{oe.setAttribute(z,"")}catch{}},$e=function(z){let oe=null,we=null;if(hs)z="<remove></remove>"+z;else{const Fs=NR(z,/^[\r\n\t ]+/);we=Fs&&Fs[0]}Em==="application/xhtml+xml"&&wa===In&&(z='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+z+"</body></html>");const kt=S?S.createHTML(z):z;if(wa===In)try{oe=new f().parseFromString(kt,Em)}catch{}if(!oe||!oe.documentElement){oe=T.createDocument(wa,"template",null);try{oe.documentElement.innerHTML=Fd?j:kt}catch{}}const us=oe.body||oe.documentElement;return z&&we&&us.insertBefore(t.createTextNode(we),us.childNodes[0]||null),wa===In?L.call(oe,nt?"html":"body")[0]:nt?oe.documentElement:us},Xe=function(z){return k.call(z.ownerDocument||z,z,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},Ae=function(z){return z instanceof p&&(typeof z.nodeName!="string"||typeof z.textContent!="string"||typeof z.removeChild!="function"||!(z.attributes instanceof u)||typeof z.removeAttribute!="function"||typeof z.setAttribute!="function"||typeof z.namespaceURI!="string"||typeof z.insertBefore!="function"||typeof z.hasChildNodes!="function")},De=function(z){return typeof c=="function"&&z instanceof c};function xe(de,z,oe){_k(de,we=>{we.call(e,z,oe,vl)})}const Oe=function(z){let oe=null;if(xe(P.beforeSanitizeElements,z,null),Ae(z))return re(z),!0;const we=Nn(z.nodeName);if(xe(P.uponSanitizeElement,z,{tagName:we,allowedTags:Z}),Pe&&z.hasChildNodes()&&!De(z.firstElementChild)&&Nr(/<[/\w!]/g,z.innerHTML)&&Nr(/<[/\w!]/g,z.textContent)||z.nodeType===TS.progressingInstruction||Pe&&z.nodeType===TS.comment&&Nr(/<[/\w]/g,z.data))return re(z),!0;if(!(Re.tagCheck instanceof Function&&Re.tagCheck(we))&&(!Z[we]||ee[we])){if(!ee[we]&&bt(we)&&(q.tagNameCheck instanceof RegExp&&Nr(q.tagNameCheck,we)||q.tagNameCheck instanceof Function&&q.tagNameCheck(we)))return!1;if(ce&&!pe[we]){const kt=w(z)||z.parentNode,us=C(z)||z.childNodes;if(us&&kt){const Fs=us.length;for(let Fn=Fs-1;Fn>=0;--Fn){const Ni=g(us[Fn],!0);Ni.__removalCount=(z.__removalCount||0)+1,kt.insertBefore(Ni,y(z))}}}return re(z),!0}return z instanceof d&&!Q(z)||(we==="noscript"||we==="noembed"||we==="noframes")&&Nr(/<\/no(script|embed|frames)/i,z.innerHTML)?(re(z),!0):(Ne&&z.nodeType===TS.text&&(oe=z.textContent,_k([I,M,O],kt=>{oe=AS(oe,kt," ")}),z.textContent!==oe&&(jS(e.removed,{element:z.cloneNode()}),z.textContent=oe)),xe(P.afterSanitizeElements,z,null),!1)},Ze=function(z,oe,we){if(Ji&&(oe==="id"||oe==="name")&&(we in t||we in ly))return!1;if(!(Le&&!ie[oe]&&Nr(F,oe))){if(!(Ye&&Nr(B,oe))){if(!(Re.attributeCheck instanceof Function&&Re.attributeCheck(oe,z))){if(!X[oe]||ie[oe]){if(!(bt(z)&&(q.tagNameCheck instanceof RegExp&&Nr(q.tagNameCheck,z)||q.tagNameCheck instanceof Function&&q.tagNameCheck(z))&&(q.attributeNameCheck instanceof RegExp&&Nr(q.attributeNameCheck,oe)||q.attributeNameCheck instanceof Function&&q.attributeNameCheck(oe,z))||oe==="is"&&q.allowCustomizedBuiltInElements&&(q.tagNameCheck instanceof RegExp&&Nr(q.tagNameCheck,we)||q.tagNameCheck instanceof Function&&q.tagNameCheck(we))))return!1}else if(!ze[oe]){if(!Nr(ne,AS(we,$,""))){if(!((oe==="src"||oe==="xlink:href"||oe==="href")&&z!=="script"&&Ohe(we,"data:")===0&&Be[z])){if(!(te&&!Nr(U,AS(we,$,"")))){if(we)return!1}}}}}}}return!0},bt=function(z){return z!=="annotation-xml"&&NR(z,G)},Mn=function(z){xe(P.beforeSanitizeAttributes,z,null);const{attributes:oe}=z;if(!oe||Ae(z))return;const we={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:X,forceKeepAttr:void 0};let kt=oe.length;for(;kt--;){const us=oe[kt],{name:Fs,namespaceURI:Fn,value:Ni}=us,wl=Nn(Fs),qu=Ni;let Ge=Fs==="value"?qu:Bhe(qu);if(we.attrName=wl,we.attrValue=Ge,we.keepAttr=!0,we.forceKeepAttr=void 0,xe(P.uponSanitizeAttribute,z,we),Ge=we.attrValue,Si&&(wl==="id"||wl==="name")&&(he(Fs,z),Ge=Ci+Ge),Pe&&Nr(/((--!?|])>)|<\/(style|title|textarea)/i,Ge)){he(Fs,z);continue}if(wl==="attributename"&&NR(Ge,"href")){he(Fs,z);continue}if(we.forceKeepAttr)continue;if(!we.keepAttr){he(Fs,z);continue}if(!fe&&Nr(/\/>/i,Ge)){he(Fs,z);continue}Ne&&_k([I,M,O],Od=>{Ge=AS(Ge,Od," ")});const Ps=Nn(z.nodeName);if(!Ze(Ps,wl,Ge)){he(Fs,z);continue}if(S&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!Fn)switch(m.getAttributeType(Ps,wl)){case"TrustedHTML":{Ge=S.createHTML(Ge);break}case"TrustedScriptURL":{Ge=S.createScriptURL(Ge);break}}if(Ge!==qu)try{Fn?z.setAttributeNS(Fn,Fs,Ge):z.setAttribute(Fs,Ge),Ae(z)?re(z):VU(e.removed)}catch{he(Fs,z)}}xe(P.afterSanitizeAttributes,z,null)},Jt=function de(z){let oe=null;const we=Xe(z);for(xe(P.beforeSanitizeShadowDOM,z,null);oe=we.nextNode();)xe(P.uponSanitizeShadowNode,oe,null),Oe(oe),Mn(oe),oe.content instanceof r&&de(oe.content);xe(P.afterSanitizeShadowDOM,z,null)};return e.sanitize=function(de){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},oe=null,we=null,kt=null,us=null;if(Fd=!de,Fd&&(de="<!-->"),typeof de!="string"&&!De(de))if(typeof de.toString=="function"){if(de=de.toString(),typeof de!="string")throw ES("dirty is not a string, aborting")}else throw ES("toString is not a function");if(!e.isSupported)return de;if(gt||tS(z),e.removed=[],typeof de=="string"&&(ye=!1),ye){if(de.nodeName){const Ni=Nn(de.nodeName);if(!Z[Ni]||ee[Ni])throw ES("root node is forbidden and cannot be sanitized in-place")}}else if(de instanceof c)oe=$e("<!---->"),we=oe.ownerDocument.importNode(de,!0),we.nodeType===TS.element&&we.nodeName==="BODY"||we.nodeName==="HTML"?oe=we:oe.appendChild(we);else{if(!qs&&!Ne&&!nt&&de.indexOf("<")===-1)return S&&ni?S.createHTML(de):de;if(oe=$e(de),!oe)return qs?null:ni?j:""}oe&&hs&&re(oe.firstChild);const Fs=Xe(ye?de:oe);for(;kt=Fs.nextNode();)Oe(kt),Mn(kt),kt.content instanceof r&&Jt(kt.content);if(ye)return de;if(qs){if(Cn)for(us=_.call(oe.ownerDocument);oe.firstChild;)us.appendChild(oe.firstChild);else us=oe;return(X.shadowroot||X.shadowrootmode)&&(us=D.call(s,us,!0)),us}let Fn=nt?oe.outerHTML:oe.innerHTML;return nt&&Z["!doctype"]&&oe.ownerDocument&&oe.ownerDocument.doctype&&oe.ownerDocument.doctype.name&&Nr(yY,oe.ownerDocument.doctype.name)&&(Fn="<!DOCTYPE "+oe.ownerDocument.doctype.name+`>
`+Fn),Ne&&_k([I,M,O],Ni=>{Fn=AS(Fn,Ni," ")}),S&&ni?S.createHTML(Fn):Fn},e.setConfig=function(){let de=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};tS(de),gt=!0},e.clearConfig=function(){vl=null,gt=!1},e.isValidAttribute=function(de,z,oe){vl||tS({});const we=Nn(de),kt=Nn(z);return Ze(we,kt,oe)},e.addHook=function(de,z){typeof z=="function"&&jS(P[de],z)},e.removeHook=function(de,z){if(z!==void 0){const oe=Mhe(P[de],z);return oe===-1?void 0:Fhe(P[de],oe,1)[0]}return VU(P[de])},e.removeHooks=function(de){P[de]=[]},e.removeAllHooks=function(){P=KU()},e}var QU=bY();const eue=({card:n,isFlipped:e,onFlip:t,showMastery:s=!0,size:i="large"})=>{const[r,o]=N.useState(!1),c=e!==void 0?e:r,d=()=>{t?t():o(!r)},h=x5(n.correctReviews||0),u={small:"w-64 h-40",medium:"w-80 h-52",large:"w-full max-w-md h-64"},p={gray:"bg-gray-100 border-gray-300",orange:"bg-orange-100 border-orange-300",yellow:"bg-yellow-100 border-yellow-300",blue:"bg-blue-100 border-blue-300",green:"bg-green-100 border-green-300"};return a.jsx("div",{className:`${u[i]} perspective-1000`,children:a.jsxs(R.div,{className:"relative w-full h-full cursor-pointer",onClick:d,style:{transformStyle:"preserve-3d"},animate:{rotateY:c?180:0},transition:{duration:.6,type:"spring",stiffness:100},children:[a.jsxs("div",{className:`
                        absolute w-full h-full rounded-3xl border-4 border-black
                        shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]
                        bg-gradient-to-br from-nanobanana-blue to-blue-600
                        flex flex-col items-center justify-center p-6
                        backface-hidden
                    `,style:{backfaceVisibility:"hidden"},children:[s&&a.jsx("div",{className:`
                            absolute top-3 right-3 px-2 py-1 rounded-full text-xs font-bold
                            border-2 ${p[h.color]}
                        `,children:h.label}),a.jsx("div",{className:"absolute top-3 left-3",children:a.jsx(qL,{className:"w-6 h-6 text-white/70"})}),a.jsxs("div",{className:"text-white text-center",children:[a.jsx("p",{className:"text-xs uppercase tracking-wide mb-2 text-white/70 font-bold",children:"Question"}),a.jsx("p",{className:"text-lg md:text-xl font-bold font-comic leading-relaxed",children:n.front})]}),a.jsxs("div",{className:"absolute bottom-3 flex items-center gap-1 text-white/60 text-xs",children:[a.jsx(L1,{className:"w-3 h-3"}),"Tap to flip"]})]}),a.jsxs("div",{className:`
                        absolute w-full h-full rounded-3xl border-4 border-black
                        shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]
                        bg-gradient-to-br from-nanobanana-green to-green-600
                        flex flex-col items-center justify-center p-6
                        backface-hidden
                    `,style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:[a.jsxs("div",{className:"text-white text-center",children:[a.jsx("p",{className:"text-xs uppercase tracking-wide mb-2 text-white/70 font-bold",children:"Answer"}),a.jsx("p",{className:"text-lg md:text-xl font-bold font-comic leading-relaxed",children:n.back})]}),a.jsxs("div",{className:"absolute bottom-3 flex items-center gap-1 text-white/60 text-xs",children:[a.jsx(L1,{className:"w-3 h-3"}),"Tap to flip back"]})]})]})})},tue=({deck:n,dueCount:e=0,onStudy:t,onEdit:s,onDelete:i,compact:r=!1})=>{const o=nP.find(d=>d.id===n.category)||nP[0],c={blue:"from-blue-400 to-blue-600",purple:"from-purple-400 to-purple-600",green:"from-green-400 to-green-600",cyan:"from-cyan-400 to-cyan-600",pink:"from-pink-400 to-pink-600"};return r?a.jsx(R.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>t==null?void 0:t(n.id),className:`
                    relative p-4 rounded-2xl border-4 border-black
                    shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                    bg-gradient-to-br ${c[o.color]||c.blue}
                    cursor-pointer hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]
                    transition-shadow
                `,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-3xl",children:o.icon}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-bold font-comic text-white truncate",children:n.name}),a.jsxs("p",{className:"text-xs text-white/80",children:[n.cardCount||0," cards"]})]}),e>0&&a.jsxs("div",{className:"bg-white text-black px-2 py-1 rounded-full text-xs font-bold",children:[e," due"]})]})}):a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`
                relative bg-white rounded-2xl border-4 border-black
                shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                overflow-hidden
            `,children:[a.jsx("div",{className:`
                p-4 bg-gradient-to-r ${c[o.color]||c.blue}
                border-b-4 border-black
            `,children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center text-2xl",children:o.icon}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold font-comic text-lg text-white",children:n.name}),a.jsx("p",{className:"text-xs text-white/80",children:o.label})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[s&&a.jsx("button",{onClick:d=>{d.stopPropagation(),s(n.id)},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:a.jsx(aoe,{className:"w-4 h-4 text-white"})}),i&&a.jsx("button",{onClick:d=>{d.stopPropagation(),i(n.id)},className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:a.jsx(um,{className:"w-4 h-4 text-white"})})]})]})}),a.jsxs("div",{className:"p-4",children:[n.description&&a.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:n.description}),a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(Ki,{className:"w-4 h-4 text-gray-500"}),a.jsxs("span",{className:"font-medium",children:[n.cardCount||0," cards"]})]}),e>0&&a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(Pd,{className:"w-4 h-4 text-orange-500"}),a.jsxs("span",{className:"font-medium text-orange-600",children:[e," due today"]})]})]}),a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>t==null?void 0:t(n.id),disabled:!n.cardCount||n.cardCount===0,className:`
                        w-full py-3 px-4 rounded-xl border-4 border-black
                        shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                        font-bold font-comic flex items-center justify-center gap-2
                        transition-all
                        ${n.cardCount>0?"bg-nanobanana-yellow hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]":"bg-gray-200 cursor-not-allowed opacity-50"}
                    `,children:[a.jsx(coe,{className:"w-5 h-5"}),e>0?`Study ${e} Due Cards`:"Study Now"]})]}),e>0&&a.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-red-500 rounded-full border-2 border-black flex items-center justify-center",children:a.jsx("span",{className:"text-white text-xs font-bold",children:e>9?"9+":e})})]})},Lm={LESSON_COMPLETE:50,QUESTION_CORRECT:10,QUESTION_CORRECT_EASY:5,QUESTION_CORRECT_HARD:15,FLASHCARD_REVIEWED:5,PERFECT_SCORE:100,STUDY_TIME:10};function vY(){const{earnXP:n,updateStatistics:e,updateDailyChallengeProgress:t,recordActivity:s,statistics:i}=bl(),r=N.useCallback((p="general",f=0)=>{s(),n(Lm.LESSON_COMPLETE,"Completed a lesson!"),e({lessonsCompleted:((i==null?void 0:i.lessonsCompleted)||0)+1,totalStudyTime:((i==null?void 0:i.totalStudyTime)||0)+f}),t("lessonCompleted")},[n,e,t,s,i]),o=N.useCallback((p,f="medium")=>{if(s(),p){const m=f==="hard"?Lm.QUESTION_CORRECT_HARD:f==="easy"?Lm.QUESTION_CORRECT_EASY:Lm.QUESTION_CORRECT;n(m,"Correct answer!"),t("questionAnswered")}e({questionsAnswered:((i==null?void 0:i.questionsAnswered)||0)+1})},[n,e,t,s,i]),c=N.useCallback((p=1)=>{s(),n(Lm.FLASHCARD_REVIEWED*p,`Reviewed ${p} flashcard${p>1?"s":""}!`),e({flashcardsReviewed:((i==null?void 0:i.flashcardsReviewed)||0)+p}),t("flashcardReviewed",p)},[n,e,t,s,i]),d=N.useCallback(()=>{n(Lm.PERFECT_SCORE,"Perfect score! Amazing!"),e({perfectScores:((i==null?void 0:i.perfectScores)||0)+1})},[n,e,i]),h=N.useCallback(p=>{s();const f=Math.floor(p/10)*Lm.STUDY_TIME;f>0&&n(f,`${p} minutes of learning!`),e({totalStudyTime:((i==null?void 0:i.totalStudyTime)||0)+p}),t("studyTime",p)},[n,e,t,s,i]),u=N.useCallback(()=>{s()},[s]);return{recordLessonComplete:r,recordQuestionAnswered:o,recordFlashcardReviewed:c,recordPerfectScore:d,recordStudyTime:h,recordChatInteraction:u}}const sue=({deckId:n,onClose:e,onComplete:t})=>{const{currentSession:s,cards:i,startSession:r,recordSessionAnswer:o,endSession:c}=ML(),{recordFlashcardReviewed:d}=vY(),[h,u]=N.useState([]),[p,f]=N.useState(0),[m,x]=N.useState(!1),[g,b]=N.useState(!1),[y,C]=N.useState(!1),[w,S]=N.useState(null);N.useEffect(()=>{const P=r(n);P&&P.length>0?u(P):(C(!0),S({total:0,correct:0,accuracy:0,xpEarned:0}))},[n,r]);const j=h[p],T=()=>{x(!m),m||setTimeout(()=>b(!0),300)},k=N.useCallback(P=>{if(!j)return;const I=P.id==="got_it"||P.id==="almost",M=o(j.id,I,P.id);if(M){C(!0),S(M),d(h.length),t==null||t(M);return}x(!1),b(!1),f(O=>O+1)},[j,o,h.length,d,t]),_=()=>{p<h.length-1&&(x(!1),b(!1),f(P=>P+1))},L=()=>{if(s){const P=c();P&&P.total>0&&d(P.total)}e==null||e()};if(N.useEffect(()=>{const P=I=>{(I.key===" "||I.key==="Enter")&&(I.preventDefault(),g||T()),I.key==="Escape"&&L(),g&&(I.key==="1"&&k(pk[0]),I.key==="2"&&k(pk[1]),I.key==="3"&&k(pk[2]))};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[g,k]),y)return a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gradient-to-br from-nanobanana-blue to-purple-600 z-50 flex items-center justify-center p-4",children:a.jsxs(R.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] p-8 max-w-md w-full text-center",children:[w&&w.total>0?a.jsxs(a.Fragment,{children:[a.jsx(R.div,{animate:{rotate:[0,10,-10,0]},transition:{repeat:2,duration:.5},className:"w-24 h-24 mx-auto mb-4 bg-nanobanana-yellow rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center",children:a.jsx(K1,{className:"w-12 h-12 text-black"})}),a.jsx("h2",{className:"text-3xl font-black font-comic mb-2",children:w.isPerfect?"Amazing!":"Great Job!"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["You reviewed ",w.total," cards!"]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{className:"p-3 bg-green-50 rounded-xl border-2 border-green-200",children:[a.jsx("div",{className:"text-2xl font-black text-green-600",children:w.correct}),a.jsx("div",{className:"text-xs text-green-700",children:"Correct"})]}),a.jsxs("div",{className:"p-3 bg-orange-50 rounded-xl border-2 border-orange-200",children:[a.jsx("div",{className:"text-2xl font-black text-orange-600",children:w.incorrect}),a.jsx("div",{className:"text-xs text-orange-700",children:"Learning"})]}),a.jsxs("div",{className:"p-3 bg-blue-50 rounded-xl border-2 border-blue-200",children:[a.jsxs("div",{className:"text-2xl font-black text-blue-600",children:[w.accuracy,"%"]}),a.jsx("div",{className:"text-xs text-blue-700",children:"Accuracy"})]})]}),a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6 p-3 bg-yellow-50 rounded-xl border-2 border-yellow-300",children:[a.jsx(Cr,{className:"w-5 h-5 fill-yellow-500 text-yellow-600"}),a.jsxs("span",{className:"font-bold text-yellow-800",children:["+",w.xpEarned," XP earned!"]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full border-4 border-black flex items-center justify-center",children:a.jsx("span",{className:"text-4xl",children:""})}),a.jsx("h2",{className:"text-2xl font-black font-comic mb-2",children:"No Cards Due!"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Great job! You've reviewed all your cards for now. Come back later for more practice!"})]}),a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:L,className:"w-full py-3 bg-nanobanana-green text-white font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:"Done"})]})});if(!j)return null;const D=p/h.length*100;return a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gradient-to-br from-nanobanana-blue to-purple-600 z-50 flex flex-col",children:[a.jsxs("div",{className:"p-4 flex items-center justify-between",children:[a.jsx("button",{onClick:L,className:"p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:a.jsx(on,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{className:"flex-1 mx-4",children:[a.jsxs("div",{className:"text-white/80 text-sm text-center mb-1",children:["Card ",p+1," of ",h.length]}),a.jsx("div",{className:"h-2 bg-white/20 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${D}%`},className:"h-full bg-white rounded-full"})})]}),a.jsx("button",{onClick:_,className:"p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:a.jsx(jm,{className:"w-6 h-6 text-white"})})]}),a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4",children:[a.jsx(Ie,{mode:"wait",children:a.jsx(R.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},className:"w-full max-w-md",children:a.jsx(eue,{card:j,isFlipped:m,onFlip:T,showMastery:!1,size:"large"})},j.id)}),!m&&a.jsx(R.p,{initial:{opacity:0},animate:{opacity:1},className:"mt-4 text-white/70 text-sm",children:"Tap the card or press Space to reveal the answer"})]}),a.jsx(Ie,{children:g&&a.jsxs(R.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"p-4 bg-white border-t-4 border-black",children:[a.jsx("p",{className:"text-center text-sm text-gray-600 mb-3 font-medium",children:"How well did you know this?"}),a.jsx("div",{className:"flex gap-3 justify-center",children:pk.map((P,I)=>a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>k(P),className:`
                                        flex-1 max-w-[120px] py-3 px-2 rounded-xl border-4 border-black
                                        shadow-[3px_3px_0px_0px_rgba(0,0,0,1)]
                                        font-bold text-center
                                        ${P.color==="orange"?"bg-orange-100 hover:bg-orange-200":P.color==="yellow"?"bg-yellow-100 hover:bg-yellow-200":"bg-green-100 hover:bg-green-200"}
                                    `,children:[a.jsx("div",{className:"text-2xl mb-1",children:P.emoji}),a.jsx("div",{className:"text-xs",children:P.label}),a.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Press ",I+1]})]},P.id))})]})})]})},wY=({isOpen:n,onClose:e,lessonContent:t=null,existingDeck:s=null})=>{const{createDeck:i,addCards:r,updateDeck:o}=ML(),[c,d]=N.useState((s==null?void 0:s.name)||""),[h,u]=N.useState((s==null?void 0:s.description)||""),[p,f]=N.useState((s==null?void 0:s.category)||"custom"),[m,x]=N.useState([{front:"",back:""}]),[g,b]=N.useState(!1),[y,C]=N.useState("manual"),w=()=>{x([...m,{front:"",back:""}])},S=_=>{m.length>1&&x(m.filter((L,D)=>D!==_))},j=(_,L,D)=>{const P=[...m];P[_][L]=D,x(P)},T=async()=>{if(t){b(!0);try{const _=await IG(JSON.stringify(t),10);_.flashcards&&x(_.flashcards.map(L=>({front:L.front,back:L.back})))}catch(_){console.error("Error generating flashcards:",_)}finally{b(!1)}}},k=()=>{const _=m.filter(L=>L.front.trim()&&L.back.trim());if(!(!c.trim()||_.length===0)){if(s)o(s.id,{name:c,description:h,category:p}),r(_,s.id);else{const L=i({name:c,description:h,category:p});r(_,L.id)}e==null||e()}};return n?a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e,children:a.jsxs(R.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:_=>_.stopPropagation(),className:"bg-white rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b-4 border-black bg-nanobanana-yellow flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-black font-comic",children:s?"Add Cards":"Create Flashcard Deck"}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-black/10 rounded-full transition-colors",children:a.jsx(on,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[!s&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold mb-1",children:"Deck Name"}),a.jsx("input",{type:"text",value:c,onChange:_=>d(_.target.value),placeholder:"e.g., Math Facts, Science Vocab",className:"w-full px-4 py-2 rounded-xl border-4 border-black focus:outline-none focus:ring-2 focus:ring-nanobanana-blue"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold mb-1",children:"Description (optional)"}),a.jsx("input",{type:"text",value:h,onChange:_=>u(_.target.value),placeholder:"What's this deck about?",className:"w-full px-4 py-2 rounded-xl border-4 border-black focus:outline-none focus:ring-2 focus:ring-nanobanana-blue"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-bold mb-2",children:"Category"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:nP.map(_=>a.jsxs("button",{onClick:()=>f(_.id),className:`
                                                px-3 py-2 rounded-xl border-2 font-medium text-sm
                                                flex items-center gap-2 transition-all
                                                ${p===_.id?"border-black bg-nanobanana-blue text-white":"border-gray-300 hover:border-black"}
                                            `,children:[a.jsx("span",{children:_.icon}),_.label]},_.id))})]})]}),a.jsxs("div",{className:"flex gap-2 border-b-2 border-gray-200",children:[a.jsx("button",{onClick:()=>C("manual"),className:`
                                px-4 py-2 font-bold text-sm border-b-4 -mb-[2px] transition-colors
                                ${y==="manual"?"border-nanobanana-blue text-nanobanana-blue":"border-transparent text-gray-500 hover:text-gray-700"}
                            `,children:"Create Manually"}),t&&a.jsxs("button",{onClick:()=>C("generate"),className:`
                                    px-4 py-2 font-bold text-sm border-b-4 -mb-[2px] transition-colors
                                    flex items-center gap-2
                                    ${y==="generate"?"border-nanobanana-blue text-nanobanana-blue":"border-transparent text-gray-500 hover:text-gray-700"}
                                `,children:[a.jsx(lT,{className:"w-4 h-4"}),"Generate with AI"]})]}),y==="generate"&&t?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-purple-100 rounded-full flex items-center justify-center",children:a.jsx(lT,{className:"w-8 h-8 text-purple-600"})}),a.jsx("h3",{className:"font-bold mb-2",children:"Generate Flashcards"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Let AI create flashcards from your lesson content!"}),a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:T,disabled:g,className:"px-6 py-3 bg-purple-500 text-white font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center gap-2 mx-auto",children:g?a.jsxs(a.Fragment,{children:[a.jsx(nc,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(lT,{className:"w-5 h-5"}),"Generate 10 Cards"]})})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsx(Ie,{children:m.map((_,L)=>a.jsxs(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-3 bg-gray-50 rounded-xl border-2 border-gray-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("span",{className:"text-xs font-bold text-gray-500",children:["Card ",L+1]}),m.length>1&&a.jsx("button",{onClick:()=>S(L),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:a.jsx(um,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Front (Question)"}),a.jsx("textarea",{value:_.front,onChange:D=>j(L,"front",D.target.value),placeholder:"Enter question...",className:"w-full px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-nanobanana-blue focus:outline-none text-sm resize-none",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Back (Answer)"}),a.jsx("textarea",{value:_.back,onChange:D=>j(L,"back",D.target.value),placeholder:"Enter answer...",className:"w-full px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-nanobanana-blue focus:outline-none text-sm resize-none",rows:2})]})]})]},L))}),a.jsxs("button",{onClick:w,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-xl text-gray-500 hover:border-nanobanana-blue hover:text-nanobanana-blue transition-colors flex items-center justify-center gap-2",children:[a.jsx(rm,{className:"w-4 h-4"}),"Add Another Card"]})]})]}),a.jsxs("div",{className:"p-4 border-t-4 border-black bg-gray-50 flex justify-end gap-3",children:[a.jsx("button",{onClick:e,className:"px-4 py-2 rounded-xl border-2 border-gray-300 font-bold hover:bg-gray-100 transition-colors",children:"Cancel"}),a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:k,disabled:!c.trim()||m.every(_=>!_.front.trim()||!_.back.trim()),className:"px-6 py-2 bg-nanobanana-green text-white font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(poe,{className:"w-4 h-4"}),"Save Deck"]})]})]})}):null};function SY(){const{decks:n,cards:e,studyHistory:t,currentSession:s,createDeck:i,createDeckFromLesson:r,addCards:o,startSession:c,recordSessionAnswer:d,endSession:h,getCardsForDeck:u,getDueCardsForDeck:p,getDeckStats:f,deleteDeck:m}=ML(),x=N.useMemo(()=>US(e).length,[e]),g=N.useMemo(()=>{const L=e.length,D=x,P=e.filter(F=>x5(F.correctReviews||0).level>=4).length,I=e.reduce((F,B)=>F+(B.totalReviews||0),0),M=e.reduce((F,B)=>F+(B.correctReviews||0),0),O=I>0?Math.round(M/I*100):0;return{totalCards:L,dueCards:D,masteredCards:P,totalReviews:I,correctReviews:M,overallAccuracy:O,deckCount:n.length}},[e,n,x]),b=N.useMemo(()=>Ute(t),[t]),y=N.useMemo(()=>{const L=t.slice(-10).filter(P=>P.accuracy!==void 0);if(L.length===0)return 80;const D=L.reduce((P,I)=>P+I.accuracy,0)/L.length;return Math.round(D)},[t]),C=N.useMemo(()=>n.map(L=>({...L,dueCount:p(L.id).length,stats:f(L.id)})),[n,p,f]),w=N.useCallback((L,D=null)=>{const P=p(L),I=D||zte(P,y);return c(L,I)},[p,y,c]),S=N.useCallback((L=null)=>(L?u(L):e).filter(P=>(P.easeFactor||2.5)<2||(P.totalReviews||0)>5&&(P.correctReviews||0)/(P.totalReviews||1)<.5),[e,u]),j=N.useCallback(()=>{if(C.length===0)return null;const L=C.filter(D=>D.dueCount>0);return L.length>0?L.sort((D,P)=>P.dueCount-D.dueCount)[0]:C.sort((D,P)=>(P.cardCount||0)-(D.cardCount||0))[0]},[C]),T=N.useCallback(()=>{const L=j();return L?w(L.id):null},[j,w]),k=N.useCallback(L=>{var P,I,M,O;return L?!n.find(F=>F.lessonId===L.id)&&(((I=(P=L.content)==null?void 0:P.vocabulary)==null?void 0:I.length)>0||((O=(M=L.content)==null?void 0:M.keyPoints)==null?void 0:O.length)>0):!1},[n]),_=N.useCallback(L=>n.find(D=>D.lessonId===L),[n]);return{decks:n,cards:e,decksWithDueCounts:C,currentSession:s,totalDueCards:x,overallStats:g,studyStreakInfo:b,recentAccuracy:y,createDeck:i,createDeckFromLesson:r,addCards:o,startSession:c,startStudySession:w,startQuickStudy:T,recordSessionAnswer:d,endSession:h,getCardsForDeck:u,getDueCardsForDeck:p,getDeckStats:f,getStrugglingCards:S,getRecommendedDeck:j,canCreateDeckFromLesson:k,getDeckForLesson:_,deleteDeck:m}}const nue=({minLength:n=3,onSelect:e,onDeselect:t,containerRef:s,delay:i=300}={})=>{const[r,o]=N.useState(null),[c,d]=N.useState(!1),h=N.useRef(null),u=N.useRef(null),p=N.useCallback(()=>{const j=window.getSelection(),T=j==null?void 0:j.toString().trim();if(!T||T.length<n)return null;if(s!=null&&s.current){const k=j.anchorNode;if(!s.current.contains(k))return null}try{const k=j.getRangeAt(0),_=Array.from(k.getClientRects());return{text:T,rects:_.map(L=>({top:L.top,left:L.left,width:L.width,height:L.height,bottom:L.bottom,right:L.right})),range:{startOffset:k.startOffset,endOffset:k.endOffset}}}catch(k){return console.error("Error getting selection data:",k),null}},[n,s]),f=N.useCallback(()=>{h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{const j=p();j?(o(j),d(!1),e==null||e(j)):r&&(o(null),t==null||t())},i)},[p,r,e,t,i]),m=N.useCallback(()=>{const j=window.getSelection();!(j==null?void 0:j.toString().trim())&&r&&(h.current&&clearTimeout(h.current),o(null),t==null||t())},[r,t]),x=N.useCallback(()=>{h.current&&clearTimeout(h.current),d(!0)},[]),g=N.useCallback(()=>{d(!1),u.current=Date.now(),setTimeout(f,10)},[f]),b=N.useCallback(()=>{h.current&&clearTimeout(h.current),d(!0)},[]),y=N.useCallback(()=>{d(!1),u.current=Date.now(),setTimeout(f,100)},[f]),C=N.useCallback(()=>{const j=window.getSelection(),T=j==null?void 0:j.toString().trim();T&&T.length>=n?(h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{const k=p();k&&(o(k),d(!1),e==null||e(k))},i)):!T&&r&&(h.current&&clearTimeout(h.current),o(null),t==null||t())},[p,r,e,t,i,n]),w=N.useCallback(()=>{var j;h.current&&clearTimeout(h.current),(j=window.getSelection())==null||j.removeAllRanges(),o(null),t==null||t()},[t]),S=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0);return N.useEffect(()=>(S?(document.addEventListener("selectionchange",C),document.addEventListener("touchstart",b,{passive:!0}),document.addEventListener("touchend",y,{passive:!0})):document.addEventListener("selectionchange",m),document.addEventListener("mousedown",x),document.addEventListener("mouseup",g),()=>{S?(document.removeEventListener("selectionchange",C),document.removeEventListener("touchstart",b),document.removeEventListener("touchend",y)):document.removeEventListener("selectionchange",m),document.removeEventListener("mousedown",x),document.removeEventListener("mouseup",g),h.current&&clearTimeout(h.current)}),[m,C,x,g,b,y,S]),{selection:r,isSelecting:c,clearSelection:w,getSelectionData:p}},Pn={YOUNG:"young-learner",MIDDLE:"middle-learner",OLDER:"older-learner"},$d={[Pn.YOUNG]:{buttonSize:64,fontSize:20,iconSize:48,spacing:24,borderRadius:24,colors:{primary:"#ff6b6b",secondary:"#4ecdc4",accent:"#ffe66d"},features:{showEmoji:!0,useSimpleLanguage:!0,showFloatingHelper:!0,allowUpload:!1,maxChatLength:100,showProgressBadges:!0,animationsLevel:"high"},navigation:{items:["home","learn","play","rewards"],showLabels:!0,iconOnly:!1}},[Pn.MIDDLE]:{buttonSize:52,fontSize:17,iconSize:32,spacing:18,borderRadius:18,colors:{primary:"#5c7cfa",secondary:"#20c997",accent:"#ffa94d"},features:{showEmoji:!0,useSimpleLanguage:!1,showFloatingHelper:!0,allowUpload:!0,maxChatLength:200,showProgressBadges:!0,animationsLevel:"medium"},navigation:{items:["home","learn","explore","upload","rewards"],showLabels:!0,iconOnly:!1}},[Pn.OLDER]:{buttonSize:44,fontSize:15,iconSize:24,spacing:14,borderRadius:12,colors:{primary:"#4263eb",secondary:"#15aabf",accent:"#fa5252"},features:{showEmoji:!1,useSimpleLanguage:!1,showFloatingHelper:!1,allowUpload:!0,maxChatLength:500,showProgressBadges:!0,animationsLevel:"low"},navigation:{items:["home","learn","explore","upload","tools","rewards"],showLabels:!0,iconOnly:!1}}},iue={[Pn.YOUNG]:{maxWordsPerSentence:8,maxSyllablesPerWord:2,vocabulary:"basic",fontSize:"1.25rem",lineHeight:1.8},[Pn.MIDDLE]:{maxWordsPerSentence:15,maxSyllablesPerWord:3,vocabulary:"intermediate",fontSize:"1rem",lineHeight:1.6},[Pn.OLDER]:{maxWordsPerSentence:20,maxSyllablesPerWord:4,vocabulary:"advanced",fontSize:"0.9375rem",lineHeight:1.5}};function rue(n){return n<=6?Pn.YOUNG:n<=9?Pn.MIDDLE:Pn.OLDER}function CY(){let n=null;try{const i=Vt();n=i==null?void 0:i.currentProfile}catch{}const e=(n==null?void 0:n.age)||8,t=rue(e);return N.useMemo(()=>({age:e,ageGroup:t,ui:$d[t],reading:iue[t],getLayoutClass:()=>`child-layout ${t}`,shouldShowFeature:i=>$d[t].features[i]??!0,getNavItems:()=>$d[t].navigation.items,getButtonStyle:()=>({minWidth:`${$d[t].buttonSize}px`,minHeight:`${$d[t].buttonSize}px`,borderRadius:`${$d[t].borderRadius}px`,fontSize:`${$d[t].fontSize}px`}),getIconSize:()=>$d[t].iconSize,getMaxChatLength:()=>$d[t].features.maxChatLength,isAgeAppropriate:i=>i<=e,getGreeting:i=>{switch(t){case Pn.YOUNG:return`Hi ${i}!  Ready to learn?`;case Pn.MIDDLE:return`Hey ${i}! What would you like to explore today?`;case Pn.OLDER:return`Welcome back, ${i}. What are you working on?`;default:return`Hello ${i}!`}},getErrorMessage:i=>{var o;const r={network:{[Pn.YOUNG]:"Oops! Something went wrong. Let's try again! ",[Pn.MIDDLE]:"We're having trouble connecting. Please try again.",[Pn.OLDER]:"Network error. Please check your connection and retry."},notFound:{[Pn.YOUNG]:"Hmm, we can't find that. Let's look for something else! ",[Pn.MIDDLE]:"We couldn't find what you're looking for.",[Pn.OLDER]:"The requested content was not found."},generic:{[Pn.YOUNG]:"Something went wrong. Don't worry, we'll fix it! ",[Pn.MIDDLE]:"Something unexpected happened. Please try again.",[Pn.OLDER]:"An error occurred. Please try again or contact support."}};return((o=r[i])==null?void 0:o[t])||r.generic[t]}}),[e,t])}const JU=[{code:"es",name:"Spanish",flag:"",popular:!0},{code:"fr",name:"French",flag:"",popular:!0},{code:"ar",name:"Arabic",flag:"",popular:!0},{code:"zh",name:"Chinese",flag:"",popular:!0},{code:"de",name:"German",flag:"",popular:!1},{code:"it",name:"Italian",flag:"",popular:!1},{code:"pt",name:"Portuguese",flag:"",popular:!1},{code:"ja",name:"Japanese",flag:"",popular:!1},{code:"ko",name:"Korean",flag:"",popular:!1},{code:"ru",name:"Russian",flag:"",popular:!1},{code:"hi",name:"Hindi",flag:"",popular:!1},{code:"tr",name:"Turkish",flag:"",popular:!1}],b3=({isOpen:n,onClose:e,onSelectLanguage:t,selectedText:s,isProcessing:i})=>{const[r,o]=N.useState(!1),c=JU.filter(p=>p.popular),h=r?JU:c,u=p=>{t(p.name)};return n?a.jsx(Ie,{children:a.jsxs(R.div,{className:"language-selector-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p=>{p.target===p.currentTarget&&e()},children:[a.jsxs(R.div,{className:"language-selector-modal",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},onClick:p=>p.stopPropagation(),children:[a.jsx("button",{className:"close-button",onClick:e,"aria-label":"Close",children:a.jsx(on,{className:"w-5 h-5"})}),a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"header-icon",children:a.jsx(WL,{className:"w-6 h-6 text-white"})}),a.jsx("h2",{className:"header-title",children:"Translate to..."}),a.jsx("p",{className:"header-subtitle",children:"Pick a language!"})]}),s&&a.jsxs("div",{className:"selected-text-preview",children:[a.jsx("span",{className:"preview-label",children:"Translating:"}),a.jsxs("span",{className:"preview-text",children:['"',s.length>50?s.substring(0,50)+"...":s,'"']})]}),i&&a.jsxs(R.div,{className:"processing-state",initial:{opacity:0},animate:{opacity:1},children:[a.jsx(R.div,{className:"processing-spinner",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:a.jsx(Ut,{className:"w-6 h-6 text-emerald-500"})}),a.jsx("p",{className:"processing-text",children:"Translating..."})]}),!i&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"language-grid",children:h.map((p,f)=>a.jsxs(R.button,{className:"language-button",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:f*.05},whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},onClick:()=>u(p),children:[a.jsx("span",{className:"language-flag",children:p.flag}),a.jsx("span",{className:"language-name",children:p.name}),a.jsx(No,{className:"language-arrow"})]},p.code))}),!r&&a.jsx("button",{className:"show-more-button",onClick:()=>o(!0),children:"Show more languages"})]})]}),a.jsx("style",{children:`
                    .language-selector-overlay {
                        position: fixed;
                        inset: 0;
                        background: rgba(0, 0, 0, 0.5);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 1000;
                        padding: 20px;
                    }

                    .language-selector-modal {
                        position: relative;
                        background: white;
                        border-radius: 24px;
                        border: 4px solid black;
                        box-shadow: 8px 8px 0px 0px rgba(0, 0, 0, 1);
                        max-width: 400px;
                        width: 100%;
                        max-height: 80vh;
                        overflow-y: auto;
                        padding: 24px;
                    }

                    .close-button {
                        position: absolute;
                        top: 16px;
                        right: 16px;
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: #f3f4f6;
                        border: none;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: background 0.2s;
                    }

                    .close-button:hover {
                        background: #e5e7eb;
                    }

                    .modal-header {
                        text-align: center;
                        margin-bottom: 20px;
                    }

                    .header-icon {
                        width: 56px;
                        height: 56px;
                        background: linear-gradient(135deg, #10B981, #059669);
                        border-radius: 50%;
                        border: 3px solid black;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 12px;
                        box-shadow: 4px 4px 0px 0px rgba(0, 0, 0, 1);
                    }

                    .header-title {
                        font-size: 24px;
                        font-weight: 800;
                        color: #1f2937;
                        margin: 0;
                    }

                    .header-subtitle {
                        font-size: 14px;
                        color: #6b7280;
                        margin: 4px 0 0;
                    }

                    .selected-text-preview {
                        background: #f3f4f6;
                        border: 2px solid #e5e7eb;
                        border-radius: 12px;
                        padding: 12px 16px;
                        margin-bottom: 20px;
                    }

                    .preview-label {
                        display: block;
                        font-size: 11px;
                        font-weight: 700;
                        text-transform: uppercase;
                        color: #9ca3af;
                        margin-bottom: 4px;
                    }

                    .preview-text {
                        font-size: 14px;
                        color: #4b5563;
                        font-style: italic;
                    }

                    .processing-state {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        padding: 40px 20px;
                    }

                    .processing-spinner {
                        margin-bottom: 12px;
                    }

                    .processing-text {
                        font-size: 16px;
                        font-weight: 600;
                        color: #10B981;
                    }

                    .language-grid {
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 10px;
                    }

                    .language-button {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        padding: 14px 16px;
                        background: white;
                        border: 3px solid #e5e7eb;
                        border-radius: 16px;
                        cursor: pointer;
                        transition: all 0.2s;
                        text-align: left;
                    }

                    .language-button:hover {
                        border-color: #10B981;
                        background: #ecfdf5;
                    }

                    .language-flag {
                        font-size: 24px;
                    }

                    .language-name {
                        flex: 1;
                        font-size: 15px;
                        font-weight: 600;
                        color: #374151;
                    }

                    .language-arrow {
                        width: 18px;
                        height: 18px;
                        color: #9ca3af;
                        transition: transform 0.2s, color 0.2s;
                    }

                    .language-button:hover .language-arrow {
                        transform: translateX(4px);
                        color: #10B981;
                    }

                    .show-more-button {
                        width: 100%;
                        margin-top: 16px;
                        padding: 12px;
                        background: transparent;
                        border: 2px dashed #d1d5db;
                        border-radius: 12px;
                        color: #6b7280;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s;
                    }

                    .show-more-button:hover {
                        border-color: #10B981;
                        color: #10B981;
                        background: #ecfdf5;
                    }

                    @media (max-width: 480px) {
                        .language-grid {
                            grid-template-columns: 1fr;
                        }

                        .language-selector-modal {
                            padding: 20px;
                            margin: 10px;
                        }
                    }
                `})]})}):null},aue=n=>n==="4-7"?[{type:"read",icon:"",label:"Read to Me",color:"#FF6B6B",autoTrigger:!0},{type:"ask",icon:"",label:"What is this?",color:"#4ECDC4",presetQuestion:"Can you explain this in simple words?"},{type:"save",icon:"",label:"Save",color:"#FFD93D"}]:[{type:"ask",icon:"",label:"Ask Jeffrey",color:"#4ECDC4"},{type:"flashcard",icon:"",label:"Make Flashcard",color:"#A259FF"},{type:"translate",icon:"",label:"Translate",color:"#10B981"},{type:"save",icon:"",label:"Save This",color:"#FFD93D"},{type:"read",icon:"",label:"Read to Me",color:"#95E1D3"}],oue=({position:n,selectedText:e,ageGroup:t,onAction:s,onDismiss:i,isProcessing:r,showDismissPrompt:o,onInputModeStart:c})=>{const[d,h]=N.useState(!1),[u,p]=N.useState(!1),[f,m]=N.useState(""),x=N.useRef(null),g=N.useRef(null),b=aue(t);N.useEffect(()=>{d&&c&&c()},[d,c]),N.useEffect(()=>{d&&x.current&&x.current.focus()},[d]),N.useEffect(()=>{if(g.current){const T=g.current.getBoundingClientRect(),k={width:window.innerWidth};T.right>k.width-20&&(g.current.style.left=`${k.width-T.width-20}px`),T.left<20&&(g.current.style.left="20px"),T.top<20&&(g.current.style.top=`${n.y+150}px`)}},[n]);const y=T=>{if(!r){if(T.type==="ask"&&t==="8-12"&&!T.presetQuestion){h(!0);return}if(T.type==="translate"){p(!0);return}s({type:T.type,userQuestion:T.presetQuestion||null})}},C=T=>{s({type:"translate",targetLanguage:T}),p(!1)},w=()=>{f.trim()&&(s({type:"ask",userQuestion:f.trim()}),m(""),h(!1))},S=T=>{T.key==="Enter"?w():T.key==="Escape"&&(h(!1),m(""))},j=e.length>30?e.substring(0,30)+"...":e;return a.jsxs(R.div,{ref:g,className:"context-menu context-menu-compact",initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:25,stiffness:400},style:{position:"fixed",left:n.x,top:n.y,transform:"translateX(-50%)",zIndex:1e3},children:[a.jsxs("div",{className:"compact-header",children:[a.jsx(R.div,{className:"jeffrey-mini",animate:{rotate:r?360:0},transition:{duration:2,repeat:r?1/0:0,ease:"linear"},children:r?"":""}),a.jsxs("span",{className:"selected-text-mini",title:e,children:['"',j,'"']}),a.jsx("button",{className:"dismiss-button-mini",onClick:i,"aria-label":"Close menu",children:""})]}),a.jsx("div",{className:"menu-actions-horizontal",children:b.map(T=>a.jsxs("button",{className:"menu-button-compact",style:{backgroundColor:T.color},onClick:()=>y(T),disabled:r,title:T.label,children:[a.jsx("span",{className:"menu-icon-compact",children:T.icon}),a.jsx("span",{className:"menu-label-compact",children:T.label})]},T.type))}),d&&t==="8-12"&&a.jsx(R.div,{className:"question-input-compact",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{ref:x,type:"text",placeholder:"Ask Jeffrey...",value:f,onChange:T=>m(T.target.value),onKeyDown:S,maxLength:200,disabled:r,className:"flex-1"}),a.jsx("button",{className:"ask-button-compact",onClick:w,disabled:!f.trim()||r,children:"Ask"})]})}),a.jsx(b3,{isOpen:u,onClose:()=>p(!1),onSelectLanguage:C,selectedText:e,isProcessing:r})]})},lue=({xp:n})=>a.jsxs(R.div,{className:"xp-gain-animation",initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{type:"spring",damping:10,stiffness:200},children:[a.jsx(R.span,{className:"xp-icon",animate:{rotate:[0,10,-10,0]},transition:{duration:.5,repeat:2},children:""}),a.jsxs("span",{className:"xp-text",children:["+",n," XP!"]})]}),cue=({question:n,answer:e,selectedText:t,imageData:s,mimeType:i})=>a.jsxs("div",{className:"jeffrey-response-view",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full border-3 border-black flex items-center justify-center text-3xl shadow-lg",children:""}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-lg",children:"Jeffrey says:"}),n&&a.jsxs("p",{className:"text-sm text-gray-500",children:['You asked: "',n,'"']})]})]}),a.jsx("div",{className:"bg-yellow-100 border-2 border-yellow-300 rounded-xl p-3 mb-4",children:a.jsxs("p",{className:"text-sm font-medium text-yellow-800",children:[a.jsx(js,{className:"w-4 h-4 inline mr-1"}),'About: "',t.substring(0,100),t.length>100?"...":"",'"']})}),s&&a.jsxs(R.div,{className:"mb-4 rounded-xl overflow-hidden border-2 border-purple-300 shadow-lg",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},children:[a.jsxs("div",{className:"bg-gradient-to-r from-purple-100 to-pink-100 px-3 py-2 flex items-center gap-2",children:[a.jsx(Ut,{className:"w-4 h-4 text-purple-500"}),a.jsx("span",{className:"text-sm font-bold text-purple-700",children:"Jeffrey drew this for you!"})]}),a.jsx("img",{src:`data:${i||"image/png"};base64,${s}`,alt:"Jeffrey's drawing",className:"w-full"})]}),a.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:a.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:e})}),a.jsxs("button",{className:"mt-4 flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-xl font-bold text-sm hover:bg-blue-200 transition-colors",onClick:()=>{const r=new SpeechSynthesisUtterance(e);r.rate=.9,window.speechSynthesis.speak(r)},children:[a.jsx(Y0,{className:"w-4 h-4"}),"Read Answer Aloud"]})]}),due=({flashcard:n,onAddToDeck:e})=>{const[t,s]=Td.useState(!1);return a.jsxs("div",{className:"flashcard-preview",children:[a.jsxs("h3",{className:"font-bold text-lg mb-3 flex items-center gap-2",children:[a.jsx("span",{className:"text-2xl",children:""}),"New Flashcard Created!"]}),a.jsx(R.div,{className:"flashcard-container cursor-pointer",onClick:()=>s(!t),whileHover:{scale:1.02},whileTap:{scale:.98},children:a.jsxs(R.div,{className:"flashcard",animate:{rotateY:t?180:0},transition:{duration:.5},style:{transformStyle:"preserve-3d"},children:[a.jsxs("div",{className:`flashcard-face flashcard-front ${t?"hidden":""}`,children:[a.jsx(Ld,{className:"w-6 h-6 text-purple-400 mb-2"}),a.jsx("p",{className:"font-medium text-center",children:n.front}),a.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Tap to flip"})]}),a.jsxs("div",{className:`flashcard-face flashcard-back ${t?"":"hidden"}`,style:{transform:"rotateY(180deg)"},children:[a.jsx(Cr,{className:"w-6 h-6 text-yellow-400 mb-2"}),a.jsx("p",{className:"font-medium text-center",children:n.back})]})]})}),a.jsxs("button",{className:"mt-4 w-full py-3 bg-purple-500 text-white font-bold rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-all",onClick:e,children:[a.jsx(Ut,{className:"w-4 h-4 inline mr-2"}),"Add to My Deck"]})]})},hue=({quiz:n,onStartQuiz:e})=>{const[t,s]=Td.useState(null),[i,r]=Td.useState(!1),o=d=>{s(d),r(!0)},c=t===n.correctAnswer;return a.jsxs("div",{className:"quiz-preview",children:[a.jsxs("h3",{className:"font-bold text-lg mb-3 flex items-center gap-2",children:[a.jsx("span",{className:"text-2xl",children:""}),"Quick Quiz!"]}),a.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-4",children:a.jsx("p",{className:"font-medium text-blue-800",children:n.question})}),a.jsx("div",{className:"space-y-2",children:n.options.map((d,h)=>a.jsxs(R.button,{className:`w-full p-3 rounded-xl border-2 text-left font-medium transition-all ${i?h===n.correctAnswer?"bg-green-100 border-green-500 text-green-800":t===h?"bg-red-100 border-red-500 text-red-800":"bg-gray-50 border-gray-200":t===h?"bg-blue-100 border-blue-500":"bg-white border-gray-200 hover:border-blue-300"}`,onClick:()=>!i&&o(h),disabled:i,whileHover:i?{}:{scale:1.01},whileTap:i?{}:{scale:.99},children:[a.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 text-sm font-bold mr-2",children:String.fromCharCode(65+h)}),d]},h))}),i&&a.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-xl ${c?"bg-green-100":"bg-orange-100"}`,children:[a.jsx("p",{className:`font-bold ${c?"text-green-700":"text-orange-700"}`,children:c?" Correct! Great job!":" Not quite!"}),a.jsx("p",{className:"text-sm mt-1 text-gray-600",children:n.explanation})]})]})},uue=({originalText:n,translatedText:e,targetLanguage:t,pronunciation:s,simpleExplanation:i})=>{const r=(o,c)=>{window.speechSynthesis.cancel();const d=new SpeechSynthesisUtterance(o);d.rate=.85;const h=window.speechSynthesis.getVoices(),u={Spanish:"es",French:"fr",Arabic:"ar",Chinese:"zh",Japanese:"ja",Korean:"ko",German:"de",Italian:"it",Portuguese:"pt",Russian:"ru",Hindi:"hi"}[c]||"en",p=h.find(f=>f.lang.startsWith(u));p&&(d.voice=p),window.speechSynthesis.speak(d)};return a.jsxs("div",{className:"translation-view",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full border-3 border-black flex items-center justify-center text-3xl shadow-lg",children:""}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-lg",children:"Translation"}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Translated to ",t]})]})]}),a.jsxs("div",{className:"bg-gray-100 border-2 border-gray-300 rounded-xl p-3 mb-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide",children:"Original"}),a.jsx("button",{onClick:()=>r(n,"English"),className:"p-1.5 hover:bg-gray-200 rounded-lg transition-colors",title:"Read aloud",children:a.jsx(Y0,{className:"w-4 h-4 text-gray-500"})})]}),a.jsxs("p",{className:"text-gray-700 font-medium",children:['"',n,'"']})]}),a.jsxs(R.div,{className:"bg-emerald-50 border-2 border-emerald-300 rounded-xl p-4 mb-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(WL,{className:"w-4 h-4 text-emerald-600"}),a.jsx("p",{className:"text-xs font-bold text-emerald-600 uppercase tracking-wide",children:t})]}),a.jsx("button",{onClick:()=>r(e,t),className:"p-1.5 hover:bg-emerald-100 rounded-lg transition-colors",title:"Read aloud",children:a.jsx(Y0,{className:"w-4 h-4 text-emerald-600"})})]}),a.jsx("p",{className:"text-emerald-800 font-bold text-lg",children:e}),s&&a.jsx(R.div,{className:"mt-2 pt-2 border-t border-emerald-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:a.jsxs("p",{className:"text-xs text-emerald-600 font-medium",children:[" Say it: ",a.jsx("span",{className:"italic",children:s})]})})]}),i&&a.jsx(R.div,{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(Ru,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),a.jsx("p",{className:"text-sm text-blue-700",children:i})]})})]})},pue=({result:n,onClose:e})=>(N.useEffect(()=>{console.log("Selection result shown:",n.type,n.content)},[n]),a.jsx(R.div,{className:"selection-result-modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t=>{t.target===t.currentTarget&&e()},children:a.jsxs(R.div,{className:"selection-result-content",initial:{opacity:0,scale:.9,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:50},transition:{type:"spring",damping:20},children:[a.jsx("button",{className:"absolute top-4 right-4 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",onClick:e,"aria-label":"Close",children:a.jsx(on,{className:"w-5 h-5"})}),n.xpEarned>0&&a.jsx(lue,{xp:n.xpEarned}),a.jsxs("div",{className:"result-content mt-4",children:[n.type==="jeffrey-response"&&a.jsx(cue,{question:n.content.question,answer:n.content.answer,selectedText:n.content.selectedText,imageData:n.content.imageData,mimeType:n.content.mimeType}),n.type==="flashcard"&&a.jsx(due,{flashcard:n.content,onAddToDeck:()=>{console.log("Adding flashcard to deck:",n.content),e()}}),n.type==="quiz"&&a.jsx(hue,{quiz:n.content,onStartQuiz:()=>{console.log("Starting quiz with:",n.content)}}),n.type==="translation"&&n.content&&a.jsx(uue,{originalText:n.content.originalText||"",translatedText:n.content.translatedText||"Translation not available",targetLanguage:n.content.targetLanguage||"Unknown",pronunciation:n.content.pronunciation,simpleExplanation:n.content.simpleExplanation})]}),a.jsxs("button",{className:"continue-button",onClick:e,children:[a.jsx("span",{children:"Keep Reading"}),a.jsx(jm,{className:"w-5 h-5"})]})]})})),fue=({children:n,lessonId:e,contentType:t="html",onSelectionAction:s,className:i=""})=>{const r=N.useRef(null),[o,c]=N.useState(!1),[d,h]=N.useState({x:0,y:0}),[u,p]=N.useState(!1),f=N.useRef(null),m=N.useRef(null),{ageGroup:x,age:g}=CY(),{setSelection:b,clearSelection:y,currentSelection:C,isProcessing:w,result:S,handleAction:j,clearResult:T}=BL(),k=g<=7?"4-7":"8-12",_=N.useCallback(F=>{if(!F||!F.text){c(!1);return}const B=window.getSelection();let U="",$="";try{const Z=B.getRangeAt(0).commonAncestorContainer.textContent||"",K=Z.indexOf(F.text);K!==-1&&(U=Z.substring(Math.max(0,K-50),K),$=Z.substring(K+F.text.length,K+F.text.length+50))}catch(G){console.warn("Could not extract context:",G)}if(b({...F,context:{beforeText:U,afterText:$},lessonId:e,timestamp:new Date}),F.rects&&F.rects.length>0){const G=F.rects[0],ne=F.rects[F.rects.length-1],Z=(G.left+ne.right)/2,K=ne.bottom+10;h({x:Math.min(Math.max(Z,150),window.innerWidth-150),y:K})}c(!0),p(!1),"vibrate"in navigator&&navigator.vibrate(30),f.current&&clearTimeout(f.current),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{p(!0)},12e3),f.current=setTimeout(()=>{P()},15e3)},[b,e]),L=N.useCallback(()=>{!w&&!S&&setTimeout(()=>{},200)},[w,S]),{isSelecting:D}=nue({minLength:k==="4-7"?1:3,onSelect:_,onDeselect:L,containerRef:r}),P=N.useCallback(()=>{c(!1),p(!1),y(),f.current&&clearTimeout(f.current),m.current&&clearTimeout(m.current)},[y]),I=N.useCallback(()=>{f.current&&(clearTimeout(f.current),f.current=null),m.current&&(clearTimeout(m.current),m.current=null),p(!1)},[]),M=N.useCallback(async F=>{if(f.current&&clearTimeout(f.current),m.current&&clearTimeout(m.current),"vibrate"in navigator&&navigator.vibrate(50),k==="4-7"&&F.type==="read"){j(F),setTimeout(P,500);return}const B=await j(F);B&&(s==null||s(B)),(F.type==="save"||F.type==="read")&&setTimeout(P,500)},[k,j,P,s]),O=N.useCallback(()=>{T(),P()},[T,P]);return N.useEffect(()=>()=>{f.current&&clearTimeout(f.current),m.current&&clearTimeout(m.current)},[]),N.useEffect(()=>{C||(c(!1),p(!1))},[C]),a.jsxs("div",{ref:r,className:`highlightable-content ${i} ${D?"is-selecting":""}`,children:[n,a.jsx(Ie,{children:o&&C&&a.jsx(mue,{position:d})}),a.jsx(Ie,{children:o&&C&&!S&&a.jsx(oue,{position:d,selectedText:C.text,ageGroup:k,onAction:M,onDismiss:P,isProcessing:w,showDismissPrompt:u,onInputModeStart:I})}),a.jsx(Ie,{children:S&&a.jsx(pue,{result:S,onClose:O})})]})},mue=({position:n})=>{const e=Array.from({length:6},(t,s)=>({id:s,delay:s*.1,offsetX:(Math.random()-.5)*60,offsetY:-20-Math.random()*40}));return a.jsx("div",{className:"selection-particles",style:{position:"fixed",left:n.x,top:n.y,pointerEvents:"none",zIndex:999},children:e.map(t=>a.jsx(R.div,{className:"selection-particle",initial:{opacity:1,scale:1,x:0,y:0},animate:{opacity:0,scale:.5,x:t.offsetX,y:t.offsetY},transition:{duration:.8,delay:t.delay,ease:"easeOut"},style:{position:"absolute",width:8,height:8,backgroundColor:"#FFD93D",borderRadius:"50%",boxShadow:"0 0 4px rgba(255, 217, 61, 0.6)"}},t.id))})},gue=({onChatOpen:n})=>{const{currentSelection:e,handleAction:t,isProcessing:s}=BL(),{age:i}=CY(),[r,o]=N.useState(!1),d=(i<=7?"4-7":"8-12")==="4-7"?[{type:"read",icon:Y0,label:"Read aloud",color:"#FF6B6B"},{type:"ask",icon:Ld,label:"Explain",color:"#4ECDC4",presetQuestion:"Can you explain this?"},{type:"save",icon:X$,label:"Add to notes",color:"#FFD93D"}]:[{type:"ask",icon:Ld,label:"Explain",color:"#4ECDC4",presetQuestion:"Can you explain this?"},{type:"chat",icon:Ru,label:"Chat",color:"#5C7CFA",isExternal:!0},{type:"translate",icon:WL,label:"Translate",color:"#10B981"},{type:"flashcard",icon:Ki,label:"Flashcards",color:"#A259FF"},{type:"save",icon:X$,label:"Add to notes",color:"#FFD93D"},{type:"read",icon:Y0,label:"Read aloud",color:"#95E1D3"}],h=f=>{if(f.isExternal){n==null||n();return}if(!e){console.log("Please select some text first");return}if(f.type==="translate"){o(!0);return}t({type:f.type,userQuestion:f.presetQuestion})},u=f=>{t({type:"translate",targetLanguage:f}),o(!1)},p=!!e;return a.jsxs(a.Fragment,{children:[a.jsxs(R.div,{className:"selection-toolbar",initial:{y:100,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,type:"spring",damping:20},children:[a.jsxs("div",{className:"toolbar-container",children:[p&&a.jsx(R.div,{className:"selection-indicator",initial:{scale:0},animate:{scale:1},children:a.jsxs("span",{className:"selection-text",children:['"',e.text.substring(0,20),e.text.length>20?"...":"",'"']})}),a.jsx("div",{className:"toolbar-actions",children:d.map(f=>{const m=f.icon,x=!p&&!f.isExternal;return a.jsxs(R.button,{className:`toolbar-button ${x?"disabled":""}`,style:{"--button-color":f.color},whileHover:x?{}:{scale:1.05,y:-2},whileTap:x?{}:{scale:.95},onClick:()=>h(f),disabled:x||s,title:x?"Select text first":f.label,children:[a.jsx(m,{className:"toolbar-icon",size:20}),a.jsx("span",{className:"toolbar-label",children:f.label})]},f.type)})})]}),a.jsx("style",{children:`
                .selection-toolbar {
                    position: sticky;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(to top, white 80%, transparent);
                    padding: 16px 0 12px;
                    z-index: 100;
                }

                .toolbar-container {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 8px;
                }

                .selection-indicator {
                    background: #FFF9E6;
                    border: 2px solid #FFD93D;
                    border-radius: 20px;
                    padding: 6px 16px;
                    font-size: 13px;
                    font-weight: 600;
                    color: #666;
                    max-width: 200px;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                }

                .toolbar-actions {
                    display: flex;
                    gap: 8px;
                    flex-wrap: wrap;
                    justify-content: center;
                    padding: 8px 16px;
                    background: white;
                    border-radius: 24px;
                    border: 3px solid #000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                }

                .toolbar-button {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 4px;
                    padding: 10px 14px;
                    background: transparent;
                    border: none;
                    border-radius: 12px;
                    cursor: pointer;
                    transition: all 0.2s;
                    min-width: 64px;
                }

                .toolbar-button:hover:not(.disabled) {
                    background: var(--button-color);
                }

                .toolbar-button:hover:not(.disabled) .toolbar-icon,
                .toolbar-button:hover:not(.disabled) .toolbar-label {
                    color: white;
                }

                .toolbar-button.disabled {
                    opacity: 0.4;
                    cursor: not-allowed;
                }

                .toolbar-icon {
                    color: #333;
                    transition: color 0.2s;
                }

                .toolbar-label {
                    font-size: 11px;
                    font-weight: 600;
                    color: #666;
                    transition: color 0.2s;
                }

                @media (max-width: 640px) {
                    .toolbar-actions {
                        gap: 4px;
                        padding: 6px 12px;
                    }

                    .toolbar-button {
                        padding: 8px 10px;
                        min-width: 56px;
                    }

                    .toolbar-label {
                        font-size: 10px;
                    }

                    .toolbar-icon {
                        width: 18px;
                        height: 18px;
                    }
                }
            `})]}),a.jsx(b3,{isOpen:r,onClose:()=>o(!1),onSelectLanguage:u,selectedText:e==null?void 0:e.text,isProcessing:s})]})},ZU={"application/pdf":"pdf","image/png":"image","image/jpeg":"image","image/jpg":"image","image/webp":"image","image/gif":"image","text/plain":"text","text/markdown":"text","text/html":"text"},ez={".pdf":"pdf",".png":"image",".jpg":"image",".jpeg":"image",".webp":"image",".gif":"image",".txt":"text",".md":"text",".html":"text"};function NY(n){var t,s,i,r,o,c,d,h;if(!n)return"unknown";if(n.contentType)return n.contentType;if(n.sourceType)return n.sourceType;if((t=n.source)!=null&&t.type)return n.source.type;if((s=n.fileMetadata)!=null&&s.mimeType){const u=ZU[n.fileMetadata.mimeType];if(u)return u}if((i=n.source)!=null&&i.mimeType){const u=ZU[n.source.mimeType];if(u)return u}const e=((r=n.fileMetadata)==null?void 0:r.originalFileName)||((o=n.source)==null?void 0:o.originalName)||n.contentUrl;if(e){const u=xue(e);if(u&&ez[u])return ez[u]}if((c=n.sourceVideo)!=null&&c.videoId||n.youtubeUrl||n.contentUrl&&yue(n.contentUrl))return"youtube";if(n.contentUrl){if(n.contentUrl.endsWith(".pdf"))return"pdf";if(/\.(png|jpg|jpeg|webp|gif)$/i.test(n.contentUrl))return"image"}return(d=n.contentUrl)!=null&&d.startsWith("blob:")&&n.rawText&&!n.contentUrl||n.rawText||(h=n.content)!=null&&h.rawText?"text":"unknown"}function xue(n){if(!n)return null;const e=n.split("?")[0],t=e.lastIndexOf(".");return t===-1?null:e.substring(t).toLowerCase()}function yue(n){return n?[/youtube\.com\/watch/i,/youtube\.com\/embed/i,/youtu\.be\//i,/youtube\.com\/v\//i].some(t=>t.test(n)):!1}function bue(n){const e={pdf:{icon:"FileText",label:"PDF Document",emoji:"",color:"#EF4444"},image:{icon:"Image",label:"Image",emoji:"",color:"#8B5CF6"},text:{icon:"FileText",label:"Text Content",emoji:"",color:"#3B82F6"},youtube:{icon:"Youtube",label:"YouTube Video",emoji:"",color:"#EF4444"},unknown:{icon:"FileQuestion",label:"Unknown",emoji:"",color:"#6B7280"}};return e[n]||e.unknown}const vue=N.lazy(()=>XL(()=>import("./PDFContentView-CQCGsn03.js"),[])),wue=N.lazy(()=>XL(()=>import("./ImageContentView-BdkihcX1.js"),[])),Sue=N.lazy(()=>XL(()=>import("./TextContentView-sUkNZiCS.js"),[])),Cue=({lesson:n,viewPreferences:e,onZoomChange:t,onPageChange:s,onSelectionAction:i})=>{const r=NY(n),o=()=>a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8",children:[a.jsx(R.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"mb-4",children:a.jsx(nc,{className:"w-12 h-12 text-nanobanana-blue"})}),a.jsx("p",{className:"text-gray-600 font-comic text-lg",children:"Loading content..."})]}),c=()=>{switch(r){case"pdf":return a.jsx(vue,{lesson:n,viewPreferences:e,onZoomChange:t,onPageChange:s,onSelectionAction:i});case"image":return a.jsx(wue,{lesson:n,viewPreferences:e,onZoomChange:t});case"text":return a.jsx(Sue,{lesson:n,viewPreferences:e,onSelectionAction:i});case"youtube":return a.jsx(Nue,{lesson:n});default:return a.jsx(jue,{contentType:r,lesson:n})}};return a.jsx(N.Suspense,{fallback:a.jsx(o,{}),children:a.jsx("div",{className:"flex-1 h-full overflow-hidden",children:c()})})},Nue=({lesson:n})=>{var s,i,r;const e=(s=n.sourceVideo)==null?void 0:s.videoId,t=(i=n.sourceVideo)==null?void 0:i.thumbnail;return a.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gradient-to-br from-red-50 to-pink-50",children:a.jsxs("div",{className:"text-center max-w-md",children:[t&&a.jsxs("div",{className:"relative mb-6 rounded-2xl overflow-hidden border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("img",{src:t,alt:"Video thumbnail",className:"w-full aspect-video object-cover"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:a.jsx(R.div,{whileHover:{scale:1.1},className:"w-20 h-20 bg-red-500 rounded-full flex items-center justify-center border-4 border-white shadow-lg cursor-pointer",onClick:()=>{e&&window.open(`https://www.youtube.com/watch?v=${e}`,"_blank")},children:a.jsx("svg",{className:"w-10 h-10 text-white ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{d:"M8 5v14l11-7z"})})})})]}),a.jsx("h3",{className:"text-2xl font-bold font-comic mb-2",children:((r=n.sourceVideo)==null?void 0:r.title)||"YouTube Video"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Click the play button to watch on YouTube"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Read the lesson summary below while you study!"})]})})},jue=({contentType:n})=>a.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"w-20 h-20 bg-gray-100 rounded-full border-4 border-black flex items-center justify-center mx-auto mb-4",children:a.jsx(jN,{className:"w-10 h-10 text-gray-400"})}),a.jsx("h3",{className:"text-xl font-bold text-gray-600 font-comic mb-2",children:"Unsupported Content Type"}),a.jsx("p",{className:"text-gray-500",children:"We're working on supporting more file types!"}),n&&a.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["Type: ",n]})]})}),Aue=({vocabulary:n=[],lessonId:e,onClose:t,isOpen:s=!0})=>{const[i,r]=N.useState(""),[o,c]=N.useState(new Set),{handleCreateFlashcard:d,setSelection:h}=BL()||{},u=n.filter(x=>{const g=typeof x=="string"?x:x.term,b=typeof x=="string"?"":x.definition||"",y=i.toLowerCase();return g.toLowerCase().includes(y)||b.toLowerCase().includes(y)}),p=N.useCallback(x=>{c(g=>{const b=new Set(g);return b.has(x)?b.delete(x):b.add(x),b})},[]),f=N.useCallback(x=>{if("speechSynthesis"in window){window.speechSynthesis.cancel();const g=new SpeechSynthesisUtterance(x);g.rate=.9,g.pitch=1.1,window.speechSynthesis.speak(g)}},[]),m=N.useCallback((x,g)=>{h&&h({text:`${x}: ${g}`,lessonId:e}),d&&d()},[h,d,e]);return a.jsx(Ie,{children:s&&a.jsxs(R.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:200},className:"h-full bg-white flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"px-4 py-3 bg-gradient-to-r from-nanobanana-blue to-blue-500 text-white flex items-center justify-between border-b-4 border-black",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(js,{className:"w-5 h-5"}),a.jsx("h3",{className:"font-bold font-comic",children:"Key Words"}),a.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-bold",children:n.length})]}),a.jsx("button",{onClick:t,className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:a.jsx(on,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsxs("div",{className:"relative",children:[a.jsx(D1,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx("input",{type:"text",value:i,onChange:x=>r(x.target.value),placeholder:"Search words...",className:"w-full pl-9 pr-4 py-2 bg-gray-100 rounded-xl border-2 border-transparent focus:border-nanobanana-blue focus:bg-white outline-none transition-all text-sm"})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:u.length===0?a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(js,{className:"w-10 h-10 mx-auto mb-2 text-gray-300"}),a.jsx("p",{className:"font-medium",children:i?"No words found":"No vocabulary yet"})]}):u.map((x,g)=>a.jsx(Eue,{item:x,index:g,isExpanded:o.has(g),onToggle:()=>p(g),onReadAloud:f,onCreateFlashcard:m},g))}),a.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:a.jsxs("button",{onClick:()=>{const x=n.map(g=>typeof g=="string"?g:g.term).join(". ");f(x)},className:"w-full py-2 px-4 bg-nanobanana-blue text-white font-bold rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-shadow flex items-center justify-center gap-2",children:[a.jsx(Y0,{className:"w-4 h-4"}),"Read All Words"]})})]})})},Eue=({item:n,index:e,isExpanded:t,onToggle:s,onReadAloud:i,onCreateFlashcard:r})=>{const o=typeof n=="string"?n:n.term,c=typeof n=="string"?null:n.definition,d=typeof n=="string"?null:n.example;return a.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:e*.05},className:`
        rounded-xl border-2 overflow-hidden transition-all
        ${t?"border-nanobanana-blue bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}
      `,children:[a.jsxs("button",{onClick:s,className:"w-full p-3 flex items-center justify-between text-left",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-6 h-6 bg-nanobanana-blue/10 text-nanobanana-blue rounded-full flex items-center justify-center text-xs font-bold",children:e+1}),a.jsx("span",{className:"font-bold text-gray-800",children:o})]}),a.jsx(R.div,{animate:{rotate:t?90:0},transition:{duration:.2},children:a.jsx(No,{className:"w-4 h-4 text-gray-400"})})]}),a.jsx(Ie,{children:t&&a.jsx(R.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:a.jsxs("div",{className:"px-3 pb-3 pt-1 border-t border-blue-100",children:[c&&a.jsx("p",{className:"text-gray-600 text-sm mb-2",children:c}),d&&a.jsxs("p",{className:"text-gray-500 text-xs italic mb-3 bg-white/50 p-2 rounded-lg",children:["Example: ",d]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>i(c?`${o}. ${c}`:o),className:"flex-1 py-1.5 px-2 bg-white border-2 border-gray-200 rounded-lg text-xs font-bold flex items-center justify-center gap-1 hover:border-nanobanana-blue transition-colors",children:[a.jsx(Y0,{className:"w-3 h-3"}),"Listen"]}),c&&a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>r(o,c),className:"flex-1 py-1.5 px-2 bg-nanobanana-yellow border-2 border-black rounded-lg text-xs font-bold flex items-center justify-center gap-1 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] transition-shadow",children:[a.jsx(Ut,{className:"w-3 h-3"}),"Flashcard"]})]})]})})})]})},kue=({answerType:n="TEXT",exerciseType:e,options:t=[],value:s,onChange:i,onSubmit:r,disabled:o=!1,placeholder:c="Type your answer..."})=>{const d=N.useRef(null),[h,u]=N.useState(null);N.useEffect(()=>{d.current&&!o&&d.current.focus()},[o]);const p=f=>{f.key==="Enter"&&!o&&(s!=null&&s.trim())&&r()};if(n==="SELECTION"||e==="MULTIPLE_CHOICE"||e==="TRUE_FALSE"){const f=e==="TRUE_FALSE"?["True","False"]:t;return a.jsx("div",{className:"space-y-3",children:f.map((m,x)=>a.jsxs(R.button,{whileHover:{scale:o?1:1.02},whileTap:{scale:o?1:.98},onClick:()=>{o||(u(x),i(m))},disabled:o,className:`
              w-full p-4 text-left rounded-xl border-2 transition-all
              font-medium text-base
              ${h===x?"bg-purple-100 border-purple-500 text-purple-800":"bg-white border-gray-200 hover:border-gray-300 text-gray-800"}
              ${o?"opacity-60 cursor-not-allowed":"cursor-pointer"}
            `,children:[a.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 text-gray-600 mr-3 text-sm font-bold",children:String.fromCharCode(65+x)}),m]},x))})}return n==="NUMBER"||e==="MATH_PROBLEM"?a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("input",{ref:d,type:"text",value:s||"",onChange:f=>i(f.target.value),onKeyDown:p,disabled:o,placeholder:"?",className:`
            w-32 h-16 text-center text-3xl font-bold
            border-2 border-gray-300 rounded-xl
            focus:border-purple-500 focus:ring-2 focus:ring-purple-200
            outline-none transition-all
            ${o?"bg-gray-100 cursor-not-allowed":"bg-white"}
          `,style:{fontFamily:"monospace"}}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Press Enter to submit"})]}):a.jsxs("div",{className:"w-full",children:[a.jsx("input",{ref:d,type:"text",value:s||"",onChange:f=>i(f.target.value),onKeyDown:p,disabled:o,placeholder:c,className:`
          w-full p-4 text-lg
          border-2 border-gray-300 rounded-xl
          focus:border-purple-500 focus:ring-2 focus:ring-purple-200
          outline-none transition-all
          ${o?"bg-gray-100 cursor-not-allowed":"bg-white"}
        `}),a.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Press Enter to submit"})]})};var GT={linear:function(n,e,t,s){var i=t-e;return i*n/s+e},easeInQuad:function(n,e,t,s){var i=t-e;return i*(n/=s)*n+e},easeOutQuad:function(n,e,t,s){var i=t-e;return-i*(n/=s)*(n-2)+e},easeInOutQuad:function(n,e,t,s){var i=t-e;return(n/=s/2)<1?i/2*n*n+e:-i/2*(--n*(n-2)-1)+e},easeInCubic:function(n,e,t,s){var i=t-e;return i*(n/=s)*n*n+e},easeOutCubic:function(n,e,t,s){var i=t-e;return i*((n=n/s-1)*n*n+1)+e},easeInOutCubic:function(n,e,t,s){var i=t-e;return(n/=s/2)<1?i/2*n*n*n+e:i/2*((n-=2)*n*n+2)+e},easeInQuart:function(n,e,t,s){var i=t-e;return i*(n/=s)*n*n*n+e},easeOutQuart:function(n,e,t,s){var i=t-e;return-i*((n=n/s-1)*n*n*n-1)+e},easeInOutQuart:function(n,e,t,s){var i=t-e;return(n/=s/2)<1?i/2*n*n*n*n+e:-i/2*((n-=2)*n*n*n-2)+e},easeInQuint:function(n,e,t,s){var i=t-e;return i*(n/=s)*n*n*n*n+e},easeOutQuint:function(n,e,t,s){var i=t-e;return i*((n=n/s-1)*n*n*n*n+1)+e},easeInOutQuint:function(n,e,t,s){var i=t-e;return(n/=s/2)<1?i/2*n*n*n*n*n+e:i/2*((n-=2)*n*n*n*n+2)+e},easeInSine:function(n,e,t,s){var i=t-e;return-i*Math.cos(n/s*(Math.PI/2))+i+e},easeOutSine:function(n,e,t,s){var i=t-e;return i*Math.sin(n/s*(Math.PI/2))+e},easeInOutSine:function(n,e,t,s){var i=t-e;return-i/2*(Math.cos(Math.PI*n/s)-1)+e},easeInExpo:function(n,e,t,s){var i=t-e;return n==0?e:i*Math.pow(2,10*(n/s-1))+e},easeOutExpo:function(n,e,t,s){var i=t-e;return n==s?e+i:i*(-Math.pow(2,-10*n/s)+1)+e},easeInOutExpo:function(n,e,t,s){var i=t-e;return n===0?e:n===s?e+i:(n/=s/2)<1?i/2*Math.pow(2,10*(n-1))+e:i/2*(-Math.pow(2,-10*--n)+2)+e},easeInCirc:function(n,e,t,s){var i=t-e;return-i*(Math.sqrt(1-(n/=s)*n)-1)+e},easeOutCirc:function(n,e,t,s){var i=t-e;return i*Math.sqrt(1-(n=n/s-1)*n)+e},easeInOutCirc:function(n,e,t,s){var i=t-e;return(n/=s/2)<1?-i/2*(Math.sqrt(1-n*n)-1)+e:i/2*(Math.sqrt(1-(n-=2)*n)+1)+e},easeInElastic:function(n,e,t,s){var i=t-e,r,o,c;return c=1.70158,o=0,r=i,n===0?e:(n/=s)===1?e+i:(o||(o=s*.3),r<Math.abs(i)?(r=i,c=o/4):c=o/(2*Math.PI)*Math.asin(i/r),-(r*Math.pow(2,10*(n-=1))*Math.sin((n*s-c)*(2*Math.PI)/o))+e)},easeOutElastic:function(n,e,t,s){var i=t-e,r,o,c;return c=1.70158,o=0,r=i,n===0?e:(n/=s)===1?e+i:(o||(o=s*.3),r<Math.abs(i)?(r=i,c=o/4):c=o/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*n)*Math.sin((n*s-c)*(2*Math.PI)/o)+i+e)},easeInOutElastic:function(n,e,t,s){var i=t-e,r,o,c;return c=1.70158,o=0,r=i,n===0?e:(n/=s/2)===2?e+i:(o||(o=s*(.3*1.5)),r<Math.abs(i)?(r=i,c=o/4):c=o/(2*Math.PI)*Math.asin(i/r),n<1?-.5*(r*Math.pow(2,10*(n-=1))*Math.sin((n*s-c)*(2*Math.PI)/o))+e:r*Math.pow(2,-10*(n-=1))*Math.sin((n*s-c)*(2*Math.PI)/o)*.5+i+e)},easeInBack:function(n,e,t,s,i){var r=t-e;return i===void 0&&(i=1.70158),r*(n/=s)*n*((i+1)*n-i)+e},easeOutBack:function(n,e,t,s,i){var r=t-e;return i===void 0&&(i=1.70158),r*((n=n/s-1)*n*((i+1)*n+i)+1)+e},easeInOutBack:function(n,e,t,s,i){var r=t-e;return i===void 0&&(i=1.70158),(n/=s/2)<1?r/2*(n*n*(((i*=1.525)+1)*n-i))+e:r/2*((n-=2)*n*(((i*=1.525)+1)*n+i)+2)+e},easeInBounce:function(n,e,t,s){var i=t-e,r;return r=GT.easeOutBounce(s-n,0,i,s),i-r+e},easeOutBounce:function(n,e,t,s){var i=t-e;return(n/=s)<1/2.75?i*(7.5625*n*n)+e:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+e:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+e:i*(7.5625*(n-=2.625/2.75)*n+.984375)+e},easeInOutBounce:function(n,e,t,s){var i=t-e,r;return n<s/2?(r=GT.easeInBounce(n*2,0,i,s),r*.5+e):(r=GT.easeOutBounce(n*2-s,0,i,s),r*.5+i*.5+e)}},Tue=GT;function _ue(n){return n*Math.PI/180}function Sa(n,e){return n+Math.random()*(e-n)}function Pue(n,e){return Math.floor(n+Math.random()*(e-n+1))}var KC;(function(n){n[n.Circle=0]="Circle",n[n.Square=1]="Square",n[n.Strip=2]="Strip"})(KC||(KC={}));var np;(function(n){n[n.Positive=1]="Positive",n[n.Negative=-1]="Negative"})(np||(np={}));const Lue=1e3/60;class Due{constructor(e,t,s,i){this.getOptions=t;const{colors:r,initialVelocityX:o,initialVelocityY:c}=this.getOptions();this.context=e,this.x=s,this.y=i,this.w=Sa(5,20),this.h=Sa(5,20),this.radius=Sa(5,10),this.vx=typeof o=="number"?Sa(-o,o):Sa(o.min,o.max),this.vy=typeof c=="number"?Sa(-c,0):Sa(c.min,c.max),this.shape=Pue(0,2),this.angle=_ue(Sa(0,360)),this.angularSpin=Sa(-.2,.2),this.color=r[Math.floor(Math.random()*r.length)],this.rotateY=Sa(0,1),this.rotationDirection=Sa(0,1)?np.Positive:np.Negative}update(e){const{gravity:t,wind:s,friction:i,opacity:r,drawShape:o}=this.getOptions(),c=e/Lue;this.x+=this.vx*c,this.y+=this.vy*c,this.vy+=t*c,this.vx+=s*c,this.vx*=i**c,this.vy*=i**c,this.rotateY>=1&&this.rotationDirection===np.Positive?this.rotationDirection=np.Negative:this.rotateY<=-1&&this.rotationDirection===np.Negative&&(this.rotationDirection=np.Positive);const d=.1*this.rotationDirection*c;if(this.rotateY+=d,this.angle+=this.angularSpin,this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(this.angle),this.context.scale(1,this.rotateY),this.context.rotate(this.angle),this.context.beginPath(),this.context.fillStyle=this.color,this.context.strokeStyle=this.color,this.context.globalAlpha=r,this.context.lineCap="round",this.context.lineWidth=2,o&&typeof o=="function")o.call(this,this.context);else switch(this.shape){case KC.Circle:{this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill();break}case KC.Square:{this.context.fillRect(-this.w/2,-this.h/2,this.w,this.h);break}case KC.Strip:{this.context.fillRect(-this.w/6,-this.h/2,this.w/3,this.h);break}}this.context.closePath(),this.context.restore()}}class Rue{constructor(e,t){this.x=0,this.y=0,this.w=0,this.h=0,this.lastNumberOfPieces=0,this.tweenProgress=0,this.tweenFrom=0,this.particles=[],this.particlesGenerated=0,this.removeParticleAt=i=>{this.particles.splice(i,1)},this.getParticle=()=>{const i=Sa(this.x,this.w+this.x),r=Sa(this.y,this.h+this.y);return new Due(this.context,this.getOptions,i,r)},this.animate=i=>{const{canvas:r,context:o,particlesGenerated:c,lastNumberOfPieces:d}=this,{run:h,recycle:u,numberOfPieces:p,debug:f,tweenFunction:m,tweenDuration:x}=this.getOptions();if(!h)return!1;const g=this.particles.length,b=u?g:c;if(b<p){d!==p&&(this.tweenProgress=0,this.tweenFrom=b,this.lastNumberOfPieces=p),this.tweenProgress=Math.min(x,Math.max(0,this.tweenProgress+i));const y=m(this.tweenProgress,this.tweenFrom,p,x),C=Math.round(y-b);for(let w=0;w<C;w++)this.particles.push(this.getParticle());this.particlesGenerated+=C}f&&(o.font="12px sans-serif",o.fillStyle="#333",o.textAlign="right",o.fillText(`Particles: ${g}`,r.width-10,r.height-20));for(let y=this.particles.length-1;y>=0;y--){const C=this.particles[y];C.update(i),(C.y>r.height||C.y<-100||C.x>r.width+100||C.x<-100)&&(u&&b<=p?this.particles[y]=this.getParticle():this.removeParticleAt(y))}return g>0||b<p},this.canvas=e;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get canvas context");this.context=s,this.getOptions=t}}const v3={width:typeof window<"u"?window.innerWidth:300,height:typeof window<"u"?window.innerHeight:200,numberOfPieces:200,friction:.99,wind:0,gravity:.1,initialVelocityX:4,initialVelocityY:10,colors:["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548"],opacity:1,debug:!1,tweenFunction:Tue.easeInOutQuad,tweenDuration:5e3,recycle:!0,run:!0};class Iue{constructor(e,t){this.lastFrameTime=0,this.setOptionsWithDefaults=i=>{const r={confettiSource:{x:0,y:0,w:this.canvas.width,h:0}};this._options={...r,...v3,...i},Object.assign(this,i.confettiSource)},this.update=(i=0)=>{const{options:{run:r,onConfettiComplete:o,frameRate:c},canvas:d,context:h}=this,u=Math.min(i-this.lastFrameTime,50);if(c&&u<1e3/c){this.rafId=requestAnimationFrame(this.update);return}this.lastFrameTime=i-(c?u%c:0),r&&(h.fillStyle="white",h.clearRect(0,0,d.width,d.height)),this.generator.animate(u)?this.rafId=requestAnimationFrame(this.update):(o&&typeof o=="function"&&this.generator.particlesGenerated>0&&o.call(this,this),this._options.run=!1)},this.reset=()=>{this.generator&&this.generator.particlesGenerated>0&&(this.generator.particlesGenerated=0,this.generator.particles=[],this.generator.lastNumberOfPieces=0)},this.stop=()=>{this.options={run:!1},this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0)},this.canvas=e;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get canvas context");this.context=s,this.generator=new Rue(this.canvas,()=>this.options),this.options=t,this.update()}get options(){return this._options}set options(e){var i,r;const t=(i=this._options)==null?void 0:i.run,s=(r=this._options)==null?void 0:r.recycle;this.setOptionsWithDefaults(e),this.generator&&(Object.assign(this.generator,this.options.confettiSource),typeof e.recycle=="boolean"&&e.recycle&&s===!1&&(this.generator.lastNumberOfPieces=this.generator.particles.length)),typeof e.run=="boolean"&&e.run&&t===!1&&this.update()}}const Mue=Td.createRef();class w3 extends Td.Component{constructor(e){super(e),this.canvas=Td.createRef(),this.canvas=e.canvasRef||Mue}componentDidMount(){if(this.canvas.current){const e=TR(this.props)[0];this.confetti=new Iue(this.canvas.current,e)}}componentDidUpdate(){const e=TR(this.props)[0];this.confetti&&(this.confetti.options=e)}componentWillUnmount(){this.confetti&&this.confetti.stop(),this.confetti=void 0}render(){const[e,t]=TR(this.props),s={zIndex:2,position:"absolute",pointerEvents:"none",top:0,left:0,bottom:0,right:0,...t.style};return a.jsx("canvas",{width:e.width,height:e.height,ref:this.canvas,...t,style:s})}}w3.defaultProps={...v3};w3.displayName="ReactConfetti";function TR(n){const e={},t={},s={},i=[...Object.keys(v3),"confettiSource","drawShape","onConfettiComplete","frameRate"],r=["canvasRef"];for(const o in n){const c=n[o];i.includes(o)?e[o]=c:r.includes(o)?r[o]=c:s[o]=c}return[e,s,t]}const jY=Td.forwardRef((n,e)=>a.jsx(w3,{canvasRef:e,...n})),Fue=({isCorrect:n,feedback:e,xpAwarded:t=0,showHint:s,hint1:i,hint2:r,correctAnswer:o,explanation:c,attemptNumber:d,onTryAgain:h,onClose:u,autoCloseDelay:p=1e4})=>{const[f,m]=N.useState(p/1e3),[x,g]=N.useState(!1);N.useEffect(()=>{if(n&&t>0){g(!0);const y=setTimeout(()=>g(!1),3e3);return()=>clearTimeout(y)}},[n,t]),N.useEffect(()=>{if(n&&p>0){const y=setInterval(()=>{m(C=>C<=1?(clearInterval(y),u==null||u(),0):C-1)},1e3);return()=>clearInterval(y)}},[n,p,u]);const b=s===1?i:s===2?r:null;return a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"w-full relative",children:[x&&a.jsx(jY,{width:window.innerWidth,height:window.innerHeight,recycle:!1,numberOfPieces:200,gravity:.3,style:{position:"fixed",top:0,left:0,zIndex:1e3}}),a.jsx("div",{className:`
          p-4 rounded-xl mb-4
          ${n?"bg-green-100 border-2 border-green-400":"bg-amber-100 border-2 border-amber-400"}
        `,children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:`
              w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0
              ${n?"bg-green-500":"bg-amber-500"}
            `,children:n?a.jsx(bo,{className:"w-6 h-6 text-white"}):a.jsx(on,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`font-semibold text-lg ${n?"text-green-800":"text-amber-800"}`,children:e}),n&&t>0&&a.jsxs(R.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.3,type:"spring"},className:"flex items-center gap-2 mt-2",children:[a.jsx(pW,{className:"w-5 h-5 text-yellow-500"}),a.jsxs("span",{className:"text-yellow-600 font-bold",children:["+",t," XP"]})]})]})]})}),b&&!n&&a.jsx(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-xl mb-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(qL,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm font-semibold text-blue-700 mb-1",children:["Hint ",s,":"]}),a.jsx("p",{className:"text-blue-800",children:b})]})]})}),o&&!n&&a.jsxs("div",{className:"p-4 bg-gray-100 border-2 border-gray-300 rounded-xl mb-4",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-1",children:"The correct answer is:"}),a.jsx("p",{className:"text-xl font-bold text-gray-800",children:o}),c&&a.jsx("p",{className:"text-gray-600 mt-2",children:c})]}),n&&c&&a.jsx("div",{className:"p-4 bg-purple-50 border-2 border-purple-200 rounded-xl mb-4",children:a.jsx("p",{className:"text-purple-800",children:c})}),a.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[!n&&!o&&a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:h,className:"px-6 py-3 bg-purple-600 text-white font-semibold rounded-xl hover:bg-purple-700 transition-colors",children:"Try Again"}),a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:u,className:`
            px-6 py-3 font-semibold rounded-xl transition-colors
            ${n||o?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}
          `,children:n?a.jsxs("span",{className:"flex items-center gap-2",children:["Continue",p>0&&a.jsxs("span",{className:"text-green-200",children:["(",f,"s)"]})]}):o?"Got it":"Close"})]})]})},AY={getExercisesForLesson:async n=>ue(`/exercises/lesson/${n}`,{method:"GET"}),getExercise:async n=>ue(`/exercises/${n}`,{method:"GET"}),submitAnswer:async(n,e,t=null)=>{const s={submittedAnswer:e};return t&&(s.lessonId=t),ue(`/exercises/${n}/submit`,{method:"POST",body:JSON.stringify(s)})},getHint:async(n,e)=>ue(`/exercises/${n}/hint/${e}`,{method:"GET"}),getStats:async()=>ue("/exercises/stats/me",{method:"GET"})},Oue=({exercise:n,isOpen:e,onClose:t,onComplete:s})=>{const[i,r]=N.useState(""),[o,c]=N.useState(!1),[d,h]=N.useState(null),[u,p]=N.useState(null);N.useEffect(()=>{e&&n&&(r(""),h(null),p(null))},[e,n==null?void 0:n.id]);const f=async()=>{if(!(!i.trim()||o)){c(!0),p(null);try{const g=await AY.submitAnswer(n.id,i);h(g.data),g.data.isCorrect&&(s==null||s(g.data))}catch(g){console.error("Failed to submit answer:",g),p("Oops! Something went wrong. Please try again.")}finally{c(!1)}}},m=()=>{r(""),h(null),p(null)},x=()=>{t()};return n?a.jsx(Ie,{children:e&&a.jsxs(a.Fragment,{children:[a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:x,className:"fixed inset-0 bg-black/50 z-50 backdrop-blur-sm"}),a.jsx(R.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-auto",onClick:g=>g.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ld,{className:"w-5 h-5 text-purple-600"}),a.jsx("span",{className:"font-semibold text-gray-800",children:"Practice Question"})]}),a.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:a.jsx(on,{className:"w-5 h-5 text-gray-500"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[n.contextText&&a.jsx("p",{className:"text-sm text-gray-500 mb-2",children:n.contextText}),a.jsx("h3",{className:"text-xl font-bold text-gray-800",children:n.questionText}),n.originalPosition&&a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:n.originalPosition})]}),d?a.jsx(Fue,{isCorrect:d.isCorrect,feedback:d.feedback,xpAwarded:d.xpAwarded,showHint:d.showHint,hint1:n.hint1,hint2:n.hint2,correctAnswer:d.correctAnswer,explanation:d.explanation,attemptNumber:d.attemptNumber,onTryAgain:m,onClose:x,autoCloseDelay:d.isCorrect?1e4:0}):a.jsxs("div",{className:"space-y-4",children:[a.jsx(kue,{answerType:n.answerType,exerciseType:n.type,options:n.options,value:i,onChange:r,onSubmit:f,disabled:o,placeholder:n.type==="MATH_PROBLEM"?"Enter your answer...":"Type your answer..."}),u&&a.jsx("div",{className:"p-3 bg-red-100 border border-red-300 rounded-lg text-red-700 text-sm",children:u}),a.jsx(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:f,disabled:!i.trim()||o,className:`
                        w-full py-4 rounded-xl font-bold text-lg
                        transition-all flex items-center justify-center gap-2
                        ${!i.trim()||o?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}
                      `,children:o?a.jsxs(a.Fragment,{children:[a.jsx(nc,{className:"w-5 h-5 animate-spin"}),"Checking..."]}):"Submit Answer"})]})]}),n.difficulty&&a.jsx("div",{className:"px-6 pb-4",children:a.jsx("span",{className:`
                      inline-block px-3 py-1 rounded-full text-xs font-semibold
                      ${n.difficulty==="EASY"?"bg-green-100 text-green-700":n.difficulty==="MEDIUM"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}
                    `,children:n.difficulty})})]})})]})}):null},Bue=({exercise:n,isCompleted:e=!1,attemptCount:t=0,onClick:s})=>{const i={EASY:"bg-green-100 text-green-700",MEDIUM:"bg-yellow-100 text-yellow-700",HARD:"bg-red-100 text-red-700"},r={FILL_IN_BLANK:"Fill in the blank",MATH_PROBLEM:"Math Problem",SHORT_ANSWER:"Short Answer",MULTIPLE_CHOICE:"Multiple Choice",TRUE_FALSE:"True or False"};return a.jsxs(R.div,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>s==null?void 0:s(n),className:`
        p-4 rounded-xl cursor-pointer transition-all
        border-2
        ${e?"bg-green-50 border-green-300 hover:border-green-400":"bg-white border-gray-200 hover:border-purple-400 hover:shadow-md"}
      `,children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-xs text-gray-500 font-medium",children:r[n.type]||n.type}),a.jsx("p",{className:`mt-1 font-medium ${e?"text-green-800":"text-gray-800"}`,children:n.questionText}),n.originalPosition&&a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:n.originalPosition})]}),a.jsx("div",{className:"flex-shrink-0",children:e?a.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center",children:a.jsx(gW,{className:"w-5 h-5 text-white"})}):a.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:a.jsx(Ld,{className:"w-5 h-5 text-purple-600"})})})]}),a.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100",children:[a.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${i[n.difficulty]||i.MEDIUM}`,children:n.difficulty||"MEDIUM"}),t>0&&a.jsxs("span",{className:"text-xs text-gray-500",children:[t," attempt",t>1?"s":""]}),a.jsxs("span",{className:"text-xs text-gray-500",children:["+",n.xpReward||10," XP"]})]})]})},$ue=({exercises:n=[],onExerciseClick:e})=>{if(!n||n.length===0)return null;const t=n.filter(i=>i.isCompleted).length,s=n.length;return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[a.jsx(Ld,{className:"w-5 h-5 text-purple-600"}),"Practice Questions"]}),a.jsxs("span",{className:"text-sm text-gray-500",children:[t,"/",s," completed"]})]}),a.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${t/s*100}%`},transition:{duration:.5,ease:"easeOut"},className:"h-full bg-green-500"})}),a.jsx("div",{className:"space-y-3",children:n.map(i=>a.jsx(Bue,{exercise:i,isCompleted:i.isCompleted,attemptCount:i.attemptCount,onClick:e},i.id))})]})},Cl=n=>{let e=n;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\b([A-Z]{3,})\b/g,'<strong class="text-indigo-700">$1</strong>'),e=e.replace(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replace(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)\s+(means?|is defined as|refers to|are called)\b/g,'<strong class="text-purple-700">$1</strong> <em>$2</em>'),e},Uue=n=>{const e=n.trim();if(!e)return null;if(/^\[Section\s*\d+\]$/i.test(e))return`<div class="my-6 py-3 px-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold rounded-xl text-center shadow-md"> Section ${e.match(/\d+/)[0]}</div>`;if(/^(Learning Objectives?|Materials? Needed|Review Questions?|Vocabulary|Summary|Introduction|Conclusion|Activities?|Hands-On Activities|Art Vocabulary|Famous Artists)/i.test(e))return`<h2 class="text-xl font-bold text-indigo-800 mt-6 mb-3 pb-2 border-b-2 border-indigo-200"> ${Cl(e)}</h2>`;if(/^(Activity\s*\d+|Step\s*\d+|Example\s*\d+|Part\s*\d+|Creating\s+[A-Z]+|The\s+(?:Primary|Secondary|Color|Warm|Cool)\s+\w+|Fun Fact|Mixing Tips|Artist's Secret)/i.test(e))return`<h3 class="text-lg font-semibold text-purple-700 mt-5 mb-2"> ${Cl(e)}</h3>`;if(/^\d+\.\s+[A-Z]/.test(e)&&e.length<50)return`<h3 class="text-lg font-semibold text-teal-700 mt-4 mb-2"> ${Cl(e)}</h3>`;if(/^[]\s*/.test(e)){const i=e.replace(/^[]\s*/,"");return`<li class="ml-6 mb-1 text-gray-700">${Cl(i)}</li>`}if(/^\d+[.)]\s+/.test(e)&&e.length>50){const i=e.replace(/^\d+[.)]\s+/,"");return`<li class="ml-6 mb-2 text-gray-700 list-decimal">${Cl(i)}</li>`}return/^(Grade Level|Subject|Topic|Duration|Materials Needed):/i.test(e)?`<p class="text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-lg inline-block mb-1">${Cl(e)}</p>`:/[A-Z]+\s*\+\s*[A-Z]+\s*=\s*[A-Z]+/.test(e)?`<p class="text-center font-bold text-lg my-3 py-2 px-4 bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl border-2 border-orange-200">${Cl(e)}</p>`:e.includes("|")&&e.split("|").length>=2?`<tr class="even:bg-gray-50">${e.split("|").map(o=>o.trim()).filter(Boolean).map(o=>`<td class="px-3 py-2 border border-gray-200">${Cl(o)}</td>`).join("")}</tr>`:/\?$/.test(e)?`<p class="text-gray-800 bg-blue-50 px-4 py-2 rounded-lg border-l-4 border-blue-400 my-2"><strong></strong> ${Cl(e)}</p>`:/^Answers?:/i.test(e)?`<h3 class="text-lg font-semibold text-green-700 mt-5 mb-2"> ${Cl(e)}</h3>`:`<p class="text-gray-700 mb-2 leading-relaxed">${Cl(e)}</p>`},zue=n=>{if(!n)return"";if((n.match(/<[a-z][^>]*>/gi)||[]).length>5)return QU.sanitize(n,{ALLOWED_TAGS:["p","br","b","strong","i","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","span","div","blockquote","table","thead","tbody","tr","th","td","code","mark"],ALLOWED_ATTR:["class","style","data-page","data-exercise-id","data-type","data-definition","data-section","data-numerator","data-denominator","title"]});const s=n.replace(/(\d+\.)\s*n+\s+/g,"$1 ").replace(/^n+\s+/gm,"").replace(/\s+n+\s+(?=[A-Z])/g," ").replace(/\\n/g,`
`).split(`
`),i=[];let r=!1,o=!1;for(let c=0;c<s.length;c++){const h=s[c].trim();if(!h){r&&(i.push("</ul>"),r=!1),o&&(i.push("</tbody></table>"),o=!1);continue}const u=Uue(h);u&&(u.startsWith("<li")?(r||(i.push('<ul class="my-3 space-y-1">'),r=!0),i.push(u)):u.startsWith("<tr")?(o||(i.push('<table class="w-full my-4 border-collapse border border-gray-200 rounded-lg overflow-hidden"><tbody>'),o=!0),i.push(u)):(r&&(i.push("</ul>"),r=!1),o&&(i.push("</tbody></table>"),o=!1),i.push(u)))}return r&&i.push("</ul>"),o&&i.push("</tbody></table>"),QU.sanitize(i.join(`
`),{ALLOWED_TAGS:["p","br","b","strong","i","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","span","div","blockquote","code","table","tbody","tr","td","th","mark"],ALLOWED_ATTR:["class","style","data-page","data-exercise-id","data-type","data-definition","data-section","data-numerator","data-denominator","title"]})},_R=n=>{var e,t,s;return(n==null?void 0:n.formattedContent)||((e=n==null?void 0:n.content)==null?void 0:e.formattedContent)||(n==null?void 0:n.extractedText)||((t=n==null?void 0:n.content)==null?void 0:t.extractedText)||(n==null?void 0:n.rawText)||((s=n==null?void 0:n.content)==null?void 0:s.rawText)||""},Hue=({lesson:n,onComplete:e,showContentViewer:t=!1})=>{var Re,Ye,Le,te,fe,Ne,Pe,nt,gt,hs,qs,Cn,ni,Ji,Si,Ci,ce,ye,se,pe,Ue,Be;const[s,i]=N.useState(!1),[r,o]=N.useState(!1),[c,d]=N.useState("structured"),[h,u]=N.useState({zoom:1,currentPage:1}),[p,f]=N.useState([]),[m,x]=N.useState(null),[g,b]=N.useState(!1),{canCreateDeckFromLesson:y,getDeckForLesson:C,createDeckFromLesson:w}=SY(),{isProcessing:S,processingStage:j,processingProgress:T,currentStageInfo:k,hasLessons:_,updateLessonProgress:L}=Hu(),{formatTimeSpent:D}=l3(),P=n?NY(n):"unknown",I=(n==null?void 0:n.contentUrl)||((Re=n==null?void 0:n.source)==null?void 0:Re.url)||(n==null?void 0:n.fileUrl),M=bue(P),O=N.useCallback(()=>{o(je=>!je)},[]),F=N.useCallback(()=>{d(je=>je==="structured"?"content":"structured")},[]),B=N.useCallback(je=>{u(ze=>({...ze,zoom:je}))},[]),U=N.useCallback(je=>{u(ze=>({...ze,currentPage:je}))},[]),$=n?C(n.id):null,G=n?y(n):!1,ne=N.useRef(new Set);N.useEffect(()=>{(async()=>{if(!(n!=null&&n.id)){f([]);return}if(!ne.current.has(n.id)){ne.current.add(n.id),b(!0);try{const ze=await AY.getExercisesForLesson(n.id);f(ze.data||[])}catch(ze){console.error("Failed to fetch exercises:",ze),f([])}finally{b(!1)}}})()},[n==null?void 0:n.id]);const Z=N.useCallback(je=>{x(je)},[]),K=N.useCallback(je=>{f(ze=>ze.map(Ft=>Ft.id===(m==null?void 0:m.id)?{...Ft,isCompleted:!0,attemptCount:je.attemptNumber}:Ft))},[m==null?void 0:m.id]),X=()=>{G?w(n):i(!0)};if(S)return a.jsxs("div",{className:"flex-[1.5] bg-white rounded-3xl shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] border-4 border-black overflow-hidden flex flex-col",children:[a.jsx("div",{className:"bg-nanobanana-green border-b-4 border-black p-6",children:a.jsx("h1",{className:"text-3xl font-black font-comic text-white drop-shadow-[2px_2px_0px_rgba(0,0,0,1)]",children:k.childLabel||"Processing..."})}),a.jsx("div",{className:"flex-1 flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/graphy.png')]",children:a.jsx(WW,{stage:j,progress:T,useChildLabels:!0})})]});if(!n)return a.jsxs("div",{className:"flex-[1.5] bg-white rounded-3xl shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] border-4 border-black overflow-hidden flex flex-col",children:[a.jsx("div",{className:"bg-nanobanana-green border-b-4 border-black p-6",children:a.jsx("h1",{className:"text-3xl font-black font-comic text-white drop-shadow-[2px_2px_0px_rgba(0,0,0,1)]",children:"Hi there!"})}),a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center bg-[url('https://www.transparenttextures.com/patterns/graphy.png')]",children:[a.jsx(R.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",bounce:.5},className:"w-24 h-24 bg-nanobanana-yellow rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center mb-6",children:a.jsx(js,{className:"w-12 h-12"})}),a.jsx("h2",{className:"text-2xl font-bold font-comic mb-4",children:"Ready to Learn?"}),a.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:"Upload a lesson to start learning with Jeffrey! He's excited to help you understand new things."})]})]});const V=n,q={MATH:"",SCIENCE:"",ENGLISH:"",ARABIC:"",ISLAMIC_STUDIES:"",SOCIAL_STUDIES:"",ART:"",MUSIC:"",OTHER:""},ee=(Ye=V.progress)!=null&&Ye.timeSpent?D(V.progress.timeSpent):null,ie=((Le=V.progress)==null?void 0:Le.percentComplete)||0;return a.jsxs("div",{className:"flex-1 bg-white rounded-2xl md:rounded-3xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] md:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] border-3 md:border-4 border-black overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"bg-nanobanana-green border-b-4 border-black p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("span",{className:"bg-black text-white px-3 py-1 rounded-full text-xs font-bold uppercase",children:[q[(te=V.subject)==null?void 0:te.toUpperCase()]||""," ",V.subject||"Lesson"]}),V.gradeLevel&&a.jsx("span",{className:"bg-white/20 text-white px-3 py-1 rounded-full text-xs font-bold",children:V.gradeLevel}),I&&a.jsxs("span",{className:"bg-white/20 text-white px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1",children:[M.emoji," ",M.label]}),(((fe=V.content)==null?void 0:fe.estimatedReadTime)||ee)&&a.jsxs("span",{className:"flex items-center gap-1 text-white/80 text-xs font-bold",children:[a.jsx(Pd,{className:"w-3 h-3"}),ee||`${V.content.estimatedReadTime} min read`]}),ie===100&&a.jsxs("span",{className:"flex items-center gap-1 bg-white text-green-600 px-2 py-1 rounded-full text-xs font-bold",children:[a.jsx(kd,{className:"w-3 h-3"}),"Completed"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[I&&a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:F,className:`
                                    px-3 py-1 rounded-full text-xs font-bold border-2 border-white/30 transition-colors
                                    ${c==="content"?"bg-white text-green-600":"bg-white/20 text-white hover:bg-white/30"}
                                `,children:c==="content"?" Summary":`${M.emoji} View File`}),(((Ne=V.vocabulary)==null?void 0:Ne.length)>0||((nt=(Pe=V.content)==null?void 0:Pe.vocabulary)==null?void 0:nt.length)>0)&&a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:O,className:`
                                    px-3 py-1 rounded-full text-xs font-bold border-2 border-white/30 transition-colors
                                    ${r?"bg-white text-green-600":"bg-white/20 text-white hover:bg-white/30"}
                                `,children:[" Words (",(V.vocabulary||((gt=V.content)==null?void 0:gt.vocabulary)||[]).length,")"]})]})]}),a.jsx("h1",{className:"text-3xl font-black font-comic text-white drop-shadow-[2px_2px_0px_rgba(0,0,0,1)]",children:V.title}),ie>0&&ie<100&&a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex justify-between text-xs text-white/80 font-bold mb-1",children:[a.jsx("span",{children:"Progress"}),a.jsxs("span",{children:[ie,"%"]})]}),a.jsx("div",{className:"h-2 bg-white/30 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${ie}%`},className:"h-full bg-white rounded-full"})})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{className:`flex-1 overflow-y-auto transition-all duration-300 ${r?"lg:mr-0":""}`,children:c==="content"&&I?a.jsx(Cue,{lesson:V,viewPreferences:h,onZoomChange:B,onPageChange:U,onSelectionAction:je=>{console.log("Selection action result:",je)}}):a.jsx("div",{className:"p-6 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')]",children:a.jsxs(fue,{lessonId:V.id,contentType:"html",onSelectionAction:je=>{console.log("Selection action result:",je)},children:[a.jsxs("div",{className:"space-y-6",children:[V.sourceType==="youtube"&&V.sourceVideo&&a.jsxs("div",{className:"aspect-video bg-black rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] relative group cursor-pointer overflow-hidden",children:[a.jsx("img",{src:V.sourceVideo.thumbnail,alt:V.sourceVideo.title,className:"w-full h-full object-cover opacity-80 group-hover:scale-105 transition-transform duration-500"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] group-hover:scale-110 transition-transform",children:a.jsx(loe,{className:"w-8 h-8 ml-1"})})})]}),_R(V)&&a.jsx("div",{className:"prose prose-lg max-w-none",children:a.jsx("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-6 shadow-sm",children:a.jsx("div",{className:"text-gray-800 leading-relaxed lesson-content",dangerouslySetInnerHTML:{__html:zue(_R(V))}})})}),_R(V)&&(((qs=(hs=V.content)==null?void 0:hs.vocabulary)==null?void 0:qs.length)>0||((Cn=V.vocabulary)==null?void 0:Cn.length)>0||((ni=V.suggestedQuestions)==null?void 0:ni.length)>0)&&a.jsxs("div",{className:"flex items-center gap-4 my-8",children:[a.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300"}),a.jsx("span",{className:"text-sm font-bold text-gray-400 uppercase",children:"Study Aids"}),a.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300"})]}),(((Si=(Ji=V.content)==null?void 0:Ji.vocabulary)==null?void 0:Si.length)>0||((Ci=V.vocabulary)==null?void 0:Ci.length)>0)&&a.jsxs("div",{className:"mt-6",children:[a.jsxs("h4",{className:"font-bold text-lg mb-3 flex items-center gap-2",children:[a.jsx(va,{className:"w-5 h-5"}),"Key Words"]}),a.jsx("div",{className:"grid gap-3",children:(((ce=V.content)==null?void 0:ce.vocabulary)||V.vocabulary||[]).map((je,ze)=>a.jsxs("div",{className:"p-3 bg-blue-50 rounded-xl border-2 border-blue-200",children:[a.jsxs("span",{className:"font-bold text-blue-800",children:[je.term,":"]})," ",a.jsx("span",{className:"text-blue-600",children:je.definition}),je.example&&a.jsxs("p",{className:"text-sm text-blue-500 mt-1 italic",children:["Example: ",je.example]})]},ze))})]}),((ye=V.suggestedQuestions)==null?void 0:ye.length)>0&&a.jsxs("div",{className:"mt-6 p-4 bg-purple-50 rounded-xl border-2 border-purple-200",children:[a.jsxs("h4",{className:"font-bold text-lg mb-3 flex items-center gap-2 text-purple-800",children:[a.jsx(Ut,{className:"w-5 h-5"}),"Questions to Think About"]}),a.jsx("ul",{className:"space-y-2",children:V.suggestedQuestions.map((je,ze)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-purple-600 font-bold",children:"?"}),a.jsx("span",{className:"text-purple-700",children:je})]},ze))})]}),p.length>0&&a.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-xl border-2 border-orange-200",children:a.jsx($ue,{exercises:p,onExerciseClick:Z})}),a.jsx("div",{className:"mt-8 p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl border-2 border-purple-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:a.jsx(Ki,{className:"w-5 h-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-purple-800",children:"Study with Flashcards"}),a.jsx("p",{className:"text-sm text-purple-600",children:$?`${$.cardCount||0} cards ready to review`:"Turn this lesson into flashcards!"})]})]}),a.jsx("div",{className:"flex gap-2",children:$?a.jsxs(qe,{to:"/flashcards",className:"px-4 py-2 bg-purple-500 text-white font-bold rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] flex items-center gap-2 hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-shadow",children:[a.jsx(Ki,{className:"w-4 h-4"}),"Study"]}):a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:X,className:"px-4 py-2 bg-purple-500 text-white font-bold rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] flex items-center gap-2",children:[a.jsx(Ut,{className:"w-4 h-4"}),"Create Cards"]})})]})}),e&&ie<100&&a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:e,className:"mt-6 w-full py-3 bg-nanobanana-green text-white font-bold font-comic rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center gap-2",children:[a.jsx(Cr,{className:"w-5 h-5"}),"I've Finished This Lesson!"]}),ie===100&&a.jsxs("div",{className:"mt-6 p-4 bg-green-50 rounded-xl border-2 border-green-200 text-center",children:[a.jsx(kd,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),a.jsx("p",{className:"font-bold text-green-700",children:"Great job! You've completed this lesson!"}),a.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Keep chatting with Jeffrey to learn more."})]})]}),a.jsx(gue,{})]})})}),a.jsx(Ie,{children:r&&(((se=V.vocabulary)==null?void 0:se.length)>0||((Ue=(pe=V.content)==null?void 0:pe.vocabulary)==null?void 0:Ue.length)>0)&&a.jsx(R.div,{initial:{width:0,opacity:0},animate:{width:280,opacity:1},exit:{width:0,opacity:0},transition:{duration:.3},className:"hidden lg:block border-l-4 border-black overflow-hidden",children:a.jsx(Aue,{vocabulary:V.vocabulary||((Be=V.content)==null?void 0:Be.vocabulary)||[],lessonId:V.id,onClose:()=>o(!1)})})})]}),a.jsx(wY,{isOpen:s,onClose:()=>i(!1),lessonContent:V.content}),a.jsx(Oue,{exercise:m,isOpen:!!m,onClose:()=>x(null),onComplete:K})]})},Vue=({onClick:n,variant:e="primary",size:t="medium"})=>{const s={small:"px-3 py-2 text-sm",medium:"px-5 py-3 text-base",large:"px-6 py-4 text-lg"},i={primary:"bg-nanobanana-yellow hover:bg-yellow-400",secondary:"bg-white hover:bg-gray-100",floating:"bg-nanobanana-green hover:bg-green-500 text-white rounded-full"};return e==="floating"?a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:n,className:"fixed bottom-6 left-6 w-16 h-16 bg-nanobanana-green text-white rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center z-50 hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] transition-shadow",children:a.jsx(rm,{className:"w-8 h-8"})}):a.jsxs(R.button,{whileHover:{y:-2},whileTap:{y:0},onClick:n,className:`
                ${s[t]}
                ${i[e]}
                font-bold font-comic
                border-4 border-black 
                rounded-xl 
                shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)]
                active:shadow-none active:translate-y-1
                transition-all
                flex items-center gap-2
            `,children:[a.jsx(q0,{className:"w-5 h-5"}),"Upload Lesson"]})};function tz(n){return 50*Math.pow(n-1,2)}const yP=({children:n,content:e,title:t,position:s="bottom",delay:i=200})=>{const[r,o]=N.useState(!1),[c,d]=N.useState(null),h=()=>{const x=setTimeout(()=>{o(!0)},i);d(x)},u=()=>{c&&clearTimeout(c),o(!1)},p=()=>{switch(s){case"top":return"bottom-full left-1/2 -translate-x-1/2 mb-2";case"bottom":return"top-full left-1/2 -translate-x-1/2 mt-2";case"left":return"right-full top-1/2 -translate-y-1/2 mr-2";case"right":return"left-full top-1/2 -translate-y-1/2 ml-2";default:return"top-full left-1/2 -translate-x-1/2 mt-2"}},f=()=>{switch(s){case"top":return"top-full left-1/2 -translate-x-1/2 border-t-black border-x-transparent border-b-transparent";case"bottom":return"bottom-full left-1/2 -translate-x-1/2 border-b-black border-x-transparent border-t-transparent";case"left":return"left-full top-1/2 -translate-y-1/2 border-l-black border-y-transparent border-r-transparent";case"right":return"right-full top-1/2 -translate-y-1/2 border-r-black border-y-transparent border-l-transparent";default:return"bottom-full left-1/2 -translate-x-1/2 border-b-black border-x-transparent border-t-transparent"}},m=()=>{switch(s){case"top":return{initial:{opacity:0,y:5},animate:{opacity:1,y:0}};case"bottom":return{initial:{opacity:0,y:-5},animate:{opacity:1,y:0}};case"left":return{initial:{opacity:0,x:5},animate:{opacity:1,x:0}};case"right":return{initial:{opacity:0,x:-5},animate:{opacity:1,x:0}};default:return{initial:{opacity:0,y:-5},animate:{opacity:1,y:0}}}};return a.jsxs("div",{className:"relative inline-block",onMouseEnter:h,onMouseLeave:u,children:[n,a.jsx(Ie,{children:r&&a.jsx(R.div,{className:`absolute z-50 ${p()}`,...m(),exit:{opacity:0},transition:{duration:.15},children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`absolute w-0 h-0 border-[6px] ${f()}`}),a.jsxs("div",{className:"bg-white px-3 py-2 rounded-xl border-3 border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] whitespace-nowrap min-w-max",children:[t&&a.jsx("p",{className:"font-bold text-sm text-gray-800 mb-0.5",children:t}),a.jsx("p",{className:"text-xs text-gray-600",children:e})]})]})})})]})},WT=({compact:n=!1,showLabel:e=!0})=>{const{currentXP:t,currentLevel:s}=bl(),i=tz(s),r=tz(s+1),o=t-i,c=r-i,d=r-t,h=c>0?o/c*100:0,u=h>80;return n?a.jsx(yP,{title:`Level ${s}`,content:`${o}/${c} XP (${d} to next level)`,position:"bottom",children:a.jsxs("div",{className:"flex items-center gap-2 cursor-default",children:[a.jsxs("div",{className:"flex items-center gap-1 bg-nanobanana-yellow px-2 py-1 rounded-full border-2 border-black text-xs font-bold",children:[a.jsx(Cr,{className:"w-3 h-3 fill-black"}),s]}),a.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full border-2 border-black overflow-hidden min-w-[60px]",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${h}%`},transition:{duration:.5,ease:"easeOut"},className:`h-full ${u?"bg-gradient-to-r from-nanobanana-yellow to-orange-400":"bg-nanobanana-yellow"}`})})]})}):a.jsxs("div",{className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[e&&a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Cr,{className:"w-5 h-5 fill-nanobanana-yellow text-black"}),a.jsxs("span",{className:"font-bold font-comic",children:["Level ",s]})]}),a.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[o," / ",c," XP"]})]}),a.jsxs("div",{className:"relative h-6 bg-gray-200 rounded-full border-4 border-black overflow-hidden",children:[a.jsx(R.div,{initial:{width:0},animate:{width:`${h}%`},transition:{duration:.8,ease:"easeOut"},className:"h-full bg-gradient-to-r from-nanobanana-yellow via-yellow-400 to-orange-400 relative",children:u&&a.jsx(R.div,{animate:{x:["-100%","200%"]},transition:{duration:1.5,repeat:1/0,ease:"linear"},className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent"})}),u&&a.jsx(R.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0},className:"absolute right-2 top-1/2 -translate-y-1/2",children:a.jsx(Ut,{className:"w-4 h-4 text-orange-500"})})]}),e&&a.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center",children:[d," XP to Level ",s+1,"!"]})]})},qT=({compact:n=!1})=>{const{streak:e}=bl(),t=i=>i>=30?"from-purple-500 to-pink-500":i>=14?"from-orange-500 to-red-500":i>=7?"from-yellow-500 to-orange-500":"from-blue-500 to-cyan-500",s=i=>i>=7?{scale:[1,1.2,1],rotate:[0,5,-5,0]}:{scale:[1,1.1,1]};if(n){const i=e.freezeAvailable?`${e.current} day${e.current!==1?"s":""} in a row! Freeze available`:`${e.current} day${e.current!==1?"s":""} in a row!`;return a.jsx(yP,{title:"Day Streak",content:i,position:"bottom",children:a.jsxs("div",{className:"flex items-center gap-2 bg-white px-3 py-2 rounded-full border-2 border-black cursor-default",children:[a.jsx(R.div,{animate:s(e.current),transition:{duration:1,repeat:1/0,ease:"easeInOut"},children:a.jsx(uP,{className:"w-5 h-5 fill-orange-500 text-orange-600"})}),a.jsx("span",{className:"font-bold text-sm",children:e.current}),e.freezeAvailable&&a.jsx(yP,{title:"Streak Freeze",content:"Protects your streak if you miss a day",position:"bottom",children:a.jsx(Iu,{className:"w-4 h-4 text-blue-500"})})]})})}return a.jsxs("div",{className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("h3",{className:"font-bold font-comic flex items-center gap-2",children:[a.jsx(uP,{className:"w-5 h-5 fill-orange-500 text-orange-600"}),"Day Streak"]}),e.freezeAvailable&&a.jsxs("div",{className:"flex items-center gap-1 text-xs bg-blue-50 px-2 py-1 rounded-full border-2 border-blue-200",children:[a.jsx(Iu,{className:"w-3 h-3 text-blue-500"}),a.jsx("span",{className:"font-bold text-blue-700",children:"Freeze"})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(R.div,{animate:s(e.current),transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:`
                        text-5xl font-black font-comic text-center
                        bg-gradient-to-br ${t(e.current)}
                        bg-clip-text text-transparent
                    `,children:e.current}),a.jsxs("p",{className:"text-center text-sm text-gray-600 font-medium mt-1",children:[e.current===1?"day":"days"," in a row!"]})]}),e.longest>e.current&&a.jsx("div",{className:"mt-3 pt-3 border-t-2 border-gray-200 text-center",children:a.jsxs("p",{className:"text-xs text-gray-500",children:[a.jsx("span",{className:"font-bold",children:"Personal Best:"})," ",e.longest," days"]})}),a.jsx("div",{className:"mt-3 p-2 bg-yellow-50 rounded-xl border-2 border-yellow-200",children:a.jsx("p",{className:"text-xs text-yellow-800 text-center font-medium",children:e.current>=30?"Legendary! You're on fire!":e.current>=7?"Wow! You're on fire!":e.current>=3?"Great start! Keep it going!":"Keep learning daily to build your streak!"})})]})},Gue={common:"from-gray-300 to-gray-400",rare:"from-blue-400 to-blue-600",epic:"from-purple-400 to-purple-600",legendary:"from-yellow-400 to-orange-500"},Wue={common:"border-gray-400",rare:"border-blue-500",epic:"border-purple-500",legendary:"border-yellow-500"},que={common:"",rare:"shadow-[0_0_15px_rgba(59,130,246,0.5)]",epic:"shadow-[0_0_20px_rgba(139,92,246,0.6)]",legendary:"shadow-[0_0_25px_rgba(245,158,11,0.7)]"},Yue=n=>`/assets/badges/${n}.png`,Xue=({badge:n})=>{const[e,t]=N.useState(!1),[s,i]=N.useState(!1),r=Yue(n.id),o=!s;return a.jsxs("div",{className:"relative",children:[a.jsxs(R.div,{whileHover:{scale:1.1,rotate:n.unlocked?5:0},whileTap:{scale:.95},onHoverStart:()=>t(!0),onHoverEnd:()=>t(!1),className:`
                    relative aspect-square rounded-2xl border-4 cursor-pointer overflow-hidden
                    ${n.unlocked?`${Wue[n.rarity]} ${que[n.rarity]}`:"border-gray-300 bg-gray-100"}
                    shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]
                    flex flex-col items-center justify-center
                    transition-all
                `,children:[n.unlocked?o?a.jsx("img",{src:r,alt:n.name,className:"w-full h-full object-cover",onError:()=>i(!0)}):a.jsx("div",{className:`text-3xl bg-gradient-to-br ${Gue[n.rarity]} w-full h-full flex items-center justify-center`,children:n.icon}):a.jsxs("div",{className:"flex flex-col items-center justify-center p-2 opacity-50 grayscale",children:[o?a.jsx("img",{src:r,alt:n.name,className:"w-full h-full object-cover opacity-30 grayscale",onError:()=>i(!0)}):a.jsx(uM,{className:"w-6 h-6 text-gray-400"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200/60",children:a.jsx(uM,{className:"w-6 h-6 text-gray-500"})})]}),n.unlocked&&n.rarity!=="common"&&a.jsx("div",{className:"absolute top-1 right-1",children:a.jsx(Cr,{className:"w-3 h-3 fill-yellow-400 text-yellow-600"})}),!n.unlocked&&n.progress!==void 0&&n.progress>0&&a.jsx("div",{className:"absolute bottom-1 left-1 right-1",children:a.jsx("div",{className:"h-1 bg-gray-300 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${n.progress}%`},className:"h-full bg-nanobanana-blue"})})})]}),a.jsx(Ie,{children:e&&a.jsxs(R.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute z-20 bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-black text-white rounded-xl text-xs pointer-events-none",children:[a.jsx("div",{className:"font-bold mb-1",children:n.name}),a.jsx("div",{className:"text-gray-300",children:n.description}),n.unlocked&&n.unlockedAt&&a.jsxs("div",{className:"text-gray-400 mt-1 text-[10px]",children:["Unlocked: ",new Date(n.unlockedAt).toLocaleDateString()]}),!n.unlocked&&n.progress!==void 0&&n.progress>0&&a.jsxs("div",{className:"text-yellow-400 mt-1",children:["Progress: ",Math.round(n.progress),"%"]}),a.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1",children:a.jsx("div",{className:"w-2 h-2 bg-black transform rotate-45"})})]})})]})},F0=[{id:"first_lesson",name:"First Steps",description:"Complete your first lesson",icon:"",category:"learning",rarity:"common",criteria:n=>n.lessonsCompleted>=1},{id:"lesson_master_10",name:"Lesson Explorer",description:"Complete 10 lessons",icon:"",category:"learning",rarity:"common",criteria:n=>n.lessonsCompleted>=10},{id:"lesson_master_50",name:"Study Champion",description:"Complete 50 lessons",icon:"",category:"learning",rarity:"rare",criteria:n=>n.lessonsCompleted>=50},{id:"lesson_master_100",name:"Learning Legend",description:"Complete 100 lessons",icon:"",category:"learning",rarity:"epic",criteria:n=>n.lessonsCompleted>=100},{id:"first_correct",name:"Getting Started",description:"Answer your first question correctly",icon:"",category:"mastery",rarity:"common",criteria:n=>n.questionsAnswered>=1},{id:"question_master_50",name:"Question Whiz",description:"Answer 50 questions correctly",icon:"",category:"mastery",rarity:"common",criteria:n=>n.questionsAnswered>=50},{id:"question_master_100",name:"Answer Expert",description:"Answer 100 questions correctly",icon:"",category:"mastery",rarity:"rare",criteria:n=>n.questionsAnswered>=100},{id:"perfect_score_1",name:"Perfectionist",description:"Get your first perfect score",icon:"",category:"mastery",rarity:"common",criteria:n=>n.perfectScores>=1},{id:"perfect_score_10",name:"Quiz Wizard",description:"Get 10 perfect scores",icon:"",category:"mastery",rarity:"epic",criteria:n=>n.perfectScores>=10},{id:"flashcard_starter",name:"Flashcard Friend",description:"Review 10 flashcards",icon:"",category:"learning",rarity:"common",criteria:n=>n.flashcardsReviewed>=10},{id:"flashcard_pro",name:"Memory Master",description:"Review 100 flashcards",icon:"",category:"learning",rarity:"rare",criteria:n=>n.flashcardsReviewed>=100},{id:"flashcard_legend",name:"Flashcard Legend",description:"Review 500 flashcards",icon:"",category:"learning",rarity:"epic",criteria:n=>n.flashcardsReviewed>=500},{id:"study_time_1h",name:"Getting Started",description:"Study for 1 hour total",icon:"",category:"learning",rarity:"common",criteria:n=>n.totalStudyTime>=60},{id:"study_time_5h",name:"Time Traveler",description:"Study for 5 hours total",icon:"",category:"learning",rarity:"common",criteria:n=>n.totalStudyTime>=300},{id:"study_time_20h",name:"Dedicated Learner",description:"Study for 20 hours total",icon:"",category:"learning",rarity:"rare",criteria:n=>n.totalStudyTime>=1200},{id:"study_time_50h",name:"Scholar",description:"Study for 50 hours total",icon:"",category:"learning",rarity:"epic",criteria:n=>n.totalStudyTime>=3e3},{id:"streak_3",name:"Hat Trick",description:"Maintain a 3-day streak",icon:"",category:"streak",rarity:"common",criteria:(n,e,t)=>(t==null?void 0:t.current)>=3},{id:"streak_7",name:"Week Warrior",description:"Maintain a 7-day streak",icon:"",category:"streak",rarity:"rare",criteria:(n,e,t)=>(t==null?void 0:t.current)>=7},{id:"streak_14",name:"Fortnight Fighter",description:"Maintain a 14-day streak",icon:"",category:"streak",rarity:"rare",criteria:(n,e,t)=>(t==null?void 0:t.current)>=14},{id:"streak_30",name:"Unstoppable",description:"Maintain a 30-day streak",icon:"",category:"streak",rarity:"epic",criteria:(n,e,t)=>(t==null?void 0:t.current)>=30},{id:"streak_100",name:"Legendary Streak",description:"Maintain a 100-day streak",icon:"",category:"streak",rarity:"legendary",criteria:(n,e,t)=>(t==null?void 0:t.current)>=100},{id:"level_5",name:"Rising Star",description:"Reach Level 5",icon:"",category:"special",rarity:"common",criteria:(n,e,t,s)=>s>=5},{id:"level_10",name:"Shining Bright",description:"Reach Level 10",icon:"",category:"special",rarity:"rare",criteria:(n,e,t,s)=>s>=10},{id:"level_25",name:"Master Learner",description:"Reach Level 25",icon:"",category:"special",rarity:"epic",criteria:(n,e,t,s)=>s>=25},{id:"level_50",name:"Grand Master",description:"Reach Level 50",icon:"",category:"special",rarity:"legendary",criteria:(n,e,t,s)=>s>=50},{id:"early_bird",name:"Early Bird",description:"Study before 8 AM",icon:"",category:"special",rarity:"rare",criteria:()=>!1},{id:"night_owl",name:"Night Owl",description:"Study after 10 PM",icon:"",category:"special",rarity:"rare",criteria:()=>!1},{id:"weekend_warrior",name:"Weekend Warrior",description:"Study on Saturday and Sunday",icon:"",category:"special",rarity:"rare",criteria:()=>!1}];function uC(n,e,t,s){if(!F0.find(r=>r.id===n))return 0;switch(n){case"first_lesson":case"lesson_master_10":case"lesson_master_50":case"lesson_master_100":{const r={first_lesson:1,lesson_master_10:10,lesson_master_50:50,lesson_master_100:100};return Math.min(100,e.lessonsCompleted/r[n]*100)}case"flashcard_starter":case"flashcard_pro":case"flashcard_legend":{const r={flashcard_starter:10,flashcard_pro:100,flashcard_legend:500};return Math.min(100,e.flashcardsReviewed/r[n]*100)}case"streak_3":case"streak_7":case"streak_14":case"streak_30":case"streak_100":{const r={streak_3:3,streak_7:7,streak_14:14,streak_30:30,streak_100:100};return Math.min(100,((t==null?void 0:t.current)||0)/r[n]*100)}default:return 0}}function Kue(n){return n==="all"?F0:F0.filter(e=>e.category===n)}const Que=({limit:n=null,category:e=null,showHeader:t=!0})=>{const{badges:s,statistics:i,streak:r,currentLevel:o}=bl(),c=F0,d=e&&e!=="all"?c.filter(g=>g.category===e):c,h=new Set(s.map(g=>g.code||g.id)),u=d.map(g=>{var b,y;return{...g,unlocked:h.has(g.id),unlockedAt:((b=s.find(C=>(C.code||C.id)===g.id))==null?void 0:b.unlockedAt)||((y=s.find(C=>(C.code||C.id)===g.id))==null?void 0:y.earnedAt),progress:h.has(g.id)?void 0:uC(g.id,i,r)}}),p={legendary:0,epic:1,rare:2,common:3};u.sort((g,b)=>g.unlocked!==b.unlocked?g.unlocked?-1:1:p[g.rarity]-p[b.rarity]);const f=n?u.slice(0,n):u,m=u.filter(g=>g.unlocked).length,x=u.length;return a.jsxs("div",{className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[t&&a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"font-bold font-comic flex items-center gap-2",children:[a.jsx(K1,{className:"w-5 h-5 fill-nanobanana-yellow text-black"}),"Achievements"]}),a.jsxs("div",{className:"text-sm font-bold bg-gray-100 px-3 py-1 rounded-full border-2 border-black",children:[m,"/",x]})]}),a.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-3",children:a.jsx(Ie,{children:f.map((g,b)=>a.jsx(R.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:b*.03},children:a.jsx(Xue,{badge:g})},g.id))})}),n&&x>n&&a.jsx("div",{className:"mt-4 text-center",children:a.jsxs("span",{className:"text-sm text-nanobanana-blue font-bold",children:["+",x-n," more badges to unlock"]})})]})},Jue=({duration:n=5e3})=>{const[e,t]=N.useState({width:typeof window<"u"?window.innerWidth:800,height:typeof window<"u"?window.innerHeight:600}),[s,i]=N.useState(!0);return N.useEffect(()=>{const r=()=>{t({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",r);const o=setTimeout(()=>{i(!1)},n);return()=>{window.removeEventListener("resize",r),clearTimeout(o)}},[n]),s?a.jsx(jY,{width:e.width,height:e.height,numberOfPieces:200,recycle:!1,gravity:.3,colors:["#FFD700","#4169E1","#32CD32","#FF6B9D","#9B59B6"],style:{position:"fixed",top:0,left:0,zIndex:100}}):null},Zue=n=>`/assets/badges/${n}.png`,epe=()=>{const{pendingCelebration:n,clearCelebration:e}=bl();if(N.useEffect(()=>{if(n){const s=setTimeout(()=>{e()},5e3);return()=>clearTimeout(s)}},[n,e]),!n)return null;const t=()=>{switch(n.type){case"levelUp":return a.jsxs(a.Fragment,{children:[a.jsx(R.div,{animate:{scale:[1,1.2,1],rotate:[0,360]},transition:{duration:1,times:[0,.5,1]},className:"w-24 h-24 bg-gradient-to-br from-nanobanana-yellow to-orange-400 rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center mb-4",children:a.jsx(Cr,{className:"w-12 h-12 fill-white text-black"})}),a.jsx("h2",{className:"text-4xl font-black font-comic mb-2",children:"Level Up!"}),a.jsxs("p",{className:"text-xl font-bold text-gray-700 mb-2",children:["You're now Level ",n.level,"!"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["+",n.xpEarned," XP earned"]})]});case"badge":{const s=n.badge.code||n.badge.id,i=Zue(s);return a.jsxs(a.Fragment,{children:[a.jsx(R.div,{animate:{scale:[0,1.2,1],rotate:[0,180,360]},transition:{duration:.8},className:`
                                w-28 h-28 rounded-2xl border-4 overflow-hidden
                                ${n.badge.rarity==="legendary"?"border-yellow-500 shadow-[0_0_25px_rgba(245,158,11,0.7)]":n.badge.rarity==="epic"?"border-purple-500 shadow-[0_0_20px_rgba(139,92,246,0.6)]":n.badge.rarity==="rare"?"border-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.5)]":"border-gray-500"}
                                shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
                                flex items-center justify-center mb-4
                            `,children:a.jsx("img",{src:i,alt:n.badge.name,className:"w-full h-full object-cover",onError:r=>{r.target.style.display="none",r.target.parentElement.innerHTML=`<span class="text-5xl">${n.badge.icon||""}</span>`}})}),a.jsx("h2",{className:"text-4xl font-black font-comic mb-2",children:"New Badge!"}),a.jsx("p",{className:"text-xl font-bold text-gray-700 mb-2",children:n.badge.name}),a.jsx("p",{className:"text-sm text-gray-600",children:n.badge.description})]})}case"streakMilestone":return a.jsxs(a.Fragment,{children:[a.jsx(R.div,{animate:{scale:[1,1.2,1],rotate:[0,10,-10,0]},transition:{duration:1,repeat:2},className:"w-24 h-24 bg-gradient-to-br from-orange-400 to-red-500 rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center mb-4",children:a.jsx(uP,{className:"w-12 h-12 fill-white text-orange-600"})}),a.jsx("h2",{className:"text-4xl font-black font-comic mb-2",children:"Amazing Streak!"}),a.jsxs("p",{className:"text-xl font-bold text-gray-700 mb-2",children:[n.streak," days in a row!"]}),a.jsx("p",{className:"text-sm text-gray-600",children:"You're unstoppable! Keep it up!"})]});case"dailyChallenge":return a.jsxs(a.Fragment,{children:[a.jsx(R.div,{animate:{scale:[1,1.1,1]},transition:{duration:.5,repeat:3},className:"w-24 h-24 bg-gradient-to-br from-nanobanana-green to-green-600 rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center mb-4",children:a.jsx(Yae,{className:"w-12 h-12 text-white"})}),a.jsx("h2",{className:"text-4xl font-black font-comic mb-2",children:"Challenge Complete!"}),a.jsx("p",{className:"text-xl font-bold text-gray-700 mb-2",children:"Daily Goal Achieved!"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["+",n.xpReward," XP bonus earned!"]})]});case"bigXP":return a.jsxs(a.Fragment,{children:[a.jsx(R.div,{animate:{scale:[1,1.15,1]},transition:{duration:.6,repeat:2},className:"w-24 h-24 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-center mb-4",children:a.jsx(K1,{className:"w-12 h-12 text-white"})}),a.jsx("h2",{className:"text-4xl font-black font-comic mb-2",children:"Awesome Work!"}),a.jsxs("p",{className:"text-xl font-bold text-gray-700 mb-2",children:["+",n.xpEarned," XP!"]}),a.jsx("p",{className:"text-sm text-gray-600",children:n.reason})]});default:return null}};return a.jsx(Ie,{children:n&&a.jsxs(a.Fragment,{children:[a.jsx(Jue,{}),a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e,children:a.jsxs(R.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{type:"spring",damping:15,stiffness:200},onClick:s=>s.stopPropagation(),className:"bg-white rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] p-8 max-w-md w-full text-center relative",children:[a.jsx("button",{onClick:e,className:"absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-full transition-colors",children:a.jsx(on,{className:"w-5 h-5"})}),t(),a.jsx(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:e,className:"mt-6 px-8 py-3 bg-nanobanana-green text-white font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none transition-all",children:"Awesome! Let's Continue"})]})})]})})},YT=({compact:n=!1})=>{const{dailyChallenge:e}=bl();if(!e)return null;const t=e.progress/e.challenge.target*100,s=e.completed;if(n){const i=s?`Completed! +${e.xpReward} XP earned`:`${e.challenge.description} (${e.xpReward} XP reward)`;return a.jsx(yP,{title:"Daily Challenge",content:i,position:"bottom",children:a.jsxs("div",{className:`
                    flex items-center gap-2 px-3 py-2 rounded-full border-2 cursor-default
                    ${s?"bg-green-50 border-green-500":"bg-white border-black"}
                `,children:[s?a.jsx(kd,{className:"w-5 h-5 text-green-500"}):a.jsx(hm,{className:"w-5 h-5 text-nanobanana-blue"}),a.jsx("span",{className:"text-xs font-bold",children:s?"Done!":`${e.progress}/${e.challenge.target}`})]})})}return a.jsxs("div",{className:`
            bg-white p-4 rounded-2xl border-4 border-black
            shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]
            ${s&&"bg-green-50 border-green-500"}
        `,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("h3",{className:"font-bold font-comic flex items-center gap-2",children:[a.jsx(hm,{className:"w-5 h-5 text-nanobanana-blue"}),"Daily Challenge"]}),a.jsxs("div",{className:"flex items-center gap-1 text-xs bg-yellow-50 px-2 py-1 rounded-full border-2 border-yellow-300",children:[a.jsx(Pd,{className:"w-3 h-3 text-yellow-700"}),a.jsx("span",{className:"font-bold text-yellow-700",children:"Today"})]})]}),a.jsx("div",{className:"mb-3",children:a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-2xl",children:e.challenge.icon}),a.jsx("p",{className:"font-medium text-gray-700",children:e.challenge.description})]})}),a.jsxs("div",{className:"mb-3",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[a.jsxs("span",{className:"font-bold text-gray-700",children:[e.progress," / ",e.challenge.target]}),a.jsxs("span",{className:"font-bold text-nanobanana-blue",children:[Math.round(t),"%"]})]}),a.jsx("div",{className:"h-3 bg-gray-200 rounded-full border-2 border-black overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${Math.min(t,100)}%`},transition:{duration:.5},className:`h-full ${s?"bg-gradient-to-r from-green-400 to-green-600":"bg-gradient-to-r from-nanobanana-blue to-blue-600"}`})})]}),a.jsx("div",{className:`
                p-2 rounded-xl border-2 text-center
                ${s?"bg-green-100 border-green-300":"bg-yellow-50 border-yellow-200"}
            `,children:s?a.jsxs("p",{className:"text-sm font-bold text-green-700",children:["Challenge Complete! +",e.xpReward," XP earned!"]}):a.jsxs("p",{className:"text-sm font-bold text-yellow-700",children:["Reward: ",e.xpReward," XP"]})})]})},tpe=({layout:n="horizontal"})=>n==="compact"?a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx(WT,{compact:!0}),a.jsx(qT,{compact:!0}),a.jsx(YT,{compact:!0})]}):n==="vertical"?a.jsxs("div",{className:"space-y-3",children:[a.jsx(WT,{}),a.jsx(qT,{}),a.jsx(YT,{})]}):a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(WT,{}),a.jsx(qT,{}),a.jsx(YT,{})]}),Fr=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),z4=[.001,0,0,.001,0,0],PR=1.35,ao={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},bd={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},DN="pdfjs_internal_editor_",et={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Nt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},EY={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ei={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},QC={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},jn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Ty={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},_E={ERRORS:0,WARNINGS:1,INFOS:5},F1={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Lk={moveTo:0,lineTo:1,curveTo:2,closePath:3},kY={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let tD=_E.WARNINGS;function spe(n){Number.isInteger(n)&&(tD=n)}function npe(){return tD}function sD(n){tD>=_E.INFOS&&console.info(`Info: ${n}`)}function st(n){tD>=_E.WARNINGS&&console.warn(`Warning: ${n}`)}function Ns(n){throw new Error(n)}function Et(n,e){n||Ns(e)}function ipe(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function S3(n,e=null,t=null){if(!n)return null;if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=cpe(n)}catch{}}const s=e?URL.parse(n,e):URL.parse(n);return ipe(s)?s:null}function C3(n,e,t=!1){const s=URL.parse(n);return s?(s.hash=e,s.href):t&&S3(n,"http://example.com")?n.split("#",1)[0]+`${e?`#${e}`:""}`:""}function ct(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const ay=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class sz extends ay{constructor(e,t){super(e,"PasswordException"),this.code=t}}class LR extends ay{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class bP extends ay{constructor(e){super(e,"InvalidPDFException")}}class RN extends ay{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class rpe extends ay{constructor(e){super(e,"FormatError")}}class Mu extends ay{constructor(e){super(e,"AbortException")}}function TY(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Ns("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function PE(n){typeof n!="string"&&Ns("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function ape(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function ope(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function lpe(){try{return new Function(""),!0}catch{return!1}}class wi{static get isLittleEndian(){return ct(this,"isLittleEndian",ope())}static get isEvalSupported(){return ct(this,"isEvalSupported",lpe())}static get isOffscreenCanvasSupported(){return ct(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ct(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return ct(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return ct(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const DR=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Eu,XT,H4;class Ce{static makeHexColor(e,t,s){return`#${DR[e]}${DR[t]}${DR[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const i=e[s],r=e[s+1];e[s]=i*t[0]+r*t[2]+t[4],e[s+1]=i*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],r=t[1],o=t[2],c=t[3],d=t[4],h=t[5];for(let u=0;u<6;u+=2){const p=e[s+u],f=e[s+u+1];e[s+u]=p*i+f*o+d,e[s+u+1]=p*r+f*c+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,s){const i=t[0],r=t[1],o=t[2],c=t[3],d=t[4],h=t[5],u=e[0],p=e[1],f=e[2],m=e[3];let x=i*u+d,g=x,b=i*f+d,y=b,C=c*p+h,w=C,S=c*m+h,j=S;if(r!==0||o!==0){const T=r*u,k=r*f,_=o*p,L=o*m;x+=_,y+=_,b+=L,g+=L,C+=T,j+=T,S+=k,w+=k}s[0]=Math.min(s[0],x,b,g,y),s[1]=Math.min(s[1],C,S,w,j),s[2]=Math.max(s[2],x,b,g,y),s[3]=Math.max(s[3],C,S,w,j)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],r=e[2],o=e[3],c=s**2+i**2,d=s*r+i*o,h=r**2+o**2,u=(c+h)/2,p=Math.sqrt(u**2-(c*h-d**2));t[0]=Math.sqrt(u+p||1),t[1]=Math.sqrt(u-p||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[s,r,i,o]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,r){r[0]=Math.min(r[0],e,s),r[1]=Math.min(r[1],t,i),r[2]=Math.max(r[2],e,s),r[3]=Math.max(r[3],t,i)}static bezierBoundingBox(e,t,s,i,r,o,c,d,h){h[0]=Math.min(h[0],e,c),h[1]=Math.min(h[1],t,d),h[2]=Math.max(h[2],e,c),h[3]=Math.max(h[3],t,d),E(this,Eu,H4).call(this,e,s,r,c,t,i,o,d,3*(-e+3*(s-r)+c),6*(e-2*s+r),3*(s-e),h),E(this,Eu,H4).call(this,e,s,r,c,t,i,o,d,3*(-t+3*(i-o)+d),6*(t-2*i+o),3*(i-t),h)}}Eu=new WeakSet,XT=function(e,t,s,i,r,o,c,d,h,u){if(h<=0||h>=1)return;const p=1-h,f=h*h,m=f*h,x=p*(p*(p*e+3*h*t)+3*f*s)+m*i,g=p*(p*(p*r+3*h*o)+3*f*c)+m*d;u[0]=Math.min(u[0],x),u[1]=Math.min(u[1],g),u[2]=Math.max(u[2],x),u[3]=Math.max(u[3],g)},H4=function(e,t,s,i,r,o,c,d,h,u,p,f){if(Math.abs(h)<1e-12){Math.abs(u)>=1e-12&&E(this,Eu,XT).call(this,e,t,s,i,r,o,c,d,-p/u,f);return}const m=u**2-4*p*h;if(m<0)return;const x=Math.sqrt(m),g=2*h;E(this,Eu,XT).call(this,e,t,s,i,r,o,c,d,(-u+x)/g,f),E(this,Eu,XT).call(this,e,t,s,i,r,o,c,d,(-u-x)/g,f)},A(Ce,Eu);function cpe(n){return decodeURIComponent(escape(n))}let RR=null,nz=null;function _Y(n){return RR||(RR=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,nz=new Map([["","t"]])),n.replaceAll(RR,(e,t,s)=>t?t.normalize("NFKC"):nz.get(s))}function N3(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),TY(n)}const j3="pdfjs_internal_id_";function dpe(n,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...r]=t;if(!n(s)&&!Number.isInteger(s)||!e(i))return!1;const o=r.length;let c=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;c=!1;break;default:return!1}for(const d of r)if(!(typeof d=="number"||c&&d===null))return!1;return!0}function gr(n,e,t){return Math.min(Math.max(n,e),t)}function PY(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(TY(n))}function hpe(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):PE(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((e,t)=>e+t,0)});class IN{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var d;if(!r)return;let o=null;const c=r.name;if(c==="#text")o=r.value;else if(IN.shouldBuildText(c))(d=r==null?void 0:r.attributes)!=null&&d.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const h of r.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class A3{static setupStorage(e,t,s,i,r){const o=i.getValue(t,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",c=>{i.setValue(t,{value:c.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?e.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",c=>{i.setValue(t,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",c=>{i.setValue(t,{value:c.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const c of s.children)c.attributes.value===o.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}e.addEventListener("input",c=>{const d=c.target.options,h=d.selectedIndex===-1?"":d[d.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:o}=t,c=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[d,h]of Object.entries(o))if(h!=null)switch(d){case"class":h.length&&e.setAttribute(d,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!c||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,h)}c&&r.addLinkAttributes(e,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(e,o.dataId,t,s)}static render(e){var p,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const c=r!=="richText",d=e.div;if(d.append(o),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=m}c&&d.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const m=document.createTextNode(i.value);o.append(m),c&&IN.shouldBuildText(i.name)&&h.push(m)}return{textDivs:h}}const u=[[i,-1,o]];for(;u.length>0;){const[m,x,g]=u.at(-1);if(x+1===m.children.length){u.pop();continue}const b=m.children[++u.at(-1)[1]];if(b===null)continue;const{name:y}=b;if(y==="#text"){const w=document.createTextNode(b.value);h.push(w),g.append(w);continue}const C=(p=b==null?void 0:b.attributes)!=null&&p.xmlns?document.createElementNS(b.attributes.xmlns,y):document.createElement(y);if(g.append(C),b.attributes&&this.setAttributes({html:C,element:b,storage:t,intent:r,linkService:s}),((f=b.children)==null?void 0:f.length)>0)u.push([b,-1,C]);else if(b.value){const w=document.createTextNode(b.value);c&&IN.shouldBuildText(y)&&h.push(w),C.append(w)}}for(const m of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Wd="http://www.w3.org/2000/svg",Xm=class Xm{};W(Xm,"CSS",96),W(Xm,"PDF",72),W(Xm,"PDF_TO_CSS_UNITS",Xm.CSS/Xm.PDF);let Fu=Xm;async function Q1(n,e="text"){if(pC(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class LE{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:c=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=o,s*=t;const d=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let u,p,f,m;switch(i%=360,i<0&&(i+=360),i){case 180:u=-1,p=0,f=0,m=1;break;case 90:u=0,p=1,f=1,m=0;break;case 270:u=0,p=-1,f=-1,m=0;break;case 0:u=1,p=0,f=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(f=-f,m=-m);let x,g,b,y;u===0?(x=Math.abs(h-e[1])*s+r,g=Math.abs(d-e[0])*s+o,b=(e[3]-e[1])*s,y=(e[2]-e[0])*s):(x=Math.abs(d-e[0])*s+r,g=Math.abs(h-e[1])*s+o,b=(e[2]-e[0])*s,y=(e[3]-e[1])*s),this.transform=[u*s,p*s,f*s,m*s,x-u*s*d-f*s*h,g-p*s*d-m*s*h],this.width=b,this.height=y}get rawDims(){const e=this.viewBox;return ct(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new LE({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){const s=[e,t];return Ce.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];Ce.applyTransform(t,this.transform);const s=[e[2],e[3]];return Ce.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return Ce.applyInverseTransform(s,this.transform),s}}class nD extends ay{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function DE(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function iD(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function LY(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function DY(n,e="document.pdf"){if(typeof n!="string")return e;if(DE(n))return st('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(c=>{try{return new URL(c)}catch{try{return new URL(decodeURIComponent(c))}catch{try{return new URL(c,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(c),"https://foo.bar")}catch{return null}}}}})(n);if(!s)return e;const i=c=>{try{let d=decodeURIComponent(c);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:c):d}catch{return c}},r=/\.pdf$/i,o=s.pathname.split("/").at(-1);if(r.test(o))return i(o);if(s.searchParams.size>0){const c=Array.from(s.searchParams.values()).reverse();for(const h of c)if(r.test(h))return i(h);const d=Array.from(s.searchParams.keys()).reverse();for(const h of d)if(r.test(h))return i(h)}if(s.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(d)return i(d[0])}return e}class iz{constructor(){W(this,"started",Object.create(null));W(this,"times",[])}time(e){e in this.started&&st(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||st(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function pC(n,e){const t=e?URL.parse(n,e):URL.parse(n);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function jo(n){n.preventDefault()}function tn(n){n.preventDefault(),n.stopPropagation()}function upe(n){console.log("Deprecated API usage: "+n)}var _2;class MN{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;l(this,_2)||v(this,_2,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=l(this,_2).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let c=parseInt(t[5],10);c=c>=0&&c<=59?c:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const h=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let p=parseInt(t[9],10)||0;return p=p>=0&&p<=59?p:0,h==="-"?(o+=u,c+=p):h==="+"&&(o-=u,c-=p),new Date(Date.UTC(s,i,r,o,c,d))}}_2=new WeakMap,A(MN,_2);function RY(n,{scale:e=1,rotation:t=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new LE({viewBox:r,userUnit:1,scale:e,rotation:t})}function J1(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(st(`Not a valid color format: "${n}"`),[0,0,0])}function ppe(n){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,J1(s))}e.remove()}function Js(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform();return[e,t,s,i,r,o]}function bc(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[e,t,s,i,r,o]}function fm(n,e,t=!1,s=!0){if(e instanceof LE){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=n,c=wi.isCSSRoundSupported,d=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${r}px`,u=c?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,p=c?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(o.width=u,o.height=p):(o.width=p,o.height=u)}s&&n.setAttribute("data-main-rotation",e.rotation)}class cc{constructor(){const{pixelRatio:e}=cc;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,r=-1){let o=1/0,c=1/0,d=1/0;s=cc.capPixels(s,r),s>0&&(o=Math.sqrt(s/(e*t))),i!==-1&&(c=i/e,d=i/t);const h=Math.min(o,c,d);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const vP=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class fpe{static get isDarkMode(){var e;return ct(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class IY{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),ct(this,"commentForegroundColor",J1(s))}}function MY(n,e,t,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return n=Math.round(n*s+i),e=Math.round(e*s+i),t=Math.round(t*s+i),[n,e,t]}function rz(n,e){const t=n[0]/255,s=n[1]/255,i=n[2]/255,r=Math.max(t,s,i),o=Math.min(t,s,i),c=(r+o)/2;if(r===o)e[0]=e[1]=0;else{const d=r-o;switch(e[1]=c<.5?d/(r+o):d/(2-r-o),r){case t:e[0]=((s-i)/d+(s<i?6:0))*60;break;case s:e[0]=((i-t)/d+2)*60;break;case i:e[0]=((t-s)/d+4)*60;break}}e[2]=c}function V4(n,e){const t=n[0],s=n[1],i=n[2],r=(1-Math.abs(2*i-1))*s,o=r*(1-Math.abs(t/60%2-1)),c=i-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+c,e[1]=o+c,e[2]=c;break;case 1:e[0]=o+c,e[1]=r+c,e[2]=c;break;case 2:e[0]=c,e[1]=r+c,e[2]=o+c;break;case 3:e[0]=c,e[1]=o+c,e[2]=r+c;break;case 4:e[0]=o+c,e[1]=c,e[2]=r+c;break;case 5:case 6:e[0]=r+c,e[1]=c,e[2]=o+c;break}}function az(n){return n<=.03928?n/12.92:((n+.055)/1.055)**2.4}function oz(n,e,t){V4(n,t),t.map(az);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];V4(e,t),t.map(az);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const lz=new Map;function FY(n,e){const t=n[0]+n[1]*256+n[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=lz.get(t);if(s)return s;const i=new Float32Array(9),r=i.subarray(0,3),o=i.subarray(3,6);rz(n,o);const c=i.subarray(6,9);rz(e,c);const d=c[2]<.5,h=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),oz(o,c,r)<h){let u,p;d?(u=o[2],p=1):(u=0,p=o[2]);const f=.005;for(;p-u>f;){const m=o[2]=(u+p)/2;d===oz(o,c,r)<h?u=m:p=m}o[2]=d?p:u}return V4(o,r),s=Ce.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),lz.set(t,s),s}function E3({html:n,dir:e,className:t},s){const i=document.createDocumentFragment();if(typeof n=="string"){const r=document.createElement("p");r.dir=e||"auto";const o=n.split(/(?:\r\n?|\n)/);for(let c=0,d=o.length;c<d;++c){const h=o[c];r.append(document.createTextNode(h)),c<d-1&&r.append(document.createElement("br"))}i.append(r)}else A3.render({xfaHtml:n,div:i,intent:"richText"});i.firstChild.classList.add("richText",t),s.append(i)}var Zp,ef,Wo,qo,P2,tf,Yv,Xv,L2,qP,OY,Wi,BY,$Y,_y,fC;const Kd=class Kd{constructor(e){A(this,Wi);A(this,Zp,null);A(this,ef,null);A(this,Wo);A(this,qo,null);A(this,P2,null);A(this,tf,null);A(this,Yv,null);A(this,Xv,null);v(this,Wo,e),l(Kd,L2)||v(Kd,L2,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=v(this,Zp,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=l(this,Wo)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",jo,{signal:t}),e.addEventListener("pointerdown",E(Kd,qP,OY),{signal:t}));const s=v(this,qo,document.createElement("div"));s.className="buttons",e.append(s);const i=l(this,Wo).toolbarPosition;if(i){const{style:r}=e,o=l(this,Wo)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return l(this,Zp)}hide(){var e;l(this,Zp).classList.add("hidden"),(e=l(this,ef))==null||e.hideDropdown()}show(){var e,t;l(this,Zp).classList.remove("hidden"),(e=l(this,P2))==null||e.shown(),(t=l(this,tf))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=l(this,Wo),s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",l(Kd,L2)[e]),E(this,Wi,_y).call(this,s)&&s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),l(this,qo).append(s)}async addAltText(e){const t=await e.render();E(this,Wi,_y).call(this,t),l(this,qo).append(t,l(this,Wi,fC)),v(this,P2,e)}addComment(e,t=null){if(l(this,tf))return;const s=e.renderForToolbar();if(!s)return;E(this,Wi,_y).call(this,s);const i=v(this,Yv,l(this,Wi,fC));t?(l(this,qo).insertBefore(s,t),l(this,qo).insertBefore(i,t)):l(this,qo).append(s,i),v(this,tf,e),e.toolbar=this}addColorPicker(e){if(l(this,ef))return;v(this,ef,e);const t=e.renderButton();E(this,Wi,_y).call(this,t),l(this,qo).append(t,l(this,Wi,fC))}async addEditSignatureButton(e){const t=v(this,Xv,await e.renderEditButton(l(this,Wo)));E(this,Wi,_y).call(this,t),l(this,qo).append(t,l(this,Wi,fC))}removeButton(e){var t,s;switch(e){case"comment":(t=l(this,tf))==null||t.removeToolbarCommentButton(),v(this,tf,null),(s=l(this,Yv))==null||s.remove(),v(this,Yv,null);break}}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(t);break}}async addButtonBefore(e,t,s){const i=l(this,qo).querySelector(s);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){l(this,Xv)&&(l(this,Xv).title=e)}remove(){var e;l(this,Zp).remove(),(e=l(this,ef))==null||e.destroy(),v(this,ef,null)}};Zp=new WeakMap,ef=new WeakMap,Wo=new WeakMap,qo=new WeakMap,P2=new WeakMap,tf=new WeakMap,Yv=new WeakMap,Xv=new WeakMap,L2=new WeakMap,qP=new WeakSet,OY=function(e){e.stopPropagation()},Wi=new WeakSet,BY=function(e){l(this,Wo)._focusEventsAllowed=!1,tn(e)},$Y=function(e){l(this,Wo)._focusEventsAllowed=!0,tn(e)},_y=function(e){const t=l(this,Wo)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",E(this,Wi,BY).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",E(this,Wi,$Y).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",jo,{signal:t}),!0)},fC=function(){const e=document.createElement("div");return e.className="divider",e},A(Kd,qP),A(Kd,L2,null);let G4=Kd;var D2,wx,Rh,$u,UY,zY,W4;class mpe{constructor(e){A(this,$u);A(this,D2,null);A(this,wx,null);A(this,Rh);v(this,Rh,e)}show(e,t,s){const[i,r]=E(this,$u,zY).call(this,t,s),{style:o}=l(this,wx)||v(this,wx,E(this,$u,UY).call(this));e.append(l(this,wx)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,wx).remove()}}D2=new WeakMap,wx=new WeakMap,Rh=new WeakMap,$u=new WeakSet,UY=function(){const e=v(this,wx,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=l(this,Rh)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",jo,{signal:t});const s=v(this,D2,document.createElement("div"));return s.className="buttons",e.append(s),l(this,Rh).hasCommentManager()&&E(this,$u,W4).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{l(this,Rh).commentSelection("floating_button")}),E(this,$u,W4).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{l(this,Rh).highlightSelection("floating_button")}),e},zY=function(e,t){let s=0,i=0;for(const r of e){const o=r.y+r.height;if(o<s)continue;const c=r.x+(t?r.width:0);if(o>s){i=c,s=o;continue}t?c>i&&(i=c):c<i&&(i=c)}return[t?1-i:i,s]},W4=function(e,t,s,i){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",s);const c=l(this,Rh)._signal;c instanceof AbortSignal&&!c.aborted&&(r.addEventListener("contextmenu",jo,{signal:c}),r.addEventListener("click",i,{signal:c})),l(this,D2).append(r)};function HY(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var YP;class gpe{constructor(){A(this,YP,0)}get id(){return`${DN}${vt(this,YP)._++}`}}YP=new WeakMap;var Kv,R2,cr,Qv,KT;const $3=class $3{constructor(){A(this,Qv);A(this,Kv,N3());A(this,R2,0);A(this,cr,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return ct(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return E(this,Qv,KT).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return E(this,Qv,KT).call(this,e,e)}async getFromBlob(e,t){const s=await t;return E(this,Qv,KT).call(this,e,s)}async getFromId(e){l(this,cr)||v(this,cr,new Map);const t=l(this,cr).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){l(this,cr)||v(this,cr,new Map);let s=l(this,cr).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${l(this,Kv)}_${vt(this,R2)._++}`,refCounter:1,isSvg:!1},l(this,cr).set(e,s),l(this,cr).set(s.id,s),s}getSvgUrl(e){const t=l(this,cr).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;l(this,cr)||v(this,cr,new Map);const t=l(this,cr).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${l(this,Kv)}_`)}};Kv=new WeakMap,R2=new WeakMap,cr=new WeakMap,Qv=new WeakSet,KT=async function(e,t){l(this,cr)||v(this,cr,new Map);let s=l(this,cr).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${l(this,Kv)}_${vt(this,R2)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await Q1(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=$3._isSVGFittingCanvas,o=new FileReader,c=new Image,d=new Promise((h,u)=>{c.onload=()=>{s.bitmap=c,s.isSvg=!0,h()},o.onload=async()=>{const p=s.svgUrl=o.result;c.src=await r?`${p}#svgView(preserveAspectRatio(none))`:p},c.onerror=o.onerror=u});o.readAsDataURL(i),await d}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){st(i),s=null}return l(this,cr).set(e,s),s&&l(this,cr).set(s.id,s),s};let q4=$3;var kn,sf,I2,Ks;class xpe{constructor(e=128){A(this,kn,[]);A(this,sf,!1);A(this,I2);A(this,Ks,-1);v(this,I2,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:c=!1}){if(i&&e(),l(this,sf))return;const d={cmd:e,undo:t,post:s,type:r};if(l(this,Ks)===-1){l(this,kn).length>0&&(l(this,kn).length=0),v(this,Ks,0),l(this,kn).push(d);return}if(o&&l(this,kn)[l(this,Ks)].type===r){c&&(d.undo=l(this,kn)[l(this,Ks)].undo),l(this,kn)[l(this,Ks)]=d;return}const h=l(this,Ks)+1;h===l(this,I2)?l(this,kn).splice(0,1):(v(this,Ks,h),h<l(this,kn).length&&l(this,kn).splice(h)),l(this,kn).push(d)}undo(){if(l(this,Ks)===-1)return;v(this,sf,!0);const{undo:e,post:t}=l(this,kn)[l(this,Ks)];e(),t==null||t(),v(this,sf,!1),v(this,Ks,l(this,Ks)-1)}redo(){if(l(this,Ks)<l(this,kn).length-1){v(this,Ks,l(this,Ks)+1),v(this,sf,!0);const{cmd:e,post:t}=l(this,kn)[l(this,Ks)];e(),t==null||t(),v(this,sf,!1)}}hasSomethingToUndo(){return l(this,Ks)!==-1}hasSomethingToRedo(){return l(this,Ks)<l(this,kn).length-1}cleanType(e){if(l(this,Ks)!==-1){for(let t=l(this,Ks);t>=0;t--)if(l(this,kn)[t].type!==e){l(this,kn).splice(t+1,l(this,Ks)-t),v(this,Ks,t);return}l(this,kn).length=0,v(this,Ks,-1)}}destroy(){v(this,kn,null)}}kn=new WeakMap,sf=new WeakMap,I2=new WeakMap,Ks=new WeakMap;var XP,VY;class RE{constructor(e){A(this,XP);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=wi.platform;for(const[s,i,r={}]of e)for(const o of s){const c=o.startsWith("mac+");t&&c?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!c&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(E(this,XP,VY).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:c=null}}=s;c&&!c(e,t)||(i.bind(e,...o,t)(),r||tn(t))}}XP=new WeakSet,VY=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const KP=class KP{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return ppe(e),ct(this,"_colors",e)}convert(e){const t=J1(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,o)=>r===t[o]))return KP._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?Ce.makeHexColor(...t):e}};W(KP,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Y4=KP;var Jv,za,Zv,un,Qn,ew,Yo,tw,Xo,dr,nf,rf,sw,af,qc,Ko,Sx,M2,F2,nw,O2,Yc,of,iw,lf,Xc,QP,cf,rw,B2,df,Cx,aw,hf,$2,Hn,qt,Ih,uf,pf,U2,ow,z2,ff,Kc,Mh,H2,V2,Qo,me,QT,X4,GY,WY,mC,qY,YY,XY,K4,KY,Q4,J4,QY,Ar,qd,JY,ZY,Z4,eX,gC,eF;const nb=class nb{constructor(e,t,s,i,r,o,c,d,h,u,p,f,m,x,g,b){A(this,me);A(this,Jv,new AbortController);A(this,za,null);A(this,Zv,null);A(this,un,new Map);A(this,Qn,new Map);A(this,ew,null);A(this,Yo,null);A(this,tw,null);A(this,Xo,new xpe);A(this,dr,null);A(this,nf,null);A(this,rf,null);A(this,sw,0);A(this,af,new Set);A(this,qc,null);A(this,Ko,null);A(this,Sx,new Set);W(this,"_editorUndoBar",null);A(this,M2,!1);A(this,F2,!1);A(this,nw,!1);A(this,O2,null);A(this,Yc,null);A(this,of,null);A(this,iw,null);A(this,lf,!1);A(this,Xc,null);A(this,QP,new gpe);A(this,cf,!1);A(this,rw,!1);A(this,B2,!1);A(this,df,null);A(this,Cx,null);A(this,aw,null);A(this,hf,null);A(this,$2,null);A(this,Hn,et.NONE);A(this,qt,new Set);A(this,Ih,null);A(this,uf,null);A(this,pf,null);A(this,U2,null);A(this,ow,null);A(this,z2,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});A(this,ff,[0,0]);A(this,Kc,null);A(this,Mh,null);A(this,H2,null);A(this,V2,null);A(this,Qo,null);const y=this._signal=l(this,Jv).signal;v(this,Mh,e),v(this,H2,t),v(this,V2,s),v(this,ew,i),v(this,dr,r),v(this,uf,o),v(this,ow,d),this._eventBus=c,c._on("editingaction",this.onEditingAction.bind(this),{signal:y}),c._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),c._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),c._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),c._on("setpreference",this.onSetPreference.bind(this),{signal:y}),c._on("switchannotationeditorparams",C=>this.updateParams(C.type,C.value),{signal:y}),window.addEventListener("pointerdown",()=>{v(this,rw,!0)},{capture:!0,signal:y}),window.addEventListener("pointerup",()=>{v(this,rw,!1)},{capture:!0,signal:y}),E(this,me,qY).call(this),E(this,me,QY).call(this),E(this,me,K4).call(this),v(this,Yo,d.annotationStorage),v(this,O2,d.filterFactory),v(this,pf,h),v(this,iw,u||null),v(this,M2,p),v(this,F2,f),v(this,nw,m),v(this,$2,x||null),this.viewParameters={realScale:Fu.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=b!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=nb.prototype,t=o=>l(o,Mh).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:c})=>{if(c instanceof HTMLInputElement){const{type:d}=c;return d!=="text"&&d!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ct(this,"_keyboardManager",new RE([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&l(o,Mh).contains(c)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&l(o,Mh).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r,o,c,d,h;(e=l(this,Qo))==null||e.resolve(),v(this,Qo,null),(t=l(this,Jv))==null||t.abort(),v(this,Jv,null),this._signal=null;for(const u of l(this,Qn).values())u.destroy();l(this,Qn).clear(),l(this,un).clear(),l(this,Sx).clear(),(s=l(this,hf))==null||s.clear(),v(this,za,null),l(this,qt).clear(),l(this,Xo).destroy(),(i=l(this,ew))==null||i.destroy(),(r=l(this,dr))==null||r.destroy(),(o=l(this,uf))==null||o.destroy(),(c=l(this,Xc))==null||c.hide(),v(this,Xc,null),(d=l(this,aw))==null||d.destroy(),v(this,aw,null),v(this,Zv,null),l(this,Yc)&&(clearTimeout(l(this,Yc)),v(this,Yc,null)),l(this,Kc)&&(clearTimeout(l(this,Kc)),v(this,Kc,null)),(h=this._editorUndoBar)==null||h.destroy(),v(this,ow,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return l(this,$2)}get useNewAltTextFlow(){return l(this,F2)}get useNewAltTextWhenAddingImage(){return l(this,nw)}get hcmFilter(){return ct(this,"hcmFilter",l(this,pf)?l(this,O2).addHCMFilter(l(this,pf).foreground,l(this,pf).background):"none")}get direction(){return ct(this,"direction",getComputedStyle(l(this,Mh)).direction)}get _highlightColors(){return ct(this,"_highlightColors",l(this,iw)?new Map(l(this,iw).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return ct(this,"highlightColors",null);const t=new Map,s=!!l(this,pf);for(const[i,r]of e){const o=i.endsWith("_HCM");if(s&&o){t.set(i.replace("_HCM",""),r);continue}!s&&!o&&t.set(i,r)}return ct(this,"highlightColors",t)}get highlightColorNames(){return ct(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),v(this,rf,e)}setMainHighlightColorPicker(e){v(this,aw,e)}editAltText(e,t=!1){var s;(s=l(this,ew))==null||s.editAltText(this,e,t)}hasCommentManager(){return!!l(this,dr)}editComment(e,t,s,i){var r;(r=l(this,dr))==null||r.showDialog(this,e,t,s,i)}selectComment(e,t){const s=l(this,Qn).get(e),i=s==null?void 0:s.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=l(this,dr))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=l(this,dr))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=l(this,dr))==null||t.removeComments([e.uid])}toggleComment(e,t,s=void 0){var i;(i=l(this,dr))==null||i.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){var s;return e&&((s=l(this,dr))==null?void 0:s.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=l(this,dr))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(l(this,Qn).has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),i=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await s}getSignature(e){var t;(t=l(this,uf))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return l(this,uf)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":v(this,nw,t);break}}onPageChanging({pageNumber:e}){v(this,sw,e-1)}focusMainContainer(){l(this,Mh).focus()}findParent(e,t){for(const s of l(this,Qn).values()){const{x:i,y:r,width:o,height:c}=s.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+c)return s}return null}disableUserSelect(e=!1){l(this,H2).classList.toggle("noUserSelect",e)}addShouldRescale(e){l(this,Sx).add(e)}removeShouldRescale(e){l(this,Sx).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Fu.PDF_TO_CSS_UNITS;for(const s of l(this,Sx))s.onScaleChanging();(t=l(this,rf))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:c}=s,d=s.toString(),u=E(this,me,QT).call(this,s).closest(".textLayer"),p=this.getSelectionBoxes(u);if(!p)return;s.empty();const f=E(this,me,X4).call(this,u),m=l(this,Hn)===et.NONE,x=()=>{const g=f==null?void 0:f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:p,anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:c,text:d});m&&this.showAllEditors("highlight",!0,!0),t&&(g==null||g.editComment())};if(m){this.switchToMode(et.HIGHLIGHT,x);return}x()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!l(this,Yo))return null;const t=`${DN}${e}`,s=l(this,Yo).getRawValue(t);return s&&l(this,Yo).remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&l(this,Yo)&&!l(this,Yo).has(e.id)&&l(this,Yo).setValue(e.id,e)}a11yAlert(e,t=null){const s=l(this,V2);s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,l(this,lf)&&(v(this,lf,!1),E(this,me,mC).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of l(this,qt))if(t.div.contains(e)){v(this,Cx,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!l(this,Cx))return;const[e,t]=l(this,Cx);v(this,Cx,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){E(this,me,K4).call(this),E(this,me,Q4).call(this)}removeEditListeners(){E(this,me,KY).call(this),E(this,me,J4).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of l(this,Ko))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of l(this,Ko))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=l(this,za))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of l(this,qt)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of l(this,Ko))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){st(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const d of s){const h=await i.deserialize(d);if(!h)return;r.push(h)}const o=()=>{for(const d of r)E(this,me,Z4).call(this,d);E(this,me,eF).call(this,r)},c=()=>{for(const d of r)d.remove()};this.addCommands({cmd:o,undo:c,mustExec:!0})}catch(r){st(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,Hn)!==et.NONE&&!this.isEditorHandlingKeyboard&&nb._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,lf)&&(v(this,lf,!1),E(this,me,mC).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(E(this,me,YY).call(this),E(this,me,Q4).call(this),E(this,me,Ar).call(this,{isEditing:l(this,Hn)!==et.NONE,isEmpty:E(this,me,gC).call(this),hasSomethingToUndo:l(this,Xo).hasSomethingToUndo(),hasSomethingToRedo:l(this,Xo).hasSomethingToRedo(),hasSelectedEditor:!1})):(E(this,me,XY).call(this),E(this,me,J4).call(this),E(this,me,Ar).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!l(this,Ko)){v(this,Ko,e);for(const t of l(this,Ko))E(this,me,qd).call(this,t.defaultPropertiesToUpdate)}}getId(){return l(this,QP).id}get currentLayer(){return l(this,Qn).get(l(this,sw))}getLayer(e){return l(this,Qn).get(e)}get currentPageIndex(){return l(this,sw)}addLayer(e){l(this,Qn).set(e.pageIndex,e),l(this,cf)?e.enable():e.disable()}removeLayer(e){l(this,Qn).delete(e.pageIndex)}async updateMode(e,t=null,s=!1,i=!1,r=!1){var o,c,d,h,u,p;if(l(this,Hn)!==e&&!(l(this,Qo)&&(await l(this,Qo).promise,!l(this,Qo)))){if(v(this,Qo,Promise.withResolvers()),(o=l(this,rf))==null||o.commitOrRemove(),l(this,Hn)===et.POPUP&&((c=l(this,dr))==null||c.hideSidebar()),(d=l(this,dr))==null||d.destroyPopup(),v(this,Hn,e),e===et.NONE){this.setEditingState(!1),E(this,me,ZY).call(this);for(const f of l(this,un).values())f.hideStandaloneCommentButton();(h=this._editorUndoBar)==null||h.hide(),this.toggleComment(null),l(this,Qo).resolve();return}for(const f of l(this,un).values())f.addStandaloneCommentButton();e===et.SIGNATURE&&await((u=l(this,uf))==null?void 0:u.loadSignatures()),this.setEditingState(!0),await E(this,me,JY).call(this),this.unselectAll();for(const f of l(this,Qn).values())f.updateMode(e);if(e===et.POPUP){l(this,Zv)||v(this,Zv,await l(this,ow).getAnnotationsByType(new Set(l(this,Ko).map(x=>x._editorType))));const f=new Set,m=[];for(const x of l(this,un).values()){const{annotationElementId:g,hasComment:b,deleted:y}=x;g&&f.add(g),b&&!y&&m.push(x.getData())}for(const x of l(this,Zv)){const{id:g,popupRef:b,contentsObj:y}=x;b&&(y!=null&&y.str)&&!f.has(g)&&!l(this,af).has(g)&&m.push(x)}(p=l(this,dr))==null||p.showSidebar(m)}if(!t){s&&this.addNewEditorFromKeyboard(),l(this,Qo).resolve();return}for(const f of l(this,un).values())f.uid===t?(this.setSelected(f),r?f.editComment():i?f.enterInEditMode():f.focus()):f.unselect();l(this,Qo).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==l(this,Hn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(l(this,Ko)){switch(e){case Nt.CREATE:this.currentLayer.addNewEditor(t);return;case Nt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,U2)||v(this,U2,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of l(this,qt))s.updateParams(e,t);else for(const s of l(this,Ko))s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const o of l(this,un).values())o.editorType===e&&o.show(t);(((r=l(this,U2))==null?void 0:r.get(Nt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&E(this,me,qd).call(this,[[Nt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(l(this,B2)!==e){v(this,B2,e);for(const t of l(this,Qn).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of l(this,un).values())t.pageIndex===e&&(yield t)}getEditor(e){return l(this,un).get(e)}addEditor(e){l(this,un).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(l(this,Yc)&&clearTimeout(l(this,Yc)),v(this,Yc,setTimeout(()=>{this.focusMainContainer(),v(this,Yc,null)},0))),l(this,un).delete(e.id),e.annotationElementId&&((t=l(this,hf))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!l(this,af).has(e.annotationElementId))&&((s=l(this,Yo))==null||s.remove(e.id))}addDeletedAnnotationElement(e){l(this,af).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return l(this,af).has(e)}removeDeletedAnnotationElement(e){l(this,af).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){l(this,za)!==e&&(v(this,za,e),e&&E(this,me,qd).call(this,e.propertiesToUpdate))}updateUI(e){l(this,me,eX)===e&&E(this,me,qd).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){E(this,me,qd).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(l(this,qt).has(e)){l(this,qt).delete(e),e.unselect(),E(this,me,Ar).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,qt).add(e),e.select(),E(this,me,qd).call(this,e.propertiesToUpdate),E(this,me,Ar).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.id}),(t=l(this,rf))==null||t.commitOrRemove();for(const s of l(this,qt))s!==e&&s.unselect();l(this,qt).clear(),l(this,qt).add(e),e.select(),E(this,me,qd).call(this,e.propertiesToUpdate),E(this,me,Ar).call(this,{hasSelectedEditor:!0})}isSelected(e){return l(this,qt).has(e)}get firstSelectedEditor(){return l(this,qt).values().next().value}unselect(e){e.unselect(),l(this,qt).delete(e),E(this,me,Ar).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,qt).size!==0}get isEnterHandled(){return l(this,qt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;l(this,Xo).undo(),E(this,me,Ar).call(this,{hasSomethingToUndo:l(this,Xo).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:E(this,me,gC).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){l(this,Xo).redo(),E(this,me,Ar).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,Xo).hasSomethingToRedo(),isEmpty:E(this,me,gC).call(this)})}addCommands(e){l(this,Xo).add(e),E(this,me,Ar).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:E(this,me,gC).call(this)})}cleanUndoStack(e){l(this,Xo).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...l(this,qt)],s=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const c of t)c.remove()},i=()=>{for(const o of t)E(this,me,Z4).call(this,o)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=l(this,za))==null||e.commitOrRemove()}hasSomethingToControl(){return l(this,za)||this.hasSelection}selectAll(){for(const e of l(this,qt))e.commit();E(this,me,eF).call(this,l(this,un).values())}unselectAll(){var e;if(!(l(this,za)&&(l(this,za).commitOrRemove(),l(this,Hn)!==et.NONE))&&!((e=l(this,rf))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of l(this,qt))t.unselect();l(this,qt).clear(),E(this,me,Ar).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;l(this,ff)[0]+=e,l(this,ff)[1]+=t;const[i,r]=l(this,ff),o=[...l(this,qt)],c=1e3;l(this,Kc)&&clearTimeout(l(this,Kc)),v(this,Kc,setTimeout(()=>{v(this,Kc,null),l(this,ff)[0]=l(this,ff)[1]=0,this.addCommands({cmd:()=>{for(const d of o)l(this,un).has(d.id)&&(d.translateInPage(i,r),d.translationDone())},undo:()=>{for(const d of o)l(this,un).has(d.id)&&(d.translateInPage(-i,-r),d.translationDone())},mustExec:!1})},c));for(const d of o)d.translateInPage(e,t),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),v(this,qc,new Map);for(const e of l(this,qt))l(this,qc).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,qc))return!1;this.disableUserSelect(!1);const e=l(this,qc);v(this,qc,null);let t=!1;for(const[{x:i,y:r,pageIndex:o},c]of e)c.newX=i,c.newY=r,c.newPageIndex=o,t||(t=i!==c.savedX||r!==c.savedY||o!==c.savedPageIndex);if(!t)return!1;const s=(i,r,o,c)=>{if(l(this,un).has(i.id)){const d=l(this,Qn).get(c);d?i._setParentAndPosition(d,r,o):(i.pageIndex=c,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:c}]of e)s(i,r,o,c)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:c}]of e)s(i,r,o,c)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(l(this,qc))for(const s of l(this,qc).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||l(this,qt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return l(this,za)===e}getActive(){return l(this,za)}getMode(){return l(this,Hn)}isEditingMode(){return l(this,Hn)!==et.NONE}get imageManager(){return ct(this,"imageManager",new q4)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,u=t.rangeCount;h<u;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=e.getBoundingClientRect();let c;switch(e.getAttribute("data-main-rotation")){case"90":c=(h,u,p,f)=>({x:(u-i)/o,y:1-(h+p-s)/r,width:f/o,height:p/r});break;case"180":c=(h,u,p,f)=>({x:1-(h+p-s)/r,y:1-(u+f-i)/o,width:p/r,height:f/o});break;case"270":c=(h,u,p,f)=>({x:1-(u+f-i)/o,y:(h-s)/r,width:f/o,height:p/r});break;default:c=(h,u,p,f)=>({x:(h-s)/r,y:(u-i)/o,width:p/r,height:f/o});break}const d=[];for(let h=0,u=t.rangeCount;h<u;h++){const p=t.getRangeAt(h);if(!p.collapsed)for(const{x:f,y:m,width:x,height:g}of p.getClientRects())x===0||g===0||d.push(c(f,m,x,g))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(l(this,tw)||v(this,tw,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=l(this,tw))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=l(this,tw))==null?void 0:i.get(e.data.id);if(!t)return;const s=l(this,Yo).getRawValue(t);s&&(l(this,Hn)===et.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var r;const i=(r=l(this,hf))==null?void 0:r.get(e);i&&(i.setCanvas(t,s),l(this,hf).delete(e))}addMissingCanvas(e,t){(l(this,hf)||v(this,hf,new Map)).set(e,t)}};Jv=new WeakMap,za=new WeakMap,Zv=new WeakMap,un=new WeakMap,Qn=new WeakMap,ew=new WeakMap,Yo=new WeakMap,tw=new WeakMap,Xo=new WeakMap,dr=new WeakMap,nf=new WeakMap,rf=new WeakMap,sw=new WeakMap,af=new WeakMap,qc=new WeakMap,Ko=new WeakMap,Sx=new WeakMap,M2=new WeakMap,F2=new WeakMap,nw=new WeakMap,O2=new WeakMap,Yc=new WeakMap,of=new WeakMap,iw=new WeakMap,lf=new WeakMap,Xc=new WeakMap,QP=new WeakMap,cf=new WeakMap,rw=new WeakMap,B2=new WeakMap,df=new WeakMap,Cx=new WeakMap,aw=new WeakMap,hf=new WeakMap,$2=new WeakMap,Hn=new WeakMap,qt=new WeakMap,Ih=new WeakMap,uf=new WeakMap,pf=new WeakMap,U2=new WeakMap,ow=new WeakMap,z2=new WeakMap,ff=new WeakMap,Kc=new WeakMap,Mh=new WeakMap,H2=new WeakMap,V2=new WeakMap,Qo=new WeakMap,me=new WeakSet,QT=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},X4=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of l(this,Qn).values())if(s.hasTextLayer(e))return s;return null},GY=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=E(this,me,QT).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(l(this,Xc)||v(this,Xc,new mpe(this)),l(this,Xc).show(s,i,this.direction==="ltr"))},WY=function(){var r,o,c;const e=document.getSelection();if(!e||e.isCollapsed){l(this,Ih)&&((r=l(this,Xc))==null||r.hide(),v(this,Ih,null),E(this,me,Ar).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===l(this,Ih))return;const i=E(this,me,QT).call(this,e).closest(".textLayer");if(!i){l(this,Ih)&&((o=l(this,Xc))==null||o.hide(),v(this,Ih,null),E(this,me,Ar).call(this,{hasSelectedText:!1}));return}if((c=l(this,Xc))==null||c.hide(),v(this,Ih,t),E(this,me,Ar).call(this,{hasSelectedText:!0}),!(l(this,Hn)!==et.HIGHLIGHT&&l(this,Hn)!==et.NONE)&&(l(this,Hn)===et.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),v(this,lf,this.isShiftKeyDown),!this.isShiftKeyDown)){const d=l(this,Hn)===et.HIGHLIGHT?E(this,me,X4).call(this,i):null;if(d==null||d.toggleDrawing(),l(this,rw)){const h=new AbortController,u=this.combinedSignal(h),p=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),d==null||d.toggleDrawing(!0),f.type==="pointerup"&&E(this,me,mC).call(this,"main_toolbar"))};window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("blur",p,{signal:u})}else d==null||d.toggleDrawing(!0),E(this,me,mC).call(this,"main_toolbar")}},mC=function(e=""){l(this,Hn)===et.HIGHLIGHT?this.highlightSelection(e):l(this,M2)&&E(this,me,GY).call(this)},qY=function(){document.addEventListener("selectionchange",E(this,me,WY).bind(this),{signal:this._signal})},YY=function(){if(l(this,of))return;v(this,of,new AbortController);const e=this.combinedSignal(l(this,of));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},XY=function(){var e;(e=l(this,of))==null||e.abort(),v(this,of,null)},K4=function(){if(l(this,df))return;v(this,df,new AbortController);const e=this.combinedSignal(l(this,df));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},KY=function(){var e;(e=l(this,df))==null||e.abort(),v(this,df,null)},Q4=function(){if(l(this,nf))return;v(this,nf,new AbortController);const e=this.combinedSignal(l(this,nf));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},J4=function(){var e;(e=l(this,nf))==null||e.abort(),v(this,nf,null)},QY=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ar=function(e){Object.entries(e).some(([s,i])=>l(this,z2)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,z2),e)}),l(this,Hn)===et.HIGHLIGHT&&e.hasSelectedEditor===!1&&E(this,me,qd).call(this,[[Nt.HIGHLIGHT_FREE,!0]]))},qd=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},JY=async function(){if(!l(this,cf)){v(this,cf,!0);const e=[];for(const t of l(this,Qn).values())e.push(t.enable());await Promise.all(e);for(const t of l(this,un).values())t.enable()}},ZY=function(){if(this.unselectAll(),l(this,cf)){v(this,cf,!1);for(const e of l(this,Qn).values())e.disable();for(const e of l(this,un).values())e.disable()}},Z4=function(e){const t=l(this,Qn).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},eX=function(){let e=null;for(e of l(this,qt));return e},gC=function(){if(l(this,un).size===0)return!0;if(l(this,un).size===1)for(const e of l(this,un).values())return e.isEmpty();return!1},eF=function(e){for(const t of l(this,qt))t.unselect();l(this,qt).clear();for(const t of e)t.isEmpty()||(l(this,qt).add(t),t.select());E(this,me,Ar).call(this,{hasSelectedEditor:this.hasSelection})},W(nb,"TRANSLATE_SMALL",1),W(nb,"TRANSLATE_BIG",10);let mm=nb;var hi,Qc,zl,lw,Jc,Ha,cw,Zc,ia,Fh,Nx,ed,mf,rc,xC,JT;const Er=class Er{constructor(e){A(this,rc);A(this,hi,null);A(this,Qc,!1);A(this,zl,null);A(this,lw,null);A(this,Jc,null);A(this,Ha,null);A(this,cw,!1);A(this,Zc,null);A(this,ia,null);A(this,Fh,null);A(this,Nx,null);A(this,ed,!1);v(this,ia,e),v(this,ed,e._uiManager.useNewAltTextFlow),l(Er,mf)||v(Er,mf,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Er._l10n??(Er._l10n=e)}async render(){const e=v(this,zl,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=v(this,lw,document.createElement("span"));e.append(t),l(this,ed)?(e.classList.add("new"),e.setAttribute("data-l10n-id",l(Er,mf).missing),t.setAttribute("data-l10n-id",l(Er,mf)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=l(this,ia)._uiManager._signal;e.addEventListener("contextmenu",jo,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),l(this,ia)._uiManager.editAltText(l(this,ia)),l(this,ed)&&l(this,ia)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,rc,xC)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(v(this,cw,!0),i(r))},{signal:s}),await E(this,rc,JT).call(this),e}finish(){l(this,zl)&&(l(this,zl).focus({focusVisible:l(this,cw)}),v(this,cw,!1))}isEmpty(){return l(this,ed)?l(this,hi)===null:!l(this,hi)&&!l(this,Qc)}hasData(){return l(this,ed)?l(this,hi)!==null||!!l(this,Fh):this.isEmpty()}get guessedText(){return l(this,Fh)}async setGuessedText(e){l(this,hi)===null&&(v(this,Fh,e),v(this,Nx,await Er._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),E(this,rc,JT).call(this))}toggleAltTextBadge(e=!1){var t;if(!l(this,ed)||l(this,hi)){(t=l(this,Zc))==null||t.remove(),v(this,Zc,null);return}if(!l(this,Zc)){const s=v(this,Zc,document.createElement("div"));s.className="noAltTextBadge",l(this,ia).div.append(s)}l(this,Zc).classList.toggle("hidden",!e)}serialize(e){let t=l(this,hi);return!e&&l(this,Fh)===t&&(t=l(this,Nx)),{altText:t,decorative:l(this,Qc),guessedText:l(this,Fh),textWithDisclaimer:l(this,Nx)}}get data(){return{altText:l(this,hi),decorative:l(this,Qc)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(v(this,Fh,s),v(this,Nx,i)),!(l(this,hi)===e&&l(this,Qc)===t)&&(r||(v(this,hi,e),v(this,Qc,t)),E(this,rc,JT).call(this))}toggle(e=!1){l(this,zl)&&(!e&&l(this,Ha)&&(clearTimeout(l(this,Ha)),v(this,Ha,null)),l(this,zl).disabled=!e)}shown(){l(this,ia)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,rc,xC)}})}destroy(){var e,t;(e=l(this,zl))==null||e.remove(),v(this,zl,null),v(this,lw,null),v(this,Jc,null),(t=l(this,Zc))==null||t.remove(),v(this,Zc,null)}};hi=new WeakMap,Qc=new WeakMap,zl=new WeakMap,lw=new WeakMap,Jc=new WeakMap,Ha=new WeakMap,cw=new WeakMap,Zc=new WeakMap,ia=new WeakMap,Fh=new WeakMap,Nx=new WeakMap,ed=new WeakMap,mf=new WeakMap,rc=new WeakSet,xC=function(){return l(this,hi)&&"added"||l(this,hi)===null&&this.guessedText&&"review"||"missing"},JT=async function(){var i,r,o;const e=l(this,zl);if(!e)return;if(l(this,ed)){if(e.classList.toggle("done",!!l(this,hi)),e.setAttribute("data-l10n-id",l(Er,mf)[l(this,rc,xC)]),(i=l(this,lw))==null||i.setAttribute("data-l10n-id",l(Er,mf)[`${l(this,rc,xC)}-label`]),!l(this,hi)){(r=l(this,Jc))==null||r.remove();return}}else{if(!l(this,hi)&&!l(this,Qc)){e.classList.remove("done"),(o=l(this,Jc))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=l(this,Jc);if(!t){v(this,Jc,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${l(this,ia).id}`;const c=100,d=l(this,ia)._uiManager._signal;d.addEventListener("abort",()=>{clearTimeout(l(this,Ha)),v(this,Ha,null)},{once:!0}),e.addEventListener("mouseenter",()=>{v(this,Ha,setTimeout(()=>{v(this,Ha,null),l(this,Jc).classList.add("show"),l(this,ia)._reportTelemetry({action:"alt_text_tooltip"})},c))},{signal:d}),e.addEventListener("mouseleave",()=>{var h;l(this,Ha)&&(clearTimeout(l(this,Ha)),v(this,Ha,null)),(h=l(this,Jc))==null||h.classList.remove("show")},{signal:d})}l(this,Qc)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=l(this,hi)),t.parentNode||e.append(t);const s=l(this,ia).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},A(Er,mf,null),W(Er,"_l10n",null);let wP=Er;var Di,Jo,jx,ks,G2,Ax,Hl,Ex,kx,Tx,W2,tF;class Dk{constructor(e){A(this,W2);A(this,Di,null);A(this,Jo,null);A(this,jx,!1);A(this,ks,null);A(this,G2,null);A(this,Ax,null);A(this,Hl,null);A(this,Ex,null);A(this,kx,!1);A(this,Tx,null);v(this,ks,e)}renderForToolbar(){const e=v(this,Jo,document.createElement("button"));return e.className="comment",E(this,W2,tF).call(this,e,!1)}renderForStandalone(){const e=v(this,Di,document.createElement("button"));e.className="annotationCommentButton";const t=l(this,ks).commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(l(this,ks)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=l(this,ks).commentButtonColor;i&&(s.backgroundColor=i)}return E(this,W2,tF).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=l(this,Di)??l(this,Jo))==null||e.focus()},0)}onUpdatedColor(){if(!l(this,Di))return;const e=l(this,ks).commentButtonColor;e&&(l(this,Di).style.backgroundColor=e),l(this,ks)._uiManager.updatePopupColor(l(this,ks))}get commentButtonWidth(){var e;return(((e=l(this,Di))==null?void 0:e.getBoundingClientRect().width)??0)/l(this,ks).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(l(this,Tx))return l(this,Tx);if(!l(this,Di))return null;const{x:e,y:t,height:s}=l(this,Di).getBoundingClientRect(),{x:i,y:r,width:o,height:c}=l(this,ks).parent.boundingClientRect;return[(e-i)/o,(t+s-r)/c]}set commentPopupPositionInLayer(e){v(this,Tx,e)}hasDefaultPopupPosition(){return l(this,Tx)===null}removeStandaloneCommentButton(){var e;(e=l(this,Di))==null||e.remove(),v(this,Di,null)}removeToolbarCommentButton(){var e;(e=l(this,Jo))==null||e.remove(),v(this,Jo,null)}setCommentButtonStates({selected:e,hasPopup:t}){l(this,Di)&&(l(this,Di).classList.toggle("selected",e),l(this,Di).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let s,i;if(t)[s,i]=t;else{[s,i]=l(this,ks).commentButtonPosition;const{width:u,height:p,x:f,y:m}=l(this,ks);s=f+s*u,i=m+i*p}const r=l(this,ks).parent.boundingClientRect,{x:o,y:c,width:d,height:h}=r;l(this,ks)._uiManager.editComment(l(this,ks),o+s*d,c+i*h,{...e,parentDimensions:r})}finish(){l(this,Jo)&&(l(this,Jo).focus({focusVisible:l(this,jx)}),v(this,jx,!1))}isDeleted(){return l(this,kx)||l(this,Hl)===""}isEmpty(){return l(this,Hl)===null}hasBeenEdited(){return this.isDeleted()||l(this,Hl)!==l(this,G2)}serialize(){return this.data}get data(){return{text:l(this,Hl),richText:l(this,Ax),date:l(this,Ex),deleted:this.isDeleted()}}set data(e){if(e!==l(this,Hl)&&v(this,Ax,null),e===null){v(this,Hl,""),v(this,kx,!0);return}v(this,Hl,e),v(this,Ex,new Date),v(this,kx,!1)}setInitialText(e,t=null){v(this,G2,e),this.data=e,v(this,Ex,null),v(this,Ax,t)}shown(){}destroy(){var e,t;(e=l(this,Jo))==null||e.remove(),v(this,Jo,null),(t=l(this,Di))==null||t.remove(),v(this,Di,null),v(this,Hl,""),v(this,Ax,null),v(this,Ex,null),v(this,ks,null),v(this,jx,!1),v(this,kx,!1)}}Di=new WeakMap,Jo=new WeakMap,jx=new WeakMap,ks=new WeakMap,G2=new WeakMap,Ax=new WeakMap,Hl=new WeakMap,Ex=new WeakMap,kx=new WeakMap,Tx=new WeakMap,W2=new WeakSet,tF=function(e,t){if(!l(this,ks)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[l(this,ks)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const s=l(this,ks)._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",jo,{signal:s}),t&&(e.addEventListener("focusin",r=>{l(this,ks)._focusEventsAllowed=!1,tn(r)},{capture:!0,signal:s}),e.addEventListener("focusout",r=>{l(this,ks)._focusEventsAllowed=!0,tn(r)},{capture:!0,signal:s})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),e===l(this,Jo)?this.edit():l(this,ks).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(v(this,jx,!0),i(r))},{signal:s}),e.addEventListener("pointerenter",()=>{l(this,ks).toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{l(this,ks).toggleComment(!1,!1)},{signal:s}),e};var dw,_x,q2,Y2,X2,K2,Q2,Oh,Px,Bh,Lx,$h,xm,tX,sX,nX;const U3=class U3{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:c}){A(this,xm);A(this,dw);A(this,_x,!1);A(this,q2,null);A(this,Y2);A(this,X2);A(this,K2);A(this,Q2);A(this,Oh,null);A(this,Px);A(this,Bh,null);A(this,Lx);A(this,$h,null);v(this,dw,e),v(this,q2,s),v(this,Y2,t),v(this,X2,i),v(this,K2,r),v(this,Q2,o),v(this,Lx,new AbortController),v(this,Px,AbortSignal.any([c,l(this,Lx).signal])),e.addEventListener("touchstart",E(this,xm,tX).bind(this),{passive:!1,signal:l(this,Px)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/cc.pixelRatio}destroy(){var e,t;(e=l(this,Lx))==null||e.abort(),v(this,Lx,null),(t=l(this,Oh))==null||t.abort(),v(this,Oh,null)}};dw=new WeakMap,_x=new WeakMap,q2=new WeakMap,Y2=new WeakMap,X2=new WeakMap,K2=new WeakMap,Q2=new WeakMap,Oh=new WeakMap,Px=new WeakMap,Bh=new WeakMap,Lx=new WeakMap,$h=new WeakMap,xm=new WeakSet,tX=function(e){var i,r,o;if((i=l(this,Y2))!=null&&i.call(this))return;if(e.touches.length===1){if(l(this,Oh))return;const c=v(this,Oh,new AbortController),d=AbortSignal.any([l(this,Px),c.signal]),h=l(this,dw),u={capture:!0,signal:d,passive:!1},p=f=>{var m;f.pointerType==="touch"&&((m=l(this,Oh))==null||m.abort(),v(this,Oh,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(tn(f),p(f))},u),h.addEventListener("pointerup",p,u),h.addEventListener("pointercancel",p,u);return}if(!l(this,$h)){v(this,$h,new AbortController);const c=AbortSignal.any([l(this,Px),l(this,$h).signal]),d=l(this,dw),h={signal:c,capture:!1,passive:!1};d.addEventListener("touchmove",E(this,xm,sX).bind(this),h);const u=E(this,xm,nX).bind(this);d.addEventListener("touchend",u,h),d.addEventListener("touchcancel",u,h),h.capture=!0,d.addEventListener("pointerdown",tn,h),d.addEventListener("pointermove",tn,h),d.addEventListener("pointercancel",tn,h),d.addEventListener("pointerup",tn,h),(r=l(this,X2))==null||r.call(this)}if(tn(e),e.touches.length!==2||(o=l(this,q2))!=null&&o.call(this)){v(this,Bh,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),v(this,Bh,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},sX=function(e){var S;if(!l(this,Bh)||e.touches.length!==2)return;tn(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:o,screenY:c}=s,d=l(this,Bh),{touch0X:h,touch0Y:u,touch1X:p,touch1Y:f}=d,m=p-h,x=f-u,g=o-i,b=c-r,y=Math.hypot(g,b)||1,C=Math.hypot(m,x)||1;if(!l(this,_x)&&Math.abs(C-y)<=U3.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=i,d.touch0Y=r,d.touch1X=o,d.touch1Y=c,!l(this,_x)){v(this,_x,!0);return}const w=[(i+o)/2,(r+c)/2];(S=l(this,K2))==null||S.call(this,w,C,y)},nX=function(e){var t;e.touches.length>=2||(l(this,$h)&&(l(this,$h).abort(),v(this,$h,null),(t=l(this,Q2))==null||t.call(this)),l(this,Bh)&&(tn(e),v(this,Bh,null),v(this,_x,!1)))};let FN=U3;var Dx,Vl,Us,gs,Uh,hw,gf,J2,Ri,Rx,zh,td,xf,Z2,Ix,Va,eA,Mx,Hh,sd,uw,pw,Zo,Fx,tA,JP,Ve,sF,sA,nF,ZT,iX,rX,iF,e_,rF,aX,oX,lX,aF,cX,oF,dX,hX,uX,lF,yC;const it=class it{constructor(e){A(this,Ve);A(this,Dx,null);A(this,Vl,null);A(this,Us,null);A(this,gs,null);A(this,Uh,null);A(this,hw,!1);A(this,gf,null);A(this,J2,"");A(this,Ri,null);A(this,Rx,null);A(this,zh,null);A(this,td,null);A(this,xf,null);A(this,Z2,"");A(this,Ix,!1);A(this,Va,null);A(this,eA,!1);A(this,Mx,!1);A(this,Hh,!1);A(this,sd,null);A(this,uw,0);A(this,pw,0);A(this,Zo,null);A(this,Fx,null);W(this,"isSelected",!1);W(this,"_isCopy",!1);W(this,"_editToolbar",null);W(this,"_initialOptions",Object.create(null));W(this,"_initialData",null);W(this,"_isVisible",!0);W(this,"_uiManager",null);W(this,"_focusEventsAllowed",!0);A(this,tA,!1);A(this,JP,it._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[c,d]=this.parentDimensions;this.x=e.x/c,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=it.prototype._resizeWithKeyboard,t=mm.TRANSLATE_SMALL,s=mm.TRANSLATE_BIG;return ct(this,"_resizerKeyboardManager",new RE([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],it.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ct(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new ype({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(it._l10n??(it._l10n=e),it._l10nResizer||(it._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),it._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);it._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Ns("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,tA)}set _isDraggable(e){var t;v(this,tA,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,JP)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(E(this,Ve,yC).call(this),(t=l(this,td))==null||t.remove(),v(this,td,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(l(this,Ix)?v(this,Ix,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){E(this,Ve,sF).call(this,this.parentDimensions,e,t)}translateInPage(e,t){l(this,Va)||v(this,Va,[this.x,this.y,this.width,this.height]),E(this,Ve,sF).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){l(this,Va)||v(this,Va,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:p,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:c}=this;const[d,h]=this.getBaseTranslation();o+=d,c+=h;const{style:u}=s;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*c).toFixed(2)}%`,this._onTranslating(o,c),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!l(this,Va)&&(l(this,Va)[0]!==this.x||l(this,Va)[1]!==this.y)}get _hasBeenResized(){return!!l(this,Va)&&(l(this,Va)[2]!==this.width||l(this,Va)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=it,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:o,width:c,height:d}=this;if(c*=s,d*=i,r*=s,o*=i,this._mustFixPosition)switch(e){case 0:r=gr(r,0,s-c),o=gr(o,0,i-d);break;case 90:r=gr(r,0,s-d),o=gr(o,c,i);break;case 180:r=gr(r,c,s),o=gr(o,d,i);break;case 270:r=gr(r,d,s),o=gr(o,0,i-c);break}this.x=r/=s,this.y=o/=i;const[h,u]=this.getBaseTranslation();r+=h,o+=u,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return E(s=it,sA,nF).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return E(s=it,sA,nF).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=l(this,Us))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||l(this,Mx))return this._editToolbar;this._editToolbar=new G4(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=l(this,Us))==null||t.destroy()}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return l(this,Us)||(wP.initialize(it._l10n),v(this,Us,new wP(this)),l(this,Dx)&&(l(this,Us).data=l(this,Dx),v(this,Dx,null))),l(this,Us)}get altTextData(){var e;return(e=l(this,Us))==null?void 0:e.data}set altTextData(e){l(this,Us)&&(l(this,Us).data=e)}get guessedAltText(){var e;return(e=l(this,Us))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=l(this,Us))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=l(this,Us))==null?void 0:t.serialize(e)}hasAltText(){return!!l(this,Us)&&!l(this,Us).isEmpty()}hasAltTextData(){var e;return((e=l(this,Us))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=l(this,gs))==null||e.focusButton()}addCommentButton(){return l(this,gs)||v(this,gs,new Dk(this))}addStandaloneCommentButton(){if(l(this,Uh)){this._uiManager.isEditingMode()&&l(this,Uh).classList.remove("hidden");return}this.hasComment&&(v(this,Uh,l(this,gs).renderForStandalone()),this.div.append(l(this,Uh)))}removeStandaloneCommentButton(){l(this,gs).removeStandaloneCommentButton(),v(this,Uh,null)}hideStandaloneCommentButton(){var e;(e=l(this,Uh))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:s,deleted:i}}=l(this,gs);return{text:t,richText:e,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){l(this,gs)||v(this,gs,new Dk(this)),l(this,gs).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(l(this,gs)||v(this,gs,new Dk(this)),l(this,gs).setInitialText(e,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=l(this,gs))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=l(this,gs))==null?void 0:e.isDeleted()}get hasComment(){return!!l(this,gs)&&!l(this,gs).isEmpty()&&!l(this,gs).isDeleted()}async editComment(e){l(this,gs)||v(this,gs,new Dk(this)),l(this,gs).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){l(this,gs).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,c=o+r+1,d=i-100,h=c+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[c,d,h,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){l(this,gs).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=l(this,hw)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),E(this,Ve,oF).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),HY(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(l(this,Fx)||v(this,Fx,new FN({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:E(this,Ve,aX).bind(this),onPinching:E(this,Ve,oX).bind(this),onPinchEnd:E(this,Ve,lX).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=wi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(v(this,Ix,!0),this._isDraggable){E(this,Ve,cX).call(this,e);return}E(this,Ve,aF).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){l(this,sd)&&clearTimeout(l(this,sd)),v(this,sd,setTimeout(()=>{var e;v(this,sd,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[c,d]=this.pageTranslation,h=e/i,u=t/i,p=this.x*r,f=this.y*o,m=this.width*r,x=this.height*o;switch(s){case 0:return[p+h+c,o-f-u-x+d,p+h+m+c,o-f-u+d];case 90:return[p+u+c,o-f+h+d,p+u+x+c,o-f+h+m+d];case 180:return[p-h-m+c,o-f+u+d,p-h+c,o-f+u+x+d];case 270:return[p-u-x+c,o-f-h-m+d,p-u+c,o-f-h+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,o]=e,c=r-s,d=o-i;switch(this.rotation){case 0:return[s,t-o,c,d];case 90:return[s,t-i,d,c];case 180:return[r,t-i,c,d];case 270:return[r,t-o,d,c];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&it._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=l(this,gs))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:i,deleted:r,richText:o},uid:c,pageIndex:d,creationDate:h,modificationDate:u}=this;return{id:c,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:h,modificationDate:s||u,popupRef:!r,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),v(this,Mx,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),v(this,Mx,!1),!0):!1}isInEditMode(){return l(this,Mx)}shouldGetKeyboardEvents(){return l(this,Hh)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&s>0}rebuild(){E(this,Ve,oF).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var s;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((s=this._initialData)==null?void 0:s.popupRef)||""}}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,v(i,Dx,e.accessibilityData),i._isCopy=e.isCopy||!1;const[r,o]=i.pageDimensions,[c,d,h,u]=i.getRectInCurrentCoords(e.rect,o);return i.x=c/r,i.y=d/o,i.width=h/r,i.height=u/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=l(this,xf))==null||e.abort(),v(this,xf,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),l(this,sd)&&(clearTimeout(l(this,sd)),v(this,sd,null)),E(this,Ve,yC).call(this),this.removeEditToolbar(),l(this,Zo)){for(const s of l(this,Zo).values())clearTimeout(s);v(this,Zo,null)}this.parent=null,(t=l(this,Fx))==null||t.destroy(),v(this,Fx,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(E(this,Ve,iX).call(this),l(this,Ri).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,i,r,o]=this.getPDFRect();return[it._round(s+(r-s)*e),it._round(i+(o-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return l(this,gs).commentPopupPositionInLayer}set commentPopupPosition(e){l(this,gs).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return l(this,gs).hasDefaultPopupPosition()}get commentButtonWidth(){return l(this,gs).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){l(this,gs).setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),v(this,zh,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=l(this,Ri).children;if(!l(this,Vl)){v(this,Vl,Array.from(t));const o=E(this,Ve,dX).bind(this),c=E(this,Ve,hX).bind(this),d=this._uiManager._signal;for(const h of l(this,Vl)){const u=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",o,{signal:d}),h.addEventListener("blur",c,{signal:d}),h.addEventListener("focus",E(this,Ve,uX).bind(this,u),{signal:d}),h.setAttribute("data-l10n-id",it._l10nResizer[u])}}const s=l(this,Vl)[0];let i=0;for(const o of t){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(l(this,Vl).length/4);if(r!==i){if(r<i)for(let c=0;c<i-r;c++)l(this,Ri).append(l(this,Ri).firstChild);else if(r>i)for(let c=0;c<r-i;c++)l(this,Ri).firstChild.before(l(this,Ri).lastChild);let o=0;for(const c of t){const h=l(this,Vl)[o++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",it._l10nResizer[h])}}E(this,Ve,lF).call(this,0),v(this,Hh,!0),l(this,Ri).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){l(this,Hh)&&E(this,Ve,rF).call(this,l(this,Z2),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){E(this,Ve,yC).call(this),this.div.focus()}select(){var e,t,s;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=l(this,Us))==null||s.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,s,i,r;this.isSelected&&(this.isSelected=!1,(e=l(this,Ri))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=l(this,Us))==null||r.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return l(this,eA)}set isEditing(e){v(this,eA,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){l(this,Zo)||v(this,Zo,new Map);const{action:s}=e;let i=l(this,Zo).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),l(this,Zo).delete(s),l(this,Zo).size===0&&v(this,Zo,null)},it._telemetryTimeout),l(this,Zo).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),v(this,hw,!1)}disable(){this.div&&(this.div.tabIndex=-1),v(this,hw,!0)}updateFakeAnnotationElement(e){if(!l(this,td)&&!this.deleted){v(this,td,e.addFakeAnnotation(this));return}if(this.deleted){l(this,td).remove(),v(this,td,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&l(this,td).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Dx=new WeakMap,Vl=new WeakMap,Us=new WeakMap,gs=new WeakMap,Uh=new WeakMap,hw=new WeakMap,gf=new WeakMap,J2=new WeakMap,Ri=new WeakMap,Rx=new WeakMap,zh=new WeakMap,td=new WeakMap,xf=new WeakMap,Z2=new WeakMap,Ix=new WeakMap,Va=new WeakMap,eA=new WeakMap,Mx=new WeakMap,Hh=new WeakMap,sd=new WeakMap,uw=new WeakMap,pw=new WeakMap,Zo=new WeakMap,Fx=new WeakMap,tA=new WeakMap,JP=new WeakMap,Ve=new WeakSet,sF=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},sA=new WeakSet,nF=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},ZT=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},iX=function(){if(l(this,Ri))return;v(this,Ri,document.createElement("div")),l(this,Ri).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");l(this,Ri).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",E(this,Ve,rX).bind(this,s),{signal:t}),i.addEventListener("contextmenu",jo,{signal:t}),i.tabIndex=-1}this.div.prepend(l(this,Ri))},rX=function(e,t){var u;t.preventDefault();const{isMac:s}=wi.platform;if(t.button!==0||t.ctrlKey&&s)return;(u=l(this,Us))==null||u.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,v(this,Rx,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",E(this,Ve,rF).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",tn,{passive:!1,signal:o}),window.addEventListener("contextmenu",jo,{signal:o}),v(this,zh,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const c=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var p;r.abort(),this.parent.togglePointerEvents(!0),(p=l(this,Us))==null||p.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=c,this.div.style.cursor=d,E(this,Ve,e_).call(this)};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})},iF=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},e_=function(){if(!l(this,zh))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=l(this,zh);v(this,zh,null);const r=this.x,o=this.y,c=this.width,d=this.height;r===e&&o===t&&c===s&&d===i||this.addCommands({cmd:E(this,Ve,iF).bind(this,r,o,c,d),undo:E(this,Ve,iF).bind(this,e,t,s,i),mustExec:!0})},rF=function(e,t){const[s,i]=this.parentDimensions,r=this.x,o=this.y,c=this.width,d=this.height,h=it.MIN_SIZE/s,u=it.MIN_SIZE/i,p=E(this,Ve,ZT).call(this,this.rotation),f=(B,U)=>[p[0]*B+p[2]*U,p[1]*B+p[3]*U],m=E(this,Ve,ZT).call(this,360-this.rotation),x=(B,U)=>[m[0]*B+m[2]*U,m[1]*B+m[3]*U];let g,b,y=!1,C=!1;switch(e){case"topLeft":y=!0,g=(B,U)=>[0,0],b=(B,U)=>[B,U];break;case"topMiddle":g=(B,U)=>[B/2,0],b=(B,U)=>[B/2,U];break;case"topRight":y=!0,g=(B,U)=>[B,0],b=(B,U)=>[0,U];break;case"middleRight":C=!0,g=(B,U)=>[B,U/2],b=(B,U)=>[0,U/2];break;case"bottomRight":y=!0,g=(B,U)=>[B,U],b=(B,U)=>[0,0];break;case"bottomMiddle":g=(B,U)=>[B/2,U],b=(B,U)=>[B/2,0];break;case"bottomLeft":y=!0,g=(B,U)=>[0,U],b=(B,U)=>[B,0];break;case"middleLeft":C=!0,g=(B,U)=>[0,U/2],b=(B,U)=>[B,U/2];break}const w=g(c,d),S=b(c,d);let j=f(...S);const T=it._round(r+j[0]),k=it._round(o+j[1]);let _=1,L=1,D,P;if(t.fromKeyboard)({deltaX:D,deltaY:P}=t);else{const{screenX:B,screenY:U}=t,[$,G]=l(this,Rx);[D,P]=this.screenToPageTranslation(B-$,U-G),l(this,Rx)[0]=B,l(this,Rx)[1]=U}if([D,P]=x(D/s,P/i),y){const B=Math.hypot(c,d);_=L=Math.max(Math.min(Math.hypot(S[0]-w[0]-D,S[1]-w[1]-P)/B,1/c,1/d),h/c,u/d)}else C?_=gr(Math.abs(S[0]-w[0]-D),h,1)/c:L=gr(Math.abs(S[1]-w[1]-P),u,1)/d;const I=it._round(c*_),M=it._round(d*L);j=f(...b(I,M));const O=T-j[0],F=k-j[1];l(this,Va)||v(this,Va,[this.x,this.y,this.width,this.height]),this.width=I,this.height=M,this.x=O,this.y=F,this.setDims(),this.fixAndSetPosition(),this._onResizing()},aX=function(){var e;v(this,zh,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=l(this,Us))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},oX=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const o=E(this,Ve,ZT).call(this,this.rotation),c=(T,k)=>[o[0]*T+o[2]*k,o[1]*T+o[3]*k],[d,h]=this.parentDimensions,u=this.x,p=this.y,f=this.width,m=this.height,x=it.MIN_SIZE/d,g=it.MIN_SIZE/h;r=Math.max(Math.min(r,1/f,1/m),x/f,g/m);const b=it._round(f*r),y=it._round(m*r);if(b===f&&y===m)return;l(this,Va)||v(this,Va,[u,p,f,m]);const C=c(f/2,m/2),w=it._round(u+C[0]),S=it._round(p+C[1]),j=c(b/2,y/2);this.x=w-j[0],this.y=S-j[1],this.width=b,this.height=y,this.setDims(),this.fixAndSetPosition(),this._onResizing()},lX=function(){var e;(e=l(this,Us))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),E(this,Ve,e_).call(this)},aF=function(e){const{isMac:t}=wi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},cX=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},c=h=>{i.abort(),v(this,gf,null),v(this,Ix,!1),this._uiManager.endDragSession()||E(this,Ve,aF).call(this,h),s&&this._onStopDragging()};t&&(v(this,uw,e.clientX),v(this,pw,e.clientY),v(this,gf,e.pointerId),v(this,J2,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:u,clientY:p,pointerId:f}=h;if(f!==l(this,gf)){tn(h);return}const[m,x]=this.screenToPageTranslation(u-l(this,uw),p-l(this,pw));v(this,uw,u),v(this,pw,p),this._uiManager.dragSelectedEditors(m,x)},o),window.addEventListener("touchmove",tn,o),window.addEventListener("pointerdown",h=>{h.pointerType===l(this,J2)&&(l(this,Fx)||h.isPrimary)&&c(h),tn(h)},o));const d=h=>{if(!l(this,gf)||l(this,gf)===h.pointerId){c(h);return}tn(h)};window.addEventListener("pointerup",d,{signal:r}),window.addEventListener("blur",d,{signal:r})},oF=function(){if(l(this,xf)||!this.div)return;v(this,xf,new AbortController);const e=this._uiManager.combinedSignal(l(this,xf));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},dX=function(e){it._resizerKeyboardManager.exec(this,e)},hX=function(e){var t;l(this,Hh)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==l(this,Ri)&&E(this,Ve,yC).call(this)},uX=function(e){v(this,Z2,l(this,Hh)?e:"")},lF=function(e){if(l(this,Vl))for(const t of l(this,Vl))t.tabIndex=e},yC=function(){v(this,Hh,!1),E(this,Ve,lF).call(this,-1),E(this,Ve,e_).call(this)},A(it,sA),W(it,"_l10n",null),W(it,"_l10nResizer",null),W(it,"_borderLineWidth",-1),W(it,"_colorManager",new Y4),W(it,"_zIndex",1),W(it,"_telemetryTimeout",1e3);let _s=it;class ype extends _s{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const cz=3285377520,Po=4294901760,vc=65535;class pX{constructor(e){this.h1=e?e&4294967295:cz,this.h2=e?e&4294967295:cz}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let g=0,b=e.length;g<b;g++){const y=e.charCodeAt(g);y<=255?t[s++]=y:(t[s++]=y>>>8,t[s++]=y&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(t.buffer,0,i);let c=0,d=0,h=this.h1,u=this.h2;const p=3432918353,f=461845907,m=p&vc,x=f&vc;for(let g=0;g<i;g++)g&1?(c=o[g],c=c*p&Po|c*m&vc,c=c<<15|c>>>17,c=c*f&Po|c*x&vc,h^=c,h=h<<13|h>>>19,h=h*5+3864292196):(d=o[g],d=d*p&Po|d*m&vc,d=d<<15|d>>>17,d=d*f&Po|d*x&vc,u^=d,u=u<<13|u>>>19,u=u*5+3864292196);switch(c=0,r){case 3:c^=t[i*4+2]<<16;case 2:c^=t[i*4+1]<<8;case 1:c^=t[i*4],c=c*p&Po|c*m&vc,c=c<<15|c>>>17,c=c*f&Po|c*x&vc,i&1?h^=c:u^=c}this.h1=h,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Po|e*36045&vc,t=t*4283543511&Po|((t<<16|e>>>16)*2950163797&Po)>>>16,e^=t>>>1,e=e*444984403&Po|e*60499&vc,t=t*3301882366&Po|((t<<16|e>>>16)*3120437893&Po)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const cF=Object.freeze({map:null,hash:"",transfer:void 0});var Ox,Bx,Vh,Ii,ZP,fX;class k3{constructor(){A(this,ZP);A(this,Ox,!1);A(this,Bx,null);A(this,Vh,null);A(this,Ii,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=l(this,Ii).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return l(this,Ii).get(e)}remove(e){const t=l(this,Ii).get(e);if(t!==void 0&&(t instanceof _s&&l(this,Vh).delete(t.annotationElementId),l(this,Ii).delete(e),l(this,Ii).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of l(this,Ii).values())if(s instanceof _s)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=l(this,Ii).get(e);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(t))s[r]!==o&&(i=!0,s[r]=o);else i=!0,l(this,Ii).set(e,t);i&&E(this,ZP,fX).call(this),t instanceof _s&&((l(this,Vh)||v(this,Vh,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return l(this,Ii).has(e)}get size(){return l(this,Ii).size}resetModified(){l(this,Ox)&&(v(this,Ox,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new mX(this)}get serializable(){if(l(this,Ii).size===0)return cF;const e=new Map,t=new pX,s=[],i=Object.create(null);let r=!1;for(const[o,c]of l(this,Ii)){const d=c instanceof _s?c.serialize(!1,i):c;d&&(e.set(o,d),t.update(`${o}:${JSON.stringify(d)}`),r||(r=!!d.bitmap))}if(r)for(const o of e.values())o.bitmap&&s.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:cF}get editorStats(){let e=null;const t=new Map;let s=0,i=0;for(const r of l(this,Ii).values()){if(!(r instanceof _s)){r.popup&&(r.popup.deleted?i+=1:s+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(s+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:c}=o;t.has(c)||t.set(c,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const d=e[c]||(e[c]=new Map);for(const[h,u]of Object.entries(o)){if(h==="type")continue;let p=d.get(h);p||(p=new Map,d.set(h,p));const f=p.get(u)??0;p.set(u,f+1)}}if((i>0||s>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:s}),!e)return null;for(const[r,o]of t)e[r]=o.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){v(this,Bx,null)}updateEditor(e,t){var i;const s=(i=l(this,Vh))==null?void 0:i.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=l(this,Vh))==null?void 0:t.get(e))||null}get modifiedIds(){if(l(this,Bx))return l(this,Bx);const e=[];if(l(this,Vh))for(const t of l(this,Vh).values())t.serialize()&&e.push(t.annotationElementId);return v(this,Bx,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return l(this,Ii).entries()}}Ox=new WeakMap,Bx=new WeakMap,Vh=new WeakMap,Ii=new WeakMap,ZP=new WeakSet,fX=function(){l(this,Ox)||(v(this,Ox,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var nA;class mX extends k3{constructor(t){super();A(this,nA);const{map:s,hash:i,transfer:r}=t.serializable,o=structuredClone(s,r?{transfer:r}:null);v(this,nA,{map:o,hash:i,transfer:r})}get print(){Ns("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,nA)}get modifiedIds(){return ct(this,"modifiedIds",{ids:new Set,hash:""})}}nA=new WeakMap;var fw;class bpe{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){A(this,fw,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),l(this,fw).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||l(this,fw).has(e.loadedName))){if(Et(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:o}=e,c=new FontFace(i,r,o);this.addNativeFontFace(c);try{await c.load(),l(this,fw).add(i),s==null||s(e)}catch{st(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}Ns("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw st(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return ct(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return ct(this,"isSyncFontLoadingSupported",Fr||wi.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Et(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ct(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(S,j){return S.charCodeAt(j)<<24|S.charCodeAt(j+1)<<16|S.charCodeAt(j+2)<<8|S.charCodeAt(j+3)&255}function i(S,j,T,k){const _=S.substring(0,j),L=S.substring(j+T);return _+k+L}let r,o;const c=this._document.createElement("canvas");c.width=1,c.height=1;const d=c.getContext("2d");let h=0;function u(S,j){if(++h>30){st("Load test font never loaded."),j();return}if(d.font="30px "+S,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){j();return}setTimeout(u.bind(null,S,j))}const p=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,p.length,p);const x=16,g=1482184792;let b=s(f,x);for(r=0,o=p.length-3;r<o;r+=4)b=b-g+s(p,r)|0;r<p.length&&(b=b-g+s(p+"XXX",r)|0),f=i(f,x,4,ape(b));const y=`url(data:font/opentype;base64,${btoa(f)});`,C=`@font-face {font-family:"${p}";src:${y}}`;this.insertRule(C);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const S of[e.loadedName,p]){const j=this._document.createElement("span");j.textContent="Hi",j.style.fontFamily=S,w.append(j)}this._document.body.append(w),u(p,()=>{w.remove(),t.complete()})}}fw=new WeakMap;var is;class vpe{constructor(e,t=null,s,i){A(this,is);this.compiledGlyphs=Object.create(null),v(this,is,e),this._inspectFont=t,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${PY(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(o){st(`getPathGenerator - ignoring character: "${o}".`)}const r=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}get black(){return l(this,is).black}get bold(){return l(this,is).bold}get disableFontFace(){return l(this,is).disableFontFace??!1}get fontExtraProperties(){return l(this,is).fontExtraProperties??!1}get isInvalidPDFjsFont(){return l(this,is).isInvalidPDFjsFont}get isType3Font(){return l(this,is).isType3Font}get italic(){return l(this,is).italic}get missingFile(){return l(this,is).missingFile}get remeasure(){return l(this,is).remeasure}get vertical(){return l(this,is).vertical}get ascent(){return l(this,is).ascent}get defaultWidth(){return l(this,is).defaultWidth}get descent(){return l(this,is).descent}get bbox(){return l(this,is).bbox}get fontMatrix(){return l(this,is).fontMatrix}get fallbackName(){return l(this,is).fallbackName}get loadedName(){return l(this,is).loadedName}get mimetype(){return l(this,is).mimetype}get name(){return l(this,is).name}get data(){return l(this,is).data}clearData(){l(this,is).clearData()}get cssFontInfo(){return l(this,is).cssFontInfo}get systemFontInfo(){return l(this,is).systemFontInfo}get defaultVMetrics(){return l(this,is).defaultVMetrics}}is=new WeakMap;function wpe(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(Fr)return n;const e=URL.parse(n,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Spe(n){if(Fr&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return PE(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Rk(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const dF=n=>typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0,Cpe=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string",gX=dpe.bind(null,dF,Cpe);var Gh,eL;class Npe{constructor(){A(this,Gh,new Map);A(this,eL,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};l(this,eL).then(()=>{for(const[i]of l(this,Gh))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){st("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}l(this,Gh).set(t,i)}removeEventListener(e,t){const s=l(this,Gh).get(t);s==null||s(),l(this,Gh).delete(t)}terminate(){for(const[,e]of l(this,Gh))e==null||e();l(this,Gh).clear()}}Gh=new WeakMap,eL=new WeakMap;const Ik={DATA:1,ERROR:2},$n={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function dz(){}function Xr(n){if(n instanceof Mu||n instanceof bP||n instanceof sz||n instanceof RN||n instanceof LR)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Ns('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Mu(n.message);case"InvalidPDFException":return new bP(n.message);case"PasswordException":return new sz(n.message,n.code);case"ResponseException":return new RN(n.message,n.status,n.missing);case"UnknownErrorException":return new LR(n.message,n.details)}return new LR(n.message,n.toString())}var mw,fl,xX,yX,bX,t_;class bC{constructor(e,t,s){A(this,fl);A(this,mw,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",E(this,fl,xX).bind(this),{signal:l(this,mw).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,o=this.sourceName,c=this.targetName,d=this.comObj;return new ReadableStream({start:h=>{const u=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:c,action:e,streamId:r,data:t,desiredSize:h.desiredSize},i),u.promise},pull:h=>{const u=Promise.withResolvers();return this.streamControllers[r].pullCall=u,d.postMessage({sourceName:o,targetName:c,stream:$n.PULL,streamId:r,desiredSize:h.desiredSize}),u.promise},cancel:h=>{Et(h instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[r].cancelCall=u,this.streamControllers[r].isClosed=!0,d.postMessage({sourceName:o,targetName:c,stream:$n.CANCEL,streamId:r,reason:Xr(h)}),u.promise}},s)}destroy(){var e;(e=l(this,mw))==null||e.abort(),v(this,mw,null)}}mw=new WeakMap,fl=new WeakSet,xX=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){E(this,fl,bX).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Ik.DATA)i.resolve(e.data);else if(e.callback===Ik.ERROR)i.reject(Xr(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:s,targetName:i,callback:Ik.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:i,callback:Ik.ERROR,callbackId:e.callbackId,reason:Xr(o)})});return}if(e.streamId){E(this,fl,yX).call(this,e);return}t(e.data)},yX=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this,c=this.actionHandler[e.action],d={enqueue(h,u=1,p){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:$n.ENQUEUE,streamId:t,chunk:h},p)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:$n.CLOSE,streamId:t}),delete o.streamSinks[t])},error(h){Et(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:$n.ERROR,streamId:t,reason:Xr(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,Promise.try(c,e.data,d).then(function(){r.postMessage({sourceName:s,targetName:i,stream:$n.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:$n.START_COMPLETE,streamId:t,reason:Xr(h)})})},bX=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],c=this.streamSinks[t];switch(e.stream){case $n.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Xr(e.reason));break;case $n.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Xr(e.reason));break;case $n.PULL:if(!c){r.postMessage({sourceName:s,targetName:i,stream:$n.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&e.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=e.desiredSize,Promise.try(c.onPull||dz).then(function(){r.postMessage({sourceName:s,targetName:i,stream:$n.PULL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:$n.PULL_COMPLETE,streamId:t,reason:Xr(h)})});break;case $n.ENQUEUE:if(Et(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case $n.CLOSE:if(Et(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),E(this,fl,t_).call(this,o,t);break;case $n.ERROR:Et(o,"error should have stream controller"),o.controller.error(Xr(e.reason)),E(this,fl,t_).call(this,o,t);break;case $n.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Xr(e.reason)),E(this,fl,t_).call(this,o,t);break;case $n.CANCEL:if(!c)break;const d=Xr(e.reason);Promise.try(c.onCancel||dz,d).then(function(){r.postMessage({sourceName:s,targetName:i,stream:$n.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:$n.CANCEL_COMPLETE,streamId:t,reason:Xr(h)})}),c.sinkCapability.reject(d),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},t_=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var iA;class vX{constructor({enableHWA:e=!1}){A(this,iA,!1);v(this,iA,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!l(this,iA)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Ns("Abstract method `_createCanvas` called.")}}iA=new WeakMap;class jpe extends vX{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class wX{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Ns("Abstract method `_fetch` called.")}}class hz extends wX{async _fetch(e){const t=await Q1(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):PE(t)}}class SX{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var $x,gw,Wh,qh,hr,Ux,zx,ve,sr,vC,Py,s_,Ly,CX,hF,Dy,wC,SC,uF,CC;class Ape extends SX{constructor({docId:t,ownerDocument:s=globalThis.document}){super();A(this,ve);A(this,$x);A(this,gw);A(this,Wh);A(this,qh);A(this,hr);A(this,Ux);A(this,zx,0);v(this,qh,t),v(this,hr,s)}addFilter(t){if(!t)return"none";let s=l(this,ve,sr).get(t);if(s)return s;const[i,r,o]=E(this,ve,s_).call(this,t),c=t.length===1?i:`${i}${r}${o}`;if(s=l(this,ve,sr).get(c),s)return l(this,ve,sr).set(t,s),s;const d=`g_${l(this,qh)}_transfer_map_${vt(this,zx)._++}`,h=E(this,ve,Ly).call(this,d);l(this,ve,sr).set(t,h),l(this,ve,sr).set(c,h);const u=E(this,ve,Dy).call(this,d);return E(this,ve,SC).call(this,i,r,o,u),h}addHCMFilter(t,s){var x;const i=`${t}-${s}`,r="base";let o=l(this,ve,vC).get(r);if((o==null?void 0:o.key)===i||(o?((x=o.filter)==null||x.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},l(this,ve,vC).set(r,o)),!t||!s))return o.url;const c=E(this,ve,CC).call(this,t);t=Ce.makeHexColor(...c);const d=E(this,ve,CC).call(this,s);if(s=Ce.makeHexColor(...d),l(this,ve,Py).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return o.url;const h=new Array(256);for(let g=0;g<=255;g++){const b=g/255;h[g]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const u=h.join(","),p=`g_${l(this,qh)}_hcm_filter`,f=o.filter=E(this,ve,Dy).call(this,p);E(this,ve,SC).call(this,u,u,u,f),E(this,ve,hF).call(this,f);const m=(g,b)=>{const y=c[g]/255,C=d[g]/255,w=new Array(b+1);for(let S=0;S<=b;S++)w[S]=y+S/b*(C-y);return w.join(",")};return E(this,ve,SC).call(this,m(0,5),m(1,5),m(2,5),f),o.url=E(this,ve,Ly).call(this,p),o.url}addAlphaFilter(t){let s=l(this,ve,sr).get(t);if(s)return s;const[i]=E(this,ve,s_).call(this,[t]),r=`alpha_${i}`;if(s=l(this,ve,sr).get(r),s)return l(this,ve,sr).set(t,s),s;const o=`g_${l(this,qh)}_alpha_map_${vt(this,zx)._++}`,c=E(this,ve,Ly).call(this,o);l(this,ve,sr).set(t,c),l(this,ve,sr).set(r,c);const d=E(this,ve,Dy).call(this,o);return E(this,ve,uF).call(this,i,d),c}addLuminosityFilter(t){let s=l(this,ve,sr).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=E(this,ve,s_).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=l(this,ve,sr).get(r),s)return l(this,ve,sr).set(t,s),s;const o=`g_${l(this,qh)}_luminosity_map_${vt(this,zx)._++}`,c=E(this,ve,Ly).call(this,o);l(this,ve,sr).set(t,c),l(this,ve,sr).set(r,c);const d=E(this,ve,Dy).call(this,o);return E(this,ve,CX).call(this,d),t&&E(this,ve,uF).call(this,i,d),c}addHighlightHCMFilter(t,s,i,r,o){var C;const c=`${s}-${i}-${r}-${o}`;let d=l(this,ve,vC).get(t);if((d==null?void 0:d.key)===c||(d?((C=d.filter)==null||C.remove(),d.key=c,d.url="none",d.filter=null):(d={key:c,url:"none",filter:null},l(this,ve,vC).set(t,d)),!s||!i))return d.url;const[h,u]=[s,i].map(E(this,ve,CC).bind(this));let p=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[m,x]=[r,o].map(E(this,ve,CC).bind(this));f<p&&([p,f,m,x]=[f,p,x,m]),l(this,ve,Py).style.color="";const g=(w,S,j)=>{const T=new Array(256),k=(f-p)/j,_=w/255,L=(S-w)/(255*j);let D=0;for(let P=0;P<=j;P++){const I=Math.round(p+P*k),M=_+P*L;for(let O=D;O<=I;O++)T[O]=M;D=I+1}for(let P=D;P<256;P++)T[P]=T[D-1];return T.join(",")},b=`g_${l(this,qh)}_hcm_${t}_filter`,y=d.filter=E(this,ve,Dy).call(this,b);return E(this,ve,hF).call(this,y),E(this,ve,SC).call(this,g(m[0],x[0],5),g(m[1],x[1],5),g(m[2],x[2],5),y),d.url=E(this,ve,Ly).call(this,b),d.url}destroy(t=!1){var s,i,r,o;t&&((s=l(this,Ux))!=null&&s.size)||((i=l(this,Wh))==null||i.parentNode.parentNode.remove(),v(this,Wh,null),(r=l(this,gw))==null||r.clear(),v(this,gw,null),(o=l(this,Ux))==null||o.clear(),v(this,Ux,null),v(this,zx,0))}}$x=new WeakMap,gw=new WeakMap,Wh=new WeakMap,qh=new WeakMap,hr=new WeakMap,Ux=new WeakMap,zx=new WeakMap,ve=new WeakSet,sr=function(){return l(this,gw)||v(this,gw,new Map)},vC=function(){return l(this,Ux)||v(this,Ux,new Map)},Py=function(){if(!l(this,Wh)){const t=l(this,hr).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=l(this,hr).createElementNS(Wd,"svg");i.setAttribute("width",0),i.setAttribute("height",0),v(this,Wh,l(this,hr).createElementNS(Wd,"defs")),t.append(i),i.append(l(this,Wh)),l(this,hr).body.append(t)}return l(this,Wh)},s_=function(t){if(t.length===1){const h=t[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=h[f]/255;const p=u.join(",");return[p,p,p]}const[s,i,r]=t,o=new Array(256),c=new Array(256),d=new Array(256);for(let h=0;h<256;h++)o[h]=s[h]/255,c[h]=i[h]/255,d[h]=r[h]/255;return[o.join(","),c.join(","),d.join(",")]},Ly=function(t){if(l(this,$x)===void 0){v(this,$x,"");const s=l(this,hr).URL;s!==l(this,hr).baseURI&&(DE(s)?st('#createUrl: ignore "data:"-URL for performance reasons.'):v(this,$x,C3(s,"")))}return`url(${l(this,$x)}#${t})`},CX=function(t){const s=l(this,hr).createElementNS(Wd,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},hF=function(t){const s=l(this,hr).createElementNS(Wd,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},Dy=function(t){const s=l(this,hr).createElementNS(Wd,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),l(this,ve,Py).append(s),s},wC=function(t,s,i){const r=l(this,hr).createElementNS(Wd,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},SC=function(t,s,i,r){const o=l(this,hr).createElementNS(Wd,"feComponentTransfer");r.append(o),E(this,ve,wC).call(this,o,"feFuncR",t),E(this,ve,wC).call(this,o,"feFuncG",s),E(this,ve,wC).call(this,o,"feFuncB",i)},uF=function(t,s){const i=l(this,hr).createElementNS(Wd,"feComponentTransfer");s.append(i),E(this,ve,wC).call(this,i,"feFuncA",t)},CC=function(t){return l(this,ve,Py).style.color=t,J1(getComputedStyle(l(this,ve,Py)).getPropertyValue("color"))};class NX{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Ns("Abstract method `_fetch` called.")}}class uz extends NX{async _fetch(e){const t=await Q1(e,"arraybuffer");return new Uint8Array(t)}}class jX{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Ns("Abstract method `_fetch` called.")}}class pz extends jX{async _fetch(e){const t=await Q1(e,"arraybuffer");return new Uint8Array(t)}}Fr&&st("Please use the `legacy` build in Node.js environments.");async function T3(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class Epe extends SX{}class kpe extends vX{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Tpe extends wX{async _fetch(e){return T3(e)}}class _pe extends NX{async _fetch(e){return T3(e)}}class Ppe extends jX{async _fetch(e){return T3(e)}}const xy="__forcedDependency",{floor:fz,ceil:mz}=Math;function Mk(n,e,t,s,i,r){n[e*4+0]=Math.min(n[e*4+0],t),n[e*4+1]=Math.min(n[e*4+1],s),n[e*4+2]=Math.max(n[e*4+2],i),n[e*4+3]=Math.max(n[e*4+3],r)}const pF=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var xw,yf;class Lpe{constructor(e,t){A(this,xw);A(this,yf);v(this,xw,e),v(this,yf,t)}get length(){return l(this,xw).length}isEmpty(e){return l(this,xw)[e]===pF}minX(e){return l(this,yf)[e*4+0]/256}minY(e){return l(this,yf)[e*4+1]/256}maxX(e){return(l(this,yf)[e*4+2]+1)/256}maxY(e){return(l(this,yf)[e*4+3]+1)/256}}xw=new WeakMap,yf=new WeakMap;const Fk=(n,e)=>{if(!n)return;let t=n.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},n.set(e,t)),t};var ra,aa,Hx,Gl,Vx,Yh,Yt,rs,Xh,oa,rA,yw,Gx,Wx,Kh,ur,nd,aA,fF;class Dpe{constructor(e,t,s=!1){A(this,aA);A(this,ra,{__proto__:null});A(this,aa,{__proto__:null,transform:[],moveText:[],sameLineText:[],[xy]:[]});A(this,Hx,new Map);A(this,Gl,[]);A(this,Vx,[]);A(this,Yh,[[1,0,0,1,0,0]]);A(this,Yt,[-1/0,-1/0,1/0,1/0]);A(this,rs,new Float64Array([1/0,1/0,-1/0,-1/0]));A(this,Xh,-1);A(this,oa,new Set);A(this,rA,new Map);A(this,yw,new Map);A(this,Gx);A(this,Wx);A(this,Kh);A(this,ur);A(this,nd);v(this,Gx,e.width),v(this,Wx,e.height),E(this,aA,fF).call(this,t),s&&v(this,nd,new Map)}growOperationsCount(e){e>=l(this,ur).length&&E(this,aA,fF).call(this,e,l(this,ur))}save(e){return v(this,ra,{__proto__:l(this,ra)}),v(this,aa,{__proto__:l(this,aa),transform:{__proto__:l(this,aa).transform},moveText:{__proto__:l(this,aa).moveText},sameLineText:{__proto__:l(this,aa).sameLineText},[xy]:{__proto__:l(this,aa)[xy]}}),v(this,Yt,{__proto__:l(this,Yt)}),l(this,Gl).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(l(this,ra));if(t===null)return this;v(this,ra,t),v(this,aa,Object.getPrototypeOf(l(this,aa))),v(this,Yt,Object.getPrototypeOf(l(this,Yt)));const s=l(this,Gl).pop();return s!==void 0&&((i=Fk(l(this,nd),e))==null||i.dependencies.add(s),l(this,ur)[e]=l(this,ur)[s]),this}recordOpenMarker(e){return l(this,Gl).push(e),this}getOpenMarker(){return l(this,Gl).length===0?null:l(this,Gl).at(-1)}recordCloseMarker(e){var s;const t=l(this,Gl).pop();return t!==void 0&&((s=Fk(l(this,nd),e))==null||s.dependencies.add(t),l(this,ur)[e]=l(this,ur)[t]),this}beginMarkedContent(e){return l(this,Vx).push(e),this}endMarkedContent(e){var s;const t=l(this,Vx).pop();return t!==void 0&&((s=Fk(l(this,nd),e))==null||s.dependencies.add(t),l(this,ur)[e]=l(this,ur)[t]),this}pushBaseTransform(e){return l(this,Yh).push(Ce.multiplyByDOMMatrix(l(this,Yh).at(-1),e.getTransform())),this}popBaseTransform(){return l(this,Yh).length>1&&l(this,Yh).pop(),this}recordSimpleData(e,t){return l(this,ra)[e]=t,this}recordIncrementalData(e,t){return l(this,aa)[e].push(t),this}resetIncrementalData(e,t){return l(this,aa)[e].length=0,this}recordNamedData(e,t){return l(this,Hx).set(e,t),this}recordSimpleDataFromNamed(e,t,s){l(this,ra)[e]=l(this,Hx).get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(xy,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in l(this,ra)&&this.recordFutureForcedDependency(t,l(this,ra)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of l(this,oa))this.recordFutureForcedDependency(xy,e);return this}resetBBox(e){return l(this,Xh)!==e&&(v(this,Xh,e),l(this,rs)[0]=1/0,l(this,rs)[1]=1/0,l(this,rs)[2]=-1/0,l(this,rs)[3]=-1/0),this}recordClipBox(e,t,s,i,r,o){const c=Ce.multiplyByDOMMatrix(l(this,Yh).at(-1),t.getTransform()),d=[1/0,1/0,-1/0,-1/0];Ce.axialAlignedBoundingBox([s,r,i,o],c,d);const h=Ce.intersect(l(this,Yt),d);return h?(l(this,Yt)[0]=h[0],l(this,Yt)[1]=h[1],l(this,Yt)[2]=h[2],l(this,Yt)[3]=h[3]):(l(this,Yt)[0]=l(this,Yt)[1]=1/0,l(this,Yt)[2]=l(this,Yt)[3]=-1/0),this}recordBBox(e,t,s,i,r,o){const c=l(this,Yt);if(c[0]===1/0)return this;const d=Ce.multiplyByDOMMatrix(l(this,Yh).at(-1),t.getTransform());if(c[0]===-1/0)return Ce.axialAlignedBoundingBox([s,r,i,o],d,l(this,rs)),this;const h=[1/0,1/0,-1/0,-1/0];return Ce.axialAlignedBoundingBox([s,r,i,o],d,h),l(this,rs)[0]=Math.min(l(this,rs)[0],Math.max(h[0],c[0])),l(this,rs)[1]=Math.min(l(this,rs)[1],Math.max(h[1],c[1])),l(this,rs)[2]=Math.max(l(this,rs)[2],Math.min(h[2],c[2])),l(this,rs)[3]=Math.max(l(this,rs)[3],Math.min(h[3],c[3])),this}recordCharacterBBox(e,t,s,i=1,r=0,o=0,c){const d=s.bbox;let h,u;if(d&&(h=d[2]!==d[0]&&d[3]!==d[1]&&l(this,yw).get(s),h!==!1&&(u=[0,0,0,0],Ce.axialAlignedBoundingBox(d,s.fontMatrix,u),(i!==1||r!==0||o!==0)&&Ce.scaleMinMax([i,0,0,-i,r,o],u),h)))return this.recordBBox(e,t,u[0],u[2],u[1],u[3]);if(!c)return this.recordFullPageBBox(e);const p=c();return d&&u&&h===void 0&&(h=u[0]<=r-p.actualBoundingBoxLeft&&u[2]>=r+p.actualBoundingBoxRight&&u[1]<=o-p.actualBoundingBoxAscent&&u[3]>=o+p.actualBoundingBoxDescent,l(this,yw).set(s,h),h)?this.recordBBox(e,t,u[0],u[2],u[1],u[3]):this.recordBBox(e,t,r-p.actualBoundingBoxLeft,r+p.actualBoundingBoxRight,o-p.actualBoundingBoxAscent,o+p.actualBoundingBoxDescent)}recordFullPageBBox(e){return l(this,rs)[0]=Math.max(0,l(this,Yt)[0]),l(this,rs)[1]=Math.max(0,l(this,Yt)[1]),l(this,rs)[2]=Math.min(l(this,Gx),l(this,Yt)[2]),l(this,rs)[3]=Math.min(l(this,Wx),l(this,Yt)[3]),this}getSimpleIndex(e){return l(this,ra)[e]}recordDependencies(e,t){const s=l(this,oa),i=l(this,ra),r=l(this,aa);for(const o of t)o in l(this,ra)?s.add(i[o]):o in r&&r[o].forEach(s.add,s);return this}recordNamedDependency(e,t){return l(this,Hx).has(t)&&l(this,oa).add(l(this,Hx).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[xy]),l(this,nd)){const s=Fk(l(this,nd),e),{dependencies:i}=s;l(this,oa).forEach(i.add,i),l(this,Gl).forEach(i.add,i),l(this,Vx).forEach(i.add,i),i.delete(e),s.isRenderingOperation=!0}if(l(this,Xh)===e){const s=fz(l(this,rs)[0]*256/l(this,Gx)),i=fz(l(this,rs)[1]*256/l(this,Wx)),r=mz(l(this,rs)[2]*256/l(this,Gx)),o=mz(l(this,rs)[3]*256/l(this,Wx));Mk(l(this,Kh),e,s,i,r,o);for(const c of l(this,oa))c!==e&&Mk(l(this,Kh),c,s,i,r,o);for(const c of l(this,Gl))c!==e&&Mk(l(this,Kh),c,s,i,r,o);for(const c of l(this,Vx))c!==e&&Mk(l(this,Kh),c,s,i,r,o);t||(l(this,oa).clear(),v(this,Xh,-1))}return this}recordShowTextOperation(e,t=!1){const s=Array.from(l(this,oa));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return l(this,Xh)===e&&(v(this,Xh,-1),l(this,Yt)[0]=Math.max(l(this,Yt)[0],l(this,rs)[0]),l(this,Yt)[1]=Math.max(l(this,Yt)[1],l(this,rs)[1]),l(this,Yt)[2]=Math.min(l(this,Yt)[2],l(this,rs)[2]),l(this,Yt)[3]=Math.min(l(this,Yt)[3],l(this,rs)[3]),t||l(this,oa).clear()),this}_takePendingDependencies(){const e=l(this,oa);return v(this,oa,new Set),e}_extractOperation(e){const t=l(this,rA).get(e);return l(this,rA).delete(e),t}_pushPendingDependencies(e){for(const t of e)l(this,oa).add(t)}take(){return l(this,yw).clear(),new Lpe(l(this,ur),l(this,Kh))}takeDebugMetadata(){return l(this,nd)}}ra=new WeakMap,aa=new WeakMap,Hx=new WeakMap,Gl=new WeakMap,Vx=new WeakMap,Yh=new WeakMap,Yt=new WeakMap,rs=new WeakMap,Xh=new WeakMap,oa=new WeakMap,rA=new WeakMap,yw=new WeakMap,Gx=new WeakMap,Wx=new WeakMap,Kh=new WeakMap,ur=new WeakMap,nd=new WeakMap,aA=new WeakSet,fF=function(e,t){const s=new ArrayBuffer(e*4);v(this,Kh,new Uint8ClampedArray(s)),v(this,ur,new Uint32Array(s)),t&&t.length>0?(l(this,ur).set(t),l(this,ur).fill(pF,t.length)):l(this,ur).fill(pF)};var xs,pn,Wl,bw,vw;const z3=class z3{constructor(e,t,s){A(this,xs);A(this,pn);A(this,Wl);A(this,bw,0);A(this,vw,0);if(e instanceof z3&&l(e,Wl)===!!s)return e;v(this,xs,e),v(this,pn,t),v(this,Wl,!!s)}growOperationsCount(){throw new Error("Unreachable")}save(e){return vt(this,vw)._++,l(this,xs).save(l(this,pn)),this}restore(e){return l(this,vw)>0&&(l(this,xs).restore(l(this,pn)),vt(this,vw)._--),this}recordOpenMarker(e){return vt(this,bw)._++,this}getOpenMarker(){return l(this,bw)>0?l(this,pn):l(this,xs).getOpenMarker()}recordCloseMarker(e){return vt(this,bw)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return l(this,xs).pushBaseTransform(e),this}popBaseTransform(){return l(this,xs).popBaseTransform(),this}recordSimpleData(e,t){return l(this,xs).recordSimpleData(e,l(this,pn)),this}recordIncrementalData(e,t){return l(this,xs).recordIncrementalData(e,l(this,pn)),this}resetIncrementalData(e,t){return l(this,xs).resetIncrementalData(e,l(this,pn)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return l(this,xs).recordSimpleDataFromNamed(e,t,l(this,pn)),this}recordFutureForcedDependency(e,t){return l(this,xs).recordFutureForcedDependency(e,l(this,pn)),this}inheritSimpleDataAsFutureForcedDependencies(e){return l(this,xs).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return l(this,xs).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return l(this,Wl)||l(this,xs).resetBBox(l(this,pn)),this}recordClipBox(e,t,s,i,r,o){return l(this,Wl)||l(this,xs).recordClipBox(l(this,pn),t,s,i,r,o),this}recordBBox(e,t,s,i,r,o){return l(this,Wl)||l(this,xs).recordBBox(l(this,pn),t,s,i,r,o),this}recordCharacterBBox(e,t,s,i,r,o,c){return l(this,Wl)||l(this,xs).recordCharacterBBox(l(this,pn),t,s,i,r,o,c),this}recordFullPageBBox(e){return l(this,Wl)||l(this,xs).recordFullPageBBox(l(this,pn)),this}getSimpleIndex(e){return l(this,xs).getSimpleIndex(e)}recordDependencies(e,t){return l(this,xs).recordDependencies(l(this,pn),t),this}recordNamedDependency(e,t){return l(this,xs).recordNamedDependency(l(this,pn),t),this}recordOperation(e){return l(this,xs).recordOperation(l(this,pn),!0),this}recordShowTextOperation(e){return l(this,xs).recordShowTextOperation(l(this,pn),!0),this}bboxToClipBoxDropOperation(e){return l(this,Wl)||l(this,xs).bboxToClipBoxDropOperation(l(this,pn),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};xs=new WeakMap,pn=new WeakMap,Wl=new WeakMap,bw=new WeakMap,vw=new WeakMap;let SP=z3;const Lo={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},zi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function mF(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),n.clip(i)}class _3{isModifyingCurrentTransform(){return!1}getPattern(){Ns("Abstract method `getPattern` called.")}}class Rpe extends _3{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let r;if(i===zi.STROKE||i===zi.FILL){const o=t.current.getClippedPathBoundingBox(i,Js(e))||[0,0,0,0],c=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,h=t.cachedCanvases.getCanvas("pattern",c,d),u=h.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),s=Ce.transform(s,[1,0,0,1,o[0],o[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),mF(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),r=e.createPattern(h.canvas,"no-repeat");const p=new DOMMatrix(s);r.setTransform(p)}else mF(e,this._bbox),r=this._createGradient(e);return r}}function IR(n,e,t,s,i,r,o,c){const d=e.coords,h=e.colors,u=n.data,p=n.width*4;let f;d[t+1]>d[s+1]&&(f=t,t=s,s=f,f=r,r=o,o=f),d[s+1]>d[i+1]&&(f=s,s=i,i=f,f=o,o=c,c=f),d[t+1]>d[s+1]&&(f=t,t=s,s=f,f=r,r=o,o=f);const m=(d[t]+e.offsetX)*e.scaleX,x=(d[t+1]+e.offsetY)*e.scaleY,g=(d[s]+e.offsetX)*e.scaleX,b=(d[s+1]+e.offsetY)*e.scaleY,y=(d[i]+e.offsetX)*e.scaleX,C=(d[i+1]+e.offsetY)*e.scaleY;if(x>=C)return;const w=h[r],S=h[r+1],j=h[r+2],T=h[o],k=h[o+1],_=h[o+2],L=h[c],D=h[c+1],P=h[c+2],I=Math.round(x),M=Math.round(C);let O,F,B,U,$,G,ne,Z;for(let K=I;K<=M;K++){if(K<b){const ie=K<x?0:(x-K)/(x-b);O=m-(m-g)*ie,F=w-(w-T)*ie,B=S-(S-k)*ie,U=j-(j-_)*ie}else{let ie;K>C?ie=1:b===C?ie=0:ie=(b-K)/(b-C),O=g-(g-y)*ie,F=T-(T-L)*ie,B=k-(k-D)*ie,U=_-(_-P)*ie}let X;K<x?X=0:K>C?X=1:X=(x-K)/(x-C),$=m-(m-y)*X,G=w-(w-L)*X,ne=S-(S-D)*X,Z=j-(j-P)*X;const V=Math.round(Math.min(O,$)),q=Math.round(Math.max(O,$));let ee=p*K+V*4;for(let ie=V;ie<=q;ie++)X=(O-ie)/(O-$),X<0?X=0:X>1&&(X=1),u[ee++]=F-(F-G)*X|0,u[ee++]=B-(B-ne)*X|0,u[ee++]=U-(U-Z)*X|0,u[ee++]=255}}function Ipe(n,e,t){const s=e.coords,i=e.colors;let r,o;switch(e.type){case"lattice":const c=e.verticesPerRow,d=Math.floor(s.length/c)-1,h=c-1;for(r=0;r<d;r++){let u=r*c;for(let p=0;p<h;p++,u++)IR(n,t,s[u],s[u+1],s[u+c],i[u],i[u+1],i[u+c]),IR(n,t,s[u+c+1],s[u+1],s[u+c],i[u+c+1],i[u+1],i[u+c])}break;case"triangles":for(r=0,o=s.length;r<o;r+=3)IR(n,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class Mpe extends _3{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const c=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-c,u=Math.ceil(this._bounds[3])-d,p=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),m=h/p,x=u/f,g={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-d,scaleX:1/m,scaleY:1/x},b=p+2*2,y=f+2*2,C=s.getCanvas("mesh",b,y),w=C.context,S=w.createImageData(p,f);if(t){const T=S.data;for(let k=0,_=T.length;k<_;k+=4)T[k]=t[0],T[k+1]=t[1],T[k+2]=t[2],T[k+3]=255}for(const T of this._figures)Ipe(S,T,g);return w.putImageData(S,2,2),{canvas:C.canvas,offsetX:c-2*m,offsetY:d-2*x,scaleX:m,scaleY:x}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){mF(e,this._bbox);const r=new Float32Array(2);if(i===zi.SHADING)Ce.singularValueDecompose2dScale(Js(e),r);else if(this.matrix){Ce.singularValueDecompose2dScale(this.matrix,r);const[c,d]=r;Ce.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=c,r[1]*=d}else Ce.singularValueDecompose2dScale(t.baseTransform,r);const o=this._createMeshCanvas(r,i===zi.SHADING?null:this._background,t.cachedCanvases);return i!==zi.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class Fpe extends _3{getPattern(){return"hotpink"}}function Ope(n){switch(n[0]){case"RadialAxial":return new Rpe(n);case"Mesh":return new Mpe(n);case"Dummy":return new Fpe}throw new Error(`Unknown IR type: ${n[0]}`)}const gz={COLORED:1,UNCOLORED:2},tL=class tL{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e,t){var G,ne;const{bbox:s,operatorList:i,paintType:r,tilingType:o,color:c,canvasGraphicsFactory:d}=this;let{xstep:h,ystep:u}=this;h=Math.abs(h),u=Math.abs(u),sD("TilingType: "+o);const p=s[0],f=s[1],m=s[2],x=s[3],g=m-p,b=x-f,y=new Float32Array(2);Ce.singularValueDecompose2dScale(this.matrix,y);const[C,w]=y;Ce.singularValueDecompose2dScale(this.baseTransform,y);const S=C*y[0],j=w*y[1];let T=g,k=b,_=!1,L=!1;const D=Math.ceil(h*S),P=Math.ceil(u*j),I=Math.ceil(g*S),M=Math.ceil(b*j);D>=I?T=h:_=!0,P>=M?k=u:L=!0;const O=this.getSizeAndScale(T,this.ctx.canvas.width,S),F=this.getSizeAndScale(k,this.ctx.canvas.height,j),B=e.cachedCanvases.getCanvas("pattern",O.size,F.size),U=B.context,$=d.createCanvasGraphics(U,t);if($.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext($,r,c),U.translate(-O.scale*p,-F.scale*f),$.transform(0,O.scale,0,0,F.scale,0,0),U.save(),(G=$.dependencyTracker)==null||G.save(),this.clipBbox($,p,f,m,x),$.baseTransform=Js($.ctx),$.executeOperatorList(i),$.endDrawing(),(ne=$.dependencyTracker)==null||ne.restore(),U.restore(),_||L){const Z=B.canvas;_&&(T=h),L&&(k=u);const K=this.getSizeAndScale(T,this.ctx.canvas.width,S),X=this.getSizeAndScale(k,this.ctx.canvas.height,j),V=K.size,q=X.size,ee=e.cachedCanvases.getCanvas("pattern-workaround",V,q),ie=ee.context,Re=_?Math.floor(g/h):0,Ye=L?Math.floor(b/u):0;for(let Le=0;Le<=Re;Le++)for(let te=0;te<=Ye;te++)ie.drawImage(Z,V*Le,q*te,V,q,0,0,V,q);return{canvas:ee.canvas,scaleX:K.scale,scaleY:X.scale,offsetX:p,offsetY:f}}return{canvas:B.canvas,scaleX:O.scale,scaleY:F.scale,offsetX:p,offsetY:f}}getSizeAndScale(e,t,s){const i=Math.max(tL.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const o=i-t,c=r-s;e.ctx.rect(t,s,o,c),Ce.axialAlignedBoundingBox([t,s,i,r],Js(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case gz.COLORED:const{fillStyle:o,strokeStyle:c}=this.ctx;i.fillStyle=r.fillColor=o,i.strokeStyle=r.strokeColor=c;break;case gz.UNCOLORED:i.fillStyle=i.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new rpe(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i,r){let o=s;i!==zi.SHADING&&(o=Ce.transform(o,t.baseTransform),this.matrix&&(o=Ce.transform(o,this.matrix)));const c=this.createPatternCanvas(t,r);let d=new DOMMatrix(o);d=d.translate(c.offsetX,c.offsetY),d=d.scale(1/c.scaleX,1/c.scaleY);const h=e.createPattern(c.canvas,"repeat");return h.setTransform(d),h}};W(tL,"MAX_PATTERN_SIZE",3e3);let gF=tL;function Bpe({src:n,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const c=wi.isLittleEndian?4278190080:255,[d,h]=o?[r,c]:[c,r],u=s>>3,p=s&7,f=n.length;t=new Uint32Array(t.buffer);let m=0;for(let x=0;x<i;x++){for(const b=e+u;e<b;e++){const y=e<f?n[e]:255;t[m++]=y&128?h:d,t[m++]=y&64?h:d,t[m++]=y&32?h:d,t[m++]=y&16?h:d,t[m++]=y&8?h:d,t[m++]=y&4?h:d,t[m++]=y&2?h:d,t[m++]=y&1?h:d}if(p===0)continue;const g=e<f?n[e++]:255;for(let b=0;b<p;b++)t[m++]=g&1<<7-b?h:d}return{srcPos:e,destPos:m}}const xz=16,yz=100,$pe=15,bz=10,pa=16,MR=new DOMMatrix,ho=new Float32Array(2),sb=new Float32Array([1/0,1/0,-1/0,-1/0]);function Upe(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},n.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},n.transform=function(t,s,i,r,o,c){e.transform(t,s,i,r,o,c),this.__originalTransform(t,s,i,r,o,c)},n.setTransform=function(t,s,i,r,o,c){e.setTransform(t,s,i,r,o,c),this.__originalSetTransform(t,s,i,r,o,c)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(t){e.rotate(t),this.__originalRotate(t)},n.clip=function(t){e.clip(t),this.__originalClip(t)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,i,r,o,c){e.bezierCurveTo(t,s,i,r,o,c),this.__originalBezierCurveTo(t,s,i,r,o,c)},n.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class zpe{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Ok(n,e,t,s,i,r,o,c,d,h){const[u,p,f,m,x,g]=Js(n);if(p===0&&f===0){const C=o*u+x,w=Math.round(C),S=c*m+g,j=Math.round(S),T=(o+d)*u+x,k=Math.abs(Math.round(T)-w)||1,_=(c+h)*m+g,L=Math.abs(Math.round(_)-j)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(m),w,j),n.drawImage(e,t,s,i,r,0,0,k,L),n.setTransform(u,p,f,m,x,g),[k,L]}if(u===0&&m===0){const C=c*f+x,w=Math.round(C),S=o*p+g,j=Math.round(S),T=(c+h)*f+x,k=Math.abs(Math.round(T)-w)||1,_=(o+d)*p+g,L=Math.abs(Math.round(_)-j)||1;return n.setTransform(0,Math.sign(p),Math.sign(f),0,w,j),n.drawImage(e,t,s,i,r,0,0,L,k),n.setTransform(u,p,f,m,x,g),[L,k]}n.drawImage(e,t,s,i,r,o,c,d,h);const b=Math.hypot(u,p),y=Math.hypot(f,m);return[b*d,y*h]}class vz{constructor(e,t,s){W(this,"alphaIsShape",!1);W(this,"fontSize",0);W(this,"fontSizeScale",1);W(this,"textMatrix",null);W(this,"textMatrixScale",1);W(this,"fontMatrix",z4);W(this,"leading",0);W(this,"x",0);W(this,"y",0);W(this,"lineX",0);W(this,"lineY",0);W(this,"charSpacing",0);W(this,"wordSpacing",0);W(this,"textHScale",1);W(this,"textRenderingMode",Ei.FILL);W(this,"textRise",0);W(this,"fillColor","#000000");W(this,"strokeColor","#000000");W(this,"patternFill",!1);W(this,"patternStroke",!1);W(this,"fillAlpha",1);W(this,"strokeAlpha",1);W(this,"lineWidth",1);W(this,"activeSMask",null);W(this,"transferMaps","none");s==null||s(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=sb.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=zi.FILL,t=null){const s=this.minMax.slice();if(e===zi.STROKE){t||Ns("Stroke bounding box must include transform."),Ce.singularValueDecompose2dScale(t,ho);const i=ho[0]*this.lineWidth/2,r=ho[1]*this.lineWidth/2;s[0]-=i,s[1]-=r,s[2]+=i,s[3]+=r}return s}updateClipFromPath(){const e=Ce.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(sb,0)}getClippedPathBoundingBox(e=zi.FILL,t=null){return Ce.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function wz(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%pa,r=(t-i)/pa,o=i===0?r:r+1,c=n.createImageData(s,pa);let d=0,h;const u=e.data,p=c.data;let f,m,x,g;if(e.kind===QC.GRAYSCALE_1BPP){const b=u.byteLength,y=new Uint32Array(p.buffer,0,p.byteLength>>2),C=y.length,w=s+7>>3,S=4294967295,j=wi.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(x=f<r?pa:i,h=0,m=0;m<x;m++){const T=b-d;let k=0;const _=T>w?s:T*8-7,L=_&-8;let D=0,P=0;for(;k<L;k+=8)P=u[d++],y[h++]=P&128?S:j,y[h++]=P&64?S:j,y[h++]=P&32?S:j,y[h++]=P&16?S:j,y[h++]=P&8?S:j,y[h++]=P&4?S:j,y[h++]=P&2?S:j,y[h++]=P&1?S:j;for(;k<_;k++)D===0&&(P=u[d++],D=128),y[h++]=P&D?S:j,D>>=1}for(;h<C;)y[h++]=0;n.putImageData(c,0,f*pa)}}else if(e.kind===QC.RGBA_32BPP){for(m=0,g=s*pa*4,f=0;f<r;f++)p.set(u.subarray(d,d+g)),d+=g,n.putImageData(c,0,m),m+=pa;f<o&&(g=s*i*4,p.set(u.subarray(d,d+g)),n.putImageData(c,0,m))}else if(e.kind===QC.RGB_24BPP)for(x=pa,g=s*x,f=0;f<o;f++){for(f>=r&&(x=i,g=s*x),h=0,m=g;m--;)p[h++]=u[d++],p[h++]=u[d++],p[h++]=u[d++],p[h++]=255;n.putImageData(c,0,f*pa)}else throw new Error(`bad image kind: ${e.kind}`)}function Sz(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%pa,r=(t-i)/pa,o=i===0?r:r+1,c=n.createImageData(s,pa);let d=0;const h=e.data,u=c.data;for(let p=0;p<o;p++){const f=p<r?pa:i;({srcPos:d}=Bpe({src:h,srcPos:d,dest:u,width:s,height:f,nonBlackColor:0})),n.putImageData(c,0,p*pa)}}function _S(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Bk(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}function Cz(n,e){if(e)return!0;Ce.singularValueDecompose2dScale(n,ho);const t=Math.fround(cc.pixelRatio*Fu.PDF_TO_CSS_UNITS);return ho[0]<=t&&ho[1]<=t}const Hpe=["butt","round","square"],Vpe=["miter","round","bevel"],Gpe={},Nz={};var hc,xF,yF,bF;const H3=class H3{constructor(e,t,s,i,r,{optionalContentConfig:o,markedContentStack:c=null},d,h,u){A(this,hc);this.ctx=e,this.current=new vz(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=o,this.cachedCanvases=new zpe(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=u??null}getObject(e,t,s=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=c,s){const d=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...Js(this.compositeCtx))}this.ctx.save(),Bk(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Js(this.ctx)}executeOperatorList(e,t,s,i,r){var y;const o=e.argsArray,c=e.fnArray;let d=t||0;const h=o.length;if(h===d)return d;const u=h-d>bz&&typeof s=="function",p=u?Date.now()+$pe:0;let f=0;const m=this.commonObjs,x=this.objs;let g,b;for(;;){if(i!==void 0&&d===i.nextBreakPoint)return i.breakIt(d,s),d;if(!r||r(d))if(g=c[d],b=o[d]??null,g!==F1.dependency)b===null?this[g](d):this[g](d,...b);else for(const C of b){(y=this.dependencyTracker)==null||y.recordNamedData(C,d);const w=C.startsWith("g_")?m:x;if(!w.has(C))return w.get(C,s),d}if(d++,d===h)return d;if(u&&++f>bz){if(Date.now()>p)return s(),d;f=0}}}endDrawing(){E(this,hc,xF).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),E(this,hc,yF).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),c=s,d=i,h="prescale1",u,p;for(;r>2&&c>1||o>2&&d>1;){let f=c,m=d;r>2&&c>1&&(f=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),r/=c/f),o>2&&d>1&&(m=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/m),u=this.cachedCanvases.getCanvas(h,f,m),p=u.context,p.clearRect(0,0,f,m),p.drawImage(e,0,0,c,d,0,0,f,m),e=u.canvas,c=f,d=m,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:c,paintHeight:d}}_createMaskCanvas(e,t){var D,P;const s=this.ctx,{width:i,height:r}=t,o=this.current.fillColor,c=this.current.patternFill,d=Js(s);let h,u,p,f;if((t.bitmap||t.data)&&t.count>1){const I=t.bitmap||t.data.buffer;u=JSON.stringify(c?d:[d.slice(0,4),o]),h=this._cachedBitmapsMap.get(I),h||(h=new Map,this._cachedBitmapsMap.set(I,h));const M=h.get(u);if(M&&!c){const O=Math.round(Math.min(d[0],d[2])+d[4]),F=Math.round(Math.min(d[1],d[3])+d[5]);return(D=this.dependencyTracker)==null||D.recordDependencies(e,Lo.transformAndFill),{canvas:M,offsetX:O,offsetY:F}}p=M}p||(f=this.cachedCanvases.getCanvas("maskCanvas",i,r),Sz(f.context,t));let m=Ce.transform(d,[1/i,0,0,-1/r,0,0]);m=Ce.transform(m,[1,0,0,1,0,-r]);const x=sb.slice();Ce.axialAlignedBoundingBox([0,0,i,r],m,x);const[g,b,y,C]=x,w=Math.round(y-g)||1,S=Math.round(C-b)||1,j=this.cachedCanvases.getCanvas("fillCanvas",w,S),T=j.context,k=g,_=b;T.translate(-k,-_),T.transform(...m),p||(p=this._scaleImage(f.canvas,bc(T)),p=p.img,h&&c&&h.set(u,p)),T.imageSmoothingEnabled=Cz(Js(T),t.interpolate),Ok(T,p,0,0,p.width,p.height,0,0,i,r),T.globalCompositeOperation="source-in";const L=Ce.transform(bc(T),[1,0,0,1,-k,-_]);return T.fillStyle=c?o.getPattern(s,this,L,zi.FILL,e):o,T.fillRect(0,0,i,r),h&&!c&&(this.cachedCanvases.delete("fillCanvas"),h.set(u,j.canvas)),(P=this.dependencyTracker)==null||P.recordDependencies(e,Lo.transformAndFill),{canvas:j.canvas,offsetX:Math.round(k),offsetY:Math.round(_)}}setLineWidth(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineCap",e),this.ctx.lineCap=Hpe[t]}setLineJoin(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Vpe[t]}setMiterLimit(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var s,i,r,o,c;for(const[d,h]of t)switch(d){case"LW":this.setLineWidth(e,h);break;case"LC":this.setLineCap(e,h);break;case"LJ":this.setLineJoin(e,h);break;case"ML":this.setMiterLimit(e,h);break;case"D":this.setDash(e,h[0],h[1]);break;case"RI":this.setRenderingIntent(e,h);break;case"FL":this.setFlatness(e,h);break;case"Font":this.setFont(e,h[0],h[1]);break;case"CA":(s=this.dependencyTracker)==null||s.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=h;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=h;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=h;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=h?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(c=this.dependencyTracker)==null||c.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(h);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,t,s);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),_S(this.suspendedCtx,o),Upe(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),_S(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],o=i[1],c=i[2]-r,d=i[3]-o;c===0||d===0||(this.genericComposeSMask(t.context,s,c,d,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,o,c,d,h,u,p){let f=e.canvas,m=d-u,x=h-p;if(o)if(m<0||x<0||m+s>f.width||x+i>f.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,i),y=b.context;y.drawImage(f,-m,-x),y.globalCompositeOperation="destination-atop",y.fillStyle=o,y.fillRect(0,0,s,i),y.globalCompositeOperation="source-over",f=b.canvas,m=x=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(m,x,s,i),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(m,x,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&c?t.filter=this.filterFactory.addAlphaFilter(c):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(c));const g=new Path2D;g.rect(d,h,s,i),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(f,m,x,s,i,d,h,s,i),t.restore()}save(e){var s;this.inSMaskMode&&_S(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(s=this.dependencyTracker)==null||s.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&_S(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,r,o,c){var d;(d=this.dependencyTracker)==null||d.recordIncrementalData("transform",e),this.ctx.transform(t,s,i,r,o,c),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,i){let[r]=s;if(!i){r||(r=s[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const o=t===F1.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-o,i[2]+o,i[1]-o,i[3]+o).recordDependencies(e,["transform"])}if(!(r instanceof Path2D)){const o=s[0]=new Path2D;for(let c=0,d=r.length;c<d;)switch(r[c++]){case Lk.moveTo:o.moveTo(r[c++],r[c++]);break;case Lk.lineTo:o.lineTo(r[c++],r[c++]);break;case Lk.curveTo:o.bezierCurveTo(r[c++],r[c++],r[c++],r[c++],r[c++],r[c++]);break;case Lk.closePath:o.closePath();break;default:st(`Unrecognized drawing path operator: ${r[c-1]}`);break}r=o}Ce.axialAlignedBoundingBox(i,Js(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){var o;const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const c=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,bc(i),zi.STROKE,e),c){const d=new Path2D;d.addPath(t,i.getTransform().invertSelf().multiplySelf(c)),t=d}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,Lo.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(zi.STROKE,Js(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){var h,u,p;const i=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let c=!1;if(o){const f=r.isModifyingCurrentTransform()?i.getTransform():null;if((h=this.dependencyTracker)==null||h.save(e),i.save(),i.fillStyle=r.getPattern(i,this,bc(i),zi.FILL,e),f){const m=new Path2D;m.addPath(t,i.getTransform().invertSelf().multiplySelf(f)),t=m}c=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(u=this.dependencyTracker)==null||u.recordDependencies(e,Lo.fill),c&&(i.restore(),(p=this.dependencyTracker)==null||p.restore(e)),s&&this.consumePath(e,t,d)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var s;this.ctx.fill(t),(s=this.dependencyTracker)==null||s.recordDependencies(e,Lo.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=Gpe}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=Nz}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,r=s.getTransform().invertSelf();for(const{transform:o,x:c,y:d,fontSize:h,path:u}of t)u&&i.addPath(u,new DOMMatrix(o).preMultiplySelf(r).translate(c,d).scale(h,-h));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){var p,f;(p=this.dependencyTracker)==null||p.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),r=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=i.fontMatrix||z4,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&st("Invalid font matrix for font "+t),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const o=i.loadedName||"sans-serif",c=((f=i.systemFontInfo)==null?void 0:f.css)||`"${o}", ${i.fallbackName}`;let d="normal";i.black?d="900":i.bold&&(d="bold");const h=i.italic?"italic":"normal";let u=s;s<xz?u=xz:s>yz&&(u=yz),this.current.fontSizeScale=s/u,this.ctx.font=`${h} ${d} ${u}px ${c}`}setTextRenderingMode(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,s,i,r,o){var y,C,w,S;const c=this.ctx,d=this.current,h=d.font,u=d.textRenderingMode,p=d.fontSize/d.fontSizeScale,f=u&Ei.FILL_STROKE_MASK,m=!!(u&Ei.ADD_TO_PATH_FLAG),x=d.patternFill&&!h.missingFile,g=d.patternStroke&&!h.missingFile;let b;if((h.disableFontFace||m||x||g)&&!h.missingFile&&(b=h.getPathGenerator(this.commonObjs,t)),b&&(h.disableFontFace||x||g)){c.save(),c.translate(s,i),c.scale(p,-p),(y=this.dependencyTracker)==null||y.recordCharacterBBox(e,c,h);let j;if(f===Ei.FILL||f===Ei.FILL_STROKE)if(r){j=c.getTransform(),c.setTransform(...r);const T=E(this,hc,bF).call(this,b,j,r);c.fill(T)}else c.fill(b);if(f===Ei.STROKE||f===Ei.FILL_STROKE)if(o){j||(j=c.getTransform()),c.setTransform(...o);const{a:T,b:k,c:_,d:L}=j,D=Ce.inverseTransform(o),P=Ce.transform([T,k,_,L,0,0],D);Ce.singularValueDecompose2dScale(P,ho),c.lineWidth*=Math.max(ho[0],ho[1])/p,c.stroke(E(this,hc,bF).call(this,b,j,o))}else c.lineWidth/=p,c.stroke(b);c.restore()}else(f===Ei.FILL||f===Ei.FILL_STROKE)&&(c.fillText(t,s,i),(C=this.dependencyTracker)==null||C.recordCharacterBBox(e,c,h,p,s,i,()=>c.measureText(t))),(f===Ei.STROKE||f===Ei.FILL_STROKE)&&(this.dependencyTracker&&((w=this.dependencyTracker)==null||w.recordCharacterBBox(e,c,h,p,s,i,()=>c.measureText(t)).recordDependencies(e,Lo.stroke)),c.strokeText(t,s,i));m&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Js(c),x:s,y:i,fontSize:p,path:b}),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,c,h,p,s,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return ct(this,"isFontSubpixelAAEnabled",s)}showText(e,t){var _,L,D,P;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Lo.showText).resetBBox(e),this.current.textRenderingMode&Ei.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(e,t),(_=this.dependencyTracker)==null||_.recordShowTextOperation(e);return}const r=s.fontSize;if(r===0){(L=this.dependencyTracker)==null||L.recordOperation(e);return}const o=this.ctx,c=s.fontSizeScale,d=s.charSpacing,h=s.wordSpacing,u=s.fontDirection,p=s.textHScale*u,f=t.length,m=i.vertical,x=m?1:-1,g=i.defaultVMetrics,b=r*s.fontMatrix[0],y=s.textRenderingMode===Ei.FILL&&!i.disableFontFace&&!s.patternFill;o.save(),s.textMatrix&&o.transform(...s.textMatrix),o.translate(s.x,s.y+s.textRise),u>0?o.scale(p,-1):o.scale(p,1);let C,w;if(s.patternFill){o.save();const I=s.fillColor.getPattern(o,this,bc(o),zi.FILL,e);C=Js(o),o.restore(),o.fillStyle=I}if(s.patternStroke){o.save();const I=s.strokeColor.getPattern(o,this,bc(o),zi.STROKE,e);w=Js(o),o.restore(),o.strokeStyle=I}let S=s.lineWidth;const j=s.textMatrixScale;if(j===0||S===0){const I=s.textRenderingMode&Ei.FILL_STROKE_MASK;(I===Ei.STROKE||I===Ei.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=j;if(c!==1&&(o.scale(c,c),S/=c),o.lineWidth=S,i.isInvalidPDFjsFont){const I=[];let M=0;for(const F of t)I.push(F.unicode),M+=F.width;const O=I.join("");if(o.fillText(O,0,0),this.dependencyTracker!==null){const F=o.measureText(O);this.dependencyTracker.recordBBox(e,this.ctx,-F.actualBoundingBoxLeft,F.actualBoundingBoxRight,-F.actualBoundingBoxAscent,F.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=M*b*p,o.restore(),this.compose();return}let T=0,k;for(k=0;k<f;++k){const I=t[k];if(typeof I=="number"){T+=x*I*r/1e3;continue}let M=!1;const O=(I.isSpace?h:0)+d,F=I.fontChar,B=I.accent;let U,$,G=I.width;if(m){const K=I.vmetric||g,X=-(I.vmetric?K[1]:G*.5)*b,V=K[2]*b;G=K?-K[0]:G,U=X/c,$=(T+V)/c}else U=T/c,$=0;let ne;if(i.remeasure&&G>0){ne=o.measureText(F);const K=ne.width*1e3/r*c;if(G<K&&this.isFontSubpixelAAEnabled){const X=G/K;M=!0,o.save(),o.scale(X,1),U/=X}else G!==K&&(U+=(G-K)/2e3*r/c)}if(this.contentVisible&&(I.isInFont||i.missingFile)){if(y&&!B)o.fillText(F,U,$),(D=this.dependencyTracker)==null||D.recordCharacterBBox(e,o,ne?{bbox:null}:i,r/c,U,$,()=>ne??o.measureText(F));else if(this.paintChar(e,F,U,$,C,w),B){const K=U+r*B.offset.x/c,X=$-r*B.offset.y/c;this.paintChar(e,B.fontChar,K,X,C,w)}}const Z=m?G*b-O*u:G*b+O*u;T+=Z,M&&o.restore()}m?s.y-=T:s.x+=T*p,o.restore(),this.compose(),(P=this.dependencyTracker)==null||P.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,i=this.current,r=i.font,o=i.fontSize,c=i.fontDirection,d=r.vertical?1:-1,h=i.charSpacing,u=i.wordSpacing,p=i.textHScale*c,f=i.fontMatrix||z4,m=t.length,x=i.textRenderingMode===Ei.INVISIBLE;let g,b,y,C;if(x||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(p,c);const w=this.dependencyTracker;for(this.dependencyTracker=w?new SP(w,e):null,g=0;g<m;++g){if(b=t[g],typeof b=="number"){C=d*b*o/1e3,this.ctx.translate(C,0),i.x+=C*p;continue}const S=(b.isSpace?u:0)+h,j=r.charProcOperatorList[b.operatorListId];j?this.contentVisible&&(this.save(),s.scale(o,o),s.transform(...f),this.executeOperatorList(j),this.restore()):st(`Type3 character "${b.operatorListId}" is not available.`);const T=[b.width,0];Ce.applyTransform(T,f),y=T[0]*o+S,s.translate(y,0),i.x+=y*p}s.restore(),w&&(this.dependencyTracker=w)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,i,r,o,c){var h;const d=new Path2D;d.rect(i,r,o-i,c-r),this.ctx.clip(d),(h=this.dependencyTracker)==null||h.recordBBox(e,this.ctx,i,o,r,c).recordClipBox(e,this.ctx,i,o,r,c),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const i=this.baseTransform||Js(this.ctx),r={createCanvasGraphics:(o,c)=>new H3(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new SP(this.dependencyTracker,c,!0):null)};s=new gF(t,this.ctx,r,i)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=Ope(this.getObject(e,t)),this.cachedPatterns.set(t,i)),s&&(i.matrix=s),i}shadingFill(e,t){var o;if(!this.contentVisible)return;const s=this.ctx;this.save(e);const i=this._getPattern(e,t);s.fillStyle=i.getPattern(s,this,bc(s),zi.SHADING,e);const r=bc(s);if(r){const{width:c,height:d}=s.canvas,h=sb.slice();Ce.axialAlignedBoundingBox([0,0,c,d],r,h);const[u,p,f,m]=h;this.ctx.fillRect(u,p,f-u,m-p)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Lo.transform).recordDependencies(e,Lo.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Ns("Should not call beginInlineImage")}beginImageData(){Ns("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Js(this.ctx),s)){Ce.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[r,o,c,d]=s,h=new Path2D;h.rect(r,o,c-r,d-o),this.ctx.clip(h),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,r,c,o,d),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var w;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||sD("TODO: Support non-isolated groups."),t.knockout&&st("Knockout groups not supported.");const i=Js(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=sb.slice();Ce.axialAlignedBoundingBox(t.bbox,Js(s),r);const o=[0,0,s.canvas.width,s.canvas.height];r=Ce.intersect(r,o)||[0,0,0,0];const c=Math.floor(r[0]),d=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-c,1),u=Math.max(Math.ceil(r[3])-d,1);this.current.startNewPathAndClipBox([0,0,h,u]);let p="groupAt"+this.groupLevel;t.smask&&(p+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(p,h,u),m=f.context;m.translate(-c,-d),m.transform(...i);let x=new Path2D;const[g,b,y,C]=t.bbox;if(x.rect(g,b,y-g,C-b),t.matrix){const S=new Path2D;S.addPath(x,new DOMMatrix(t.matrix)),x=S}m.clip(x),t.smask&&this.smaskStack.push({canvas:f.canvas,context:m,offsetX:c,offsetY:d,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(c,d),s.save()),_S(s,m),this.ctx=m,(w=this.dependencyTracker)==null||w.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Js(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const c=sb.slice();Ce.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],o,c),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(c)}}beginAnnotation(e,t,s,i,r,o){if(E(this,hc,xF).call(this),Bk(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const c=s[2]-s[0],d=s[3]-s[1];if(o&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=c,s[3]=d,Ce.singularValueDecompose2dScale(Js(this.ctx),ho);const{viewportScale:h}=this,u=Math.ceil(c*this.outputScaleX*h),p=Math.ceil(d*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(u,p);const{canvas:f,context:m}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=m,this.ctx.save(),this.ctx.setTransform(ho[0],0,0,-ho[1],0,d*ho[1]),Bk(this.ctx)}else{Bk(this.ctx),this.endPath(e);const h=new Path2D;h.rect(s[0],s[1],c,d),this.ctx.clip(h)}}this.current=new vz(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),E(this,hc,yF).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var c;if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const i=this.ctx,r=this._createMaskCanvas(e,t),o=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,r.offsetX,r.offsetY),(c=this.dependencyTracker)==null||c.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,i=0,r=0,o,c){var p,f,m;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const d=this.ctx;d.save();const h=Js(d);d.transform(s,i,r,o,0,0);const u=this._createMaskCanvas(e,t);d.setTransform(1,0,0,1,u.offsetX-h[4],u.offsetY-h[5]),(p=this.dependencyTracker)==null||p.resetBBox(e);for(let x=0,g=c.length;x<g;x+=2){const b=Ce.transform(h,[s,i,r,o,c[x],c[x+1]]);d.drawImage(u.canvas,b[4],b[5]),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,b[4],b[4]+u.canvas.width,b[5],b[5]+u.canvas.height)}d.restore(),this.compose(),(m=this.dependencyTracker)==null||m.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,c,d;if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,r=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,Lo.transformAndFill);for(const h of t){const{data:u,width:p,height:f,transform:m}=h,x=this.cachedCanvases.getCanvas("maskCanvas",p,f),g=x.context;g.save();const b=this.getObject(e,u,h);Sz(g,b),g.globalCompositeOperation="source-in",g.fillStyle=r?i.getPattern(g,this,bc(s),zi.FILL,e):i,g.fillRect(0,0,p,f),g.restore(),s.save(),s.transform(...m),s.scale(1,-1),Ok(s,x.canvas,0,0,p,f,0,-1,1,1),(c=this.dependencyTracker)==null||c.recordBBox(e,s,0,p,0,f),s.restore()}this.compose(),(d=this.dependencyTracker)==null||d.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){st("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,i,r){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){st("Dependent image isn't ready yet");return}const c=o.width,d=o.height,h=[];for(let u=0,p=r.length;u<p;u+=2)h.push({transform:[s,0,0,i,r[u],r[u+1]],x:0,y:0,w:c,h:d});this.paintInlineImageXObjectGroup(e,o,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e,t){var h;if(!this.contentVisible)return;const s=t.width,i=t.height,r=this.ctx;this.save(e);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/s,-1/i);let c;if(t.bitmap)c=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)c=t;else{const p=this.cachedCanvases.getCanvas("inlineImage",s,i).context;wz(p,t),c=this.applyTransferMapsToCanvas(p)}const d=this._scaleImage(c,bc(r));r.imageSmoothingEnabled=Cz(Js(r),t.interpolate),(h=this.dependencyTracker)==null||h.resetBBox(e).recordBBox(e,r,0,s,-i,0).recordDependencies(e,Lo.imageXObject).recordOperation(e),Ok(r,d.img,0,0,d.paintWidth,d.paintHeight,0,-i,s,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){var o,c,d;if(!this.contentVisible)return;const i=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const h=t.width,u=t.height,f=this.cachedCanvases.getCanvas("inlineImage",h,u).context;wz(f,t),r=this.applyTransferMapsToCanvas(f)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const h of s)i.save(),i.transform(...h.transform),i.scale(1,-1),Ok(i,r,h.x,h.y,h.w,h.h,0,-1,1,1),(c=this.dependencyTracker)==null||c.recordBBox(e,i,0,1,-1,0),i.restore();(d=this.dependencyTracker)==null||d.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Lo.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){var o,c;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===Nz?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(c=this.dependencyTracker)==null||c.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Js(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let o,c;if(s===0&&i===0){const d=Math.abs(t),h=Math.abs(r);if(d===h)if(e===0)o=c=1/d;else{const u=d*e;o=c=u<1?1/u:1}else if(e===0)o=1/d,c=1/h;else{const u=d*e,p=h*e;o=u<1?1/u:1,c=p<1?1/p:1}}else{const d=Math.abs(t*r-s*i),h=Math.hypot(t,s),u=Math.hypot(i,r);if(e===0)o=u/d,c=h/d;else{const p=e*d;o=u>p?u/p:1,c=h>p?h/p:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[r,o]=this.getScaleForStroking();if(r===o){s.lineWidth=(i||1)*r,s.stroke(e);return}const c=s.getLineDash();t&&s.save(),s.scale(r,o),MR.a=1/r,MR.d=1/o;const d=new Path2D;if(d.addPath(e,MR),c.length>0){const h=Math.max(r,o);s.setLineDash(c.map(u=>u/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(d),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};hc=new WeakSet,xF=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},yF=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},bF=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let fb=H3;for(const n in F1)fb.prototype[n]!==void 0&&(fb.prototype[F1[n]]=fb.prototype[n]);var ww,Sw,oA,Cw,n_;const ib=class ib{constructor(e){A(this,Cw);A(this,ww);A(this,Sw);A(this,oA);v(this,ww,e),v(this,Sw,new DataView(l(this,ww))),v(this,oA,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const h of ib.strings){const u=t.encode(e[h]);s[h]=u,i+=4+u.length}const r=new ArrayBuffer(i),o=new Uint8Array(r),c=new DataView(r);let d=0;for(const h of ib.strings){const u=s[h],p=u.length;c.setUint32(d,p),o.set(u,d+4),d+=4+p}return Et(d===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return E(this,Cw,n_).call(this,0)}get fontWeight(){return E(this,Cw,n_).call(this,1)}get italicAngle(){return E(this,Cw,n_).call(this,2)}};ww=new WeakMap,Sw=new WeakMap,oA=new WeakMap,Cw=new WeakSet,n_=function(e){Et(e<ib.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=l(this,Sw).getUint32(t)+4;const s=l(this,Sw).getUint32(t);return l(this,oA).decode(new Uint8Array(l(this,ww),t+4,s))},W(ib,"strings",["fontFamily","fontWeight","italicAngle"]);let CP=ib;var bf,id,qx,Yx,NC;const rb=class rb{constructor(e){A(this,Yx);A(this,bf);A(this,id);A(this,qx);v(this,bf,e),v(this,id,new DataView(l(this,bf))),v(this,qx,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const f of rb.strings){const m=t.encode(e[f]);s[f]=m,i+=4+m.length}i+=4;let r,o,c=1+i;e.style&&(r=t.encode(e.style.style),o=t.encode(e.style.weight),c+=4+r.length+4+o.length);const d=new ArrayBuffer(c),h=new Uint8Array(d),u=new DataView(d);let p=0;u.setUint8(p++,e.guessFallback?1:0),u.setUint32(p,0),p+=4,i=0;for(const f of rb.strings){const m=s[f],x=m.length;i+=4+x,u.setUint32(p,x),h.set(m,p+4),p+=4+x}return u.setUint32(p-i-4,i),e.style&&(u.setUint32(p,r.length),h.set(r,p+4),p+=4+r.length,u.setUint32(p,o.length),h.set(o,p+4),p+=4+o.length),Et(p<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(p)}get guessFallback(){return l(this,id).getUint8(0)!==0}get css(){return E(this,Yx,NC).call(this,0)}get loadedName(){return E(this,Yx,NC).call(this,1)}get baseFontName(){return E(this,Yx,NC).call(this,2)}get src(){return E(this,Yx,NC).call(this,3)}get style(){let e=1;e+=4+l(this,id).getUint32(e);const t=l(this,id).getUint32(e),s=l(this,qx).decode(new Uint8Array(l(this,bf),e+4,t));e+=4+t;const i=l(this,id).getUint32(e),r=l(this,qx).decode(new Uint8Array(l(this,bf),e+4,i));return{style:s,weight:r}}};bf=new WeakMap,id=new WeakMap,qx=new WeakMap,Yx=new WeakSet,NC=function(e){Et(e<rb.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=l(this,id).getUint32(t)+4;const s=l(this,id).getUint32(t);return l(this,qx).decode(new Uint8Array(l(this,bf),t+4,s))},W(rb,"strings",["css","loadedName","baseFontName","src"]);let NP=rb;var Nw,jw,Aw,Ew,Ga,rd,lA,as,vn,jl,i_,jC;const at=class at{constructor({data:e,extra:t}){A(this,vn);A(this,rd);A(this,lA);A(this,as);v(this,rd,e),v(this,lA,new TextDecoder),v(this,as,new DataView(l(this,rd))),t&&Object.assign(this,t)}get black(){return E(this,vn,jl).call(this,0)}get bold(){return E(this,vn,jl).call(this,1)}get disableFontFace(){return E(this,vn,jl).call(this,2)}get fontExtraProperties(){return E(this,vn,jl).call(this,3)}get isInvalidPDFjsFont(){return E(this,vn,jl).call(this,4)}get isType3Font(){return E(this,vn,jl).call(this,5)}get italic(){return E(this,vn,jl).call(this,6)}get missingFile(){return E(this,vn,jl).call(this,7)}get remeasure(){return E(this,vn,jl).call(this,8)}get vertical(){return E(this,vn,jl).call(this,9)}get ascent(){return E(this,vn,i_).call(this,0)}get defaultWidth(){return E(this,vn,i_).call(this,1)}get descent(){return E(this,vn,i_).call(this,2)}get bbox(){let e=l(at,jw);if(l(this,as).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<4;i++)s.push(l(this,as).getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=l(at,Aw);if(l(this,as).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<6;i++)s.push(l(this,as).getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=l(at,Ew);if(l(this,as).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<3;i++)s.push(l(this,as).getInt16(e,!0)),e+=2;return s}get fallbackName(){return E(this,vn,jC).call(this,0)}get loadedName(){return E(this,vn,jC).call(this,1)}get mimetype(){return E(this,vn,jC).call(this,2)}get name(){return E(this,vn,jC).call(this,3)}get data(){let e=l(at,Ga);const t=l(this,as).getUint32(e);e+=4+t;const s=l(this,as).getUint32(e);e+=4+s;const i=l(this,as).getUint32(e);e+=4+i;const r=l(this,as).getUint32(e);if(r!==0)return new Uint8Array(l(this,rd),e+4,r)}clearData(){let e=l(at,Ga);const t=l(this,as).getUint32(e);e+=4+t;const s=l(this,as).getUint32(e);e+=4+s;const i=l(this,as).getUint32(e);e+=4+i;const r=l(this,as).getUint32(e);new Uint8Array(l(this,rd),e+4,r).fill(0),l(this,as).setUint32(e,0)}get cssFontInfo(){let e=l(at,Ga);const t=l(this,as).getUint32(e);e+=4+t;const s=l(this,as).getUint32(e);e+=4+s;const i=l(this,as).getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(l(this,rd),e+4,i)),new CP(r.buffer)}get systemFontInfo(){let e=l(at,Ga);const t=l(this,as).getUint32(e);e+=4+t;const s=l(this,as).getUint32(e);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(l(this,rd),e+4,s)),new NP(i.buffer)}static write(e){const t=e.systemFontInfo?NP.write(e.systemFontInfo):null,s=e.cssFontInfo?CP.write(e.cssFontInfo):null,i=new TextEncoder,r={};let o=0;for(const g of at.strings)r[g]=i.encode(e[g]),o+=4+r[g].length;const c=l(at,Ga)+4+o+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),d=new ArrayBuffer(c),h=new Uint8Array(d),u=new DataView(d);let p=0;const f=at.bools.length;let m=0,x=0;for(let g=0;g<f;g++){const b=e[at.bools[g]];m|=(b===void 0?0:b?2:1)<<x,x+=2,(x===8||g===f-1)&&(u.setUint8(p++,m),m=0,x=0)}Et(p===l(at,Nw),"FontInfo.write: Boolean properties offset mismatch");for(const g of at.numbers)u.setFloat64(p,e[g]),p+=8;if(Et(p===l(at,jw),"FontInfo.write: Number properties offset mismatch"),e.bbox){u.setUint8(p++,4);for(const g of e.bbox)u.setInt16(p,g,!0),p+=2}else u.setUint8(p++,0),p+=2*4;if(Et(p===l(at,Aw),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){u.setUint8(p++,6);for(const g of e.fontMatrix)u.setFloat64(p,g,!0),p+=8}else u.setUint8(p++,0),p+=8*6;if(Et(p===l(at,Ew),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){u.setUint8(p++,1);for(const g of e.defaultVMetrics)u.setInt16(p,g,!0),p+=2}else u.setUint8(p++,0),p+=3*2;Et(p===l(at,Ga),"FontInfo.write: DefaultVMetrics properties offset mismatch"),u.setUint32(l(at,Ga),0),p+=4;for(const g of at.strings){const b=r[g],y=b.length;u.setUint32(p,y),h.set(b,p+4),p+=4+y}if(u.setUint32(l(at,Ga),p-l(at,Ga)-4),!t)u.setUint32(p,0),p+=4;else{const g=t.byteLength;u.setUint32(p,g),Et(p+4+g<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),p+4),p+=4+g}if(!s)u.setUint32(p,0),p+=4;else{const g=s.byteLength;u.setUint32(p,g),Et(p+4+g<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(s),p+4),p+=4+g}return e.data===void 0?(u.setUint32(p,0),p+=4):(u.setUint32(p,e.data.length),h.set(e.data,p+4),p+=4+e.data.length),Et(p<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(p)}};Nw=new WeakMap,jw=new WeakMap,Aw=new WeakMap,Ew=new WeakMap,Ga=new WeakMap,rd=new WeakMap,lA=new WeakMap,as=new WeakMap,vn=new WeakSet,jl=function(e){Et(e<at.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,i=l(this,as).getUint8(t)>>s&3;return i===0?void 0:i===2},i_=function(e){return Et(e<at.numbers.length,"Invalid number index"),l(this,as).getFloat64(l(at,Nw)+e*8)},jC=function(e){Et(e<at.strings.length,"Invalid string index");let t=l(at,Ga)+4;for(let r=0;r<e;r++)t+=l(this,as).getUint32(t)+4;const s=l(this,as).getUint32(t),i=new Uint8Array(s);return i.set(new Uint8Array(l(this,rd),t+4,s)),l(this,lA).decode(i)},W(at,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),W(at,"numbers",["ascent","defaultWidth","descent"]),W(at,"strings",["fallbackName","loadedName","mimetype","name"]),A(at,Nw,Math.ceil(at.bools.length*2/8)),A(at,jw,l(at,Nw)+at.numbers.length*8),A(at,Aw,l(at,jw)+1+2*4),A(at,Ew,l(at,Aw)+1+8*6),A(at,Ga,l(at,Ew)+1+2*3);let vF=at;var cA,dA;class mo{static get workerPort(){return l(this,cA)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");v(this,cA,e)}static get workerSrc(){return l(this,dA)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");v(this,dA,e)}}cA=new WeakMap,dA=new WeakMap,A(mo,cA,null),A(mo,dA,"");var kw,hA;class Wpe{constructor({parsedData:e,rawData:t}){A(this,kw);A(this,hA);v(this,kw,e),v(this,hA,t)}getRaw(){return l(this,hA)}get(e){return l(this,kw).get(e)??null}[Symbol.iterator](){return l(this,kw).entries()}}kw=new WeakMap,hA=new WeakMap;const Ry=Symbol("INTERNAL");var uA,pA,fA,Tw;class qpe{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){A(this,uA,!1);A(this,pA,!1);A(this,fA,!1);A(this,Tw,!0);v(this,uA,!!(e&ao.DISPLAY)),v(this,pA,!!(e&ao.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(l(this,fA))return l(this,Tw);if(!l(this,Tw))return!1;const{print:e,view:t}=this.usage;return l(this,uA)?(t==null?void 0:t.viewState)!=="OFF":l(this,pA)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==Ry&&Ns("Internal method `_setVisible` called."),v(this,fA,s),v(this,Tw,t)}}uA=new WeakMap,pA=new WeakMap,fA=new WeakMap,Tw=new WeakMap;var vf,os,_w,Pw,mA,wF;class Ype{constructor(e,t=ao.DISPLAY){A(this,mA);A(this,vf,null);A(this,os,new Map);A(this,_w,null);A(this,Pw,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,v(this,Pw,e.order);for(const s of e.groups)l(this,os).set(s.id,new qpe(t,s));if(e.baseState==="OFF")for(const s of l(this,os).values())s._setVisible(Ry,!1);for(const s of e.on)l(this,os).get(s)._setVisible(Ry,!0);for(const s of e.off)l(this,os).get(s)._setVisible(Ry,!1);v(this,_w,this.getHash())}}isVisible(e){if(l(this,os).size===0)return!0;if(!e)return sD("Optional content group not defined."),!0;if(e.type==="OCG")return l(this,os).has(e.id)?l(this,os).get(e.id).visible:(st(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return E(this,mA,wF).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!l(this,os).has(t))return st(`Optional content group not found: ${t}`),!0;if(l(this,os).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!l(this,os).has(t))return st(`Optional content group not found: ${t}`),!0;if(!l(this,os).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!l(this,os).has(t))return st(`Optional content group not found: ${t}`),!0;if(!l(this,os).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!l(this,os).has(t))return st(`Optional content group not found: ${t}`),!0;if(l(this,os).get(t).visible)return!1}return!0}return st(`Unknown optional content policy ${e.policy}.`),!0}return st(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=l(this,os).get(e);if(!i){st(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const c of o)c!==e&&((r=l(this,os).get(c))==null||r._setVisible(Ry,!1,!0));i._setVisible(Ry,!!t,!0),v(this,vf,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=l(this,os).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}v(this,vf,null)}get hasInitialVisibility(){return l(this,_w)===null||this.getHash()===l(this,_w)}getOrder(){return l(this,os).size?l(this,Pw)?l(this,Pw).slice():[...l(this,os).keys()]:null}getGroup(e){return l(this,os).get(e)||null}getHash(){if(l(this,vf)!==null)return l(this,vf);const e=new pX;for(const[t,s]of l(this,os))e.update(`${t}:${s.visible}`);return v(this,vf,e.hexdigest())}[Symbol.iterator](){return l(this,os).entries()}}vf=new WeakMap,os=new WeakMap,_w=new WeakMap,Pw=new WeakMap,mA=new WeakSet,wF=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let o;if(Array.isArray(r))o=E(this,mA,wF).call(this,r);else if(l(this,os).has(r))o=l(this,os).get(r).visible;else return st(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"};class Xpe{constructor(e,{disableRange:t=!1,disableStream:s=!1}){Et(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:c}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=c,(r==null?void 0:r.length)>0){const d=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((d,h)=>{this._onReceiveData({begin:d,chunk:h})}),e.addProgressListener((d,h)=>{this._onProgress({loaded:d,total:h})}),e.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});Et(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Et(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Kpe(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Qpe(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class Kpe{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=iD(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Qpe{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Jpe(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let u=c(t);return u=unescape(u),u=d(u),u=h(u),r(u)}if(t=o(n),t){const u=h(t);return r(u)}if(t=s("filename","i").exec(n),t){t=t[1];let u=c(t);return u=h(u),r(u)}function s(u,p){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function i(u,p){if(u){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const f=new TextDecoder(u,{fatal:!0}),m=PE(p);p=f.decode(m),e=!1}catch{}}return p}function r(u){return e&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),e&&(u=i("iso-8859-1",u))),u}function o(u){const p=[];let f;const m=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=m.exec(u))!==null;){let[,g,b,y]=f;if(g=parseInt(g,10),g in p){if(g===0)break;continue}p[g]=[b,y]}const x=[];for(let g=0;g<p.length&&g in p;++g){let[b,y]=p[g];y=c(y),b&&(y=unescape(y),g===0&&(y=d(y))),x.push(y)}return x.join("")}function c(u){if(u.startsWith('"')){const p=u.slice(1).split('\\"');for(let f=0;f<p.length;++f){const m=p[f].indexOf('"');m!==-1&&(p[f]=p[f].slice(0,m),p.length=f+1),p[f]=p[f].replaceAll(/\\(.)/g,"$1")}u=p.join('"')}return u}function d(u){const p=u.indexOf("'");if(p===-1)return u;const f=u.slice(0,p),x=u.slice(p+1).replace(/^[^']*'/,"");return i(f,x)}function h(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,f,m,x){if(m==="q"||m==="Q")return x=x.replaceAll("_"," "),x=x.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,b){return String.fromCharCode(parseInt(b,16))}),i(f,x);try{x=atob(x)}catch{}return i(f,x)})}return""}function AX(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function rD(n){var e;return((e=URL.parse(n))==null?void 0:e.origin)??null}function EX({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function kX(n){const e=n.get("Content-Disposition");if(e){let t=Jpe(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(iD(t))return t}return null}function IE(n,e){return new RN(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n,n===404||n===0&&e.startsWith("file:"))}function TX(n){return n===200||n===206}function _X(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function PX(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(st(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class Zpe{constructor(e){W(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=AX(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Et(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new efe(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new tfe(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class efe{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,_X(s,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=rD(r.url),!TX(r.status))throw IE(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:c,suggestedLength:d}=EX({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=c,this._contentLength=d||this._contentLength,this._filename=kX(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Mu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:PX(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class tfe{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const o=i.url;fetch(o,_X(r,this._withCredentials,this._abortController)).then(c=>{const d=rD(c.url);if(d!==e._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${e._responseOrigin}".`);if(!TX(c.status))throw IE(c.status,o);this._readCapability.resolve(),this._reader=c.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:PX(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const FR=200,OR=206;function sfe(n){const e=n.response;return typeof e!="string"?e:PE(e).buffer}class nfe{constructor({url:e,httpHeaders:t,withCredentials:s}){W(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=AX(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=OR):i.expectedStatus=FR,t.responseType="arraybuffer",Et(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||FR;if(!(r===FR&&s.expectedStatus===OR)&&r!==s.expectedStatus){s.onError(i.status);return}const c=sfe(i);if(r===OR){const d=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);h?s.onDone({begin:parseInt(h[1],10),chunk:c}):(st('Missing or invalid "Content-Range" header.'),s.onError(0))}else c?s.onDone({begin:0,chunk:c}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class ife{constructor(e){this._source=e,this._manager=new nfe(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Et(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new rfe(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new afe(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class rfe{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=rD(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[d,...h]=c.split(": ");return[d,h.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=EX({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=kX(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=IE(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class afe{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=rD((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=IE(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ofe=/^[a-z][a-z0-9\-+.]+:/i;function lfe(n){if(ofe.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class cfe{constructor(e){this.source=e,this.url=lfe(e.url),Et(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Et(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new dfe(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new hfe(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class dfe{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=IE(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Mu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class hfe{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const PS=Symbol("INITIAL_DATA");var Wa,gA,SF;class LX{constructor(){A(this,gA);A(this,Wa,Object.create(null))}get(e,t=null){if(t){const i=E(this,gA,SF).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=l(this,Wa)[e];if(!s||s.data===PS)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=l(this,Wa)[e];return!!t&&t.data!==PS}delete(e){const t=l(this,Wa)[e];return!t||t.data===PS?!1:(delete l(this,Wa)[e],!0)}resolve(e,t=null){const s=E(this,gA,SF).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in l(this,Wa)){const{data:s}=l(this,Wa)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}v(this,Wa,Object.create(null))}*[Symbol.iterator](){for(const e in l(this,Wa)){const{data:t}=l(this,Wa)[e];t!==PS&&(yield[e,t])}}}Wa=new WeakMap,gA=new WeakSet,SF=function(e){var t;return(t=l(this,Wa))[e]||(t[e]={...Promise.withResolvers(),data:PS})};const ufe=1e5,jz=30;var U8,wf,la,xA,yA,Xx,Qh,bA,vA,Kx,Lw,Dw,Sf,Rw,wA,Iw,Qx,SA,CA,xn,Mw,Jx,NA,Cf,Fw,Uu,DX,RX,CF,wo,r_,NF,IX,MX;let ON=(xn=class{constructor({textContentSource:e,container:t,viewport:s}){A(this,Uu);A(this,wf,Promise.withResolvers());A(this,la,null);A(this,xA,!1);A(this,yA,!!((U8=globalThis.FontInspector)!=null&&U8.enabled));A(this,Xx,null);A(this,Qh,null);A(this,bA,0);A(this,vA,0);A(this,Kx,null);A(this,Lw,null);A(this,Dw,0);A(this,Sf,0);A(this,Rw,Object.create(null));A(this,wA,[]);A(this,Iw,null);A(this,Qx,[]);A(this,SA,new WeakMap);A(this,CA,null);var d;if(e instanceof ReadableStream)v(this,Iw,e);else if(typeof e=="object")v(this,Iw,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');v(this,la,v(this,Lw,t)),v(this,Sf,s.scale*cc.pixelRatio),v(this,Dw,s.rotation),v(this,Qh,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:c}=s.rawDims;v(this,CA,[1,0,0,-1,-o,c+r]),v(this,vA,i),v(this,bA,r),E(d=xn,wo,IX).call(d),fm(t,s),l(this,wf).promise.finally(()=>{l(xn,Fw).delete(this),v(this,Qh,null),v(this,Rw,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=wi.platform;return ct(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{l(this,Kx).read().then(({value:t,done:s})=>{if(s){l(this,wf).resolve();return}l(this,Xx)??v(this,Xx,t.lang),Object.assign(l(this,Rw),t.styles),E(this,Uu,DX).call(this,t.items),e()},l(this,wf).reject)};return v(this,Kx,l(this,Iw).getReader()),l(xn,Fw).add(this),e(),l(this,wf).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*cc.pixelRatio,i=e.rotation;if(i!==l(this,Dw)&&(t==null||t(),v(this,Dw,i),fm(l(this,Lw),{rotation:i})),s!==l(this,Sf)){t==null||t(),v(this,Sf,s);const o={div:null,properties:null,ctx:E(r=xn,wo,r_).call(r,l(this,Xx))};for(const c of l(this,Qx))o.properties=l(this,SA).get(c),o.div=c,E(this,Uu,CF).call(this,o)}}cancel(){var t;const e=new Mu("TextLayer task cancelled.");(t=l(this,Kx))==null||t.cancel(e).catch(()=>{}),v(this,Kx,null),l(this,wf).reject(e)}get textDivs(){return l(this,Qx)}get textContentItemsStr(){return l(this,wA)}static cleanup(){if(!(l(this,Fw).size>0)){l(this,Mw).clear();for(const{canvas:e}of l(this,Jx).values())e.remove();l(this,Jx).clear()}}},wf=new WeakMap,la=new WeakMap,xA=new WeakMap,yA=new WeakMap,Xx=new WeakMap,Qh=new WeakMap,bA=new WeakMap,vA=new WeakMap,Kx=new WeakMap,Lw=new WeakMap,Dw=new WeakMap,Sf=new WeakMap,Rw=new WeakMap,wA=new WeakMap,Iw=new WeakMap,Qx=new WeakMap,SA=new WeakMap,CA=new WeakMap,Mw=new WeakMap,Jx=new WeakMap,NA=new WeakMap,Cf=new WeakMap,Fw=new WeakMap,Uu=new WeakSet,DX=function(e){var i,r;if(l(this,xA))return;(r=l(this,Qh)).ctx??(r.ctx=E(i=xn,wo,r_).call(i,l(this,Xx)));const t=l(this,Qx),s=l(this,wA);for(const o of e){if(t.length>ufe){st("Ignoring additional textDivs for performance reasons."),v(this,xA,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const c=l(this,la);v(this,la,document.createElement("span")),l(this,la).classList.add("markedContent"),o.id&&l(this,la).setAttribute("id",`${o.id}`),c.append(l(this,la))}else o.type==="endMarkedContent"&&v(this,la,l(this,la).parentNode);continue}s.push(o.str),E(this,Uu,RX).call(this,o)}},RX=function(e){var g;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};l(this,Qx).push(t);const i=Ce.transform(l(this,CA),e.transform);let r=Math.atan2(i[1],i[0]);const o=l(this,Rw)[e.fontName];o.vertical&&(r+=Math.PI/2);let c=l(this,yA)&&o.fontSubstitution||o.fontFamily;c=xn.fontFamilyMap.get(c)||c;const d=Math.hypot(i[2],i[3]),h=d*E(g=xn,wo,MX).call(g,c,o,l(this,Xx));let u,p;r===0?(u=i[4],p=i[5]-h):(u=i[4]+h*Math.sin(r),p=i[5]-h*Math.cos(r));const f="calc(var(--total-scale-factor) *",m=t.style;l(this,la)===l(this,Lw)?(m.left=`${(100*u/l(this,vA)).toFixed(2)}%`,m.top=`${(100*p/l(this,bA)).toFixed(2)}%`):(m.left=`${f}${u.toFixed(2)}px)`,m.top=`${f}${p.toFixed(2)}px)`),m.fontSize=`${f}${(l(xn,Cf)*d).toFixed(2)}px)`,m.fontFamily=c,s.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,l(this,yA)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let x=!1;if(e.str.length>1)x=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),y=Math.abs(e.transform[3]);b!==y&&Math.max(b,y)/Math.min(b,y)>1.5&&(x=!0)}if(x&&(s.canvasWidth=o.vertical?e.height:e.width),l(this,SA).set(t,s),l(this,Qh).div=t,l(this,Qh).properties=s,E(this,Uu,CF).call(this,l(this,Qh)),s.hasText&&l(this,la).append(t),s.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),l(this,la).append(b)}},CF=function(e){var c;const{div:t,properties:s,ctx:i}=e,{style:r}=t;let o="";if(l(xn,Cf)>1&&(o=`scale(${1/l(xn,Cf)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:d}=r,{canvasWidth:h,fontSize:u}=s;E(c=xn,wo,NF).call(c,i,u*l(this,Sf),d);const{width:p}=i.measureText(t.textContent);p>0&&(o=`scaleX(${h*l(this,Sf)/p}) ${o}`)}s.angle!==0&&(o=`rotate(${s.angle}deg) ${o}`),o.length>0&&(r.transform=o)},wo=new WeakSet,r_=function(e=null){let t=l(this,Jx).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,Jx).set(e,t),l(this,NA).set(t,{size:0,family:""})}return t},NF=function(e,t,s){const i=l(this,NA).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},IX=function(){if(l(this,Cf)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),v(this,Cf,e.getBoundingClientRect().height),e.remove()},MX=function(e,t,s){const i=l(this,Mw).get(e);if(i)return i;const r=E(this,wo,r_).call(this,s);r.canvas.width=r.canvas.height=jz,E(this,wo,NF).call(this,r,jz,e);const o=r.measureText(""),c=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let h=.8;return c?h=c/(c+d):(wi.platform.isFirefox&&st("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),l(this,Mw).set(e,h),h},A(xn,wo),A(xn,Mw,new Map),A(xn,Jx,new Map),A(xn,NA,new WeakMap),A(xn,Cf,null),A(xn,Fw,new Set),xn);const pfe=100;function P3(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new jF,{docId:t}=e,s=n.url?wpe(n.url):null,i=n.data?Spe(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,c=n.password??null,d=n.range instanceof L3?n.range:null,h=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let u=n.worker instanceof O1?n.worker:null;const p=n.verbosity,f=typeof n.docBaseUrl=="string"&&!DE(n.docBaseUrl)?n.docBaseUrl:null,m=Rk(n.cMapUrl),x=n.cMapPacked!==!1,g=n.CMapReaderFactory||(Fr?Tpe:hz),b=Rk(n.iccUrl),y=Rk(n.standardFontDataUrl),C=n.StandardFontDataFactory||(Fr?_pe:uz),w=Rk(n.wasmUrl),S=n.WasmFactory||(Fr?Ppe:pz),j=n.stopAtErrors!==!0,T=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,k=n.isEvalSupported!==!1,_=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!Fr,L=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!Fr&&(wi.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,P=typeof n.disableFontFace=="boolean"?n.disableFontFace:Fr,I=n.fontExtraProperties===!0,M=n.enableXfa===!0,O=n.ownerDocument||globalThis.document,F=n.disableRange===!0,B=n.disableStream===!0,U=n.disableAutoFetch===!0,$=n.pdfBug===!0,G=n.CanvasFactory||(Fr?kpe:jpe),ne=n.FilterFactory||(Fr?Epe:Ape),Z=n.enableHWA===!0,K=n.useWasm!==!1,X=d?d.length:n.length??NaN,V=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!Fr&&!P,q=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(g===hz&&C===uz&&S===pz&&m&&y&&w&&pC(m,document.baseURI)&&pC(y,document.baseURI)&&pC(w,document.baseURI)),ee=null;spe(p);const ie={canvasFactory:new G({ownerDocument:O,enableHWA:Z}),filterFactory:new ne({docId:t,ownerDocument:O}),cMapReaderFactory:q?null:new g({baseUrl:m,isCompressed:x}),standardFontDataFactory:q?null:new C({baseUrl:y}),wasmFactory:q?null:new S({baseUrl:w})};u||(u=O1.create({verbosity:p,port:mo.workerPort}),e._worker=u);const Re={docId:t,apiVersion:"5.4.296",data:i,password:c,disableAutoFetch:U,rangeChunkSize:h,length:X,docBaseUrl:f,enableXfa:M,evaluatorOptions:{maxImageSize:T,disableFontFace:P,ignoreErrors:j,isEvalSupported:k,isOffscreenCanvasSupported:_,isImageDecoderSupported:L,canvasMaxAreaInBytes:D,fontExtraProperties:I,useSystemFonts:V,useWasm:K,useWorkerFetch:q,cMapUrl:m,iccUrl:b,standardFontDataUrl:y,wasmUrl:w}},Ye={ownerDocument:O,pdfBug:$,styleElement:ee,loadingParams:{disableAutoFetch:U,enableXfa:M}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Le=u.messageHandler.sendWithPromise("GetDocRequest",Re,i?[i.buffer]:null);let te;if(d)te=new Xpe(d,{disableRange:F,disableStream:B});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const fe=pC(s)?Zpe:Fr?cfe:ife;te=new fe({url:s,length:X,httpHeaders:r,withCredentials:o,rangeChunkSize:h,disableRange:F,disableStream:B})}return Le.then(fe=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Ne=new bC(t,fe,u.port),Pe=new gfe(Ne,e,te,Ye,ie,Z);e._transport=Pe,Ne.send("Ready",null)})}).catch(e._capability.reject),e}var sL;const nL=class nL{constructor(){W(this,"_capability",Promise.withResolvers());W(this,"_transport",null);W(this,"_worker",null);W(this,"docId",`d${vt(nL,sL)._++}`);W(this,"destroyed",!1);W(this,"onPassword",null);W(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};sL=new WeakMap,A(nL,sL,0);let jF=nL;var Zx,jA,AA,EA,kA,z8;let L3=(z8=class{constructor(e,t,s=!1,i=null){A(this,Zx,Promise.withResolvers());A(this,jA,[]);A(this,AA,[]);A(this,EA,[]);A(this,kA,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){l(this,kA).push(e)}addProgressListener(e){l(this,EA).push(e)}addProgressiveReadListener(e){l(this,AA).push(e)}addProgressiveDoneListener(e){l(this,jA).push(e)}onDataRange(e,t){for(const s of l(this,kA))s(e,t)}onDataProgress(e,t){l(this,Zx).promise.then(()=>{for(const s of l(this,EA))s(e,t)})}onDataProgressiveRead(e){l(this,Zx).promise.then(()=>{for(const t of l(this,AA))t(e)})}onDataProgressiveDone(){l(this,Zx).promise.then(()=>{for(const e of l(this,jA))e()})}transportReady(){l(this,Zx).resolve()}requestDataRange(e,t){Ns("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},Zx=new WeakMap,jA=new WeakMap,AA=new WeakMap,EA=new WeakMap,kA=new WeakMap,z8);class ffe{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ct(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Jh,e0,AC;class mfe{constructor(e,t,s,i=!1){A(this,e0);A(this,Jh,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new iz:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new LX,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new LE({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ct(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:i="display",annotationMode:r=bd.ENABLE,transform:o=null,background:c=null,optionalContentConfigPromise:d=null,annotationCanvasMap:h=null,pageColors:u=null,printAnnotationStorage:p=null,isEditing:f=!1,recordOperations:m=!1,operationsFilter:x=null}){var L,D,P;(L=this._stats)==null||L.time("Overall");const g=this._transport.getRenderingIntent(i,r,p,f),{renderingIntent:b,cacheKey:y}=g;v(this,Jh,!1),d||(d=this._transport.getOptionalContentConfig(b));let C=this._intentStates.get(y);C||(C=Object.create(null),this._intentStates.set(y,C)),C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null);const w=!!(b&ao.PRINT);C.displayReadyCapability||(C.displayReadyCapability=Promise.withResolvers(),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(D=this._stats)==null||D.time("Page Request"),this._pumpOperatorList(g));const S=!!(this._pdfBug&&((P=globalThis.StepperManager)!=null&&P.enabled)),j=!this.recordedBBoxes&&(m||S),T=I=>{var M,O;if(C.renderTasks.delete(k),j){const F=(M=k.gfx)==null?void 0:M.dependencyTracker.take();F&&(k.stepper&&k.stepper.setOperatorBBoxes(F,k.gfx.dependencyTracker.takeDebugMetadata()),m&&(this.recordedBBoxes=F))}w&&v(this,Jh,!0),E(this,e0,AC).call(this),I?(k.capability.reject(I),this._abortOperatorList({intentState:C,reason:I instanceof Error?I:new Error(I)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(O=globalThis.Stats)!=null&&O.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new AF({callback:T,params:{canvas:t,canvasContext:e,dependencyTracker:j?new Dpe(t,C.operatorList.length,S):null,viewport:s,transform:o,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:C.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:u,enableHWA:this._transport.enableHWA,operationsFilter:x});(C.renderTasks||(C.renderTasks=new Set)).add(k);const _=k.task;return Promise.all([C.displayReadyCapability.promise,d]).then(([I,M])=>{var O;if(this.destroyed){T();return}if((O=this._stats)==null||O.time("Rendering"),!(M.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:I,optionalContentConfig:M}),k.operatorListChanged()}).catch(T),_}getOperatorList({intent:e="display",annotationMode:t=bd.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function r(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(e,t,s,i,!0);let c=this._intentStates.get(o.cacheKey);c||(c=Object.create(null),this._intentStates.set(o.cacheKey,c));let d;return c.opListReadCapability||(d=Object.create(null),d.operatorListChanged=r,c.opListReadCapability=Promise.withResolvers(),(c.renderTasks||(c.renderTasks=new Set)).add(d),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(o)),c.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>IN.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){o.read().then(function({value:d,done:h}){if(h){s(c);return}c.lang??(c.lang=d.lang),Object.assign(c.styles,d.styles),c.items.push(...d.items),r()},i)}const o=t.getReader(),c={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),v(this,Jh,!1),Promise.all(e)}cleanup(e=!1){v(this,Jh,!0);const t=E(this,e0,AC).call(this);return e&&t&&this._stats&&(this._stats=new iz),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&E(this,e0,AC).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),h=this._intentStates.get(t);h.streamReader=d;const u=()=>{d.read().then(({value:p,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,h),u())},p=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();E(this,e0,AC).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(p);else if(h.opListReadCapability)h.opListReadCapability.reject(p);else throw p}})};u()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof nD){let i=pfe;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Mu(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}Jh=new WeakMap,e0=new WeakSet,AC=function(){if(!l(this,Jh)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),v(this,Jh,!1),!0};var Nf,ql,Zh,t0,iL,s0,n0,$r,a_,FX,OX,EC,Ow,o_;const Os=class Os{constructor({name:e=null,port:t=null,verbosity:s=npe()}={}){A(this,$r);A(this,Nf,Promise.withResolvers());A(this,ql,null);A(this,Zh,null);A(this,t0,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(l(Os,n0).has(t))throw new Error("Cannot use more than one PDFWorker per port.");l(Os,n0).set(t,this),E(this,$r,FX).call(this,t)}else E(this,$r,OX).call(this)}get promise(){return l(this,Nf).promise}get port(){return l(this,Zh)}get messageHandler(){return l(this,ql)}destroy(){var e,t;this.destroyed=!0,(e=l(this,t0))==null||e.terminate(),v(this,t0,null),l(Os,n0).delete(l(this,Zh)),v(this,Zh,null),(t=l(this,ql))==null||t.destroy(),v(this,ql,null)}static create(e){const t=l(this,n0).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Os(e)}static get workerSrc(){if(mo.workerSrc)return mo.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ct(this,"_setupFakeWorkerGlobal",(async()=>l(this,Ow,o_)?l(this,Ow,o_):(await import(this.workerSrc)).WorkerMessageHandler)())}};Nf=new WeakMap,ql=new WeakMap,Zh=new WeakMap,t0=new WeakMap,iL=new WeakMap,s0=new WeakMap,n0=new WeakMap,$r=new WeakSet,a_=function(){l(this,Nf).resolve(),l(this,ql).send("configure",{verbosity:this.verbosity})},FX=function(e){v(this,Zh,e),v(this,ql,new bC("main","worker",e)),l(this,ql).on("ready",()=>{}),E(this,$r,a_).call(this)},OX=function(){if(l(Os,s0)||l(Os,Ow,o_)){E(this,$r,EC).call(this);return}let{workerSrc:e}=Os;try{Os._isSameOrigin(window.location,e)||(e=Os._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new bC("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?l(this,Nf).reject(new Error("Worker was destroyed")):E(this,$r,EC).call(this)},r=new AbortController;t.addEventListener("error",()=>{l(this,t0)||i()},{signal:r.signal}),s.on("test",c=>{if(r.abort(),this.destroyed||!c){i();return}v(this,ql,s),v(this,Zh,t),v(this,t0,t),E(this,$r,a_).call(this)}),s.on("ready",c=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{E(this,$r,EC).call(this)}});const o=()=>{const c=new Uint8Array;s.send("test",c,[c.buffer])};o();return}catch{sD("The worker has been disabled.")}E(this,$r,EC).call(this)},EC=function(){l(Os,s0)||(st("Setting up fake worker."),v(Os,s0,!0)),Os._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){l(this,Nf).reject(new Error("Worker was destroyed"));return}const t=new Npe;v(this,Zh,t);const s=`fake${vt(Os,iL)._++}`,i=new bC(s+"_worker",s,t);e.setup(i,t),v(this,ql,new bC(s,s+"_worker",t)),E(this,$r,a_).call(this)}).catch(e=>{l(this,Nf).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Ow=new WeakSet,o_=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},A(Os,Ow),A(Os,iL,0),A(Os,s0,!1),A(Os,n0,new WeakMap),Fr&&(v(Os,s0,!0),mo.workerSrc||(mo.workerSrc="./pdf.worker.mjs")),Os._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},Os._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Os.fromPort=e=>{if(upe("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Os.create(e)};let O1=Os;var eu,ad,Bw,$w,tu,i0,kC;class gfe{constructor(e,t,s,i,r,o){A(this,i0);A(this,eu,new Map);A(this,ad,new Map);A(this,Bw,new Map);A(this,$w,new Map);A(this,tu,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new LX,this.fontLoader=new bpe({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return ct(this,"annotationStorage",new k3)}getRenderingIntent(e,t=bd.ENABLE,s=null,i=!1,r=!1){let o=ao.DISPLAY,c=cF;switch(e){case"any":o=ao.ANY;break;case"display":break;case"print":o=ao.PRINT;break;default:st(`getRenderingIntent - invalid intent: ${e}`)}const d=o&ao.PRINT&&s instanceof mX?s:this.annotationStorage;switch(t){case bd.DISABLE:o+=ao.ANNOTATIONS_DISABLE;break;case bd.ENABLE:break;case bd.ENABLE_FORMS:o+=ao.ANNOTATIONS_FORMS;break;case bd.ENABLE_STORAGE:o+=ao.ANNOTATIONS_STORAGE,c=d.serializable;break;default:st(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=ao.IS_EDITING),r&&(o+=ao.OPLIST);const{ids:h,hash:u}=d.modifiedIds,p=[o,c.hash,u];return{renderingIntent:o,cacheKey:p.join("_"),annotationStorageSerializable:c,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=l(this,tu))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of l(this,ad).values())e.push(i._destroy());l(this,ad).clear(),l(this,Bw).clear(),l(this,$w).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),l(this,eu).clear(),this.filterFactory.destroy(),ON.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Mu("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{Et(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}Et(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async s=>{var c;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((c=t.onProgress)==null||c.call(t,this._lastProgress)),this._fullReader.onProgress=d=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:d.loaded,total:d.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(s,i)=>{Et(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:c}){if(c){i.close();return}Et(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new ffe(s,this))}),e.on("DocException",s=>{t._capability.reject(Xr(s))}),e.on("PasswordRequest",s=>{v(this,tu,Promise.withResolvers());try{if(!t.onPassword)throw Xr(s);const i=r=>{r instanceof Error?l(this,tu).reject(r):l(this,tu).resolve({password:r})};t.onPassword(i,s.code)}catch(i){l(this,tu).reject(i)}return l(this,tu).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;l(this,ad).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in r){const p=r.error;st(`Error during font loading: ${p}`),this.commonObjs.resolve(s,p);break}const c=new vF(r),d=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(p,f)=>globalThis.FontInspector.fontAdded(p,f):null,h=new vpe(c,d,r.extra,r.charProcOperatorList);this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&h.clearData(),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:u}=r;Et(u,"The imageRef must be defined.");for(const p of l(this,ad).values())for(const[,f]of p.objs)if((f==null?void 0:f.ref)===u)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,r);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,o])=>{var d;if(this.destroyed)return;const c=l(this,ad).get(i);if(!c.objs.has(s)){if(c._intentStates.size===0){(d=o==null?void 0:o.bitmap)==null||d.close();return}switch(r){case"Image":case"Pattern":c.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&st("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=l(this,Bw).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&l(this,$w).set(r.refStr,e);const o=new mfe(t,r,this,this._params.pdfBug);return l(this,ad).set(t,o),o});return l(this,Bw).set(t,i),i}getPageIndex(e){return dF(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return E(this,i0,kC).call(this,"GetFieldObjects")}hasJSActions(){return E(this,i0,kC).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return E(this,i0,kC).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return E(this,i0,kC).call(this,"GetOptionalContentConfig").then(t=>new Ype(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=l(this,eu).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new Wpe(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return l(this,eu).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of l(this,ad).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),l(this,eu).clear(),this.filterFactory.destroy(!0),ON.cleanup()}}cachedPageNumber(e){if(!dF(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return l(this,$w).get(t)??null}}eu=new WeakMap,ad=new WeakMap,Bw=new WeakMap,$w=new WeakMap,tu=new WeakMap,i0=new WeakSet,kC=function(e,t=null){const s=l(this,eu).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return l(this,eu).set(e,i),i};var jf;class xfe{constructor(e){A(this,jf,null);W(this,"onContinue",null);W(this,"onError",null);v(this,jf,e)}get promise(){return l(this,jf).capability.promise}cancel(e=0){l(this,jf).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=l(this,jf).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=l(this,jf);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}jf=new WeakMap;var Af,r0;const Km=class Km{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:c,canvasFactory:d,filterFactory:h,useRequestAnimationFrame:u=!1,pdfBug:p=!1,pageColors:f=null,enableHWA:m=!1,operationsFilter:x=null}){A(this,Af,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=c,this.canvasFactory=d,this.filterFactory=h,this._pdfBug=p,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new xfe(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=m,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=x}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var d,h;if(this.cancelled)return;if(this._canvas){if(l(Km,r0).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(Km,r0).add(this._canvas)}this._pdfBug&&((d=globalThis.StepperManager)!=null&&d.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:r,dependencyTracker:o}=this.params,c=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new fb(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(e=null,t=0){var s,i,r;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),l(this,Af)&&(window.cancelAnimationFrame(l(this,Af)),v(this,Af,null)),l(Km,r0).delete(this._canvas),e||(e=new nD(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(i=this.task).onError)==null||r.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?v(this,Af,window.requestAnimationFrame(()=>{v(this,Af,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(Km,r0).delete(this._canvas),this.callback())))}};Af=new WeakMap,r0=new WeakMap,A(Km,r0,new WeakSet);let AF=Km;const D3="5.4.296",BX="f56dc8601";var qa,a0,Uw,Jn,TA,zw,su,_A,Ef,Yl,PA,ds,EF,kF,TF,Hm,$X,ep;const Kr=class Kr{constructor({editor:e=null,uiManager:t=null}){A(this,ds);A(this,qa,null);A(this,a0,null);A(this,Uw);A(this,Jn,null);A(this,TA,!1);A(this,zw,!1);A(this,su,null);A(this,_A);A(this,Ef,null);A(this,Yl,null);var s,i;e?(v(this,zw,!1),v(this,su,e)):v(this,zw,!0),v(this,Yl,(e==null?void 0:e._uiManager)||t),v(this,_A,l(this,Yl)._eventBus),v(this,Uw,((s=e==null?void 0:e.color)==null?void 0:s.toUpperCase())||((i=l(this,Yl))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),l(Kr,PA)||v(Kr,PA,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ct(this,"_keyboardManager",new RE([[["Escape","mac+Escape"],Kr.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Kr.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Kr.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Kr.prototype._moveToPrevious],[["Home","mac+Home"],Kr.prototype._moveToBeginning],[["End","mac+End"],Kr.prototype._moveToEnd]]))}renderButton(){const e=v(this,qa,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",l(this,su)&&(e.ariaControls=`${l(this,su).id}_colorpicker_dropdown`);const t=l(this,Yl)._signal;e.addEventListener("click",E(this,ds,Hm).bind(this),{signal:t}),e.addEventListener("keydown",E(this,ds,TF).bind(this),{signal:t});const s=v(this,a0,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=l(this,Uw),e.append(s),e}renderMainDropdown(){const e=v(this,Jn,E(this,ds,EF).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===l(this,qa)){E(this,ds,Hm).call(this,e);return}const t=e.target.getAttribute("data-color");t&&E(this,ds,kF).call(this,t,e)}_moveToNext(e){var t,s;if(!l(this,ds,ep)){E(this,ds,Hm).call(this,e);return}if(e.target===l(this,qa)){(t=l(this,Jn).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=l(this,Jn))==null?void 0:t.firstChild)||e.target===l(this,qa)){l(this,ds,ep)&&this._hideDropdownFromKeyboard();return}l(this,ds,ep)||E(this,ds,Hm).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!l(this,ds,ep)){E(this,ds,Hm).call(this,e);return}(t=l(this,Jn).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!l(this,ds,ep)){E(this,ds,Hm).call(this,e);return}(t=l(this,Jn).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=l(this,Jn))==null||e.classList.add("hidden"),l(this,qa).ariaExpanded="false",(t=l(this,Ef))==null||t.abort(),v(this,Ef,null)}_hideDropdownFromKeyboard(){var e;if(!l(this,zw)){if(!l(this,ds,ep)){(e=l(this,su))==null||e.unselect();return}this.hideDropdown(),l(this,qa).focus({preventScroll:!0,focusVisible:l(this,TA)})}}updateColor(e){if(l(this,a0)&&(l(this,a0).style.backgroundColor=e),!l(this,Jn))return;const t=l(this,Yl).highlightColors.values();for(const s of l(this,Jn).children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=l(this,qa))==null||e.remove(),v(this,qa,null),v(this,a0,null),(t=l(this,Jn))==null||t.remove(),v(this,Jn,null)}};qa=new WeakMap,a0=new WeakMap,Uw=new WeakMap,Jn=new WeakMap,TA=new WeakMap,zw=new WeakMap,su=new WeakMap,_A=new WeakMap,Ef=new WeakMap,Yl=new WeakMap,PA=new WeakMap,ds=new WeakSet,EF=function(){const e=document.createElement("div"),t=l(this,Yl)._signal;e.addEventListener("contextmenu",jo,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),l(this,su)&&(e.id=`${l(this,su).id}_colorpicker_dropdown`);for(const[s,i]of l(this,Yl).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",l(Kr,PA)[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.ariaSelected=i===l(this,Uw),r.addEventListener("click",E(this,ds,kF).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",E(this,ds,TF).bind(this),{signal:t}),e},kF=function(e,t){t.stopPropagation(),l(this,_A).dispatch("switchannotationeditorparams",{source:this,type:Nt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},TF=function(e){Kr._keyboardManager.exec(this,e)},Hm=function(e){if(l(this,ds,ep)){this.hideDropdown();return}if(v(this,TA,e.detail===0),l(this,Ef)||(v(this,Ef,new AbortController),window.addEventListener("pointerdown",E(this,ds,$X).bind(this),{signal:l(this,Yl).combinedSignal(l(this,Ef))})),l(this,qa).ariaExpanded="true",l(this,Jn)){l(this,Jn).classList.remove("hidden");return}const t=v(this,Jn,E(this,ds,EF).call(this));l(this,qa).append(t)},$X=function(e){var t;(t=l(this,Jn))!=null&&t.contains(e.target)||this.hideDropdown()},ep=function(){return l(this,Jn)&&!l(this,Jn).classList.contains("hidden")},A(Kr,PA,null);let BN=Kr;var od,LA,Hw,DA;const Qm=class Qm{constructor(e){A(this,od,null);A(this,LA,null);A(this,Hw,null);v(this,LA,e),v(this,Hw,e._uiManager),l(Qm,DA)||v(Qm,DA,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(l(this,od))return l(this,od);const{editorType:e,colorType:t,colorValue:s}=l(this,LA),i=v(this,od,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",l(Qm,DA)[e]),i.addEventListener("input",()=>{l(this,Hw).updateParams(t,i.value)},{signal:l(this,Hw)._signal}),i}update(e){l(this,od)&&(l(this,od).value=e)}destroy(){var e;(e=l(this,od))==null||e.remove(),v(this,od,null)}hideDropdown(){}};od=new WeakMap,LA=new WeakMap,Hw=new WeakMap,DA=new WeakMap,A(Qm,DA,null);let jP=Qm;function Az(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function LS(n){return Math.max(0,Math.min(255,255*n))}class Ez{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=LS(e),[e,e,e]}static G_HTML([e]){const t=Az(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(LS)}static RGB_HTML(e){return`#${e.map(Az).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[LS(1-Math.min(1,e+i)),LS(1-Math.min(1,s+i)),LS(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,o=1-s,c=Math.min(i,r,o);return["CMYK",i,r,o,c]}}class yfe{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Ns("Abstract method `_createSVG` called.")}}class $N extends yfe{_createSVG(e){return document.createElementNS(Wd,e)}}const bfe=9,J0=new WeakSet,vfe=new Date().getTimezoneOffset()*60*1e3;class kz{static create(e){switch(e.data.annotationType){case jn.LINK:return new R3(e);case jn.TEXT:return new Sfe(e);case jn.WIDGET:switch(e.data.fieldType){case"Tx":return new Cfe(e);case"Btn":return e.data.radioButton?new HX(e):e.data.checkBox?new jfe(e):new Afe(e);case"Ch":return new Efe(e);case"Sig":return new Nfe(e)}return new oy(e);case jn.POPUP:return new PF(e);case jn.FREETEXT:return new YX(e);case jn.LINE:return new Tfe(e);case jn.SQUARE:return new _fe(e);case jn.CIRCLE:return new Pfe(e);case jn.POLYLINE:return new XX(e);case jn.CARET:return new Dfe(e);case jn.INK:return new I3(e);case jn.POLYGON:return new Lfe(e);case jn.HIGHLIGHT:return new KX(e);case jn.UNDERLINE:return new Rfe(e);case jn.SQUIGGLY:return new Ife(e);case jn.STRIKEOUT:return new Mfe(e);case jn.STAMP:return new QX(e);case jn.FILEATTACHMENT:return new Ffe(e);default:return new rn(e)}}}var o0,Vw,el,RA,_F;const V3=class V3{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){A(this,RA);A(this,o0,null);A(this,Vw,!1);A(this,el,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return V3._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var s;const{data:e}=this,t=(s=this.annotationStorage)==null?void 0:s.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var c;const e=(c=this.annotationStorage)==null?void 0:c.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:i}=this.data;let r=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let d=0;d<t.length;d+=8)t[d+1]>o?(o=t[d+1],r=t[d+2]):t[d+1]===o&&(r=Math.max(r,t[d+2]));return[r,o]}if((s==null?void 0:s.length)>=1){for(const d of s)for(let h=0,u=d.length;h<u;h+=2)d[h+1]>o?(o=d[h+1],r=d[h]):d[h+1]===o&&(r=Math.max(r,d[h]));if(r!==1/0)return[r,o]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/s,e[1]=100*(e[1]-o)/i,e}get commentText(){var t,s,i;const{data:e}=this;return((s=(t=this.annotationStorage.getRawValue(`${DN}${e.id}`))==null?void 0:t.popup)==null?void 0:s.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${DN}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=l(this,el))==null?void 0:e.popup)||this.popup)==null||t.remove(),v(this,el,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(l(this,o0)||v(this,o0,{rect:this.data.rect.slice(0)}));const{rect:t,popup:s}=e;t&&E(this,RA,_F).call(this,t);let i=((r=l(this,el))==null?void 0:r.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=l(this,el).popup),i&&(i.updateEdited(e),s!=null&&s.deleted&&(i.remove(),v(this,el,null),this.popup=null))}resetEdited(){var e;l(this,o0)&&(E(this,RA,_F).call(this,l(this,o0).rect),(e=l(this,el))==null||e.popup.resetEdited(),v(this,o0,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof oy)&&!(this instanceof R3)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof PF){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,r),r}const{width:c,height:d}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(g>0||b>0){const C=`calc(${g}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;o.borderRadius=C}else if(this instanceof HX){const C=`calc(${c}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=C}switch(t.borderStyle.style){case Ty.SOLID:o.borderStyle="solid";break;case Ty.DASHED:o.borderStyle="dashed";break;case Ty.BEVELED:st("Unimplemented border style: beveled");break;case Ty.INSET:st("Unimplemented border style: inset");break;case Ty.UNDERLINE:o.borderBottomStyle="solid";break}const y=t.borderColor||null;y?(v(this,Vw,!0),o.borderColor=Ce.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const h=Ce.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:u,pageHeight:p,pageX:f,pageY:m}=i.rawDims;o.left=`${100*(h[0]-f)/u}%`,o.top=`${100*(h[1]-m)/p}%`;const{rotation:x}=t;return t.hasOwnCanvas||x===0?(o.width=`${100*c/u}%`,o.height=`${100*d/p}%`):this.setRotation(x,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:o}=this;e%180!==0&&([r,o]=[o,r]),t.style.width=`${100*r/s}%`,t.style.height=`${100*o/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],o=r[0],c=r.slice(1);i.target.style[s]=Ez[`${o}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[s]:Ez[`${o}_rgb`](c)})};return ct(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const o=s[i];if(o){const c={detail:{[i]:r},target:e};o(c),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,b,y,C]=e.subarray(2,6);if(i===g&&r===b&&t===y&&s===C)return}const{style:o}=this.container;let c;if(l(this,Vw)){const{borderColor:g,borderWidth:b}=o;o.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const d=i-t,h=r-s,{svgFactory:u}=this,p=u.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0),p.role="none";const f=u.createElement("defs");p.append(f);const m=u.createElement("clipPath"),x=`clippath_${this.data.id}`;m.setAttribute("id",x),m.setAttribute("clipPathUnits","objectBoundingBox"),f.append(m);for(let g=2,b=e.length;g<b;g+=8){const y=e[g],C=e[g+1],w=e[g+2],S=e[g+3],j=u.createElement("rect"),T=(w-t)/d,k=(r-C)/h,_=(y-w)/d,L=(C-S)/h;j.setAttribute("x",T),j.setAttribute("y",k),j.setAttribute("width",_),j.setAttribute("height",L),m.append(j),c==null||c.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${k}" width="${_}" height="${L}"/>`)}l(this,Vw)&&(c.push("</g></svg>')"),o.backgroundImage=c.join("")),this.container.append(p),this.container.style.clipPath=`url(#${x})`}_createPopup(e=null){const{data:t}=this;let s,i;e?(s={str:e.text},i=e.date):(s=t.contentsObj,i=t.modificationDate);const r=v(this,el,new PF({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}));this.parent._commentManager||this.parent.div.append(r.render())}get hasPopupElement(){return!!(l(this,el)||this.popup||this.data.popupRef)}get extraPopupElement(){return l(this,el)}render(){Ns("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:o,exportValues:c}of i){if(r===-1||o===t)continue;const d=typeof c=="string"?c:null,h=document.querySelector(`[data-element-id="${o}"]`);if(h&&!J0.has(h)){st(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:d,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&J0.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};o0=new WeakMap,Vw=new WeakMap,el=new WeakMap,RA=new WeakSet,_F=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:c,pageY:d}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-c)/r}%`,t.top=`${100*(o-e[3]+d)/o}%`,i===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(i)};let rn=V3;class wfe extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&(this._createPopup(e.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}var fo,Vm,UX,zX;class R3 extends rn{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});A(this,fo);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),r=!0):t.attachment?(E(this,fo,UX).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(E(this,fo,zX).call(this,i,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}_bindLink(t,s,i=""){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&E(this,fo,Vm).call(this),i&&(t.title=i)}_bindNamedAction(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(t.title=i),E(this,fo,Vm).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const o=i.get(r);o&&(t[o]=()=>{var c;return(c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}s.overlaidText&&(t.title=s.overlaidText),t.onclick||(t.onclick=()=>!1),E(this,fo,Vm).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),E(this,fo,Vm).call(this),!this._fieldObjects){st('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var p;i==null||i();const{fields:r,refs:o,include:c}=s,d=[];if(r.length!==0||o.length!==0){const f=new Set(o);for(const m of r){const x=this._fieldObjects[m]||[];for(const{id:g}of x)f.add(g)}for(const m of Object.values(this._fieldObjects))for(const x of m)f.has(x.id)===c&&d.push(x)}else for(const f of Object.values(this._fieldObjects))d.push(...f);const h=this.annotationStorage,u=[];for(const f of d){const{id:m}=f;switch(u.push(m),f.type){case"text":{const g=f.defaultValue||"";h.setValue(m,{value:g});break}case"checkbox":case"radiobutton":{const g=f.defaultValue===f.exportValues;h.setValue(m,{value:g});break}case"combobox":case"listbox":{const g=f.defaultValue||"";h.setValue(m,{value:g});break}default:continue}const x=document.querySelector(`[data-element-id="${m}"]`);if(x){if(!J0.has(x)){st(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;x.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}fo=new WeakSet,Vm=function(){this.container.setAttribute("data-internal-link","")},UX=function(t,s,i="",r=null){t.href=this.linkService.getAnchorUrl(""),s.description?t.title=s.description:i&&(t.title=i),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(s.content,s.filename,r),!1},E(this,fo,Vm).call(this)},zX=function(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(t.title=i),E(this,fo,Vm).call(this)};class Sfe extends rn{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class oy extends rn{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return wi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,o=>{var c;(c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(s,o=>{var c;if(s==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(e,t,s,i){var r,o,c;for(const[d,h]of s)(h==="Action"||(r=this.data.actions)!=null&&r[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,d,h,i),h==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((c=this.data.actions)!=null&&c.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ce.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||bfe,r=e.style;let o;const c=2,d=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c),u=Math.round(h/(PR*i))||1,p=h/u;o=Math.min(i,d(p/PR))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c);o=Math.min(i,d(h/PR))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=Ce.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Cfe extends oy{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=s),r.setValue(o.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let c=o.value||"";const d=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;d&&c.length>d&&(c=c.slice(0,d));let h=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const u={userValue:c,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??c,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??c),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),J0.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:p,datetimeType:f,timeStep:m}=this.data,x=!!f&&this.enableScripting;p&&(s.title=p),this._setRequired(s,this.data.required),d&&(s.maxLength=d),s.addEventListener("input",b=>{e.setValue(t,{value:b.target.value}),this.setPropertyOnSiblings(s,"value",b.target.value,"value"),u.formattedValue=null}),s.addEventListener("resetform",b=>{const y=this.data.defaultFieldValue??"";s.value=u.userValue=y,u.formattedValue=null});let g=b=>{const{formattedValue:y}=u;y!=null&&(b.target.value=y),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",y=>{var w;if(u.focused)return;const{target:C}=y;if(x&&(C.type=f,m&&(C.step=m)),u.userValue){const S=u.userValue;if(x)if(f==="time"){const j=new Date(S),T=[j.getHours(),j.getMinutes(),j.getSeconds()];C.value=T.map(k=>k.toString().padStart(2,"0")).join(":")}else C.value=new Date(S-vfe).toISOString().split(f==="date"?"T":".",1)[0];else C.value=S}u.lastCommittedValue=C.value,u.commitKey=1,(w=this.data.actions)!=null&&w.Focus||(u.focused=!0)}),s.addEventListener("updatefromsandbox",y=>{this.showElementAndHideCanvas(y.target);const C={value(w){u.userValue=w.detail.value??"",x||e.setValue(t,{value:u.userValue.toString()}),w.target.value=u.userValue},formattedValue(w){const{formattedValue:S}=w.detail;u.formattedValue=S,S!=null&&w.target!==document.activeElement&&(w.target.value=S);const j={formattedValue:S};x&&(j.value=S),e.setValue(t,j)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{var k;const{charLimit:S}=w.detail,{target:j}=w;if(S===0){j.removeAttribute("maxLength");return}j.setAttribute("maxLength",S);let T=u.userValue;!T||T.length<=S||(T=T.slice(0,S),j.value=u.userValue=T,e.setValue(t,{value:T}),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:j.selectionStart,selEnd:j.selectionEnd}}))}};this._dispatchEventFromSandbox(C,y)}),s.addEventListener("keydown",y=>{var S;u.commitKey=1;let C=-1;if(y.key==="Escape"?C=0:y.key==="Enter"&&!this.data.multiLine?C=2:y.key==="Tab"&&(u.commitKey=3),C===-1)return;const{value:w}=y.target;u.lastCommittedValue!==w&&(u.lastCommittedValue=w,u.userValue=w,(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:C,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}}))});const b=g;g=null,s.addEventListener("blur",y=>{var S,j;if(!u.focused||!y.relatedTarget)return;(S=this.data.actions)!=null&&S.Blur||(u.focused=!1);const{target:C}=y;let{value:w}=C;if(x){if(w&&f==="time"){const T=w.split(":").map(k=>parseInt(k,10));w=new Date(2e3,0,1,T[0],T[1],T[2]||0).valueOf(),C.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();C.type="text"}u.userValue=w,u.lastCommittedValue!==w&&((j=this.linkService.eventBus)==null||j.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:u.commitKey,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}})),b(y)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",y=>{var L;u.lastCommittedValue=null;const{data:C,target:w}=y,{value:S,selectionStart:j,selectionEnd:T}=w;let k=j,_=T;switch(y.inputType){case"deleteWordBackward":{const D=S.substring(0,j).match(/\w*[^\w]*$/);D&&(k-=D[0].length);break}case"deleteWordForward":{const D=S.substring(j).match(/^[^\w]*\w*/);D&&(_+=D[0].length);break}case"deleteContentBackward":j===T&&(k-=1);break;case"deleteContentForward":j===T&&(_+=1);break}y.preventDefault(),(L=this.linkService.eventBus)==null||L.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,change:C||"",willCommit:!1,selStart:k,selEnd:_}})}),this._setEventListeners(s,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],y=>y.target.value)}if(g&&s.addEventListener("blur",g),this.data.comb){const y=(this.data.rect[2]-this.data.rect[0])/d;s.classList.add("comb"),s.style.letterSpacing=`calc(${y}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Nfe extends oy{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class jfe extends oy{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return J0.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:c,checked:d}=o.target;for(const h of this._getElementsByName(c,s)){const u=d&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=u),e.setValue(h.id,{value:u})}e.setValue(s,{value:d})}),r.addEventListener("resetform",o=>{const c=t.defaultFieldValue||"Off";o.target.checked=c===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const c={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(s,{value:d.target.checked})}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class HX extends oy{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,s))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(J0.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:c,checked:d}=o.target;for(const h of this._getElementsByName(c,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:d})}),r.addEventListener("resetform",o=>{const c=t.defaultFieldValue;o.target.checked=c!=null&&c===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",c=>{const d={value:h=>{const u=o===h.detail.value;for(const p of this._getElementsByName(h.target.name)){const f=u&&p.id===s;p.domElement&&(p.domElement.checked=f),e.setValue(p.id,{value:f})}}};this._dispatchEventFromSandbox(d,c)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Afe extends R3{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class Efe extends oy{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");J0.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{const p=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===p});for(const u of this.data.options){const p=document.createElement("option");p.textContent=u.displayValue,p.value=u.exportValue,s.value.includes(u.exportValue)&&(p.setAttribute("selected",!0),r=!1),i.append(p)}let o=null;if(r){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),o=()=>{u.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const c=u=>{const p=u?"value":"textContent",{options:f,multiple:m}=i;return m?Array.prototype.filter.call(f,x=>x.selected).map(x=>x[p]):f.selectedIndex===-1?null:f[f.selectedIndex][p]};let d=c(!1);const h=u=>{const p=u.target.options;return Array.prototype.map.call(p,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{const p={value(f){o==null||o();const m=f.detail.value,x=new Set(Array.isArray(m)?m:[m]);for(const g of i.options)g.selected=x.has(g.value);e.setValue(t,{value:c(!0)}),d=c(!1)},multipleSelection(f){i.multiple=!0},remove(f){const m=i.options,x=f.detail.remove;m[x].selected=!1,i.remove(x),m.length>0&&Array.prototype.findIndex.call(m,b=>b.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:c(!0),items:h(f)}),d=c(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),d=c(!1)},insert(f){const{index:m,displayValue:x,exportValue:g}=f.detail.insert,b=i.children[m],y=document.createElement("option");y.textContent=x,y.value=g,b?b.before(y):i.append(y),e.setValue(t,{value:c(!0),items:h(f)}),d=c(!1)},items(f){const{items:m}=f.detail;for(;i.length!==0;)i.remove(0);for(const x of m){const{displayValue:g,exportValue:b}=x,y=document.createElement("option");y.textContent=g,y.value=b,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:c(!0),items:h(f)}),d=c(!1)},indices(f){const m=new Set(f.detail.indices);for(const x of f.target.options)x.selected=m.has(x.index);e.setValue(t,{value:c(!0)}),d=c(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(p,u)}),i.addEventListener("input",u=>{var m;const p=c(!0),f=c(!1);e.setValue(t,{value:p}),u.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:f,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){e.setValue(t,{value:c(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}var IA,LF;class PF extends rn{constructor(t){const{data:s,elements:i,parent:r}=t,o=!!r._commentManager;super(t,{isRenderable:!o&&rn._hasPopupData(s)});A(this,IA);if(this.elements=i,o&&rn._hasPopupData(s)){const c=this.popup=E(this,IA,LF).call(this);for(const d of i)d.popup=c}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const s=this.popup=E(this,IA,LF).call(this),i=[];for(const r of this.elements)r.popup=s,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${j3}${r}`).join(",")),this.container}}IA=new WeakSet,LF=function(){return new kfe({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var Ya,kf,rL,aL,Gw,Ww,fn,ld,Tf,l0,qw,Yw,cd,Xa,nu,iu,ui,ru,_f,MA,au,Xw,c0,Pf,pr,Lf,pt,l_,DF,RF,IF,c_,MF,VX,GX,WX,qX,d_,h_,FF;class kfe{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:c,parent:d,rect:h,parentRect:u,open:p,commentManager:f=null}){A(this,pt);A(this,Ya,null);A(this,kf,E(this,pt,WX).bind(this));A(this,rL,E(this,pt,FF).bind(this));A(this,aL,E(this,pt,h_).bind(this));A(this,Gw,E(this,pt,d_).bind(this));A(this,Ww,null);A(this,fn,null);A(this,ld,null);A(this,Tf,null);A(this,l0,null);A(this,qw,null);A(this,Yw,null);A(this,cd,!1);A(this,Xa,null);A(this,nu,null);A(this,iu,null);A(this,ui,null);A(this,ru,null);A(this,_f,null);A(this,MA,null);A(this,au,null);A(this,Xw,null);A(this,c0,null);A(this,Pf,!1);A(this,pr,null);A(this,Lf,null);v(this,fn,e),v(this,Xw,i),v(this,ld,o),v(this,au,c),v(this,qw,d),v(this,Ww,t),v(this,MA,h),v(this,Yw,u),v(this,l0,s),v(this,Ya,f),v(this,pr,s[0]),v(this,Tf,MN.toDateObject(r)),this.trigger=s.flatMap(m=>m.getElementsToTriggerPopup()),f?this.renderCommentButton():(E(this,pt,l_).call(this),l(this,fn).hidden=!0,p&&E(this,pt,d_).call(this))}renderCommentButton(){if(l(this,ui)||(l(this,ru)||E(this,pt,DF).call(this),!l(this,ru)))return;const{signal:e}=v(this,nu,new AbortController),t=!!l(this,pr).extraPopupElement,s=()=>{l(this,Ya).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{l(this,Ya).toggleCommentPopup(this,!1,!0,!t)},r=()=>{l(this,Ya).toggleCommentPopup(this,!1,!1)};if(t){v(this,ui,l(this,pr).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",l(this,kf),{signal:e}),o.addEventListener("click",s,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=v(this,ui,document.createElement("button"));o.className="annotationCommentButton";const c=l(this,pr).container;o.style.zIndex=c.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),E(this,pt,IF).call(this),E(this,pt,RF).call(this),o.addEventListener("keydown",l(this,kf),{signal:e}),o.addEventListener("click",s,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),c.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=l(this,pr).commentData;return e?l(this,qw)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=l(this,ui))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}=l(this,pr).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}}get elementBeforePopup(){return l(this,ui)}get comment(){return l(this,Lf)||v(this,Lf,l(this,pr).commentText),l(this,Lf)}set comment(e){e!==this.comment&&(l(this,pr).commentText=v(this,Lf,e))}get parentBoundingClientRect(){return l(this,pr).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){l(this,ui)&&(l(this,ui).classList.toggle("selected",e),l(this,ui).ariaExpanded=t)}setSelectedCommentButton(e){l(this,ui).classList.toggle("selected",e)}get commentPopupPosition(){if(l(this,_f))return l(this,_f);const{x:e,y:t,height:s}=l(this,ui).getBoundingClientRect(),{x:i,y:r,width:o,height:c}=l(this,pr).layer.getBoundingClientRect();return[(e-i)/o,(t+s-r)/c]}set commentPopupPosition(e){v(this,_f,e)}hasDefaultPopupPosition(){return l(this,_f)===null}get commentButtonPosition(){return l(this,ru)}get commentButtonWidth(){return l(this,ui).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=l(this,_f)||this.commentButtonPosition.map(h=>h/100),i=this.parentBoundingClientRect,{x:r,y:o,width:c,height:d}=i;l(this,Ya).showDialog(null,this,r+t*c,o+s*d,{...e,parentDimensions:i})}render(){var s,i;if(l(this,Xa))return;const e=v(this,Xa,document.createElement("div"));if(e.className="popup",l(this,Ww)){const r=e.style.outlineColor=Ce.makeHexColor(...l(this,Ww));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(s=l(this,Xw))!=null&&s.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=l(this,Xw)}if(e.append(t),l(this,Tf)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,Tf).valueOf()})),r.dateTime=l(this,Tf).toISOString(),t.append(r)}E3({html:l(this,pt,c_)||l(this,ld).str,dir:(i=l(this,ld))==null?void 0:i.dir,className:"popupContent"},e),l(this,fn).append(e)}updateEdited({rect:e,popup:t,deleted:s}){var i;if(l(this,Ya)){s?(this.remove(),v(this,Lf,null)):t&&(t.deleted?this.remove():(E(this,pt,IF).call(this),v(this,Lf,t.text))),e&&(v(this,ru,null),E(this,pt,DF).call(this),E(this,pt,RF).call(this));return}if(s||t!=null&&t.deleted){this.remove();return}E(this,pt,l_).call(this),l(this,c0)||v(this,c0,{contentsObj:l(this,ld),richText:l(this,au)}),e&&v(this,iu,null),t&&t.text&&(v(this,au,E(this,pt,GX).call(this,t.text)),v(this,Tf,MN.toDateObject(t.date)),v(this,ld,null)),(i=l(this,Xa))==null||i.remove(),v(this,Xa,null)}resetEdited(){var e;l(this,c0)&&({contentsObj:vt(this,ld)._,richText:vt(this,au)._}=l(this,c0),v(this,c0,null),(e=l(this,Xa))==null||e.remove(),v(this,Xa,null),v(this,iu,null))}remove(){var e,t,s;if((e=l(this,nu))==null||e.abort(),v(this,nu,null),(t=l(this,Xa))==null||t.remove(),v(this,Xa,null),v(this,Pf,!1),v(this,cd,!1),(s=l(this,ui))==null||s.remove(),v(this,ui,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){v(this,Pf,this.isVisible),l(this,Pf)&&(l(this,fn).hidden=!0)}maybeShow(){l(this,Ya)||(E(this,pt,l_).call(this),l(this,Pf)&&(l(this,Xa)||E(this,pt,h_).call(this),v(this,Pf,!1),l(this,fn).hidden=!1))}get isVisible(){return l(this,Ya)?!1:l(this,fn).hidden===!1}}Ya=new WeakMap,kf=new WeakMap,rL=new WeakMap,aL=new WeakMap,Gw=new WeakMap,Ww=new WeakMap,fn=new WeakMap,ld=new WeakMap,Tf=new WeakMap,l0=new WeakMap,qw=new WeakMap,Yw=new WeakMap,cd=new WeakMap,Xa=new WeakMap,nu=new WeakMap,iu=new WeakMap,ui=new WeakMap,ru=new WeakMap,_f=new WeakMap,MA=new WeakMap,au=new WeakMap,Xw=new WeakMap,c0=new WeakMap,Pf=new WeakMap,pr=new WeakMap,Lf=new WeakMap,pt=new WeakSet,l_=function(){var t;if(l(this,nu))return;v(this,nu,new AbortController);const{signal:e}=l(this,nu);for(const s of this.trigger)s.addEventListener("click",l(this,Gw),{signal:e}),s.addEventListener("pointerenter",l(this,aL),{signal:e}),s.addEventListener("pointerleave",l(this,rL),{signal:e}),s.classList.add("popupTriggerArea");for(const s of l(this,l0))(t=s.container)==null||t.addEventListener("keydown",l(this,kf),{signal:e})},DF=function(){const e=l(this,l0).find(t=>t.hasCommentButton);e&&v(this,ru,e._normalizePoint(e.commentButtonPosition))},RF=function(){if(l(this,pr).extraPopupElement&&!l(this,pr).editor)return;this.renderCommentButton();const[e,t]=l(this,ru),{style:s}=l(this,ui);s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`},IF=function(){l(this,pr).extraPopupElement||(this.renderCommentButton(),l(this,ui).style.backgroundColor=this.commentButtonColor||"")},c_=function(){const e=l(this,au),t=l(this,ld);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&l(this,au).html||null},MF=function(){var e,t,s;return((s=(t=(e=l(this,pt,c_))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},VX=function(){var e,t,s;return((s=(t=(e=l(this,pt,c_))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},GX=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:l(this,pt,VX),fontSize:l(this,pt,MF)?`calc(${l(this,pt,MF)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},WX=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&l(this,cd))&&E(this,pt,d_).call(this)},qX=function(){if(l(this,iu)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=l(this,qw);let o=!!l(this,Yw),c=o?l(this,Yw):l(this,MA);for(const x of l(this,l0))if(!c||Ce.intersect(x.data.rect,c)!==null){c=x.data.rect,o=!0;break}const d=Ce.normalizeRect([c[0],e[3]-c[1]+e[1],c[2],e[3]-c[3]+e[1]]),u=o?c[2]-c[0]+5:0,p=d[0]+u,f=d[1];v(this,iu,[100*(p-i)/t,100*(f-r)/s]);const{style:m}=l(this,fn);m.left=`${l(this,iu)[0]}%`,m.top=`${l(this,iu)[1]}%`},d_=function(){if(l(this,Ya)){l(this,Ya).toggleCommentPopup(this,!1);return}v(this,cd,!l(this,cd)),l(this,cd)?(E(this,pt,h_).call(this),l(this,fn).addEventListener("click",l(this,Gw)),l(this,fn).addEventListener("keydown",l(this,kf))):(E(this,pt,FF).call(this),l(this,fn).removeEventListener("click",l(this,Gw)),l(this,fn).removeEventListener("keydown",l(this,kf)))},h_=function(){l(this,Xa)||this.render(),this.isVisible?l(this,cd)&&l(this,fn).classList.add("focused"):(E(this,pt,qX).call(this),l(this,fn).hidden=!1,l(this,fn).style.zIndex=parseInt(l(this,fn).style.zIndex)+1e3)},FF=function(){l(this,fn).classList.remove("focused"),!(l(this,cd)||!this.isVisible)&&(l(this,fn).hidden=!0,l(this,fn).style.zIndex=parseInt(l(this,fn).style.zIndex)-1e3)};class YX extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=et.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var FA;class Tfe extends rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,FA,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=v(this,FA,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,FA)}addHighlightArea(){this.container.classList.add("highlightArea")}}FA=new WeakMap;var OA;class _fe extends rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,OA,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,c=v(this,OA,this.svgFactory.createElement("svg:rect"));return c.setAttribute("x",o/2),c.setAttribute("y",o/2),c.setAttribute("width",s-o),c.setAttribute("height",i-o),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,OA)}addHighlightArea(){this.container.classList.add("highlightArea")}}OA=new WeakMap;var BA;class Pfe extends rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,BA,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,c=v(this,BA,this.svgFactory.createElement("svg:ellipse"));return c.setAttribute("cx",s/2),c.setAttribute("cy",i/2),c.setAttribute("rx",s/2-o/2),c.setAttribute("ry",i/2-o/2),c.setAttribute("stroke-width",o||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c),this.container.append(r),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,BA)}addHighlightArea(){this.container.classList.add("highlightArea")}}BA=new WeakMap;var $A;class XX extends rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,$A,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r},width:o,height:c}=this;if(!s)return this.container;const d=this.svgFactory.create(o,c,!0);let h=[];for(let p=0,f=s.length;p<f;p+=2){const m=s[p]-t[0],x=t[3]-s[p+1];h.push(`${m},${x}`)}h=h.join(" ");const u=v(this,$A,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",h),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),d.append(u),this.container.append(d),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,$A)}addHighlightArea(){this.container.classList.add("highlightArea")}}$A=new WeakMap;class Lfe extends XX{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Dfe extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var UA,d0,zA,OF;class I3 extends rn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});A(this,zA);A(this,UA,null);A(this,d0,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?et.HIGHLIGHT:et.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:c,width:d,height:h}=E(this,zA,OF).call(this,s,t),u=this.svgFactory.create(d,h,!0),p=v(this,UA,this.svgFactory.createElement("svg:g"));u.append(p),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",c);for(let f=0,m=i.length;f<m;f++){const x=this.svgFactory.createElement(this.svgElementName);l(this,d0).push(x),x.setAttribute("points",i[f].join(",")),p.append(x)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,o=l(this,UA);if(s>=0&&o.setAttribute("stroke-width",s||1),i)for(let c=0,d=l(this,d0).length;c<d;c++)l(this,d0)[c].setAttribute("points",i[c].join(","));if(r){const{transform:c,width:d,height:h}=E(this,zA,OF).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${d} ${h}`),o.setAttribute("transform",c)}}getElementsToTriggerPopup(){return l(this,d0)}addHighlightArea(){this.container.classList.add("highlightArea")}}UA=new WeakMap,d0=new WeakMap,zA=new WeakSet,OF=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class KX extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=et.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Rfe extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Ife extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Mfe extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class QX extends rn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=et.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var HA,VA,BF;class Ffe extends rn{constructor(t){var i;super(t,{isRenderable:!0});A(this,VA);A(this,HA,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",E(this,VA,BF).bind(this)),v(this,HA,i);const{isMac:r}=wi.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&E(this,VA,BF).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return l(this,HA)}addHighlightArea(){this.container.classList.add("highlightArea")}}HA=new WeakMap,VA=new WeakSet,BF=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Kw,h0,Qw,Df,GA,u0,ym,$F,UF,Jw;let M3=(Jw=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:c,commentManager:d,linkService:h,annotationStorage:u}){A(this,ym);A(this,Kw,null);A(this,h0,null);A(this,Qw,null);A(this,Df,new Map);A(this,GA,null);A(this,u0,null);this.div=e,v(this,Kw,t),v(this,h0,s),v(this,GA,c||null),v(this,u0,h||null),v(this,Qw,u||new k3),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=d||null}hasEditableAnnotations(){return l(this,Df).size>0}async render(e){var o,c,d;const{annotations:t}=e,s=this.div;fm(s,this.viewport);const i=new Map,r={data:null,layer:s,linkService:l(this,u0),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new $N,annotationStorage:l(this,Qw),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const h of t){if(h.noHTML)continue;const u=h.annotationType===jn.POPUP;if(u){const m=i.get(h.id);if(!m)continue;r.elements=m}else if(h.rect[2]===h.rect[0]||h.rect[3]===h.rect[1])continue;r.data=h;const p=kz.create(r);if(!p.isRenderable)continue;if(!u&&h.popupRef){const m=i.get(h.popupRef);m?m.push(p):i.set(h.popupRef,[p])}const f=p.render();h.hidden&&(f.style.visibility="hidden"),await E(this,ym,$F).call(this,f,h.id,r.elements),(c=(o=p.extraPopupElement)==null?void 0:o.popup)==null||c.renderCommentButton(),p._isEditable&&(l(this,Df).set(p.data.id,p),(d=this._annotationEditorUIManager)==null||d.renderAnnotationElement(p))}E(this,ym,UF).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:l(this,u0),svgFactory:new $N,parent:this};for(const s of e){s.borderStyle||(s.borderStyle=Jw._defaultBorderStyle),t.data=s;const i=kz.create(t);if(!i.isRenderable)continue;const r=i.render();await E(this,ym,$F).call(this,r,s.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,fm(t,{rotation:e.rotation}),E(this,ym,UF).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(l(this,Df).values())}getEditableAnnotation(e){return l(this,Df).get(e)}addFakeAnnotation(e){var c;const{div:t}=this,{id:s,rotation:i}=e,r=new wfe({data:{id:s,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:l(this,u0),annotationStorage:l(this,Qw)}),o=r.render();return t.append(o),(c=l(this,Kw))==null||c.moveElementInDOM(t,o,o,!1),r.createOrUpdatePopup(),r}static get _defaultBorderStyle(){return ct(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Ty.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},Kw=new WeakMap,h0=new WeakMap,Qw=new WeakMap,Df=new WeakMap,GA=new WeakMap,u0=new WeakMap,ym=new WeakSet,$F=async function(e,t,s){var c,d;const i=e.firstChild||e,r=i.id=`${j3}${t}`,o=await((c=l(this,GA))==null?void 0:c.getAriaAttributes(r));if(o)for(const[h,u]of o)i.setAttribute(h,u);s?s.at(-1).container.after(e):(this.div.append(e),(d=l(this,Kw))==null||d.moveElementInDOM(this.div,e,i,!1))},UF=function(){var t;if(!l(this,h0))return;const e=this.div;for(const[s,i]of l(this,h0)){const r=e.querySelector(`[data-annotation-id="${s}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(i):o.classList.contains("annotationContent")?o.after(i):o.before(i):r.append(i);const c=l(this,Df).get(s);c&&(c._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,r.id,i),c._hasNoCanvas=!1):c.canvas=i)}l(this,h0).clear()},Jw);const $k=/\r\n?|\n/g;var Ka,WA,p0,Qa,qn,JX,ZX,eK,u_,ku,p_,f_,tK,HF,sK;const Ds=class Ds extends _s{constructor(t){super({...t,name:"freeTextEditor"});A(this,qn);A(this,Ka,"");A(this,WA,`${this.id}-editor`);A(this,p0,null);A(this,Qa);W(this,"_colorPicker",null);this.color=t.color||Ds._defaultColor||_s._defaultLineColor,v(this,Qa,t.fontSize||Ds._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const t=Ds.prototype,s=o=>o.isEmpty(),i=mm.TRANSLATE_SMALL,r=mm.TRANSLATE_BIG;return ct(this,"_keyboardManager",new RE([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){_s.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case Nt.FREETEXT_SIZE:Ds._defaultFontSize=s;break;case Nt.FREETEXT_COLOR:Ds._defaultColor=s;break}}updateParams(t,s){switch(t){case Nt.FREETEXT_SIZE:E(this,qn,JX).call(this,s);break;case Nt.FREETEXT_COLOR:E(this,qn,ZX).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Nt.FREETEXT_SIZE,Ds._defaultFontSize],[Nt.FREETEXT_COLOR,Ds._defaultColor||_s._defaultLineColor]]}get propertiesToUpdate(){return[[Nt.FREETEXT_SIZE,l(this,Qa)],[Nt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new jP(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Nt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Ds._internalPadding*t,-(Ds._internalPadding+l(this,Qa))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),v(this,p0,new AbortController);const t=this._uiManager.combinedSignal(l(this,p0));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,WA)),this._isDraggable=!0,(t=l(this,p0))==null||t.abort(),v(this,p0,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=l(this,Ka),s=v(this,Ka,E(this,qn,eK).call(this).trimEnd());if(t===s)return;const i=r=>{if(v(this,Ka,r),!r){this.remove();return}E(this,qn,f_).call(this),this._uiManager.rebuild(this),E(this,qn,u_).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),E(this,qn,u_).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Ds._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,WA)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${l(this,Qa)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:c}=this._initialData;let[d,h]=this.getInitialTranslation();[d,h]=this.pageTranslationToScreen(d,h);const[u,p]=this.pageDimensions,[f,m]=this.pageTranslation;let x,g;switch(this.rotation){case 0:x=t+(c[0]-f)/u,g=s+this.height-(c[1]-m)/p;break;case 90:x=t+(c[0]-f)/u,g=s-(c[1]-m)/p,[d,h]=[h,-d];break;case 180:x=t-this.width+(c[0]-f)/u,g=s-(c[1]-m)/p,[d,h]=[-d,-h];break;case 270:x=t+(c[0]-f-this.height*p)/u,g=s+(c[1]-m-this.width*u)/p,[d,h]=[-h,d];break}this.setAt(x*r,g*o,d,h)}else this._moveAfterPaste(t,s);E(this,qn,f_).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var x,g,b;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=E(x=Ds,ku,HF).call(x,s.getData("text")||"").replaceAll($k,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const c=o.getRangeAt(0);if(!r.includes(`
`)){c.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:d,startOffset:h}=c,u=[],p=[];if(d.nodeType===Node.TEXT_NODE){const y=d.parentElement;if(p.push(d.nodeValue.slice(h).replaceAll($k,"")),y!==this.editorDiv){let C=u;for(const w of this.editorDiv.childNodes){if(w===y){C=p;continue}C.push(E(g=Ds,ku,p_).call(g,w))}}u.push(d.nodeValue.slice(0,h).replaceAll($k,""))}else if(d===this.editorDiv){let y=u,C=0;for(const w of this.editorDiv.childNodes)C++===h&&(y=p),y.push(E(b=Ds,ku,p_).call(b,w))}v(this,Ka,`${u.join(`
`)}${r}${p.join(`
`)}`),E(this,qn,f_).call(this);const f=new Range;let m=Math.sumPrecise(u.map(y=>y.length));for(const{firstChild:y}of this.editorDiv.childNodes)if(y.nodeType===Node.TEXT_NODE){const C=y.nodeValue.length;if(m<=C){f.setStart(y,m),f.setEnd(y,m);break}m-=C}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Ds._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,s,i){var c;let r=null;if(t instanceof YX){const{data:{defaultAppearanceData:{fontSize:d,fontColor:h},rect:u,rotation:p,id:f,popupRef:m,richText:x,contentsObj:g,creationDate:b,modificationDate:y},textContent:C,textPosition:w,parent:{page:{pageNumber:S}}}=t;if(!C||C.length===0)return null;r=t={annotationType:et.FREETEXT,color:Array.from(h),fontSize:d,value:C.join(`
`),position:w,pageIndex:S-1,rect:u.slice(0),rotation:p,annotationElementId:f,id:f,deleted:!1,popupRef:m,comment:(g==null?void 0:g.str)||null,richText:x,creationDate:b,modificationDate:y}}const o=await super.deserialize(t,s,i);return v(o,Qa,t.fontSize),o.color=Ce.makeHexColor(...t.color),v(o,Ka,E(c=Ds,ku,HF).call(c,t.value)),o._initialData=r,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=_s._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:s,fontSize:l(this,Qa),value:E(this,qn,tK).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!E(this,qn,sK).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(!s)return null;const{style:i}=s;i.fontSize=`calc(${l(this,Qa)}px * var(--total-scale-factor))`,i.color=this.color,s.replaceChildren();for(const r of l(this,Ka).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),s.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:l(this,Ka)}}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Ka=new WeakMap,WA=new WeakMap,p0=new WeakMap,Qa=new WeakMap,qn=new WeakSet,JX=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-l(this,Qa))*this.parentScale),v(this,Qa,r),E(this,qn,u_).call(this)},i=l(this,Qa);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},ZX=function(t){const s=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},eK=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(E(i=Ds,ku,p_).call(i,r)),s=r);return t.join(`
`)},u_=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,c=o.style.display,d=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=c,o.classList.toggle("hidden",d)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},ku=new WeakSet,p_=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll($k,"")},f_=function(){if(this.editorDiv.replaceChildren(),!!l(this,Ka))for(const t of l(this,Ka).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},tK=function(){return l(this,Ka).replaceAll(""," ")},HF=function(t){return t.replaceAll(" ","")},sK=function(t){const{value:s,fontSize:i,color:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((c,d)=>c!==r[d])||t.pageIndex!==o},A(Ds,ku),W(Ds,"_freeTextDefaultContent",""),W(Ds,"_internalPadding",0),W(Ds,"_defaultColor",null),W(Ds,"_defaultFontSize",10),W(Ds,"_type","freetext"),W(Ds,"_editorType",et.FREETEXT);let zF=Ds;class Se{toSVGPath(){Ns("Abstract method `toSVGPath` must be implemented.")}get box(){Ns("Abstract getter `box` must be implemented.")}serialize(e,t){Ns("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let c=0,d=e.length;c<d;c+=2)o[c]=t+e[c]*i,o[c+1]=s+e[c+1]*r;return o}static _rescaleAndSwap(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let c=0,d=e.length;c<d;c+=2)o[c]=t+e[c+1]*i,o[c+1]=s+e[c]*r;return o}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,o){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+o)/6,(s+r)/2,(i+o)/2]}}W(Se,"PRECISION",1e-4);var Ja,Xl,Zw,e1,dd,yt,f0,m0,qA,YA,t1,s1,Rf,XA,oL,lL,si,TC,nK,iK,rK,aK,oK,lK;const Qd=class Qd{constructor({x:e,y:t},s,i,r,o,c=0){A(this,si);A(this,Ja);A(this,Xl,[]);A(this,Zw);A(this,e1);A(this,dd,[]);A(this,yt,new Float32Array(18));A(this,f0);A(this,m0);A(this,qA);A(this,YA);A(this,t1);A(this,s1);A(this,Rf,[]);v(this,Ja,s),v(this,s1,r*i),v(this,e1,o),l(this,yt).set([NaN,NaN,NaN,NaN,e,t],6),v(this,Zw,c),v(this,YA,l(Qd,XA)*i),v(this,qA,l(Qd,lL)*i),v(this,t1,i),l(this,Rf).push(e,t)}isEmpty(){return isNaN(l(this,yt)[8])}add({x:e,y:t}){var L;v(this,f0,e),v(this,m0,t);const[s,i,r,o]=l(this,Ja);let[c,d,h,u]=l(this,yt).subarray(8,12);const p=e-h,f=t-u,m=Math.hypot(p,f);if(m<l(this,qA))return!1;const x=m-l(this,YA),g=x/m,b=g*p,y=g*f;let C=c,w=d;c=h,d=u,h+=b,u+=y,(L=l(this,Rf))==null||L.push(e,t);const S=-y/x,j=b/x,T=S*l(this,s1),k=j*l(this,s1);return l(this,yt).set(l(this,yt).subarray(2,8),0),l(this,yt).set([h+T,u+k],4),l(this,yt).set(l(this,yt).subarray(14,18),12),l(this,yt).set([h-T,u-k],16),isNaN(l(this,yt)[6])?(l(this,dd).length===0&&(l(this,yt).set([c+T,d+k],2),l(this,dd).push(NaN,NaN,NaN,NaN,(c+T-s)/r,(d+k-i)/o),l(this,yt).set([c-T,d-k],14),l(this,Xl).push(NaN,NaN,NaN,NaN,(c-T-s)/r,(d-k-i)/o)),l(this,yt).set([C,w,c,d,h,u],6),!this.isEmpty()):(l(this,yt).set([C,w,c,d,h,u],6),Math.abs(Math.atan2(w-d,C-c)-Math.atan2(y,b))<Math.PI/2?([c,d,h,u]=l(this,yt).subarray(2,6),l(this,dd).push(NaN,NaN,NaN,NaN,((c+h)/2-s)/r,((d+u)/2-i)/o),[c,d,C,w]=l(this,yt).subarray(14,18),l(this,Xl).push(NaN,NaN,NaN,NaN,((C+c)/2-s)/r,((w+d)/2-i)/o),!0):([C,w,c,d,h,u]=l(this,yt).subarray(0,6),l(this,dd).push(((C+5*c)/6-s)/r,((w+5*d)/6-i)/o,((5*c+h)/6-s)/r,((5*d+u)/6-i)/o,((c+h)/2-s)/r,((d+u)/2-i)/o),[h,u,c,d,C,w]=l(this,yt).subarray(12,18),l(this,Xl).push(((C+5*c)/6-s)/r,((w+5*d)/6-i)/o,((5*c+h)/6-s)/r,((5*d+u)/6-i)/o,((c+h)/2-s)/r,((d+u)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=l(this,dd),t=l(this,Xl);if(isNaN(l(this,yt)[6])&&!this.isEmpty())return E(this,si,nK).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);E(this,si,rK).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return E(this,si,iK).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,o){return new cK(e,t,s,i,r,o)}getOutlines(){var p;const e=l(this,dd),t=l(this,Xl),s=l(this,yt),[i,r,o,c]=l(this,Ja),d=new Float32Array((((p=l(this,Rf))==null?void 0:p.length)??0)+2);for(let f=0,m=d.length-2;f<m;f+=2)d[f]=(l(this,Rf)[f]-i)/o,d[f+1]=(l(this,Rf)[f+1]-r)/c;if(d[d.length-2]=(l(this,f0)-i)/o,d[d.length-1]=(l(this,m0)-r)/c,isNaN(s[6])&&!this.isEmpty())return E(this,si,aK).call(this,d);const h=new Float32Array(l(this,dd).length+24+l(this,Xl).length);let u=e.length;for(let f=0;f<u;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}u=E(this,si,lK).call(this,h,u);for(let f=t.length-6;f>=6;f-=6)for(let m=0;m<6;m+=2){if(isNaN(t[f+m])){h[u]=h[u+1]=NaN,u+=2;continue}h[u]=t[f+m],h[u+1]=t[f+m+1],u+=2}return E(this,si,oK).call(this,h,u),this.newFreeDrawOutline(h,d,l(this,Ja),l(this,t1),l(this,Zw),l(this,e1))}};Ja=new WeakMap,Xl=new WeakMap,Zw=new WeakMap,e1=new WeakMap,dd=new WeakMap,yt=new WeakMap,f0=new WeakMap,m0=new WeakMap,qA=new WeakMap,YA=new WeakMap,t1=new WeakMap,s1=new WeakMap,Rf=new WeakMap,XA=new WeakMap,oL=new WeakMap,lL=new WeakMap,si=new WeakSet,TC=function(){const e=l(this,yt).subarray(4,6),t=l(this,yt).subarray(16,18),[s,i,r,o]=l(this,Ja);return[(l(this,f0)+(e[0]-t[0])/2-s)/r,(l(this,m0)+(e[1]-t[1])/2-i)/o,(l(this,f0)+(t[0]-e[0])/2-s)/r,(l(this,m0)+(t[1]-e[1])/2-i)/o]},nK=function(){const[e,t,s,i]=l(this,Ja),[r,o,c,d]=E(this,si,TC).call(this);return`M${(l(this,yt)[2]-e)/s} ${(l(this,yt)[3]-t)/i} L${(l(this,yt)[4]-e)/s} ${(l(this,yt)[5]-t)/i} L${r} ${o} L${c} ${d} L${(l(this,yt)[16]-e)/s} ${(l(this,yt)[17]-t)/i} L${(l(this,yt)[14]-e)/s} ${(l(this,yt)[15]-t)/i} Z`},iK=function(e){const t=l(this,Xl);e.push(`L${t[4]} ${t[5]} Z`)},rK=function(e){const[t,s,i,r]=l(this,Ja),o=l(this,yt).subarray(4,6),c=l(this,yt).subarray(16,18),[d,h,u,p]=E(this,si,TC).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-s)/r} L${d} ${h} L${u} ${p} L${(c[0]-t)/i} ${(c[1]-s)/r}`)},aK=function(e){const t=l(this,yt),[s,i,r,o]=l(this,Ja),[c,d,h,u]=E(this,si,TC).call(this),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(p,e,l(this,Ja),l(this,t1),l(this,Zw),l(this,e1))},oK=function(e,t){const s=l(this,Xl);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},lK=function(e,t){const s=l(this,yt).subarray(4,6),i=l(this,yt).subarray(16,18),[r,o,c,d]=l(this,Ja),[h,u,p,f]=E(this,si,TC).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/c,(s[1]-o)/d,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,p,f,NaN,NaN,NaN,NaN,(i[0]-r)/c,(i[1]-o)/d],t),t+=24},A(Qd,XA,8),A(Qd,oL,2),A(Qd,lL,l(Qd,XA)+l(Qd,oL));let AP=Qd;var n1,g0,ou,KA,Za,QA,Tn,cL,dK;class cK extends Se{constructor(t,s,i,r,o,c){super();A(this,cL);A(this,n1);A(this,g0,new Float32Array(4));A(this,ou);A(this,KA);A(this,Za);A(this,QA);A(this,Tn);v(this,Tn,t),v(this,Za,s),v(this,n1,i),v(this,QA,r),v(this,ou,o),v(this,KA,c),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],E(this,cL,dK).call(this,c);const[d,h,u,p]=l(this,g0);for(let f=0,m=t.length;f<m;f+=2)t[f]=(t[f]-d)/u,t[f+1]=(t[f+1]-h)/p;for(let f=0,m=s.length;f<m;f+=2)s[f]=(s[f]-d)/u,s[f+1]=(s[f+1]-h)/p}toSVGPath(){const t=[`M${l(this,Tn)[4]} ${l(this,Tn)[5]}`];for(let s=6,i=l(this,Tn).length;s<i;s+=6){if(isNaN(l(this,Tn)[s])){t.push(`L${l(this,Tn)[s+4]} ${l(this,Tn)[s+5]}`);continue}t.push(`C${l(this,Tn)[s]} ${l(this,Tn)[s+1]} ${l(this,Tn)[s+2]} ${l(this,Tn)[s+3]} ${l(this,Tn)[s+4]} ${l(this,Tn)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],o){const c=i-t,d=r-s;let h,u;switch(o){case 0:h=Se._rescale(l(this,Tn),t,r,c,-d),u=Se._rescale(l(this,Za),t,r,c,-d);break;case 90:h=Se._rescaleAndSwap(l(this,Tn),t,s,c,d),u=Se._rescaleAndSwap(l(this,Za),t,s,c,d);break;case 180:h=Se._rescale(l(this,Tn),i,s,-c,d),u=Se._rescale(l(this,Za),i,s,-c,d);break;case 270:h=Se._rescaleAndSwap(l(this,Tn),i,r,-c,-d),u=Se._rescaleAndSwap(l(this,Za),i,r,-c,-d);break}return{outline:Array.from(h),points:[Array.from(u)]}}get box(){return l(this,g0)}newOutliner(t,s,i,r,o,c=0){return new AP(t,s,i,r,o,c)}getNewOutline(t,s){const[i,r,o,c]=l(this,g0),[d,h,u,p]=l(this,n1),f=o*u,m=c*p,x=i*u+d,g=r*p+h,b=this.newOutliner({x:l(this,Za)[0]*f+x,y:l(this,Za)[1]*m+g},l(this,n1),l(this,QA),t,l(this,KA),s??l(this,ou));for(let y=2;y<l(this,Za).length;y+=2)b.add({x:l(this,Za)[y]*f+x,y:l(this,Za)[y+1]*m+g});return b.getOutlines()}}n1=new WeakMap,g0=new WeakMap,ou=new WeakMap,KA=new WeakMap,Za=new WeakMap,QA=new WeakMap,Tn=new WeakMap,cL=new WeakSet,dK=function(t){const s=l(this,Tn);let i=s[4],r=s[5];const o=[i,r,i,r];let c=i,d=r,h=i,u=r;const p=t?Math.max:Math.min,f=new Float32Array(4);for(let x=6,g=s.length;x<g;x+=6){const b=s[x+4],y=s[x+5];isNaN(s[x])?(Ce.pointBoundingBox(b,y,o),d>y?(c=b,d=y):d===y&&(c=p(c,b)),u<y?(h=b,u=y):u===y&&(h=p(h,b))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,Ce.bezierBoundingBox(i,r,...s.slice(x,x+6),f),Ce.rectBoundingBox(f[0],f[1],f[2],f[3],o),d>f[1]?(c=f[0],d=f[1]):d===f[1]&&(c=p(c,f[0])),u<f[3]?(h=f[2],u=f[3]):u===f[3]&&(h=p(h,f[2]))),i=b,r=y}const m=l(this,g0);m[0]=o[0]-l(this,ou),m[1]=o[1]-l(this,ou),m[2]=o[2]-o[0]+2*l(this,ou),m[3]=o[3]-o[1]+2*l(this,ou),this.firstPoint=[c,d],this.lastPoint=[h,u]};var JA,ZA,eE,If,Kl,Hr,hK,m_,uK,pK,GF;class VF{constructor(e,t=0,s=0,i=!0){A(this,Hr);A(this,JA);A(this,ZA);A(this,eE);A(this,If,[]);A(this,Kl,[]);const r=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:g,y:b,width:y,height:C}of e){const w=Math.floor((g-t)/o)*o,S=Math.ceil((g+y+t)/o)*o,j=Math.floor((b-t)/o)*o,T=Math.ceil((b+C+t)/o)*o,k=[w,j,T,!0],_=[S,j,T,!1];l(this,If).push(k,_),Ce.rectBoundingBox(w,j,S,T,r)}const c=r[2]-r[0]+2*s,d=r[3]-r[1]+2*s,h=r[0]-s,u=r[1]-s;let p=i?-1/0:1/0,f=1/0;const m=l(this,If).at(i?-1:-2),x=[m[0],m[2]];for(const g of l(this,If)){const[b,y,C,w]=g;!w&&i?y<f?(f=y,p=b):y===f&&(p=Math.max(p,b)):w&&!i&&(y<f?(f=y,p=b):y===f&&(p=Math.min(p,b))),g[0]=(b-h)/c,g[1]=(y-u)/d,g[2]=(C-u)/d}v(this,JA,new Float32Array([h,u,c,d])),v(this,ZA,[p,f]),v(this,eE,x)}getOutlines(){l(this,If).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of l(this,If))t[3]?(e.push(...E(this,Hr,GF).call(this,t)),E(this,Hr,uK).call(this,t)):(E(this,Hr,pK).call(this,t),e.push(...E(this,Hr,GF).call(this,t)));return E(this,Hr,hK).call(this,e)}}JA=new WeakMap,ZA=new WeakMap,eE=new WeakMap,If=new WeakMap,Kl=new WeakMap,Hr=new WeakSet,hK=function(e){const t=[],s=new Set;for(const o of e){const[c,d,h]=o;t.push([c,d,o],[c,h,o])}t.sort((o,c)=>o[1]-c[1]||o[0]-c[0]);for(let o=0,c=t.length;o<c;o+=2){const d=t[o][2],h=t[o+1][2];d.push(h),h.push(d),s.add(d),s.add(h)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[c,d,h,u,p]=o;s.delete(o);let f=c,m=d;for(r=[c,h],i.push(r);;){let x;if(s.has(u))x=u;else if(s.has(p))x=p;else break;s.delete(x),[c,d,h,u,p]=x,f!==c&&(r.push(f,m,c,m===d?d:h),f=c),m=m===d?h:d}r.push(f,m)}return new Ofe(i,l(this,JA),l(this,ZA),l(this,eE))},m_=function(e){const t=l(this,Kl);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,o=t[r][0];if(o===e)return r;o<e?s=r+1:i=r-1}return i+1},uK=function([,e,t]){const s=E(this,Hr,m_).call(this,e);l(this,Kl).splice(s,0,[e,t])},pK=function([,e,t]){const s=E(this,Hr,m_).call(this,e);for(let i=s;i<l(this,Kl).length;i++){const[r,o]=l(this,Kl)[i];if(r!==e)break;if(r===e&&o===t){l(this,Kl).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=l(this,Kl)[i];if(r!==e)break;if(r===e&&o===t){l(this,Kl).splice(i,1);return}}},GF=function(e){const[t,s,i]=e,r=[[t,s,i]],o=E(this,Hr,m_).call(this,i);for(let c=0;c<o;c++){const[d,h]=l(this,Kl)[c];for(let u=0,p=r.length;u<p;u++){const[,f,m]=r[u];if(!(h<=f||m<=d)){if(f>=d){if(m>h)r[u][1]=h;else{if(p===1)return[];r.splice(u,1),u--,p--}continue}r[u][2]=d,m>h&&r.push([t,h,m])}}}return r};var tE,i1;class Ofe extends Se{constructor(t,s,i,r){super();A(this,tE);A(this,i1);v(this,i1,t),v(this,tE,s),this.firstPoint=i,this.lastPoint=r}toSVGPath(){const t=[];for(const s of l(this,i1)){let[i,r]=s;t.push(`M${i} ${r}`);for(let o=2;o<s.length;o+=2){const c=s[o],d=s[o+1];c===i?(t.push(`V${d}`),r=d):d===r&&(t.push(`H${c}`),i=c)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],o){const c=[],d=i-t,h=r-s;for(const u of l(this,i1)){const p=new Array(u.length);for(let f=0;f<u.length;f+=2)p[f]=t+u[f]*d,p[f+1]=r-u[f+1]*h;c.push(p)}return c}get box(){return l(this,tE)}get classNamesForOutlining(){return["highlightOutline"]}}tE=new WeakMap,i1=new WeakMap;class WF extends AP{newFreeDrawOutline(e,t,s,i,r,o){return new Bfe(e,t,s,i,r,o)}}class Bfe extends cK{newOutliner(e,t,s,i,r,o=0){return new WF(e,t,s,i,r,o)}}var r1,sE,lu,x0,nE,ca,iE,rE,y0,eo,to,Mi,a1,o1,fr,l1,tl,aE,ht,qF,g_,fK,mK,gK,YF,Gm,dl,Iy,xK,x_,y_,yK,bK,vK,wK,SK;const Ot=class Ot extends _s{constructor(t){super({...t,name:"highlightEditor"});A(this,ht);A(this,r1,null);A(this,sE,0);A(this,lu);A(this,x0,null);A(this,nE,null);A(this,ca,null);A(this,iE,null);A(this,rE,0);A(this,y0,null);A(this,eo,null);A(this,to,null);A(this,Mi,!1);A(this,a1,null);A(this,o1,null);A(this,fr,null);A(this,l1,"");A(this,tl);A(this,aE,"");this.color=t.color||Ot._defaultColor,v(this,tl,t.thickness||Ot._defaultThickness),this.opacity=t.opacity||Ot._defaultOpacity,v(this,lu,t.boxes||null),v(this,aE,t.methodOfCreation||""),v(this,l1,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(v(this,Mi,!0),E(this,ht,g_).call(this,t),E(this,ht,Gm).call(this)):l(this,lu)&&(v(this,r1,t.anchorNode),v(this,sE,t.anchorOffset),v(this,iE,t.focusNode),v(this,rE,t.focusOffset),E(this,ht,qF).call(this),E(this,ht,Gm).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=Ot.prototype;return ct(this,"_keyboardManager",new RE([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,Mi)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:l(this,tl),methodOfCreation:l(this,aE)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;_s.initialize(t,s),Ot._defaultColor||(Ot._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case Nt.HIGHLIGHT_COLOR:Ot._defaultColor=s;break;case Nt.HIGHLIGHT_THICKNESS:Ot._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return l(this,o1)}get commentButtonPosition(){return l(this,a1)}updateParams(t,s){switch(t){case Nt.HIGHLIGHT_COLOR:E(this,ht,fK).call(this,s);break;case Nt.HIGHLIGHT_THICKNESS:E(this,ht,mK).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Nt.HIGHLIGHT_COLOR,Ot._defaultColor],[Nt.HIGHLIGHT_THICKNESS,Ot._defaultThickness]]}get propertiesToUpdate(){return[[Nt.HIGHLIGHT_COLOR,this.color||Ot._defaultColor],[Nt.HIGHLIGHT_THICKNESS,l(this,tl)||Ot._defaultThickness],[Nt.HIGHLIGHT_FREE,l(this,Mi)]]}onUpdatedColor(){var t,s;(t=this.parent)==null||t.drawLayer.updateProperties(l(this,to),{root:{fill:this.color,"fill-opacity":this.opacity}}),(s=l(this,nE))==null||s.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",v(this,nE,new BN({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(E(this,ht,y_).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,E(this,ht,y_).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){E(this,ht,YF).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,ht,Gm).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?E(this,ht,YF).call(this):t&&(E(this,ht,Gm).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,o,c;const{drawLayer:s}=this.parent;let i;l(this,Mi)?(t=(t-this.rotation+360)%360,i=E(r=Ot,dl,Iy).call(r,l(this,eo).box,t)):i=E(o=Ot,dl,Iy).call(o,[this.x,this.y,this.width,this.height],t),s.updateProperties(l(this,to),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(l(this,fr),{bbox:E(c=Ot,dl,Iy).call(c,l(this,ca).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();l(this,l1)&&(t.setAttribute("aria-label",l(this,l1)),t.setAttribute("role","mark")),l(this,Mi)?t.classList.add("free"):this.div.addEventListener("keydown",E(this,ht,xK).bind(this),{signal:this._uiManager._signal});const s=v(this,y0,document.createElement("div"));return t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=l(this,x0),this.setDims(this.width,this.height),HY(this,l(this,y0),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,fr),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,fr),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:E(this,ht,x_).call(this,!0);break;case 1:case 3:E(this,ht,x_).call(this,!1);break}}select(){var t;super.select(),l(this,fr)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,fr),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),l(this,fr)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,fr),{rootClass:{selected:!1}}),l(this,Mi)||E(this,ht,x_).call(this,!1))}get _mustFixPosition(){return!l(this,Mi)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(l(this,to),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(l(this,fr),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:o}){const{x:c,y:d,width:h,height:u}=i.getBoundingClientRect(),p=new AbortController,f=t.combinedSignal(p),m=x=>{p.abort(),E(this,dl,wK).call(this,t,x)};window.addEventListener("blur",m,{signal:f}),window.addEventListener("pointerup",m,{signal:f}),window.addEventListener("pointerdown",tn,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",jo,{signal:f}),i.addEventListener("pointermove",E(this,dl,vK).bind(this,t),{signal:f}),this._freeHighlight=new WF({x:r,y:o},[c,d,h,u],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var g,b,y,C;let r=null;if(t instanceof KX){const{data:{quadPoints:w,rect:S,rotation:j,id:T,color:k,opacity:_,popupRef:L,richText:D,contentsObj:P,creationDate:I,modificationDate:M},parent:{page:{pageNumber:O}}}=t;r=t={annotationType:et.HIGHLIGHT,color:Array.from(k),opacity:_,quadPoints:w,boxes:null,pageIndex:O-1,rect:S.slice(0),rotation:j,annotationElementId:T,id:T,deleted:!1,popupRef:L,richText:D,comment:(P==null?void 0:P.str)||null,creationDate:I,modificationDate:M}}else if(t instanceof I3){const{data:{inkLists:w,rect:S,rotation:j,id:T,color:k,borderStyle:{rawWidth:_},popupRef:L,richText:D,contentsObj:P,creationDate:I,modificationDate:M},parent:{page:{pageNumber:O}}}=t;r=t={annotationType:et.HIGHLIGHT,color:Array.from(k),thickness:_,inkLists:w,boxes:null,pageIndex:O-1,rect:S.slice(0),rotation:j,annotationElementId:T,id:T,deleted:!1,popupRef:L,richText:D,comment:(P==null?void 0:P.str)||null,creationDate:I,modificationDate:M}}const{color:o,quadPoints:c,inkLists:d,opacity:h}=t,u=await super.deserialize(t,s,i);u.color=Ce.makeHexColor(...o),u.opacity=h||1,d&&v(u,tl,t.thickness),u._initialData=r,t.comment&&u.setCommentData(t);const[p,f]=u.pageDimensions,[m,x]=u.pageTranslation;if(c){const w=v(u,lu,[]);for(let S=0;S<c.length;S+=8)w.push({x:(c[S]-m)/p,y:1-(c[S+1]-x)/f,width:(c[S+2]-c[S])/p,height:(c[S+1]-c[S+5])/f});E(g=u,ht,qF).call(g),E(b=u,ht,Gm).call(b),u.rotate(u.rotation)}else if(d){v(u,Mi,!0);const w=d[0],S={x:w[0]-m,y:f-(w[1]-x)},j=new WF(S,[0,0,p,f],1,l(u,tl)/2,!0,.001);for(let _=0,L=w.length;_<L;_+=2)S.x=w[_]-m,S.y=f-(w[_+1]-x),j.add(S);const{id:T,clipPathId:k}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:j.toSVGPath()}},!0,!0);E(y=u,ht,g_).call(y,{highlightOutlines:j.getOutlines(),highlightId:T,clipPathId:k}),E(C=u,ht,Gm).call(C),u.rotate(u.parentRotation)}return u}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=_s._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:s,opacity:this.opacity,thickness:l(this,tl),quadPoints:E(this,ht,yK).call(this),outlines:E(this,ht,bK).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!E(this,ht,SK).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};r1=new WeakMap,sE=new WeakMap,lu=new WeakMap,x0=new WeakMap,nE=new WeakMap,ca=new WeakMap,iE=new WeakMap,rE=new WeakMap,y0=new WeakMap,eo=new WeakMap,to=new WeakMap,Mi=new WeakMap,a1=new WeakMap,o1=new WeakMap,fr=new WeakMap,l1=new WeakMap,tl=new WeakMap,aE=new WeakMap,ht=new WeakSet,qF=function(){const t=new VF(l(this,lu),.001);v(this,eo,t.getOutlines()),[this.x,this.y,this.width,this.height]=l(this,eo).box;const s=new VF(l(this,lu),.0025,.001,this._uiManager.direction==="ltr");v(this,ca,s.getOutlines());const{firstPoint:i}=l(this,eo);v(this,a1,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:r}=l(this,ca);v(this,o1,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},g_=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var f,m;if(v(this,eo,t),v(this,ca,t.getNewOutline(l(this,tl)/2+1.5,.0025)),s>=0)v(this,to,s),v(this,x0,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),v(this,fr,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:l(this,ca).box,path:{d:l(this,ca).toSVGPath()}},!0));else if(this.parent){const x=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(l(this,to),{bbox:E(f=Ot,dl,Iy).call(f,l(this,eo).box,(x-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(l(this,fr),{bbox:E(m=Ot,dl,Iy).call(m,l(this,ca).box,x),path:{d:l(this,ca).toSVGPath()}})}const[o,c,d,h]=t.box;switch(this.rotation){case 0:this.x=o,this.y=c,this.width=d,this.height=h;break;case 90:{const[x,g]=this.parentDimensions;this.x=c,this.y=1-o,this.width=d*g/x,this.height=h*x/g;break}case 180:this.x=1-o,this.y=1-c,this.width=d,this.height=h;break;case 270:{const[x,g]=this.parentDimensions;this.x=1-c,this.y=o,this.width=d*g/x,this.height=h*x/g;break}}const{firstPoint:u}=t;v(this,a1,[(u[0]-o)/d,(u[1]-c)/h]);const{lastPoint:p}=l(this,ca);v(this,o1,[(p[0]-o)/d,(p[1]-c)/h])},fK=function(t){const s=(o,c)=>{this.color=o,this.opacity=c,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:s.bind(this,t,Ot._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},mK=function(t){const s=l(this,tl),i=r=>{v(this,tl,r),E(this,ht,gK).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Nt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},gK=function(t){l(this,Mi)&&(E(this,ht,g_).call(this,{highlightOutlines:l(this,eo).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))},YF=function(){l(this,to)===null||!this.parent||(this.parent.drawLayer.remove(l(this,to)),v(this,to,null),this.parent.drawLayer.remove(l(this,fr)),v(this,fr,null))},Gm=function(t=this.parent){l(this,to)===null&&({id:vt(this,to)._,clipPathId:vt(this,x0)._}=t.drawLayer.draw({bbox:l(this,eo).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:l(this,Mi)},path:{d:l(this,eo).toSVGPath()}},!1,!0),v(this,fr,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:l(this,Mi)},bbox:l(this,ca).box,path:{d:l(this,ca).toSVGPath()}},l(this,Mi))),l(this,y0)&&(l(this,y0).style.clipPath=l(this,x0)))},dl=new WeakSet,Iy=function([t,s,i,r],o){switch(o){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},xK=function(t){Ot._keyboardManager.exec(this,t)},x_=function(t){if(!l(this,r1))return;const s=window.getSelection();t?s.setPosition(l(this,r1),l(this,sE)):s.setPosition(l(this,iE),l(this,rE))},y_=function(){return l(this,Mi)?this.rotation:0},yK=function(){if(l(this,Mi))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,o=l(this,lu),c=new Float32Array(o.length*8);let d=0;for(const{x:h,y:u,width:p,height:f}of o){const m=h*t+i,x=(1-u)*s+r;c[d]=c[d+4]=m,c[d+1]=c[d+3]=x,c[d+2]=c[d+6]=m+p*t,c[d+5]=c[d+7]=x-f*s,d+=8}return c},bK=function(t){return l(this,eo).serialize(t,E(this,ht,y_).call(this))},vK=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},wK=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},SK=function(t){const{color:s}=this._initialData;return this.hasEditedComment||t.color.some((i,r)=>i!==s[r])},A(Ot,dl),W(Ot,"_defaultColor",null),W(Ot,"_defaultOpacity",1),W(Ot,"_defaultThickness",12),W(Ot,"_type","highlight"),W(Ot,"_editorType",et.HIGHLIGHT),W(Ot,"_freeHighlightId",-1),W(Ot,"_freeHighlight",null),W(Ot,"_freeHighlightClipId","");let EP=Ot;var b0;class CK{constructor(){A(this,b0,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){l(this,b0)[e]=t}toSVGProperties(){const e=l(this,b0);return v(this,b0,Object.create(null)),{root:e}}reset(){v(this,b0,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Ns("Not implemented")}}b0=new WeakMap;var so,c1,pi,v0,w0,Mf,Ff,Of,S0,Dt,XF,KF,QF,_C,NK,b_,PC,My;const Te=class Te extends _s{constructor(t){super(t);A(this,Dt);A(this,so,null);A(this,c1);W(this,"_colorPicker",null);W(this,"_drawId",null);v(this,c1,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(E(this,Dt,XF).call(this,t),E(this,Dt,_C).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,o]of Object.entries(s))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){Ns("Not implemented")}static get typesMap(){Ns("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(l(Te,pi).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,o=r[s],c=d=>{var u;r.updateProperty(s,d);const h=l(this,so).updateProperty(s,d);h&&E(this,Dt,PC).call(this,h),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:c.bind(this,i),undo:c.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Te._mergeSVGProperties(l(this,so).getPathResizingSVGProperties(E(this,Dt,b_).call(this)),{bbox:E(this,Dt,My).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Te._mergeSVGProperties(l(this,so).getPathResizedSVGProperties(E(this,Dt,b_).call(this)),{bbox:E(this,Dt,My).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:E(this,Dt,My).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Te._mergeSVGProperties(l(this,so).getPathTranslatedSVGProperties(E(this,Dt,b_).call(this),this.parentDimensions),{bbox:E(this,Dt,My).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,l(this,c1)&&(v(this,c1,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){E(this,Dt,QF).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,Dt,_C).call(this),E(this,Dt,PC).call(this,l(this,so).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),E(this,Dt,QF).call(this)):t&&(this._uiManager.addShouldRescale(this),E(this,Dt,_C).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Te._mergeSVGProperties({bbox:E(this,Dt,My).call(this)},l(this,so).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&E(this,Dt,PC).call(this,l(this,so).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,r,o){Ns("Not implemented")}static startDrawing(t,s,i,r){var b;const{target:o,offsetX:c,offsetY:d,pointerId:h,pointerType:u}=r;if(l(Te,Ff)&&l(Te,Ff)!==u)return;const{viewport:{rotation:p}}=t,{width:f,height:m}=o.getBoundingClientRect(),x=v(Te,v0,new AbortController),g=t.combinedSignal(x);if(l(Te,Mf)||v(Te,Mf,h),l(Te,Ff)??v(Te,Ff,u),window.addEventListener("pointerup",y=>{var C;l(Te,Mf)===y.pointerId?this._endDraw(y):(C=l(Te,Of))==null||C.delete(y.pointerId)},{signal:g}),window.addEventListener("pointercancel",y=>{var C;l(Te,Mf)===y.pointerId?this._currentParent.endDrawingSession():(C=l(Te,Of))==null||C.delete(y.pointerId)},{signal:g}),window.addEventListener("pointerdown",y=>{l(Te,Ff)===y.pointerType&&((l(Te,Of)||v(Te,Of,new Set)).add(y.pointerId),l(Te,pi).isCancellable()&&(l(Te,pi).removeLastElement(),l(Te,pi).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",jo,{signal:g}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),o.addEventListener("touchmove",y=>{y.timeStamp===l(Te,S0)&&tn(y)},{signal:g}),t.toggleDrawing(),(b=s._editorUndoBar)==null||b.hide(),l(Te,pi)){t.drawLayer.updateProperties(this._currentDrawId,l(Te,pi).startNew(c,d,f,m,p));return}s.updateUIForDefaultProperties(this),v(Te,pi,this.createDrawerInstance(c,d,f,m,p)),v(Te,w0,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(l(Te,w0).toSVGProperties(),l(Te,pi).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(v(Te,S0,-1),!l(Te,pi))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if(l(Te,Mf)===r){if(((o=l(Te,Of))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,l(Te,pi).add(s,i)),v(Te,S0,t.timeStamp),tn(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,v(Te,pi,null),v(Te,w0,null),v(Te,Ff,null),v(Te,S0,NaN)),l(Te,v0)&&(l(Te,v0).abort(),v(Te,v0,null),v(Te,Mf,NaN),v(Te,Of,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,l(Te,pi).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=l(Te,pi),r=this._currentDrawId,o=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:Nt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Nt.DRAW_STEP),!l(Te,pi).isEmpty()){const{pageDimensions:[i,r],scale:o}=s,c=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:l(Te,pi).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:l(Te,w0),mustBeCommitted:!t});return this._cleanup(!0),c}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,o,c){Ns("Not implemented")}static async deserialize(t,s,i){var p,f;const{rawDims:{pageWidth:r,pageHeight:o,pageX:c,pageY:d}}=s.viewport,h=this.deserializeDraw(c,d,r,o,this._INNER_MARGIN,t),u=await super.deserialize(t,s,i);return u.createDrawingOptions(t),E(p=u,Dt,XF).call(p,{drawOutlines:h}),E(f=u,Dt,_C).call(f),u.onScaleChanging(),u.rotate(),u}serializeDraw(t){const[s,i]=this.pageTranslation,[r,o]=this.pageDimensions;return l(this,so).serialize([s,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};so=new WeakMap,c1=new WeakMap,pi=new WeakMap,v0=new WeakMap,w0=new WeakMap,Mf=new WeakMap,Ff=new WeakMap,Of=new WeakMap,S0=new WeakMap,Dt=new WeakSet,XF=function({drawOutlines:t,drawId:s,drawingOptions:i}){v(this,so,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=E(this,Dt,KF).call(this,t,this.parent),E(this,Dt,PC).call(this,t.box)},KF=function(t,s){const{id:i}=s.drawLayer.draw(Te._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},QF=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},_C=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=E(this,Dt,KF).call(this,l(this,so),t)}},NK=function([t,s,i,r]){const{parentDimensions:[o,c],rotation:d}=this;switch(d){case 90:return[s,1-t,i*(c/o),r*(o/c)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(c/o),r*(o/c)];default:return[t,s,i,r]}},b_=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[o,c],rotation:d}=this;switch(d){case 90:return[1-s,t,i*(o/c),r*(c/o)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(o/c),r*(c/o)];default:return[t,s,i,r]}},PC=function(t){[this.x,this.y,this.width,this.height]=E(this,Dt,NK).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},My=function(){const{x:t,y:s,width:i,height:r,rotation:o,parentRotation:c,parentDimensions:[d,h]}=this;switch((o*4+c)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(d/h),r*(h/d),i*(d/h)];case 5:return[1-s,t,i*(d/h),r*(h/d)];case 6:return[1-t-r*(h/d),1-s,r*(h/d),i*(d/h)];case 7:return[s-i*(d/h),1-t-r*(h/d),i*(d/h),r*(h/d)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(h/d),s,r*(h/d),i*(d/h)];case 13:return[1-s-i*(d/h),t-r*(h/d),i*(d/h),r*(h/d)];case 14:return[1-t,1-s-i*(d/h),r*(h/d),i*(d/h)];case 15:return[s,1-t,i*(d/h),r*(h/d)];default:return[t,s,i,r]}},W(Te,"_currentDrawId",-1),W(Te,"_currentParent",null),A(Te,pi,null),A(Te,v0,null),A(Te,w0,null),A(Te,Mf,NaN),A(Te,Ff,null),A(Te,Of,null),A(Te,S0,NaN),W(Te,"_INNER_MARGIN",3);let kP=Te;var hd,fi,mi,C0,d1,Pr,Fi,sl,N0,j0,A0,h1,v_;class $fe{constructor(e,t,s,i,r,o){A(this,h1);A(this,hd,new Float64Array(6));A(this,fi);A(this,mi);A(this,C0);A(this,d1);A(this,Pr);A(this,Fi,"");A(this,sl,0);A(this,N0,new ME);A(this,j0);A(this,A0);v(this,j0,s),v(this,A0,i),v(this,C0,r),v(this,d1,o),[e,t]=E(this,h1,v_).call(this,e,t);const c=v(this,fi,[NaN,NaN,NaN,NaN,e,t]);v(this,Pr,[e,t]),v(this,mi,[{line:c,points:l(this,Pr)}]),l(this,hd).set(c,0)}updateProperty(e,t){e==="stroke-width"&&v(this,d1,t)}isEmpty(){return!l(this,mi)||l(this,mi).length===0}isCancellable(){return l(this,Pr).length<=10}add(e,t){[e,t]=E(this,h1,v_).call(this,e,t);const[s,i,r,o]=l(this,hd).subarray(2,6),c=e-r,d=t-o;return Math.hypot(l(this,j0)*c,l(this,A0)*d)<=2?null:(l(this,Pr).push(e,t),isNaN(s)?(l(this,hd).set([r,o,e,t],2),l(this,fi).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(l(this,hd)[0])&&l(this,fi).splice(6,6),l(this,hd).set([s,i,r,o,e,t],0),l(this,fi).push(...Se.createBezierPoints(s,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(l(this,Pr).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){v(this,j0,s),v(this,A0,i),v(this,C0,r),[e,t]=E(this,h1,v_).call(this,e,t);const o=v(this,fi,[NaN,NaN,NaN,NaN,e,t]);v(this,Pr,[e,t]);const c=l(this,mi).at(-1);return c&&(c.line=new Float32Array(c.line),c.points=new Float32Array(c.points)),l(this,mi).push({line:o,points:l(this,Pr)}),l(this,hd).set(o,0),v(this,sl,0),this.toSVGPath(),null}getLastElement(){return l(this,mi).at(-1)}setLastElement(e){return l(this,mi)?(l(this,mi).push(e),v(this,fi,e.line),v(this,Pr,e.points),v(this,sl,0),{path:{d:this.toSVGPath()}}):l(this,N0).setLastElement(e)}removeLastElement(){if(!l(this,mi))return l(this,N0).removeLastElement();l(this,mi).pop(),v(this,Fi,"");for(let e=0,t=l(this,mi).length;e<t;e++){const{line:s,points:i}=l(this,mi)[e];v(this,fi,s),v(this,Pr,i),v(this,sl,0),this.toSVGPath()}return{path:{d:l(this,Fi)}}}toSVGPath(){const e=Se.svgRound(l(this,fi)[4]),t=Se.svgRound(l(this,fi)[5]);if(l(this,Pr).length===2)return v(this,Fi,`${l(this,Fi)} M ${e} ${t} Z`),l(this,Fi);if(l(this,Pr).length<=6){const i=l(this,Fi).lastIndexOf("M");v(this,Fi,`${l(this,Fi).slice(0,i)} M ${e} ${t}`),v(this,sl,6)}if(l(this,Pr).length===4){const i=Se.svgRound(l(this,fi)[10]),r=Se.svgRound(l(this,fi)[11]);return v(this,Fi,`${l(this,Fi)} L ${i} ${r}`),v(this,sl,12),l(this,Fi)}const s=[];l(this,sl)===0&&(s.push(`M ${e} ${t}`),v(this,sl,6));for(let i=l(this,sl),r=l(this,fi).length;i<r;i+=6){const[o,c,d,h,u,p]=l(this,fi).slice(i,i+6).map(Se.svgRound);s.push(`C${o} ${c} ${d} ${h} ${u} ${p}`)}return v(this,Fi,l(this,Fi)+s.join(" ")),v(this,sl,l(this,fi).length),l(this,Fi)}getOutlines(e,t,s,i){const r=l(this,mi).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),l(this,N0).build(l(this,mi),e,t,s,l(this,C0),l(this,d1),i),v(this,hd,null),v(this,fi,null),v(this,mi,null),v(this,Fi,null),l(this,N0)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}hd=new WeakMap,fi=new WeakMap,mi=new WeakMap,C0=new WeakMap,d1=new WeakMap,Pr=new WeakMap,Fi=new WeakMap,sl=new WeakMap,N0=new WeakMap,j0=new WeakMap,A0=new WeakMap,h1=new WeakSet,v_=function(e,t){return Se._normalizePoint(e,t,l(this,j0),l(this,A0),l(this,C0))};var Lr,oE,lE,no,ud,pd,u1,p1,E0,Vi,Yd,jK,AK,EK;class ME extends Se{constructor(){super(...arguments);A(this,Vi);A(this,Lr);A(this,oE,0);A(this,lE);A(this,no);A(this,ud);A(this,pd);A(this,u1);A(this,p1);A(this,E0)}build(t,s,i,r,o,c,d){v(this,ud,s),v(this,pd,i),v(this,u1,r),v(this,p1,o),v(this,E0,c),v(this,lE,d??0),v(this,no,t),E(this,Vi,AK).call(this)}get thickness(){return l(this,E0)}setLastElement(t){return l(this,no).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return l(this,no).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of l(this,no)){if(t.push(`M${Se.svgRound(s[4])} ${Se.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${Se.svgRound(s[10])} ${Se.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[o,c,d,h,u,p]=s.subarray(i,i+6).map(Se.svgRound);t.push(`C${o} ${c} ${d} ${h} ${u} ${p}`)}}return t.join("")}serialize([t,s,i,r],o){const c=[],d=[],[h,u,p,f]=E(this,Vi,jK).call(this);let m,x,g,b,y,C,w,S,j;switch(l(this,p1)){case 0:j=Se._rescale,m=t,x=s+r,g=i,b=-r,y=t+h*i,C=s+(1-u-f)*r,w=t+(h+p)*i,S=s+(1-u)*r;break;case 90:j=Se._rescaleAndSwap,m=t,x=s,g=i,b=r,y=t+u*i,C=s+h*r,w=t+(u+f)*i,S=s+(h+p)*r;break;case 180:j=Se._rescale,m=t+i,x=s,g=-i,b=r,y=t+(1-h-p)*i,C=s+u*r,w=t+(1-h)*i,S=s+(u+f)*r;break;case 270:j=Se._rescaleAndSwap,m=t+i,x=s+r,g=-i,b=-r,y=t+(1-u-f)*i,C=s+(1-h-p)*r,w=t+(1-u)*i,S=s+(1-h)*r;break}for(const{line:T,points:k}of l(this,no))c.push(j(T,m,x,g,b,o?new Array(T.length):null)),d.push(j(k,m,x,g,b,o?new Array(k.length):null));return{lines:c,points:d,rect:[y,C,w,S]}}static deserialize(t,s,i,r,o,{paths:{lines:c,points:d},rotation:h,thickness:u}){const p=[];let f,m,x,g,b;switch(h){case 0:b=Se._rescale,f=-t/i,m=s/r+1,x=1/i,g=-1/r;break;case 90:b=Se._rescaleAndSwap,f=-s/r,m=-t/i,x=1/r,g=1/i;break;case 180:b=Se._rescale,f=t/i+1,m=-s/r,x=-1/i,g=1/r;break;case 270:b=Se._rescaleAndSwap,f=s/r+1,m=t/i+1,x=-1/r,g=-1/i;break}if(!c){c=[];for(const C of d){const w=C.length;if(w===2){c.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(w===4){c.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}const S=new Float32Array(3*(w-2));c.push(S);let[j,T,k,_]=C.subarray(0,4);S.set([NaN,NaN,NaN,NaN,j,T],0);for(let L=4;L<w;L+=2){const D=C[L],P=C[L+1];S.set(Se.createBezierPoints(j,T,k,_,D,P),(L-2)*3),[j,T,k,_]=[k,_,D,P]}}}for(let C=0,w=c.length;C<w;C++)p.push({line:b(c[C].map(S=>S??NaN),f,m,x,g),points:b(d[C].map(S=>S??NaN),f,m,x,g)});const y=new this.prototype.constructor;return y.build(p,i,r,1,h,u,o),y}get box(){return l(this,Lr)}updateProperty(t,s){return t==="stroke-width"?E(this,Vi,EK).call(this,s):null}updateParentDimensions([t,s],i){const[r,o]=E(this,Vi,Yd).call(this);v(this,ud,t),v(this,pd,s),v(this,u1,i);const[c,d]=E(this,Vi,Yd).call(this),h=c-r,u=d-o,p=l(this,Lr);return p[0]-=h,p[1]-=u,p[2]+=2*h,p[3]+=2*u,p}updateRotation(t){return v(this,oE,t),{path:{transform:this.rotationTransform}}}get viewBox(){return l(this,Lr).map(Se.svgRound).join(" ")}get defaultProperties(){const[t,s]=l(this,Lr);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=l(this,Lr);let i=0,r=0,o=0,c=0,d=0,h=0;switch(l(this,oE)){case 90:r=s/t,o=-t/s,d=t;break;case 180:i=-1,c=-1,d=t,h=s;break;case 270:r=-s/t,o=t/s,h=s;break;default:return""}return`matrix(${i} ${r} ${o} ${c} ${Se.svgRound(d)} ${Se.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,r]){const[o,c]=E(this,Vi,Yd).call(this),[d,h,u,p]=l(this,Lr);if(Math.abs(u-o)<=Se.PRECISION||Math.abs(p-c)<=Se.PRECISION){const b=t+i/2-(d+u/2),y=s+r/2-(h+p/2);return{path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(s)}`,transform:`${this.rotationTransform} translate(${b} ${y})`}}}const f=(i-2*o)/(u-2*o),m=(r-2*c)/(p-2*c),x=u/i,g=p/r;return{path:{"transform-origin":`${Se.svgRound(d)} ${Se.svgRound(h)}`,transform:`${this.rotationTransform} scale(${x} ${g}) translate(${Se.svgRound(o)} ${Se.svgRound(c)}) scale(${f} ${m}) translate(${Se.svgRound(-o)} ${Se.svgRound(-c)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[o,c]=E(this,Vi,Yd).call(this),d=l(this,Lr),[h,u,p,f]=d;if(d[0]=t,d[1]=s,d[2]=i,d[3]=r,Math.abs(p-o)<=Se.PRECISION||Math.abs(f-c)<=Se.PRECISION){const y=t+i/2-(h+p/2),C=s+r/2-(u+f/2);for(const{line:w,points:S}of l(this,no))Se._translate(w,y,C,w),Se._translate(S,y,C,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(i-2*o)/(p-2*o),x=(r-2*c)/(f-2*c),g=-m*(h+o)+t+o,b=-x*(u+c)+s+c;if(m!==1||x!==1||g!==0||b!==0)for(const{line:y,points:C}of l(this,no))Se._rescale(y,g,b,m,x,y),Se._rescale(C,g,b,m,x,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,o]=i,c=l(this,Lr),d=t-c[0],h=s-c[1];if(l(this,ud)===r&&l(this,pd)===o)for(const{line:u,points:p}of l(this,no))Se._translate(u,d,h,u),Se._translate(p,d,h,p);else{const u=l(this,ud)/r,p=l(this,pd)/o;v(this,ud,r),v(this,pd,o);for(const{line:f,points:m}of l(this,no))Se._rescale(f,d,h,u,p,f),Se._rescale(m,d,h,u,p,m);c[2]*=u,c[3]*=p}return c[0]=t,c[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(s)}`}}}get defaultSVGProperties(){const t=l(this,Lr);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(t[0])} ${Se.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}Lr=new WeakMap,oE=new WeakMap,lE=new WeakMap,no=new WeakMap,ud=new WeakMap,pd=new WeakMap,u1=new WeakMap,p1=new WeakMap,E0=new WeakMap,Vi=new WeakSet,Yd=function(t=l(this,E0)){const s=l(this,lE)+t/2*l(this,u1);return l(this,p1)%180===0?[s/l(this,ud),s/l(this,pd)]:[s/l(this,pd),s/l(this,ud)]},jK=function(){const[t,s,i,r]=l(this,Lr),[o,c]=E(this,Vi,Yd).call(this,0);return[t+o,s+c,i-2*o,r-2*c]},AK=function(){const t=v(this,Lr,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of l(this,no)){if(r.length<=12){for(let d=4,h=r.length;d<h;d+=6)Ce.pointBoundingBox(r[d],r[d+1],t);continue}let o=r[4],c=r[5];for(let d=6,h=r.length;d<h;d+=6){const[u,p,f,m,x,g]=r.subarray(d,d+6);Ce.bezierBoundingBox(o,c,u,p,f,m,x,g,t),o=x,c=g}}const[s,i]=E(this,Vi,Yd).call(this);t[0]=gr(t[0]-s,0,1),t[1]=gr(t[1]-i,0,1),t[2]=gr(t[2]+s,0,1),t[3]=gr(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},EK=function(t){const[s,i]=E(this,Vi,Yd).call(this);v(this,E0,t);const[r,o]=E(this,Vi,Yd).call(this),[c,d]=[r-s,o-i],h=l(this,Lr);return h[0]-=c,h[1]-=d,h[2]+=2*c,h[3]+=2*d,h};class aD extends CK{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:_s._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new aD(this._viewParameters);return e.updateAll(this),e}}var dL,kK;const ab=class ab extends kP{constructor(t){super({...t,name:"inkEditor"});A(this,dL);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){_s.initialize(t,s),this._defaultDrawingOptions=new aD(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return ct(this,"typesMap",new Map([[Nt.INK_THICKNESS,"stroke-width"],[Nt.INK_COLOR,"stroke"],[Nt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,o){return new $fe(t,s,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,o,c){return ME.deserialize(t,s,i,r,o,c)}static async deserialize(t,s,i){let r=null;if(t instanceof I3){const{data:{inkLists:c,rect:d,rotation:h,id:u,color:p,opacity:f,borderStyle:{rawWidth:m},popupRef:x,richText:g,contentsObj:b,creationDate:y,modificationDate:C},parent:{page:{pageNumber:w}}}=t;r=t={annotationType:et.INK,color:Array.from(p),thickness:m,opacity:f,paths:{points:c},boxes:null,pageIndex:w-1,rect:d.slice(0),rotation:h,annotationElementId:u,id:u,deleted:!1,popupRef:x,richText:g,comment:(b==null?void 0:b.str)||null,creationDate:y,modificationDate:C}}const o=await super.deserialize(t,s,i);return o._initialData=r,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new jP(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Nt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=ab.getDefaultDrawingOptions({stroke:Ce.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":c}}=this,d=Object.assign(super.serialize(t),{color:_s._colorManager.convert(r),opacity:o,thickness:c,paths:{lines:s,points:i}});return this.addComment(d),t?(d.isCopy=!0,d):this.annotationElementId&&!E(this,dL,kK).call(this,d)?null:(d.id=this.annotationElementId,d)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s,popup:this.comment}),null}};dL=new WeakSet,kK=function(t){const{color:s,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((c,d)=>c!==s[d])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},W(ab,"_type","ink"),W(ab,"_editorType",et.INK),W(ab,"_defaultDrawingOptions",null);let JF=ab;class ZF extends ME{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Uk=8,DS=3;var k0,Ht,eO,Ql,TK,_K,tO,w_,PK,LK,DK,sO,nO,RK;class vd{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},r,o,c,d){let h=new OffscreenCanvas(1,1),u=h.getContext("2d",{alpha:!1});const p=200,f=u.font=`${s} ${i} ${p}px ${t}`,{actualBoundingBoxLeft:m,actualBoundingBoxRight:x,actualBoundingBoxAscent:g,actualBoundingBoxDescent:b,fontBoundingBoxAscent:y,fontBoundingBoxDescent:C,width:w}=u.measureText(e),S=1.5,j=Math.ceil(Math.max(Math.abs(m)+Math.abs(x)||0,w)*S),T=Math.ceil(Math.max(Math.abs(g)+Math.abs(b)||p,Math.abs(y)+Math.abs(C)||p)*S);h=new OffscreenCanvas(j,T),u=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),u.font=f,u.filter="grayscale(1)",u.fillStyle="white",u.fillRect(0,0,j,T),u.fillStyle="black",u.fillText(e,j*(S-1)/2,T*(3-S)/2);const k=E(this,Ht,sO).call(this,u.getImageData(0,0,j,T).data),_=E(this,Ht,DK).call(this,k),L=E(this,Ht,nO).call(this,_),D=E(this,Ht,tO).call(this,k,j,T,L);return this.processDrawnLines({lines:{curves:D,width:j,height:T},pageWidth:r,pageHeight:o,rotation:c,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,r){const[o,c,d]=E(this,Ht,RK).call(this,e),[h,u]=E(this,Ht,LK).call(this,o,c,d,Math.hypot(c,d)*l(this,k0).sigmaSFactor,l(this,k0).sigmaR,l(this,k0).kernelSize),p=E(this,Ht,nO).call(this,u),f=E(this,Ht,tO).call(this,h,c,d,p);return this.processDrawnLines({lines:{curves:f,width:c,height:d},pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:o,areContours:c}){i%180!==0&&([t,s]=[s,t]);const{curves:d,width:h,height:u}=e,p=e.thickness??0,f=[],m=Math.min(t/h,s/u),x=m/t,g=m/s,b=[];for(const{points:C}of d){const w=o?E(this,Ht,PK).call(this,C):C;if(!w)continue;b.push(w);const S=w.length,j=new Float32Array(S),T=new Float32Array(3*(S===2?2:S-2));if(f.push({line:T,points:j}),S===2){j[0]=w[0]*x,j[1]=w[1]*g,T.set([NaN,NaN,NaN,NaN,j[0],j[1]],0);continue}let[k,_,L,D]=w;k*=x,_*=g,L*=x,D*=g,j.set([k,_,L,D],0),T.set([NaN,NaN,NaN,NaN,k,_],0);for(let P=4;P<S;P+=2){const I=j[P]=w[P]*x,M=j[P+1]=w[P+1]*g;T.set(Se.createBezierPoints(k,_,L,D,I,M),(P-2)*3),[k,_,L,D]=[L,D,I,M]}}if(f.length===0)return null;const y=c?new ZF:new ME;return y.build(f,t,s,1,i,c?0:p,r),{outline:y,newCurves:b,areContours:c,thickness:p,width:h,height:u}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:r}){let o=1/0,c=-1/0,d=0;for(const w of e){d+=w.length;for(let S=2,j=w.length;S<j;S++){const T=w[S]-w[S-2];o=Math.min(o,T),c=Math.max(c,T)}}let h;o>=-128&&c<=127?h=Int8Array:o>=-32768&&c<=32767?h=Int16Array:h=Int32Array;const u=e.length,p=Uk+DS*u,f=new Uint32Array(p);let m=0;f[m++]=p*Uint32Array.BYTES_PER_ELEMENT+(d-2*u)*h.BYTES_PER_ELEMENT,f[m++]=0,f[m++]=i,f[m++]=r,f[m++]=t?0:1,f[m++]=Math.max(0,Math.floor(s??0)),f[m++]=u,f[m++]=h.BYTES_PER_ELEMENT;for(const w of e)f[m++]=w.length-2,f[m++]=w[0],f[m++]=w[1];const x=new CompressionStream("deflate-raw"),g=x.writable.getWriter();await g.ready,g.write(f);const b=h.prototype.constructor;for(const w of e){const S=new b(w.length-2);for(let j=2,T=w.length;j<T;j++)S[j-2]=w[j]-w[j-2];g.write(S)}g.close();const y=await new Response(x.readable).arrayBuffer(),C=new Uint8Array(y);return PY(C)}static async decompressSignature(e){try{const t=hpe(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,c=0;for await(const w of s)o||(o=new Uint8Array(new Uint32Array(w.buffer,0,4)[0])),o.set(w,c),c+=w.length;const d=new Uint32Array(o.buffer,0,o.length>>2),h=d[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const u=d[2],p=d[3],f=d[4]===0,m=d[5],x=d[6],g=d[7],b=[],y=(Uk+DS*x)*Uint32Array.BYTES_PER_ELEMENT;let C;switch(g){case Int8Array.BYTES_PER_ELEMENT:C=new Int8Array(o.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:C=new Int16Array(o.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:C=new Int32Array(o.buffer,y);break}c=0;for(let w=0;w<x;w++){const S=d[DS*w+Uk],j=new Float32Array(S+2);b.push(j);for(let T=0;T<DS-1;T++)j[T]=d[DS*w+Uk+T+1];for(let T=0;T<S;T++)j[T+2]=j[T]+C[c++]}return{areContours:f,thickness:m,outlines:b,width:u,height:p}}catch(t){return st(`decompressSignature: ${t}`),null}}}k0=new WeakMap,Ht=new WeakSet,eO=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},Ql=new WeakMap,TK=function(e,t,s,i,r,o,c){const d=E(this,Ht,eO).call(this,s,i,r,o);for(let h=0;h<8;h++){const u=(-h+d-c+16)%8,p=l(this,Ql)[2*u],f=l(this,Ql)[2*u+1];if(e[(s+p)*t+(i+f)]!==0)return u}return-1},_K=function(e,t,s,i,r,o,c){const d=E(this,Ht,eO).call(this,s,i,r,o);for(let h=0;h<8;h++){const u=(h+d+c+16)%8,p=l(this,Ql)[2*u],f=l(this,Ql)[2*u+1];if(e[(s+p)*t+(i+f)]!==0)return u}return-1},tO=function(e,t,s,i){const r=e.length,o=new Int32Array(r);for(let u=0;u<r;u++)o[u]=e[u]<=i?1:0;for(let u=1;u<s-1;u++)o[u*t]=o[u*t+t-1]=0;for(let u=0;u<t;u++)o[u]=o[t*s-1-u]=0;let c=1,d;const h=[];for(let u=1;u<s-1;u++){d=1;for(let p=1;p<t-1;p++){const f=u*t+p,m=o[f];if(m===0)continue;let x=u,g=p;if(m===1&&o[f-1]===0)c+=1,g-=1;else if(m>=1&&o[f+1]===0)c+=1,g+=1,m>1&&(d=m);else{m!==1&&(d=Math.abs(m));continue}const b=[p,u],y=g===p+1,C={isHole:y,points:b,id:c,parent:0};h.push(C);let w;for(const P of h)if(P.id===d){w=P;break}w?w.isHole?C.parent=y?w.parent:d:C.parent=y?d:w.parent:C.parent=y?d:0;const S=E(this,Ht,TK).call(this,o,t,u,p,x,g,0);if(S===-1){o[f]=-c,o[f]!==1&&(d=Math.abs(o[f]));continue}let j=l(this,Ql)[2*S],T=l(this,Ql)[2*S+1];const k=u+j,_=p+T;x=k,g=_;let L=u,D=p;for(;;){const P=E(this,Ht,_K).call(this,o,t,L,D,x,g,1);j=l(this,Ql)[2*P],T=l(this,Ql)[2*P+1];const I=L+j,M=D+T;b.push(M,I);const O=L*t+D;if(o[O+1]===0?o[O]=-c:o[O]===1&&(o[O]=c),I===u&&M===p&&L===k&&D===_){o[f]!==1&&(d=Math.abs(o[f]));break}else x=L,g=D,L=I,D=M}}}return h},w_=function(e,t,s,i){if(s-t<=4){for(let k=t;k<s-2;k+=2)i.push(e[k],e[k+1]);return}const r=e[t],o=e[t+1],c=e[s-4]-r,d=e[s-3]-o,h=Math.hypot(c,d),u=c/h,p=d/h,f=u*o-p*r,m=d/c,x=1/h,g=Math.atan(m),b=Math.cos(g),y=Math.sin(g),C=x*(Math.abs(b)+Math.abs(y)),w=x*(1-C+C**2),S=Math.max(Math.atan(Math.abs(y+b)*w),Math.atan(Math.abs(y-b)*w));let j=0,T=t;for(let k=t+2;k<s-2;k+=2){const _=Math.abs(f-u*e[k+1]+p*e[k]);_>j&&(T=k,j=_)}j>(h*S)**2?(E(this,Ht,w_).call(this,e,t,T+2,i),E(this,Ht,w_).call(this,e,T,s,i)):i.push(r,o)},PK=function(e){const t=[],s=e.length;return E(this,Ht,w_).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},LK=function(e,t,s,i,r,o){const c=new Float32Array(o**2),d=-2*i**2,h=o>>1;for(let g=0;g<o;g++){const b=(g-h)**2;for(let y=0;y<o;y++)c[g*o+y]=Math.exp((b+(y-h)**2)/d)}const u=new Float32Array(256),p=-2*r**2;for(let g=0;g<256;g++)u[g]=Math.exp(g**2/p);const f=e.length,m=new Uint8Array(f),x=new Uint32Array(256);for(let g=0;g<s;g++)for(let b=0;b<t;b++){const y=g*t+b,C=e[y];let w=0,S=0;for(let T=0;T<o;T++){const k=g+T-h;if(!(k<0||k>=s))for(let _=0;_<o;_++){const L=b+_-h;if(L<0||L>=t)continue;const D=e[k*t+L],P=c[T*o+_]*u[Math.abs(D-C)];w+=D*P,S+=P}}const j=m[y]=Math.round(w/S);x[j]++}return[m,x]},DK=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},sO=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,r=1/0;for(let c=0,d=s.length;c<d;c++){const h=s[c]=e[c<<2];i=Math.max(i,h),r=Math.min(r,h)}const o=255/(i-r);for(let c=0,d=s.length;c<d;c++)s[c]=(s[c]-r)*o;return s},nO=function(e){let t,s=-1/0,i=-1/0;const r=e.findIndex(d=>d!==0);let o=r,c=r;for(t=r;t<256;t++){const d=e[t];d>s&&(t-o>i&&(i=t-o,c=t-1),s=d,o=t)}for(t=c-1;t>=0&&!(e[t]>e[t+1]);t--);return t},RK=function(e){const t=e,{width:s,height:i}=e,{maxDim:r}=l(this,k0);let o=s,c=i;if(s>r||i>r){let f=s,m=i,x=Math.log2(Math.max(s,i)/r);const g=Math.floor(x);x=x===g?g-1:g;for(let y=0;y<x;y++){o=Math.ceil(f/2),c=Math.ceil(m/2);const C=new OffscreenCanvas(o,c);C.getContext("2d").drawImage(e,0,0,f,m,0,0,o,c),f=o,m=c,e!==t&&e.close(),e=C.transferToImageBitmap()}const b=Math.min(r/o,r/c);o=Math.round(o*b),c=Math.round(c*b)}const h=new OffscreenCanvas(o,c).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,o,c),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,o,c);const u=h.getImageData(0,0,o,c).data;return[E(this,Ht,sO).call(this,u),o,c]},A(vd,Ht),A(vd,k0,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),A(vd,Ql,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class F3 extends CK{constructor(){super(),super.updateProperties({fill:_s._defaultLineColor,"stroke-width":0})}clone(){const e=new F3;return e.updateAll(this),e}}class O3 extends aD{constructor(e){super(e),super.updateProperties({stroke:_s._defaultLineColor,"stroke-width":1})}clone(){const e=new O3(this._viewParameters);return e.updateAll(this),e}}var Bf,fd,$f,T0;const Ca=class Ca extends kP{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});A(this,Bf,!1);A(this,fd,null);A(this,$f,null);A(this,T0,null);this._willKeepAspectRatio=!0,v(this,$f,t.signatureData||null),v(this,fd,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){_s.initialize(t,s),this._defaultDrawingOptions=new F3,this._defaultDrawnSignatureOptions=new O3(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return ct(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!l(this,fd)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(l(this,$f)){const{lines:r,mustSmooth:o,areContours:c,description:d,uuid:h,heightInPage:u}=l(this,$f),{rawDims:{pageWidth:p,pageHeight:f},rotation:m}=this.parent.viewport,x=vd.processDrawnLines({lines:r,pageWidth:p,pageHeight:f,rotation:m,innerMargin:Ca._INNER_MARGIN,mustSmooth:o,areContours:c});this.addSignature(x,u,d,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:l(this,fd)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){v(this,T0,t),this.addEditToolbar()}getUuid(){return l(this,T0)}get description(){return l(this,fd)}set description(t){v(this,fd,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:r,height:o}=l(this,$f),c=Math.max(r,o),d=vd.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:r,height:o},pageWidth:c,pageHeight:c,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:d.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,s,i,r){const{x:o,y:c}=this,{outline:d}=v(this,$f,t);v(this,Bf,d instanceof ZF),this.description=i;let h;l(this,Bf)?h=Ca.getDefaultDrawingOptions():(h=Ca._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":d.thickness})),this._addOutlines({drawOutlines:d,drawingOptions:h});const[,u]=this.pageDimensions;let p=s/u;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(),this.x=o,this.y=c,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return vd.process(t,s,i,r,Ca._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:r},rotation:o}=this.parent.viewport;return vd.extractContoursFromText(t,s,i,r,o,Ca._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return vd.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:r,innerMargin:Ca._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=Ca.getDefaultDrawingOptions():(this._drawingOptions=Ca._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:l(this,Bf),color:[0,0,0],thickness:l(this,Bf)?0:r});return this.addComment(o),t?(o.paths={lines:s,points:i},o.uuid=l(this,T0),o.isCopy=!0):o.lines=s,l(this,fd)&&(o.accessibilityData={type:"Figure",alt:l(this,fd)}),o}static deserializeDraw(t,s,i,r,o,c){return c.areContours?ZF.deserialize(t,s,i,r,o,c):ME.deserialize(t,s,i,r,o,c)}static async deserialize(t,s,i){var o;const r=await super.deserialize(t,s,i);return v(r,Bf,t.areContours),r.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",v(r,T0,t.uuid),r}};Bf=new WeakMap,fd=new WeakMap,$f=new WeakMap,T0=new WeakMap,W(Ca,"_type","signature"),W(Ca,"_editorType",et.SIGNATURE),W(Ca,"_defaultDrawingOptions",null);let iO=Ca;var zs,gi,Uf,cu,zf,f1,du,_0,md,io,m1,It,LC,DC,S_,C_,N_,aO,j_,IK;class rO extends _s{constructor(t){super({...t,name:"stampEditor"});A(this,It);A(this,zs,null);A(this,gi,null);A(this,Uf,null);A(this,cu,null);A(this,zf,null);A(this,f1,"");A(this,du,null);A(this,_0,!1);A(this,md,null);A(this,io,!1);A(this,m1,!1);v(this,cu,t.bitmapUrl),v(this,zf,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){_s.initialize(t,s)}static isHandlingMimeForPasting(t){return vP.includes(t)}static paste(t,s){s.pasteEditor({mode:et.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:c}=t||this.copyCanvas(null,null,!0).imageData,d=await i.guess({name:"altText",request:{data:r,width:o,height:c,channels:r.length/(o*c)}});if(!d)throw new Error("No response from the AI service.");if(d.error)throw new Error("Error from the AI service.");if(d.cancel)return null;if(!d.output)throw new Error("No valid response from the AI service.");const h=d.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;l(this,gi)&&(v(this,zs,null),this._uiManager.imageManager.deleteId(l(this,gi)),(t=l(this,du))==null||t.remove(),v(this,du,null),l(this,md)&&(clearTimeout(l(this,md)),v(this,md,null))),super.remove()}rebuild(){if(!this.parent){l(this,gi)&&E(this,It,S_).call(this);return}super.rebuild(),this.div!==null&&(l(this,gi)&&l(this,du)===null&&E(this,It,S_).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(l(this,Uf)||l(this,zs)||l(this,cu)||l(this,zf)||l(this,gi)||l(this,_0))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),l(this,_0)||(l(this,zs)?E(this,It,C_).call(this):E(this,It,S_).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(v(this,gi,i),r&&v(this,zs,r),v(this,_0,!1),E(this,It,C_).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;l(this,md)!==null&&clearTimeout(l(this,md)),v(this,md,setTimeout(()=>{v(this,md,null),E(this,It,aO).call(this)},200))}copyCanvas(t,s,i=!1){t||(t=224);const{width:r,height:o}=l(this,zs),c=new cc;let d=l(this,zs),h=r,u=o,p=null;if(s){if(r>s||o>s){const k=Math.min(s/r,s/o);h=Math.floor(r*k),u=Math.floor(o*k)}p=document.createElement("canvas");const m=p.width=Math.ceil(h*c.sx),x=p.height=Math.ceil(u*c.sy);l(this,io)||(d=E(this,It,N_).call(this,m,x));const g=p.getContext("2d");g.filter=this._uiManager.hcmFilter;let b="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":fpe.isDarkMode&&(b="#8f8f9d",y="#42414d");const C=15,w=C*c.sx,S=C*c.sy,j=new OffscreenCanvas(w*2,S*2),T=j.getContext("2d");T.fillStyle=b,T.fillRect(0,0,w*2,S*2),T.fillStyle=y,T.fillRect(0,0,w,S),T.fillRect(w,S,w,S),g.fillStyle=g.createPattern(j,"repeat"),g.fillRect(0,0,m,x),g.drawImage(d,0,0,d.width,d.height,0,0,m,x)}let f=null;if(i){let m,x;if(c.symmetric&&d.width<t&&d.height<t)m=d.width,x=d.height;else if(d=l(this,zs),r>t||o>t){const y=Math.min(t/r,t/o);m=Math.floor(r*y),x=Math.floor(o*y),l(this,io)||(d=E(this,It,N_).call(this,m,x))}const b=new OffscreenCanvas(m,x).getContext("2d",{willReadFrequently:!0});b.drawImage(d,0,0,d.width,d.height,0,0,m,x),f={width:m,height:x,data:b.getImageData(0,0,m,x).data}}return{canvas:p,width:h,height:u,imageData:f}}static async deserialize(t,s,i){var b;let r=null,o=!1;if(t instanceof QX){const{data:{rect:y,rotation:C,id:w,structParent:S,popupRef:j,richText:T,contentsObj:k,creationDate:_,modificationDate:L},container:D,parent:{page:{pageNumber:P}},canvas:I}=t;let M,O;I?(delete t.canvas,{id:M,bitmap:O}=i.imageManager.getFromCanvas(D.id,I),I.remove()):(o=!0,t._hasNoCanvas=!0);const F=((b=await s._structTree.getAriaAttributes(`${j3}${w}`))==null?void 0:b.get("aria-label"))||"";r=t={annotationType:et.STAMP,bitmapId:M,bitmap:O,pageIndex:P-1,rect:y.slice(0),rotation:C,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:F},isSvg:!1,structParent:S,popupRef:j,richText:T,comment:(k==null?void 0:k.str)||null,creationDate:_,modificationDate:L}}const c=await super.deserialize(t,s,i),{rect:d,bitmap:h,bitmapUrl:u,bitmapId:p,isSvg:f,accessibilityData:m}=t;o?(i.addMissingCanvas(t.id,c),v(c,_0,!0)):p&&i.imageManager.isValidId(p)?(v(c,gi,p),h&&v(c,zs,h)):v(c,cu,u),v(c,io,f);const[x,g]=c.pageDimensions;return c.width=(d[2]-d[0])/x,c.height=(d[3]-d[1])/g,m&&(c.altTextData=m),c._initialData=r,t.comment&&c.setCommentData(t),v(c,m1,!!r),c}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:l(this,gi),isSvg:l(this,io)});if(this.addComment(i),t)return i.bitmapUrl=E(this,It,j_).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const d=E(this,It,IK).call(this,i);return d.isSame?null:(d.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(s===null)return i;s.stamps||(s.stamps=new Map);const c=l(this,io)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(l(this,gi)))s.stamps.set(l(this,gi),{area:c,serialized:i}),i.bitmap=E(this,It,j_).call(this,!1);else if(l(this,io)){const d=s.stamps.get(l(this,gi));c>d.area&&(d.area=c,d.serialized.bitmap.close(),d.serialized.bitmap=E(this,It,j_).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}zs=new WeakMap,gi=new WeakMap,Uf=new WeakMap,cu=new WeakMap,zf=new WeakMap,f1=new WeakMap,du=new WeakMap,_0=new WeakMap,md=new WeakMap,io=new WeakMap,m1=new WeakMap,It=new WeakSet,LC=function(t,s=!1){if(!t){this.remove();return}v(this,zs,t.bitmap),s||(v(this,gi,t.id),v(this,io,t.isSvg)),t.file&&v(this,f1,t.file.name),E(this,It,C_).call(this)},DC=function(){if(v(this,Uf,null),this._uiManager.enableWaiting(!1),!!l(this,du)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,zs)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,zs)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},S_=function(){if(l(this,gi)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,gi)).then(i=>E(this,It,LC).call(this,i,!0)).finally(()=>E(this,It,DC).call(this));return}if(l(this,cu)){const i=l(this,cu);v(this,cu,null),this._uiManager.enableWaiting(!0),v(this,Uf,this._uiManager.imageManager.getFromUrl(i).then(r=>E(this,It,LC).call(this,r)).finally(()=>E(this,It,DC).call(this)));return}if(l(this,zf)){const i=l(this,zf);v(this,zf,null),this._uiManager.enableWaiting(!0),v(this,Uf,this._uiManager.imageManager.getFromFile(i).then(r=>E(this,It,LC).call(this,r)).finally(()=>E(this,It,DC).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=vP.join(",");const s=this._uiManager._signal;v(this,Uf,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),E(this,It,LC).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>E(this,It,DC).call(this))),t.click()},C_=function(){var h;const{div:t}=this;let{width:s,height:i}=l(this,zs);const[r,o]=this.pageDimensions,c=.75;if(this.width)s=this.width*r,i=this.height*o;else if(s>c*r||i>c*o){const u=Math.min(c*r/s,c*o/i);s*=u,i*=u}this._uiManager.enableWaiting(!1);const d=v(this,du,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=s/r,this.height=i/o,this.setDims(),(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),E(this,It,aO).call(this),l(this,m1)||(this.parent.addUndoableEditor(this),v(this,m1,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,f1)&&this.div.setAttribute("aria-description",l(this,f1)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},N_=function(t,s){const{width:i,height:r}=l(this,zs);let o=i,c=r,d=l(this,zs);for(;o>2*t||c>2*s;){const h=o,u=c;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),c>2*s&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2));const p=new OffscreenCanvas(o,c);p.getContext("2d").drawImage(d,0,0,h,u,0,0,o,c),d=p.transferToImageBitmap()}return d},aO=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,o=new cc,c=Math.ceil(i*t*o.sx),d=Math.ceil(r*s*o.sy),h=l(this,du);if(!h||h.width===c&&h.height===d)return;h.width=c,h.height=d;const u=l(this,io)?l(this,zs):E(this,It,N_).call(this,c,d),p=h.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(u,0,0,u.width,u.height,0,0,c,d)},j_=function(t){if(t){if(l(this,io)){const r=this._uiManager.imageManager.getSvgUrl(l(this,gi));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=l(this,zs),s.getContext("2d").drawImage(l(this,zs),0,0),s.toDataURL()}if(l(this,io)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*Fu.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*Fu.PDF_TO_CSS_UNITS),c=new OffscreenCanvas(r,o);return c.getContext("2d").drawImage(l(this,zs),0,0,l(this,zs).width,l(this,zs).height,0,0,r,o),c.transferToImageBitmap()}return structuredClone(l(this,zs))},IK=function(t){var c;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,o=(((c=t.accessibilityData)==null?void 0:c.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},W(rO,"_type","stamp"),W(rO,"_editorType",et.STAMP);var P0,g1,Hf,Vf,hu,da,Gf,x1,y1,Jl,uu,xi,pu,Wf,b1,Fe,qf,Ss,oO,MK,Sc,lO,cO,A_;const kl=class kl{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:c,textLayer:d,viewport:h,l10n:u}){A(this,Ss);A(this,P0);A(this,g1,!1);A(this,Hf,null);A(this,Vf,null);A(this,hu,null);A(this,da,new Map);A(this,Gf,!1);A(this,x1,!1);A(this,y1,!1);A(this,Jl,null);A(this,uu,null);A(this,xi,null);A(this,pu,null);A(this,Wf,null);A(this,b1,-1);A(this,Fe);const p=[...l(kl,qf).values()];if(!kl._initialized){kl._initialized=!0;for(const f of p)f.initialize(u,e)}e.registerEditorTypes(p),v(this,Fe,e),this.pageIndex=t,this.div=s,v(this,P0,r),v(this,Hf,o),this.viewport=h,v(this,xi,d),this.drawLayer=c,this._structTree=i,l(this,Fe).addLayer(this)}get isEmpty(){return l(this,da).size===0}get isInvisible(){return this.isEmpty&&l(this,Fe).getMode()===et.NONE}updateToolbar(e){l(this,Fe).updateToolbar(e)}updateMode(e=l(this,Fe).getMode()){switch(E(this,Ss,A_).call(this),e){case et.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case et.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case et.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===et.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of l(kl,qf).values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=l(this,xi))==null?void 0:t.div)}setEditingState(e){l(this,Fe).setEditingState(e)}addCommands(e){l(this,Fe).addCommands(e)}cleanUndoStack(e){l(this,Fe).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=l(this,Hf))==null||t.div.classList.toggle("disabled",!e)}async enable(){var s;v(this,y1,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(s=l(this,Wf))==null||s.abort(),v(this,Wf,null);const e=new Set;for(const i of l(this,Ss,oO))i.enableEditing(),i.show(!0),i.annotationElementId&&(l(this,Fe).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=l(this,Hf);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),l(this,Fe).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}v(this,y1,!1),l(this,Fe)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var s;if(v(this,x1,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),l(this,xi)&&!l(this,Wf)){v(this,Wf,new AbortController);const i=l(this,Fe).combinedSignal(l(this,Wf));l(this,xi).div.addEventListener("pointerdown",r=>{const{clientX:c,clientY:d,timeStamp:h}=r,u=l(this,b1);if(h-u>500){v(this,b1,h);return}v(this,b1,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const f=document.elementsFromPoint(c,d);if(p.toggle("getElements",!1),!this.div.contains(f[0]))return;let m;const x=new RegExp(`^${DN}[0-9]+$`);for(const b of f)if(x.test(b.id)){m=b.id;break}if(!m)return;const g=l(this,da).get(m);(g==null?void 0:g.annotationElementId)===null&&(r.stopPropagation(),r.preventDefault(),g.dblclick(r))},{signal:i,capture:!0})}const e=l(this,Hf);if(e){const i=new Map,r=new Map;for(const c of l(this,Ss,oO)){if(c.disableEditing(),!c.annotationElementId){c.updateFakeAnnotationElement(e);continue}if(c.serialize()!==null){i.set(c.annotationElementId,c);continue}else r.set(c.annotationElementId,c);(s=this.getEditableAnnotation(c.annotationElementId))==null||s.show(),c.remove()}const o=e.getEditableAnnotations();for(const c of o){const{id:d}=c.data;if(l(this,Fe).isDeletedAnnotationElement(d)){c.updateEdited({deleted:!0});continue}let h=r.get(d);if(h){h.resetAnnotationElement(c),h.show(!1),c.show();continue}h=i.get(d),h&&(l(this,Fe).addChangedExistingAnnotation(h),h.renderAnnotationElement(c)&&h.show(!1)),c.show()}}E(this,Ss,A_).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:t}=this.div;for(const i of l(kl,qf).values())t.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),v(this,x1,!1)}getEditableAnnotation(e){var t;return((t=l(this,Hf))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){l(this,Fe).getActive()!==e&&l(this,Fe).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=l(this,xi))!=null&&e.div&&!l(this,pu)){v(this,pu,new AbortController);const t=l(this,Fe).combinedSignal(l(this,pu));l(this,xi).div.addEventListener("pointerdown",E(this,Ss,MK).bind(this),{signal:t}),l(this,xi).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=l(this,xi))!=null&&e.div&&l(this,pu)&&(l(this,pu).abort(),v(this,pu,null),l(this,xi).div.classList.remove("highlighting"))}enableClick(){if(l(this,Vf))return;v(this,Vf,new AbortController);const e=l(this,Fe).combinedSignal(l(this,Vf));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=l(this,Vf))==null||e.abort(),v(this,Vf,null)}attach(e){l(this,da).set(e.id,e);const{annotationElementId:t}=e;t&&l(this,Fe).isDeletedAnnotationElement(t)&&l(this,Fe).removeDeletedAnnotationElement(e)}detach(e){var t;l(this,da).delete(e.id),(t=l(this,P0))==null||t.removePointerInTextLayer(e.contentDiv),!l(this,x1)&&e.annotationElementId&&l(this,Fe).addDeletedAnnotationElement(e)}remove(e){this.detach(e),l(this,Fe).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(l(this,Fe).addDeletedAnnotationElement(e.annotationElementId),_s.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),l(this,Fe).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!l(this,y1)),l(this,Fe).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!l(this,hu)&&(e._focusEventsAllowed=!1,v(this,hu,setTimeout(()=>{v(this,hu,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:l(this,Fe)._signal}),t.focus())},0))),e._structTreeParentId=(s=l(this,P0))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of l(this,da).values())if(t.uid===e)return t;return null}getNextId(){return l(this,Fe).getId()}combinedSignal(e){return l(this,Fe).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=l(this,Ss,Sc))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await l(this,Fe).updateMode(e.mode);const{offsetX:s,offsetY:i}=E(this,Ss,cO).call(this),r=this.getNextId(),o=E(this,Ss,lO).call(this,{parent:this,id:r,x:s,y:i,uiManager:l(this,Fe),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=l(kl,qf).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,l(this,Fe)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=E(this,Ss,lO).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:l(this,Fe),isCentered:t,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(E(this,Ss,cO).call(this),!0,e)}setSelected(e){l(this,Fe).setSelected(e)}toggleSelected(e){l(this,Fe).toggleSelected(e)}unselect(e){l(this,Fe).unselect(e)}pointerup(e){var i;const{isMac:t}=wi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!l(this,Gf)||(v(this,Gf,!1),(i=l(this,Ss,Sc))!=null&&i.isDrawer&&l(this,Ss,Sc).supportMultipleDrawings))return;if(!l(this,g1)){v(this,g1,!0);return}const s=l(this,Fe).getMode();if(s===et.STAMP||s===et.SIGNATURE){l(this,Fe).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(l(this,Fe).getMode()===et.HIGHLIGHT&&this.enableTextSelection(),l(this,Gf)){v(this,Gf,!1);return}const{isMac:t}=wi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(v(this,Gf,!0),(i=l(this,Ss,Sc))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=l(this,Fe).getActive();v(this,g1,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),l(this,Jl)){l(this,Ss,Sc).startDrawing(this,l(this,Fe),!1,e);return}l(this,Fe).setCurrentDrawingSession(this),v(this,Jl,new AbortController);const t=l(this,Fe).combinedSignal(l(this,Jl));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(v(this,uu,null),this.commitOrRemove())},{signal:t}),l(this,Ss,Sc).startDrawing(this,l(this,Fe),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&v(this,uu,t);return}l(this,uu)&&setTimeout(()=>{var t;(t=l(this,uu))==null||t.focus(),v(this,uu,null)},0)}endDrawingSession(e=!1){return l(this,Jl)?(l(this,Fe).setCurrentDrawingSession(null),l(this,Jl).abort(),v(this,Jl,null),v(this,uu,null),l(this,Ss,Sc).endDrawing(e)):null}findNewParent(e,t,s){const i=l(this,Fe).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return l(this,Jl)?(this.endDrawingSession(),!0):!1}onScaleChanging(){l(this,Jl)&&l(this,Ss,Sc).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=l(this,Fe).getActive())==null?void 0:e.parent)===this&&(l(this,Fe).commitOrRemove(),l(this,Fe).setActiveEditor(null)),l(this,hu)&&(clearTimeout(l(this,hu)),v(this,hu,null));for(const s of l(this,da).values())(t=l(this,P0))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,l(this,da).clear(),l(this,Fe).removeLayer(this)}render({viewport:e}){this.viewport=e,fm(this.div,e);for(const t of l(this,Fe).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){l(this,Fe).commitOrRemove(),E(this,Ss,A_).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,fm(this.div,{rotation:s}),t!==s)for(const i of l(this,da).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return l(this,Fe).viewParameters.realScale}};P0=new WeakMap,g1=new WeakMap,Hf=new WeakMap,Vf=new WeakMap,hu=new WeakMap,da=new WeakMap,Gf=new WeakMap,x1=new WeakMap,y1=new WeakMap,Jl=new WeakMap,uu=new WeakMap,xi=new WeakMap,pu=new WeakMap,Wf=new WeakMap,b1=new WeakMap,Fe=new WeakMap,qf=new WeakMap,Ss=new WeakSet,oO=function(){return l(this,da).size!==0?l(this,da).values():l(this,Fe).getEditors(this.pageIndex)},MK=function(e){l(this,Fe).unselectAll();const{target:t}=e;if(t===l(this,xi).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&l(this,xi).div.contains(t)){const{isMac:s}=wi.platform;if(e.button!==0||e.ctrlKey&&s)return;l(this,Fe).showAllEditors("highlight",!0,!0),l(this,xi).div.classList.add("free"),this.toggleDrawing(),EP.startHighlighting(this,l(this,Fe).direction==="ltr",{target:l(this,xi).div,x:e.x,y:e.y}),l(this,xi).div.addEventListener("pointerup",()=>{l(this,xi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,Fe)._signal}),e.preventDefault()}},Sc=function(){return l(kl,qf).get(l(this,Fe).getMode())},lO=function(e){const t=l(this,Ss,Sc);return t?new t.prototype.constructor(e):null},cO=function(){const{x:e,y:t,width:s,height:i}=this.boundingClientRect,r=Math.max(0,e),o=Math.max(0,t),c=Math.min(window.innerWidth,e+s),d=Math.min(window.innerHeight,t+i),h=(r+c)/2-e,u=(o+d)/2-t,[p,f]=this.viewport.rotation%180===0?[h,u]:[u,h];return{offsetX:p,offsetY:f}},A_=function(){for(const e of l(this,da).values())e.isEmpty()&&e.remove()},W(kl,"_initialized",!1),A(kl,qf,new Map([zF,JF,rO,EP,iO].map(e=>[e._editorType,e])));let TP=kl;var Zl,Dr,L0,cE,hL,FK,Rd,dO,OK,hO;const Yn=class Yn{constructor({pageIndex:e}){A(this,Rd);A(this,Zl,null);A(this,Dr,new Map);A(this,L0,new Map);this.pageIndex=e}setParent(e){if(!l(this,Zl)){v(this,Zl,e);return}if(l(this,Zl)!==e){if(l(this,Dr).size>0)for(const t of l(this,Dr).values())t.remove(),e.append(t);v(this,Zl,e)}}static get _svgFactory(){return ct(this,"_svgFactory",new $N)}draw(e,t=!1,s=!1){const i=vt(Yn,cE)._++,r=E(this,Rd,dO).call(this),o=Yn._svgFactory.createElement("defs");r.append(o);const c=Yn._svgFactory.createElement("path");o.append(c);const d=`path_p${this.pageIndex}_${i}`;c.setAttribute("id",d),c.setAttribute("vector-effect","non-scaling-stroke"),t&&l(this,L0).set(i,c);const h=s?E(this,Rd,OK).call(this,o,d):null,u=Yn._svgFactory.createElement("use");return r.append(u),u.setAttribute("href",`#${d}`),this.updateProperties(r,e),l(this,Dr).set(i,r),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=vt(Yn,cE)._++,i=E(this,Rd,dO).call(this),r=Yn._svgFactory.createElement("defs");i.append(r);const o=Yn._svgFactory.createElement("path");r.append(o);const c=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(t){const p=Yn._svgFactory.createElement("mask");r.append(p),d=`mask_p${this.pageIndex}_${s}`,p.setAttribute("id",d),p.setAttribute("maskUnits","objectBoundingBox");const f=Yn._svgFactory.createElement("rect");p.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const m=Yn._svgFactory.createElement("use");p.append(m),m.setAttribute("href",`#${c}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const h=Yn._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${c}`),d&&h.setAttribute("mask",`url(#${d})`);const u=h.cloneNode();return i.append(u),h.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(i,e),l(this,Dr).set(s,i),s}finalizeDraw(e,t){l(this,L0).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var d;if(!t)return;const{root:s,bbox:i,rootClass:r,path:o}=t,c=typeof e=="number"?l(this,Dr).get(e):e;if(c){if(s&&E(this,Rd,hO).call(this,c,s),i&&E(d=Yn,hL,FK).call(d,c,i),r){const{classList:h}=c;for(const[u,p]of Object.entries(r))h.toggle(u,p)}if(o){const u=c.firstChild.firstChild;E(this,Rd,hO).call(this,u,o)}}}updateParent(e,t){if(t===this)return;const s=l(this,Dr).get(e);s&&(l(t,Zl).append(s),l(this,Dr).delete(e),l(t,Dr).set(e,s))}remove(e){l(this,L0).delete(e),l(this,Zl)!==null&&(l(this,Dr).get(e).remove(),l(this,Dr).delete(e))}destroy(){v(this,Zl,null);for(const e of l(this,Dr).values())e.remove();l(this,Dr).clear(),l(this,L0).clear()}};Zl=new WeakMap,Dr=new WeakMap,L0=new WeakMap,cE=new WeakMap,hL=new WeakSet,FK=function(e,[t,s,i,r]){const{style:o}=e;o.top=`${100*s}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},Rd=new WeakSet,dO=function(){const e=Yn._svgFactory.create(1,1,!0);return l(this,Zl).append(e),e.setAttribute("aria-hidden",!0),e},OK=function(e,t){const s=Yn._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=Yn._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},hO=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},A(Yn,hL),A(Yn,cE,0);let _P=Yn;globalThis._pdfjsTestingUtils={HighlightOutliner:VF};globalThis.pdfjsLib={AbortException:Mu,AnnotationEditorLayer:TP,AnnotationEditorParamsType:Nt,AnnotationEditorType:et,AnnotationEditorUIManager:mm,AnnotationLayer:M3,AnnotationMode:bd,AnnotationType:jn,applyOpacity:MY,build:BX,ColorPicker:BN,createValidAbsoluteUrl:S3,CSSConstants:IY,DOMSVGFactory:$N,DrawLayer:_P,FeatureTest:wi,fetchData:Q1,findContrastColor:FY,getDocument:P3,getFilenameFromUrl:LY,getPdfFilenameFromUrl:DY,getRGB:J1,getUuid:N3,getXfaPageViewport:RY,GlobalWorkerOptions:mo,ImageKind:QC,InvalidPDFException:bP,isDataScheme:DE,isPdfFile:iD,isValidExplicitDest:gX,MathClamp:gr,noContextMenu:jo,normalizeUnicode:_Y,OPS:F1,OutputScale:cc,PasswordResponses:kY,PDFDataRangeTransport:L3,PDFDateString:MN,PDFWorker:O1,PermissionFlag:EY,PixelsPerInch:Fu,RenderingCancelledException:nD,renderRichText:E3,ResponseException:RN,setLayerDimensions:fm,shadow:ct,SignatureExtractor:vd,stopEvent:tn,SupportedImageMimeTypes:vP,TextLayer:ON,TouchManager:FN,updateUrlHash:C3,Util:Ce,VerbosityLevel:_E,version:D3,XfaLayer:A3};const Ufe=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Mu,AnnotationEditorLayer:TP,AnnotationEditorParamsType:Nt,AnnotationEditorType:et,AnnotationEditorUIManager:mm,AnnotationLayer:M3,AnnotationMode:bd,AnnotationType:jn,CSSConstants:IY,ColorPicker:BN,DOMSVGFactory:$N,DrawLayer:_P,FeatureTest:wi,GlobalWorkerOptions:mo,ImageKind:QC,InvalidPDFException:bP,MathClamp:gr,OPS:F1,OutputScale:cc,PDFDataRangeTransport:L3,PDFDateString:MN,PDFWorker:O1,PasswordResponses:kY,PermissionFlag:EY,PixelsPerInch:Fu,RenderingCancelledException:nD,ResponseException:RN,SignatureExtractor:vd,SupportedImageMimeTypes:vP,TextLayer:ON,TouchManager:FN,Util:Ce,VerbosityLevel:_E,XfaLayer:A3,applyOpacity:MY,build:BX,createValidAbsoluteUrl:S3,fetchData:Q1,findContrastColor:FY,getDocument:P3,getFilenameFromUrl:LY,getPdfFilenameFromUrl:DY,getRGB:J1,getUuid:N3,getXfaPageViewport:RY,isDataScheme:DE,isPdfFile:iD,isValidExplicitDest:gX,noContextMenu:jo,normalizeUnicode:_Y,renderRichText:E3,setLayerDimensions:fm,shadow:ct,stopEvent:tn,updateUrlHash:C3,version:D3},Symbol.toStringTag,{value:"Module"}));function BK(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=BK(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function oD(){for(var n,e,t=0,s="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=BK(n))&&(s&&(s+=" "),s+=e);return s}var Tz=Object.prototype.hasOwnProperty;function _z(n,e,t){for(t of n.keys())if(mb(t,e))return t}function mb(n,e){var t,s,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((s=n.length)===e.length)for(;s--&&mb(n[s],e[s]););return s===-1}if(t===Set){if(n.size!==e.size)return!1;for(s of n)if(i=s,i&&typeof i=="object"&&(i=_z(e,i),!i)||!e.has(i))return!1;return!0}if(t===Map){if(n.size!==e.size)return!1;for(s of n)if(i=s[0],i&&typeof i=="object"&&(i=_z(e,i),!i)||!mb(s[1],e.get(i)))return!1;return!0}if(t===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(t===DataView){if((s=n.byteLength)===e.byteLength)for(;s--&&n.getInt8(s)===e.getInt8(s););return s===-1}if(ArrayBuffer.isView(n)){if((s=n.byteLength)===e.byteLength)for(;s--&&n[s]===e[s];);return s===-1}if(!t||typeof n=="object"){s=0;for(t in n)if(Tz.call(n,t)&&++s&&!Tz.call(e,t)||!(t in e)||!mb(n[t],e[t]))return!1;return Object.keys(e).length===s}}return n!==n&&e!==e}function FE(n){let e=!1;return{promise:new Promise((s,i)=>{n.then(r=>!e&&s(r)).catch(r=>!e&&i(r))}),cancel(){e=!0}}}const zfe=["onCopy","onCut","onPaste"],Hfe=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],Vfe=["onFocus","onBlur"],Gfe=["onInput","onInvalid","onReset","onSubmit"],Wfe=["onLoad","onError"],qfe=["onKeyDown","onKeyPress","onKeyUp"],Yfe=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],Xfe=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],Kfe=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],Qfe=["onSelect"],Jfe=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],Zfe=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],eme=["onScroll"],tme=["onWheel"],sme=["onAnimationStart","onAnimationEnd","onAnimationIteration"],nme=["onTransitionEnd"],ime=["onToggle"],rme=["onChange"],ame=[...zfe,...Hfe,...Vfe,...Gfe,...Wfe,...qfe,...Yfe,...Xfe,...Kfe,...Qfe,...Jfe,...Zfe,...eme,...tme,...sme,...nme,...rme,...ime];function $K(n,e){const t={};for(const s of ame){const i=n[s];i&&(e?t[s]=r=>i(r,e(s)):t[s]=i)}return t}var ome="Invariant failed";function vs(n,e){if(!n)throw new Error(ome)}var lme=function(){},cme=lme;const vr=uL(cme),UK=N.createContext(null),dme="noopener noreferrer nofollow";class hme{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHash(){}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return vs(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){vs(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}addLinkAttributes(e,t,s){e.href=t,e.rel=this.externalLinkRel||dme,e.target=s?"_blank":this.externalLinkTarget||""}goToDestination(e){return new Promise(t=>{vs(this.pdfDocument),vs(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{vs(Array.isArray(t));const s=t[0];new Promise(i=>{vs(this.pdfDocument),s instanceof Object?this.pdfDocument.getPageIndex(s).then(r=>{i(r)}).catch(()=>{vs(!1)}):typeof s=="number"?i(s):vs(!1)}).then(i=>{const r=i+1;vs(this.pdfViewer),vs(r>=1&&r<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:i,pageNumber:r})})})}goToPage(e){const t=e-1;vs(this.pdfViewer),vs(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}goToXY(){}cachePageRef(){}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}executeNamedAction(){}executeSetOCGState(){}isPageVisible(){return!0}isPageCached(){return!0}navigateTo(e){this.goToDestination(e)}}function gb({children:n,type:e}){return a.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:n})}const Pz={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function ume(n,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return n}}function B1(){return N.useReducer(ume,{value:void 0,error:void 0})}const lD=typeof window<"u",zK=lD&&window.location.protocol==="file:";function pme(n){return typeof n<"u"}function Dm(n){return pme(n)&&n!==null}function fme(n){return typeof n=="string"}function mme(n){return n instanceof ArrayBuffer}function gme(n){return vs(lD),n instanceof Blob}function uO(n){return fme(n)&&/^data:/.test(n)}function Lz(n){vs(uO(n));const[e="",t=""]=n.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function xme(){return lD&&window.devicePixelRatio||1}const HK="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Dz(){vr(!zK,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${HK}`)}function yme(){vr(!zK,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${HK}`)}function Z0(n){n!=null&&n.cancel&&n.cancel()}function pO(n,e){return Object.defineProperty(n,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(n,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(n,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(n,"originalHeight",{get(){return this.view[3]},configurable:!0}),n}function bme(n){return n.name==="RenderingCancelledException"}function vme(n){return new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{if(!s.result)return t(new Error("Error while reading a file."));e(s.result)},s.onerror=i=>{if(!i.target)return t(new Error("Error while reading a file."));const{error:r}=i.target;if(!r)return t(new Error("Error while reading a file."));switch(r.code){case r.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case r.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case r.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},s.readAsArrayBuffer(n)})}const{PDFDataRangeTransport:wme}=Ufe,Sme=(n,e)=>{switch(e){case Pz.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");n(t);break}case Pz.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");n(t);break}}};function Rz(n){return typeof n=="object"&&n!==null&&("data"in n||"range"in n||"url"in n)}const Cme=N.forwardRef(function({children:e,className:t,error:s="Failed to load PDF file.",externalLinkRel:i,externalLinkTarget:r,file:o,inputRef:c,imageResourcesPath:d,loading:h="Loading PDF",noData:u="No PDF file specified.",onItemClick:p,onLoadError:f,onLoadProgress:m,onLoadSuccess:x,onPassword:g=Sme,onSourceError:b,onSourceSuccess:y,options:C,renderMode:w,rotate:S,scale:j,...T},k){const[_,L]=B1(),{value:D,error:P}=_,[I,M]=B1(),{value:O,error:F}=I,B=N.useRef(new hme),U=N.useRef([]),$=N.useRef(void 0),G=N.useRef(void 0);o&&o!==$.current&&Rz(o)&&(vr(!mb(o,$.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),$.current=o),C&&C!==G.current&&(vr(!mb(C,G.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),G.current=C);const ne=N.useRef({scrollPageIntoView:Ne=>{const{dest:Pe,pageNumber:nt,pageIndex:gt=nt-1}=Ne;if(p){p({dest:Pe,pageIndex:gt,pageNumber:nt});return}const hs=U.current[gt];if(hs){hs.scrollIntoView();return}vr(!1,`An internal link leading to page ${nt} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});N.useImperativeHandle(k,()=>({linkService:B,pages:U,viewer:ne}),[]);function Z(){y&&y()}function K(){P&&(vr(!1,P.toString()),b&&b(P))}function X(){L({type:"RESET"})}N.useEffect(X,[o,L]);const V=N.useCallback(async()=>{if(!o)return null;if(typeof o=="string")return uO(o)?{data:Lz(o)}:(Dz(),{url:o});if(o instanceof wme)return{range:o};if(mme(o))return{data:o};if(lD&&gme(o))return{data:await vme(o)};if(vs(typeof o=="object"),vs(Rz(o)),"url"in o&&typeof o.url=="string"){if(uO(o.url)){const{url:Ne,...Pe}=o;return{data:Lz(Ne),...Pe}}Dz()}return o},[o]);N.useEffect(()=>{const Ne=FE(V());return Ne.promise.then(Pe=>{L({type:"RESOLVE",value:Pe})}).catch(Pe=>{L({type:"REJECT",error:Pe})}),()=>{Z0(Ne)}},[V,L]),N.useEffect(()=>{if(!(typeof D>"u")){if(D===!1){K();return}Z()}},[D]);function q(){O&&(x&&x(O),U.current=new Array(O.numPages),B.current.setDocument(O))}function ee(){F&&(vr(!1,F.toString()),f&&f(F))}N.useEffect(function(){M({type:"RESET"})},[M,D]),N.useEffect(function(){if(!D)return;const Pe=C?{...D,...C}:D,nt=P3(Pe);m&&(nt.onProgress=m),g&&(nt.onPassword=g);const gt=nt,hs=gt.promise.then(qs=>{M({type:"RESOLVE",value:qs})}).catch(qs=>{gt.destroyed||M({type:"REJECT",error:qs})});return()=>{hs.finally(()=>gt.destroy())}},[C,M,D]),N.useEffect(()=>{if(!(typeof O>"u")){if(O===!1){ee();return}q()}},[O]),N.useEffect(function(){B.current.setViewer(ne.current),B.current.setExternalLinkRel(i),B.current.setExternalLinkTarget(r)},[i,r]);const ie=N.useCallback((Ne,Pe)=>{U.current[Ne]=Pe},[]),Re=N.useCallback(Ne=>{delete U.current[Ne]},[]),Ye=N.useMemo(()=>({imageResourcesPath:d,linkService:B.current,onItemClick:p,pdf:O,registerPage:ie,renderMode:w,rotate:S,scale:j,unregisterPage:Re}),[d,p,O,ie,w,S,j,Re]),Le=N.useMemo(()=>$K(T,()=>O),[T,O]);function te(){function Ne(nt){return!!(nt!=null&&nt.pdf)}if(!Ne(Ye))throw new Error("pdf is undefined");const Pe=typeof e=="function"?e(Ye):e;return a.jsx(UK.Provider,{value:Ye,children:Pe})}function fe(){return o?O==null?a.jsx(gb,{type:"loading",children:typeof h=="function"?h():h}):O===!1?a.jsx(gb,{type:"error",children:typeof s=="function"?s():s}):te():a.jsx(gb,{type:"no-data",children:typeof u=="function"?u():u})}return a.jsx("div",{className:oD("react-pdf__Document",t),ref:c,...Le,children:fe()})});function VK(){return N.useContext(UK)}function GK(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.filter(Boolean);if(t.length<=1){var s=t[0];return s||null}return function(r){for(var o=0,c=t;o<c.length;o++){var d=c[o];typeof d=="function"?d(r):d&&(d.current=r)}}}const WK=N.createContext(null);function cD(){return N.useContext(WK)}function Nme(){const n=VK(),e=cD();vs(e);const t={...n,...e},{imageResourcesPath:s,linkService:i,onGetAnnotationsError:r,onGetAnnotationsSuccess:o,onRenderAnnotationLayerError:c,onRenderAnnotationLayerSuccess:d,page:h,pdf:u,renderForms:p,rotate:f,scale:m=1}=t;vs(u),vs(h),vs(i);const[x,g]=B1(),{value:b,error:y}=x,C=N.useRef(null);vr(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function w(){b&&o&&o(b)}function S(){y&&(vr(!1,y.toString()),r&&r(y))}N.useEffect(function(){g({type:"RESET"})},[g,h]),N.useEffect(function(){if(!h)return;const L=FE(h.getAnnotations()),D=L;return L.promise.then(P=>{g({type:"RESOLVE",value:P})}).catch(P=>{g({type:"REJECT",error:P})}),()=>{Z0(D)}},[g,h]),N.useEffect(()=>{if(b!==void 0){if(b===!1){S();return}w()}},[b]);function j(){d&&d()}function T(_){vr(!1,`${_}`),c&&c(_)}const k=N.useMemo(()=>h.getViewport({scale:m,rotation:f}),[h,f,m]);return N.useEffect(function(){if(!u||!h||!i||!b)return;const{current:L}=C;if(!L)return;const D=k.clone({dontFlip:!0}),P={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,annotationStorage:u.annotationStorage,commentManager:null,div:L,l10n:null,linkService:i,page:h,structTreeLayer:null,viewport:D},I={annotations:b,annotationStorage:u.annotationStorage,div:L,imageResourcesPath:s,linkService:i,page:h,renderForms:p,viewport:D};L.innerHTML="";try{new M3(P).render(I),j()}catch(M){T(M)}return()=>{}},[b,s,i,h,u,p,k]),a.jsx("div",{className:oD("react-pdf__Page__annotations","annotationLayer"),ref:C})}const qK={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},jme=/^H(\d+)$/;function Ame(n){return n in qK}function dD(n){return"children"in n}function YK(n){return dD(n)?n.children.length===1&&0 in n.children&&"id"in n.children[0]:!1}function Eme(n){const e={};if(dD(n)){const{role:t}=n,s=t.match(jme);if(s)e.role="heading",e["aria-level"]=Number(s[1]);else if(Ame(t)){const i=qK[t];i&&(e.role=i)}}return e}function XK(n){const e={};if(dD(n)){if(n.alt!==void 0&&(e["aria-label"]=n.alt),n.lang!==void 0&&(e.lang=n.lang),YK(n)){const[t]=n.children;if(t){const s=XK(t);return{...e,...s}}}}else"id"in n&&(e["aria-owns"]=n.id);return e}function kme(n){return n?{...Eme(n),...XK(n)}:null}function KK({className:n,node:e}){const t=N.useMemo(()=>kme(e),[e]),s=N.useMemo(()=>!dD(e)||YK(e)?null:e.children.map((i,r)=>a.jsx(KK,{node:i},r)),[e]);return a.jsx("span",{className:n,...t,children:s})}function Tme(){const n=cD();vs(n);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=n,[s,i]=B1(),{value:r,error:o}=s,{customTextRenderer:c,page:d}=n;function h(){r&&t&&t(r)}function u(){o&&(vr(!1,o.toString()),e&&e(o))}return N.useEffect(function(){i({type:"RESET"})},[i,d]),N.useEffect(function(){if(c||!d)return;const f=FE(d.getStructTree()),m=f;return f.promise.then(x=>{i({type:"RESOLVE",value:x})}).catch(x=>{i({type:"REJECT",error:x})}),()=>Z0(m)},[c,d,i]),N.useEffect(()=>{if(r!==void 0){if(r===!1){u();return}h()}},[r]),r?a.jsx(KK,{className:"react-pdf__Page__structTree structTree",node:r}):null}const Iz=bd;function _me(n){const e=cD();vs(e);const t={...e,...n},{_className:s,canvasBackground:i,devicePixelRatio:r=xme(),onRenderError:o,onRenderSuccess:c,page:d,renderForms:h,renderTextLayer:u,rotate:p,scale:f}=t,{canvasRef:m}=n;vs(d);const x=N.useRef(null);function g(){d&&c&&c(pO(d,f))}function b(S){bme(S)||(vr(!1,S.toString()),o&&o(S))}const y=N.useMemo(()=>d.getViewport({scale:f*r,rotation:p}),[r,d,p,f]),C=N.useMemo(()=>d.getViewport({scale:f,rotation:p}),[d,p,f]);N.useEffect(function(){if(!d)return;d.cleanup();const{current:j}=x;if(!j)return;j.width=y.width,j.height=y.height,j.style.width=`${Math.floor(C.width)}px`,j.style.height=`${Math.floor(C.height)}px`,j.style.visibility="hidden";const T={annotationMode:h?Iz.ENABLE_FORMS:Iz.ENABLE,canvas:j,canvasContext:j.getContext("2d",{alpha:!1}),viewport:y};i&&(T.background=i);const k=d.render(T),_=k;return k.promise.then(()=>{j.style.visibility="",g()}).catch(b),()=>Z0(_)},[i,d,h,y,C]);const w=N.useCallback(()=>{const{current:S}=x;S&&(S.width=0,S.height=0)},[]);return N.useEffect(()=>w,[w]),a.jsx("canvas",{className:`${s}__canvas`,dir:"ltr",ref:GK(m,x),style:{display:"block",userSelect:"none"},children:u?a.jsx(Tme,{}):null})}function Pme(n){return"str"in n}function Lme(){const n=cD();vs(n);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:s,onRenderTextLayerError:i,onRenderTextLayerSuccess:r,page:o,pageIndex:c,pageNumber:d,rotate:h,scale:u}=n;vs(o);const[p,f]=B1(),{value:m,error:x}=p,g=N.useRef(null);vr(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function b(){m&&s&&s(m)}function y(){x&&(vr(!1,x.toString()),t&&t(x))}N.useEffect(function(){f({type:"RESET"})},[o,f]),N.useEffect(function(){if(!o)return;const _=FE(o.getTextContent()),L=_;return _.promise.then(D=>{f({type:"RESOLVE",value:D})}).catch(D=>{f({type:"REJECT",error:D})}),()=>Z0(L)},[o,f]),N.useEffect(()=>{if(m!==void 0){if(m===!1){y();return}b()}},[m]);const C=N.useCallback(()=>{r&&r()},[r]),w=N.useCallback(k=>{vr(!1,k.toString()),i&&i(k)},[i]);function S(){const k=g.current;k&&k.classList.add("selecting")}function j(){const k=g.current;k&&k.classList.remove("selecting")}const T=N.useMemo(()=>o.getViewport({scale:u,rotation:h}),[o,h,u]);return N.useLayoutEffect(function(){if(!o||!m)return;const{current:_}=g;if(!_)return;_.innerHTML="";const L=o.streamTextContent({includeMarkedContent:!0}),D={container:_,textContentSource:L,viewport:T},P=new ON(D),I=P;return P.render().then(()=>{const M=document.createElement("div");M.className="endOfContent",_.append(M);const O=_.querySelectorAll('[role="presentation"]');if(e){let F=0;m.items.forEach((B,U)=>{if(!Pme(B))return;const $=O[F];if(!$)return;const G=e({pageIndex:c,pageNumber:d,itemIndex:U,...B});$.innerHTML=G,F+=B.str&&B.hasEOL?2:1})}C()}).catch(w),()=>Z0(I)},[e,w,C,o,c,d,m,T]),a.jsx("div",{className:oD("react-pdf__Page__textContent","textLayer"),onMouseUp:j,onMouseDown:S,ref:g})}const Mz=1;function Dme(n){const t={...VK(),...n},{_className:s="react-pdf__Page",_enableRegisterUnregisterPage:i=!0,canvasBackground:r,canvasRef:o,children:c,className:d,customRenderer:h,customTextRenderer:u,devicePixelRatio:p,error:f="Failed to load the page.",height:m,inputRef:x,loading:g="Loading page",noData:b="No page specified.",onGetAnnotationsError:y,onGetAnnotationsSuccess:C,onGetStructTreeError:w,onGetStructTreeSuccess:S,onGetTextError:j,onGetTextSuccess:T,onLoadError:k,onLoadSuccess:_,onRenderAnnotationLayerError:L,onRenderAnnotationLayerSuccess:D,onRenderError:P,onRenderSuccess:I,onRenderTextLayerError:M,onRenderTextLayerSuccess:O,pageIndex:F,pageNumber:B,pdf:U,registerPage:$,renderAnnotationLayer:G=!0,renderForms:ne=!1,renderMode:Z="canvas",renderTextLayer:K=!0,rotate:X,scale:V=Mz,unregisterPage:q,width:ee,...ie}=t,[Re,Ye]=B1(),{value:Le,error:te}=Re,fe=N.useRef(null);vs(U);const Ne=Dm(B)?B-1:F??null,Pe=B??(Dm(F)?F+1:null),nt=X??(Le?Le.rotate:null),gt=N.useMemo(()=>{if(!Le)return null;let pe=1;const Ue=V??Mz;if(ee||m){const Be=Le.getViewport({scale:1,rotation:nt});ee?pe=ee/Be.width:m&&(pe=m/Be.height)}return Ue*pe},[m,Le,nt,V,ee]);N.useEffect(function(){return()=>{Dm(Ne)&&i&&q&&q(Ne)}},[i,U,Ne,q]);function hs(){if(_){if(!Le||!gt)return;_(pO(Le,gt))}if(i&&$){if(!Dm(Ne)||!fe.current)return;$(Ne,fe.current)}}function qs(){te&&(vr(!1,te.toString()),k&&k(te))}N.useEffect(function(){Ye({type:"RESET"})},[Ye,U,Ne]),N.useEffect(function(){if(!U||!Pe)return;const Ue=FE(U.getPage(Pe)),Be=Ue;return Ue.promise.then(je=>{Ye({type:"RESOLVE",value:je})}).catch(je=>{Ye({type:"REJECT",error:je})}),()=>Z0(Be)},[Ye,U,Pe]),N.useEffect(()=>{if(Le!==void 0){if(Le===!1){qs();return}hs()}},[Le,gt]);const Cn=N.useMemo(()=>Dm(Ne)&&Pe&&Dm(nt)&&Dm(gt)?{_className:s,canvasBackground:r,customTextRenderer:u,devicePixelRatio:p,onGetAnnotationsError:y,onGetAnnotationsSuccess:C,onGetStructTreeError:w,onGetStructTreeSuccess:S,onGetTextError:j,onGetTextSuccess:T,onRenderAnnotationLayerError:L,onRenderAnnotationLayerSuccess:D,onRenderError:P,onRenderSuccess:I,onRenderTextLayerError:M,onRenderTextLayerSuccess:O,page:Le,pageIndex:Ne,pageNumber:Pe,renderForms:ne,renderTextLayer:K,rotate:nt,scale:gt}:null,[s,r,u,p,y,C,w,S,j,T,L,D,P,I,M,O,Le,Ne,Pe,ne,K,nt,gt]),ni=N.useMemo(()=>$K(ie,()=>Le&&(gt?pO(Le,gt):void 0)),[ie,Le,gt]),Ji=`${Ne}@${gt}/${nt}`;function Si(){switch(Z){case"custom":return vs(h),a.jsx(h,{},`${Ji}_custom`);case"none":return null;case"canvas":default:return a.jsx(_me,{canvasRef:o},`${Ji}_canvas`)}}function Ci(){return K?a.jsx(Lme,{},`${Ji}_text`):null}function ce(){return G?a.jsx(Nme,{},`${Ji}_annotations`):null}function ye(){function pe(Be){return!!(Be!=null&&Be.page)}if(!pe(Cn))throw new Error("page is undefined");const Ue=typeof c=="function"?c(Cn):c;return a.jsxs(WK.Provider,{value:Cn,children:[Si(),Ci(),ce(),Ue]})}function se(){return Pe?U===null||Le===void 0||Le===null?a.jsx(gb,{type:"loading",children:typeof g=="function"?g():g}):U===!1||Le===!1?a.jsx(gb,{type:"error",children:typeof f=="function"?f():f}):ye():a.jsx(gb,{type:"no-data",children:typeof b=="function"?b():b})}return a.jsx("div",{className:oD(s,d),"data-page-number":Pe,ref:GK(x,fe),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${gt}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:r||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...ni,children:se()})}yme();mo.workerSrc="pdf.worker.mjs";const Rme={currentSelection:null,highlights:[],activeHighlightId:null,isContextMenuOpen:!1,contextMenuPosition:{x:0,y:0},pendingAction:null,selectionHistory:[]},Hs={SET_SELECTION:"SET_SELECTION",CLEAR_SELECTION:"CLEAR_SELECTION",ADD_HIGHLIGHT:"ADD_HIGHLIGHT",REMOVE_HIGHLIGHT:"REMOVE_HIGHLIGHT",UPDATE_HIGHLIGHT:"UPDATE_HIGHLIGHT",SET_ACTIVE_HIGHLIGHT:"SET_ACTIVE_HIGHLIGHT",OPEN_CONTEXT_MENU:"OPEN_CONTEXT_MENU",CLOSE_CONTEXT_MENU:"CLOSE_CONTEXT_MENU",SET_PENDING_ACTION:"SET_PENDING_ACTION",CLEAR_PENDING_ACTION:"CLEAR_PENDING_ACTION",LOAD_HIGHLIGHTS:"LOAD_HIGHLIGHTS",ADD_TO_HISTORY:"ADD_TO_HISTORY"};function Ime(n,e){switch(e.type){case Hs.SET_SELECTION:return{...n,currentSelection:e.payload};case Hs.CLEAR_SELECTION:return{...n,currentSelection:null,isContextMenuOpen:!1};case Hs.ADD_HIGHLIGHT:return{...n,highlights:[...n.highlights,e.payload],currentSelection:null,isContextMenuOpen:!1};case Hs.REMOVE_HIGHLIGHT:return{...n,highlights:n.highlights.filter(t=>t.id!==e.payload),activeHighlightId:n.activeHighlightId===e.payload?null:n.activeHighlightId};case Hs.UPDATE_HIGHLIGHT:return{...n,highlights:n.highlights.map(t=>t.id===e.payload.id?{...t,...e.payload.updates}:t)};case Hs.SET_ACTIVE_HIGHLIGHT:return{...n,activeHighlightId:e.payload};case Hs.OPEN_CONTEXT_MENU:return{...n,isContextMenuOpen:!0,contextMenuPosition:e.payload};case Hs.CLOSE_CONTEXT_MENU:return{...n,isContextMenuOpen:!1};case Hs.SET_PENDING_ACTION:return{...n,pendingAction:e.payload};case Hs.CLEAR_PENDING_ACTION:return{...n,pendingAction:null};case Hs.LOAD_HIGHLIGHTS:return{...n,highlights:e.payload};case Hs.ADD_TO_HISTORY:{const t=[e.payload,...n.selectionHistory].slice(0,10);return{...n,selectionHistory:t}}default:return n}}const QK=N.createContext(null),Mme=({children:n,lessonId:e})=>{const[t,s]=N.useReducer(Ime,Rme);N.useEffect(()=>{if(e){const b=localStorage.getItem(`highlights_${e}`);if(b)try{const y=JSON.parse(b);s({type:Hs.LOAD_HIGHLIGHTS,payload:y})}catch(y){console.error("Failed to load highlights:",y)}}},[e]),N.useEffect(()=>{e&&t.highlights.length>0&&localStorage.setItem(`highlights_${e}`,JSON.stringify(t.highlights))},[t.highlights,e]);const i=N.useCallback(b=>{s({type:Hs.SET_SELECTION,payload:{id:E1(),...b,timestamp:new Date().toISOString(),lessonId:e}})},[e]),r=N.useCallback(()=>{s({type:Hs.CLEAR_SELECTION})},[]),o=N.useCallback((b,y="yellow")=>{const C={id:E1(),selectionId:b.id,text:b.text,pageNumber:b.pageNumber,boundingRects:b.boundingRects,color:y,createdAt:new Date().toISOString(),lessonId:e,actions:[]};return s({type:Hs.ADD_HIGHLIGHT,payload:C}),s({type:Hs.ADD_TO_HISTORY,payload:b}),C},[e]),c=N.useCallback(b=>{s({type:Hs.REMOVE_HIGHLIGHT,payload:b})},[]),d=N.useCallback((b,y)=>{s({type:Hs.UPDATE_HIGHLIGHT,payload:{id:b,updates:y}})},[]),h=N.useCallback((b,y,C)=>{const w=t.highlights.find(S=>S.id===b);w&&d(b,{actions:[...w.actions,{type:y,timestamp:new Date().toISOString(),resultId:C}]})},[t.highlights,d]),u=N.useCallback(b=>{s({type:Hs.SET_ACTIVE_HIGHLIGHT,payload:b})},[]),p=N.useCallback(b=>{s({type:Hs.OPEN_CONTEXT_MENU,payload:b})},[]),f=N.useCallback(()=>{s({type:Hs.CLOSE_CONTEXT_MENU})},[]),m=N.useCallback(b=>{s({type:Hs.SET_PENDING_ACTION,payload:b})},[]),x=N.useCallback(()=>{s({type:Hs.CLEAR_PENDING_ACTION})},[]),g={...t,setSelection:i,clearSelection:r,addHighlight:o,removeHighlight:c,updateHighlight:d,recordAction:h,setActiveHighlight:u,openContextMenu:p,closeContextMenu:f,setPendingAction:m,clearPendingAction:x};return a.jsx(QK.Provider,{value:g,children:n})},Z1=()=>{const n=N.useContext(QK);if(!n)throw new Error("useHighlightContext must be used within a HighlightProvider");return n},JK={CHAT:{id:"chat",emoji:"",label:"Ask Jeffrey",description:"Chat about this text",color:"bg-nanobanana-blue",highlightColor:"blue",xpReward:5},FLASHCARD:{id:"flashcard",emoji:"",label:"Make Flashcards",description:"Turn into study cards",color:"bg-nanobanana-yellow",highlightColor:"yellow",xpReward:15},VIDEO:{id:"video",emoji:"",label:"Explainer Video",description:"Watch and learn!",color:"bg-pink-400",highlightColor:"pink",xpReward:20,isPremium:!0},TRANSLATE:{id:"translate",emoji:"",label:"Translate",description:"Translate to another language",color:"bg-emerald-500",highlightColor:"green",xpReward:10},HIGHLIGHT:{id:"highlight",emoji:"",label:"Just Highlight",description:"Save for later",color:"bg-orange-400",highlightColor:"orange",xpReward:2},COPY:{id:"copy",emoji:"",label:"Copy Text",description:"Copy to clipboard",color:"bg-gray-400",highlightColor:null,xpReward:0}},Fz={yellow:{name:"Sunny Yellow",emoji:"",bg:"rgba(255, 235, 59, 0.4)",border:"rgba(255, 235, 59, 0.8)"},green:{name:"Grass Green",emoji:"",bg:"rgba(76, 175, 80, 0.4)",border:"rgba(76, 175, 80, 0.8)"},blue:{name:"Sky Blue",emoji:"",bg:"rgba(33, 150, 243, 0.4)",border:"rgba(33, 150, 243, 0.8)"},pink:{name:"Bubblegum Pink",emoji:"",bg:"rgba(233, 30, 99, 0.4)",border:"rgba(233, 30, 99, 0.8)"},orange:{name:"Tangerine Orange",emoji:"",bg:"rgba(255, 152, 0, 0.4)",border:"rgba(255, 152, 0, 0.8)"}},fO={chat:5,flashcard:20,video:50,translate:3,highlight:3,copy:1},mO={chat:5e3,flashcard:2e3,video:3e3,translate:2e3,highlight:1e4,copy:1/0},Fme=({highlights:n,scale:e})=>{const{activeHighlightId:t,setActiveHighlight:s}=Z1();return a.jsx("div",{className:"absolute inset-0 pointer-events-none",children:n.map(i=>a.jsx("div",{children:i.boundingRects.map((r,o)=>{var c;return a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1,scale:t===i.id?1.02:1},whileHover:{scale:1.02},style:{position:"absolute",top:r.top*e,left:r.left*e,width:r.width*e,height:r.height*e,backgroundColor:((c=Fz[i.color])==null?void 0:c.bg)||Fz.yellow.bg,borderRadius:"2px",pointerEvents:"auto",cursor:"pointer"},onMouseEnter:()=>s(i.id),onMouseLeave:()=>s(null),className:"transition-all duration-200 highlight-overlay"},`${i.id}-${o}`)})},i.id))})},Ome=({selection:n,scale:e})=>{const{openContextMenu:t,addHighlight:s}=Z1(),i=N.useMemo(()=>{var d;if(!((d=n==null?void 0:n.boundingRects)!=null&&d.length))return null;const c=n.boundingRects[0];return{top:c.top*e-50,left:(c.left+c.width/2)*e}},[n,e]);if(!i)return null;const r=()=>{s(n,"blue")},o=c=>{c.stopPropagation(),t({x:c.clientX,y:c.clientY})};return a.jsxs(R.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},transition:{type:"spring",stiffness:400,damping:25},style:{position:"absolute",top:i.top,left:i.left,transform:"translateX(-50%)"},className:"flex items-center gap-2 bg-white rounded-full border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] px-2 py-1 z-40",children:[a.jsxs(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r,className:"flex items-center gap-2 px-3 py-2 bg-nanobanana-blue text-white rounded-full font-bold text-sm",children:[a.jsx(Ru,{className:"w-4 h-4"}),"Ask Jeffrey"]}),a.jsx(R.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.95},onClick:o,className:"p-2 bg-gray-100 rounded-full border-2 border-black",title:"More options",children:a.jsx(noe,{className:"w-4 h-4"})}),a.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-4 h-4 bg-white border-r-4 border-b-4 border-black rotate-45",style:{marginBottom:"-8px"}})]})},Bme=({pageNumber:n,scale:e,lessonId:t,onTextSelected:s})=>{const i=N.useRef(null),{setSelection:r,currentSelection:o,highlights:c,openContextMenu:d}=Z1(),h=N.useCallback(()=>{var g;const m=window.getSelection(),x=m==null?void 0:m.toString().trim();if(x&&x.length>0){const y=m.getRangeAt(0).getClientRects(),C=(g=i.current)==null?void 0:g.getBoundingClientRect();if(C&&y.length>0){const w=Array.from(y).map(j=>({top:(j.top-C.top)/e,left:(j.left-C.left)/e,width:j.width/e,height:j.height/e,pageIndex:n-1})),S={text:x,pageNumber:n,boundingRects:w};r(S),s==null||s(S)}}},[n,e,r,s]),u=N.useCallback(()=>{setTimeout(()=>{h()},10)},[h]),p=N.useCallback(m=>{const x=window.getSelection();if(x==null?void 0:x.toString().trim()){h();const b=m.changedTouches[0];b&&d({x:b.clientX,y:b.clientY})}},[h,d]),f=c.filter(m=>m.pageNumber===n);return a.jsxs(R.div,{ref:i,initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-white shadow-lg rounded-lg overflow-hidden pdf-page",onMouseUp:u,onTouchEnd:p,children:[a.jsx(Dme,{pageNumber:n,scale:e,renderTextLayer:!0,renderAnnotationLayer:!1,className:"pdf-page",loading:a.jsx("div",{className:"w-full h-96 flex items-center justify-center",children:a.jsx("span",{className:"text-2xl animate-bounce",children:""})})}),a.jsx(Fme,{highlights:f,scale:e}),o&&o.pageNumber===n&&a.jsx(Ome,{selection:o,scale:e})]})},$me=({currentPage:n,numPages:e,scale:t,onPreviousPage:s,onNextPage:i,onZoomIn:r,onZoomOut:o,onPageChange:c})=>{const d=Math.round(t*100);return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border-b-4 border-black",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:s,disabled:n<=1,className:"p-2 bg-gray-100 rounded-lg border-2 border-black disabled:opacity-30 disabled:cursor-not-allowed shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[2px]","aria-label":"Previous page",children:a.jsx(X1,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex items-center gap-1 px-3 py-2 bg-nanobanana-yellow rounded-lg border-2 border-black font-bold",children:[a.jsx("input",{type:"number",value:n,onChange:h=>{const u=parseInt(h.target.value);u>=1&&u<=e&&c(u)},min:1,max:e||1,className:"w-8 text-center bg-transparent outline-none font-bold"}),a.jsx("span",{className:"text-gray-600",children:"/"}),a.jsx("span",{children:e||"?"})]}),a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:i,disabled:n>=e,className:"p-2 bg-gray-100 rounded-lg border-2 border-black disabled:opacity-30 disabled:cursor-not-allowed shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[2px]","aria-label":"Next page",children:a.jsx(No,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:o,disabled:t<=.5,className:"p-2 bg-gray-100 rounded-lg border-2 border-black disabled:opacity-30 disabled:cursor-not-allowed shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[2px]","aria-label":"Zoom out",children:a.jsx(voe,{className:"w-5 h-5"})}),a.jsxs("div",{className:"px-3 py-2 bg-white rounded-lg border-2 border-black font-bold min-w-[60px] text-center",children:[d,"%"]}),a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:r,disabled:t>=3,className:"p-2 bg-gray-100 rounded-lg border-2 border-black disabled:opacity-30 disabled:cursor-not-allowed shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[2px]","aria-label":"Zoom in",children:a.jsx(by,{className:"w-5 h-5"})})]})]})},Ume=({id:n,emoji:e,label:t,description:s,color:i,handler:r,delay:o=0,disabled:c=!1,disabledReason:d=null})=>{const[h,u]=N.useState(!1),p=async()=>{if(!c){u(!0);try{await r()}catch(f){console.error(`Error executing ${n} action:`,f)}finally{u(!1)}}};return a.jsxs(R.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:o,type:"spring",stiffness:300,damping:25},whileHover:c?{}:{scale:1.02,x:4},whileTap:c?{}:{scale:.98},onClick:p,disabled:h||c,className:`
                w-full flex items-center gap-3 p-3 rounded-xl
                border-2 border-black ${i}
                ${c?"opacity-50 cursor-not-allowed":"hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"}
                active:shadow-none active:translate-x-1 active:translate-y-1
                transition-all duration-200
                disabled:cursor-wait
                mb-2 last:mb-0
                context-menu-item
            `,title:d||"",children:[a.jsx("span",{className:"text-2xl",children:e}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsx("span",{className:"block font-bold text-sm",children:t}),a.jsx("span",{className:"block text-xs text-gray-700 opacity-80",children:d||s})]}),h&&a.jsx(R.span,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"text-lg",children:""})]})},zme=(n,e,t="free")=>{const s=JK[n.toUpperCase()];if(!s)return!1;const i=e.text.length;return!(i<fO[n]||i>mO[n]||s.isPremium&&t==="free")},Hme=(n,e,t="free")=>{const s=JK[n.toUpperCase()];if(!s)return"Unknown action";const i=e.text.length;return i<fO[n]?`Select more text! (at least ${fO[n]} characters)`:i>mO[n]?`Text is too long! (max ${mO[n]} characters)`:s.isPremium&&t==="free"?"Upgrade to Family Plus for this feature!":null},Vme=(n,e="explain")=>{const{text:t}=n,s={explain:`I found this in my lesson and I want to understand it better. Can you explain what this means using simple words and maybe a fun example I can relate to?

Here's the part I'm curious about:
"${t}"`,simplify:`This part of my lesson is a bit confusing for me. Can you break it down into smaller, easier pieces? Maybe explain it step by step so I can follow along?

Here's what I'm struggling with:
"${t}"`,examples:`I'm learning about this topic and I think some examples would help me understand better! Can you give me 2-3 fun, real-world examples that show how this works in everyday life?

Here's what I want examples about:
"${t}"`,quiz:`I've been studying this topic and I want to test myself! Can you ask me a fun question about this to see if I really understand it? Make it feel like a game, not a test!

Here's what to quiz me on:
"${t}"`,story:`I learn best through stories! Can you create a short, fun story that teaches me about this concept? Maybe with characters I can imagine or a situation I might experience?

Here's what the story should teach:
"${t}"`,translate:`I'm learning about languages! Can you show me how to say this in Spanish, French, and Arabic? For each language, please show the translation and tell me something interesting about how that language works.

Here's what I want to learn to say:
"${t}"`};return s[e]||s.explain},Gme=({position:n,selection:e,onClose:t,onSendToChat:s,onCreateFlashcards:i})=>{const r=N.useRef(null),{addHighlight:o,recordAction:c}=Z1(),{setSelection:d,handleTranslate:h,isProcessing:u}=BL(),[p,f]=N.useState(!1);N.useEffect(()=>{if(r.current){const g=r.current,b=g.getBoundingClientRect(),y=window.innerWidth,C=window.innerHeight;let w=n.x,S=n.y;b.right>y&&(w=y-b.width-20),b.bottom>C&&(S=C-b.height-20),g.style.left=`${Math.max(10,w)}px`,g.style.top=`${Math.max(10,S)}px`}},[n]);const m=[{id:"chat",icon:a.jsx(Ru,{className:"w-5 h-5"}),emoji:"",label:"Ask Jeffrey",description:"Chat about this text",color:"bg-nanobanana-blue",handler:async()=>{const g=o(e,"blue"),b=Vme(e,"explain");s==null||s(b),c(g.id,"chat"),t()}},{id:"flashcard",icon:a.jsx(zae,{className:"w-5 h-5"}),emoji:"",label:"Make Flashcards",description:"Turn into study cards",color:"bg-nanobanana-yellow",handler:async()=>{const g=o(e,"yellow");i==null||i(e.text),c(g.id,"flashcard"),t()}},{id:"video",icon:a.jsx(yoe,{className:"w-5 h-5"}),emoji:"",label:"Explainer Video",description:"Watch and learn!",color:"bg-pink-400",handler:async()=>{const g=o(e,"pink");c(g.id,"video"),t()}},{id:"translate",icon:a.jsx(WL,{className:"w-5 h-5"}),emoji:"",label:"Translate",description:"Translate to another language",color:"bg-emerald-500",handler:async()=>{d({text:e.text,context:e}),f(!0)}},{id:"highlight",icon:a.jsx(r3,{className:"w-5 h-5"}),emoji:"",label:"Just Highlight",description:"Save for later",color:"bg-orange-400",handler:()=>{o(e,"orange"),t()}},{id:"copy",icon:a.jsx(xW,{className:"w-5 h-5"}),emoji:"",label:"Copy Text",description:"Copy to clipboard",color:"bg-gray-400",handler:async()=>{await navigator.clipboard.writeText(e.text),t()}}],x=async g=>{const b=o(e,"green");await h(g),c(b.id,"translate"),f(!1),t()};return a.jsxs(a.Fragment,{children:[a.jsxs(R.div,{ref:r,initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{type:"spring",stiffness:300,damping:25},className:"fixed z-50 min-w-[240px] bg-white rounded-2xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] overflow-hidden",style:{left:n.x,top:n.y},onClick:g=>g.stopPropagation(),children:[a.jsxs("div",{className:"p-3 bg-gray-100 border-b-4 border-black",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Selected Text"}),a.jsx("button",{onClick:t,className:"p-1 hover:bg-gray-200 rounded-full transition-colors",children:a.jsx(on,{className:"w-4 h-4"})})]}),a.jsxs("p",{className:"text-sm font-medium text-gray-800 line-clamp-2",children:['"',e.text.length>100?e.text.substring(0,100)+"...":e.text,'"']})]}),a.jsx("div",{className:"p-2",children:m.map((g,b)=>{const y=zme(g.id,e),C=Hme(g.id,e);return a.jsx(Ume,{...g,delay:b*.05,disabled:!y,disabledReason:C},g.id)})}),a.jsx("div",{className:"px-3 pb-3 pt-1",children:a.jsx("p",{className:"text-xs text-gray-400 text-center italic",children:"Pick what you want to do!"})})]}),a.jsx(b3,{isOpen:p,onClose:()=>{f(!1),t()},onSelectLanguage:x,selectedText:e==null?void 0:e.text,isProcessing:u})]})};mo.workerSrc=new URL("/assets/pdf.worker.min-Cpi8b8z3.mjs",import.meta.url).toString();const RS={MIN:.5,MAX:3,DEFAULT:1,STEP:.25};mo.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${D3}/pdf.worker.min.js`;const Wme=({pdfUrl:n,lessonId:e,onTextSelected:t,onSendToChat:s,onCreateFlashcards:i,initialPage:r=1})=>{const[o,c]=N.useState(null),[d,h]=N.useState(r),[u,p]=N.useState(RS.DEFAULT),[f,m]=N.useState(!0),[x,g]=N.useState(null),b=N.useRef(null),{currentSelection:y,isContextMenuOpen:C,contextMenuPosition:w,openContextMenu:S,closeContextMenu:j}=Z1(),T=N.useCallback(({numPages:M})=>{c(M),m(!1)},[]),k=N.useCallback(M=>{g(M),m(!1),console.error("PDF load error:",M)},[]),_=N.useCallback(()=>{h(M=>Math.max(M-1,1))},[]),L=N.useCallback(()=>{h(M=>Math.min(M+1,o||M))},[o]),D=N.useCallback(()=>{p(M=>Math.min(M+RS.STEP,RS.MAX))},[]),P=N.useCallback(()=>{p(M=>Math.max(M-RS.STEP,RS.MIN))},[]),I=N.useCallback(M=>{y&&(M.preventDefault(),S({x:M.clientX,y:M.clientY}))},[y,S]);return N.useEffect(()=>{const M=()=>{C&&j()};return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[C,j]),N.useEffect(()=>{const M=O=>{O.key==="ArrowLeft"&&_(),O.key==="ArrowRight"&&L(),O.key==="Escape"&&j()};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[_,L,j]),a.jsxs("div",{ref:b,className:"relative flex flex-col h-full bg-gray-100 rounded-2xl border-4 border-black overflow-hidden",onContextMenu:I,children:[a.jsx(Ie,{children:f&&a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 flex flex-col items-center justify-center bg-white z-50",children:[a.jsx(R.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:a.jsx(nc,{className:"w-12 h-12 text-nanobanana-blue"})}),a.jsx("p",{className:"mt-4 font-comic text-lg text-gray-600",children:"Loading your lesson..."})]})}),x&&a.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white",children:[a.jsx("span",{className:"text-6xl mb-4",children:""}),a.jsx("p",{className:"font-comic text-lg text-gray-600",children:"Oops! We couldn't load this document."}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Try uploading it again!"})]}),a.jsx($me,{currentPage:d,numPages:o,scale:u,onPreviousPage:_,onNextPage:L,onZoomIn:D,onZoomOut:P,onPageChange:h}),a.jsx("div",{className:"flex-1 overflow-auto p-4",children:a.jsx(Cme,{file:n,onLoadSuccess:T,onLoadError:k,loading:null,className:"flex flex-col items-center",children:a.jsx(Bme,{pageNumber:d,scale:u,lessonId:e,onTextSelected:t})})}),a.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pointer-events-none",children:a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:_,disabled:d<=1,className:"ml-2 p-3 bg-white border-4 border-black rounded-full shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] disabled:opacity-30 disabled:cursor-not-allowed pointer-events-auto","aria-label":"Previous page",children:a.jsx(X1,{className:"w-6 h-6"})})}),a.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pointer-events-none",children:a.jsx(R.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:L,disabled:d>=o,className:"mr-2 p-3 bg-white border-4 border-black rounded-full shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] disabled:opacity-30 disabled:cursor-not-allowed pointer-events-auto","aria-label":"Next page",children:a.jsx(No,{className:"w-6 h-6"})})}),a.jsx(Ie,{children:C&&y&&a.jsx(Gme,{position:w,selection:y,onClose:j,onSendToChat:s,onCreateFlashcards:i})})]})},qme=({onSendToChat:n})=>{const{currentSelection:e,clearSelection:t,addHighlight:s}=Z1();if(!e)return null;const i=()=>{s(e,"blue"),n(e.text),t()},r=()=>{s(e,"yellow"),t()};return a.jsx(Ie,{children:a.jsxs(R.div,{initial:{opacity:0,y:20,height:0},animate:{opacity:1,y:0,height:"auto"},exit:{opacity:0,y:20,height:0},className:"mx-4 mb-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xl",children:""}),a.jsx("span",{className:"font-bold text-sm",children:"You selected:"})]}),a.jsx("button",{onClick:t,className:"p-1 hover:bg-gray-200 rounded-full transition-colors",children:a.jsx(on,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"p-3 bg-white rounded-xl border-2 border-gray-200 mb-3 max-h-24 overflow-y-auto",children:a.jsxs("p",{className:"text-sm text-gray-800 italic",children:['"',e.text.length>200?e.text.substring(0,200)+"...":e.text,'"']})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:i,className:"flex-1 flex items-center justify-center gap-2 p-3 bg-nanobanana-blue text-white font-bold rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[2px]",children:[a.jsx(AN,{className:"w-4 h-4"}),"Send to Jeffrey"]}),a.jsx(R.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:r,className:"p-3 bg-nanobanana-yellow font-bold rounded-xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[2px]",title:"Just highlight",children:a.jsx(r3,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-xs text-center text-gray-500 mt-2 italic",children:"Right-click for more options!"})]})})},Yme=()=>{var I;const{lessonId:n}=DL(),e=Qt(),[t,s]=N.useState(!1),[i,r]=N.useState(null),[o,c]=N.useState(""),[d,h]=N.useState(!1),{currentLesson:u,lessons:p,markLessonComplete:f,setCurrentLesson:m,addLesson:x}=Hu(),g=N.useRef(new Set);N.useEffect(()=>{async function M(){var F,B;if(!n)return;if(g.current.has(n)){p.find($=>$.id===n)&&(!u||u.id!==n)&&m(n);return}if(p.find(U=>U.id===n)){(!u||u.id!==n)&&m(n);return}g.current.add(n),h(!0);try{const U=await ue(`/lessons/${n}`);if(U.success&&((F=U.data)!=null&&F.lesson)){const $=U.data.lesson;x({id:$.id,title:$.title,subject:$.subject,gradeLevel:$.gradeLevel,sourceType:((B=$.sourceType)==null?void 0:B.toLowerCase())||"text",rawText:$.extractedText,formattedContent:$.formattedContent,summary:$.summary,chapters:$.chapters||[],keyConceptsForChat:$.keyConcepts||[],vocabulary:$.vocabulary||[],suggestedQuestions:$.suggestedQuestions||[],fileUrl:$.originalFileUrl,createdAt:$.createdAt,updatedAt:$.updatedAt})}}catch(U){console.error("Failed to load lesson from database:",U),e("/learn")}finally{h(!1)}}M()},[n]);const b=N.useRef(new Set);N.useEffect(()=>{if(!n||(u==null?void 0:u.id)===n||b.current.has(n))return;p.find(O=>O.id===n)&&(b.current.add(n),m(n))},[n,p,u==null?void 0:u.id,m]),N.useEffect(()=>{!n&&!u&&!d&&e("/learn")},[n,u,d,e]),l3();const{recordLessonComplete:y,recordStudyTime:C,recordChatInteraction:w}=vY(),{createDeck:S,addCards:j}=ML(),T=N.useRef(null),k=!!(u!=null&&u.fileUrl)&&((u==null?void 0:u.sourceType)==="pdf"||((I=u==null?void 0:u.fileUrl)==null?void 0:I.toLowerCase().endsWith(".pdf"))),_=N.useCallback(M=>{c(`Can you explain this? "${M}"`)},[]),L=N.useCallback(async M=>{if(!M||M.length<20)return;const O=S({name:`From PDF - ${new Date().toLocaleDateString()}`,description:"Flashcards created from PDF selection",category:"lesson",color:"yellow"});j([{front:"What does this text explain?",back:M.length>500?M.substring(0,500)+"...":M,type:"concept"}],O.id)},[S,j]);N.useEffect(()=>(T.current=Date.now(),r(Date.now()),()=>{if(T.current){const M=Math.floor((Date.now()-T.current)/6e4);M>0&&C(M)}}),[]),N.useEffect(()=>{u&&(T.current=Date.now(),r(Date.now()))},[u==null?void 0:u.id]);const D=()=>{if(u){const M=i?Math.floor((Date.now()-i)/6e4):0;f(u.id),y(u.subject||"general",M)}},P=()=>{w()};return a.jsxs(Lhe,{className:u?void 0:"bg-[#F0F8FF]",showClouds:!u,children:[a.jsx("div",{className:"absolute top-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-b-2 md:border-b-4 border-black p-2 md:p-3 z-20",children:a.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx(tpe,{layout:"compact"})}),a.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 flex-shrink-0",children:[a.jsxs(qe,{to:"/learn",className:"flex items-center gap-1.5 md:gap-2 px-2.5 md:px-3 py-1.5 md:py-2 bg-nanobanana-blue rounded-full border-2 border-black font-bold text-xs md:text-sm text-white hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-shadow",children:[a.jsx(vW,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]}),a.jsxs(qe,{to:"/learn/achievements",className:"flex items-center gap-1.5 md:gap-2 px-2.5 md:px-3 py-1.5 md:py-2 bg-nanobanana-yellow rounded-full border-2 border-black font-bold text-xs md:text-sm hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-shadow",children:[a.jsx(EN,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Progress"})]})]})]})}),a.jsx("div",{className:"pt-14 md:pt-16 flex-1 flex flex-col md:flex-row overflow-hidden",children:d?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-nanobanana-blue border-t-transparent mx-auto mb-4"}),a.jsx("p",{className:"text-lg font-medium text-gray-600",children:"Loading lesson..."})]})}):u?a.jsx(Mme,{lessonId:u.id,children:k&&u.fileUrl?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-full md:w-3/5 p-4 h-1/2 md:h-full overflow-hidden",children:a.jsx(Wme,{pdfUrl:u.fileUrl,lessonId:u.id,onTextSelected:M=>{console.log("Text selected:",M)},onSendToChat:_,onCreateFlashcards:L})}),a.jsxs("div",{className:"w-full md:w-2/5 md:border-l-4 border-t-4 md:border-t-0 border-black flex flex-col h-1/2 md:h-full",children:[a.jsx(qme,{onSendToChat:_}),a.jsx(pM,{lesson:u,onInteraction:P,initialInput:o,onInputChange:c})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-full md:w-[55%] lg:w-[60%] h-[45%] md:h-full overflow-hidden flex flex-col p-2 md:p-4",children:a.jsx(Hue,{lesson:u,onComplete:D})}),a.jsx("div",{className:"w-full md:w-[45%] lg:w-[40%] h-[55%] md:h-full overflow-hidden flex flex-col p-2 md:p-4 md:pl-0",children:a.jsx(pM,{lesson:u,onInteraction:P})})]})}):null}),u&&a.jsx(Vue,{variant:"floating",onClick:()=>s(!0)}),a.jsx(mY,{isOpen:t,onClose:()=>s(!1)})]})};function Xme(){const{badges:n,statistics:e,streak:t,currentLevel:s}=bl(),i=N.useMemo(()=>{const f=new Set(n.map(m=>m.code||m.id));return F0.map(m=>{var x,g;return{...m,unlocked:f.has(m.id),unlockedAt:((x=n.find(b=>(b.code||b.id)===m.id))==null?void 0:x.unlockedAt)||((g=n.find(b=>(b.code||b.id)===m.id))==null?void 0:g.earnedAt),progress:f.has(m.id)?100:uC(m.id,e,t)}})},[n,e,t,s]),r=N.useMemo(()=>n.length,[n]),o=N.useMemo(()=>F0.length,[]),c=N.useCallback(f=>uC(f,e,t),[e,t,s]),d=N.useCallback(()=>{const f=new Set(n.map(x=>x.code||x.id)),m=F0.filter(x=>!f.has(x.id)).map(x=>({...x,progress:uC(x.id,e,t)})).filter(x=>x.progress>0&&x.progress<100).sort((x,g)=>g.progress-x.progress);if(m.length>0){const x=m[0];return{badge:x,message:h(x)}}return null},[n,e,t,s]),h=f=>{switch(100-f.progress,f.category){case"learning":return f.id.includes("lesson")?`Complete a few more lessons to earn "${f.name}"!`:f.id.includes("flashcard")?`Review some flashcards to unlock "${f.name}"!`:`Keep learning to earn "${f.name}"!`;case"streak":return`Keep your streak going to earn "${f.name}"!`;case"mastery":return`Answer more questions correctly to unlock "${f.name}"!`;default:return`You're ${Math.round(f.progress)}% of the way to "${f.name}"!`}},u=N.useCallback(f=>{const m=Kue(f),x=new Set(n.map(g=>g.code||g.id));return m.map(g=>{var b,y;return{...g,unlocked:x.has(g.id),unlockedAt:((b=n.find(C=>(C.code||C.id)===g.id))==null?void 0:b.unlockedAt)||((y=n.find(C=>(C.code||C.id)===g.id))==null?void 0:y.earnedAt),progress:x.has(g.id)?100:uC(g.id,e,t)}})},[n,e,t,s]),p=N.useMemo(()=>{const f=new Date(Date.now()-864e5).toISOString();return n.filter(m=>{const x=m.unlockedAt||m.earnedAt;return x&&x>f})},[n]);return{badges:n,allBadgesWithStatus:i,unlockedCount:r,totalCount:o,getProgressForBadge:c,getNextBadgeSuggestion:d,getBadgesByCategoryWithStatus:u,recentlyUnlocked:p}}const Kme=()=>{N.useEffect(()=>(console.log("[AchievementsPage] MOUNTED"),()=>console.log("[AchievementsPage] UNMOUNTED")),[]);const[n,e]=N.useState("all"),{statistics:t,currentLevel:s,totalXP:i}=bl(),{unlockedCount:r,totalCount:o,getNextBadgeSuggestion:c}=Xme(),d=[{id:"all",label:"All",icon:K1},{id:"learning",label:"Learning",icon:js},{id:"streak",label:"Streaks",icon:uP},{id:"mastery",label:"Mastery",icon:Cr},{id:"special",label:"Special",icon:hm}],h=c();return a.jsxs("div",{className:"min-h-screen bg-gray-50 pb-8",children:[a.jsx("div",{className:"bg-white border-b-4 border-black p-4",children:a.jsxs("div",{className:"max-w-5xl mx-auto",children:[a.jsxs(qe,{to:"/study",className:"inline-flex items-center gap-2 text-nanobanana-blue font-bold hover:underline mb-4",children:[a.jsx(wE,{className:"w-5 h-5"}),"Back to Study"]}),a.jsx("h1",{className:"text-4xl font-black font-comic mb-2",children:"Your Progress"}),a.jsx("p",{className:"text-gray-600",children:"Keep learning to unlock more achievements!"})]})}),a.jsxs("div",{className:"max-w-5xl mx-auto px-4 mt-8 space-y-6",children:[a.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:a.jsx(WT,{showLabel:!0})}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:a.jsx(qT,{})}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:a.jsx(YT,{})})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white p-6 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[a.jsx("h2",{className:"text-xl font-bold font-comic mb-4",children:"Your Stats"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-xl border-2 border-blue-200",children:[a.jsx("div",{className:"text-3xl font-black text-nanobanana-blue",children:t.lessonsCompleted}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Lessons"})]}),a.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-xl border-2 border-green-200",children:[a.jsx("div",{className:"text-3xl font-black text-nanobanana-green",children:t.questionsAnswered}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Questions"})]}),a.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-xl border-2 border-purple-200",children:[a.jsx("div",{className:"text-3xl font-black text-purple-600",children:t.flashcardsReviewed}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Flashcards"})]}),a.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-xl border-2 border-yellow-200",children:[a.jsx("div",{className:"text-3xl font-black text-yellow-600",children:Math.round(t.totalStudyTime)}),a.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Minutes"})]})]})]}),h&&a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-gradient-to-r from-nanobanana-yellow/20 to-orange-100 p-4 rounded-2xl border-4 border-yellow-400 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"text-4xl",children:h.badge.icon}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"font-bold font-comic",children:["Next up: ",h.badge.name]}),a.jsx("p",{className:"text-sm text-gray-700",children:h.message}),a.jsx("div",{className:"mt-2 h-2 bg-gray-200 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-nanobanana-yellow",style:{width:`${h.badge.progress}%`}})})]}),a.jsxs("div",{className:"text-2xl font-black text-yellow-600",children:[Math.round(h.badge.progress),"%"]})]})}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[a.jsx("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto pb-2",children:d.map(u=>{const p=u.icon;return a.jsxs("button",{onClick:()=>e(u.id),className:`
                                        flex items-center gap-2 px-4 py-2 rounded-full border-2 font-bold whitespace-nowrap
                                        transition-all
                                        ${n===u.id?"bg-nanobanana-blue text-white border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]":"bg-white text-gray-700 border-gray-300 hover:border-black"}
                                    `,children:[a.jsx(p,{className:"w-4 h-4"}),u.label]},u.id)})}),a.jsx(Que,{category:n,showHeader:!1})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"text-center py-4",children:[a.jsxs("p",{className:"text-gray-500 font-medium",children:["You've unlocked ",a.jsx("span",{className:"font-bold text-nanobanana-blue",children:r})," of ",a.jsx("span",{className:"font-bold",children:o})," badges"]}),a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Total XP: ",i.toLocaleString()," | Level ",s]})]})]})]})},Oz=()=>{const[n,e]=N.useState(!1),[t,s]=N.useState(null),[i,r]=N.useState("all"),{decksWithDueCounts:o,totalDueCards:c,overallStats:d,getRecommendedDeck:h,deleteDeck:u}=SY(),p=g=>{s(g)},f=()=>{const g=h();g&&s(g.id)},m=g=>{window.confirm("Are you sure you want to delete this deck? All cards will be lost.")&&u(g)},x=i==="all"?o:o.filter(g=>g.category===i);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"min-h-screen bg-gray-50 pb-8",children:[a.jsx("div",{className:"bg-white border-b-4 border-black p-4",children:a.jsxs("div",{className:"max-w-5xl mx-auto",children:[a.jsxs(qe,{to:"/study",className:"inline-flex items-center gap-2 text-nanobanana-blue font-bold hover:underline mb-4",children:[a.jsx(wE,{className:"w-5 h-5"}),"Back to Study"]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-4xl font-black font-comic mb-2",children:"Flashcards"}),a.jsx("p",{className:"text-gray-600",children:"Master your lessons with spaced repetition!"})]}),a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>e(!0),className:"px-4 py-2 bg-nanobanana-yellow font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center gap-2",children:[a.jsx(rm,{className:"w-5 h-5"}),"New Deck"]})]})]})}),a.jsxs("div",{className:"max-w-5xl mx-auto px-4 mt-8 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:a.jsx(Ki,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-black",children:d.totalCards}),a.jsx("div",{className:"text-xs text-gray-500",children:"Total Cards"})]})]})}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:a.jsx(Pd,{className:"w-5 h-5 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-black",children:c}),a.jsx("div",{className:"text-xs text-gray-500",children:"Due Today"})]})]})}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:a.jsx(hm,{className:"w-5 h-5 text-green-600"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-2xl font-black",children:[d.overallAccuracy,"%"]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Accuracy"})]})]})}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:a.jsx(EN,{className:"w-5 h-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-2xl font-black",children:d.masteredCards}),a.jsx("div",{className:"text-xs text-gray-500",children:"Mastered"})]})]})})]}),c>0&&a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-gradient-to-r from-nanobanana-blue to-purple-600 p-6 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-white",children:[a.jsx("h3",{className:"font-bold font-comic text-xl mb-1",children:"Ready to Study?"}),a.jsxs("p",{className:"text-white/80 text-sm",children:["You have ",c," cards waiting for review!"]})]}),a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:f,className:"px-6 py-3 bg-white font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center gap-2",children:[a.jsx(Vu,{className:"w-5 h-5 text-nanobanana-yellow"}),"Quick Study"]})]})}),a.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[a.jsx("button",{onClick:()=>r("all"),className:`
                                px-4 py-2 rounded-full border-2 font-bold whitespace-nowrap
                                transition-all
                                ${i==="all"?"bg-black text-white border-black":"bg-white text-gray-700 border-gray-300 hover:border-black"}
                            `,children:"All Decks"}),nP.map(g=>a.jsxs("button",{onClick:()=>r(g.id),className:`
                                    px-4 py-2 rounded-full border-2 font-bold whitespace-nowrap
                                    flex items-center gap-2 transition-all
                                    ${i===g.id?"bg-black text-white border-black":"bg-white text-gray-700 border-gray-300 hover:border-black"}
                                `,children:[a.jsx("span",{children:g.icon}),g.label]},g.id))]}),x.length>0?a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.jsx(Ie,{children:x.map((g,b)=>a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},transition:{delay:b*.05},children:a.jsx(tue,{deck:g,dueCount:g.dueCount,onStudy:p,onDelete:m})},g.id))})}):a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[a.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:a.jsx(Ki,{className:"w-12 h-12 text-gray-400"})}),a.jsx("h3",{className:"font-bold font-comic text-xl mb-2 text-gray-700",children:"No Flashcard Decks Yet"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first deck or generate cards from a lesson!"}),a.jsxs(R.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>e(!0),className:"px-6 py-3 bg-nanobanana-yellow font-bold rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] inline-flex items-center gap-2",children:[a.jsx(rm,{className:"w-5 h-5"}),"Create Deck"]})]})]})]}),a.jsx(Ie,{children:t&&a.jsx(sue,{deckId:t,onClose:()=>s(null),onComplete:g=>{console.log("Session complete:",g)}})}),a.jsx(Ie,{children:n&&a.jsx(wY,{isOpen:n,onClose:()=>e(!1)})})]})},gO=[{value:"#FFD93D",label:"Sunny Yellow",emoji:""},{value:"#FF6B6B",label:"Cherry Red",emoji:""},{value:"#4ECDC4",label:"Ocean Teal",emoji:""},{value:"#95E1D3",label:"Mint Green",emoji:""},{value:"#A259FF",label:"Magic Purple",emoji:""},{value:"#5C7CFA",label:"Sky Blue",emoji:""},{value:"#FF9A9E",label:"Pink Cloud",emoji:""},{value:"#FAD961",label:"Golden Sun",emoji:""}],Qme=[{value:"dots",label:"Polka Dots",icon:""},{value:"lines",label:"Lines",icon:""},{value:"stars",label:"Stars",icon:""},{value:"hearts",label:"Hearts",icon:""},{value:"waves",label:"Waves",icon:""},{value:"confetti",label:"Confetti",icon:""},{value:"none",label:"Plain",icon:""}],ZK=[{id:"star",emoji:"",label:"Star"},{id:"heart",emoji:"",label:"Heart"},{id:"rainbow",emoji:"",label:"Rainbow"},{id:"rocket",emoji:"",label:"Rocket"},{id:"lightbulb",emoji:"",label:"Idea"},{id:"trophy",emoji:"",label:"Trophy"},{id:"pencil",emoji:"",label:"Pencil"},{id:"book",emoji:"",label:"Books"},{id:"sparkles",emoji:"",label:"Sparkles"},{id:"fire",emoji:"",label:"Fire"},{id:"brain",emoji:"",label:"Brain"},{id:"globe",emoji:"",label:"Globe"},{id:"atom",emoji:"",label:"Atom"},{id:"paint",emoji:"",label:"Art"},{id:"music",emoji:"",label:"Music"}],Jme={created:["Great note! Keep learning! ","Saved to your notebook! ","Another smart note! You're doing awesome! ","Nice work! Your notebook is growing! ","Knowledge saved! "]},al={MATH:{label:"Math",emoji:"",color:"#5C7CFA"},SCIENCE:{label:"Science",emoji:"",color:"#4ECDC4"},ENGLISH:{label:"English",emoji:"",color:"#A259FF"},ARABIC:{label:"Arabic",emoji:"",color:"#95E1D3"},ISLAMIC_STUDIES:{label:"Islamic Studies",emoji:"",color:"#FFD93D"},SOCIAL_STUDIES:{label:"Social Studies",emoji:"",color:"#FF9A9E"},ART:{label:"Art",emoji:"",color:"#FF6B6B"},MUSIC:{label:"Music",emoji:"",color:"#FAD961"},OTHER:{label:"Other",emoji:"",color:"#CCCCCC"}},Bz={color:"#FFD93D",pattern:"dots",stickers:[]},$z={young:["bold","highlight","emoji"],older:["bold","italic","underline","highlight","bulletList","emoji"]},Zme=[{value:"#FFEB3B",label:"Yellow"},{value:"#4CAF50",label:"Green"},{value:"#2196F3",label:"Blue"},{value:"#E91E63",label:"Pink"},{value:"#FF9800",label:"Orange"}],ege=({isOpen:n=!1,childName:e="My",avatarUrl:t,coverColor:s="#FFD93D",coverPattern:i="dots",coverStickers:r=[],onClick:o})=>{const c=m=>{switch(m){case"dots":return{backgroundImage:"radial-gradient(circle, rgba(255,255,255,0.4) 3px, transparent 3px)",backgroundSize:"24px 24px"};case"lines":return{backgroundImage:"repeating-linear-gradient(0deg, transparent, transparent 12px, rgba(255,255,255,0.25) 12px, rgba(255,255,255,0.25) 14px)"};case"stars":return{backgroundImage:`url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6.4-4.8-6.4 4.8 2.4-7.2-6-4.8h7.6z' fill='rgba(255,255,255,0.25)'/%3E%3C/svg%3E")`,backgroundSize:"48px 48px"};case"hearts":return{backgroundImage:`url("data:image/svg+xml,%3Csvg width='28' height='28' viewBox='0 0 28 28' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14 24.35l-1.45-1.32C6.4 17.36 3 14.28 3 10.5 3 7.42 5.42 5 8.5 5c1.74 0 3.41.81 4.5 2.09C14.09 5.81 15.76 5 17.5 5 20.58 5 23 7.42 23 10.5c0 3.78-3.4 6.86-8.55 11.54L14 24.35z' fill='rgba(255,255,255,0.25)'/%3E%3C/svg%3E")`,backgroundSize:"56px 56px"};case"waves":return{backgroundImage:`url("data:image/svg+xml,%3Csvg width='120' height='24' viewBox='0 0 120 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 12c10 0 10-8 20-8s10 8 20 8 10-8 20-8 10 8 20 8 10-8 20-8 10 8 20 8' stroke='rgba(255,255,255,0.2)' fill='none' stroke-width='2'/%3E%3C/svg%3E")`,backgroundSize:"120px 24px"};case"confetti":return{backgroundImage:`url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Crect x='15' y='8' width='6' height='12' fill='rgba(255,255,255,0.3)' transform='rotate(25 18 14)'/%3E%3Crect x='55' y='20' width='5' height='10' fill='rgba(255,255,255,0.25)' transform='rotate(-15 57.5 25)'/%3E%3Crect x='30' y='55' width='6' height='12' fill='rgba(255,255,255,0.35)' transform='rotate(40 33 61)'/%3E%3Ccircle cx='65' cy='60' r='4' fill='rgba(255,255,255,0.3)'/%3E%3Ccircle cx='20' cy='65' r='5' fill='rgba(255,255,255,0.25)'/%3E%3Ccircle cx='70' cy='15' r='3' fill='rgba(255,255,255,0.2)'/%3E%3C/svg%3E")`,backgroundSize:"80px 80px"};default:return{}}},d=m=>{const x=ZK.find(g=>g.id===m);return(x==null?void 0:x.emoji)||""},h=m=>{const x=parseInt(m.slice(1,3),16),g=parseInt(m.slice(3,5),16),b=parseInt(m.slice(5,7),16);return`rgb(${Math.max(0,x-50)}, ${Math.max(0,g-50)}, ${Math.max(0,b-50)})`},u=m=>{const x=parseInt(m.slice(1,3),16),g=parseInt(m.slice(3,5),16),b=parseInt(m.slice(5,7),16);return`rgb(${Math.min(255,x+30)}, ${Math.min(255,g+30)}, ${Math.min(255,b+30)})`},f=t&&t.startsWith("avatar_")?{avatar_1:"",avatar_2:"",avatar_3:"",avatar_4:"",avatar_5:"",avatar_6:"",avatar_7:"",avatar_8:""}[t]||"":null;return a.jsxs(R.div,{className:"relative cursor-pointer select-none",style:{width:"300px",height:"400px",perspective:"1500px",transformStyle:"preserve-3d"},onClick:o,whileHover:n?{}:{scale:1.02},children:[a.jsx("div",{className:"absolute rounded-r-lg",style:{left:"20px",top:"8px",right:"-4px",bottom:"-4px",background:"#f8f5e6",border:"3px solid #000",zIndex:-2}}),a.jsx("div",{className:"absolute rounded-r-lg",style:{left:"20px",top:"4px",right:"-2px",bottom:"-2px",background:"#faf7ea",border:"3px solid #000",zIndex:-1}}),a.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-6 rounded-l-xl",style:{background:`linear-gradient(to right, ${h(s)}, ${s})`,borderLeft:"4px solid #000",borderTop:"4px solid #000",borderBottom:"4px solid #000",zIndex:5},children:a.jsx("div",{className:"absolute inset-x-0 top-8 bottom-8 flex flex-col justify-around",children:[...Array(5)].map((m,x)=>a.jsx("div",{className:"h-1 mx-1 rounded-full",style:{background:"rgba(0,0,0,0.15)"}},x))})}),a.jsxs(R.div,{className:"absolute rounded-r-2xl overflow-hidden",style:{left:"20px",top:0,right:0,bottom:0,backgroundColor:s,border:"4px solid #000",boxShadow:n?"-8px 8px 0px 0px rgba(0,0,0,0.9)":"8px 8px 0px 0px rgba(0,0,0,1)",transformOrigin:"left center",transformStyle:"preserve-3d"},animate:n?{rotateY:-165}:{rotateY:0},transition:{type:"spring",damping:18,stiffness:80,delay:n?.1:0},children:[a.jsx("div",{className:"absolute inset-0 pointer-events-none",style:c(i)}),a.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`linear-gradient(135deg, ${u(s)} 0%, transparent 30%, transparent 70%, ${h(s)} 100%)`,opacity:.4}}),a.jsx("div",{className:"absolute left-0 top-4 bottom-4 w-8 flex flex-col justify-around items-center z-10",children:[...Array(10)].map((m,x)=>a.jsx(R.div,{initial:{scale:0,rotate:-90},animate:{scale:1,rotate:0},transition:{delay:.05*x,type:"spring",stiffness:300},children:a.jsx("div",{className:"relative",style:{width:"22px",height:"18px"},children:a.jsx("div",{className:"absolute",style:{width:"20px",height:"18px",border:"4px solid #2a2a2a",borderRadius:"50%",background:"linear-gradient(180deg, #e8e8e8 0%, #c0c0c0 50%, #d8d8d8 100%)",boxShadow:"inset 0 2px 4px rgba(255,255,255,0.5), inset 0 -2px 4px rgba(0,0,0,0.2), 2px 2px 4px rgba(0,0,0,0.3)"}})})},x))}),a.jsx(R.div,{className:"absolute top-0 right-8 w-6 z-20",style:{height:"80px",background:"linear-gradient(180deg, #ef4444 0%, #dc2626 100%)",clipPath:"polygon(0 0, 100% 0, 100% 100%, 50% 85%, 0 100%)",boxShadow:"2px 2px 4px rgba(0,0,0,0.3)"},initial:{y:-80},animate:{y:0},transition:{delay:.5,type:"spring",stiffness:100}}),a.jsxs("div",{className:"absolute inset-0 pl-12 pr-6 py-8 flex flex-col items-center justify-center",children:[a.jsx("div",{className:"absolute top-4 right-4 text-2xl opacity-60",children:""}),a.jsx("div",{className:"absolute bottom-4 left-12 text-2xl opacity-60",children:""}),a.jsxs(R.div,{className:"relative mb-6",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.3,type:"spring",stiffness:150},children:[a.jsx("div",{className:"absolute -inset-3 rounded-full",style:{background:`conic-gradient(from 0deg, ${u(s)}, white, ${s}, white, ${u(s)})`,opacity:.6}}),a.jsx("div",{className:"relative w-24 h-24 rounded-full border-4 border-black overflow-hidden flex items-center justify-center",style:{background:f||t?"white":`linear-gradient(135deg, ${u(s)}, white)`,boxShadow:"4px 4px 0px rgba(0,0,0,1), inset 0 -4px 8px rgba(0,0,0,0.1)"},children:f?a.jsx("span",{className:"text-5xl",children:f}):t?a.jsx("img",{src:t,alt:e,className:"w-full h-full object-cover"}):a.jsx("span",{className:"text-5xl",children:""})}),a.jsx(R.div,{className:"absolute -top-2 -right-2 text-xl",animate:{rotate:[0,15,-15,0],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},children:""})]}),a.jsxs(R.div,{className:"text-center relative",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[a.jsx("div",{className:"relative px-6 py-2 mb-2 rounded-full",style:{background:"rgba(255,255,255,0.9)",border:"3px solid #000",boxShadow:"3px 3px 0px rgba(0,0,0,1)"},children:a.jsxs("span",{className:"text-2xl font-black",style:{fontFamily:'"Comic Neue", cursive',color:"#000"},children:[e,"'s"]})}),a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"text-4xl font-black block",style:{fontFamily:'"Comic Neue", cursive',color:"#000",textShadow:"3px 3px 0px rgba(255,255,255,0.8), 5px 5px 0px rgba(0,0,0,0.2)",letterSpacing:"2px"},children:"NOTEBOOK"}),a.jsx(R.div,{className:"h-2 mx-auto mt-1 rounded-full",style:{background:"linear-gradient(90deg, transparent, rgba(0,0,0,0.3), transparent)",width:"80%"},initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.6}})]})]}),a.jsxs(R.div,{className:"flex items-center gap-2 mt-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},children:[a.jsx("div",{className:"w-8 h-0.5 bg-black/20 rounded-full"}),a.jsx(Cr,{size:14,className:"text-black/40",fill:"currentColor"}),a.jsx("div",{className:"w-8 h-0.5 bg-black/20 rounded-full"})]}),r.length>0&&a.jsx("div",{className:"absolute bottom-6 right-6 flex flex-wrap gap-1 max-w-[100px] justify-end",children:r.slice(0,5).map((m,x)=>a.jsx(R.span,{className:"text-3xl drop-shadow-md",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:(x-2)*8},transition:{delay:.5+x*.1,type:"spring",stiffness:200},whileHover:{scale:1.2,rotate:0},children:d(m)},m))}),r.length===0&&a.jsxs("div",{className:"absolute bottom-6 right-6 flex gap-2",children:[a.jsx(R.span,{className:"text-2xl opacity-40",animate:{y:[0,-4,0]},transition:{duration:2,repeat:1/0,delay:0},children:""}),a.jsx(R.span,{className:"text-2xl opacity-40",animate:{y:[0,-4,0]},transition:{duration:2,repeat:1/0,delay:.3},children:""})]})]}),a.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.4) 0%, transparent 40%, transparent 60%, rgba(0,0,0,0.1) 100%)"}}),a.jsx("div",{className:"absolute top-0 left-8 right-0 h-1 pointer-events-none",style:{background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent)"}})]}),!n&&a.jsx(R.div,{className:"absolute -bottom-10 left-0 right-0 text-center",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:1.2},children:a.jsxs(R.span,{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/90 rounded-full text-sm font-bold text-gray-600 border-2 border-black",style:{boxShadow:"2px 2px 0px rgba(0,0,0,1)"},animate:{y:[0,-3,0]},transition:{duration:1.5,repeat:1/0},children:[a.jsx(js,{size:16}),"Tap to open"]})})]})},eQ=({initialTitle:n="",initialContent:e="",ageGroup:t="OLDER",onTitleChange:s,onContentChange:i,placeholder:r="Write your note here...",autoFocus:o=!1})=>{const[c,d]=N.useState(n),[h,u]=N.useState(!1),[p,f]=N.useState(!1),m=N.useRef(null),x=["","","","","","","","","","","",""],g=t==="YOUNG"?$z.young:$z.older,b=N.useCallback((T,k=null)=>{var _;document.execCommand(T,!1,k),(_=m.current)==null||_.focus()},[]),y=T=>{const k=T.target.value;d(k),s==null||s(k)},C=()=>{var k;const T=((k=m.current)==null?void 0:k.innerHTML)||"";i==null||i(T)},w=T=>{b("backColor",T),u(!1)},S=T=>{b("insertText",T),f(!1)},j=({icon:T,command:k,value:_,label:L,onClick:D,isActive:P})=>a.jsx(R.button,{type:"button",className:`p-2 rounded-lg border-2 border-black transition-colors ${P?"bg-black text-white":"bg-white hover:bg-gray-100"}`,style:{boxShadow:"2px 2px 0px rgba(0,0,0,1)"},whileHover:{scale:1.05},whileTap:{scale:.95,boxShadow:"1px 1px 0px rgba(0,0,0,1)"},onClick:D||(()=>b(k,_)),title:L,children:a.jsx(T,{size:18})});return a.jsxs("div",{className:"w-full",children:[a.jsx("input",{type:"text",value:c,onChange:y,placeholder:"Give your note a title...",className:"w-full text-xl font-bold px-4 py-3 rounded-xl border-3 border-black bg-white mb-4 focus:outline-none focus:ring-2 focus:ring-yellow-400",style:{fontFamily:'"Comic Neue", cursive',boxShadow:"3px 3px 0px rgba(0,0,0,1)"},maxLength:255,autoFocus:o}),a.jsxs("div",{className:"flex flex-wrap gap-2 mb-3 p-2 bg-gray-50 rounded-xl border-2 border-gray-200",children:[g.includes("bold")&&a.jsx(j,{icon:Bae,command:"bold",label:"Bold"}),g.includes("italic")&&a.jsx(j,{icon:Jae,command:"italic",label:"Italic"}),g.includes("underline")&&a.jsx(j,{icon:xoe,command:"underline",label:"Underline"}),g.includes("highlight")&&a.jsxs("div",{className:"relative",children:[a.jsx(j,{icon:r3,label:"Highlight",onClick:()=>u(!h)}),h&&a.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute top-full left-0 mt-2 p-2 bg-white rounded-xl border-3 border-black z-10 flex gap-2",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},children:Zme.map(T=>a.jsx("button",{type:"button",className:"w-8 h-8 rounded-full border-2 border-black hover:scale-110 transition-transform",style:{backgroundColor:T.value},onClick:()=>w(T.value),title:T.label},T.value))})]}),g.includes("bulletList")&&a.jsx(j,{icon:wW,command:"insertUnorderedList",label:"Bullet List"}),g.includes("emoji")&&a.jsxs("div",{className:"relative",children:[a.jsx(j,{icon:foe,label:"Emoji",onClick:()=>f(!p)}),p&&a.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute top-full left-0 mt-2 p-3 bg-white rounded-xl border-3 border-black z-10",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)",width:"200px"},children:a.jsx("div",{className:"grid grid-cols-6 gap-1",children:x.map(T=>a.jsx("button",{type:"button",className:"text-xl p-1 hover:bg-gray-100 rounded transition-colors",onClick:()=>S(T),children:T},T))})})]})]}),a.jsx("div",{ref:m,contentEditable:!0,onInput:C,dangerouslySetInnerHTML:{__html:e},className:"w-full min-h-[200px] max-h-[400px] overflow-y-auto p-4 rounded-xl border-3 border-black bg-white focus:outline-none focus:ring-2 focus:ring-yellow-400",style:{fontFamily:'"Comic Neue", cursive',fontSize:t==="YOUNG"?"1.125rem":"1rem",lineHeight:"1.6",boxShadow:"3px 3px 0px rgba(0,0,0,1)",background:"#fffef0"},"data-placeholder":r,suppressContentEditableWarning:!0}),t==="YOUNG"&&a.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Use the buttons above to make your note pretty! "}),a.jsx("style",{children:`
        [contenteditable]:empty:before {
          content: attr(data-placeholder);
          color: #9ca3af;
          pointer-events: none;
        }
        [contenteditable] ul {
          list-style-type: disc;
          margin-left: 20px;
        }
      `})]})},tge=({color:n,pattern:e,stickers:t=[],onColorChange:s,onPatternChange:i,onStickersChange:r})=>{const o=c=>{t.includes(c)?r(t.filter(d=>d!==c)):t.length<4&&r([...t,c])};return a.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-xl border-2 border-gray-200",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-bold mb-2 flex items-center gap-2",children:[a.jsx("span",{children:""})," Cover Color"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:gO.map(c=>a.jsx(R.button,{type:"button",className:"relative w-10 h-10 rounded-full border-3 border-black transition-transform",style:{backgroundColor:c.value},whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>s(c.value),title:c.label,children:n===c.value&&a.jsx(R.div,{className:"absolute inset-0 flex items-center justify-center",initial:{scale:0},animate:{scale:1},children:a.jsx(bo,{size:20,className:"text-black drop-shadow-lg",strokeWidth:3})})},c.value))})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-bold mb-2 flex items-center gap-2",children:[a.jsx("span",{children:""})," Pattern"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Qme.map(c=>a.jsxs(R.button,{type:"button",className:`px-3 py-2 rounded-lg border-2 border-black text-sm font-medium transition-colors ${e===c.value?"bg-black text-white":"bg-white hover:bg-gray-100"}`,style:{boxShadow:"2px 2px 0px rgba(0,0,0,1)"},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>i(c.value),children:[c.icon," ",c.label]},c.value))})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-bold mb-2 flex items-center gap-2",children:[a.jsx("span",{children:""})," Stickers",a.jsx("span",{className:"text-xs font-normal text-gray-500",children:"(Choose up to 4)"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:ZK.map(c=>{const d=t.includes(c.id),h=!d&&t.length>=4;return a.jsx(R.button,{type:"button",className:`p-2 text-xl rounded-lg border-2 transition-all ${d?"border-black bg-yellow-100":h?"border-gray-200 opacity-50 cursor-not-allowed":"border-gray-300 hover:border-black bg-white"}`,style:{boxShadow:d?"2px 2px 0px rgba(0,0,0,1)":"none"},whileHover:h?{}:{scale:1.1},whileTap:h?{}:{scale:.95},onClick:()=>!h&&o(c.id),title:c.label,disabled:h,children:c.emoji},c.id)})})]})]})},sge=()=>{const{isNotebookModalOpen:n,pendingNoteData:e,closeNotebookModal:t,createNote:s,isSaving:i}=y5(),{currentProfile:r}=Vt(),{earnXP:o}=bl(),[c,d]=N.useState(!1),[h,u]=N.useState(!1),[p,f]=N.useState(""),[m,x]=N.useState(""),[g,b]=N.useState(Bz),[y,C]=N.useState(!1),[w,S]=N.useState(""),j=(r==null?void 0:r.displayName)||"My",T=r==null?void 0:r.avatarUrl,k=(r==null?void 0:r.ageGroup)||"OLDER";N.useEffect(()=>{if(n&&e){x(e.originalText||"");const I=(e.originalText||"").split(" ").slice(0,5).join(" ");f(I.length>30?I.substring(0,30)+"...":I)}},[n,e]),N.useEffect(()=>{n||(d(!1),u(!1),f(""),x(""),b(Bz),C(!1),S(""))},[n]),N.useEffect(()=>{if(n&&!c){const I=setTimeout(()=>d(!0),800);return()=>clearTimeout(I)}},[n]);const _=N.useCallback(async()=>{if(!p.trim()){S("Please add a title to your note");return}if(!m.trim()){S("Please add some content to your note");return}S("");const I={title:p.trim(),content:m,originalText:e==null?void 0:e.originalText,lessonId:e==null?void 0:e.lessonId,subject:e==null?void 0:e.subject,contentFormat:"RICH_TEXT",coverColor:g.color,coverStickers:g.stickers,coverPattern:g.pattern},M=await s(I);M.success?(C(!0),M.xpAwarded&&o&&o(M.xpAwarded,"Created a note"),setTimeout(()=>{t()},1500)):S(M.error||"Failed to save note")},[p,m,g,e,s,o,t]),L=()=>{c||d(!0)},D=()=>{const I=e==null?void 0:e.subject;if(!I)return null;const M=al[I];return M?a.jsxs(R.span,{className:"inline-flex items-center gap-1.5 px-4 py-1.5 rounded-full text-sm font-bold border-3 border-black",style:{backgroundColor:M.color,boxShadow:"2px 2px 0px rgba(0,0,0,1)"},initial:{scale:0},animate:{scale:1},transition:{delay:.5,type:"spring"},children:[a.jsx("span",{className:"text-lg",children:M.emoji}),M.label]}):null},P=()=>{const I=Jme.created;return I[Math.floor(Math.random()*I.length)]};return n?a.jsx(Ie,{children:n&&a.jsxs(R.div,{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[a.jsx(R.div,{className:"absolute inset-0",style:{background:"linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(20,20,40,0.9) 100%)",backdropFilter:"blur(8px)"},onClick:t,children:[...Array(6)].map((I,M)=>a.jsx(R.div,{className:"absolute text-4xl opacity-10",style:{left:`${15+M*15}%`,top:`${10+M%3*30}%`},animate:{y:[0,-20,0],rotate:[0,10,-10,0]},transition:{duration:4+M,repeat:1/0,ease:"easeInOut"},children:["","","","","",""][M]},M))}),a.jsxs(R.div,{className:"relative z-10 w-full max-w-5xl",initial:{scale:.8,opacity:0,y:50},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:50},transition:{type:"spring",damping:25,stiffness:300},children:[a.jsx(R.button,{className:"absolute -top-3 -right-3 z-30 w-14 h-14 rounded-full bg-gradient-to-br from-red-400 to-red-600 border-4 border-black flex items-center justify-center text-white",style:{boxShadow:"4px 4px 0px rgba(0,0,0,1)"},whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:t,children:a.jsx(on,{size:28,strokeWidth:3})}),a.jsxs("div",{className:"flex gap-8 items-start justify-center",children:[a.jsx(R.div,{className:"flex-shrink-0",initial:{x:-100,opacity:0,rotateY:20},animate:{x:0,opacity:1,rotateY:0},transition:{delay:.2,type:"spring",stiffness:100},children:a.jsx(ege,{isOpen:c,childName:j,avatarUrl:T,coverColor:g.color,coverPattern:g.pattern,coverStickers:g.stickers,onClick:L})}),a.jsx(Ie,{children:c&&a.jsx(R.div,{className:"flex-1 max-w-xl",initial:{opacity:0,x:100,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:100,scale:.9},transition:{delay:.3,type:"spring",stiffness:150},children:y?a.jsxs(R.div,{className:"bg-gradient-to-br from-white to-green-50 rounded-3xl border-4 border-black p-10 text-center",style:{boxShadow:"8px 8px 0px rgba(0,0,0,1)"},initial:{scale:.8,rotateZ:-5},animate:{scale:1,rotateZ:0},transition:{type:"spring",stiffness:200},children:[[...Array(12)].map((I,M)=>a.jsx(R.div,{className:"absolute text-2xl",style:{left:`${20+Math.random()*60}%`,top:`${20+Math.random()*60}%`},initial:{scale:0,rotate:0},animate:{scale:[0,1,0],rotate:[0,360],y:[0,-50,50]},transition:{delay:M*.1,duration:1},children:["","","","","",""][M%6]},M)),a.jsx(R.div,{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-green-400 to-emerald-500 border-4 border-black flex items-center justify-center",style:{boxShadow:"4px 4px 0px rgba(0,0,0,1)"},initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.2,type:"spring",stiffness:200},children:a.jsx(bo,{size:50,className:"text-white",strokeWidth:3})}),a.jsx(R.h3,{className:"text-3xl font-black mb-3",style:{fontFamily:'"Comic Neue", cursive'},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:"Note Saved! "}),a.jsx(R.p,{className:"text-xl text-gray-600 mb-6",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:P()}),a.jsxs(R.div,{className:"inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-amber-300 to-yellow-400 rounded-full border-3 border-black",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:.6,type:"spring"},children:[a.jsx(Ut,{size:24,className:"text-amber-700"}),a.jsx("span",{className:"text-xl font-black",children:"+5 XP"})]})]}):a.jsxs("div",{className:"relative bg-gradient-to-br from-white via-white to-amber-50 rounded-3xl border-4 border-black overflow-hidden",style:{boxShadow:"8px 8px 0px rgba(0,0,0,1)"},children:[a.jsxs("div",{className:"relative px-6 py-4 border-b-4 border-black",style:{background:`linear-gradient(135deg, ${g.color}88 0%, ${g.color}44 100%)`},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(R.div,{className:"w-10 h-10 rounded-full bg-white border-3 border-black flex items-center justify-center",style:{boxShadow:"2px 2px 0px rgba(0,0,0,1)"},animate:{rotate:[0,-5,5,0]},transition:{duration:2,repeat:1/0},children:a.jsx(a3,{size:20,className:"text-gray-700"})}),a.jsx("h2",{className:"text-2xl font-black",style:{fontFamily:'"Comic Neue", cursive'},children:"Add to Notebook"})]}),D()]}),(e==null?void 0:e.lessonTitle)&&a.jsxs(R.div,{className:"mt-3 flex items-center gap-2 text-sm text-gray-700 bg-white/60 rounded-full px-4 py-1.5 w-fit",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6},children:[a.jsx(js,{size:14}),a.jsx("span",{children:"From:"}),a.jsx("span",{className:"font-bold",children:e.lessonTitle})]})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs(R.button,{type:"button",className:"flex items-center gap-2 mb-4 px-4 py-2 bg-white border-2 border-black rounded-full hover:bg-gray-50 transition-colors",style:{boxShadow:"2px 2px 0px rgba(0,0,0,1)"},onClick:()=>u(!h),whileHover:{scale:1.02},whileTap:{scale:.98},children:[a.jsx(SW,{size:18,className:"text-purple-600"}),a.jsx("span",{className:"font-bold text-sm",children:"Customize Cover"}),h?a.jsx(CE,{size:16}):a.jsx(SE,{size:16})]}),a.jsx(Ie,{children:h&&a.jsx(R.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mb-4",children:a.jsx("div",{className:"p-4 bg-gray-50 rounded-2xl border-2 border-gray-200",children:a.jsx(tge,{color:g.color,pattern:g.pattern,stickers:g.stickers,onColorChange:I=>b(M=>({...M,color:I})),onPatternChange:I=>b(M=>({...M,pattern:I})),onStickersChange:I=>b(M=>({...M,stickers:I}))})})})}),a.jsx("div",{className:"bg-white rounded-2xl border-3 border-gray-200 overflow-hidden",children:a.jsx(eQ,{initialTitle:p,initialContent:m,ageGroup:k,onTitleChange:f,onContentChange:x,placeholder:"Write your thoughts about this..."})}),a.jsx(Ie,{children:w&&a.jsxs(R.div,{className:"mt-4 p-3 bg-red-50 border-2 border-red-200 rounded-xl flex items-center gap-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[a.jsx("span",{className:"text-red-500 text-lg",children:""}),a.jsx("span",{className:"text-red-600 font-medium",children:w})]})}),a.jsx(R.button,{className:"w-full mt-5 py-4 px-6 bg-gradient-to-r from-green-400 to-emerald-500 text-white font-black text-xl rounded-2xl border-4 border-black disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3",style:{boxShadow:"5px 5px 0px rgba(0,0,0,1)"},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98,boxShadow:"2px 2px 0px rgba(0,0,0,1)",y:2},onClick:_,disabled:i,children:i?a.jsxs(a.Fragment,{children:[a.jsx(R.span,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"text-2xl",children:""}),a.jsx("span",{children:"Saving..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(Ut,{size:24}),a.jsx("span",{children:"Save to Notebook"}),a.jsx("span",{className:"text-green-200",children:"+5 XP"})]})})]})]})})})]})]})]})}):null},xO=["","","","","","","","","",""],nge=()=>a.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}),ige=()=>a.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-12 flex flex-col justify-center gap-4 z-10",children:[...Array(12)].map((n,e)=>a.jsx(R.div,{className:"w-6 h-6 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 border-2 border-gray-500 shadow-inner ml-3",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:e*.03,type:"spring",stiffness:200},style:{boxShadow:"inset 2px 2px 4px rgba(0,0,0,0.3), 0 2px 4px rgba(0,0,0,0.2)"}},e))}),rge=({subject:n,isActive:e,onClick:t,index:s,totalTabs:i})=>{const r=n==="all"?{emoji:"",label:"All Notes"}:al[n]||{emoji:"",label:n},o=["from-rose-400 to-pink-500","from-amber-400 to-orange-500","from-emerald-400 to-teal-500","from-sky-400 to-blue-500","from-violet-400 to-purple-500","from-lime-400 to-green-500"],c=n==="all"?"from-gray-700 to-gray-900":o[s%o.length];return a.jsxs(R.button,{onClick:t,className:`relative px-5 py-3 rounded-t-2xl font-bold text-sm transition-all flex items-center gap-2 ${e?"text-white z-20 -mb-1":"text-gray-600 hover:text-gray-900 bg-white/50 hover:bg-white/80 z-10"}`,style:{transformOrigin:"bottom",...e&&{background:"linear-gradient(135deg, var(--tw-gradient-from), var(--tw-gradient-to))"}},initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:s*.05},whileHover:{y:e?0:-4},whileTap:{scale:.98},children:[e&&a.jsx(R.div,{className:`absolute inset-0 rounded-t-2xl bg-gradient-to-br ${c}`,layoutId:"activeTab",style:{boxShadow:"0 -4px 20px rgba(0,0,0,0.15)"}}),a.jsx("span",{className:"relative z-10 text-lg",children:r.emoji}),a.jsx("span",{className:"relative z-10 hidden sm:inline",children:r.label})]})},age=({note:n,isSelected:e,onClick:t,index:s})=>{const i=al[n.subject]||al.OTHER,r=(s%5-2)*.5,o=[{bg:"from-yellow-100 to-amber-50",border:"border-amber-200"},{bg:"from-pink-100 to-rose-50",border:"border-rose-200"},{bg:"from-blue-100 to-sky-50",border:"border-sky-200"},{bg:"from-green-100 to-emerald-50",border:"border-emerald-200"},{bg:"from-purple-100 to-violet-50",border:"border-violet-200"}],c=o[s%o.length];return a.jsxs(R.div,{onClick:t,className:"relative cursor-pointer group",initial:{opacity:0,y:30,rotate:r},animate:{opacity:1,y:0,rotate:r},exit:{opacity:0,scale:.8,rotate:r*2},transition:{delay:s*.05,type:"spring",stiffness:200},whileHover:{y:-8,rotate:0,scale:1.02,transition:{type:"spring",stiffness:300}},style:{transformOrigin:"center top"},children:[a.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-16 h-6 bg-gradient-to-b from-amber-200/80 to-amber-300/60 rotate-[-2deg] z-10",style:{clipPath:"polygon(5% 0%, 95% 0%, 100% 100%, 0% 100%)",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}}),n.isPinned&&a.jsx(R.div,{className:"absolute -top-2 -right-2 z-20",initial:{scale:0,rotate:-45},animate:{scale:1,rotate:0},children:a.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-red-400 to-red-600 flex items-center justify-center shadow-lg border-2 border-red-300",children:a.jsx(NW,{size:14,className:"text-white"})})}),a.jsxs("div",{className:`relative p-5 rounded-lg bg-gradient-to-br ${c.bg} ${c.border} border-2 overflow-hidden ${e?"ring-4 ring-amber-400 ring-offset-2":""}`,style:{boxShadow:e?"8px 8px 0px rgba(0,0,0,0.15), 0 20px 40px rgba(0,0,0,0.1)":"4px 4px 0px rgba(0,0,0,0.1), 0 10px 20px rgba(0,0,0,0.05)",minHeight:"180px"},children:[a.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none",children:[...Array(8)].map((d,h)=>a.jsx("div",{className:"h-px bg-blue-300 w-full",style:{marginTop:`${24+h*24}px`}},h))}),a.jsxs(R.div,{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold mb-3 shadow-sm",style:{backgroundColor:i.color},whileHover:{scale:1.05},children:[a.jsx("span",{children:i.emoji}),a.jsx("span",{className:"text-gray-800",children:i.label})]}),a.jsx("h3",{className:"font-bold text-lg mb-2 text-gray-800 line-clamp-2 relative z-10",style:{fontFamily:'"Comic Neue", cursive'},children:n.title}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-3 mb-4 relative z-10",children:n.content.replace(/<[^>]*>/g,"")}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-auto relative z-10",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(s3,{size:12}),new Date(n.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),n.lesson&&a.jsxs("span",{className:"flex items-center gap-1 truncate max-w-[120px]",children:[a.jsx(fW,{size:12}),n.lesson.title]})]}),a.jsx(R.div,{className:"absolute top-2 right-2 text-2xl opacity-0 group-hover:opacity-100",initial:!1,animate:{rotate:[0,-10,10,0]},transition:{duration:.5,repeat:1/0,repeatDelay:1},children:xO[s%xO.length]})]})]})},oge=({searchQuery:n,activeSubject:e})=>{var t;return a.jsxs(R.div,{className:"text-center py-16 px-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[a.jsxs(R.div,{className:"relative w-32 h-32 mx-auto mb-6",animate:{y:[0,-10,0],rotate:[0,2,-2,0]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-200 to-orange-300 rounded-2xl rotate-3 border-4 border-black"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-yellow-100 to-amber-200 rounded-2xl -rotate-2 border-4 border-black flex items-center justify-center",children:a.jsx("span",{className:"text-5xl",children:""})}),a.jsx(R.div,{className:"absolute -top-4 -right-4 text-3xl",animate:{rotate:[0,20,0],scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},children:""})]}),a.jsx("h3",{className:"text-2xl font-bold mb-3 text-gray-800",style:{fontFamily:'"Comic Neue", cursive'},children:n?"No matching notes found!":e!=="all"?`No ${((t=al[e])==null?void 0:t.label)||e} notes yet!`:"Your notebook is empty!"}),a.jsx("p",{className:"text-gray-600 max-w-md mx-auto mb-6",children:n?"Try a different search term":'Start taking notes while studying your lessons. Highlight any text and click "Add to Notes" to save it here!'}),a.jsx("div",{className:"flex justify-center gap-3",children:["","","","",""].map((s,i)=>a.jsx(R.span,{className:"text-2xl",animate:{y:[0,-5,0]},transition:{delay:i*.1,duration:1,repeat:1/0},children:s},i))})]})},lge=()=>{const n=Qt(),{currentProfile:e}=Vt(),{notes:t,notesBySubject:s,isLoading:i,isInitialized:r,activeSubject:o,setActiveSubject:c,getFilteredNotes:d,getAvailableSubjects:h,deleteNote:u,updateNote:p,toggleNotePin:f,fetchNotes:m}=y5(),[x,g]=N.useState(""),[b,y]=N.useState(null),[C,w]=N.useState(!1),[S,j]=N.useState(""),[T,k]=N.useState(""),[_,L]=N.useState(null),D=(e==null?void 0:e.displayName)||"My",P=(e==null?void 0:e.ageGroup)||"OLDER",I=e==null?void 0:e.avatarUrl;N.useEffect(()=>{r||m()},[r,m]);const M=d().filter(Z=>{if(!x)return!0;const K=x.toLowerCase();return Z.title.toLowerCase().includes(K)||Z.content.toLowerCase().includes(K)}),O=["all",...h()],F=Z=>{y(Z),w(!1)},B=()=>{j(b.title),k(b.content),w(!0)},U=async()=>{if(!S.trim())return;await p(b.id,{title:S.trim(),content:T}),w(!1);const Z=t.find(K=>K.id===b.id);Z&&y(Z)},$=async Z=>{await u(Z),L(null),(b==null?void 0:b.id)===Z&&y(null)},G=async Z=>{await f(Z)},ne=()=>I&&I.startsWith("avatar_")&&{avatar_1:"",avatar_2:"",avatar_3:"",avatar_4:"",avatar_5:"",avatar_6:"",avatar_7:"",avatar_8:""}[I]||"";return a.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-100"}),a.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((Z,K)=>a.jsx(R.div,{className:"absolute text-6xl opacity-10",style:{left:`${10+K*15}%`,top:`${5+K*12}%`},animate:{y:[0,-20,0],rotate:[0,10,-10,0]},transition:{duration:6+K,repeat:1/0,ease:"easeInOut"},children:xO[K]},K))}),a.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto p-4 md:p-6 lg:p-8",children:[a.jsxs(R.div,{className:"flex items-center justify-between mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(R.button,{className:"p-3 rounded-2xl bg-white/80 backdrop-blur border-3 border-black hover:bg-white transition-colors",style:{boxShadow:"4px 4px 0px rgba(0,0,0,1)"},whileHover:{scale:1.05,x:-2},whileTap:{scale:.95},onClick:()=>n("/learn"),children:a.jsx(wE,{size:24})}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(R.div,{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-300 to-orange-400 border-3 border-black flex items-center justify-center text-2xl",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},whileHover:{rotate:[0,-5,5,0]},transition:{duration:.3},children:ne()}),a.jsxs("div",{children:[a.jsxs(R.h1,{className:"text-3xl md:text-4xl font-black text-gray-900",style:{fontFamily:'"Comic Neue", cursive'},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},children:[D,"'s Notebook"]}),a.jsxs(R.p,{className:"text-gray-600 flex items-center gap-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[a.jsx(Ut,{size:16,className:"text-amber-500"}),t.length," ",t.length===1?"note":"notes"," saved"]})]})]})]}),a.jsxs(R.div,{className:"relative hidden md:block",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},children:[a.jsx(D1,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",size:20}),a.jsx("input",{type:"text",placeholder:"Search your notes...",value:x,onChange:Z=>g(Z.target.value),className:"pl-12 pr-5 py-3 w-72 rounded-2xl border-3 border-black bg-white/90 backdrop-blur focus:outline-none focus:ring-4 focus:ring-amber-300 transition-shadow",style:{boxShadow:"4px 4px 0px rgba(0,0,0,1)"}})]})]}),a.jsxs(R.div,{className:"relative bg-white/95 backdrop-blur rounded-3xl border-4 border-black overflow-hidden",style:{boxShadow:"8px 8px 0px rgba(0,0,0,1), 0 20px 60px rgba(0,0,0,0.15)",minHeight:"70vh"},initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.3,type:"spring",stiffness:100},children:[a.jsx(nge,{}),a.jsx(ige,{}),a.jsx("div",{className:"relative ml-12 pl-4 pt-4 flex gap-1 overflow-x-auto pb-0 border-b-4 border-black bg-gradient-to-b from-gray-100 to-transparent",children:O.map((Z,K)=>a.jsx(rge,{subject:Z,isActive:o===Z,onClick:()=>c(Z),index:K,totalTabs:O.length},Z))}),a.jsx("div",{className:"ml-12 p-6 md:p-8",children:i?a.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[a.jsx(R.div,{className:"text-6xl mb-4",animate:{rotate:[0,360],scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"linear"},children:""}),a.jsx("p",{className:"text-gray-600 font-medium",children:"Loading your notes..."})]}):M.length===0?a.jsx(oge,{searchQuery:x,activeSubject:o}):a.jsxs("div",{className:"flex gap-8",children:[a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:a.jsx(Ie,{mode:"popLayout",children:M.map((Z,K)=>a.jsx(age,{note:Z,isSelected:(b==null?void 0:b.id)===Z.id,onClick:()=>F(Z),index:K},Z.id))})})}),a.jsx(Ie,{children:b&&a.jsx(R.div,{className:"hidden xl:block w-96 flex-shrink-0",initial:{opacity:0,x:50,scale:.95},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:50,scale:.95},children:a.jsxs("div",{className:"sticky top-6 bg-gradient-to-br from-white to-amber-50 rounded-2xl border-4 border-black overflow-hidden",style:{boxShadow:"6px 6px 0px rgba(0,0,0,1)"},children:[a.jsxs("div",{className:"p-4 border-b-3 border-black bg-gradient-to-r from-amber-100 to-orange-100 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(a3,{size:20,className:"text-amber-600"}),a.jsx("h3",{className:"font-bold text-gray-800",children:"Note Details"})]}),a.jsx("button",{className:"p-2 hover:bg-white/50 rounded-xl transition-colors",onClick:()=>y(null),children:a.jsx(on,{size:18})})]}),a.jsx("div",{className:"p-5 max-h-[60vh] overflow-y-auto",children:C?a.jsxs("div",{className:"space-y-4",children:[a.jsx(eQ,{initialTitle:S,initialContent:T,ageGroup:P,onTitleChange:j,onContentChange:k,autoFocus:!0}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(R.button,{className:"flex-1 py-2.5 px-4 bg-gradient-to-r from-emerald-400 to-green-500 text-white font-bold rounded-xl border-3 border-black",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:U,children:"Save Changes"}),a.jsx(R.button,{className:"py-2.5 px-4 bg-gray-100 font-bold rounded-xl border-3 border-black",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>w(!1),children:"Cancel"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-bold mb-4",style:{backgroundColor:(al[b.subject]||al.OTHER).color},children:[a.jsx("span",{children:(al[b.subject]||al.OTHER).emoji}),a.jsx("span",{children:(al[b.subject]||al.OTHER).label})]}),a.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-800",style:{fontFamily:'"Comic Neue", cursive'},children:b.title}),a.jsx("div",{className:"prose prose-sm max-w-none mb-5 p-4 bg-yellow-50/50 rounded-xl border-2 border-amber-200",style:{fontFamily:'"Comic Neue", cursive'},dangerouslySetInnerHTML:{__html:b.content}}),b.originalText&&a.jsxs("div",{className:"mb-5 p-3 bg-blue-50 rounded-xl border-2 border-blue-200",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1 flex items-center gap-1",children:[a.jsx($ae,{size:12}),"Original highlight:"]}),a.jsxs("p",{className:"text-sm italic text-gray-600",children:['"',b.originalText,'"']})]}),b.lesson&&a.jsxs("div",{className:"mb-5 p-3 bg-purple-50 rounded-xl border-2 border-purple-200",children:[a.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"From lesson:"}),a.jsxs("p",{className:"font-medium flex items-center gap-2 text-gray-700",children:[a.jsx(fW,{size:16,className:"text-purple-500"}),b.lesson.title]})]}),a.jsxs("p",{className:"text-sm text-gray-500 mb-5 flex items-center gap-2",children:[a.jsx(s3,{size:14}),new Date(b.createdAt).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsxs(R.button,{className:"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-400 to-indigo-500 text-white font-bold rounded-xl border-2 border-black text-sm",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:B,children:[a.jsx(roe,{size:16}),"Edit"]}),a.jsxs(R.button,{className:`flex items-center gap-2 px-4 py-2.5 font-bold rounded-xl border-2 border-black text-sm ${b.isPinned?"bg-gradient-to-r from-amber-300 to-yellow-400":"bg-white"}`,style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>G(b.id),children:[a.jsx(NW,{size:16}),b.isPinned?"Pinned!":"Pin"]}),a.jsxs(R.button,{className:"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-red-400 to-rose-500 text-white font-bold rounded-xl border-2 border-black text-sm",style:{boxShadow:"3px 3px 0px rgba(0,0,0,1)"},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>L(b.id),children:[a.jsx(um,{size:16}),"Delete"]})]})]})})]})})})]})})]})]}),a.jsx(Ie,{children:_&&a.jsx(R.div,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a.jsxs(R.div,{className:"bg-white p-8 rounded-3xl border-4 border-black max-w-sm w-full",style:{boxShadow:"8px 8px 0px rgba(0,0,0,1)"},initial:{scale:.8,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:20},children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx(R.div,{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-red-100 to-rose-200 flex items-center justify-center border-4 border-black",animate:{rotate:[0,-5,5,0]},transition:{duration:.5,repeat:1/0},children:a.jsx(um,{size:32,className:"text-red-500"})}),a.jsx("h3",{className:"text-2xl font-bold mb-2",style:{fontFamily:'"Comic Neue", cursive'},children:"Delete this note?"}),a.jsx("p",{className:"text-gray-600",children:"This cannot be undone. Your note will be gone forever!"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(R.button,{className:"flex-1 py-3 px-4 bg-gray-100 font-bold rounded-xl border-3 border-black",style:{boxShadow:"4px 4px 0px rgba(0,0,0,1)"},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>L(null),children:"Keep it!"}),a.jsx(R.button,{className:"flex-1 py-3 px-4 bg-gradient-to-r from-red-400 to-rose-500 text-white font-bold rounded-xl border-3 border-black",style:{boxShadow:"4px 4px 0px rgba(0,0,0,1)"},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>$(_),children:"Delete it"})]})]})})})]})},Ud={EMAIL:"email",CODE:"code",NEW_PASSWORD:"new_password",SUCCESS:"success"},tQ=({isOpen:n,onClose:e})=>{const[t,s]=N.useState(Ud.EMAIL),[i,r]=N.useState(""),[o,c]=N.useState(""),[d,h]=N.useState(""),[u,p]=N.useState(""),[f,m]=N.useState(""),[x,g]=N.useState(!1),b=()=>{s(Ud.EMAIL),r(""),c(""),h(""),p(""),m("")},y=()=>{b(),e()},C=async T=>{if(T.preventDefault(),m(""),!i){m("Please enter your email address");return}g(!0);try{await xr.requestPasswordReset(i),s(Ud.CODE)}catch(k){m(k.message||"Failed to send reset code")}finally{g(!1)}},w=async T=>{if(T.preventDefault(),m(""),!o||o.length!==6){m("Please enter the 6-digit code");return}g(!0);try{await xr.verifyResetCode(i,o),s(Ud.NEW_PASSWORD)}catch(k){m(k.message||"Invalid code")}finally{g(!1)}},S=async T=>{if(T.preventDefault(),m(""),d.length<8){m("Password must be at least 8 characters");return}const k=/[A-Z]/.test(d),_=/[a-z]/.test(d),L=/[0-9]/.test(d);if(!k||!_||!L){m("Password must contain uppercase, lowercase, and number");return}if(d!==u){m("Passwords do not match");return}g(!0);try{await xr.resetPassword(i,d),s(Ud.SUCCESS)}catch(D){m(D.message||"Failed to reset password")}finally{g(!1)}},j=async()=>{m(""),g(!0);try{await xr.requestPasswordReset(i),m("")}catch(T){m(T.message||"Failed to resend code")}finally{g(!1)}};return n?a.jsx("div",{className:"modal-overlay",onClick:y,children:a.jsxs("div",{className:"modal-content",onClick:T=>T.stopPropagation(),children:[a.jsx("button",{className:"modal-close",onClick:y,"aria-label":"Close",children:""}),t===Ud.EMAIL&&a.jsxs("div",{className:"forgot-password-step",children:[a.jsx("h2",{children:"Forgot Password?"}),a.jsx("p",{className:"subtitle",children:"Enter your email and we'll send you a code to reset your password."}),f&&a.jsx("div",{className:"error-message",children:f}),a.jsxs("form",{onSubmit:C,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Email Address"}),a.jsx("input",{type:"email",className:"form-input",placeholder:"parent@example.com",value:i,onChange:T=>r(T.target.value),autoComplete:"email",autoFocus:!0})]}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Sending...":"Send Reset Code"})]})]}),t===Ud.CODE&&a.jsxs("div",{className:"forgot-password-step",children:[a.jsx("h2",{children:"Enter Code"}),a.jsxs("p",{className:"subtitle",children:["We sent a 6-digit code to ",a.jsx("strong",{children:i})]}),f&&a.jsx("div",{className:"error-message",children:f}),a.jsxs("form",{onSubmit:w,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Verification Code"}),a.jsx("input",{type:"text",className:"form-input code-input",placeholder:"000000",value:o,onChange:T=>c(T.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,autoFocus:!0})]}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Verifying...":"Verify Code"})]}),a.jsxs("div",{className:"resend-section",children:[a.jsx("p",{children:"Didn't receive the code?"}),a.jsx("button",{type:"button",className:"link-btn",onClick:j,disabled:x,children:"Resend Code"})]})]}),t===Ud.NEW_PASSWORD&&a.jsxs("div",{className:"forgot-password-step",children:[a.jsx("h2",{children:"Set New Password"}),a.jsx("p",{className:"subtitle",children:"Create a strong password for your account."}),f&&a.jsx("div",{className:"error-message",children:f}),a.jsxs("form",{onSubmit:S,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"New Password"}),a.jsx("input",{type:"password",className:"form-input",placeholder:"Create a strong password",value:d,onChange:T=>h(T.target.value),autoComplete:"new-password",autoFocus:!0}),a.jsx("div",{className:"form-hint",children:"At least 8 characters with uppercase, lowercase, and number"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Confirm Password"}),a.jsx("input",{type:"password",className:"form-input",placeholder:"Confirm your password",value:u,onChange:T=>p(T.target.value),autoComplete:"new-password"})]}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Resetting...":"Reset Password"})]})]}),t===Ud.SUCCESS&&a.jsxs("div",{className:"forgot-password-step success-step",children:[a.jsx("div",{className:"success-icon",children:""}),a.jsx("h2",{children:"Password Reset!"}),a.jsx("p",{className:"subtitle",children:"Your password has been reset successfully. You can now sign in with your new password."}),a.jsx("button",{className:"btn btn-primary",onClick:y,children:"Back to Sign In"})]}),a.jsx("style",{children:`
          .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
          }

          .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 420px;
            width: 100%;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
          }

          .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
          }

          .modal-close:hover {
            background: #f0f0f0;
          }

          .forgot-password-step h2 {
            margin: 0 0 8px;
            font-size: 1.5rem;
            color: #1a1a1a;
          }

          .forgot-password-step .subtitle {
            color: #666;
            margin: 0 0 24px;
            font-size: 0.9375rem;
          }

          .error-message {
            background: #fff2f2;
            border: 1px solid #ffcccc;
            color: #cc0000;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.875rem;
          }

          .form-group {
            margin-bottom: 16px;
          }

          .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
            font-size: 0.875rem;
          }

          .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
            box-sizing: border-box;
          }

          .form-input:focus {
            outline: none;
            border-color: #4a90d9;
          }

          .code-input {
            font-size: 1.5rem;
            letter-spacing: 0.5rem;
            text-align: center;
            font-family: monospace;
          }

          .form-hint {
            font-size: 0.8125rem;
            color: #888;
            margin-top: 6px;
          }

          .btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
          }

          .btn-primary {
            background: #4a90d9;
            color: white;
          }

          .btn-primary:hover:not(:disabled) {
            background: #3a7bc8;
          }

          .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
          }

          .resend-section {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
          }

          .resend-section p {
            margin: 0 0 8px;
            color: #666;
            font-size: 0.875rem;
          }

          .link-btn {
            background: none;
            border: none;
            color: #4a90d9;
            font-size: 0.875rem;
            cursor: pointer;
            text-decoration: underline;
          }

          .link-btn:hover {
            color: #3a7bc8;
          }

          .link-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
          }

          .success-step {
            text-align: center;
          }

          .success-icon {
            width: 64px;
            height: 64px;
            background: #22c55e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 32px;
            font-weight: bold;
          }

          @media (max-width: 480px) {
            .modal-content {
              padding: 24px;
            }
          }
        `})]})}):null},Uz=({isSignIn:n=!1,onComplete:e,onSwitchToSignIn:t,onSwitchToSignUp:s})=>{const{signUp:i,signIn:r,isLoading:o}=Vt(),[c,d]=N.useState(!1),[h,u]=N.useState({email:"",password:"",confirmPassword:"",firstName:"",lastName:""}),[p,f]=N.useState({}),[m,x]=N.useState(""),g=()=>{const C={},w=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;if(h.email?w.test(h.email)||(C.email="Please enter a valid email address"):C.email="Email is required",!h.password)C.password="Password is required";else if(h.password.length<8)C.password="Password must be at least 8 characters";else if(!n){const S=/[A-Z]/.test(h.password),j=/[a-z]/.test(h.password),T=/[0-9]/.test(h.password);(!S||!j||!T)&&(C.password="Password must contain uppercase, lowercase, and number")}return!n&&h.password!==h.confirmPassword&&(C.confirmPassword="Passwords do not match"),f(C),Object.keys(C).length===0},b=C=>{const{name:w,value:S}=C.target;u(j=>({...j,[w]:S})),p[w]&&f(j=>({...j,[w]:""})),x("")},y=async C=>{if(C.preventDefault(),!!g()){x("");try{n?(await r(h.email,h.password),e==null||e()):(await i(h.email,h.password,h.firstName,h.lastName),e==null||e(h.email))}catch(w){x(w.message||`Failed to ${n?"sign in":"sign up"}`)}}};return a.jsxs("div",{className:"signup-step",children:[a.jsxs("div",{className:"step-header",children:[a.jsx("h2",{children:n?"Welcome Back!":"Create Your Account"}),a.jsx("p",{className:"subtitle",children:n?"Sign in to continue learning with Jeffrey":"Join OrbitLearn and help your child learn with Jeffrey"})]}),m&&a.jsx("div",{className:"error-message",children:m}),a.jsxs("form",{onSubmit:y,noValidate:!0,children:[!n&&a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"First Name"}),a.jsx("input",{type:"text",name:"firstName",className:`form-input ${p.firstName?"error":""}`,placeholder:"Your first name",value:h.firstName,onChange:b})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Last Name"}),a.jsx("input",{type:"text",name:"lastName",className:`form-input ${p.lastName?"error":""}`,placeholder:"Your last name",value:h.lastName,onChange:b})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Email Address"}),a.jsx("input",{type:"email",name:"email",className:`form-input ${p.email?"error":""}`,placeholder:"parent@example.com",value:h.email,onChange:b,autoComplete:"email"}),p.email&&a.jsx("div",{className:"form-error",children:p.email})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Password"}),a.jsx("input",{type:"password",name:"password",className:`form-input ${p.password?"error":""}`,placeholder:n?"Your password":"Create a strong password",value:h.password,onChange:b,autoComplete:n?"current-password":"new-password"}),p.password&&a.jsx("div",{className:"form-error",children:p.password}),!n&&!p.password&&a.jsx("div",{className:"form-hint",children:"At least 8 characters with uppercase, lowercase, and number"})]}),!n&&a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Confirm Password"}),a.jsx("input",{type:"password",name:"confirmPassword",className:`form-input ${p.confirmPassword?"error":""}`,placeholder:"Confirm your password",value:h.confirmPassword,onChange:b,autoComplete:"new-password"}),p.confirmPassword&&a.jsx("div",{className:"form-error",children:p.confirmPassword})]}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),n?"Signing in...":"Creating account..."]}):n?"Sign In":"Create Account"})]}),a.jsx("div",{className:"divider",children:a.jsx("span",{children:"or"})}),a.jsx("div",{className:"auth-switch",children:n?a.jsxs("p",{children:["Don't have an account?"," ",a.jsx("button",{type:"button",className:"link-btn",onClick:s,children:"Sign up"})]}):a.jsxs("p",{children:["Already have an account?"," ",a.jsx("button",{type:"button",className:"link-btn",onClick:t,children:"Sign in"})]})}),n&&a.jsx("div",{className:"forgot-password",children:a.jsx("button",{type:"button",className:"link-btn",onClick:()=>d(!0),children:"Forgot your password?"})}),a.jsx(tQ,{isOpen:c,onClose:()=>d(!1)}),a.jsx("style",{children:`
        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }

        .auth-switch {
          text-align: center;
          font-size: 0.9375rem;
          color: #666;
        }

        .auth-switch p {
          margin: 0;
        }

        .forgot-password {
          text-align: center;
          margin-top: 12px;
        }

        @media (max-width: 480px) {
          .form-row {
            grid-template-columns: 1fr;
          }
        }
      `})]})},cge=({onVerified:n,email:e})=>{const{verifyEmail:t}=Vt(),[s,i]=N.useState(["","","","","",""]),[r,o]=N.useState(!1),[c,d]=N.useState(!1),[h,u]=N.useState(0),[p,f]=N.useState(""),[m,x]=N.useState(""),g=N.useRef([]);N.useEffect(()=>{g.current[0]&&g.current[0].focus()},[]),N.useEffect(()=>{if(h>0){const T=setInterval(()=>{u(k=>k-1)},1e3);return()=>clearInterval(T)}},[h]);const b=(T,k)=>{var L;if(k&&!/^\d$/.test(k))return;const _=[...s];_[T]=k,i(_),x(""),k&&T<5&&((L=g.current[T+1])==null||L.focus()),k&&T===5&&_.every(D=>D!=="")&&w(_.join(""))},y=(T,k)=>{var _;k.key==="Backspace"&&!s[T]&&T>0&&((_=g.current[T-1])==null||_.focus())},C=T=>{var D;T.preventDefault();const k=T.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(k))return;const _=[...s];for(let P=0;P<k.length&&P<6;P++)_[P]=k[P];i(_),x("");const L=_.findIndex(P=>!P);L!==-1?(D=g.current[L])==null||D.focus():w(_.join(""))},w=async T=>{var k,_;if(!e){x("Email not found. Please go back and try again.");return}o(!0),x("");try{const L=await t(e,T);L.success?(f("Email verified successfully!"),setTimeout(()=>{n==null||n()},1e3)):(x(L.error||"Invalid verification code. Please try again."),i(["","","","","",""]),(k=g.current[0])==null||k.focus())}catch(L){x(L.message||"Verification failed. Please try again."),i(["","","","","",""]),(_=g.current[0])==null||_.focus()}finally{o(!1)}},S=async()=>{var T;if(!(h>0||!e)){d(!0),f(""),x("");try{const k=await xr.resendVerificationEmail(e);k.success?(f("A new verification code has been sent to your email."),u(60),i(["","","","","",""]),(T=g.current[0])==null||T.focus()):x(k.error||"Failed to resend code. Please try again.")}catch(k){x(k.message||"Failed to resend code. Please try again.")}finally{d(!1)}}},j=()=>{const T=s.join("");T.length===6?w(T):x("Please enter all 6 digits.")};return a.jsxs("div",{className:"email-verification-step",children:[a.jsxs("div",{className:"step-header",children:[a.jsx("div",{className:"verification-icon",children:a.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"40",cy:"40",r:"40",fill:"#E3F2FD"}),a.jsx("path",{d:"M56 28H24C22.9 28 22 28.9 22 30V50C22 51.1 22.9 52 24 52H56C57.1 52 58 51.1 58 50V30C58 28.9 57.1 28 56 28Z",stroke:"#2196F3",strokeWidth:"2",fill:"white"}),a.jsx("path",{d:"M58 30L40 42L22 30",stroke:"#2196F3",strokeWidth:"2",fill:"none"}),a.jsx("circle",{cx:"54",cy:"26",r:"8",fill:"#4CAF50"}),a.jsx("path",{d:"M51 26L53 28L57 24",stroke:"white",strokeWidth:"2",fill:"none"})]})}),a.jsx("h2",{children:"Verify Your Email"}),a.jsx("p",{className:"subtitle",children:"We've sent a 6-digit verification code to:"}),a.jsx("p",{className:"email-display",children:e||"your@email.com"})]}),a.jsxs("div",{className:"otp-container",children:[a.jsx("p",{className:"otp-label",children:"Enter verification code"}),a.jsx("div",{className:"otp-inputs",children:s.map((T,k)=>a.jsx("input",{ref:_=>g.current[k]=_,type:"text",inputMode:"numeric",maxLength:1,value:T,onChange:_=>b(k,_.target.value),onKeyDown:_=>y(k,_),onPaste:k===0?C:void 0,className:`otp-input ${m?"otp-input-error":""}`,disabled:r,autoComplete:"one-time-code"},k))}),m&&a.jsx("p",{className:"error-message",children:m}),p&&a.jsx("p",{className:"success-message",children:p})]}),a.jsx("button",{type:"button",className:"btn btn-primary verify-btn",onClick:j,disabled:r||s.some(T=>!T),children:r?"Verifying...":"Verify Email"}),a.jsxs("div",{className:"verification-actions",children:[a.jsxs("p",{className:"resend-text",children:["Didn't receive the code?"," ",a.jsx("button",{type:"button",className:"link-btn",onClick:S,disabled:c||h>0,children:c?"Sending...":h>0?`Resend in ${h}s`:"Resend code"})]}),a.jsxs("div",{className:"email-tips",children:[a.jsx("h4",{children:"Can't find the email?"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Check your spam or junk folder"}),a.jsx("li",{children:"Make sure you entered the correct email"}),a.jsx("li",{children:"Add support@orbitlearn.app to your contacts"})]})]})]}),a.jsx("style",{children:`
        .email-verification-step {
          text-align: center;
        }

        .verification-icon {
          margin-bottom: 16px;
        }

        .email-display {
          font-size: 1.125rem;
          font-weight: 600;
          color: #2196f3;
          margin: 8px 0 24px;
        }

        .otp-container {
          margin-bottom: 24px;
        }

        .otp-label {
          font-size: 0.9375rem;
          color: #666;
          margin-bottom: 12px;
        }

        .otp-inputs {
          display: flex;
          justify-content: center;
          gap: 8px;
        }

        .otp-input {
          width: 48px;
          height: 56px;
          text-align: center;
          font-size: 1.5rem;
          font-weight: 600;
          border: 2px solid #e0e0e0;
          border-radius: 12px;
          outline: none;
          transition: border-color 0.2s, box-shadow 0.2s;
        }

        .otp-input:focus {
          border-color: #2196f3;
          box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .otp-input-error {
          border-color: #f44336;
        }

        .otp-input:disabled {
          background: #f5f5f5;
          color: #999;
        }

        .verify-btn {
          width: 100%;
          padding: 14px 24px;
          font-size: 1rem;
          margin-bottom: 24px;
        }

        .verification-actions {
          text-align: center;
        }

        .resend-text {
          font-size: 0.9375rem;
          color: #666;
          margin-bottom: 20px;
        }

        .link-btn {
          background: none;
          border: none;
          color: #2196f3;
          font-weight: 600;
          cursor: pointer;
          padding: 0;
        }

        .link-btn:hover:not(:disabled) {
          text-decoration: underline;
        }

        .link-btn:disabled {
          color: #999;
          cursor: not-allowed;
        }

        .error-message {
          color: #f44336;
          font-size: 0.875rem;
          margin-top: 12px;
        }

        .success-message {
          color: #4caf50;
          font-size: 0.875rem;
          margin-top: 12px;
        }

        .email-tips {
          background: #fff3e0;
          border-radius: 12px;
          padding: 16px;
          text-align: left;
        }

        .email-tips h4 {
          font-size: 0.875rem;
          font-weight: 600;
          color: #e65100;
          margin: 0 0 8px;
        }

        .email-tips ul {
          margin: 0;
          padding-left: 20px;
        }

        .email-tips li {
          font-size: 0.8125rem;
          color: #666;
          margin-bottom: 4px;
        }

        .email-tips li:last-child {
          margin-bottom: 0;
        }

        @media (max-width: 480px) {
          .otp-input {
            width: 42px;
            height: 50px;
            font-size: 1.25rem;
          }
        }
      `})]})},JC={getConsentStatus:async()=>ue("/auth/consent/status",{method:"GET"}),initiateCreditCardConsent:async()=>ue("/auth/consent/initiate-cc",{method:"POST"}),verifyCreditCard:async({paymentIntentId:n})=>ue("/auth/consent/verify-cc",{method:"POST",body:JSON.stringify({paymentIntentId:n})}),getKBQQuestions:async()=>ue("/auth/consent/kbq/questions",{method:"GET"}),setupKBQ:async({answers:n})=>ue("/auth/consent/kbq/setup",{method:"POST",body:JSON.stringify({answers:n})}),verifyKBQ:async({answers:n})=>ue("/auth/consent/kbq/verify",{method:"POST",body:JSON.stringify({answers:n})})},dge=({onMethodSelected:n})=>{const{user:e}=Vt(),[t,s]=N.useState(!1),[i,r]=N.useState(null),[o,c]=N.useState(""),d=async h=>{var u;if(e){r(h),s(!0),c("");try{if(h==="credit_card"){const p=await JC.initiateCreditCardConsent();p.success&&((u=p.data)!=null&&u.clientSecret)?n==null||n(h,p.data.clientSecret):c(p.error||"Failed to initiate verification")}else n==null||n(h,null)}catch(p){c(p.message||"An error occurred")}finally{s(!1),r(null)}}};return a.jsxs("div",{className:"consent-method-step",children:[a.jsxs("div",{className:"step-header",children:[a.jsx("div",{className:"consent-icon",children:a.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"32",cy:"32",r:"32",fill:"#E8F5E9"}),a.jsx("path",{d:"M32 14C23.163 14 16 21.163 16 30V38C16 39.1 16.9 40 18 40H22C23.1 40 24 39.1 24 38V30C24 25.58 27.58 22 32 22C36.42 22 40 25.58 40 30V38C40 39.1 40.9 40 42 40H46C47.1 40 48 39.1 48 38V30C48 21.163 40.837 14 32 14Z",stroke:"#4CAF50",strokeWidth:"2",fill:"white"}),a.jsx("rect",{x:"20",y:"36",width:"24",height:"16",rx:"2",fill:"#4CAF50"}),a.jsx("circle",{cx:"32",cy:"44",r:"2",fill:"white"}),a.jsx("path",{d:"M32 46V50",stroke:"white",strokeWidth:"2"})]})}),a.jsx("h2",{children:"Verify Parental Consent"}),a.jsx("p",{className:"subtitle",children:"To comply with COPPA and ensure child safety, we need to verify that you're an adult parent or guardian."})]}),o&&a.jsx("div",{className:"error-message",children:o}),a.jsxs("div",{className:"method-options",children:[a.jsxs("button",{type:"button",className:`method-card ${i==="credit_card"?"selected":""}`,onClick:()=>d("credit_card"),disabled:t,children:[a.jsx("div",{className:"method-icon",children:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("rect",{x:"4",y:"10",width:"40",height:"28",rx:"4",fill:"#E3F2FD",stroke:"#2196F3",strokeWidth:"2"}),a.jsx("rect",{x:"4",y:"16",width:"40",height:"8",fill:"#2196F3"}),a.jsx("rect",{x:"8",y:"30",width:"16",height:"4",rx:"2",fill:"#BBDEFB"}),a.jsx("rect",{x:"28",y:"30",width:"8",height:"4",rx:"2",fill:"#BBDEFB"})]})}),a.jsxs("div",{className:"method-content",children:[a.jsx("h3",{children:"Credit Card Verification"}),a.jsx("p",{className:"method-description",children:"We'll charge $0.50 to your card and immediately refund it. This verifies you have a valid payment method."}),a.jsxs("ul",{className:"method-benefits",children:[a.jsx("li",{children:"Instant verification"}),a.jsx("li",{children:"Immediate platform access"}),a.jsx("li",{children:"Full refund within 5-7 days"}),a.jsx("li",{children:"Secure payment via Stripe"})]})]}),a.jsx("div",{className:"method-badge recommended",children:"Recommended"}),t&&i==="credit_card"&&a.jsx("div",{className:"method-loading",children:a.jsx("span",{className:"loading-spinner"})})]}),a.jsxs("button",{type:"button",className:`method-card ${i==="kbq"?"selected":""}`,onClick:()=>d("kbq"),disabled:t,children:[a.jsx("div",{className:"method-icon",children:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"#FFF3E0",stroke:"#FF9800",strokeWidth:"2"}),a.jsx("text",{x:"24",y:"32",fontSize:"24",fontWeight:"bold",fill:"#FF9800",textAnchor:"middle",children:"?"})]})}),a.jsxs("div",{className:"method-content",children:[a.jsx("h3",{children:"Knowledge-Based Questions"}),a.jsx("p",{className:"method-description",children:"Answer 5 questions that only an adult would know. Takes about 2 minutes."}),a.jsxs("ul",{className:"method-benefits",children:[a.jsx("li",{children:"No payment required"}),a.jsx("li",{children:"Quick and simple"}),a.jsx("li",{children:"3 attempts allowed"}),a.jsx("li",{children:"Privacy-focused"})]})]}),a.jsx("div",{className:"method-badge",children:"Free Option"}),t&&i==="kbq"&&a.jsx("div",{className:"method-loading",children:a.jsx("span",{className:"loading-spinner"})})]})]}),a.jsxs("div",{className:"consent-info",children:[a.jsx("div",{className:"info-icon",children:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"10",cy:"10",r:"9",stroke:"#2196F3",strokeWidth:"2"}),a.jsx("path",{d:"M10 5V6",stroke:"#2196F3",strokeWidth:"2",strokeLinecap:"round"}),a.jsx("path",{d:"M10 9V15",stroke:"#2196F3",strokeWidth:"2",strokeLinecap:"round"})]})}),a.jsxs("div",{className:"info-content",children:[a.jsx("strong",{children:"Why do we need this?"}),a.jsx("p",{children:"Under the Children's Online Privacy Protection Act (COPPA), we must obtain verifiable parental consent before collecting information from children under 13. Your information is encrypted and secure."})]})]}),a.jsx("style",{children:`
        .consent-method-step {
          text-align: center;
        }

        .consent-icon {
          margin-bottom: 16px;
        }

        .method-options {
          display: flex;
          flex-direction: column;
          gap: 16px;
          margin-bottom: 24px;
        }

        .method-card {
          background: white;
          border: 2px solid #e0e0e0;
          border-radius: 16px;
          padding: 20px;
          cursor: pointer;
          transition: all 0.2s ease;
          text-align: left;
          position: relative;
          overflow: hidden;
        }

        .method-card:hover:not(:disabled) {
          border-color: #ffc107;
          box-shadow: 0 4px 16px rgba(255, 193, 7, 0.2);
        }

        .method-card.selected {
          border-color: #ffc107;
          background: #fffde7;
        }

        .method-card:disabled {
          opacity: 0.7;
          cursor: not-allowed;
        }

        .method-icon {
          margin-bottom: 12px;
        }

        .method-content h3 {
          font-size: 1.125rem;
          font-weight: 600;
          color: #333;
          margin: 0 0 8px;
        }

        .method-description {
          font-size: 0.9375rem;
          color: #666;
          margin: 0 0 12px;
        }

        .method-benefits {
          list-style: none;
          padding: 0;
          margin: 0;
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 6px;
        }

        .method-benefits li {
          font-size: 0.8125rem;
          color: #4caf50;
          display: flex;
          align-items: center;
          gap: 4px;
        }

        .method-benefits li::before {
          content: '';
          font-weight: bold;
        }

        .method-badge {
          position: absolute;
          top: 12px;
          right: 12px;
          padding: 4px 10px;
          border-radius: 20px;
          font-size: 0.6875rem;
          font-weight: 600;
          text-transform: uppercase;
          background: #e0e0e0;
          color: #666;
        }

        .method-badge.recommended {
          background: linear-gradient(135deg, #ffc107, #ff9800);
          color: white;
        }

        .method-loading {
          position: absolute;
          inset: 0;
          background: rgba(255, 255, 255, 0.9);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .method-loading .loading-spinner {
          width: 32px;
          height: 32px;
          border: 3px solid #e0e0e0;
          border-top-color: #ffc107;
        }

        .consent-info {
          display: flex;
          gap: 12px;
          background: #e3f2fd;
          border-radius: 12px;
          padding: 16px;
          text-align: left;
        }

        .info-icon {
          flex-shrink: 0;
        }

        .info-content {
          font-size: 0.8125rem;
          color: #1565c0;
        }

        .info-content strong {
          display: block;
          margin-bottom: 4px;
        }

        .info-content p {
          margin: 0;
          line-height: 1.5;
        }

        @media (max-width: 480px) {
          .method-benefits {
            grid-template-columns: 1fr;
          }
        }
      `})]})},hge=({consentId:n,onVerified:e,onBack:t})=>{const{updateConsentStatus:s}=Vt(),[i,r]=N.useState(!1),[o,c]=N.useState(""),[d,h]=N.useState("form"),[u,p]=N.useState({number:"",expiry:"",cvc:"",name:""}),f=g=>{const{name:b,value:y}=g.target;let C=y;b==="number"?C=y.replace(/\s/g,"").replace(/(\d{4})/g,"$1 ").trim().slice(0,19):b==="expiry"?C=y.replace(/\D/g,"").replace(/(\d{2})(\d)/,"$1/$2").slice(0,5):b==="cvc"&&(C=y.replace(/\D/g,"").slice(0,4)),p(w=>({...w,[b]:C}))},m=()=>u.number.replace(/\s/g,"").length<15?(c("Please enter a valid card number"),!1):u.expiry.length!==5?(c("Please enter a valid expiry date"),!1):u.cvc.length<3?(c("Please enter a valid CVC"),!1):u.name.length<2?(c("Please enter the cardholder name"),!1):!0,x=async g=>{if(g.preventDefault(),!!m()){c(""),r(!0),h("processing");try{const b=await JC.verifyCreditCard({paymentIntentId:n});if(b.success)h("success"),s("verified"),setTimeout(()=>{e==null||e()},2e3);else throw new Error(b.error||"Verification failed")}catch(b){c(b.message||"Payment verification failed"),h("form")}finally{r(!1)}}};return d==="success"?a.jsxs("div",{className:"cc-step cc-success",children:[a.jsx("div",{className:"success-animation",children:a.jsxs("svg",{width:"100",height:"100",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"#E8F5E9",stroke:"#4CAF50",strokeWidth:"3"}),a.jsx("path",{d:"M30 50L45 65L70 35",stroke:"#4CAF50",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})}),a.jsx("h2",{children:"Verification Successful!"}),a.jsx("p",{className:"success-text",children:"Your parental consent has been verified. The $0.50 charge will be refunded to your card within 5-7 business days."}),a.jsx("p",{className:"redirect-text",children:"Continuing to profile setup..."})]}):d==="processing"?a.jsxs("div",{className:"cc-step cc-processing",children:[a.jsx("div",{className:"processing-animation",children:a.jsx("div",{className:"spinner-large"})}),a.jsx("h2",{children:"Processing Payment"}),a.jsx("p",{className:"processing-text",children:"Please wait while we verify your payment..."}),a.jsxs("p",{className:"secure-text",children:[a.jsx("span",{className:"lock-icon",children:""}),"Your payment is secure and encrypted"]})]}):a.jsxs("div",{className:"cc-step cc-form",children:[a.jsxs("div",{className:"step-header",children:[a.jsx("h2",{children:"Credit Card Verification"}),a.jsx("p",{className:"subtitle",children:"Enter your card details. We'll charge $0.50 and immediately refund it."})]}),a.jsxs("div",{className:"amount-badge",children:[a.jsx("span",{className:"amount",children:"$0.50"}),a.jsx("span",{className:"amount-note",children:"(will be refunded)"})]}),o&&a.jsx("div",{className:"error-message",children:o}),a.jsxs("form",{onSubmit:x,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Card Number"}),a.jsxs("div",{className:"card-input-wrapper",children:[a.jsx("input",{type:"text",name:"number",className:"form-input card-input",placeholder:"4242 4242 4242 4242",value:u.number,onChange:f,autoComplete:"cc-number"}),a.jsx("div",{className:"card-icons",children:a.jsx("span",{className:"card-icon visa",children:""})})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Expiry Date"}),a.jsx("input",{type:"text",name:"expiry",className:"form-input",placeholder:"MM/YY",value:u.expiry,onChange:f,autoComplete:"cc-exp"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"CVC"}),a.jsx("input",{type:"text",name:"cvc",className:"form-input",placeholder:"123",value:u.cvc,onChange:f,autoComplete:"cc-csc"})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Cardholder Name"}),a.jsx("input",{type:"text",name:"name",className:"form-input",placeholder:"Name on card",value:u.name,onChange:f,autoComplete:"cc-name"})]}),a.jsxs("div",{className:"security-badges",children:[a.jsxs("span",{className:"badge",children:[a.jsx("span",{children:""})," SSL Encrypted"]}),a.jsxs("span",{className:"badge",children:[a.jsx("span",{children:""})," PCI Compliant"]}),a.jsxs("span",{className:"badge",children:[a.jsx("span",{children:""})," Powered by Stripe"]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:t,disabled:i,children:"Back"}),a.jsx("button",{type:"submit",className:"btn btn-primary",disabled:i,children:i?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),"Processing..."]}):"Verify & Pay $0.50"})]})]}),a.jsx("div",{className:"refund-notice",children:a.jsxs("p",{children:[a.jsx("strong",{children:"100% Refund Guaranteed"}),a.jsx("br",{}),"The $0.50 charge is only to verify your identity as an adult. It will be automatically refunded within 5-7 business days."]})}),a.jsx("style",{children:`
        .cc-step {
          text-align: center;
        }

        .cc-form .step-header {
          margin-bottom: 16px;
        }

        .amount-badge {
          background: linear-gradient(135deg, #e3f2fd, #bbdefb);
          border-radius: 12px;
          padding: 12px 20px;
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          margin-bottom: 20px;
        }

        .amount {
          font-size: 1.5rem;
          font-weight: 700;
          color: #1565c0;
        }

        .amount-note {
          font-size: 0.75rem;
          color: #42a5f5;
        }

        .card-input-wrapper {
          position: relative;
        }

        .card-input {
          padding-right: 50px;
        }

        .card-icons {
          position: absolute;
          right: 12px;
          top: 50%;
          transform: translateY(-50%);
          display: flex;
          gap: 4px;
        }

        .card-icon {
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }

        .security-badges {
          display: flex;
          justify-content: center;
          gap: 12px;
          flex-wrap: wrap;
          margin: 16px 0;
        }

        .security-badges .badge {
          display: flex;
          align-items: center;
          gap: 4px;
          font-size: 0.75rem;
          color: #666;
          background: #f5f5f5;
          padding: 4px 10px;
          border-radius: 20px;
        }

        .form-actions {
          display: grid;
          grid-template-columns: 1fr 2fr;
          gap: 12px;
          margin-top: 20px;
        }

        .refund-notice {
          background: #fff8e1;
          border-radius: 12px;
          padding: 16px;
          margin-top: 20px;
          font-size: 0.8125rem;
          color: #f57c00;
          text-align: left;
        }

        .refund-notice strong {
          color: #e65100;
        }

        .refund-notice p {
          margin: 0;
        }

        /* Processing state */
        .cc-processing {
          padding: 40px 20px;
        }

        .processing-animation {
          margin-bottom: 24px;
        }

        .spinner-large {
          width: 60px;
          height: 60px;
          border: 4px solid #e0e0e0;
          border-top-color: #ffc107;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto;
        }

        .processing-text {
          color: #666;
          margin: 0 0 16px;
        }

        .secure-text {
          font-size: 0.875rem;
          color: #4caf50;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        }

        /* Success state */
        .cc-success {
          padding: 40px 20px;
        }

        .success-animation {
          margin-bottom: 24px;
        }

        .success-animation svg {
          animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
          from {
            transform: scale(0);
            opacity: 0;
          }
          to {
            transform: scale(1);
            opacity: 1;
          }
        }

        .success-text {
          color: #666;
          margin: 0 0 16px;
        }

        .redirect-text {
          font-size: 0.875rem;
          color: #999;
          font-style: italic;
        }

        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }
      `})]})},uge=({consentId:n,onVerified:e,onBack:t})=>{const{updateConsentStatus:s}=Vt(),[i,r]=N.useState([]),[o,c]=N.useState({}),[d,h]=N.useState(0),[u,p]=N.useState(!0),[f,m]=N.useState(!1),[x,g]=N.useState(""),[b,y]=N.useState(3),[C,w]=N.useState("questions"),[S,j]=N.useState(!1);N.useEffect(()=>{T()},[]);const T=async()=>{var F;p(!0);try{const B=await JC.getKBQQuestions();B.success&&((F=B.data)!=null&&F.questions)?(r(B.data.questions),j(B.data.isSetup||!1)):g("Failed to load questions")}catch(B){g(B.message||"Failed to load questions")}finally{p(!1)}},k=(F,B)=>{c(U=>({...U,[F]:B}))},_=F=>{F>=0&&F<i.length&&h(F)},L=()=>{d<i.length-1&&h(F=>F+1)},D=()=>{d>0&&h(F=>F-1)},P=()=>i.every(F=>o[F.id]&&o[F.id].trim()!==""),I=async()=>{var F;if(!P()){g("Please answer all questions");return}g(""),m(!0);try{const B=Object.entries(o).map(([G,ne])=>({questionId:G,answer:ne})),$=await(S?JC.setupKBQ:JC.verifyKBQ)({answers:B});$.success&&((F=$.data)!=null&&F.passed)?(w("success"),s("verified"),setTimeout(()=>{e==null||e()},2e3)):(y(G=>G-1),b<=1?w("failed"):g($.error||"Verification failed. Please try again."))}catch(B){y(U=>U-1),b<=1?w("failed"):g(B.message||"Verification failed. Please check your answers.")}finally{m(!1)}};if(u)return a.jsxs("div",{className:"kbq-step kbq-loading",children:[a.jsx("div",{className:"loading-animation",children:a.jsx("span",{className:"loading-spinner"})}),a.jsx("p",{children:"Loading questions..."})]});if(C==="success")return a.jsxs("div",{className:"kbq-step kbq-success",children:[a.jsx("div",{className:"success-animation",children:a.jsxs("svg",{width:"100",height:"100",viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"#E8F5E9",stroke:"#4CAF50",strokeWidth:"3"}),a.jsx("path",{d:"M30 50L45 65L70 35",stroke:"#4CAF50",strokeWidth:"5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})}),a.jsx("h2",{children:"Verification Successful!"}),a.jsx("p",{className:"success-text",children:"Your parental consent has been verified through knowledge-based questions."}),a.jsx("p",{className:"redirect-text",children:"Continuing to profile setup..."})]});if(C==="failed")return a.jsxs("div",{className:"kbq-step kbq-failed",children:[a.jsx("div",{className:"failed-icon",children:a.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"40",cy:"40",r:"36",fill:"#FFEBEE",stroke:"#F44336",strokeWidth:"3"}),a.jsx("path",{d:"M28 28L52 52M52 28L28 52",stroke:"#F44336",strokeWidth:"4",strokeLinecap:"round"})]})}),a.jsx("h2",{children:"Verification Failed"}),a.jsx("p",{className:"failed-text",children:"You've used all 3 attempts. Please try credit card verification instead."}),a.jsx("button",{type:"button",className:"btn btn-primary",onClick:t,children:"Try Credit Card Verification"})]});const M=i[d],O=(d+1)/i.length*100;return a.jsxs("div",{className:"kbq-step kbq-questions",children:[a.jsxs("div",{className:"step-header",children:[a.jsx("h2",{children:S?"Set Up Security Questions":"Knowledge-Based Verification"}),a.jsx("p",{className:"subtitle",children:S?"Answer these security questions. You'll need to remember these answers for future verification.":"Answer your security questions to verify your identity."})]}),a.jsxs("div",{className:"question-progress",children:[a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${O}%`}})}),a.jsxs("span",{className:"progress-text",children:["Question ",d+1," of ",i.length]})]}),b<3&&a.jsxs("div",{className:"attempts-warning",children:[a.jsx("span",{className:"warning-icon",children:"!"}),b," attempt",b!==1?"s":""," remaining"]}),x&&a.jsx("div",{className:"error-message",children:x}),M&&a.jsxs("div",{className:"question-card",children:[a.jsx("div",{className:"question-text",children:M.question}),M.type==="text"||!M.options||M.options.length===0?a.jsx("input",{type:"text",className:"form-input",placeholder:"Enter your answer",value:o[M.id]||"",onChange:F=>k(M.id,F.target.value)}):a.jsx("div",{className:"options-grid",children:M.options.map((F,B)=>a.jsx("button",{type:"button",className:`option-btn ${o[M.id]===F?"selected":""}`,onClick:()=>k(M.id,F),children:F},B))})]}),a.jsx("div",{className:"question-dots",children:i.map((F,B)=>a.jsx("button",{type:"button",className:`dot ${B===d?"active":""} ${o[F.id]?"answered":""}`,onClick:()=>_(B),"aria-label":`Question ${B+1}`},F.id))}),a.jsxs("div",{className:"form-actions",children:[d===0?a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:t,children:"Back"}):a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:D,children:"Previous"}),d<i.length-1?a.jsx("button",{type:"button",className:"btn btn-primary",onClick:L,disabled:!o[M==null?void 0:M.id],children:"Next"}):a.jsx("button",{type:"button",className:"btn btn-primary",onClick:I,disabled:f||!P(),children:f?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),"Verifying..."]}):"Submit Answers"})]}),a.jsx("style",{children:`
        .kbq-step {
          text-align: center;
        }

        .kbq-loading {
          padding: 40px 20px;
        }

        .loading-animation {
          margin-bottom: 16px;
        }

        .loading-animation .loading-spinner {
          width: 40px;
          height: 40px;
          border: 3px solid #e0e0e0;
          border-top-color: #ffc107;
        }

        .question-progress {
          margin-bottom: 16px;
        }

        .progress-bar {
          height: 8px;
          background: #e0e0e0;
          border-radius: 4px;
          overflow: hidden;
          margin-bottom: 8px;
        }

        .progress-fill {
          height: 100%;
          background: linear-gradient(90deg, #ffc107, #ff9800);
          border-radius: 4px;
          transition: width 0.3s ease;
        }

        .progress-text {
          font-size: 0.875rem;
          color: #666;
        }

        .attempts-warning {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          background: #fff3e0;
          color: #e65100;
          padding: 8px 16px;
          border-radius: 8px;
          font-size: 0.875rem;
          font-weight: 500;
          margin-bottom: 16px;
        }

        .warning-icon {
          width: 20px;
          height: 20px;
          background: #ff9800;
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: 0.75rem;
        }

        .question-card {
          background: #f9f9f9;
          border-radius: 16px;
          padding: 24px;
          margin-bottom: 20px;
          text-align: left;
        }

        .question-text {
          font-size: 1.125rem;
          font-weight: 600;
          color: #333;
          margin-bottom: 16px;
        }

        .options-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .option-btn {
          padding: 12px 16px;
          border: 2px solid #e0e0e0;
          border-radius: 10px;
          background: white;
          font-size: 0.9375rem;
          color: #333;
          cursor: pointer;
          transition: all 0.2s ease;
          text-align: center;
        }

        .option-btn:hover {
          border-color: #ffc107;
          background: #fffde7;
        }

        .option-btn.selected {
          border-color: #ffc107;
          background: #ffc107;
          color: white;
          font-weight: 500;
        }

        .question-dots {
          display: flex;
          justify-content: center;
          gap: 8px;
          margin-bottom: 24px;
        }

        .dot {
          width: 12px;
          height: 12px;
          border-radius: 50%;
          border: 2px solid #e0e0e0;
          background: white;
          padding: 0;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .dot.active {
          border-color: #ffc107;
          transform: scale(1.2);
        }

        .dot.answered {
          background: #ffc107;
          border-color: #ffc107;
        }

        .form-actions {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }

        /* Success state */
        .kbq-success {
          padding: 40px 20px;
        }

        .success-animation {
          margin-bottom: 24px;
        }

        .success-animation svg {
          animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
          from {
            transform: scale(0);
            opacity: 0;
          }
          to {
            transform: scale(1);
            opacity: 1;
          }
        }

        .success-text {
          color: #666;
          margin: 0 0 16px;
        }

        .redirect-text {
          font-size: 0.875rem;
          color: #999;
          font-style: italic;
        }

        /* Failed state */
        .kbq-failed {
          padding: 40px 20px;
        }

        .failed-icon {
          margin-bottom: 24px;
        }

        .failed-text {
          color: #666;
          margin: 0 0 24px;
        }

        @media (max-width: 480px) {
          .options-grid {
            grid-template-columns: 1fr;
          }
        }
      `})]})},$1={createProfile:async n=>ue("/profiles/children",{method:"POST",body:JSON.stringify(n)}),getProfiles:async()=>ue("/profiles/children",{method:"GET"}),getProfile:async n=>ue(`/profiles/children/${n}`,{method:"GET"}),updateProfile:async(n,e)=>ue(`/profiles/children/${n}`,{method:"PATCH",body:JSON.stringify(e)}),deleteProfile:async n=>ue(`/profiles/children/${n}`,{method:"DELETE"}),updatePrivacySettings:async(n,e)=>ue(`/profiles/children/${n}/privacy`,{method:"PATCH",body:JSON.stringify(e)}),getPrivacySettings:async n=>ue(`/profiles/children/${n}/privacy`,{method:"GET"}),getActivityStats:async(n,e="week")=>ue(`/profiles/children/${n}/stats?period=${e}`,{method:"GET"}),uploadAvatar:async(n,e)=>{const t=$t.getActiveToken(),s=new FormData;s.append("avatar",e);const i=await fetch(`${CG}/api/profiles/children/${n}/avatar`,{method:"POST",headers:{...t&&{Authorization:`Bearer ${t}`}},body:s});if(!i.ok){const r=await i.json().catch(()=>({}));throw new Error(r.error||`HTTP error! status: ${i.status}`)}return i.json()},getAvatarOptions:async()=>ue("/profiles/avatars",{method:"GET"})},zz=[{id:"avatar_1",name:"Cool Cat",emoji:""},{id:"avatar_2",name:"Happy Dog",emoji:""},{id:"avatar_3",name:"Smart Owl",emoji:""},{id:"avatar_4",name:"Brave Lion",emoji:""},{id:"avatar_5",name:"Friendly Panda",emoji:""},{id:"avatar_6",name:"Curious Bunny",emoji:""},{id:"avatar_7",name:"Playful Penguin",emoji:""},{id:"avatar_8",name:"Mighty Elephant",emoji:""}],Hz=[{value:0,label:"Pre-K"},{value:1,label:"Grade 1"},{value:2,label:"Grade 2"},{value:3,label:"Grade 3"},{value:4,label:"Grade 4"},{value:5,label:"Grade 5"},{value:6,label:"Grade 6"}],pge=[{value:"visual",label:"Visual",icon:"",description:"Learns best with pictures and diagrams"},{value:"auditory",label:"Auditory",icon:"",description:"Learns best by listening"},{value:"kinesthetic",label:"Hands-on",icon:"",description:"Learns best by doing activities"}],fge=[{value:"american",label:"American (Common Core)"},{value:"british",label:"British (IGCSE)"},{value:"indian",label:"Indian (CBSE/ICSE)"},{value:"ib",label:"International Baccalaureate (IB)"}],mge=({onComplete:n})=>{var C,w;const{addChildProfile:e,maxChildrenAllowed:t}=Vt(),[s,i]=N.useState({displayName:"",age:"",grade:"",avatarId:"avatar_1",learningStyle:"visual",curriculumType:"american",pin:"",confirmPin:""}),[r,o]=N.useState({}),[c,d]=N.useState(!1),[h,u]=N.useState(1),p=()=>{const S={};if(s.displayName.trim()?s.displayName.length>50&&(S.displayName="Name must be 50 characters or less"):S.displayName="Please enter your child's name",!s.age)S.age="Please enter your child's age";else{const j=parseInt(s.age);(j<4||j>12)&&(S.age="Age must be between 4 and 12")}return s.grade===""&&(S.grade="Please select your child's grade"),s.pin?/^\d{4}$/.test(s.pin)||(S.pin="PIN must be exactly 4 digits"):S.pin="Please create a 4-digit PIN",s.confirmPin?s.pin!==s.confirmPin&&(S.confirmPin="PINs do not match"):S.confirmPin="Please confirm your PIN",o(S),Object.keys(S).length===0},f=S=>{const{name:j,value:T}=S.target;i(k=>({...k,[j]:T})),r[j]&&o(k=>({...k,[j]:""}))},m=S=>{i(j=>({...j,avatarId:S}))},x=S=>{i(j=>({...j,learningStyle:S}))},g=()=>{h===1?p()&&u(2):h===2&&u(3)},b=()=>{h>1&&u(h-1)},y=async()=>{d(!0);try{const S={displayName:s.displayName.trim(),age:parseInt(s.age),grade:parseInt(s.grade),avatarId:s.avatarId,learningStyle:s.learningStyle,curriculumType:s.curriculumType,language:"en",pin:s.pin},j=await $1.createProfile(S);j.success&&j.data&&e(j.data),n==null||n()}catch(S){o({submit:S.message||"Failed to create profile"})}finally{d(!1)}};return a.jsxs("div",{className:"create-profile-step",children:[a.jsxs("div",{className:"step-header",children:[a.jsxs("h2",{children:[h===1&&"Tell us about your child",h===2&&"Choose an avatar",h===3&&"Learning preferences"]}),a.jsxs("p",{className:"subtitle",children:[h===1&&"This helps Jeffrey personalize the learning experience.",h===2&&"Pick a fun character to represent your child!",h===3&&"Help us tailor lessons to your child's style."]})]}),a.jsxs("div",{className:"profile-progress",children:[a.jsx("div",{className:`progress-dot ${h>=1?"active":""}`,children:"1"}),a.jsx("div",{className:"progress-line-mini"}),a.jsx("div",{className:`progress-dot ${h>=2?"active":""}`,children:"2"}),a.jsx("div",{className:"progress-line-mini"}),a.jsx("div",{className:`progress-dot ${h>=3?"active":""}`,children:"3"})]}),r.submit&&a.jsx("div",{className:"error-message",children:r.submit}),h===1&&a.jsxs("div",{className:"profile-form",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Child's First Name"}),a.jsx("input",{type:"text",name:"displayName",className:`form-input ${r.displayName?"error":""}`,placeholder:"e.g., Alex",value:s.displayName,onChange:f}),r.displayName&&a.jsx("div",{className:"form-error",children:r.displayName}),a.jsx("div",{className:"form-hint",children:"First name only (for privacy)"})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Age"}),a.jsxs("select",{name:"age",className:`form-input form-select ${r.age?"error":""}`,value:s.age,onChange:f,children:[a.jsx("option",{value:"",children:"Select age"}),[4,5,6,7,8,9,10,11,12].map(S=>a.jsxs("option",{value:S,children:[S," years old"]},S))]}),r.age&&a.jsx("div",{className:"form-error",children:r.age})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Grade"}),a.jsxs("select",{name:"grade",className:`form-input form-select ${r.grade?"error":""}`,value:s.grade,onChange:f,children:[a.jsx("option",{value:"",children:"Select grade"}),Hz.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))]}),r.grade&&a.jsx("div",{className:"form-error",children:r.grade})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{className:"form-label",children:"Curriculum"}),a.jsx("select",{name:"curriculumType",className:"form-input form-select",value:s.curriculumType,onChange:f,children:fge.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))})]}),a.jsxs("div",{className:"pin-section",children:[a.jsxs("div",{className:"pin-section-header",children:[a.jsx("label",{className:"form-label",children:"Parent PIN"}),a.jsx("div",{className:"form-hint pin-hint",children:"This 4-digit PIN protects parent settings from your child. You'll need it to access the parent dashboard."})]}),a.jsxs("div",{className:"pin-entry-row",children:[a.jsxs("div",{className:"pin-entry-group",children:[a.jsx("label",{className:"form-label-small",children:"Create PIN"}),a.jsx("div",{className:`pin-boxes ${r.pin?"error":""}`,children:[0,1,2,3].map(S=>a.jsx("input",{type:"password",inputMode:"numeric",maxLength:1,className:"pin-box",value:s.pin[S]||"",onChange:j=>{const T=j.target.value.replace(/\D/g,"");if(T.length<=1){const k=s.pin.split("");if(k[S]=T,i(_=>({..._,pin:k.join("")})),r.pin&&o(_=>({..._,pin:""})),T&&S<3){const _=j.target.parentElement.children[S+1];_&&_.focus()}}},onKeyDown:j=>{if(j.key==="Backspace"&&!s.pin[S]&&S>0){const T=j.target.parentElement.children[S-1];T&&T.focus()}}},`pin-${S}`))}),r.pin&&a.jsx("div",{className:"form-error",children:r.pin})]}),a.jsxs("div",{className:"pin-entry-group",children:[a.jsx("label",{className:"form-label-small",children:"Confirm PIN"}),a.jsx("div",{className:`pin-boxes ${r.confirmPin?"error":""}`,children:[0,1,2,3].map(S=>a.jsx("input",{type:"password",inputMode:"numeric",maxLength:1,className:"pin-box",value:s.confirmPin[S]||"",onChange:j=>{const T=j.target.value.replace(/\D/g,"");if(T.length<=1){const k=s.confirmPin.split("");if(k[S]=T,i(_=>({..._,confirmPin:k.join("")})),r.confirmPin&&o(_=>({..._,confirmPin:""})),T&&S<3){const _=j.target.parentElement.children[S+1];_&&_.focus()}}},onKeyDown:j=>{if(j.key==="Backspace"&&!s.confirmPin[S]&&S>0){const T=j.target.parentElement.children[S-1];T&&T.focus()}}},`confirmPin-${S}`))}),r.confirmPin&&a.jsx("div",{className:"form-error",children:r.confirmPin})]})]})]})]}),h===2&&a.jsx("div",{className:"avatar-selection",children:a.jsx("div",{className:"avatar-grid",children:zz.map(S=>a.jsxs("button",{type:"button",className:`avatar-option ${s.avatarId===S.id?"selected":""}`,onClick:()=>m(S.id),children:[a.jsx("span",{className:"avatar-emoji",children:S.emoji}),a.jsx("span",{className:"avatar-name",children:S.name})]},S.id))})}),h===3&&a.jsxs("div",{className:"learning-selection",children:[a.jsx("div",{className:"learning-styles",children:pge.map(S=>a.jsxs("button",{type:"button",className:`style-option ${s.learningStyle===S.value?"selected":""}`,onClick:()=>x(S.value),children:[a.jsx("span",{className:"style-icon",children:S.icon}),a.jsx("span",{className:"style-label",children:S.label}),a.jsx("span",{className:"style-description",children:S.description})]},S.value))}),a.jsxs("div",{className:"profile-summary",children:[a.jsx("h4",{children:"Profile Summary"}),a.jsxs("div",{className:"summary-content",children:[a.jsx("div",{className:"summary-avatar",children:a.jsx("span",{className:"summary-emoji",children:((C=zz.find(S=>S.id===s.avatarId))==null?void 0:C.emoji)||""})}),a.jsxs("div",{className:"summary-details",children:[a.jsx("span",{className:"summary-name",children:s.displayName||"Child"}),a.jsxs("span",{className:"summary-info",children:[s.age," years old  ",((w=Hz.find(S=>S.value===parseInt(s.grade)))==null?void 0:w.label)||"Grade"]})]})]})]})]}),a.jsxs("div",{className:"form-actions",children:[h>1&&a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:b,children:"Back"}),h<3?a.jsx("button",{type:"button",className:"btn btn-primary",onClick:g,style:h===1?{gridColumn:"1 / -1"}:{},children:"Continue"}):a.jsx("button",{type:"button",className:"btn btn-primary",onClick:y,disabled:c,children:c?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"loading-spinner"}),"Creating Profile..."]}):"Create Profile"})]}),a.jsx("style",{children:`
        .create-profile-step {
          text-align: center;
        }

        .profile-progress {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          margin-bottom: 24px;
        }

        .progress-dot {
          width: 28px;
          height: 28px;
          border-radius: 50%;
          background: #e0e0e0;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.75rem;
          font-weight: 600;
          color: #999;
          transition: all 0.3s ease;
        }

        .progress-dot.active {
          background: #ffc107;
          color: white;
        }

        .progress-line-mini {
          width: 40px;
          height: 2px;
          background: #e0e0e0;
        }

        .profile-form {
          text-align: left;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }

        .form-select {
          appearance: none;
          background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
          background-position: right 12px center;
          background-repeat: no-repeat;
          background-size: 16px;
          padding-right: 40px;
        }

        /* PIN section */
        .pin-section {
          margin-top: 24px;
          padding-top: 24px;
          border-top: 1px solid #e0e0e0;
        }

        .pin-section-header {
          margin-bottom: 16px;
        }

        .pin-hint {
          margin-top: 4px;
          color: #666;
          font-size: 0.8125rem;
          line-height: 1.4;
        }

        .form-label-small {
          display: block;
          font-size: 0.8125rem;
          font-weight: 500;
          color: #666;
          margin-bottom: 8px;
        }

        .pin-entry-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 24px;
        }

        .pin-entry-group {
          display: flex;
          flex-direction: column;
        }

        .pin-boxes {
          display: flex;
          gap: 8px;
          justify-content: flex-start;
        }

        .pin-boxes.error .pin-box {
          border-color: #ef4444;
        }

        .pin-box {
          width: 48px;
          height: 56px;
          border: 2px solid #e0e0e0;
          border-radius: 12px;
          font-size: 1.5rem;
          font-weight: 600;
          text-align: center;
          background: #fff;
          transition: all 0.2s ease;
        }

        .pin-box:focus {
          outline: none;
          border-color: #ffc107;
          box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
        }

        .pin-box::-webkit-inner-spin-button,
        .pin-box::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        @media (max-width: 480px) {
          .pin-entry-row {
            grid-template-columns: 1fr;
            gap: 16px;
          }

          .pin-boxes {
            justify-content: center;
          }

          .pin-box {
            width: 52px;
            height: 60px;
          }
        }

        /* Avatar selection */
        .avatar-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 12px;
          margin-bottom: 16px;
        }

        .avatar-option {
          padding: 16px 8px;
          border: 2px solid #e0e0e0;
          border-radius: 12px;
          background: white;
          cursor: pointer;
          transition: all 0.2s ease;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
        }

        .avatar-option:hover {
          border-color: #ffc107;
          transform: translateY(-2px);
        }

        .avatar-option.selected {
          border-color: #ffc107;
          background: #fffde7;
          transform: scale(1.05);
        }

        .avatar-emoji {
          font-size: 2rem;
        }

        .avatar-name {
          font-size: 0.6875rem;
          color: #666;
        }

        /* Learning styles */
        .learning-styles {
          display: flex;
          flex-direction: column;
          gap: 12px;
          margin-bottom: 20px;
        }

        .style-option {
          padding: 16px;
          border: 2px solid #e0e0e0;
          border-radius: 12px;
          background: white;
          cursor: pointer;
          transition: all 0.2s ease;
          display: grid;
          grid-template-columns: auto 1fr;
          grid-template-rows: auto auto;
          gap: 4px 12px;
          text-align: left;
        }

        .style-option:hover {
          border-color: #ffc107;
        }

        .style-option.selected {
          border-color: #ffc107;
          background: #fffde7;
        }

        .style-icon {
          font-size: 1.5rem;
          grid-row: span 2;
          display: flex;
          align-items: center;
        }

        .style-label {
          font-weight: 600;
          color: #333;
        }

        .style-description {
          font-size: 0.8125rem;
          color: #666;
        }

        /* Profile summary */
        .profile-summary {
          background: #f9f9f9;
          border-radius: 12px;
          padding: 16px;
          text-align: left;
        }

        .profile-summary h4 {
          font-size: 0.8125rem;
          font-weight: 600;
          color: #999;
          text-transform: uppercase;
          margin: 0 0 12px;
        }

        .summary-content {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .summary-avatar {
          width: 48px;
          height: 48px;
          background: #ffc107;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .summary-emoji {
          font-size: 1.5rem;
        }

        .summary-details {
          display: flex;
          flex-direction: column;
        }

        .summary-name {
          font-weight: 600;
          color: #333;
        }

        .summary-info {
          font-size: 0.8125rem;
          color: #666;
        }

        .form-actions {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
          margin-top: 24px;
        }

        @media (max-width: 480px) {
          .avatar-grid {
            grid-template-columns: repeat(2, 1fr);
          }

          .form-row {
            grid-template-columns: 1fr;
          }
        }
      `})]})},gge=({onComplete:n})=>{var o,c,d,h,u,p,f,m;const{currentProfile:e,children:t}=Vt(),[s,i]=N.useState(!0);N.useEffect(()=>{const x=setTimeout(()=>{i(!1)},3e3);return()=>clearTimeout(x)},[]);const r=e||t[0];return a.jsxs("div",{className:"welcome-step",children:[s&&a.jsx("div",{className:"confetti-container",children:[...Array(50)].map((x,g)=>a.jsx("div",{className:"confetti",style:{left:`${Math.random()*100}%`,animationDelay:`${Math.random()*2}s`,animationDuration:`${2+Math.random()*2}s`,backgroundColor:["#ffc107","#ff9800","#4caf50","#2196f3","#e91e63"][Math.floor(Math.random()*5)]}},g))}),a.jsxs(R.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,type:"spring"},className:"welcome-content",children:[a.jsxs("div",{className:"jeffrey-welcome",children:[a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey",className:"jeffrey-avatar-large"}),a.jsx("span",{className:"party-emoji",children:""})]}),a.jsx("h2",{children:"Welcome to OrbitLearn!"}),a.jsxs("p",{className:"welcome-text",children:["You're all set! ",(r==null?void 0:r.displayName)||"Your child"," is ready to start an amazing learning adventure with Jeffrey, our friendly AI tutor."]}),a.jsxs("div",{className:"profile-card",children:[a.jsxs("div",{className:"profile-avatar-large",children:[((o=r==null?void 0:r.avatarId)==null?void 0:o.includes("avatar_1"))&&"",((c=r==null?void 0:r.avatarId)==null?void 0:c.includes("avatar_2"))&&"",((d=r==null?void 0:r.avatarId)==null?void 0:d.includes("avatar_3"))&&"",((h=r==null?void 0:r.avatarId)==null?void 0:h.includes("avatar_4"))&&"",((u=r==null?void 0:r.avatarId)==null?void 0:u.includes("avatar_5"))&&"",((p=r==null?void 0:r.avatarId)==null?void 0:p.includes("avatar_6"))&&"",((f=r==null?void 0:r.avatarId)==null?void 0:f.includes("avatar_7"))&&"",((m=r==null?void 0:r.avatarId)==null?void 0:m.includes("avatar_8"))&&"",!(r!=null&&r.avatarId)&&""]}),a.jsxs("div",{className:"profile-details",children:[a.jsx("span",{className:"profile-name",children:(r==null?void 0:r.displayName)||"Young Learner"}),a.jsxs("span",{className:"profile-info",children:["Age ",(r==null?void 0:r.age)||"?","  Grade ",(r==null?void 0:r.grade)||"?"]})]})]}),a.jsxs("div",{className:"features-preview",children:[a.jsxs("div",{className:"feature",children:[a.jsx("span",{className:"feature-icon",children:""}),a.jsx("span",{className:"feature-text",children:"Upload lessons"})]}),a.jsxs("div",{className:"feature",children:[a.jsx("span",{className:"feature-icon",children:""}),a.jsx("span",{className:"feature-text",children:"Chat with Jeffrey"})]}),a.jsxs("div",{className:"feature",children:[a.jsx("span",{className:"feature-icon",children:""}),a.jsx("span",{className:"feature-text",children:"Earn XP & badges"})]}),a.jsxs("div",{className:"feature",children:[a.jsx("span",{className:"feature-icon",children:""}),a.jsx("span",{className:"feature-text",children:"Create flashcards"})]})]}),a.jsxs("button",{type:"button",className:"btn btn-primary start-btn",onClick:n,children:[a.jsx("span",{children:"Start Learning!"}),a.jsx("span",{className:"btn-arrow",children:""})]}),a.jsxs("p",{className:"safety-note",children:[a.jsx("span",{className:"shield-icon",children:""}),"All conversations are monitored for safety. Parents can view activity anytime."]})]}),a.jsx("style",{children:`
        .welcome-step {
          text-align: center;
          position: relative;
          overflow: hidden;
        }

        .confetti-container {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 100%;
          pointer-events: none;
          overflow: hidden;
        }

        .confetti {
          position: absolute;
          width: 10px;
          height: 10px;
          top: -10px;
          animation: fall linear forwards;
          border-radius: 2px;
        }

        @keyframes fall {
          to {
            transform: translateY(500px) rotate(720deg);
            opacity: 0;
          }
        }

        .welcome-content {
          position: relative;
          z-index: 1;
        }

        .jeffrey-welcome {
          position: relative;
          display: inline-block;
          margin-bottom: 16px;
        }

        .jeffrey-avatar-large {
          width: 100px;
          height: 100px;
          border-radius: 50%;
          border: 4px solid #7C3AED;
          box-shadow: 0 8px 24px rgba(124, 58, 237, 0.3);
          object-fit: cover;
        }

        .party-emoji {
          font-size: 2rem;
          display: inline-block;
          position: absolute;
          top: -8px;
          right: -8px;
          animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
          0%, 100% {
            transform: translateY(0);
          }
          50% {
            transform: translateY(-10px);
          }
        }

        .welcome-step h2 {
          font-size: 1.75rem;
          font-weight: 700;
          color: #333;
          margin: 0 0 12px;
        }

        .welcome-text {
          font-size: 1rem;
          color: #666;
          margin: 0 0 24px;
          line-height: 1.6;
        }

        .profile-card {
          background: linear-gradient(135deg, #fff8e1, #e3f2fd);
          border-radius: 16px;
          padding: 20px;
          display: flex;
          align-items: center;
          gap: 16px;
          margin-bottom: 24px;
        }

        .profile-avatar-large {
          width: 64px;
          height: 64px;
          background: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 2rem;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .profile-details {
          display: flex;
          flex-direction: column;
          text-align: left;
        }

        .profile-name {
          font-size: 1.25rem;
          font-weight: 600;
          color: #333;
        }

        .profile-info {
          font-size: 0.875rem;
          color: #666;
        }

        .features-preview {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 12px;
          margin-bottom: 24px;
        }

        .feature {
          background: #f9f9f9;
          border-radius: 12px;
          padding: 12px;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feature-icon {
          font-size: 1.25rem;
        }

        .feature-text {
          font-size: 0.875rem;
          color: #333;
        }

        .start-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          font-size: 1.125rem;
          padding: 16px 32px;
        }

        .btn-arrow {
          font-size: 1.25rem;
          transition: transform 0.2s ease;
        }

        .start-btn:hover .btn-arrow {
          transform: translateX(4px);
        }

        .safety-note {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          margin-top: 20px;
          font-size: 0.8125rem;
          color: #4caf50;
        }

        .shield-icon {
          font-size: 1rem;
        }

        @media (max-width: 480px) {
          .features-preview {
            grid-template-columns: 1fr;
          }
        }
      `})]})},Ke={SIGNUP:"signup",SIGNIN:"signin",EMAIL_VERIFICATION:"email_verification",CONSENT_METHOD:"consent_method",CREDIT_CARD:"credit_card",KBQ:"kbq",CREATE_PROFILE:"create_profile",WELCOME:"welcome"},xge=({initialStep:n=Ke.SIGNUP})=>{const e=Qt(),{user:t,isAuthenticated:s,hasConsent:i,children:r,needsEmailVerification:o,needsConsent:c,needsChildProfile:d}=Vt(),[h,u]=N.useState(n),[p,f]=N.useState(null),[m,x]=N.useState(null),[g,b]=N.useState(1),[y,C]=N.useState(null);N.useEffect(()=>{if(!(h===Ke.EMAIL_VERIFICATION&&y)&&!(h===Ke.KBQ||h===Ke.CREDIT_CARD)){if(!s){h!==Ke.SIGNUP&&h!==Ke.SIGNIN&&h!==Ke.EMAIL_VERIFICATION&&u(Ke.SIGNUP);return}if(o){u(Ke.EMAIL_VERIFICATION);return}if(c&&h!==Ke.CONSENT_METHOD&&h!==Ke.KBQ&&h!==Ke.CREDIT_CARD){u(Ke.CONSENT_METHOD);return}if(d&&h!==Ke.CREATE_PROFILE){u(Ke.CREATE_PROFILE);return}i&&r.length>0&&(h===Ke.CREATE_PROFILE?u(Ke.WELCOME):h===Ke.WELCOME||h!==Ke.CONSENT_METHOD&&h!==Ke.KBQ&&h!==Ke.CREDIT_CARD&&h!==Ke.CREATE_PROFILE&&e("/learn"))}},[s,o,c,d,i,r.length,e,h,y]);const w=U=>{const $=Object.values(Ke),G=$.indexOf(h),ne=$.indexOf(U);b(ne>G?1:-1),u(U)},S=U=>{U&&C(U),w(Ke.EMAIL_VERIFICATION)},j=()=>{},T=()=>{w(Ke.SIGNIN)},k=()=>{w(Ke.SIGNUP)},_=()=>{w(Ke.CONSENT_METHOD)},L=(U,$)=>{f(U),x($),w(U==="credit_card"?Ke.CREDIT_CARD:Ke.KBQ)},D=()=>{w(Ke.CREATE_PROFILE)},P=()=>{w(Ke.CONSENT_METHOD)},I=()=>{w(Ke.WELCOME)},M=()=>{e("/learn")},F={[Ke.SIGNUP]:1,[Ke.SIGNIN]:1,[Ke.EMAIL_VERIFICATION]:2,[Ke.CONSENT_METHOD]:3,[Ke.CREDIT_CARD]:3,[Ke.KBQ]:3,[Ke.CREATE_PROFILE]:4,[Ke.WELCOME]:5}[h]||1,B={enter:U=>({x:U>0?300:-300,opacity:0}),center:{x:0,opacity:1},exit:U=>({x:U<0?300:-300,opacity:0})};return a.jsx("div",{className:"onboarding-flow",children:a.jsxs("div",{className:"onboarding-container",children:[a.jsx("div",{className:"onboarding-header",children:a.jsx("div",{className:"onboarding-logo",children:a.jsx("img",{src:"/assets/orbit-learn-logo.png",alt:"OrbitLearn",className:"logo-image",style:{height:"80px",width:"auto",borderRadius:"16px"}})})}),a.jsxs("div",{className:"onboarding-progress",children:[a.jsxs("div",{className:`progress-step ${F>=1?"active":""} ${F>1?"completed":""}`,children:[a.jsx("div",{className:"step-circle",children:F>1?"":"1"}),a.jsx("span",{className:"step-label",children:"Account"})]}),a.jsx("div",{className:"progress-line"}),a.jsxs("div",{className:`progress-step ${F>=2?"active":""} ${F>2?"completed":""}`,children:[a.jsx("div",{className:"step-circle",children:F>2?"":"2"}),a.jsx("span",{className:"step-label",children:"Verify"})]}),a.jsx("div",{className:"progress-line"}),a.jsxs("div",{className:`progress-step ${F>=3?"active":""} ${F>3?"completed":""}`,children:[a.jsx("div",{className:"step-circle",children:F>3?"":"3"}),a.jsx("span",{className:"step-label",children:"Consent"})]}),a.jsx("div",{className:"progress-line"}),a.jsxs("div",{className:`progress-step ${F>=4?"active":""} ${F>4?"completed":""}`,children:[a.jsx("div",{className:"step-circle",children:F>4?"":"4"}),a.jsx("span",{className:"step-label",children:"Profile"})]})]}),a.jsx("div",{className:"onboarding-content",children:a.jsx(Ie,{mode:"wait",custom:g,children:a.jsxs(R.div,{custom:g,variants:B,initial:"enter",animate:"center",exit:"exit",transition:{duration:.3},className:"step-wrapper",children:[h===Ke.SIGNUP&&a.jsx(Uz,{onComplete:S,onSwitchToSignIn:T}),h===Ke.SIGNIN&&a.jsx(Uz,{isSignIn:!0,onComplete:j,onSwitchToSignUp:k}),h===Ke.EMAIL_VERIFICATION&&a.jsx(cge,{email:y||(t==null?void 0:t.email),onVerified:_}),h===Ke.CONSENT_METHOD&&a.jsx(dge,{onMethodSelected:L}),h===Ke.CREDIT_CARD&&a.jsx(hge,{consentId:m,onVerified:D,onBack:P}),h===Ke.KBQ&&a.jsx(uge,{consentId:m,onVerified:D,onBack:P}),h===Ke.CREATE_PROFILE&&a.jsx(mge,{onComplete:I}),h===Ke.WELCOME&&a.jsx(gge,{onComplete:M})]},h)})}),a.jsxs("div",{className:"onboarding-footer",children:[a.jsxs("p",{className:"privacy-text",children:["By creating an account, you agree to our"," ",a.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),"."]}),a.jsxs("p",{className:"coppa-text",children:["We take your child's privacy seriously."," ",a.jsx("a",{href:"/coppa",target:"_blank",rel:"noopener noreferrer",children:"Learn about our COPPA compliance"}),"."]})]})]})})},Vz=({initialStep:n})=>{var s;const e=Qi(),t=n||((s=e.state)==null?void 0:s.step)||"signup";return a.jsx(xge,{initialStep:t})},B3={getDashboard:async()=>ue("/parent/dashboard",{method:"GET"}),getChildActivity:async(n,e=20)=>ue(`/parent/children/${n}/activity?limit=${e}`,{method:"GET"})},Gz={avatar_1:{name:"Cool Cat",emoji:""},avatar_2:{name:"Happy Dog",emoji:""},avatar_3:{name:"Smart Owl",emoji:""},avatar_4:{name:"Brave Lion",emoji:""},avatar_5:{name:"Friendly Panda",emoji:""},avatar_6:{name:"Curious Bunny",emoji:""},avatar_7:{name:"Playful Penguin",emoji:""},avatar_8:{name:"Mighty Elephant",emoji:""}};function yge(n){return n&&Gz[n]?Gz[n].emoji:""}const bge=()=>{N.useEffect(()=>(console.log("[ParentDashboard] MOUNTED"),()=>console.log("[ParentDashboard] UNMOUNTED")),[]);const n=Qt(),[e,t]=N.useState(!0),[s,i]=N.useState(null),[r,o]=N.useState(null);let c=null;try{const f=Vt();c=f==null?void 0:f.user}catch{}if(N.useEffect(()=>{(async()=>{try{t(!0),i(null);const m=await B3.getDashboard();m.success?o(m.data):i("Failed to load dashboard data")}catch(m){console.error("Dashboard fetch error:",m),i(m.message||"Failed to load dashboard data")}finally{t(!1)}})()},[]),e)return a.jsx("div",{className:"parent-dashboard",children:a.jsxs("div",{className:"dashboard-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading dashboard..."})]})});if(s)return a.jsx("div",{className:"parent-dashboard",children:a.jsxs("div",{className:"dashboard-error",children:[a.jsx("p",{children:"Unable to load dashboard data"}),a.jsx("p",{className:"error-message",children:s}),a.jsx("button",{onClick:()=>window.location.reload(),children:"Try Again"})]})});const d=(r==null?void 0:r.stats)||{totalLessons:0,completedToday:0,streakDays:0,weeklyProgress:0},h=(r==null?void 0:r.children)||[],u=(r==null?void 0:r.recentActivity)||[],p=h.length>0;return a.jsxs("div",{className:"parent-dashboard",children:[a.jsxs("section",{className:"dashboard-welcome",children:[a.jsxs("div",{className:"welcome-content",children:[a.jsxs("h1",{children:["Welcome back",c!=null&&c.firstName?`, ${c.firstName}`:"","!"]}),a.jsx("p",{children:p?"Here's how your children are doing this week.":"Get started by adding your first child profile."})]}),a.jsxs("button",{className:"add-child-btn",onClick:()=>n("/parent/children"),children:[a.jsx("span",{children:"+"})," Add Child"]})]}),a.jsxs("section",{className:"dashboard-stats",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-value",children:d.totalLessons}),a.jsx("span",{className:"stat-label",children:"Total Lessons"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-value",children:d.completedToday}),a.jsx("span",{className:"stat-label",children:"Completed Today"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-value",children:d.streakDays}),a.jsx("span",{className:"stat-label",children:"Day Streak"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsxs("span",{className:"stat-value",children:[d.weeklyProgress,"%"]}),a.jsx("span",{className:"stat-label",children:"Weekly Goal"})]})]})]}),a.jsxs("section",{className:"dashboard-children",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("h2",{children:"Your Children"}),a.jsx("button",{className:"view-all-btn",onClick:()=>n("/parent/children"),children:"View All"})]}),p?a.jsx("div",{className:"children-grid",children:h.map(f=>a.jsxs("div",{className:"child-card-new",children:[a.jsxs("div",{className:"child-card-top",children:[a.jsx("div",{className:"child-avatar-large",children:yge(f.avatarUrl)}),a.jsxs("div",{className:"child-details",children:[a.jsx("h3",{className:"child-name",children:f.displayName}),a.jsxs("span",{className:"child-age-text",children:[f.age," years old"]})]}),a.jsx("span",{className:`activity-badge ${f.wasActiveToday?"active-today":""}`,children:f.lastActive})]}),a.jsxs("div",{className:"child-stats-row",children:[a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-icon-small",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-number",children:f.lessonsCompleted}),a.jsx("span",{className:"stat-text",children:"Lessons"})]})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-icon-small",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-number",children:f.currentStreak}),a.jsx("span",{className:"stat-text",children:"Day Streak"})]})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-icon-small",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-number",children:f.level}),a.jsx("span",{className:"stat-text",children:"Level"})]})]})]}),a.jsx("button",{className:"view-details-btn-new",onClick:()=>n(`/parent/children/${f.id}`),children:"View Details"})]},f.id))}):a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{children:"No children added yet."}),a.jsx("button",{className:"add-child-btn-inline",onClick:()=>n("/parent/children"),children:"Add Your First Child"})]})]}),a.jsxs("section",{className:"dashboard-activity",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("h2",{children:"Recent Activity"}),a.jsx("button",{className:"view-all-btn",onClick:()=>n("/parent/reports"),children:"View Reports"})]}),u.length>0?a.jsx("div",{className:"activity-list",children:u.map(f=>a.jsxs("div",{className:"activity-item",children:[a.jsx("div",{className:"activity-icon",children:f.icon}),a.jsxs("div",{className:"activity-content",children:[a.jsx("span",{className:"activity-child",children:f.child}),a.jsx("span",{className:"activity-action",children:f.action})]}),a.jsx("span",{className:"activity-time",children:f.time})]},f.id))}):a.jsx("div",{className:"empty-state",children:a.jsx("p",{children:"No recent activity yet. Start learning to see activity here!"})})]}),a.jsxs("section",{className:"dashboard-actions",children:[a.jsx("h2",{children:"Quick Actions"}),a.jsxs("div",{className:"actions-grid",children:[a.jsxs("button",{className:"action-card",onClick:()=>n("/parent/safety"),children:[a.jsx("span",{className:"action-icon",children:""}),a.jsx("span",{className:"action-label",children:"Safety Settings"})]}),a.jsxs("button",{className:"action-card",onClick:()=>n("/parent/reports"),children:[a.jsx("span",{className:"action-icon",children:""}),a.jsx("span",{className:"action-label",children:"Progress Reports"})]}),a.jsxs("button",{className:"action-card",onClick:()=>n("/parent/settings"),children:[a.jsx("span",{className:"action-icon",children:""}),a.jsx("span",{className:"action-label",children:"Account Settings"})]}),a.jsxs("button",{className:"action-card",onClick:()=>n("/parent/support"),children:[a.jsx("span",{className:"action-icon",children:""}),a.jsx("span",{className:"action-label",children:"Get Support"})]})]})]})]})},Wz=[{id:"avatar_1",name:"Cool Cat",emoji:""},{id:"avatar_2",name:"Happy Dog",emoji:""},{id:"avatar_3",name:"Smart Owl",emoji:""},{id:"avatar_4",name:"Brave Lion",emoji:""},{id:"avatar_5",name:"Friendly Panda",emoji:""},{id:"avatar_6",name:"Curious Bunny",emoji:""},{id:"avatar_7",name:"Playful Penguin",emoji:""},{id:"avatar_8",name:"Mighty Elephant",emoji:""}],qz=[{value:0,label:"Pre-K"},{value:1,label:"Grade 1"},{value:2,label:"Grade 2"},{value:3,label:"Grade 3"},{value:4,label:"Grade 4"},{value:5,label:"Grade 5"},{value:6,label:"Grade 6"}],vge=[{value:"visual",label:"Visual",icon:"",description:"Pictures and diagrams"},{value:"auditory",label:"Auditory",icon:"",description:"Listening and discussion"},{value:"kinesthetic",label:"Hands-on",icon:"",description:"Activities and practice"}],wge=[{value:"american",label:"American (Common Core)"},{value:"british",label:"British (IGCSE)"},{value:"indian",label:"Indian (CBSE/ICSE)"},{value:"ib",label:"International Baccalaureate"}],Sge=({onClose:n,onSuccess:e})=>{var C,w;const{addChildProfile:t}=Vt(),[s,i]=N.useState(1),[r,o]=N.useState(!1),[c,d]=N.useState({}),[h,u]=N.useState({displayName:"",age:"",grade:"",avatarId:"avatar_1",learningStyle:"visual",curriculumType:"american",pin:"",confirmPin:""}),p=S=>{const{name:j,value:T}=S.target;u(k=>({...k,[j]:T})),c[j]&&d(k=>({...k,[j]:""}))},f=()=>{const S={};if(h.displayName.trim()?h.displayName.length>50&&(S.displayName="Name must be 50 characters or less"):S.displayName="Name is required",!h.age)S.age="Age is required";else{const j=parseInt(h.age);(j<4||j>12)&&(S.age="Age must be between 4 and 12")}return h.grade===""&&(S.grade="Grade is required"),h.pin?/^\d{4}$/.test(h.pin)||(S.pin="Must be exactly 4 digits"):S.pin="4-digit PIN required",h.pin!==h.confirmPin&&(S.confirmPin="PINs do not match"),d(S),Object.keys(S).length===0},m=()=>{s===1&&f()?i(2):s===2&&i(3)},x=()=>{s>1&&i(s-1)},g=async()=>{o(!0),d({});try{const S={displayName:h.displayName.trim(),age:parseInt(h.age),grade:parseInt(h.grade),avatarId:h.avatarId,learningStyle:h.learningStyle,curriculumType:h.curriculumType,language:"en",pin:h.pin},j=await $1.createProfile(S);j.success&&j.data&&(t(j.data),e==null||e())}catch(S){d({submit:S.message||"Failed to create profile"})}finally{o(!1)}},b=(S,j,T)=>{const k=j.replace(/\D/g,"");if(k.length<=1){const _=h[T].split("");if(_[S]=k,u(L=>({...L,[T]:_.join("")})),c[T]&&d(L=>({...L,[T]:""})),k&&S<3){const L=document.querySelector(`[data-pin="${T}-${S+1}"]`);L&&L.focus()}}},y=(S,j,T)=>{if(S.key==="Backspace"&&!h[T][j]&&j>0){const k=document.querySelector(`[data-pin="${T}-${j-1}"]`);k&&k.focus()}};return a.jsx("div",{className:"modal-overlay",onClick:n,children:a.jsxs("div",{className:"modal-container",onClick:S=>S.stopPropagation(),children:[a.jsx("button",{className:"modal-close",onClick:n,children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),a.jsxs("div",{className:"modal-header",children:[a.jsxs("h2",{children:[s===1&&"Add New Child",s===2&&"Choose an Avatar",s===3&&"Learning Preferences"]}),a.jsxs("p",{className:"modal-subtitle",children:[s===1&&"Enter your child's basic information",s===2&&"Pick a fun character for your child",s===3&&"Help us personalize the experience"]})]}),a.jsxs("div",{className:"step-progress",children:[a.jsx("div",{className:`step-dot ${s>=1?"active":""}`,children:"1"}),a.jsx("div",{className:"step-line"}),a.jsx("div",{className:`step-dot ${s>=2?"active":""}`,children:"2"}),a.jsx("div",{className:"step-line"}),a.jsx("div",{className:`step-dot ${s>=3?"active":""}`,children:"3"})]}),c.submit&&a.jsx("div",{className:"modal-error",children:c.submit}),a.jsxs("div",{className:"modal-body",children:[s===1&&a.jsxs("div",{className:"form-step",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Child's First Name"}),a.jsx("input",{type:"text",name:"displayName",value:h.displayName,onChange:p,placeholder:"e.g., Alex",className:c.displayName?"error":""}),c.displayName&&a.jsx("span",{className:"field-error",children:c.displayName})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Age"}),a.jsxs("select",{name:"age",value:h.age,onChange:p,className:c.age?"error":"",children:[a.jsx("option",{value:"",children:"Select age"}),[4,5,6,7,8,9,10,11,12].map(S=>a.jsxs("option",{value:S,children:[S," years old"]},S))]}),c.age&&a.jsx("span",{className:"field-error",children:c.age})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Grade"}),a.jsxs("select",{name:"grade",value:h.grade,onChange:p,className:c.grade?"error":"",children:[a.jsx("option",{value:"",children:"Select grade"}),qz.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))]}),c.grade&&a.jsx("span",{className:"field-error",children:c.grade})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Curriculum"}),a.jsx("select",{name:"curriculumType",value:h.curriculumType,onChange:p,children:wge.map(S=>a.jsx("option",{value:S.value,children:S.label},S.value))})]}),a.jsxs("div",{className:"pin-section",children:[a.jsx("label",{children:"Parent PIN"}),a.jsx("p",{className:"pin-hint",children:"Create a 4-digit PIN to protect parent settings"}),a.jsxs("div",{className:"pin-row",children:[a.jsxs("div",{className:"pin-group",children:[a.jsx("span",{className:"pin-label",children:"Create PIN"}),a.jsx("div",{className:`pin-inputs ${c.pin?"error":""}`,children:[0,1,2,3].map(S=>a.jsx("input",{type:"password",inputMode:"numeric",maxLength:1,"data-pin":`pin-${S}`,value:h.pin[S]||"",onChange:j=>b(S,j.target.value,"pin"),onKeyDown:j=>y(j,S,"pin")},`pin-${S}`))}),c.pin&&a.jsx("span",{className:"field-error",children:c.pin})]}),a.jsxs("div",{className:"pin-group",children:[a.jsx("span",{className:"pin-label",children:"Confirm PIN"}),a.jsx("div",{className:`pin-inputs ${c.confirmPin?"error":""}`,children:[0,1,2,3].map(S=>a.jsx("input",{type:"password",inputMode:"numeric",maxLength:1,"data-pin":`confirmPin-${S}`,value:h.confirmPin[S]||"",onChange:j=>b(S,j.target.value,"confirmPin"),onKeyDown:j=>y(j,S,"confirmPin")},`confirmPin-${S}`))}),c.confirmPin&&a.jsx("span",{className:"field-error",children:c.confirmPin})]})]})]})]}),s===2&&a.jsx("div",{className:"form-step",children:a.jsx("div",{className:"avatar-grid",children:Wz.map(S=>a.jsxs("button",{type:"button",className:`avatar-option ${h.avatarId===S.id?"selected":""}`,onClick:()=>u(j=>({...j,avatarId:S.id})),children:[a.jsx("span",{className:"avatar-emoji",children:S.emoji}),a.jsx("span",{className:"avatar-name",children:S.name})]},S.id))})}),s===3&&a.jsxs("div",{className:"form-step",children:[a.jsx("div",{className:"learning-options",children:vge.map(S=>a.jsxs("button",{type:"button",className:`learning-option ${h.learningStyle===S.value?"selected":""}`,onClick:()=>u(j=>({...j,learningStyle:S.value})),children:[a.jsx("span",{className:"learning-icon",children:S.icon}),a.jsxs("div",{className:"learning-text",children:[a.jsx("span",{className:"learning-label",children:S.label}),a.jsx("span",{className:"learning-desc",children:S.description})]})]},S.value))}),a.jsxs("div",{className:"profile-preview",children:[a.jsx("h4",{children:"Profile Preview"}),a.jsxs("div",{className:"preview-content",children:[a.jsx("div",{className:"preview-avatar",children:((C=Wz.find(S=>S.id===h.avatarId))==null?void 0:C.emoji)||""}),a.jsxs("div",{className:"preview-info",children:[a.jsx("span",{className:"preview-name",children:h.displayName||"Child"}),a.jsxs("span",{className:"preview-meta",children:[h.age," years old  ",(w=qz.find(S=>S.value===parseInt(h.grade)))==null?void 0:w.label]})]})]})]})]})]}),a.jsxs("div",{className:"modal-footer",children:[s>1&&a.jsx("button",{type:"button",className:"btn-secondary",onClick:x,children:"Back"}),s<3?a.jsx("button",{type:"button",className:"btn-primary",onClick:m,style:s===1?{width:"100%"}:{},children:"Continue"}):a.jsx("button",{type:"button",className:"btn-primary",onClick:g,disabled:r,children:r?"Creating...":"Create Profile"})]})]})})},Yz=[{id:"avatar_1",name:"Cool Cat",emoji:""},{id:"avatar_2",name:"Happy Dog",emoji:""},{id:"avatar_3",name:"Smart Owl",emoji:""},{id:"avatar_4",name:"Brave Lion",emoji:""},{id:"avatar_5",name:"Friendly Panda",emoji:""},{id:"avatar_6",name:"Curious Bunny",emoji:""},{id:"avatar_7",name:"Playful Penguin",emoji:""},{id:"avatar_8",name:"Mighty Elephant",emoji:""}],Cge=[{value:"visual",label:"Visual",icon:"",description:"Pictures and diagrams"},{value:"auditory",label:"Auditory",icon:"",description:"Listening and discussion"},{value:"kinesthetic",label:"Hands-on",icon:"",description:"Activities and practice"}],Nge=[{value:"american",label:"American (Common Core)"},{value:"british",label:"British (IGCSE)"},{value:"indian",label:"Indian (CBSE/ICSE)"},{value:"ib",label:"International Baccalaureate"}],sQ=({child:n,onClose:e,onSuccess:t,onDelete:s})=>{var j,T;const{updateChildProfile:i,removeChildProfile:r}=Vt(),[o,c]=N.useState("profile"),[d,h]=N.useState(!1),[u,p]=N.useState(!1),[f,m]=N.useState({}),[x,g]=N.useState({displayName:n.displayName||"",avatarId:n.avatarUrl||"avatar_1",learningStyle:((j=n.learningStyle)==null?void 0:j.toLowerCase())||"visual",curriculumType:((T=n.curriculumType)==null?void 0:T.toLowerCase())||"american",language:n.preferredLanguage||"en"}),b=k=>{const{name:_,value:L}=k.target;g(D=>({...D,[_]:L})),f[_]&&m(D=>({...D,[_]:""}))},y=()=>{const k={};return x.displayName.trim()?x.displayName.length>50&&(k.displayName="Name must be 50 characters or less"):k.displayName="Name is required",m(k),Object.keys(k).length===0},C=async()=>{if(y()){h(!0),m({});try{const k={displayName:x.displayName.trim(),avatarId:x.avatarId,learningStyle:x.learningStyle,curriculumType:x.curriculumType,language:x.language},_=await $1.updateProfile(n.id,k);_.success&&(i(n.id,_.data),t==null||t())}catch(k){m({submit:k.message||"Failed to update profile"})}finally{h(!1)}}},w=async()=>{h(!0),m({});try{await $1.deleteProfile(n.id),r(n.id),s==null||s()}catch(k){m({submit:k.message||"Failed to delete profile"}),p(!1)}finally{h(!1)}},S=k=>{const _=Yz.find(L=>L.id===k);return(_==null?void 0:_.emoji)||""};return a.jsx("div",{className:"modal-overlay",onClick:e,children:a.jsxs("div",{className:"modal-container edit-modal",onClick:k=>k.stopPropagation(),children:[a.jsx("button",{className:"modal-close",onClick:e,children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),u?a.jsxs("div",{className:"delete-confirm",children:[a.jsx("div",{className:"delete-icon",children:""}),a.jsxs("h3",{children:["Delete ",n.displayName,"'s Profile?"]}),a.jsx("p",{children:"This will permanently delete all learning progress, achievements, and data associated with this profile. This action cannot be undone."}),f.submit&&a.jsx("div",{className:"modal-error",children:f.submit}),a.jsxs("div",{className:"delete-actions",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>p(!1),disabled:d,children:"Cancel"}),a.jsx("button",{type:"button",className:"btn-danger",onClick:w,disabled:d,children:d?"Deleting...":"Delete Profile"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"modal-header edit-header",children:a.jsxs("div",{className:"edit-child-info",children:[a.jsx("div",{className:"edit-avatar",children:S(x.avatarId)}),a.jsxs("div",{children:[a.jsx("h2",{children:"Edit Profile"}),a.jsx("p",{className:"modal-subtitle",children:n.displayName})]})]})}),a.jsxs("div",{className:"modal-tabs",children:[a.jsx("button",{className:`modal-tab ${o==="profile"?"active":""}`,onClick:()=>c("profile"),children:"Profile"}),a.jsx("button",{className:`modal-tab ${o==="avatar"?"active":""}`,onClick:()=>c("avatar"),children:"Avatar"}),a.jsx("button",{className:`modal-tab ${o==="learning"?"active":""}`,onClick:()=>c("learning"),children:"Learning"})]}),f.submit&&a.jsx("div",{className:"modal-error",children:f.submit}),a.jsxs("div",{className:"modal-body",children:[o==="profile"&&a.jsxs("div",{className:"form-step",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Display Name"}),a.jsx("input",{type:"text",name:"displayName",value:x.displayName,onChange:b,placeholder:"Child's name",className:f.displayName?"error":""}),f.displayName&&a.jsx("span",{className:"field-error",children:f.displayName}),a.jsx("span",{className:"field-hint",children:"This is the name Jeffrey will use"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Curriculum"}),a.jsx("select",{name:"curriculumType",value:x.curriculumType,onChange:b,children:Nge.map(k=>a.jsx("option",{value:k.value,children:k.label},k.value))})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Preferred Language"}),a.jsxs("select",{name:"language",value:x.language,onChange:b,children:[a.jsx("option",{value:"en",children:"English"}),a.jsx("option",{value:"ar",children:"Arabic"})]})]}),a.jsxs("div",{className:"info-box",children:[a.jsx("span",{className:"info-icon",children:""}),a.jsx("p",{children:"Age and grade level cannot be changed after profile creation. Contact support if you need to update these."})]})]}),o==="avatar"&&a.jsx("div",{className:"form-step",children:a.jsx("div",{className:"avatar-grid",children:Yz.map(k=>a.jsxs("button",{type:"button",className:`avatar-option ${x.avatarId===k.id?"selected":""}`,onClick:()=>g(_=>({..._,avatarId:k.id})),children:[a.jsx("span",{className:"avatar-emoji",children:k.emoji}),a.jsx("span",{className:"avatar-name",children:k.name})]},k.id))})}),o==="learning"&&a.jsxs("div",{className:"form-step",children:[a.jsx("label",{className:"section-label",children:"Learning Style"}),a.jsx("div",{className:"learning-options",children:Cge.map(k=>a.jsxs("button",{type:"button",className:`learning-option ${x.learningStyle===k.value?"selected":""}`,onClick:()=>g(_=>({..._,learningStyle:k.value})),children:[a.jsx("span",{className:"learning-icon",children:k.icon}),a.jsxs("div",{className:"learning-text",children:[a.jsx("span",{className:"learning-label",children:k.label}),a.jsx("span",{className:"learning-desc",children:k.description})]})]},k.value))})]})]}),a.jsxs("div",{className:"modal-footer edit-footer",children:[a.jsx("button",{type:"button",className:"btn-delete",onClick:()=>p(!0),children:"Delete Profile"}),a.jsxs("div",{className:"footer-right",children:[a.jsx("button",{type:"button",className:"btn-secondary",onClick:e,children:"Cancel"}),a.jsx("button",{type:"button",className:"btn-primary",onClick:C,disabled:d,children:d?"Saving...":"Save Changes"})]})]})]})]})})},jge=()=>{const n=Qt(),{user:e,maxChildrenAllowed:t,canAddChild:s,refreshAuth:i}=Vt(),[r,o]=N.useState([]),[c,d]=N.useState(!0),[h,u]=N.useState(null),[p,f]=N.useState(!1),[m,x]=N.useState(null),g=async()=>{try{d(!0),u(null);const S=await B3.getDashboard();S.success&&o(S.data.children||[])}catch(S){console.error("Failed to fetch children:",S),u(S.message||"Failed to load children")}finally{d(!1)}};N.useEffect(()=>{g()},[]);const b=async()=>{f(!1),await i(),await g()},y=async()=>{x(null),await i(),await g()},C=async()=>{x(null),await i(),await g()};if(c)return a.jsx("div",{className:"my-children-page",children:a.jsxs("div",{className:"page-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading children..."})]})});if(h)return a.jsx("div",{className:"my-children-page",children:a.jsxs("div",{className:"page-error",children:[a.jsx("p",{children:"Unable to load children"}),a.jsx("p",{className:"error-message",children:h}),a.jsx("button",{onClick:g,children:"Try Again"})]})});const w=r.length>0;return a.jsxs("div",{className:"my-children-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsxs("div",{className:"header-content",children:[a.jsx("h1",{children:"My Children"}),a.jsx("p",{children:w?`Managing ${r.length} of ${t} profile${t>1?"s":""}`:"Add your first child to get started"})]}),s&&a.jsxs("button",{className:"add-child-btn",onClick:()=>f(!0),children:[a.jsx("span",{className:"btn-icon",children:"+"}),"Add Child"]})]}),w?a.jsxs("div",{className:"children-grid",children:[r.map(S=>a.jsx(Age,{child:S,onViewDetails:()=>n(`/parent/children/${S.id}`),onEdit:()=>x(S)},S.id)),s&&a.jsxs("button",{className:"add-child-card",onClick:()=>f(!0),children:[a.jsx("div",{className:"add-icon",children:"+"}),a.jsx("span",{children:"Add Another Child"})]})]}):a.jsxs("div",{className:"empty-state",children:[a.jsxs("div",{className:"empty-illustration",children:[a.jsx("span",{className:"empty-emoji",children:""}),a.jsx("span",{className:"empty-emoji",children:""})]}),a.jsx("h2",{children:"No Children Yet"}),a.jsx("p",{children:"Add your first child to start their learning journey with Jeffrey!"}),a.jsxs("button",{className:"add-child-btn-large",onClick:()=>f(!0),children:[a.jsx("span",{className:"btn-icon",children:"+"}),"Add Your First Child"]})]}),!s&&w&&a.jsxs("div",{className:"subscription-notice",children:[a.jsx("div",{className:"notice-icon",children:"i"}),a.jsxs("div",{className:"notice-content",children:[a.jsxs("p",{children:["You've reached the maximum of ",t," child profile",t>1?"s":""," for your plan."]}),a.jsx("button",{className:"upgrade-link",onClick:()=>n("/parent/billing"),children:"Upgrade to add more"})]})]}),p&&a.jsx(Sge,{onClose:()=>f(!1),onSuccess:b}),m&&a.jsx(sQ,{child:m,onClose:()=>x(null),onSuccess:y,onDelete:C})]})},Age=({child:n,onViewDetails:e,onEdit:t})=>{const s=(r,o)=>r&&r.startsWith("avatar_")&&{avatar_1:"",avatar_2:"",avatar_3:"",avatar_4:"",avatar_5:"",avatar_6:"",avatar_7:"",avatar_8:""}[r]||(o==="YOUNG"?"":""),i=r=>r===0?"Pre-K":`Grade ${r}`;return a.jsxs("div",{className:"child-card",children:[a.jsxs("div",{className:"card-header",children:[a.jsx("div",{className:"child-avatar",children:n.avatarUrl&&!n.avatarUrl.startsWith("avatar_")?a.jsx("img",{src:n.avatarUrl,alt:n.displayName}):a.jsx("span",{className:"avatar-emoji",children:s(n.avatarUrl,n.ageGroup)})}),a.jsx("button",{className:"edit-btn",onClick:t,title:"Edit profile",children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),a.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]}),a.jsxs("div",{className:"card-body",children:[a.jsx("h3",{className:"child-name",children:n.displayName}),a.jsxs("div",{className:"child-meta",children:[a.jsxs("span",{children:[n.age," years old"]}),a.jsx("span",{className:"meta-dot",children:""}),a.jsx("span",{children:i(n.gradeLevel)})]}),a.jsxs("div",{className:"stats-row",children:[a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:n.lessonsCompleted}),a.jsx("span",{className:"stat-label",children:"Lessons"})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:n.currentStreak}),a.jsx("span",{className:"stat-label",children:"Streak"})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:n.level}),a.jsx("span",{className:"stat-label",children:"Level"})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-value",children:n.xp}),a.jsx("span",{className:"stat-label",children:"XP"})]})]}),a.jsxs("div",{className:"activity-status",children:[a.jsx("span",{className:`status-dot ${n.wasActiveToday?"active":""}`}),a.jsx("span",{className:"status-text",children:n.wasActiveToday?"Active today":`Last active: ${n.lastActive}`})]}),n.recentBadges&&n.recentBadges.length>0&&a.jsxs("div",{className:"recent-badges",children:[a.jsx("span",{className:"badges-label",children:"Recent badges:"}),a.jsx("div",{className:"badges-list",children:n.recentBadges.slice(0,3).map((r,o)=>a.jsx("span",{className:"badge-icon",title:r.name,children:r.icon},o))})]})]}),a.jsx("div",{className:"card-footer",children:a.jsxs("button",{className:"view-details-btn",onClick:e,children:["View Details",a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})})]})},Ege=()=>{var _,L;const{childId:n}=DL(),e=Qt(),[t,s]=N.useState(null),[i,r]=N.useState(null),[o,c]=N.useState([]),[d,h]=N.useState(!0),[u,p]=N.useState(null),[f,m]=N.useState(!1),[x,g]=N.useState("overview"),b=async()=>{try{h(!0),p(null);const[D,P,I]=await Promise.all([$1.getProfile(n),fM.getChildStats(n),B3.getChildActivity(n,20)]);if(D.success){const M=D.data;s(M)}P.success&&r(P.data),I.success&&c(I.data.activities||[])}catch(D){console.error("Failed to fetch child data:",D),p(D.message||"Failed to load child data")}finally{h(!1)}};N.useEffect(()=>{n&&b()},[n]);const y=()=>{m(!1),b()},C=()=>{e("/parent/children")};if(d)return a.jsx("div",{className:"child-details-page",children:a.jsxs("div",{className:"page-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading profile..."})]})});if(u)return a.jsx("div",{className:"child-details-page",children:a.jsxs("div",{className:"page-error",children:[a.jsx("p",{children:"Unable to load profile"}),a.jsx("p",{className:"error-message",children:u}),a.jsx("button",{onClick:b,children:"Try Again"})]})});if(!t)return a.jsx("div",{className:"child-details-page",children:a.jsxs("div",{className:"page-error",children:[a.jsx("p",{children:"Child not found"}),a.jsx("button",{onClick:()=>e("/parent/children"),children:"Back to Children"})]})});const w=(D,P)=>D&&D.startsWith("avatar_")&&{avatar_1:"",avatar_2:"",avatar_3:"",avatar_4:"",avatar_5:"",avatar_6:"",avatar_7:"",avatar_8:""}[D]||(P==="YOUNG"?"":""),S=D=>D===0?"Pre-K":`Grade ${D}`,j=D=>({VISUAL:{label:"Visual Learner",icon:"",description:"Learns best with pictures and diagrams"},AUDITORY:{label:"Auditory Learner",icon:"",description:"Learns best by listening"},READING:{label:"Reading/Writing",icon:"",description:"Learns best through reading and writing"},KINESTHETIC:{label:"Hands-on Learner",icon:"",description:"Learns best by doing activities"}})[D]||{label:D,icon:"",description:""},T=D=>({AMERICAN:"American (Common Core)",BRITISH:"British (IGCSE)",INDIAN_CBSE:"Indian (CBSE)",INDIAN_ICSE:"Indian (ICSE)",IB:"International Baccalaureate",ARABIC:"Arabic Curriculum"})[D]||D,k=j(t.learningStyle);return a.jsxs("div",{className:"child-details-page",children:[a.jsxs("button",{className:"back-btn",onClick:()=>e("/parent/children"),children:[a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back to Children"]}),a.jsxs("div",{className:"profile-header",children:[a.jsx("div",{className:"profile-avatar",children:t.avatarUrl&&!t.avatarUrl.startsWith("avatar_")?a.jsx("img",{src:t.avatarUrl,alt:t.displayName}):a.jsx("span",{className:"avatar-emoji",children:w(t.avatarUrl,t.ageGroup)})}),a.jsxs("div",{className:"profile-info",children:[a.jsx("h1",{children:t.displayName}),a.jsxs("div",{className:"profile-meta",children:[a.jsxs("span",{className:"meta-item",children:[a.jsx("span",{className:"meta-icon",children:""}),t.ageGroup==="YOUNG"?"4-7":"8-12"," years old"]}),a.jsxs("span",{className:"meta-item",children:[a.jsx("span",{className:"meta-icon",children:""}),S(t.gradeLevel)]}),a.jsxs("span",{className:"meta-item",children:[a.jsx("span",{className:"meta-icon",children:k.icon}),k.label]})]})]}),a.jsxs("button",{className:"edit-profile-btn",onClick:()=>m(!0),children:[a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),a.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),"Edit Profile"]})]}),i&&a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card primary",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-value",children:i.xp.toLocaleString()}),a.jsx("span",{className:"stat-label",children:"Total XP"})]}),a.jsxs("div",{className:"stat-progress",children:[a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${i.percentToNextLevel}%`}})}),a.jsxs("span",{className:"progress-text",children:[i.xpToNextLevel," XP to Level ",i.level+1]})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-value",children:i.level}),a.jsx("span",{className:"stat-label",children:"Current Level"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-value",children:((_=i.streak)==null?void 0:_.current)||0}),a.jsx("span",{className:"stat-label",children:"Day Streak"})]}),((L=i.streak)==null?void 0:L.longest)>0&&a.jsxs("span",{className:"stat-badge",children:["Best: ",i.streak.longest]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-value",children:i.lessonsCompleted}),a.jsx("span",{className:"stat-label",children:"Lessons Done"})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-content",children:[a.jsx("span",{className:"stat-value",children:i.badgesEarned}),a.jsx("span",{className:"stat-label",children:"Badges Earned"})]}),a.jsxs("span",{className:"stat-badge secondary",children:[i.totalBadges," available"]})]})]}),(i==null?void 0:i.xpStats)&&a.jsxs("div",{className:"xp-breakdown",children:[a.jsx("h3",{children:"XP Progress"}),a.jsxs("div",{className:"xp-cards",children:[a.jsxs("div",{className:"xp-card",children:[a.jsx("span",{className:"xp-period",children:"Today"}),a.jsx("span",{className:"xp-value",children:i.xpStats.todayXP}),a.jsx("span",{className:"xp-unit",children:"XP"})]}),a.jsxs("div",{className:"xp-card",children:[a.jsx("span",{className:"xp-period",children:"This Week"}),a.jsx("span",{className:"xp-value",children:i.xpStats.weekXP}),a.jsx("span",{className:"xp-unit",children:"XP"})]}),a.jsxs("div",{className:"xp-card",children:[a.jsx("span",{className:"xp-period",children:"This Month"}),a.jsx("span",{className:"xp-value",children:i.xpStats.monthXP}),a.jsx("span",{className:"xp-unit",children:"XP"})]}),a.jsxs("div",{className:"xp-card highlight",children:[a.jsx("span",{className:"xp-period",children:"Daily Average"}),a.jsx("span",{className:"xp-value",children:Math.round(i.xpStats.averageDailyXP)}),a.jsx("span",{className:"xp-unit",children:"XP/day"})]})]})]}),(i==null?void 0:i.recentBadges)&&i.recentBadges.length>0&&a.jsxs("div",{className:"recent-badges-section",children:[a.jsx("h3",{children:"Recent Badges"}),a.jsx("div",{className:"badges-grid",children:i.recentBadges.map((D,P)=>a.jsxs("div",{className:"badge-card",children:[a.jsx("span",{className:"badge-icon",children:D.icon}),a.jsx("span",{className:"badge-name",children:D.name}),a.jsx("span",{className:"badge-date",children:new Date(D.earnedAt).toLocaleDateString()})]},P))})]}),a.jsxs("div",{className:"tabs-container",children:[a.jsxs("div",{className:"tabs-header",children:[a.jsx("button",{className:`tab-btn ${x==="overview"?"active":""}`,onClick:()=>g("overview"),children:"Overview"}),a.jsx("button",{className:`tab-btn ${x==="activity"?"active":""}`,onClick:()=>g("activity"),children:"Activity"}),a.jsx("button",{className:`tab-btn ${x==="settings"?"active":""}`,onClick:()=>g("settings"),children:"Settings"})]}),a.jsxs("div",{className:"tab-content",children:[x==="overview"&&a.jsx("div",{className:"overview-tab",children:a.jsxs("div",{className:"info-section",children:[a.jsx("h4",{children:"Learning Profile"}),a.jsxs("div",{className:"info-grid",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("span",{className:"info-label",children:"Learning Style"}),a.jsxs("span",{className:"info-value",children:[k.icon," ",k.label]}),a.jsx("span",{className:"info-description",children:k.description})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("span",{className:"info-label",children:"Curriculum"}),a.jsx("span",{className:"info-value",children:T(t.curriculumType)})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("span",{className:"info-label",children:"Preferred Language"}),a.jsx("span",{className:"info-value",children:t.preferredLanguage==="en"?"English":t.preferredLanguage})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("span",{className:"info-label",children:"Member Since"}),a.jsx("span",{className:"info-value",children:new Date(t.createdAt).toLocaleDateString()})]})]})]})}),x==="activity"&&a.jsx("div",{className:"activity-tab",children:o.length>0?a.jsx("div",{className:"activity-list",children:o.map(D=>a.jsxs("div",{className:"activity-item",children:[a.jsx("div",{className:"activity-icon",children:D.icon}),a.jsxs("div",{className:"activity-content",children:[a.jsx("span",{className:"activity-description",children:D.description}),a.jsx("span",{className:"activity-time",children:new Date(D.timestamp).toLocaleString()})]})]},D.id))}):a.jsxs("div",{className:"empty-activity",children:[a.jsx("span",{className:"empty-icon",children:""}),a.jsx("p",{children:"No recent activity"}),a.jsx("span",{className:"empty-hint",children:"Activity will appear here as your child learns"})]})}),x==="settings"&&a.jsx("div",{className:"settings-tab",children:a.jsxs("div",{className:"settings-section",children:[a.jsx("h4",{children:"Profile Actions"}),a.jsxs("div",{className:"settings-actions",children:[a.jsxs("button",{className:"settings-btn",onClick:()=>m(!0),children:[a.jsx("span",{className:"settings-btn-icon",children:""}),a.jsxs("div",{className:"settings-btn-content",children:[a.jsx("span",{className:"settings-btn-title",children:"Edit Profile"}),a.jsx("span",{className:"settings-btn-desc",children:"Update name, avatar, and preferences"})]})]}),a.jsxs("button",{className:"settings-btn",onClick:()=>e(`/parent/children/${n}/notebook`),children:[a.jsx("span",{className:"settings-btn-icon",children:""}),a.jsxs("div",{className:"settings-btn-content",children:[a.jsx("span",{className:"settings-btn-title",children:"View Notebook"}),a.jsx("span",{className:"settings-btn-desc",children:"See notes and leave encouragement"})]})]}),a.jsxs("button",{className:"settings-btn",onClick:()=>e(`/parent/children/${n}/safety`),children:[a.jsx("span",{className:"settings-btn-icon",children:""}),a.jsxs("div",{className:"settings-btn-content",children:[a.jsx("span",{className:"settings-btn-title",children:"Safety Settings"}),a.jsx("span",{className:"settings-btn-desc",children:"Manage content filters and restrictions"})]})]}),a.jsxs("button",{className:"settings-btn",onClick:()=>e(`/parent/children/${n}/progress`),children:[a.jsx("span",{className:"settings-btn-icon",children:""}),a.jsxs("div",{className:"settings-btn-content",children:[a.jsx("span",{className:"settings-btn-title",children:"Progress Report"}),a.jsx("span",{className:"settings-btn-desc",children:"View detailed learning analytics"})]})]})]})]})})]})]}),f&&a.jsx(sQ,{child:t,onClose:()=>m(!1),onSuccess:y,onDelete:C})]})},kge=()=>{const n=Qt(),{signIn:e,isLoading:t,isAuthenticated:s,hasConsent:i,children:r,needsEmailVerification:o,needsConsent:c,needsChildProfile:d,isReady:h}=Vt(),[u,p]=N.useState({email:"",password:""}),[f,m]=N.useState({}),[x,g]=N.useState(""),[b,y]=N.useState(!1),C=N.useRef(!1);N.useEffect(()=>{if(h&&s){let T="/learn",k;o?(T="/onboarding",k={step:"email_verification"}):c?(T="/onboarding",k={step:"consent_method"}):d&&(T="/onboarding",k={step:"create_profile"}),C.current?(C.current=!1,window.location.href=T):n(T,k?{state:k,replace:!0}:{replace:!0})}},[s,i,r,o,c,d,h,n]);const w=()=>{const T={},k=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;return u.email?k.test(u.email)||(T.email="Please enter a valid email address"):T.email="Email is required",u.password||(T.password="Password is required"),m(T),Object.keys(T).length===0},S=T=>{const{name:k,value:_}=T.target;p(L=>({...L,[k]:_})),f[k]&&m(L=>({...L,[k]:""})),g("")},j=async T=>{if(T.preventDefault(),!!w()){g("");try{C.current=!0,await e(u.email,u.password)}catch(k){C.current=!1,g(k.message||"Failed to sign in. Please check your credentials.")}}};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-teal-50 flex flex-col",children:[a.jsx("header",{className:"p-6",children:a.jsx(qe,{to:"/",className:"flex items-center w-fit",children:a.jsx("img",{src:"/assets/orbit-learn-logo.png",alt:"OrbitLearn",className:"h-16 md:h-20 w-auto rounded-xl"})})}),a.jsx("main",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[a.jsxs("div",{className:"bg-white rounded-3xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] p-8",children:[a.jsx("div",{className:"flex justify-center -mt-16 mb-4",children:a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey",className:"w-24 h-24 rounded-full border-4 border-white shadow-lg object-cover"})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-black font-comic mb-2",children:"Welcome Back!"}),a.jsx("p",{className:"text-gray-600",children:"Sign in to continue learning with Jeffrey"})]}),x&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-xl text-red-600 text-sm",children:x}),a.jsxs("form",{onSubmit:j,noValidate:!0,children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-bold mb-2",children:"Email Address"}),a.jsx("input",{type:"email",name:"email",className:`w-full px-4 py-3 rounded-xl border-2 ${f.email?"border-red-400":"border-gray-200"} focus:border-nanobanana-blue focus:outline-none transition-colors`,placeholder:"parent@example.com",value:u.email,onChange:S,autoComplete:"email"}),f.email&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:f.email})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-bold mb-2",children:"Password"}),a.jsx("input",{type:"password",name:"password",className:`w-full px-4 py-3 rounded-xl border-2 ${f.password?"border-red-400":"border-gray-200"} focus:border-nanobanana-blue focus:outline-none transition-colors`,placeholder:"Your password",value:u.password,onChange:S,autoComplete:"current-password"}),f.password&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:f.password})]}),a.jsx("button",{type:"submit",disabled:t,className:"w-full bg-nanobanana-yellow text-black font-bold py-4 rounded-xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[-2px] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] active:translate-y-[2px] active:shadow-none transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign In"})]}),a.jsxs("div",{className:"flex items-center my-6",children:[a.jsx("div",{className:"flex-1 border-t-2 border-gray-200"}),a.jsx("span",{className:"px-4 text-gray-400 text-sm",children:"or"}),a.jsx("div",{className:"flex-1 border-t-2 border-gray-200"})]}),a.jsxs("p",{className:"text-center text-gray-600",children:["Don't have an account?"," ",a.jsx(qe,{to:"/onboarding",className:"text-nanobanana-blue font-bold hover:underline",children:"Sign up"})]}),a.jsx("div",{className:"text-center mt-4",children:a.jsx("button",{type:"button",className:"text-nanobanana-blue font-medium hover:underline",onClick:()=>y(!0),children:"Forgot your password?"})})]}),a.jsxs("div",{className:"text-center mt-6 text-sm text-gray-500",children:[a.jsxs("p",{children:["By creating an account, you agree to our"," ",a.jsx("a",{href:"/terms",className:"text-nanobanana-blue hover:underline",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"/privacy",className:"text-nanobanana-blue hover:underline",children:"Privacy Policy"}),"."]}),a.jsxs("p",{className:"mt-2",children:["We take your child's privacy seriously."," ",a.jsx("a",{href:"/coppa",className:"text-nanobanana-blue hover:underline",children:"Learn about our COPPA compliance"}),"."]})]})]})}),a.jsx(tQ,{isOpen:b,onClose:()=>y(!1)})]})},Tge=["","","","","","","",""],_ge=()=>{const{childId:n}=DL(),e=Qt(),[t,s]=N.useState(null),[i,r]=N.useState([]),[o,c]=N.useState({}),[d,h]=N.useState(null),[u,p]=N.useState(!0),[f,m]=N.useState(null),[x,g]=N.useState("all"),[b,y]=N.useState(""),[C,w]=N.useState(null),[S,j]=N.useState(""),[T,k]=N.useState(""),[_,L]=N.useState(!1),D=N.useCallback(async()=>{if(n)try{p(!0),m(null);const[$,G,ne]=await Promise.all([$1.getProfile(n),nl.getChildNotes(n,{grouped:!0}),nl.getChildNoteStats(n)]);$.success&&s($.data),G.success&&(r(G.data.notes||[]),c(G.data.bySubject||{})),ne.success&&h(ne.data)}catch($){console.error("Failed to fetch notebook data:",$),m($.message||"Failed to load notebook")}finally{p(!1)}},[n]);N.useEffect(()=>{D()},[D]);const P=i.filter($=>{const G=x==="all"||$.subject===x,ne=!b||$.title.toLowerCase().includes(b.toLowerCase())||$.content.toLowerCase().includes(b.toLowerCase());return G&&ne}),I=["all",...Object.keys(o)],M=async()=>{if(!(!C||!S.trim()&&!T)){L(!0);try{const $=await nl.addComment(C.id,{content:S.trim(),emoji:T||null});$.success&&(w(G=>({...G,parentComments:[...G.parentComments||[],$.data]})),j(""),k(""))}catch($){console.error("Failed to add comment:",$)}finally{L(!1)}}},O=async $=>{if(C)try{(await nl.deleteComment(C.id,$)).success&&w(ne=>({...ne,parentComments:ne.parentComments.filter(Z=>Z.id!==$)}))}catch(G){console.error("Failed to delete comment:",G)}},F=async $=>{try{const G=await nl.getNoteForParent($.id);G.success?w(G.data):w($)}catch(G){console.error("Failed to fetch note details:",G),w($)}},B=$=>al[$]||{emoji:"",label:$||"General",color:"bg-gray-100"},U=$=>{const G=new Date($),Z=Math.floor((new Date-G)/(1e3*60*60*24));return Z===0?"Today":Z===1?"Yesterday":Z<7?`${Z} days ago`:G.toLocaleDateString()};return u?a.jsx("div",{className:"min-h-full flex items-center justify-center p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx(R.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-pink-400 border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading notebook..."})]})}):f?a.jsx("div",{className:"min-h-full flex items-center justify-center p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:""}),a.jsx("h2",{className:"text-xl font-bold mb-2",children:"Oops!"}),a.jsx("p",{className:"text-gray-600 mb-4",children:f}),a.jsx("button",{onClick:D,className:"px-4 py-2 bg-pink-400 text-white rounded-lg hover:bg-pink-500 transition-colors",children:"Try Again"})]})}):a.jsxs("div",{className:"min-h-full p-6",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[a.jsx("button",{onClick:()=>e(`/parent/children/${n}`),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(wE,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[a.jsx(dM,{className:"w-6 h-6 text-pink-500"}),t==null?void 0:t.displayName,"'s Notebook"]}),a.jsx("p",{className:"text-gray-600 text-sm",children:"View and comment on your child's notes"})]})]}),d&&a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-pink-500",children:d.totalNotes}),a.jsx("div",{className:"text-sm text-gray-600",children:"Total Notes"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-500",children:Object.keys(d.bySubject||{}).length}),a.jsx("div",{className:"text-sm text-gray-600",children:"Subjects"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-green-500",children:d.thisWeek||0}),a.jsx("div",{className:"text-sm text-gray-600",children:"This Week"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-purple-500",children:d.totalComments||0}),a.jsx("div",{className:"text-sm text-gray-600",children:"Your Comments"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(D1,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx("input",{type:"text",value:b,onChange:$=>y($.target.value),placeholder:"Search notes...",className:"w-full pl-10 pr-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-pink-400"})]}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:I.map($=>{const G=$==="all"?{emoji:"",label:"All"}:B($);return a.jsxs("button",{onClick:()=>g($),className:`flex items-center gap-1 px-3 py-2 rounded-lg border-2 whitespace-nowrap transition-all ${x===$?"bg-pink-100 border-pink-400 text-pink-700":"bg-white border-gray-200 hover:border-pink-300"}`,children:[a.jsx("span",{children:G.emoji}),a.jsx("span",{className:"text-sm font-medium",children:G.label})]},$)})})]}),P.length>0?a.jsx("div",{className:"space-y-3",children:a.jsx(Ie,{children:P.map($=>{const G=B($.subject),ne=(C==null?void 0:C.id)===$.id;return a.jsx(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},onClick:()=>F($),className:`p-4 bg-white rounded-xl border-2 cursor-pointer transition-all ${ne?"border-pink-400 shadow-lg":"border-gray-200 hover:border-pink-300 hover:shadow-md"}`,children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-3 h-full min-h-[60px] rounded-full flex-shrink-0",style:{backgroundColor:$.coverColor||gO[0].value}}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsx("h3",{className:"font-bold text-gray-900 truncate",children:$.title}),a.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500 whitespace-nowrap",children:[a.jsx(s3,{className:"w-3 h-3"}),U($.createdAt)]})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-1 mb-2",children:[a.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs ${G.color}`,children:[G.emoji," ",G.label]}),$.lesson&&a.jsxs("span",{className:"text-xs text-gray-500",children:['from "',$.lesson.title,'"']})]}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",dangerouslySetInnerHTML:{__html:$.content.substring(0,150)+($.content.length>150?"...":"")}}),$.parentComments&&$.parentComments.length>0&&a.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-pink-500",children:[a.jsx(Ru,{className:"w-3 h-3"}),$.parentComments.length," comment",$.parentComments.length!==1?"s":""]})]}),a.jsx(No,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})},$.id)})})}):a.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:[a.jsx(js,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),a.jsx("h3",{className:"font-bold text-gray-600 mb-1",children:"No notes yet"}),a.jsxs("p",{className:"text-sm text-gray-500",children:[t==null?void 0:t.displayName,"'s notes will appear here"]})]})]}),a.jsx("div",{className:"lg:col-span-1",children:a.jsx(Ie,{mode:"wait",children:C?a.jsxs(R.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"bg-white rounded-xl border-2 border-gray-200 sticky top-6",children:[a.jsxs("div",{className:"p-4 rounded-t-xl border-b-2 border-gray-200",style:{backgroundColor:C.coverColor||gO[0].value},children:[a.jsx("h3",{className:"font-bold text-lg text-gray-900",children:C.title}),a.jsx("p",{className:"text-sm text-gray-700 mt-1",children:U(C.createdAt)})]}),a.jsxs("div",{className:"p-4 max-h-[300px] overflow-y-auto border-b border-gray-100",children:[a.jsx("div",{className:"prose prose-sm max-w-none text-gray-700",dangerouslySetInnerHTML:{__html:C.content}}),C.originalText&&a.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Original highlight:"}),a.jsxs("p",{className:"text-sm text-gray-600 italic",children:['"',C.originalText,'"']})]})]}),a.jsxs("div",{className:"p-4",children:[a.jsxs("h4",{className:"font-bold text-sm mb-3 flex items-center gap-2",children:[a.jsx(Ru,{className:"w-4 h-4 text-pink-500"}),"Your Comments"]}),C.parentComments&&C.parentComments.length>0?a.jsx("div",{className:"space-y-3 mb-4 max-h-[200px] overflow-y-auto",children:C.parentComments.map($=>a.jsxs("div",{className:"bg-pink-50 rounded-lg p-3 relative group",children:[$.emoji&&a.jsx("span",{className:"text-xl mb-1 block",children:$.emoji}),a.jsx("p",{className:"text-sm text-gray-700",children:$.content}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:U($.createdAt)}),a.jsx("button",{onClick:()=>O($.id),className:"absolute top-2 right-2 p-1 opacity-0 group-hover:opacity-100 hover:bg-pink-200 rounded transition-all",children:a.jsx(um,{className:"w-3 h-3 text-pink-600"})})]},$.id))}):a.jsxs("div",{className:"text-center py-4 text-sm text-gray-500 mb-4",children:[a.jsx(Ut,{className:"w-5 h-5 mx-auto mb-1 text-gray-300"}),"No comments yet. Leave some encouragement!"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex flex-wrap gap-1",children:Tge.map($=>a.jsx("button",{onClick:()=>k(T===$?"":$),className:`text-xl p-1 rounded transition-all ${T===$?"bg-pink-200 scale-110":"hover:bg-gray-100"}`,children:$},$))}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:S,onChange:$=>j($.target.value),placeholder:"Add a comment...",className:"flex-1 px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-pink-400 text-sm",onKeyPress:$=>$.key==="Enter"&&M()}),a.jsx("button",{onClick:M,disabled:_||!S.trim()&&!T,className:"p-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a.jsx(AN,{className:"w-4 h-4"})})]})]})]})]},C.id):a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 p-8 text-center",children:[a.jsx(dM,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),a.jsx("h3",{className:"font-bold text-gray-600 mb-1",children:"Select a note"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Click on a note to view details and add comments"})]})})})]})]})},E_={getIncidents:async(n={})=>{const e=new URLSearchParams;n.childId&&e.append("childId",n.childId),n.severity&&e.append("severity",n.severity),n.incidentType&&e.append("incidentType",n.incidentType),n.startDate&&e.append("startDate",n.startDate),n.endDate&&e.append("endDate",n.endDate),n.reviewed!==void 0&&e.append("reviewed",n.reviewed),n.page&&e.append("page",n.page.toString()),n.limit&&e.append("limit",n.limit.toString()),n.sortBy&&e.append("sortBy",n.sortBy),n.sortOrder&&e.append("sortOrder",n.sortOrder);const t=e.toString(),s=`/parent/safety/incidents${t?`?${t}`:""}`;return ue(s,{method:"GET"})},getSummary:async()=>ue("/parent/safety/summary",{method:"GET"}),getIncidentDetail:async n=>ue(`/parent/safety/incidents/${n}`,{method:"GET"}),markAsReviewed:async(n,e="acknowledged")=>ue(`/parent/safety/incidents/${n}`,{method:"PATCH",body:JSON.stringify({action:e})})},Pge={PROFANITY:{icon:"",label:"Profanity",description:"Language containing profane or inappropriate words"},PII_DETECTED:{icon:"",label:"Personal Information",description:"Attempt to share personal identifying information"},INAPPROPRIATE_TOPIC:{icon:"",label:"Inappropriate Topic",description:"Discussion of topics not suitable for children"},JAILBREAK_ATTEMPT:{icon:"",label:"Jailbreak Attempt",description:"Attempt to bypass AI safety guidelines"},HARMFUL_CONTENT:{icon:"",label:"Harmful Content",description:"Content that could be harmful to children"},BLOCKED_BY_GEMINI:{icon:"",label:"Blocked by AI",description:"Content blocked by AI safety filters"},PARENT_OVERRIDE:{icon:"",label:"Parent Override",description:"Action overridden by parent settings"}},Lge={LOW:{label:"Low",className:"severity-low",description:"Minor concern, informational only"},MEDIUM:{label:"Medium",className:"severity-medium",description:"Moderate concern, review recommended"},HIGH:{label:"High",className:"severity-high",description:"Significant concern, action may be needed"},CRITICAL:{label:"Critical",className:"severity-critical",description:"Serious concern, immediate attention required"}},Dge=[{value:"acknowledged",label:"Acknowledge",icon:"",description:"Mark as seen and reviewed"},{value:"discussed_with_child",label:"Discussed",icon:"",description:"Had a conversation with child about this"},{value:"restricted",label:"Restricted",icon:"",description:"Added restrictions based on this incident"},{value:"dismissed",label:"Dismiss",icon:"",description:"Not a concern, dismiss this incident"}];function Xz(n){return new Date(n).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}const Rge=({incident:n,onClose:e,onMarkReviewed:t})=>{const[s,i]=N.useState(null),[r,o]=N.useState(!0),[c,d]=N.useState("acknowledged"),[h,u]=N.useState(!1);N.useEffect(()=>{(async()=>{try{o(!0);const b=await E_.getIncidentDetail(n.id);b.success&&i(b.data)}catch(b){console.error("Failed to fetch incident details:",b)}finally{o(!1)}})()},[n.id]);const p=async()=>{try{u(!0),await t(n.id,c)}catch(g){console.error("Failed to mark as reviewed:",g)}finally{u(!1)}};N.useEffect(()=>{const g=b=>{b.key==="Escape"&&e()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[e]);const f=Pge[n.incidentType]||{icon:"",label:n.incidentType},m=Lge[n.severity]||{label:n.severity,className:""},x=s||n;return a.jsx("div",{className:"modal-overlay",onClick:e,children:a.jsxs("div",{className:"modal-container incident-modal",onClick:g=>g.stopPropagation(),children:[a.jsx("button",{className:"modal-close",onClick:e,children:a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),a.jsxs("div",{className:"incident-header",children:[a.jsxs("div",{className:"incident-badges",children:[a.jsx("span",{className:`severity-badge large ${m.className}`,children:m.label}),a.jsxs("span",{className:"type-badge",children:[a.jsx("span",{className:"type-icon",children:f.icon}),f.label]})]}),x.reviewed&&a.jsx("span",{className:"reviewed-badge",children:"Reviewed"})]}),a.jsx("div",{className:"incident-body",children:r?a.jsxs("div",{className:"loading-section",children:[a.jsx("div",{className:"loading-spinner-small"}),a.jsx("p",{children:"Loading details..."})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"incident-meta",children:[a.jsxs("div",{className:"meta-item",children:[a.jsx("span",{className:"meta-label",children:"Child"}),a.jsx("span",{className:"meta-value",children:x.childName})]}),a.jsxs("div",{className:"meta-item",children:[a.jsx("span",{className:"meta-label",children:"Time"}),a.jsx("span",{className:"meta-value",children:Xz(x.createdAt)})]}),a.jsxs("div",{className:"meta-item",children:[a.jsx("span",{className:"meta-label",children:"Action Taken"}),a.jsx("span",{className:`meta-value ${x.wasBlocked?"blocked":"allowed"}`,children:x.wasBlocked?"Blocked":"Allowed"})]})]}),a.jsxs("div",{className:"info-section",children:[a.jsxs("div",{className:"info-header",children:[a.jsx("span",{className:"info-icon",children:""}),a.jsx("span",{className:"info-title",children:"What happened"})]}),a.jsx("p",{className:"info-text",children:f.description})]}),(x.inputText||x.outputText)&&a.jsxs("div",{className:"context-section",children:[a.jsx("h4",{children:"Context"}),x.inputText&&a.jsxs("div",{className:"context-block",children:[a.jsx("span",{className:"context-label",children:"Child's Input:"}),a.jsx("p",{className:"context-text",children:x.inputText})]}),x.outputText&&a.jsxs("div",{className:"context-block",children:[a.jsx("span",{className:"context-label",children:"AI Response:"}),a.jsx("p",{className:"context-text",children:x.outputText})]})]}),x.flags&&x.flags.length>0&&a.jsxs("div",{className:"flags-section",children:[a.jsx("h4",{children:"Flagged Content"}),a.jsx("div",{className:"flags-list",children:x.flags.map((g,b)=>a.jsx("span",{className:"flag-pill",children:g},b))})]}),x.geminiSafetyRatings&&a.jsxs("div",{className:"ratings-section",children:[a.jsx("h4",{children:"AI Safety Ratings"}),a.jsx("div",{className:"ratings-grid",children:Object.entries(x.geminiSafetyRatings).map(([g,b])=>a.jsxs("div",{className:"rating-item",children:[a.jsx("span",{className:"rating-category",children:g.replace(/_/g," ")}),a.jsx("span",{className:`rating-value ${String(b).toLowerCase()}`,children:String(b)})]},g))})]}),!x.reviewed&&a.jsxs("div",{className:"action-section",children:[a.jsx("h4",{children:"Take Action"}),a.jsx("div",{className:"action-options",children:Dge.map(g=>a.jsxs("button",{className:`action-option ${c===g.value?"selected":""}`,onClick:()=>d(g.value),children:[a.jsx("span",{className:"action-icon",children:g.icon}),a.jsxs("div",{className:"action-text",children:[a.jsx("span",{className:"action-label",children:g.label}),a.jsx("span",{className:"action-desc",children:g.description})]})]},g.value))})]}),x.reviewed&&x.parentAction&&a.jsxs("div",{className:"reviewed-section",children:[a.jsx("h4",{children:"Review Status"}),a.jsxs("div",{className:"reviewed-info",children:[a.jsxs("span",{className:"reviewed-action",children:["Action: ",x.parentAction.replace(/_/g," ")]}),x.parentNotifiedAt&&a.jsxs("span",{className:"reviewed-date",children:["Reviewed on ",Xz(x.parentNotifiedAt)]})]})]})]})}),a.jsxs("div",{className:"incident-footer",children:[a.jsx("button",{className:"btn-secondary",onClick:e,children:"Close"}),!x.reviewed&&a.jsx("button",{className:"btn-primary",onClick:p,disabled:h||r,children:h?"Saving...":"Mark as Reviewed"})]})]})})},Kz={PROFANITY:{icon:"",label:"Profanity"},PII_DETECTED:{icon:"",label:"Personal Info"},INAPPROPRIATE_TOPIC:{icon:"",label:"Inappropriate Topic"},JAILBREAK_ATTEMPT:{icon:"",label:"Jailbreak Attempt"},HARMFUL_CONTENT:{icon:"",label:"Harmful Content"},BLOCKED_BY_GEMINI:{icon:"",label:"Blocked by AI"},PARENT_OVERRIDE:{icon:"",label:"Parent Override"}},Ige={LOW:{label:"Low",className:"severity-low"},MEDIUM:{label:"Medium",className:"severity-medium"},HIGH:{label:"High",className:"severity-high"},CRITICAL:{label:"Critical",className:"severity-critical"}};function Mge(n){const e=new Date(n),s=new Date-e,i=Math.floor(s/6e4),r=Math.floor(s/36e5),o=Math.floor(s/864e5);return i<1?"Just now":i<60?`${i}m ago`:r<24?`${r}h ago`:o===1?"Yesterday":o<7?`${o}d ago`:e.toLocaleDateString()}const Fge=()=>{var k,_,L,D;const[n,e]=N.useState(!0),[t,s]=N.useState(null),[i,r]=N.useState([]),[o,c]=N.useState(null),[d,h]=N.useState({page:1,limit:20,total:0,totalPages:0}),[u,p]=N.useState(null),[f,m]=N.useState({childId:"",severity:"",incidentType:"",reviewed:""});let x=[];try{const P=Vt();x=((k=P==null?void 0:P.user)==null?void 0:k.children)||[]}catch{}const g=N.useCallback(async(P=1)=>{try{e(!0),s(null);const[I,M]=await Promise.all([E_.getIncidents({...f,page:P,limit:d.limit}),E_.getSummary()]);I.success&&(r(I.data.incidents),h(I.data.pagination)),M.success&&c(M.data)}catch(I){console.error("Safety logs fetch error:",I),s(I.message||"Failed to load safety logs")}finally{e(!1)}},[f,d.limit]);N.useEffect(()=>{g()},[g]);const b=(P,I)=>{m(M=>({...M,[P]:I})),h(M=>({...M,page:1}))},y=P=>{g(P)},C=P=>{p(P)},w=async(P,I)=>{try{(await E_.markAsReviewed(P,I)).success&&(r(O=>O.map(F=>F.id===P?{...F,reviewed:!0,parentAction:I}:F)),o&&c(O=>({...O,unreviewedCount:Math.max(0,O.unreviewedCount-1)})),p(null))}catch(M){console.error("Failed to mark as reviewed:",M)}};if(n&&i.length===0)return a.jsx("div",{className:"safety-logs-page",children:a.jsxs("div",{className:"page-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading safety logs..."})]})});if(t&&i.length===0)return a.jsx("div",{className:"safety-logs-page",children:a.jsxs("div",{className:"page-error",children:[a.jsx("p",{children:"Unable to load safety logs"}),a.jsx("p",{className:"error-message",children:t}),a.jsx("button",{onClick:()=>g(),children:"Try Again"})]})});const j=(()=>{var O;if(!((O=o==null?void 0:o.last7Days)!=null&&O.trend))return"stable";const P=o.last7Days.trend,I=P.slice(-3).reduce((F,B)=>F+B,0),M=P.slice(0,3).reduce((F,B)=>F+B,0);return I>M?"up":I<M?"down":"stable"})(),T=(((_=o==null?void 0:o.bySeverity)==null?void 0:_.HIGH)||0)+(((L=o==null?void 0:o.bySeverity)==null?void 0:L.CRITICAL)||0);return a.jsxs("div",{className:"safety-logs-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h1",{children:"Safety Logs"}),a.jsx("p",{children:"Monitor and review safety incidents across your children's learning sessions"})]}),a.jsxs("div",{className:"summary-cards",children:[a.jsxs("div",{className:"summary-card",children:[a.jsx("div",{className:"summary-icon",children:""}),a.jsxs("div",{className:"summary-info",children:[a.jsx("span",{className:"summary-value",children:(o==null?void 0:o.totalIncidents)||0}),a.jsx("span",{className:"summary-label",children:"Total Incidents"})]})]}),a.jsxs("div",{className:`summary-card ${T>0?"alert":""}`,children:[a.jsx("div",{className:"summary-icon",children:""}),a.jsxs("div",{className:"summary-info",children:[a.jsx("span",{className:"summary-value",children:T}),a.jsx("span",{className:"summary-label",children:"High / Critical"})]})]}),a.jsxs("div",{className:`summary-card ${((o==null?void 0:o.unreviewedCount)||0)>0?"pending":""}`,children:[a.jsx("div",{className:"summary-icon",children:""}),a.jsxs("div",{className:"summary-info",children:[a.jsx("span",{className:"summary-value",children:(o==null?void 0:o.unreviewedCount)||0}),a.jsx("span",{className:"summary-label",children:"Unreviewed"})]})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("div",{className:"summary-icon",children:j==="up"?"":j==="down"?"":""}),a.jsxs("div",{className:"summary-info",children:[a.jsx("span",{className:"summary-value",children:((D=o==null?void 0:o.last7Days)==null?void 0:D.total)||0}),a.jsx("span",{className:"summary-label",children:"Last 7 Days"})]})]})]}),a.jsxs("div",{className:"filters-section",children:[a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Child"}),a.jsxs("select",{value:f.childId,onChange:P=>b("childId",P.target.value),children:[a.jsx("option",{value:"",children:"All Children"}),x.map(P=>a.jsx("option",{value:P.id,children:P.displayName},P.id))]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Severity"}),a.jsxs("select",{value:f.severity,onChange:P=>b("severity",P.target.value),children:[a.jsx("option",{value:"",children:"All Severities"}),a.jsx("option",{value:"LOW",children:"Low"}),a.jsx("option",{value:"MEDIUM",children:"Medium"}),a.jsx("option",{value:"HIGH",children:"High"}),a.jsx("option",{value:"CRITICAL",children:"Critical"})]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Type"}),a.jsxs("select",{value:f.incidentType,onChange:P=>b("incidentType",P.target.value),children:[a.jsx("option",{value:"",children:"All Types"}),Object.entries(Kz).map(([P,{label:I}])=>a.jsx("option",{value:P,children:I},P))]})]}),a.jsxs("div",{className:"filter-group",children:[a.jsx("label",{children:"Status"}),a.jsxs("select",{value:f.reviewed,onChange:P=>b("reviewed",P.target.value),children:[a.jsx("option",{value:"",children:"All Status"}),a.jsx("option",{value:"false",children:"Unreviewed"}),a.jsx("option",{value:"true",children:"Reviewed"})]})]})]}),i.length>0?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"incidents-table-container",children:a.jsxs("table",{className:"incidents-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Child"}),a.jsx("th",{children:"Type"}),a.jsx("th",{children:"Severity"}),a.jsx("th",{children:"Time"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Action"})]})}),a.jsx("tbody",{children:i.map(P=>{const I=Kz[P.incidentType]||{icon:"",label:P.incidentType},M=Ige[P.severity]||{label:P.severity,className:""};return a.jsxs("tr",{className:`incident-row ${P.reviewed?"":"unreviewed"}`,onClick:()=>C(P),children:[a.jsxs("td",{className:"child-cell",children:[a.jsx("span",{className:"child-avatar",children:(P.childAvatar,"")}),a.jsx("span",{className:"child-name",children:P.childName})]}),a.jsxs("td",{className:"type-cell",children:[a.jsx("span",{className:"type-icon",children:I.icon}),a.jsx("span",{className:"type-label",children:I.label})]}),a.jsx("td",{children:a.jsx("span",{className:`severity-badge ${M.className}`,children:M.label})}),a.jsx("td",{className:"time-cell",children:Mge(P.createdAt)}),a.jsx("td",{children:P.reviewed?a.jsx("span",{className:"status-badge reviewed",children:"Reviewed"}):a.jsx("span",{className:"status-badge pending",children:"Pending"})}),a.jsx("td",{children:a.jsx("button",{className:"view-btn",onClick:O=>{O.stopPropagation(),C(P)},children:"View"})})]},P.id)})})]})}),d.totalPages>1&&a.jsxs("div",{className:"pagination",children:[a.jsx("button",{className:"page-btn",disabled:d.page===1,onClick:()=>y(d.page-1),children:"Previous"}),a.jsxs("span",{className:"page-info",children:["Page ",d.page," of ",d.totalPages]}),a.jsx("button",{className:"page-btn",disabled:d.page===d.totalPages,onClick:()=>y(d.page+1),children:"Next"})]})]}):a.jsxs("div",{className:"empty-state",children:[a.jsx("div",{className:"empty-icon",children:""}),a.jsx("h3",{children:"No Safety Incidents"}),a.jsx("p",{children:"Great news! There are no safety incidents to review."})]}),u&&a.jsx(Rge,{incident:u,onClose:()=>p(null),onMarkReviewed:w})]})},Rm={getSettings:async()=>ue("/parent/settings",{method:"GET"}),updateProfile:async n=>ue("/parent/settings/profile",{method:"PATCH",body:JSON.stringify(n)}),changePassword:async(n,e)=>ue("/parent/settings/change-password",{method:"POST",body:JSON.stringify({currentPassword:n,newPassword:e})}),logoutAll:async()=>ue("/parent/settings/logout-all",{method:"POST"}),getChildrenPins:async()=>ue("/parent/settings/children",{method:"GET"}),resetChildPin:async(n,e)=>ue(`/parent/settings/children/${n}/pin`,{method:"PATCH",body:JSON.stringify({newPin:e})})},Oge=[{value:"Asia/Dubai",label:"Dubai (GMT+4)"},{value:"Asia/Riyadh",label:"Riyadh (GMT+3)"},{value:"Asia/Kolkata",label:"India (GMT+5:30)"},{value:"Europe/London",label:"London (GMT+0)"},{value:"America/New_York",label:"New York (GMT-5)"},{value:"America/Los_Angeles",label:"Los Angeles (GMT-8)"},{value:"Asia/Singapore",label:"Singapore (GMT+8)"},{value:"Australia/Sydney",label:"Sydney (GMT+11)"}],Bge=[{value:"AE",label:"United Arab Emirates"},{value:"SA",label:"Saudi Arabia"},{value:"IN",label:"India"},{value:"US",label:"United States"},{value:"GB",label:"United Kingdom"},{value:"AU",label:"Australia"},{value:"SG",label:"Singapore"},{value:"PK",label:"Pakistan"},{value:"EG",label:"Egypt"},{value:"JO",label:"Jordan"}],$ge=()=>{var O,F;const[n,e]=N.useState(!0),[t,s]=N.useState(null),[i,r]=N.useState("profile"),[o,c]=N.useState(null),[d,h]=N.useState([]),[u,p]=N.useState({firstName:"",lastName:"",phone:"",country:"",timezone:""}),[f,m]=N.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[x,g]=N.useState({childId:"",newPin:""}),[b,y]=N.useState(!1),[C,w]=N.useState(""),[S,j]=N.useState({});let T=null;try{const B=Vt();T=B==null?void 0:B.updateUser}catch{}N.useEffect(()=>{(async()=>{try{e(!0),s(null);const[U,$]=await Promise.all([Rm.getSettings(),Rm.getChildrenPins()]);U.success&&(c(U.data),p({firstName:U.data.profile.firstName||"",lastName:U.data.profile.lastName||"",phone:U.data.profile.phone||"",country:U.data.profile.country||"AE",timezone:U.data.profile.timezone||"Asia/Dubai"})),$.success&&h($.data)}catch(U){console.error("Settings fetch error:",U),s(U.message||"Failed to load settings")}finally{e(!1)}})()},[]),N.useEffect(()=>{if(C){const B=setTimeout(()=>w(""),3e3);return()=>clearTimeout(B)}},[C]);const k=B=>{const{name:U,value:$}=B.target;p(G=>({...G,[U]:$})),S[U]&&j(G=>({...G,[U]:""}))},_=B=>{const{name:U,value:$}=B.target;m(G=>({...G,[U]:$})),S[U]&&j(G=>({...G,[U]:""}))},L=async()=>{try{y(!0),j({});const B=await Rm.updateProfile(u);B.success&&(w("Profile updated successfully"),c(U=>({...U,profile:{...U.profile,...B.data}})),T&&T(B.data))}catch(B){j({profile:B.message||"Failed to update profile"})}finally{y(!1)}},D=async()=>{const B={};if(f.currentPassword||(B.currentPassword="Current password is required"),f.newPassword?f.newPassword.length<8&&(B.newPassword="Password must be at least 8 characters"):B.newPassword="New password is required",f.newPassword!==f.confirmPassword&&(B.confirmPassword="Passwords do not match"),Object.keys(B).length>0){j(B);return}try{y(!0),j({}),(await Rm.changePassword(f.currentPassword,f.newPassword)).success&&(w("Password changed successfully"),m({currentPassword:"",newPassword:"",confirmPassword:""}))}catch(U){j({password:U.message||"Failed to change password"})}finally{y(!1)}},P=async()=>{if(window.confirm("This will log you out from all devices. Continue?"))try{y(!0),(await Rm.logoutAll()).success&&w("Logged out from all devices")}catch(B){j({logout:B.message||"Failed to logout"})}finally{y(!1)}},I=async()=>{if(!x.childId||!x.newPin){j({pin:"Please select a child and enter a new PIN"});return}if(!/^\d{4}$/.test(x.newPin)){j({pin:"PIN must be exactly 4 digits"});return}try{if(y(!0),j({}),(await Rm.resetChildPin(x.childId,x.newPin)).success){w("PIN updated successfully"),g({childId:"",newPin:""});const U=await Rm.getChildrenPins();U.success&&h(U.data)}}catch(B){j({pin:B.message||"Failed to reset PIN"})}finally{y(!1)}},M=B=>B?new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A";return n?a.jsx("div",{className:"settings-page",children:a.jsxs("div",{className:"page-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading settings..."})]})}):t?a.jsx("div",{className:"settings-page",children:a.jsxs("div",{className:"page-error",children:[a.jsx("p",{children:"Unable to load settings"}),a.jsx("p",{className:"error-message",children:t}),a.jsx("button",{onClick:()=>window.location.reload(),children:"Try Again"})]})}):a.jsxs("div",{className:"settings-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h1",{children:"Settings"}),a.jsx("p",{children:"Manage your account settings and preferences"})]}),C&&a.jsxs("div",{className:"success-toast",children:[a.jsx("span",{className:"success-icon",children:""}),C]}),a.jsxs("div",{className:"settings-tabs",children:[a.jsx("button",{className:`tab-btn ${i==="profile"?"active":""}`,onClick:()=>r("profile"),children:"Profile"}),a.jsx("button",{className:`tab-btn ${i==="security"?"active":""}`,onClick:()=>r("security"),children:"Security"}),a.jsx("button",{className:`tab-btn ${i==="notifications"?"active":""}`,onClick:()=>r("notifications"),children:"Notifications"})]}),a.jsxs("div",{className:"settings-content",children:[i==="profile"&&a.jsx("div",{className:"settings-section",children:a.jsxs("div",{className:"section-card",children:[a.jsx("h2",{children:"Account Information"}),a.jsx("p",{className:"section-desc",children:"Update your personal information"}),S.profile&&a.jsx("div",{className:"form-error-banner",children:S.profile}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Email"}),a.jsx("input",{type:"email",value:((O=o==null?void 0:o.profile)==null?void 0:O.email)||"",disabled:!0,className:"disabled"}),a.jsx("span",{className:"field-hint",children:"Email cannot be changed"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Member Since"}),a.jsx("input",{type:"text",value:M((F=o==null?void 0:o.profile)==null?void 0:F.memberSince),disabled:!0,className:"disabled"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"First Name"}),a.jsx("input",{type:"text",name:"firstName",value:u.firstName,onChange:k,placeholder:"Enter first name"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Last Name"}),a.jsx("input",{type:"text",name:"lastName",value:u.lastName,onChange:k,placeholder:"Enter last name"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Phone Number"}),a.jsx("input",{type:"tel",name:"phone",value:u.phone,onChange:k,placeholder:"+971 50 123 4567"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Country"}),a.jsx("select",{name:"country",value:u.country,onChange:k,children:Bge.map(B=>a.jsx("option",{value:B.value,children:B.label},B.value))})]}),a.jsxs("div",{className:"form-group full-width",children:[a.jsx("label",{children:"Timezone"}),a.jsx("select",{name:"timezone",value:u.timezone,onChange:k,children:Oge.map(B=>a.jsx("option",{value:B.value,children:B.label},B.value))})]})]}),a.jsx("div",{className:"section-actions",children:a.jsx("button",{className:"btn-primary",onClick:L,disabled:b,children:b?"Saving...":"Save Changes"})})]})}),i==="security"&&a.jsxs("div",{className:"settings-section",children:[a.jsxs("div",{className:"section-card",children:[a.jsx("h2",{children:"Change Password"}),a.jsx("p",{className:"section-desc",children:"Update your account password"}),S.password&&a.jsx("div",{className:"form-error-banner",children:S.password}),a.jsxs("div",{className:"form-stack",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Current Password"}),a.jsx("input",{type:"password",name:"currentPassword",value:f.currentPassword,onChange:_,placeholder:"Enter current password"}),S.currentPassword&&a.jsx("span",{className:"field-error",children:S.currentPassword})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"New Password"}),a.jsx("input",{type:"password",name:"newPassword",value:f.newPassword,onChange:_,placeholder:"Enter new password"}),S.newPassword&&a.jsx("span",{className:"field-error",children:S.newPassword}),a.jsx("span",{className:"field-hint",children:"Minimum 8 characters"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Confirm New Password"}),a.jsx("input",{type:"password",name:"confirmPassword",value:f.confirmPassword,onChange:_,placeholder:"Confirm new password"}),S.confirmPassword&&a.jsx("span",{className:"field-error",children:S.confirmPassword})]})]}),a.jsx("div",{className:"section-actions",children:a.jsx("button",{className:"btn-primary",onClick:D,disabled:b,children:b?"Changing...":"Change Password"})})]}),d.length>0&&a.jsxs("div",{className:"section-card",children:[a.jsx("h2",{children:"Child PIN Management"}),a.jsx("p",{className:"section-desc",children:"Reset PINs for your children's profiles"}),S.pin&&a.jsx("div",{className:"form-error-banner",children:S.pin}),a.jsx("div",{className:"pin-list",children:d.map(B=>a.jsxs("div",{className:"pin-item",children:[a.jsx("span",{className:"pin-child-name",children:B.displayName}),a.jsxs("span",{className:"pin-current",children:["Current PIN: ",B.pin]})]},B.id))}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Select Child"}),a.jsxs("select",{value:x.childId,onChange:B=>g(U=>({...U,childId:B.target.value})),children:[a.jsx("option",{value:"",children:"Choose a child..."}),d.map(B=>a.jsx("option",{value:B.id,children:B.displayName},B.id))]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"New PIN"}),a.jsx("input",{type:"text",value:x.newPin,onChange:B=>{const U=B.target.value.replace(/\D/g,"").slice(0,4);g($=>({...$,newPin:U}))},placeholder:"4 digits",maxLength:4})]})]}),a.jsx("div",{className:"section-actions",children:a.jsx("button",{className:"btn-secondary",onClick:I,disabled:b||!x.childId||!x.newPin,children:"Reset PIN"})})]}),a.jsxs("div",{className:"section-card",children:[a.jsx("h2",{children:"Session Management"}),a.jsx("p",{className:"section-desc",children:"Manage your active sessions"}),S.logout&&a.jsx("div",{className:"form-error-banner",children:S.logout}),a.jsx("div",{className:"session-info",children:a.jsx("p",{children:"If you suspect unauthorized access, you can log out from all devices. You will need to log in again on this device."})}),a.jsx("div",{className:"section-actions",children:a.jsx("button",{className:"btn-danger",onClick:P,disabled:b,children:"Logout from All Devices"})})]})]}),i==="notifications"&&a.jsx("div",{className:"settings-section",children:a.jsxs("div",{className:"section-card",children:[a.jsx("h2",{children:"Email Notifications"}),a.jsx("p",{className:"section-desc",children:"Choose what emails you receive"}),a.jsxs("div",{className:"notification-list",children:[a.jsxs("div",{className:"notification-item",children:[a.jsxs("div",{className:"notification-info",children:[a.jsx("span",{className:"notification-title",children:"Safety Alerts"}),a.jsx("span",{className:"notification-desc",children:"Receive emails when safety incidents occur"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"notification-item",children:[a.jsxs("div",{className:"notification-info",children:[a.jsx("span",{className:"notification-title",children:"Weekly Digest"}),a.jsx("span",{className:"notification-desc",children:"Summary of your children's learning progress"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"notification-item",children:[a.jsxs("div",{className:"notification-info",children:[a.jsx("span",{className:"notification-title",children:"Product Updates"}),a.jsx("span",{className:"notification-desc",children:"News about new features and improvements"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox"}),a.jsx("span",{className:"toggle-slider"})]})]})]}),a.jsxs("div",{className:"info-box",children:[a.jsx("span",{className:"info-icon",children:""}),a.jsx("p",{children:"Notification preferences are saved automatically. Critical security notifications cannot be disabled."})]})]})})]})]})},zk={getPrivacySettings:async()=>ue("/parent/privacy",{method:"GET"}),updatePreferences:async n=>ue("/parent/privacy",{method:"PATCH",body:JSON.stringify(n)}),exportData:async()=>ue("/parent/privacy/export-data",{method:"POST"}),getConsentHistory:async()=>ue("/parent/privacy/consent-history",{method:"GET"}),deleteAccount:async()=>ue("/auth/delete-account",{method:"DELETE"})};function Uge(){var D;const[n,e]=N.useState(!0),[t,s]=N.useState(null),[i,r]=N.useState(""),[o,c]=N.useState(null),[d,h]=N.useState({dataCollection:{learningAnalytics:!0,usageAnalytics:!0,personalization:!0},dataSharing:{thirdPartyAnalytics:!1,improvementResearch:!1}}),[u,p]=N.useState(!1),[f,m]=N.useState(!1),[x,g]=N.useState(!1),[b,y]=N.useState(""),[C,w]=N.useState(!1),S=N.useCallback(async()=>{try{e(!0),s(null);const P=await zk.getPrivacySettings();P.success&&(c(P.data),P.data.preferences&&h(P.data.preferences))}catch(P){s(P.message||"Failed to load privacy settings")}finally{e(!1)}},[]);N.useEffect(()=>{S()},[S]);const j=(P,I)=>{h(M=>({...M,[P]:{...M[P],[I]:!M[P][I]}}))},T=async()=>{try{p(!0),(await zk.updatePreferences(d)).success&&(r("Privacy preferences updated successfully"),setTimeout(()=>r(""),3e3))}catch(P){s(P.message||"Failed to save preferences")}finally{p(!1)}},k=async()=>{try{m(!0);const P=await zk.exportData();if(P.success){const I=JSON.stringify(P.data,null,2),M=new Blob([I],{type:"application/json"}),O=URL.createObjectURL(M),F=document.createElement("a");F.href=O,F.download=`orbit-learn-data-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(F),F.click(),document.body.removeChild(F),URL.revokeObjectURL(O),r("Data export downloaded successfully"),setTimeout(()=>r(""),3e3)}}catch(P){s(P.message||"Failed to export data")}finally{m(!1)}},_=async()=>{if(b==="DELETE")try{w(!0),await zk.deleteAccount(),window.location.href="/"}catch(P){s(P.message||"Failed to delete account"),w(!1)}},L=P=>P?new Date(P).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A";return n?a.jsx("div",{className:"privacy-page",children:a.jsxs("div",{className:"page-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading privacy settings..."})]})}):t&&!o?a.jsx("div",{className:"privacy-page",children:a.jsxs("div",{className:"page-error",children:[a.jsx("p",{children:"Unable to load privacy settings"}),a.jsx("p",{className:"error-message",children:t}),a.jsx("button",{onClick:S,children:"Try Again"})]})}):a.jsxs("div",{className:"privacy-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h1",{children:"Privacy Controls"}),a.jsx("p",{children:"Manage your data, consent, and privacy preferences"})]}),i&&a.jsxs("div",{className:"success-toast",children:[a.jsx("span",{className:"success-icon",children:""}),i]}),t&&a.jsxs("div",{className:"error-toast",children:[a.jsx("span",{className:"error-icon",children:"!"}),t,a.jsx("button",{className:"dismiss-btn",onClick:()=>s(null),children:""})]}),a.jsxs("div",{className:"privacy-sections",children:[a.jsxs("section",{className:"section-card",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("div",{className:"section-icon consent-icon",children:a.jsx("span",{children:""})}),a.jsxs("div",{children:[a.jsx("h2",{children:"Parental Consent (COPPA)"}),a.jsx("p",{className:"section-desc",children:"Your consent status for your children's accounts"})]})]}),a.jsx("div",{className:"consent-status",children:o!=null&&o.consent?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"consent-badge active",children:[a.jsx("span",{className:"badge-icon",children:""}),"Consent Active"]}),a.jsxs("div",{className:"consent-details",children:[a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"Method:"}),a.jsx("span",{className:"value",children:o.consent.method})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"Granted:"}),a.jsx("span",{className:"value",children:L(o.consent.grantedAt)})]}),o.consent.expiresAt&&a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"Expires:"}),a.jsx("span",{className:"value",children:L(o.consent.expiresAt)})]})]})]}):a.jsxs("div",{className:"consent-badge inactive",children:[a.jsx("span",{className:"badge-icon",children:"!"}),"No Active Consent"]})}),a.jsxs("div",{className:"info-box",children:[a.jsx("span",{className:"info-icon",children:""}),a.jsx("p",{children:"Under COPPA regulations, parental consent is required for children under 13 to use our educational platform. Your consent allows us to provide personalized learning experiences for your children."})]})]}),a.jsxs("section",{className:"section-card",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("div",{className:"section-icon data-icon",children:a.jsx("span",{children:""})}),a.jsxs("div",{children:[a.jsx("h2",{children:"Data Collection"}),a.jsx("p",{className:"section-desc",children:"Control what data we collect to improve learning experiences"})]})]}),a.jsxs("div",{className:"toggle-list",children:[a.jsxs("div",{className:"toggle-item",children:[a.jsxs("div",{className:"toggle-info",children:[a.jsx("h4",{children:"Learning Analytics"}),a.jsx("p",{children:"Track progress, strengths, and areas for improvement"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:d.dataCollection.learningAnalytics,onChange:()=>j("dataCollection","learningAnalytics")}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"toggle-item",children:[a.jsxs("div",{className:"toggle-info",children:[a.jsx("h4",{children:"Usage Analytics"}),a.jsx("p",{children:"Help us understand how the app is used to improve it"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:d.dataCollection.usageAnalytics,onChange:()=>j("dataCollection","usageAnalytics")}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"toggle-item",children:[a.jsxs("div",{className:"toggle-info",children:[a.jsx("h4",{children:"Personalization"}),a.jsx("p",{children:"Use learning data to personalize content and recommendations"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:d.dataCollection.personalization,onChange:()=>j("dataCollection","personalization")}),a.jsx("span",{className:"toggle-slider"})]})]})]})]}),a.jsxs("section",{className:"section-card",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("div",{className:"section-icon sharing-icon",children:a.jsx("span",{children:""})}),a.jsxs("div",{children:[a.jsx("h2",{children:"Data Sharing"}),a.jsx("p",{className:"section-desc",children:"Control how your data may be shared with third parties"})]})]}),a.jsxs("div",{className:"toggle-list",children:[a.jsxs("div",{className:"toggle-item",children:[a.jsxs("div",{className:"toggle-info",children:[a.jsx("h4",{children:"Third-Party Analytics"}),a.jsx("p",{children:"Share anonymized data with analytics providers"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:d.dataSharing.thirdPartyAnalytics,onChange:()=>j("dataSharing","thirdPartyAnalytics")}),a.jsx("span",{className:"toggle-slider"})]})]}),a.jsxs("div",{className:"toggle-item",children:[a.jsxs("div",{className:"toggle-info",children:[a.jsx("h4",{children:"Research & Improvement"}),a.jsx("p",{children:"Contribute anonymized data to educational research"})]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:d.dataSharing.improvementResearch,onChange:()=>j("dataSharing","improvementResearch")}),a.jsx("span",{className:"toggle-slider"})]})]})]}),a.jsx("div",{className:"section-actions",children:a.jsx("button",{className:"btn-primary",onClick:T,disabled:u,children:u?"Saving...":"Save Preferences"})})]}),a.jsxs("section",{className:"section-card",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("div",{className:"section-icon summary-icon",children:a.jsx("span",{children:""})}),a.jsxs("div",{children:[a.jsx("h2",{children:"Your Data Summary"}),a.jsx("p",{className:"section-desc",children:"Overview of data we have stored for your account"})]})]}),(o==null?void 0:o.dataSummary)&&a.jsxs("div",{className:"data-summary-grid",children:[a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-value",children:o.dataSummary.totalLessons}),a.jsx("span",{className:"summary-label",children:"Lessons Created"})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-value",children:o.dataSummary.totalChatMessages}),a.jsx("span",{className:"summary-label",children:"Chat Messages"})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-value",children:o.dataSummary.totalFlashcards}),a.jsx("span",{className:"summary-label",children:"Flashcard Decks"})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-value",children:o.dataSummary.accountAgeMonths}),a.jsx("span",{className:"summary-label",children:"Months Active"})]})]}),a.jsxs("div",{className:"children-list",children:[a.jsx("h4",{children:"Children's Profiles"}),((D=o==null?void 0:o.children)==null?void 0:D.length)>0?a.jsx("ul",{children:o.children.map(P=>a.jsx("li",{children:P.displayName},P.id))}):a.jsx("p",{className:"no-children",children:"No children profiles created yet"})]})]}),a.jsxs("section",{className:"section-card",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("div",{className:"section-icon manage-icon",children:a.jsx("span",{children:""})}),a.jsxs("div",{children:[a.jsx("h2",{children:"Data Management"}),a.jsx("p",{className:"section-desc",children:"Export or delete your data"})]})]}),a.jsxs("div",{className:"data-actions",children:[a.jsxs("div",{className:"action-card",children:[a.jsxs("div",{className:"action-info",children:[a.jsx("h4",{children:"Export Your Data"}),a.jsx("p",{children:"Download a copy of all your data in JSON format, including account info, children's profiles, lessons, and progress."})]}),a.jsx("button",{className:"btn-secondary",onClick:k,disabled:f,children:f?"Preparing Export...":"Export Data"})]}),a.jsxs("div",{className:"action-card danger",children:[a.jsxs("div",{className:"action-info",children:[a.jsx("h4",{children:"Delete Account"}),a.jsx("p",{children:"Permanently delete your account and all associated data. This action cannot be undone."})]}),a.jsx("button",{className:"btn-danger",onClick:()=>g(!0),children:"Delete Account"})]})]})]})]}),x&&a.jsx("div",{className:"modal-overlay",onClick:()=>g(!1),children:a.jsxs("div",{className:"modal-content delete-modal",onClick:P=>P.stopPropagation(),children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h3",{children:"Delete Account"}),a.jsx("button",{className:"close-btn",onClick:()=>g(!1),children:""})]}),a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"warning-banner",children:[a.jsx("span",{className:"warning-icon",children:""}),a.jsx("p",{children:"This action is permanent and cannot be undone!"})]}),a.jsx("p",{children:"Deleting your account will:"}),a.jsxs("ul",{className:"delete-consequences",children:[a.jsx("li",{children:"Remove your parent account"}),a.jsx("li",{children:"Delete all children's profiles and their data"}),a.jsx("li",{children:"Erase all lessons, progress, and achievements"}),a.jsx("li",{children:"Cancel any active subscription"})]}),a.jsxs("div",{className:"confirm-input",children:[a.jsxs("label",{children:["Type ",a.jsx("strong",{children:"DELETE"})," to confirm:"]}),a.jsx("input",{type:"text",value:b,onChange:P=>y(P.target.value),placeholder:"DELETE"})]})]}),a.jsxs("div",{className:"modal-actions",children:[a.jsx("button",{className:"btn-secondary",onClick:()=>{g(!1),y("")},children:"Cancel"}),a.jsx("button",{className:"btn-danger",onClick:_,disabled:b!=="DELETE"||C,children:C?"Deleting...":"Delete My Account"})]})]})})]})}const BR={getChildren:async()=>ue("/parent/reports/children",{method:"GET"}),getReport:async(n,e="7d")=>ue(`/parent/reports/${n}?period=${e}`,{method:"GET"}),exportReport:async n=>ue(`/parent/reports/${n}/export`,{method:"GET"})},Qz={MATH:"",SCIENCE:"",ENGLISH:"",HISTORY:"",GEOGRAPHY:"",ART:"",MUSIC:"",TECHNOLOGY:"",OTHER:""},zge={COMMON:"#78909c",UNCOMMON:"#66bb6a",RARE:"#42a5f5",EPIC:"#ab47bc",LEGENDARY:"#ffa726"};function Hge(){const[n,e]=N.useState(!0),[t,s]=N.useState(null),[i,r]=N.useState([]),[o,c]=N.useState(null),[d,h]=N.useState("7d"),[u,p]=N.useState(null),[f,m]=N.useState(!1),x=N.useCallback(async()=>{try{const S=await BR.getChildren();S.success&&(r(S.data),S.data.length>0&&!o&&c(S.data[0].id))}catch(S){s(S.message||"Failed to load children")}},[o]),g=N.useCallback(async()=>{if(o)try{e(!0),s(null);const S=await BR.getReport(o,d);S.success&&p(S.data)}catch(S){s(S.message||"Failed to load report")}finally{e(!1)}},[o,d]);N.useEffect(()=>{x()},[x]),N.useEffect(()=>{o&&g()},[o,d,g]);const b=async()=>{var S;if(o)try{m(!0);const j=await BR.exportReport(o);if(j.success){const T=JSON.stringify(j.data,null,2),k=new Blob([T],{type:"application/json"}),_=URL.createObjectURL(k),L=document.createElement("a");L.href=_,L.download=`progress-report-${((S=u==null?void 0:u.child)==null?void 0:S.displayName)||"child"}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(_)}}catch(j){s(j.message||"Failed to export report")}finally{m(!1)}},y=S=>S?new Date(S).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A",C=()=>{if(!(u!=null&&u.overview))return{current:0,needed:100,percent:0};const S=u.overview.currentXP,T=100*u.overview.level,k=Math.min(100,Math.round(S/T*100));return{current:S,needed:T,percent:k}},w=()=>{if(!(u!=null&&u.activityChart))return 5;const S=Math.max(...u.activityChart.map(j=>j.lessons),1);return Math.ceil(S/5)*5||5};return n&&!u?a.jsx("div",{className:"reports-page",children:a.jsxs("div",{className:"page-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading progress report..."})]})}):i.length===0?a.jsxs("div",{className:"reports-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h1",{children:"Progress Reports"}),a.jsx("p",{children:"Track your children's learning journey"})]}),a.jsxs("div",{className:"empty-state",children:[a.jsx("span",{className:"empty-icon",children:""}),a.jsx("h3",{children:"No Children Found"}),a.jsx("p",{children:"Add a child profile to start tracking their progress."})]})]}):a.jsxs("div",{className:"reports-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsxs("div",{children:[a.jsx("h1",{children:"Progress Reports"}),a.jsx("p",{children:"Track your children's learning journey"})]}),a.jsx("button",{className:"btn-secondary export-btn",onClick:b,disabled:f||!u,children:f?"Exporting...":"Export Report"})]}),a.jsxs("div",{className:"report-controls",children:[a.jsxs("div",{className:"control-group",children:[a.jsx("label",{children:"Child"}),a.jsx("select",{value:o||"",onChange:S=>c(S.target.value),children:i.map(S=>a.jsx("option",{value:S.id,children:S.displayName},S.id))})]}),a.jsxs("div",{className:"control-group",children:[a.jsx("label",{children:"Period"}),a.jsx("div",{className:"period-tabs",children:[{value:"7d",label:"7 Days"},{value:"30d",label:"30 Days"},{value:"90d",label:"3 Months"},{value:"all",label:"All Time"}].map(S=>a.jsx("button",{className:`period-tab ${d===S.value?"active":""}`,onClick:()=>h(S.value),children:S.label},S.value))})]})]}),t&&a.jsxs("div",{className:"error-banner",children:[a.jsx("span",{children:"!"}),t,a.jsx("button",{onClick:()=>s(null),children:""})]}),n?a.jsx("div",{className:"loading-overlay",children:a.jsx("div",{className:"loading-spinner small"})}):u?a.jsxs("div",{className:"report-content",children:[a.jsxs("section",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card level-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-label",children:"Level"}),a.jsx("span",{className:"stat-value",children:u.overview.level})]}),a.jsx("div",{className:"xp-bar",children:a.jsx("div",{className:"xp-fill",style:{width:`${C().percent}%`}})}),a.jsxs("span",{className:"xp-text",children:[C().current," / ",C().needed," XP"]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-label",children:"Lessons Completed"}),a.jsx("span",{className:"stat-value",children:u.overview.lessonsCompleted})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-label",children:"Questions Answered"}),a.jsx("span",{className:"stat-value",children:u.overview.questionsAnswered})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-label",children:"Total XP"}),a.jsx("span",{className:"stat-value",children:u.overview.totalXP.toLocaleString()})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-label",children:"Study Time"}),a.jsx("span",{className:"stat-value",children:u.overview.totalStudyTime})]})]}),a.jsxs("div",{className:"stat-card streak-card",children:[a.jsx("div",{className:"stat-icon",children:""}),a.jsxs("div",{className:"stat-info",children:[a.jsx("span",{className:"stat-label",children:"Current Streak"}),a.jsxs("span",{className:"stat-value",children:[u.streak.current," days"]})]}),a.jsxs("span",{className:"streak-best",children:["Best: ",u.streak.longest," days"]})]})]}),a.jsxs("section",{className:"section-card period-summary",children:[a.jsx("h2",{children:d==="7d"?"Last 7 Days":d==="30d"?"Last 30 Days":d==="90d"?"Last 3 Months":"All Time"}),a.jsxs("div",{className:"period-stats",children:[a.jsxs("div",{className:"period-stat",children:[a.jsx("span",{className:"period-value",children:u.periodStats.lessonsStarted}),a.jsx("span",{className:"period-label",children:"Lessons Started"})]}),a.jsxs("div",{className:"period-stat",children:[a.jsx("span",{className:"period-value",children:u.periodStats.lessonsCompleted}),a.jsx("span",{className:"period-label",children:"Lessons Completed"})]}),a.jsxs("div",{className:"period-stat",children:[a.jsxs("span",{className:"period-value",children:[u.periodStats.avgCompletion,"%"]}),a.jsx("span",{className:"period-label",children:"Avg. Completion"})]})]})]}),u.activityChart&&u.activityChart.length>0&&a.jsxs("section",{className:"section-card",children:[a.jsx("h2",{children:"Daily Activity"}),a.jsxs("div",{className:"activity-chart",children:[a.jsx("div",{className:"chart-y-axis",children:[w(),Math.round(w()/2),0].map(S=>a.jsx("span",{children:S},S))}),a.jsx("div",{className:"chart-bars",children:u.activityChart.map((S,j)=>a.jsxs("div",{className:"chart-bar-container",children:[a.jsx("div",{className:"chart-bar",style:{height:`${S.lessons/w()*100}%`},title:`${S.lessons} lessons on ${y(S.date)}`}),a.jsx("span",{className:"chart-label",children:new Date(S.date).toLocaleDateString("en-US",{weekday:"short"}).charAt(0)})]},j))})]}),a.jsx("p",{className:"chart-legend",children:"Lessons per day"})]}),u.subjectBreakdown&&u.subjectBreakdown.length>0&&a.jsxs("section",{className:"section-card",children:[a.jsx("h2",{children:"Subject Breakdown"}),a.jsx("div",{className:"subject-list",children:u.subjectBreakdown.map((S,j)=>{const T=u.subjectBreakdown.reduce((_,L)=>_+L.count,0),k=Math.round(S.count/T*100);return a.jsxs("div",{className:"subject-item",children:[a.jsxs("div",{className:"subject-header",children:[a.jsx("span",{className:"subject-icon",children:Qz[S.subject]||""}),a.jsx("span",{className:"subject-name",children:S.subject||"Other"}),a.jsxs("span",{className:"subject-count",children:[S.count," lessons"]})]}),a.jsx("div",{className:"subject-bar",children:a.jsx("div",{className:"subject-fill",style:{width:`${k}%`}})})]},j)})})]}),a.jsxs("div",{className:"two-column",children:[a.jsxs("section",{className:"section-card",children:[a.jsx("h2",{children:"Recent Lessons"}),u.recentLessons&&u.recentLessons.length>0?a.jsx("div",{className:"lessons-list",children:u.recentLessons.map(S=>a.jsxs("div",{className:"lesson-item",children:[a.jsx("div",{className:"lesson-icon",children:Qz[S.subject]||""}),a.jsxs("div",{className:"lesson-info",children:[a.jsx("span",{className:"lesson-title",children:S.title}),a.jsx("span",{className:"lesson-date",children:y(S.lastAccessedAt||S.createdAt)})]}),a.jsx("div",{className:"lesson-progress",children:a.jsxs("div",{className:"progress-ring",children:[a.jsxs("svg",{viewBox:"0 0 36 36",children:[a.jsx("path",{className:"progress-bg",d:`M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831`}),a.jsx("path",{className:"progress-fill",strokeDasharray:`${S.percentComplete||0}, 100`,d:`M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831`})]}),a.jsxs("span",{className:"progress-text",children:[S.percentComplete||0,"%"]})]})})]},S.id))}):a.jsx("p",{className:"empty-list",children:"No lessons in this period"})]}),a.jsxs("section",{className:"section-card",children:[a.jsx("h2",{children:"Recent Achievements"}),u.recentBadges&&u.recentBadges.length>0?a.jsx("div",{className:"badges-list",children:u.recentBadges.map(S=>a.jsxs("div",{className:"badge-item",children:[a.jsx("div",{className:"badge-icon",style:{borderColor:zge[S.rarity]||"#78909c"},children:S.icon}),a.jsxs("div",{className:"badge-info",children:[a.jsx("span",{className:"badge-name",children:S.name}),a.jsx("span",{className:"badge-desc",children:S.description}),a.jsx("span",{className:"badge-date",children:y(S.earnedAt)})]})]},S.id))}):a.jsx("p",{className:"empty-list",children:"No badges earned in this period"})]})]})]}):null]})}const Vge="http://localhost:3000",Jz={getFAQ:async()=>{const n=await fetch(`${Vge}/support/faq`);if(!n.ok)throw new Error("Failed to load FAQ");return n.json()},submitContact:async n=>ue("/support/contact",{method:"POST",body:JSON.stringify(n)})},Gge=[{value:"general",label:"General Question"},{value:"technical",label:"Technical Issue"},{value:"billing",label:"Billing & Subscription"},{value:"safety",label:"Safety Concern"},{value:"feedback",label:"Feedback & Suggestions"}];function Wge(){const[n,e]=N.useState("faq"),[t,s]=N.useState([]),[i,r]=N.useState(!0),[o,c]=N.useState(null),[d,h]=N.useState(null),[u,p]=N.useState(""),[f,m]=N.useState({subject:"",category:"general",message:""}),[x,g]=N.useState(!1),[b,y]=N.useState(null),[C,w]=N.useState(null),S=N.useCallback(async()=>{try{r(!0);const L=await Jz.getFAQ();L.success&&(s(L.data),L.data.length>0&&c(L.data[0].category))}catch(L){console.error("Failed to load FAQ:",L)}finally{r(!1)}},[]);N.useEffect(()=>{S()},[S]);const j=u.trim()?t.map(L=>({...L,questions:L.questions.filter(D=>D.q.toLowerCase().includes(u.toLowerCase())||D.a.toLowerCase().includes(u.toLowerCase()))})).filter(L=>L.questions.length>0):t,T=async L=>{if(L.preventDefault(),w(null),y(null),!f.subject.trim()){w("Please enter a subject");return}if(!f.message.trim()){w("Please enter your message");return}if(f.message.length<20){w("Please provide more detail in your message (at least 20 characters)");return}try{g(!0);const D=await Jz.submitContact(f);D.success&&(y({ticketId:D.data.ticketId,message:D.data.message}),m({subject:"",category:"general",message:""}))}catch(D){w(D.message||"Failed to submit. Please try again.")}finally{g(!1)}},k=L=>{c(o===L?null:L),h(null)},_=L=>{h(d===L?null:L)};return a.jsxs("div",{className:"support-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h1",{children:"Help & Support"}),a.jsx("p",{children:"Find answers or get in touch with our team"})]}),a.jsxs("div",{className:"support-tabs",children:[a.jsx("button",{className:`tab-btn ${n==="faq"?"active":""}`,onClick:()=>e("faq"),children:"FAQ"}),a.jsx("button",{className:`tab-btn ${n==="contact"?"active":""}`,onClick:()=>e("contact"),children:"Contact Us"}),a.jsx("button",{className:`tab-btn ${n==="resources"?"active":""}`,onClick:()=>e("resources"),children:"Resources"})]}),a.jsxs("div",{className:"support-content",children:[n==="faq"&&a.jsxs("div",{className:"faq-section",children:[a.jsxs("div",{className:"search-box",children:[a.jsx("span",{className:"search-icon",children:""}),a.jsx("input",{type:"text",placeholder:"Search FAQ...",value:u,onChange:L=>p(L.target.value)}),u&&a.jsx("button",{className:"clear-search",onClick:()=>p(""),children:""})]}),i?a.jsxs("div",{className:"loading-state",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading FAQ..."})]}):j.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("span",{className:"empty-icon",children:""}),a.jsx("h3",{children:"No results found"}),a.jsx("p",{children:"Try a different search term or browse all categories."}),u&&a.jsx("button",{className:"btn-secondary",onClick:()=>p(""),children:"Clear Search"})]}):a.jsx("div",{className:"faq-categories",children:j.map((L,D)=>a.jsxs("div",{className:"faq-category",children:[a.jsxs("button",{className:`category-header ${o===L.category?"expanded":""}`,onClick:()=>k(L.category),children:[a.jsx("span",{className:"category-title",children:L.category}),a.jsx("span",{className:"category-count",children:L.questions.length}),a.jsx("span",{className:"expand-icon",children:o===L.category?"":"+"})]}),o===L.category&&a.jsx("div",{className:"faq-questions",children:L.questions.map((P,I)=>{const M=`${D}-${I}`;return a.jsxs("div",{className:"faq-item",children:[a.jsxs("button",{className:`question-header ${d===M?"expanded":""}`,onClick:()=>_(M),children:[a.jsx("span",{className:"question-text",children:P.q}),a.jsx("span",{className:"question-icon",children:d===M?"":""})]}),d===M&&a.jsx("div",{className:"answer",children:a.jsx("p",{children:P.a})})]},I)})})]},D))})]}),n==="contact"&&a.jsx("div",{className:"contact-section",children:b?a.jsxs("div",{className:"success-message",children:[a.jsx("div",{className:"success-icon",children:""}),a.jsx("h3",{children:"Message Sent!"}),a.jsx("p",{children:b.message}),a.jsxs("p",{className:"ticket-id",children:["Reference: ",b.ticketId]}),a.jsx("button",{className:"btn-primary",onClick:()=>y(null),children:"Send Another Message"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"contact-info",children:[a.jsx("h2",{children:"Get in Touch"}),a.jsx("p",{children:"Have a question or need help? Fill out the form below and we'll get back to you within 24-48 hours."})]}),C&&a.jsxs("div",{className:"form-error",children:[a.jsx("span",{children:"!"}),C]}),a.jsxs("form",{className:"contact-form",onSubmit:T,children:[a.jsx("div",{className:"form-row",children:a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"category",children:"Category"}),a.jsx("select",{id:"category",value:f.category,onChange:L=>m({...f,category:L.target.value}),children:Gge.map(L=>a.jsx("option",{value:L.value,children:L.label},L.value))})]})}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"subject",children:"Subject *"}),a.jsx("input",{id:"subject",type:"text",value:f.subject,onChange:L=>m({...f,subject:L.target.value}),placeholder:"Brief description of your issue",maxLength:200}),a.jsxs("span",{className:"char-count",children:[f.subject.length,"/200"]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"message",children:"Message *"}),a.jsx("textarea",{id:"message",value:f.message,onChange:L=>m({...f,message:L.target.value}),placeholder:"Please describe your issue or question in detail...",rows:6,maxLength:5e3}),a.jsxs("span",{className:"char-count",children:[f.message.length,"/5000"]})]}),a.jsx("button",{type:"submit",className:"btn-primary submit-btn",disabled:x,children:x?"Sending...":"Send Message"})]})]})}),n==="resources"&&a.jsxs("div",{className:"resources-section",children:[a.jsxs("div",{className:"resource-cards",children:[a.jsxs("div",{className:"resource-card",children:[a.jsx("span",{className:"resource-icon",children:""}),a.jsx("h3",{children:"Getting Started Guide"}),a.jsx("p",{children:"Learn how to set up profiles, upload content, and start learning."}),a.jsx("a",{href:"#",className:"resource-link",children:"Read Guide"})]}),a.jsxs("div",{className:"resource-card",children:[a.jsx("span",{className:"resource-icon",children:""}),a.jsx("h3",{children:"Safety Information"}),a.jsx("p",{children:"Learn about our safety features and how we protect your children."}),a.jsx("a",{href:"#",className:"resource-link",children:"View Safety Info"})]}),a.jsxs("div",{className:"resource-card",children:[a.jsx("span",{className:"resource-icon",children:""}),a.jsx("h3",{children:"Privacy Policy"}),a.jsx("p",{children:"Understand how we handle and protect your family's data."}),a.jsx("a",{href:"#",className:"resource-link",children:"Read Policy"})]}),a.jsxs("div",{className:"resource-card",children:[a.jsx("span",{className:"resource-icon",children:""}),a.jsx("h3",{children:"Terms of Service"}),a.jsx("p",{children:"Review our terms and conditions for using Orbit Learn."}),a.jsx("a",{href:"#",className:"resource-link",children:"View Terms"})]})]}),a.jsxs("div",{className:"contact-methods",children:[a.jsx("h2",{children:"Other Ways to Reach Us"}),a.jsxs("div",{className:"method-cards",children:[a.jsxs("div",{className:"method-card",children:[a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("h4",{children:"Email"}),a.jsx("p",{children:"support@orbitlearn.com"})]})]}),a.jsxs("div",{className:"method-card",children:[a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("h4",{children:"Response Time"}),a.jsx("p",{children:"24-48 hours"})]})]})]})]})]})]})]})}const qge=({isOpen:n,onClose:e})=>{const[t,s]=N.useState("email"),[i,r]=N.useState(""),[o,c]=N.useState(""),[d,h]=N.useState(""),[u,p]=N.useState(""),[f,m]=N.useState(""),[x,g]=N.useState(!1),b=async S=>{S.preventDefault(),m(""),g(!0);try{await lt.requestPasswordReset(i),s("code")}catch(j){m(j.message||"Failed to send reset code. Please try again.")}finally{g(!1)}},y=async S=>{S.preventDefault(),m(""),g(!0);try{await lt.verifyResetCode(i,o),s("reset")}catch(j){m(j.message||"Invalid or expired code. Please try again.")}finally{g(!1)}},C=async S=>{if(S.preventDefault(),m(""),d.length<8){m("Password must be at least 8 characters");return}if(d!==u){m("Passwords do not match");return}g(!0);try{await lt.resetPassword(i,d),s("success")}catch(j){m(j.message||"Failed to reset password. Please try again.")}finally{g(!1)}},w=()=>{s("email"),r(""),c(""),h(""),p(""),m(""),e()};return n?a.jsx(Ie,{children:a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50",onClick:w}),a.jsxs(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 z-10",children:[a.jsx("button",{onClick:w,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t==="email"&&a.jsxs("form",{onSubmit:b,children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Reset Password"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Enter your email address and we'll send you a verification code."}),f&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:f}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none",placeholder:"teacher@school.edu",value:i,onChange:S=>r(S.target.value),required:!0})]}),a.jsx("button",{type:"submit",disabled:x,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:x?"Sending...":"Send Reset Code"})]}),t==="code"&&a.jsxs("form",{onSubmit:y,children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Enter Verification Code"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["We've sent a 6-digit code to ",a.jsx("strong",{children:i})]}),f&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:f}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),a.jsx("input",{type:"text",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none text-center text-2xl tracking-widest",placeholder:"000000",value:o,onChange:S=>c(S.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,required:!0})]}),a.jsx("button",{type:"submit",disabled:x||o.length!==6,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:x?"Verifying...":"Verify Code"}),a.jsx("button",{type:"button",onClick:()=>s("email"),className:"w-full mt-3 text-gray-600 text-sm hover:underline",children:"Use a different email"})]}),t==="reset"&&a.jsxs("form",{onSubmit:C,children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Create New Password"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Enter your new password below."}),f&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:f}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),a.jsx("input",{type:"password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none",placeholder:"At least 8 characters",value:d,onChange:S=>h(S.target.value),required:!0})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),a.jsx("input",{type:"password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none",placeholder:"Confirm your password",value:u,onChange:S=>p(S.target.value),required:!0})]}),a.jsx("button",{type:"submit",disabled:x,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:x?"Resetting...":"Reset Password"})]}),t==="success"&&a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Password Reset!"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Your password has been successfully reset. You can now sign in with your new password."}),a.jsx("button",{onClick:w,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700",children:"Return to Login"})]})]})]})}):null},Yge=()=>{const n=Qt(),{signIn:e,isLoading:t,isAuthenticated:s,needsEmailVerification:i,isReady:r}=Cm(),[o,c]=N.useState({email:"",password:""}),[d,h]=N.useState({}),[u,p]=N.useState(""),[f,m]=N.useState(!1),x=N.useRef(!1);N.useEffect(()=>{if(r&&s){let C="/teacher/dashboard";i&&(C="/teacher/verify-email"),x.current?(x.current=!1,window.location.href=C):n(C,{replace:!0})}},[s,i,r,n]);const g=()=>{const C={},w=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;return o.email?w.test(o.email)||(C.email="Please enter a valid email address"):C.email="Email is required",o.password||(C.password="Password is required"),h(C),Object.keys(C).length===0},b=C=>{const{name:w,value:S}=C.target;c(j=>({...j,[w]:S})),d[w]&&h(j=>({...j,[w]:""})),p("")},y=async C=>{if(C.preventDefault(),!!g()){p("");try{x.current=!0,await e(o.email,o.password)}catch(w){x.current=!1,p(w.message||"Failed to sign in. Please check your credentials.")}}};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex flex-col",children:[a.jsx("header",{className:"p-6",children:a.jsx(qe,{to:"/",className:"flex items-center w-fit",children:a.jsx("img",{src:"/assets/Logo-nobg.png",alt:"OrbitLearn",className:"h-16 md:h-20 w-auto"})})}),a.jsx("main",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Teacher Portal"}),a.jsx("p",{className:"text-gray-600",children:"Sign in to access your teaching tools"})]}),u&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:u}),a.jsxs("form",{onSubmit:y,noValidate:!0,children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",name:"email",className:`w-full px-4 py-3 rounded-lg border ${d.email?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"teacher@school.edu",value:o.email,onChange:b,autoComplete:"email"}),d.email&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.email})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsx("input",{type:"password",name:"password",className:`w-full px-4 py-3 rounded-lg border ${d.password?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"Your password",value:o.password,onChange:b,autoComplete:"current-password"}),d.password&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.password})]}),a.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign In"})]}),a.jsxs("div",{className:"flex items-center my-6",children:[a.jsx("div",{className:"flex-1 border-t border-gray-200"}),a.jsx("span",{className:"px-4 text-gray-400 text-sm",children:"or"}),a.jsx("div",{className:"flex-1 border-t border-gray-200"})]}),a.jsxs("p",{className:"text-center text-gray-600",children:["New to OrbitLearn?"," ",a.jsx(qe,{to:"/teacher/signup",className:"text-indigo-600 font-semibold hover:underline",children:"Create account"})]}),a.jsx("div",{className:"text-center mt-4",children:a.jsx("button",{type:"button",className:"text-indigo-600 text-sm hover:underline",onClick:()=>m(!0),children:"Forgot your password?"})})]}),a.jsxs("div",{className:"text-center mt-6 text-sm text-gray-500",children:[a.jsxs("p",{className:"mb-2",children:["Looking for the student/parent portal?"," ",a.jsx(qe,{to:"/login",className:"text-indigo-600 hover:underline",children:"Sign in here"})]}),a.jsxs("p",{children:["By signing in, you agree to our"," ",a.jsx("a",{href:"/terms",className:"text-indigo-600 hover:underline",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"/privacy",className:"text-indigo-600 hover:underline",children:"Privacy Policy"}),"."]})]})]})}),f&&a.jsx(qge,{isOpen:f,onClose:()=>m(!1)})]})},Xge=()=>{const n=Qt(),{signUp:e,isLoading:t,isAuthenticated:s,isReady:i}=Cm(),[r,o]=N.useState("signup"),[c,d]=N.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:""}),[h,u]=N.useState({}),[p,f]=N.useState("");N.useEffect(()=>{i&&s&&n("/teacher/dashboard",{replace:!0})},[s,i,n]);const m=()=>{const b={};c.firstName.trim()||(b.firstName="First name is required"),c.lastName.trim()||(b.lastName="Last name is required");const y=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;return c.email?y.test(c.email)||(b.email="Please enter a valid email address"):b.email="Email is required",c.password?c.password.length<8&&(b.password="Password must be at least 8 characters"):b.password="Password is required",c.password!==c.confirmPassword&&(b.confirmPassword="Passwords do not match"),u(b),Object.keys(b).length===0},x=b=>{const{name:y,value:C}=b.target;d(w=>({...w,[y]:C})),h[y]&&u(w=>({...w,[y]:""})),f("")},g=async b=>{if(b.preventDefault(),!!m()){f("");try{await e(c.email,c.password,c.firstName,c.lastName),o("verification_sent")}catch(y){f(y.message||"Failed to create account. Please try again.")}}};return r==="verification_sent"?a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex flex-col",children:[a.jsx("header",{className:"p-6",children:a.jsx(qe,{to:"/",className:"flex items-center w-fit",children:a.jsx("img",{src:"/assets/Logo-nobg.png",alt:"OrbitLearn",className:"h-16 md:h-20 w-auto"})})}),a.jsx("main",{className:"flex-1 flex items-center justify-center p-6",children:a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8 text-center",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Check Your Email"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["We've sent a verification code to ",a.jsx("strong",{children:c.email}),". Please check your inbox and enter the code to complete your registration."]}),a.jsx(qe,{to:"/teacher/verify-email",state:{email:c.email},className:"inline-block w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition-colors",children:"Enter Verification Code"}),a.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["Didn't receive the email? Check your spam folder or"," ",a.jsx("button",{onClick:()=>o("signup"),className:"text-indigo-600 hover:underline",children:"try again"})]})]})})})]}):a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex flex-col",children:[a.jsx("header",{className:"p-6",children:a.jsx(qe,{to:"/",className:"flex items-center w-fit",children:a.jsx("img",{src:"/assets/Logo-nobg.png",alt:"OrbitLearn",className:"h-16 md:h-20 w-auto"})})}),a.jsx("main",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Create Teacher Account"}),a.jsx("p",{className:"text-gray-600",children:"Start using AI-powered teaching tools"})]}),p&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:p}),a.jsxs("form",{onSubmit:g,noValidate:!0,children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),a.jsx("input",{type:"text",name:"firstName",className:`w-full px-4 py-3 rounded-lg border ${h.firstName?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"Jane",value:c.firstName,onChange:x,autoComplete:"given-name"}),h.firstName&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:h.firstName})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),a.jsx("input",{type:"text",name:"lastName",className:`w-full px-4 py-3 rounded-lg border ${h.lastName?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"Smith",value:c.lastName,onChange:x,autoComplete:"family-name"}),h.lastName&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:h.lastName})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",name:"email",className:`w-full px-4 py-3 rounded-lg border ${h.email?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"teacher@school.edu",value:c.email,onChange:x,autoComplete:"email"}),h.email&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:h.email})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsx("input",{type:"password",name:"password",className:`w-full px-4 py-3 rounded-lg border ${h.password?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"At least 8 characters",value:c.password,onChange:x,autoComplete:"new-password"}),h.password&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:h.password})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),a.jsx("input",{type:"password",name:"confirmPassword",className:`w-full px-4 py-3 rounded-lg border ${h.confirmPassword?"border-red-400":"border-gray-300"} focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none transition-colors`,placeholder:"Confirm your password",value:c.confirmPassword,onChange:x,autoComplete:"new-password"}),h.confirmPassword&&a.jsx("p",{className:"mt-1 text-sm text-red-500",children:h.confirmPassword})]}),a.jsx("button",{type:"submit",disabled:t,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:t?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating account..."]}):"Create Account"})]}),a.jsxs("div",{className:"flex items-center my-6",children:[a.jsx("div",{className:"flex-1 border-t border-gray-200"}),a.jsx("span",{className:"px-4 text-gray-400 text-sm",children:"or"}),a.jsx("div",{className:"flex-1 border-t border-gray-200"})]}),a.jsxs("p",{className:"text-center text-gray-600",children:["Already have an account?"," ",a.jsx(qe,{to:"/teacher/login",className:"text-indigo-600 font-semibold hover:underline",children:"Sign in"})]})]}),a.jsxs("div",{className:"text-center mt-6 text-sm text-gray-500",children:[a.jsxs("p",{className:"mb-2",children:["Looking for the student/parent portal?"," ",a.jsx(qe,{to:"/onboarding",className:"text-indigo-600 hover:underline",children:"Sign up here"})]}),a.jsxs("p",{children:["By creating an account, you agree to our"," ",a.jsx("a",{href:"/terms",className:"text-indigo-600 hover:underline",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"/privacy",className:"text-indigo-600 hover:underline",children:"Privacy Policy"}),"."]})]})]})})]})},Kge=()=>{var C,w;const n=Qt(),e=Qi(),{verifyEmail:t,isAuthenticated:s,needsEmailVerification:i,isReady:r}=Cm(),[o,c]=N.useState(((C=e.state)==null?void 0:C.email)||""),[d,h]=N.useState(""),[u,p]=N.useState(""),[f,m]=N.useState(!1),[x,g]=N.useState(0);N.useEffect(()=>{r&&s&&!i&&n("/teacher/dashboard",{replace:!0})},[s,i,r,n]),N.useEffect(()=>{if(x>0){const S=setTimeout(()=>g(x-1),1e3);return()=>clearTimeout(S)}},[x]);const b=async S=>{if(S.preventDefault(),p(""),!o){p("Please enter your email address");return}if(d.length!==6){p("Please enter the 6-digit verification code");return}m(!0);try{await t(o,d),n("/teacher/dashboard",{replace:!0})}catch(j){p(j.message||"Invalid or expired code. Please try again.")}finally{m(!1)}},y=async()=>{if(!(x>0||!o))try{await lt.resendVerificationEmail(o),g(60),p("")}catch(S){p(S.message||"Failed to resend code. Please try again.")}};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex flex-col",children:[a.jsx("header",{className:"p-6",children:a.jsx(qe,{to:"/",className:"flex items-center w-fit",children:a.jsx("img",{src:"/assets/Logo-nobg.png",alt:"OrbitLearn",className:"h-16 md:h-20 w-auto"})})}),a.jsx("main",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Verify Your Email"}),a.jsx("p",{className:"text-gray-600",children:o?`Enter the 6-digit code sent to ${o}`:"Enter your email and verification code"})]}),u&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm",children:u}),a.jsxs("form",{onSubmit:b,noValidate:!0,children:[!((w=e.state)!=null&&w.email)&&a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsx("input",{type:"email",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none",placeholder:"teacher@school.edu",value:o,onChange:S=>c(S.target.value)})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verification Code"}),a.jsx("input",{type:"text",className:"w-full px-4 py-4 rounded-lg border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 focus:outline-none text-center text-3xl tracking-[0.5em] font-mono",placeholder:"000000",value:d,onChange:S=>h(S.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,autoFocus:!0})]}),a.jsx("button",{type:"submit",disabled:f||d.length!==6,className:"w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:f?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify Email"})]}),a.jsx("div",{className:"mt-6 text-center",children:a.jsxs("p",{className:"text-gray-600 text-sm",children:["Didn't receive the code?"," ",x>0?a.jsxs("span",{className:"text-gray-400",children:["Resend in ",x,"s"]}):a.jsx("button",{onClick:y,disabled:!o,className:"text-indigo-600 font-medium hover:underline disabled:opacity-50",children:"Resend code"})]})})]}),a.jsx("div",{className:"text-center mt-6 text-sm text-gray-500",children:a.jsx(qe,{to:"/teacher/login",className:"text-indigo-600 hover:underline",children:"Back to login"})})]})})]})},Zz=({collapsed:n,onToggle:e,isMobile:t=!1})=>{var b,y;const s=Qi(),i=Qt(),{teacher:r,quota:o,signOut:c}=Cm(),[d,h]=N.useState(!1),u=async()=>{await c(),i("/teacher/login")},p=o?Math.min(100,Number(o.tokensUsed||0)/Number(o.monthlyQuota||1e5)*100):0,f=[{section:"Main",items:[{icon:vW,label:"Dashboard",path:"/teacher/dashboard"},{icon:js,label:"My Content",path:"/teacher/content"},{icon:a3,label:"Create",path:"/teacher/content/create"}]},{section:"Tools",items:[{icon:va,label:"Lessons",path:"/teacher/lessons"},{icon:W0,label:"Quizzes",path:"/teacher/quizzes"},{icon:Ki,label:"Flashcards",path:"/teacher/flashcards"},{icon:hM,label:"Grading",path:"/teacher/grading",badge:"Soon",disabled:!0}]},{section:"Account",items:[{icon:e3,label:"Usage & Billing",path:"/teacher/usage"},{icon:Y$,label:"Settings",path:"/teacher/settings"}]}],m=C=>{switch(C==null?void 0:C.toUpperCase()){case"PROFESSIONAL":return a.jsx(NN,{className:"w-4 h-4 text-teacher-gold"});case"BASIC":return a.jsx(Vu,{className:"w-4 h-4 text-teacher-sage"});default:return a.jsx(n3,{className:"w-4 h-4 text-teacher-inkLight"})}},x=C=>{switch(C==null?void 0:C.toUpperCase()){case"PROFESSIONAL":return"teacher-badge professional";case"BASIC":return"teacher-badge basic";default:return"teacher-badge free"}},g=t||!n;return a.jsxs(R.aside,{initial:!1,animate:{width:t?280:n?80:280},transition:{duration:.3,ease:[.4,0,.2,1]},className:"teacher-sidebar h-screen sticky top-0 flex flex-col z-40",children:[a.jsx("div",{className:"p-4 border-b border-teacher-ink/5",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(qe,{to:"/teacher/dashboard",onClick:t?e:void 0,className:"flex items-center gap-3",children:[a.jsx("img",{src:"/assets/orbit-learn-icon.png",alt:"Orbit Learn",className:"w-10 h-10 flex-shrink-0"}),a.jsx(Ie,{children:g&&a.jsxs(R.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"overflow-hidden",children:[a.jsx("h1",{className:"font-display font-semibold text-lg text-teacher-ink leading-tight",children:"Orbit Learn"}),a.jsx("span",{className:"text-xs font-medium text-teacher-chalk",children:"Teacher Portal"})]})})]}),t&&a.jsx("button",{onClick:e,className:"p-2 rounded-xl text-teacher-inkLight hover:text-teacher-ink hover:bg-teacher-paper transition-all",children:a.jsx(on,{className:"w-5 h-5"})})]})}),a.jsx("nav",{className:"flex-1 overflow-y-auto py-4 px-2",children:f.map((C,w)=>a.jsxs("div",{className:w>0?"mt-6":"",children:[a.jsx(Ie,{children:g&&a.jsx(R.h3,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"px-4 mb-2 text-xs font-semibold text-teacher-inkLight/60 uppercase tracking-wider",children:C.section})}),a.jsx("ul",{className:"space-y-1",children:C.items.map(S=>{const j=s.pathname===S.path,T=S.icon;return a.jsx("li",{children:a.jsxs(qe,{to:S.disabled?"#":S.path,onClick:k=>{S.disabled?k.preventDefault():t&&e()},className:`
                        teacher-nav-item group relative
                        ${j?"active":""}
                        ${S.disabled?"opacity-50 cursor-not-allowed":""}
                        ${g?"":"justify-center px-0"}
                      `,title:g?void 0:S.label,children:[a.jsx(T,{className:`w-5 h-5 flex-shrink-0 ${j?"":"text-teacher-inkLight"}`}),a.jsx(Ie,{children:g&&a.jsx(R.span,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex-1",children:S.label})}),S.badge&&g&&a.jsx("span",{className:"px-2 py-0.5 text-[10px] font-bold uppercase rounded-full bg-teacher-gold/20 text-teacher-gold",children:S.badge}),!g&&!t&&a.jsxs("div",{className:"absolute left-full ml-2 px-3 py-2 bg-teacher-ink text-white text-sm font-medium rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all whitespace-nowrap z-50 shadow-teacher-lg",children:[S.label,S.badge&&a.jsxs("span",{className:"ml-2 text-teacher-gold text-xs",children:["(",S.badge,")"]}),a.jsx("div",{className:"absolute left-0 top-1/2 -translate-x-1 -translate-y-1/2 w-2 h-2 bg-teacher-ink rotate-45"})]})]})},S.path)})})]},C.section))}),a.jsx(Ie,{children:g&&a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"px-4 py-4 border-t border-teacher-ink/5",children:a.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-br from-teacher-chalk/5 to-teacher-gold/5 border border-teacher-ink/5",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("span",{className:"text-sm font-medium text-teacher-ink",children:"AI Credits"}),a.jsxs("span",{className:x(r==null?void 0:r.subscriptionTier),children:[m(r==null?void 0:r.subscriptionTier),(r==null?void 0:r.subscriptionTier)||"FREE"]})]}),a.jsx("div",{className:"teacher-progress mb-2",children:a.jsx("div",{className:`teacher-progress-bar ${p>90?"danger":p>70?"warning":""}`,style:{width:`${p}%`}})}),a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsxs("span",{className:"text-teacher-inkLight",children:[Math.round(p),"% used"]}),a.jsx(qe,{to:"/teacher/usage",className:"teacher-link text-xs",onClick:t?e:void 0,children:"View details"})]})]})})}),a.jsx("div",{className:"p-4 border-t border-teacher-ink/5",children:a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>g&&h(!d),className:`
              w-full flex items-center gap-3 p-2 rounded-xl
              hover:bg-teacher-paper transition-colors
              ${g?"":"justify-center"}
            `,children:[a.jsxs("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-teacher-terracotta to-teacher-terracottaLight flex items-center justify-center text-white font-bold text-sm flex-shrink-0 border-2 border-teacher-ink/10",children:[(b=r==null?void 0:r.firstName)==null?void 0:b[0],(y=r==null?void 0:r.lastName)==null?void 0:y[0]]}),a.jsx(Ie,{children:g&&a.jsxs(R.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"flex-1 text-left overflow-hidden",children:[a.jsxs("p",{className:"font-medium text-teacher-ink text-sm truncate",children:[r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]}),a.jsx("p",{className:"text-xs text-teacher-inkLight truncate",children:r==null?void 0:r.email})]})})]}),a.jsx(Ie,{children:d&&g&&a.jsxs(R.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-xl shadow-teacher-lg border border-teacher-ink/5 overflow-hidden",children:[a.jsxs(qe,{to:"/teacher/settings",className:"flex items-center gap-3 px-4 py-3 text-sm text-teacher-ink hover:bg-teacher-paper transition-colors",onClick:()=>{h(!1),t&&e()},children:[a.jsx(Y$,{className:"w-4 h-4"}),"Account Settings"]}),a.jsxs(qe,{to:"/teacher/help",className:"flex items-center gap-3 px-4 py-3 text-sm text-teacher-ink hover:bg-teacher-paper transition-colors",onClick:()=>{h(!1),t&&e()},children:[a.jsx(Ld,{className:"w-4 h-4"}),"Help & Support"]}),a.jsx("hr",{className:"border-teacher-ink/5"}),a.jsxs("button",{onClick:u,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-teacher-coral hover:bg-red-50 transition-colors",children:[a.jsx(Zae,{className:"w-4 h-4"}),"Sign Out"]})]})})]})}),!t&&a.jsx("button",{onClick:e,className:"absolute -right-3 top-20 w-6 h-6 bg-white rounded-full border border-teacher-ink/10 shadow-teacher-sm flex items-center justify-center text-teacher-inkLight hover:text-teacher-ink hover:shadow-teacher transition-all z-50",children:n?a.jsx(No,{className:"w-4 h-4"}):a.jsx(X1,{className:"w-4 h-4"})})]})},Qge=({title:n,subtitle:e,actions:t,onMenuToggle:s})=>a.jsxs("header",{className:"sticky top-0 z-30 bg-teacher-cream/80 backdrop-blur-xl border-b border-teacher-ink/5",children:[a.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-3 sm:py-4",children:a.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-4",children:[a.jsx("button",{onClick:s,className:"lg:hidden p-2 -ml-2 rounded-xl text-teacher-inkLight hover:text-teacher-ink hover:bg-white transition-all",children:a.jsx(toe,{className:"w-6 h-6"})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[n&&a.jsx(R.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"font-display text-xl sm:text-2xl lg:text-3xl font-semibold text-teacher-ink truncate",children:n}),e&&a.jsx(R.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"hidden sm:block text-sm text-teacher-inkLight mt-0.5 truncate",children:e})]}),a.jsxs("div",{className:"flex items-center gap-1 sm:gap-3 flex-shrink-0",children:[a.jsxs("div",{className:"hidden md:block relative",children:[a.jsx(D1,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-teacher-inkLight"}),a.jsx("input",{type:"text",placeholder:"Search content...",className:"w-48 lg:w-64 pl-10 pr-4 py-2 rounded-xl bg-white border border-teacher-ink/10 text-sm placeholder:text-teacher-inkLight/60 focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all"})]}),a.jsx("button",{className:"md:hidden p-2 sm:p-2.5 rounded-xl text-teacher-inkLight hover:text-teacher-ink hover:bg-white transition-all",children:a.jsx(D1,{className:"w-5 h-5"})}),a.jsx("button",{className:"hidden sm:block p-2.5 rounded-xl text-teacher-inkLight hover:text-teacher-ink hover:bg-white transition-all",children:a.jsx(Ld,{className:"w-5 h-5"})}),a.jsxs("button",{className:"relative p-2 sm:p-2.5 rounded-xl text-teacher-inkLight hover:text-teacher-ink hover:bg-white transition-all",children:[a.jsx(t3,{className:"w-5 h-5"}),a.jsx("span",{className:"absolute top-1.5 sm:top-2 right-1.5 sm:right-2 w-2 h-2 bg-teacher-terracotta rounded-full"})]}),t&&a.jsx("div",{className:"hidden sm:flex items-center gap-2 pl-2 border-l border-teacher-ink/10",children:t})]})]})}),a.jsx("div",{className:"h-0.5 bg-gradient-to-r from-teacher-terracotta via-teacher-gold via-teacher-sage to-teacher-plum opacity-30"})]}),OE=({children:n,title:e,subtitle:t,headerActions:s})=>{const[i,r]=N.useState(!1),[o,c]=N.useState(!1);return N.useEffect(()=>{const d=()=>{window.innerWidth>=1024&&c(!1)};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),N.useEffect(()=>(o?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[o]),a.jsxs("div",{className:"teacher-portal min-h-screen flex",children:[a.jsx("div",{className:"hidden lg:block flex-shrink-0",children:a.jsx(Zz,{collapsed:i,onToggle:()=>r(!i)})}),a.jsx(Ie,{children:o&&a.jsxs(a.Fragment,{children:[a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>c(!1),className:"fixed inset-0 bg-black/50 z-40 lg:hidden"}),a.jsx(R.div,{initial:{x:-300},animate:{x:0},exit:{x:-300},transition:{type:"spring",damping:25,stiffness:300},className:"fixed left-0 top-0 bottom-0 z-50 lg:hidden",children:a.jsx(Zz,{collapsed:!1,onToggle:()=>c(!1),isMobile:!0})})]})}),a.jsxs("div",{className:"flex-1 flex flex-col min-h-screen min-w-0",children:[a.jsx(Qge,{title:e,subtitle:t,actions:s,onMenuToggle:()=>c(!0)}),a.jsxs("main",{className:"flex-1 overflow-x-hidden overflow-y-auto",children:[a.jsxs("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:[a.jsx("div",{className:"absolute inset-0 bg-teacher-mesh opacity-60"}),a.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`
                  linear-gradient(rgba(30,42,58,0.02) 1px, transparent 1px),
                  linear-gradient(90deg, rgba(30,42,58,0.02) 1px, transparent 1px)
                `,backgroundSize:"40px 40px"}}),a.jsx(R.div,{animate:{y:[0,-20,0],rotate:[0,5,0]},transition:{duration:20,repeat:1/0,ease:"easeInOut"},className:"hidden md:block absolute top-20 right-20 w-64 h-64 rounded-full bg-teacher-gold/5 blur-3xl"}),a.jsx(R.div,{animate:{y:[0,20,0],rotate:[0,-5,0]},transition:{duration:25,repeat:1/0,ease:"easeInOut"},className:"hidden md:block absolute bottom-40 left-20 w-80 h-80 rounded-full bg-teacher-chalk/5 blur-3xl"}),a.jsx(R.div,{animate:{scale:[1,1.1,1]},transition:{duration:15,repeat:1/0,ease:"easeInOut"},className:"hidden md:block absolute top-1/2 right-1/4 w-48 h-48 rounded-full bg-teacher-terracotta/3 blur-3xl"})]}),a.jsx("div",{className:"relative z-10 px-4 sm:px-6 lg:px-8 py-4 sm:py-6 max-w-7xl mx-auto w-full",children:a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:n})})]})]})]})},Jge=()=>{var y,C,w,S,j,T,k,_;Qt();const{teacher:n,quota:e}=Cm(),[t,s]=N.useState(null),[i,r]=N.useState([]),[o,c]=N.useState(!0);N.useEffect(()=>{d()},[]);const d=async()=>{try{c(!0);const[L,D]=await Promise.all([lt.getContentStats().catch(()=>({success:!1})),lt.getRecentContent(5).catch(()=>({success:!1}))]);L.success&&s(L.data),D.success&&r(D.data)}catch(L){console.error("Failed to load dashboard data:",L)}finally{c(!1)}},h=L=>L?L>=1e6?`${(L/1e6).toFixed(1)}M`:L>=1e3?`${(L/1e3).toFixed(0)}K`:L.toString():"0",u=e?Math.min(100,Number(e.tokensUsed||0)/Number(e.monthlyQuota||1e5)*100):0,p=t?(((y=t.byType)==null?void 0:y.LESSON)||0)+(((C=t.byType)==null?void 0:C.QUIZ)||0)+(((w=t.byType)==null?void 0:w.FLASHCARD_DECK)||0)+(((S=t.byType)==null?void 0:S.STUDY_GUIDE)||0):0,f=()=>{const L=new Date().getHours();return L<12?"Good morning":L<17?"Good afternoon":"Good evening"},m=[{title:"Create Lesson",description:"Build engaging lessons with AI assistance",icon:js,color:"chalk",bgGradient:"from-teacher-chalk to-teacher-chalkLight",href:"/teacher/content/create"},{title:"Generate Quiz",description:"Create quizzes from any content",icon:jN,color:"gold",bgGradient:"from-teacher-gold to-teacher-goldLight",href:"/teacher/content/create?type=QUIZ"},{title:"Flashcards",description:"Create study flashcards instantly",icon:Ki,color:"plum",bgGradient:"from-teacher-plum to-teacher-plumLight",href:"/teacher/content/create?type=FLASHCARD_DECK"},{title:"Grade Papers",description:"AI-assisted grading with rubrics",icon:hM,color:"terracotta",bgGradient:"from-teacher-terracotta to-teacher-terracottaLight",href:"/teacher/grading",comingSoon:!0}],x={LESSON:{icon:js,label:"Lesson",colorClass:"lesson"},QUIZ:{icon:jN,label:"Quiz",colorClass:"quiz"},FLASHCARD_DECK:{icon:Ki,label:"Flashcards",colorClass:"flashcard"},STUDY_GUIDE:{icon:va,label:"Study Guide",colorClass:"guide"}},b=(L=>{switch(L==null?void 0:L.toUpperCase()){case"PROFESSIONAL":return NN;case"BASIC":return Vu;default:return n3}})(n==null?void 0:n.subscriptionTier);return a.jsxs(OE,{title:`${f()}, ${(n==null?void 0:n.firstName)||"Teacher"}!`,subtitle:"Here's what's happening with your content today",headerActions:a.jsxs(qe,{to:"/teacher/content/create",className:"teacher-btn-primary inline-flex items-center gap-2 text-sm",children:[a.jsx(rm,{className:"w-4 h-4"}),"Create Content"]}),children:[a.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"teacher-stat-card gold",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-xs sm:text-sm font-medium text-teacher-inkLight",children:"AI Credits"}),a.jsxs("p",{className:"text-xl sm:text-3xl font-display font-bold text-teacher-ink mt-1",children:[h((e==null?void 0:e.tokensUsed)||0),a.jsxs("span",{className:"text-sm sm:text-lg text-teacher-inkLight font-normal",children:[" ","/ ",h((e==null?void 0:e.monthlyQuota)||1e5)]})]})]}),a.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-teacher-gold/10 flex-shrink-0",children:a.jsx(b,{className:"w-4 h-4 sm:w-5 sm:h-5 text-teacher-gold"})})]}),a.jsx("div",{className:"teacher-progress mb-2",children:a.jsx("div",{className:`teacher-progress-bar ${u>90?"danger":u>70?"warning":""}`,style:{width:`${u}%`}})}),a.jsx("p",{className:"text-[10px] sm:text-xs text-teacher-inkLight",children:e!=null&&e.quotaResetDate?`Resets ${new Date(e.quotaResetDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})}`:"Monthly quota"})]}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},children:a.jsx(qe,{to:"/teacher/content",className:"block h-full",children:a.jsxs("div",{className:"teacher-stat-card chalk group cursor-pointer h-full",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-xs sm:text-sm font-medium text-teacher-inkLight",children:"Total Content"}),a.jsx("p",{className:"text-xl sm:text-3xl font-display font-bold text-teacher-ink mt-1",children:o?"...":p})]}),a.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-teacher-chalk/10 group-hover:bg-teacher-chalk/20 transition-colors flex-shrink-0",children:a.jsx(va,{className:"w-4 h-4 sm:w-5 sm:h-5 text-teacher-chalk"})})]}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-[10px] sm:text-xs text-teacher-inkLight",children:[a.jsxs("span",{children:[((j=t==null?void 0:t.byType)==null?void 0:j.LESSON)||0," lessons"]}),a.jsxs("span",{children:[((T=t==null?void 0:t.byType)==null?void 0:T.QUIZ)||0," quizzes"]})]}),a.jsxs("div",{className:"mt-2 sm:mt-3 hidden sm:flex items-center gap-1 text-sm text-teacher-chalk opacity-0 group-hover:opacity-100 transition-opacity",children:["View all ",a.jsx(No,{className:"w-4 h-4"})]})]})})}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"teacher-stat-card sage",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-xs sm:text-sm font-medium text-teacher-inkLight",children:"This Week"}),a.jsx("p",{className:"text-xl sm:text-3xl font-display font-bold text-teacher-ink mt-1",children:o?"...":(t==null?void 0:t.thisWeek)||0})]}),a.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-teacher-sage/10 flex-shrink-0",children:a.jsx(EN,{className:"w-4 h-4 sm:w-5 sm:h-5 text-teacher-sage"})})]}),a.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-[10px] sm:text-xs flex-wrap",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 sm:px-2 py-0.5 rounded-full bg-teacher-sage/10 text-teacher-sage",children:[a.jsx(EN,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),"+",(t==null?void 0:t.weekGrowth)||0,"%"]}),a.jsx("span",{className:"text-teacher-inkLight hidden sm:inline",children:"vs last week"})]})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:"teacher-stat-card terracotta relative overflow-hidden",children:[a.jsx("div",{className:"absolute top-2 sm:top-3 right-2 sm:right-3",children:a.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 text-[8px] sm:text-[10px] font-bold uppercase rounded-full bg-teacher-terracotta/10 text-teacher-terracotta",children:"Soon"})}),a.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-xs sm:text-sm font-medium text-teacher-inkLight",children:"Papers Graded"}),a.jsx("p",{className:"text-xl sm:text-3xl font-display font-bold text-teacher-ink/30 mt-1",children:"0"})]}),a.jsx("div",{className:"p-1.5 sm:p-2 rounded-lg bg-teacher-terracotta/10 flex-shrink-0",children:a.jsx(hM,{className:"w-4 h-4 sm:w-5 sm:h-5 text-teacher-terracotta/50"})})]}),a.jsx("p",{className:"text-[10px] sm:text-xs text-teacher-inkLight",children:"AI-powered grading"})]})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mb-6 sm:mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[a.jsx("h2",{className:"font-display text-lg sm:text-xl font-semibold text-teacher-ink",children:"Quick Actions"}),a.jsx(qe,{to:"/teacher/content/create",className:"teacher-link text-xs sm:text-sm",children:"View all tools"})]}),a.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:m.map((L,D)=>{const P=L.icon;return a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.35+D*.05},children:a.jsxs(qe,{to:L.comingSoon?"#":L.href,onClick:I=>L.comingSoon&&I.preventDefault(),className:`
                    teacher-depth-card block p-4 sm:p-6 group h-full
                    ${L.comingSoon?"opacity-60 cursor-not-allowed":""}
                  `,children:[a.jsx("div",{className:`
                    w-10 h-10 sm:w-14 sm:h-14 rounded-xl sm:rounded-2xl mb-3 sm:mb-4 flex items-center justify-center
                    bg-gradient-to-br ${L.bgGradient}
                    ${L.comingSoon?"grayscale":""}
                    group-hover:scale-110 transition-transform duration-300
                  `,children:a.jsx(P,{className:"w-5 h-5 sm:w-7 sm:h-7 text-white"})}),a.jsxs("div",{className:"flex items-start justify-between gap-1 sm:gap-2",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("h3",{className:"font-semibold text-teacher-ink mb-0.5 sm:mb-1 text-sm sm:text-base",children:L.title}),a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight line-clamp-2",children:L.description})]}),!L.comingSoon&&a.jsx(jm,{className:"w-4 h-4 sm:w-5 sm:h-5 text-teacher-inkLight opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all flex-shrink-0 hidden sm:block"})]}),L.comingSoon&&a.jsxs("div",{className:"mt-2 sm:mt-3 inline-flex items-center gap-1 text-[10px] sm:text-xs font-medium text-teacher-gold",children:[a.jsx(Ut,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),"Coming soon"]})]})},L.title)})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"lg:col-span-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[a.jsx("h2",{className:"font-display text-lg sm:text-xl font-semibold text-teacher-ink",children:"Recent Content"}),a.jsx(qe,{to:"/teacher/content",className:"teacher-link text-xs sm:text-sm",children:"View all"})]}),i.length>0?a.jsx("div",{className:"teacher-card overflow-hidden",children:a.jsx("div",{className:"divide-y divide-teacher-ink/5",children:i.map((L,D)=>{const P=x[L.contentType]||x.LESSON,I=P.icon;return a.jsxs(qe,{to:`/teacher/content/${L.id}`,className:"flex items-center gap-3 sm:gap-4 p-3 sm:p-4 hover:bg-teacher-paper/50 transition-colors group",children:[a.jsx("div",{className:`teacher-content-icon ${P.colorClass} flex-shrink-0`,children:a.jsx(I,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-teacher-ink text-sm sm:text-base truncate group-hover:text-teacher-chalk transition-colors",children:L.title}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 text-xs sm:text-sm text-teacher-inkLight mt-0.5",children:[L.subject&&a.jsxs("span",{className:"inline-flex items-center gap-1 hidden sm:flex",children:[a.jsx(hm,{className:"w-3 h-3"}),L.subject]}),a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx(Pd,{className:"w-3 h-3"}),new Date(L.updatedAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]})]}),a.jsx("span",{className:`
                        px-1.5 sm:px-2 py-0.5 sm:py-1 text-[10px] sm:text-xs font-medium rounded-lg flex-shrink-0
                        ${L.status==="PUBLISHED"?"bg-teacher-sage/10 text-teacher-sage":"bg-teacher-ink/5 text-teacher-inkLight"}
                      `,children:L.status}),a.jsx(No,{className:"w-4 h-4 sm:w-5 sm:h-5 text-teacher-inkLight opacity-0 group-hover:opacity-100 transition-opacity hidden sm:block"})]},L.id)})})}):a.jsxs("div",{className:"teacher-card p-6 sm:p-8 text-center",children:[a.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 relative",children:a.jsx("img",{src:"/assets/images/landing/hero-jeffrey-teaching.png",alt:"Jeffrey - Your AI Teaching Assistant",className:"w-full h-full object-contain"})}),a.jsx("h3",{className:"font-display text-base sm:text-lg font-semibold text-teacher-ink mb-2",children:"Ready to create your first content?"}),a.jsx("p",{className:"text-sm sm:text-base text-teacher-inkLight mb-4 sm:mb-6 max-w-md mx-auto",children:"I'm Jeffrey, your AI teaching assistant! Let me help you generate engaging lessons, quizzes, and flashcards for your students in minutes."}),a.jsxs(qe,{to:"/teacher/content/create",className:"teacher-btn-primary inline-flex items-center gap-2 text-sm",children:[a.jsx(rm,{className:"w-4 h-4"}),"Create Your First Content"]})]})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.55},children:[a.jsx("h2",{className:"font-display text-lg sm:text-xl font-semibold text-teacher-ink mb-3 sm:mb-4",children:"Getting Started"}),a.jsx("div",{className:"teacher-card p-4 sm:p-5 mb-3 sm:mb-4",children:a.jsx("div",{className:"space-y-3 sm:space-y-4",children:[{text:"Upload your first lesson PDF",done:p>0},{text:"Generate an AI quiz",done:((k=t==null?void 0:t.byType)==null?void 0:k.QUIZ)>0},{text:"Create flashcard deck",done:((_=t==null?void 0:t.byType)==null?void 0:_.FLASHCARD_DECK)>0},{text:"Explore grading tools",done:!1}].map((L,D)=>a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[a.jsx("div",{className:`
                    w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center flex-shrink-0
                    ${L.done?"bg-teacher-sage text-white":"border-2 border-teacher-ink/20"}
                  `,children:L.done&&a.jsx(Cr,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"})}),a.jsx("span",{className:`text-xs sm:text-sm ${L.done?"text-teacher-inkLight line-through":"text-teacher-ink"}`,children:L.text})]},D))})}),a.jsx("div",{className:"teacher-card teacher-accent-border p-4 sm:p-5 bg-gradient-to-br from-teacher-gold/5 to-transparent",children:a.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[a.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full overflow-hidden flex-shrink-0 border-2 border-teacher-gold/20 bg-teacher-paper",children:a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey",className:"w-full h-full object-cover"})}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("h4",{className:"font-semibold text-teacher-ink text-xs sm:text-sm mb-0.5 sm:mb-1",children:"Jeffrey's Tip"}),a.jsx("p",{className:"text-[11px] sm:text-xs text-teacher-inkLight leading-relaxed",children:"Upload a PDF of your existing lesson materials, and I'll automatically generate a beautifully formatted lesson, complete with quizzes and flashcards!"})]})]})})]})]}),a.jsx(qe,{to:"/teacher/content/create",className:"teacher-fab lg:hidden fixed bottom-6 right-4 sm:right-6",children:a.jsx(rm,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})},$R={LESSON:{label:"Lesson",icon:js,color:"teacher-chalk",bgClass:"bg-teacher-chalk/10",textClass:"text-teacher-chalk"},QUIZ:{label:"Quiz",icon:W0,color:"teacher-sage",bgClass:"bg-teacher-sage/10",textClass:"text-teacher-sage"},FLASHCARD_DECK:{label:"Flashcards",icon:Ki,color:"teacher-gold",bgClass:"bg-teacher-gold/10",textClass:"text-teacher-gold"},STUDY_GUIDE:{label:"Study Guide",icon:va,color:"teacher-plum",bgClass:"bg-teacher-plum/10",textClass:"text-teacher-plum"},WORKSHEET:{label:"Worksheet",icon:CW,color:"teacher-terracotta",bgClass:"bg-teacher-terracotta/10",textClass:"text-teacher-terracotta"},INFOGRAPHIC:{label:"Infographic",icon:P1,color:"teacher-coral",bgClass:"bg-teacher-coral/10",textClass:"text-teacher-coral"}},UR={DRAFT:{label:"Draft",className:"bg-teacher-inkLight/10 text-teacher-inkLight"},REVIEW:{label:"Review",className:"bg-teacher-gold/10 text-teacher-gold"},PUBLISHED:{label:"Published",className:"bg-teacher-sage/10 text-teacher-sage"},ARCHIVED:{label:"Archived",className:"bg-teacher-coral/10 text-teacher-coral"}},Zge=[{value:"",label:"All Subjects"},{value:"MATH",label:"Math"},{value:"SCIENCE",label:"Science"},{value:"ENGLISH",label:"English"},{value:"SOCIAL_STUDIES",label:"Social Studies"},{value:"ART",label:"Art"},{value:"MUSIC",label:"Music"},{value:"OTHER",label:"Other"}],exe=()=>{var D,P,I,M;Qt();const[n,e]=wte(),[t,s]=N.useState([]),[i,r]=N.useState(!0),[o,c]=N.useState(null),[d,h]=N.useState(null),[u,p]=N.useState({page:1,limit:12,total:0,totalPages:0}),[f,m]=N.useState({contentType:n.get("type")||"",subject:n.get("subject")||"",status:n.get("status")||"",search:n.get("search")||""}),[x,g]=N.useState({open:!1,content:null}),[b,y]=N.useState(!1),C=N.useCallback(async()=>{r(!0),c(null);try{const O={page:u.page,limit:u.limit,...f.contentType&&{contentType:f.contentType},...f.subject&&{subject:f.subject},...f.status&&{status:f.status},...f.search&&{search:f.search}},F=await lt.listContent(O);F.success&&(s(F.data||[]),p(B=>{var U,$;return{...B,total:((U=F.pagination)==null?void 0:U.total)||0,totalPages:(($=F.pagination)==null?void 0:$.totalPages)||0}}))}catch(O){c(O.message||"Failed to load content")}finally{r(!1)}},[u.page,u.limit,f]),w=N.useCallback(async()=>{try{const O=await lt.getContentStats();O.success&&h(O.data)}catch(O){console.error("Failed to load stats:",O)}},[]);N.useEffect(()=>{C()},[C]),N.useEffect(()=>{w()},[w]),N.useEffect(()=>{const O=new URLSearchParams;f.contentType&&O.set("type",f.contentType),f.subject&&O.set("subject",f.subject),f.status&&O.set("status",f.status),f.search&&O.set("search",f.search),e(O,{replace:!0})},[f,e]);const S=(O,F)=>{m(B=>({...B,[O]:F})),p(B=>({...B,page:1}))},j=async()=>{if(x.content){y(!0);try{await lt.deleteContent(x.content.id),g({open:!1,content:null}),C(),w()}catch(O){c(O.message||"Failed to delete content")}finally{y(!1)}}},T=async O=>{try{await lt.duplicateContent(O),C()}catch(F){c(F.message||"Failed to duplicate content")}},k=O=>new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),_=d?Object.values(d.byType||{}).reduce((O,F)=>O+F,0):0,L=a.jsxs(qe,{to:"/teacher/content/create",className:"teacher-btn-primary flex items-center gap-2",children:[a.jsx(rm,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Create Content"}),a.jsx("span",{className:"sm:hidden",children:"Create"})]});return a.jsxs(OE,{title:"My Content",subtitle:"Create and manage your lessons, quizzes, and study materials",headerActions:L,children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[a.jsxs("div",{className:"teacher-stat-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(Wae,{className:"w-5 h-5 sm:w-6 sm:h-6 text-teacher-ink"})}),a.jsx("p",{className:"text-xl sm:text-2xl font-bold text-teacher-ink",children:_}),a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight",children:"Total Content"})]}),a.jsxs("div",{className:"teacher-stat-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(js,{className:"w-5 h-5 sm:w-6 sm:h-6 text-teacher-chalk"})}),a.jsx("p",{className:"text-xl sm:text-2xl font-bold text-teacher-chalk",children:((D=d==null?void 0:d.byType)==null?void 0:D.LESSON)||0}),a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight",children:"Lessons"})]}),a.jsxs("div",{className:"teacher-stat-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(W0,{className:"w-5 h-5 sm:w-6 sm:h-6 text-teacher-sage"})}),a.jsx("p",{className:"text-xl sm:text-2xl font-bold text-teacher-sage",children:((P=d==null?void 0:d.byType)==null?void 0:P.QUIZ)||0}),a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight",children:"Quizzes"})]}),a.jsxs("div",{className:"teacher-stat-card",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx(Ki,{className:"w-5 h-5 sm:w-6 sm:h-6 text-teacher-gold"})}),a.jsx("p",{className:"text-xl sm:text-2xl font-bold text-teacher-gold",children:((I=d==null?void 0:d.byType)==null?void 0:I.FLASHCARD_DECK)||0}),a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight",children:"Flashcards"})]})]}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"teacher-card p-3 sm:p-4 mb-4 sm:mb-6",children:a.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D1,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-teacher-inkLight"}),a.jsx("input",{type:"text",placeholder:"Search content...",value:f.search,onChange:O=>S("search",O.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-2.5 border border-teacher-ink/10 rounded-xl bg-white text-sm placeholder:text-teacher-inkLight/60 focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all"})]}),a.jsxs("div",{className:"flex gap-2 sm:gap-3 overflow-x-auto pb-1 -mx-3 px-3 sm:mx-0 sm:px-0 sm:overflow-visible",children:[a.jsxs("select",{value:f.contentType,onChange:O=>S("contentType",O.target.value),className:"flex-shrink-0 px-3 sm:px-4 py-2 border border-teacher-ink/10 rounded-xl bg-white text-sm focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all",children:[a.jsx("option",{value:"",children:"All Types"}),Object.entries($R).map(([O,{label:F}])=>a.jsx("option",{value:O,children:F},O))]}),a.jsx("select",{value:f.subject,onChange:O=>S("subject",O.target.value),className:"flex-shrink-0 px-3 sm:px-4 py-2 border border-teacher-ink/10 rounded-xl bg-white text-sm focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all",children:Zge.map(({value:O,label:F})=>a.jsx("option",{value:O,children:F},O))}),a.jsxs("select",{value:f.status,onChange:O=>S("status",O.target.value),className:"flex-shrink-0 px-3 sm:px-4 py-2 border border-teacher-ink/10 rounded-xl bg-white text-sm focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all",children:[a.jsx("option",{value:"",children:"All Status"}),Object.entries(UR).map(([O,{label:F}])=>a.jsx("option",{value:O,children:F},O))]})]})]})}),o&&a.jsx(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-teacher-coral/10 border border-teacher-coral/20 text-teacher-coral px-4 py-3 rounded-xl mb-4 sm:mb-6 text-sm",children:o}),i?a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[...Array(6)].map((O,F)=>a.jsxs("div",{className:"teacher-card p-4 sm:p-6 animate-pulse",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-10 h-10 bg-teacher-ink/5 rounded-xl"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"h-4 bg-teacher-ink/5 rounded w-3/4 mb-2"}),a.jsx("div",{className:"h-3 bg-teacher-ink/5 rounded w-1/2"})]})]}),a.jsx("div",{className:"h-3 bg-teacher-ink/5 rounded w-full mb-2"}),a.jsx("div",{className:"h-3 bg-teacher-ink/5 rounded w-2/3"})]},F))}):t.length===0?a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"teacher-card p-6 sm:p-10 text-center",children:[a.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-4 relative",children:a.jsx("img",{src:"/assets/images/landing/hero-jeffrey-teaching.png",alt:"Jeffrey - Your AI Teaching Assistant",className:"w-full h-full object-contain"})}),a.jsx("h3",{className:"font-display text-lg sm:text-xl font-semibold text-teacher-ink mb-2",children:"No content yet"}),a.jsx("p",{className:"text-sm sm:text-base text-teacher-inkLight mb-6 max-w-md mx-auto",children:"Create your first piece of content to get started. I can help you build lessons, quizzes, flashcards, and more!"}),a.jsxs(qe,{to:"/teacher/content/create",className:"teacher-btn-primary inline-flex items-center gap-2",children:[a.jsx(Ut,{className:"w-4 h-4"}),"Create Your First Content"]})]}):a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:t.map((O,F)=>{const B=$R[O.contentType]||$R.LESSON,U=UR[O.status]||UR.DRAFT,$=B.icon;return a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:F*.05},className:"teacher-card group hover:shadow-teacher-lg hover:border-teacher-chalk/20 transition-all",children:[a.jsxs(qe,{to:`/teacher/content/${O.id}`,className:"block p-4 sm:p-6",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[a.jsx("div",{className:`inline-flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-xl ${B.bgClass}`,children:a.jsx($,{className:`w-5 h-5 sm:w-6 sm:h-6 ${B.textClass}`})}),a.jsx("span",{className:`text-[10px] sm:text-xs font-semibold px-2 py-1 rounded-full ${U.className}`,children:U.label})]}),a.jsx("h3",{className:"font-semibold text-teacher-ink mb-2 group-hover:text-teacher-chalk transition-colors line-clamp-2 text-sm sm:text-base",children:O.title}),O.description&&a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight mb-3 sm:mb-4 line-clamp-2",children:O.description}),a.jsxs("div",{className:"flex items-center justify-between text-[10px] sm:text-xs text-teacher-inkLight/70",children:[a.jsx("span",{className:`font-medium ${B.textClass}`,children:B.label}),a.jsxs("span",{children:["Updated ",k(O.updatedAt)]})]})]}),a.jsxs("div",{className:"border-t border-teacher-ink/5 px-4 sm:px-6 py-2 sm:py-3 flex items-center justify-end gap-1 sm:gap-2",children:[a.jsx("button",{onClick:G=>{G.preventDefault(),T(O.id)},className:"p-2 text-teacher-inkLight hover:text-teacher-chalk hover:bg-teacher-chalk/10 rounded-lg transition-colors",title:"Duplicate",children:a.jsx(xW,{className:"w-4 h-4"})}),a.jsx("button",{onClick:G=>{G.preventDefault(),g({open:!0,content:O})},className:"p-2 text-teacher-inkLight hover:text-teacher-coral hover:bg-teacher-coral/10 rounded-lg transition-colors",title:"Delete",children:a.jsx(um,{className:"w-4 h-4"})})]})]},O.id)})}),u.totalPages>1&&a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center gap-2 sm:gap-3 mt-6 sm:mt-8",children:[a.jsxs("button",{onClick:()=>p(O=>({...O,page:O.page-1})),disabled:u.page===1,className:"p-2 sm:px-4 sm:py-2 border border-teacher-ink/10 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:border-teacher-chalk/20 transition-colors flex items-center gap-1 sm:gap-2 text-sm",children:[a.jsx(X1,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),a.jsxs("span",{className:"px-3 sm:px-4 py-2 text-xs sm:text-sm text-teacher-inkLight",children:["Page ",u.page," of ",u.totalPages]}),a.jsxs("button",{onClick:()=>p(O=>({...O,page:O.page+1})),disabled:u.page===u.totalPages,className:"p-2 sm:px-4 sm:py-2 border border-teacher-ink/10 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white hover:border-teacher-chalk/20 transition-colors flex items-center gap-1 sm:gap-2 text-sm",children:[a.jsx("span",{className:"hidden sm:inline",children:"Next"}),a.jsx(No,{className:"w-4 h-4"})]})]}),a.jsx(Ie,{children:x.open&&a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>g({open:!1,content:null}),children:a.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-2xl shadow-teacher-xl max-w-md w-full p-6",onClick:O=>O.stopPropagation(),children:[a.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-full bg-teacher-coral/10 flex items-center justify-center",children:a.jsx(um,{className:"w-6 h-6 text-teacher-coral"})}),a.jsx("h3",{className:"font-display text-lg font-semibold text-teacher-ink mb-2 text-center",children:"Delete Content"}),a.jsxs("p",{className:"text-teacher-inkLight text-center mb-6",children:['Are you sure you want to delete "',a.jsx("span",{className:"font-medium text-teacher-ink",children:(M=x.content)==null?void 0:M.title}),'"? This action cannot be undone.']}),a.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a.jsx("button",{onClick:()=>g({open:!1,content:null}),className:"px-5 py-2.5 text-teacher-inkLight hover:text-teacher-ink font-medium rounded-xl hover:bg-teacher-paper transition-colors",disabled:b,children:"Cancel"}),a.jsx("button",{onClick:j,disabled:b,className:"px-5 py-2.5 bg-teacher-coral text-white font-medium rounded-xl hover:bg-teacher-coral/90 disabled:opacity-50 transition-colors",children:b?"Deleting...":"Delete"})]})]})})})]})},zR=({size:n="md"})=>{const e={sm:"w-8 h-8",md:"w-10 h-10 sm:w-12 sm:h-12",lg:"w-14 h-14 sm:w-16 sm:h-16"};return a.jsx("div",{className:`${e[n]} rounded-full overflow-hidden flex-shrink-0 border-2 border-teacher-gold/20 bg-teacher-paper`,children:a.jsx("img",{src:"/assets/images/jeffrey-avatar.png",alt:"Jeffrey",className:"w-full h-full object-cover"})})},txe=({teacher:n,size:e="md"})=>{var s,i;const t={sm:"w-8 h-8 text-xs",md:"w-10 h-10 sm:w-12 sm:h-12 text-sm"};return a.jsxs("div",{className:`${t[e]} rounded-full bg-gradient-to-br from-teacher-terracotta to-teacher-terracottaLight flex items-center justify-center text-white font-bold flex-shrink-0 border-2 border-teacher-ink/10`,children:[(s=n==null?void 0:n.firstName)==null?void 0:s[0],(i=n==null?void 0:n.lastName)==null?void 0:i[0]]})},sxe=[{value:"MATH",label:"Mathematics"},{value:"SCIENCE",label:"Science"},{value:"ENGLISH",label:"English Language Arts"},{value:"SOCIAL_STUDIES",label:"Social Studies"},{value:"HISTORY",label:"History"},{value:"GEOGRAPHY",label:"Geography"},{value:"ART",label:"Art"},{value:"MUSIC",label:"Music"},{value:"PHYSICAL_EDUCATION",label:"Physical Education"},{value:"COMPUTER_SCIENCE",label:"Computer Science"},{value:"FOREIGN_LANGUAGE",label:"Foreign Language"},{value:"OTHER",label:"Other"}],nxe=[{value:"K",label:"Kindergarten"},{value:"1",label:"1st Grade"},{value:"2",label:"2nd Grade"},{value:"3",label:"3rd Grade"},{value:"4",label:"4th Grade"},{value:"5",label:"5th Grade"},{value:"6",label:"6th Grade"},{value:"7",label:"7th Grade"},{value:"8",label:"8th Grade"},{value:"9",label:"9th Grade"},{value:"10",label:"10th Grade"},{value:"11",label:"11th Grade"},{value:"12",label:"12th Grade"}],ixe=[{value:"",label:"No specific curriculum"},{value:"COMMON_CORE",label:"Common Core (US)"},{value:"NGSS",label:"Next Generation Science Standards (US)"},{value:"UK_NATIONAL",label:"UK National Curriculum"},{value:"CAMBRIDGE",label:"Cambridge International"},{value:"IB_PYP",label:"IB Primary Years Programme"},{value:"IB_MYP",label:"IB Middle Years Programme"},{value:"AUSTRALIAN",label:"Australian Curriculum"},{value:"SINGAPORE",label:"Singapore Curriculum"},{value:"ONTARIO",label:"Ontario Curriculum (Canada)"},{value:"CCSS_MATH",label:"Common Core Math Standards"},{value:"CCSS_ELA",label:"Common Core ELA Standards"},{value:"STATE_SPECIFIC",label:"State-Specific Standards"},{value:"OTHER",label:"Other"}],rxe=["Create a lesson about fractions for 4th graders","I need to teach the water cycle to my 3rd grade class","Help me create a lesson on the American Revolution"],axe=[{id:"guide",name:"Lesson Guide",description:"A structured outline with key points, activities, and teaching tips",credits:"~2-3K",icon:va,color:"teacher-chalk",features:["Learning objectives","Section outlines","Activity ideas","Assessment tips"]},{id:"full",name:"Full Lesson",description:"Comprehensive 5-10 page lesson with detailed content ready for students",credits:"~8-12K",icon:js,color:"teacher-gold",features:["Complete explanations","Student-ready content","Detailed examples","Worksheets & exercises","PDF export ready"]}],oxe=()=>{const n=Qt(),{teacher:e,quota:t}=Cm(),s=N.useRef(null),i=N.useRef(null),[r,o]=N.useState([{id:1,sender:"jeffrey",text:`Hi! I'm Jeffrey, your teaching assistant!

Tell me what you'd like to create today. You can describe your lesson idea, and I'll help you build something amazing for your students.`,timestamp:new Date}]),[c,d]=N.useState(""),[h,u]=N.useState(!1),[p,f]=N.useState({topic:"",subject:"",gradeLevel:"",curriculum:"",duration:45,objectives:[],lessonType:"guide",includeQuiz:!0,includeFlashcards:!0,includeInfographic:!1,includeActivities:!0,additionalNotes:""}),[m,x]=N.useState(!1),[g,b]=N.useState(!1),[y,C]=N.useState(null),[w,S]=N.useState(null),[j,T]=N.useState("initial");N.useEffect(()=>{var F;(F=s.current)==null||F.scrollIntoView({behavior:"smooth"})},[r]);const k=(F,B)=>{const U={id:Date.now(),sender:F,text:B,timestamp:new Date};return o($=>[...$,U]),U},_=async(F=1e3)=>{u(!0),await new Promise(B=>setTimeout(B,F)),u(!1)},L=async()=>{if(!c.trim())return;const F=c.trim();d(""),k("teacher",F),await _(800),j==="initial"||!p.topic?(f(B=>({...B,topic:F})),T("gathering"),k("jeffrey",`Great topic! "${F}" sounds like it will be an engaging lesson!

Let me help you set up the details. Please select the options below, and I'll create a comprehensive lesson plan for you.`),x(!0)):j==="gathering"&&(f(B=>({...B,additionalNotes:B.additionalNotes+`
`+F})),k("jeffrey",`Got it! I've noted that down. Feel free to adjust the options below or add more details. When you're ready, click "Generate Lesson" to create your content!`))},D=F=>{F.key==="Enter"&&!F.shiftKey&&(F.preventDefault(),L())},P=F=>{var B;d(F),(B=i.current)==null||B.focus()},I=async()=>{var B,U,$,G,ne,Z;if(!p.topic){C("Please describe what lesson you want to create first.");return}b(!0),C(null),T("generating");const F=p.lessonType==="full";k("jeffrey",`Perfect! I'm now creating your ${F?"full lesson":"lesson guide"} on "${p.topic}"...

Building lesson structure
Writing content sections${F?`
Creating detailed explanations
Developing student materials`:""}
${p.includeQuiz?`Generating quiz questions
`:""}${p.includeFlashcards?`Creating flashcards
`:""}${p.includeActivities?`Designing activities
`:""}${p.includeInfographic?`Generating infographic
`:""}
${F?"This will take a bit longer for the comprehensive content...":"This may take a moment..."}`);try{const K=await lt.generateLesson({topic:p.topic,subject:p.subject||void 0,gradeLevel:p.gradeLevel||void 0,curriculum:p.curriculum||void 0,duration:p.duration,lessonType:p.lessonType,includeActivities:p.includeActivities,includeAssessment:p.includeQuiz,additionalContext:p.additionalNotes});if(K.success){S(K.data);const X=await lt.createContent({title:K.data.title||p.topic,description:K.data.summary||`Lesson about ${p.topic}`,subject:p.subject||void 0,gradeLevel:p.gradeLevel||void 0,contentType:"LESSON",lessonContent:K.data});if(X.success){const V=X.data.id;if(p.includeFlashcards)try{await lt.generateFlashcards(V,{content:((B=K.data.sections)==null?void 0:B.map(ee=>ee.content).join(`
`))||p.topic,title:`${K.data.title} Flashcards`,cardCount:15,includeHints:!0,gradeLevel:p.gradeLevel},!0)}catch(ee){console.warn("Flashcard generation failed:",ee)}let q=!1;if(p.includeInfographic)try{const ee=[...(K.data.objectives||[]).slice(0,3),...(K.data.sections||[]).slice(0,4).map(ie=>ie.title),...(K.data.vocabulary||[]).slice(0,3).map(ie=>`${ie.term}: ${ie.definition}`)].filter(Boolean).slice(0,8);ee.length>=3&&(await lt.generateInfographic(V,{topic:K.data.title||p.topic,keyPoints:ee,style:"colorful",gradeLevel:p.gradeLevel,subject:p.subject}),q=!0)}catch(ee){console.warn("Infographic generation failed:",ee)}T("complete"),k("jeffrey",`Your lesson is ready!

I've created:
- Complete lesson plan with ${((U=K.data.sections)==null?void 0:U.length)||0} sections
${($=K.data.objectives)!=null&&$.length?`- ${K.data.objectives.length} learning objectives
`:""}${(G=K.data.vocabulary)!=null&&G.length?`- ${K.data.vocabulary.length} vocabulary terms
`:""}${(Z=(ne=K.data.assessment)==null?void 0:ne.questions)!=null&&Z.length?`- ${K.data.assessment.questions.length} assessment questions
`:""}${p.includeFlashcards?`- Study flashcards
`:""}${q?`- Visual infographic
`:""}
Click below to view and edit your lesson!`),setTimeout(()=>{n(`/teacher/content/${V}`)},2e3)}}else throw new Error(K.error||"Generation failed")}catch(K){C(K.message||"Failed to generate lesson"),k("jeffrey",`Oops! Something went wrong: ${K.message}

Please try again or adjust your request.`),T("gathering")}finally{b(!1)}},M=F=>F?F>=1e6?`${(F/1e6).toFixed(1)}M`:F>=1e3?`${(F/1e3).toFixed(0)}K`:F.toString():"0",O=a.jsxs(qe,{to:"/teacher/content",className:"teacher-btn-secondary flex items-center gap-2",children:[a.jsx(wE,{className:"w-4 h-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Back to Content"})]});return a.jsx(OE,{title:"Create with Jeffrey",subtitle:"Your AI teaching assistant",headerActions:O,children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("div",{className:"teacher-card overflow-hidden flex flex-col",style:{minHeight:"600px"},children:[a.jsx("div",{className:"px-4 sm:px-6 py-4 border-b border-teacher-ink/5 bg-gradient-to-r from-teacher-chalk to-teacher-chalkLight",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(zR,{size:"md"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-white font-semibold text-base sm:text-lg",children:"Jeffrey"}),a.jsx("p",{className:"text-white/80 text-xs sm:text-sm",children:"Ready to help you create amazing content"})]}),a.jsxs("div",{className:"ml-auto hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 text-white/90 text-xs",children:[a.jsx(Vu,{className:"w-3 h-3"}),M((t==null?void 0:t.tokensRemaining)||0)," credits"]})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4",style:{minHeight:"250px",maxHeight:"350px"},children:[r.map(F=>a.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-2 sm:gap-3 ${F.sender==="teacher"?"flex-row-reverse":""}`,children:[F.sender==="jeffrey"?a.jsx(zR,{size:"sm"}):a.jsx(txe,{teacher:e,size:"sm"}),a.jsx("div",{className:`max-w-[85%] sm:max-w-[80%] rounded-2xl px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base ${F.sender==="jeffrey"?"bg-teacher-paper text-teacher-ink":"bg-teacher-chalk text-white"}`,style:{whiteSpace:"pre-wrap"},children:F.text})]},F.id)),h&&a.jsxs(R.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-2 sm:gap-3",children:[a.jsx(zR,{size:"sm"}),a.jsx("div",{className:"bg-teacher-paper rounded-2xl px-4 py-3",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx("span",{className:"w-2 h-2 bg-teacher-inkLight rounded-full animate-bounce",style:{animationDelay:"0ms"}}),a.jsx("span",{className:"w-2 h-2 bg-teacher-inkLight rounded-full animate-bounce",style:{animationDelay:"150ms"}}),a.jsx("span",{className:"w-2 h-2 bg-teacher-inkLight rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),a.jsx("div",{ref:s})]}),y&&a.jsx("div",{className:"mx-4 sm:mx-6 mb-4 p-3 bg-teacher-coral/10 border border-teacher-coral/20 rounded-xl text-teacher-coral text-sm",children:y}),a.jsx(Ie,{children:m&&a.jsxs(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-teacher-ink/5 bg-teacher-paper/50 px-4 sm:px-6 py-4 overflow-hidden",children:[a.jsxs("div",{className:"mb-5",children:[a.jsx("h3",{className:"font-semibold text-teacher-ink mb-3 text-sm sm:text-base",children:"What would you like to create?"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:axe.map(F=>{const B=F.icon,U=p.lessonType===F.id;return a.jsxs("button",{onClick:()=>f($=>({...$,lessonType:F.id})),className:`relative text-left p-3 sm:p-4 rounded-xl border-2 transition-all ${U?`border-${F.color} bg-${F.color}/5 shadow-teacher`:"border-teacher-ink/10 bg-white hover:border-teacher-ink/20"}`,children:[U&&a.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3",children:a.jsx("div",{className:`w-5 h-5 sm:w-6 sm:h-6 bg-${F.color} rounded-full flex items-center justify-center`,children:a.jsx(bo,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})})}),a.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[a.jsx("div",{className:`w-9 h-9 sm:w-10 sm:h-10 rounded-lg bg-${F.color}/10 flex items-center justify-center flex-shrink-0`,children:a.jsx(B,{className:`w-4 h-4 sm:w-5 sm:h-5 text-${F.color}`})}),a.jsxs("div",{className:"flex-1 min-w-0 pr-6",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsx("h4",{className:"font-semibold text-teacher-ink text-sm sm:text-base",children:F.name}),a.jsx("span",{className:`text-[10px] sm:text-xs px-2 py-0.5 rounded-full ${U?`bg-${F.color}/20 text-${F.color}`:"bg-teacher-ink/5 text-teacher-inkLight"}`,children:F.credits})]}),a.jsx("p",{className:"text-xs sm:text-sm text-teacher-inkLight mt-1 line-clamp-2",children:F.description}),a.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:F.features.slice(0,3).map(($,G)=>a.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${U?`bg-${F.color}/10 text-${F.color}`:"bg-teacher-ink/5 text-teacher-inkLight"}`,children:$},G))})]})]})]},F.id)})})]}),a.jsx("h3",{className:"font-semibold text-teacher-ink mb-3 text-sm sm:text-base",children:"Lesson Options"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-teacher-inkLight mb-1",children:"Subject"}),a.jsxs("select",{value:p.subject,onChange:F=>f(B=>({...B,subject:F.target.value})),className:"w-full px-3 py-2 border border-teacher-ink/10 rounded-xl text-sm bg-white focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all",children:[a.jsx("option",{value:"",children:"Select subject"}),sxe.map(({value:F,label:B})=>a.jsx("option",{value:F,children:B},F))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-teacher-inkLight mb-1",children:"Grade Level"}),a.jsxs("select",{value:p.gradeLevel,onChange:F=>f(B=>({...B,gradeLevel:F.target.value})),className:"w-full px-3 py-2 border border-teacher-ink/10 rounded-xl text-sm bg-white focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all",children:[a.jsx("option",{value:"",children:"Select grade"}),nxe.map(({value:F,label:B})=>a.jsx("option",{value:F,children:B},F))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-teacher-inkLight mb-1",children:"Curriculum"}),a.jsx("select",{value:p.curriculum,onChange:F=>f(B=>({...B,curriculum:F.target.value})),className:"w-full px-3 py-2 border border-teacher-ink/10 rounded-xl text-sm bg-white focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 transition-all",children:ixe.map(({value:F,label:B})=>a.jsx("option",{value:F,children:B},F))})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-teacher-inkLight mb-1",children:["Lesson Duration: ",a.jsxs("span",{className:"text-teacher-ink font-semibold",children:[p.duration," minutes"]})]}),a.jsx("input",{type:"range",min:"15",max:"90",step:"5",value:p.duration,onChange:F=>f(B=>({...B,duration:parseInt(F.target.value)})),className:"w-full h-2 bg-teacher-ink/10 rounded-lg appearance-none cursor-pointer accent-teacher-chalk"}),a.jsxs("div",{className:"flex justify-between text-[10px] sm:text-xs text-teacher-inkLight mt-1",children:[a.jsx("span",{children:"15 min"}),a.jsx("span",{children:"90 min"})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-teacher-inkLight mb-2",children:"Include in lesson:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"includeActivities",label:"Activities",icon:qae},{key:"includeQuiz",label:"Quiz",icon:W0},{key:"includeFlashcards",label:"Flashcards",icon:Ki},{key:"includeInfographic",label:"Infographic",icon:P1}].map(({key:F,label:B,icon:U})=>a.jsxs("label",{className:`flex items-center gap-2 px-3 py-2 border rounded-xl cursor-pointer transition-all text-xs sm:text-sm ${p[F]?"border-teacher-chalk bg-teacher-chalk/5 text-teacher-chalk":"border-teacher-ink/10 bg-white text-teacher-inkLight hover:border-teacher-ink/20"}`,children:[a.jsx("input",{type:"checkbox",checked:p[F],onChange:$=>f(G=>({...G,[F]:$.target.checked})),className:"sr-only"}),a.jsx(U,{className:"w-4 h-4"}),a.jsx("span",{children:B}),p[F]&&a.jsx(bo,{className:"w-3 h-3"})]},F))})]}),a.jsx("button",{onClick:I,disabled:g||!p.topic,className:"w-full py-3 px-6 bg-gradient-to-r from-teacher-chalk to-teacher-chalkLight text-white font-semibold rounded-xl hover:shadow-teacher-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all",children:g?a.jsxs(a.Fragment,{children:[a.jsx(nc,{className:"w-5 h-5 animate-spin"}),p.lessonType==="full"?"Creating full lesson...":"Creating lesson guide..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ut,{className:"w-5 h-5"}),"Generate ",p.lessonType==="full"?"Full Lesson":"Lesson Guide"]})})]})}),a.jsxs("div",{className:"border-t border-teacher-ink/5 p-3 sm:p-4 bg-white",children:[j==="initial"&&a.jsxs("div",{className:"mb-3",children:[a.jsx("p",{className:"text-[10px] sm:text-xs text-teacher-inkLight mb-2",children:"Try one of these:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:rxe.map((F,B)=>a.jsx("button",{onClick:()=>P(F),className:"text-[10px] sm:text-xs px-2 sm:px-3 py-1 sm:py-1.5 bg-teacher-chalk/10 text-teacher-chalk rounded-full hover:bg-teacher-chalk/20 transition-colors",children:F},B))})]}),a.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[a.jsx("input",{ref:i,type:"text",value:c,onChange:F=>d(F.target.value),onKeyPress:D,placeholder:j==="initial"?"Describe the lesson you want to create...":"Add more details or requirements...",disabled:g||j==="complete",className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 border border-teacher-ink/10 rounded-xl text-sm focus:outline-none focus:border-teacher-chalk focus:ring-2 focus:ring-teacher-chalk/10 disabled:bg-teacher-paper disabled:cursor-not-allowed transition-all"}),a.jsx("button",{onClick:L,disabled:!c.trim()||g||j==="complete",className:"px-3 sm:px-4 py-2.5 sm:py-3 bg-teacher-chalk text-white rounded-xl hover:bg-teacher-chalkLight disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a.jsx(AN,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})]}),a.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2 text-xs sm:text-sm text-teacher-inkLight",children:[a.jsx(bW,{className:"w-4 h-4"}),a.jsx("span",{children:p.lessonType==="full"?"Full lesson uses approximately 8-12K credits":"Lesson guide uses approximately 2-3K credits"})]})]})})};function lxe({contentId:n,contentTitle:e,onExportStart:t,onExportEnd:s}){const[i,r]=N.useState(!1),[o,c]=N.useState(!1),[d,h]=N.useState(null),[u,p]=N.useState({connected:!1,loading:!0}),[f,m]=N.useState(!1),[x,g]=N.useState({includeAnswers:!0,includeTeacherNotes:!0,paperSize:"letter",colorScheme:"color"}),b=N.useRef(null);N.useEffect(()=>{i&&y()},[i]),N.useEffect(()=>{function j(T){b.current&&!b.current.contains(T.target)&&(r(!1),m(!1))}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const y=async()=>{var j;try{const T=await lt.getGoogleDriveStatus();p({connected:(j=T.data)==null?void 0:j.connected,loading:!1})}catch{p({connected:!1,loading:!1})}},C=async()=>{c(!0),h("pdf"),t==null||t();try{const{blob:j,filename:T}=await lt.exportContentPDF(n,x),k=window.URL.createObjectURL(j),_=document.createElement("a");_.href=k,_.download=T,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(k),r(!1)}catch(j){console.error("Export error:",j),alert("Failed to export PDF. Please try again.")}finally{c(!1),h(null),s==null||s()}},w=async()=>{var j;try{const k=(j=(await lt.getGoogleDriveAuthUrl()).data)==null?void 0:j.authUrl;if(k){const D=window.screenX+(window.outerWidth-600)/2,P=window.screenY+(window.outerHeight-700)/2,I=window.open(k,"google-drive-auth",`width=600,height=700,left=${D},top=${P}`),M=async O=>{var F,B;if(((F=O.data)==null?void 0:F.type)==="google-drive-callback"&&((B=O.data)!=null&&B.code)){window.removeEventListener("message",M),I==null||I.close();try{await lt.connectGoogleDrive(O.data.code),p({connected:!0,loading:!1})}catch(U){console.error("Failed to connect Google Drive:",U),alert("Failed to connect Google Drive. Please try again.")}}};window.addEventListener("message",M)}}catch(T){console.error("Failed to get auth URL:",T),alert("Failed to connect to Google Drive. Please try again.")}},S=async()=>{var j;if(!u.connected){w();return}c(!0),h("drive"),t==null||t();try{const T=await lt.saveToGoogleDrive(n,x);T.success&&((j=T.data)!=null&&j.webViewLink&&window.open(T.data.webViewLink,"_blank"),alert("Successfully saved to Google Drive!")),r(!1)}catch(T){console.error("Drive save error:",T),alert("Failed to save to Google Drive. Please try again.")}finally{c(!1),h(null),s==null||s()}};return a.jsxs("div",{className:"export-menu-container",ref:b,children:[a.jsx("button",{className:"export-button",onClick:()=>r(!i),disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"spinner"}),"Exporting..."]}):a.jsxs(a.Fragment,{children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),a.jsx("polyline",{points:"7,10 12,15 17,10"}),a.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Export"]})}),i&&a.jsxs("div",{className:"export-dropdown",children:[a.jsxs("div",{className:"export-dropdown-header",children:[a.jsx("span",{children:"Export Options"}),a.jsx("button",{className:"options-toggle",onClick:()=>m(!f),children:a.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"12",cy:"12",r:"3"}),a.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})]}),f&&a.jsxs("div",{className:"export-options",children:[a.jsxs("label",{className:"export-option",children:[a.jsx("input",{type:"checkbox",checked:x.includeAnswers,onChange:j=>g({...x,includeAnswers:j.target.checked})}),a.jsx("span",{children:"Include Answers"})]}),a.jsxs("label",{className:"export-option",children:[a.jsx("input",{type:"checkbox",checked:x.includeTeacherNotes,onChange:j=>g({...x,includeTeacherNotes:j.target.checked})}),a.jsx("span",{children:"Include Teacher Notes"})]}),a.jsxs("div",{className:"export-option-select",children:[a.jsx("span",{children:"Paper Size:"}),a.jsxs("select",{value:x.paperSize,onChange:j=>g({...x,paperSize:j.target.value}),children:[a.jsx("option",{value:"letter",children:"Letter"}),a.jsx("option",{value:"a4",children:"A4"})]})]}),a.jsxs("div",{className:"export-option-select",children:[a.jsx("span",{children:"Color:"}),a.jsxs("select",{value:x.colorScheme,onChange:j=>g({...x,colorScheme:j.target.value}),children:[a.jsx("option",{value:"color",children:"Color"}),a.jsx("option",{value:"grayscale",children:"Grayscale"})]})]})]}),a.jsxs("div",{className:"export-actions",children:[a.jsxs("button",{className:"export-action-button pdf",onClick:C,disabled:o,children:[o&&d==="pdf"?a.jsx("span",{className:"spinner"}):a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),a.jsx("polyline",{points:"14,2 14,8 20,8"}),a.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),a.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),a.jsx("polyline",{points:"10,9 9,9 8,9"})]}),a.jsx("span",{children:"Download PDF"})]}),a.jsxs("button",{className:"export-action-button drive",onClick:S,disabled:o,children:[o&&d==="drive"?a.jsx("span",{className:"spinner"}):u.loading?a.jsx("span",{className:"spinner small"}):a.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:a.jsx("path",{d:"M12 2L4.5 14h7l-1 8 8.5-12h-7l1-8z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),a.jsx("span",{children:u.connected?"Save to Google Drive":"Connect Google Drive"}),u.connected&&a.jsx("span",{className:"drive-connected-badge",children:"Connected"})]})]})]})]})}const e8=()=>a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),cxe=()=>a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),a.jsx("polyline",{points:"17,21 17,13 7,13 7,21"}),a.jsx("polyline",{points:"7,3 7,8 15,8"})]}),dxe=()=>a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),a.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]}),hxe=()=>a.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})}),nQ=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M4 19.5A2.5 2.5 0 016.5 17H20"}),a.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"})]}),iQ=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"}),a.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),rQ=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),a.jsx("path",{d:"M7 8h10M7 12h6"})]}),aQ=()=>a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),a.jsx("polyline",{points:"14,2 14,8 20,8"}),a.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),a.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),a.jsx("polyline",{points:"10,9 9,9 8,9"})]}),uxe=()=>a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("polyline",{points:"3,6 5,6 21,6"}),a.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),a.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),pxe=()=>a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),a.jsx("path",{d:"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"})]}),Hk=()=>a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"animate-spin",children:a.jsx("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),HR={LESSON:{icon:nQ,label:"Lesson",color:"#8B5CF6"},QUIZ:{icon:iQ,label:"Quiz",color:"#F59E0B"},FLASHCARD_DECK:{icon:rQ,label:"Flashcards",color:"#10B981"},STUDY_GUIDE:{icon:aQ,label:"Study Guide",color:"#3B82F6"}},t8={DRAFT:{label:"Draft",color:"#6B7280",bg:"#F3F4F6"},REVIEW:{label:"In Review",color:"#F59E0B",bg:"#FEF3C7"},PUBLISHED:{label:"Published",color:"#10B981",bg:"#D1FAE5"},ARCHIVED:{label:"Archived",color:"#9CA3AF",bg:"#F9FAFB"}},fxe=["MATH","SCIENCE","ENGLISH","HISTORY","GEOGRAPHY","ART","MUSIC","PHYSICAL_EDUCATION","COMPUTER_SCIENCE","OTHER"],mxe=["K","1","2","3","4","5","6","7","8","9","10","11","12"];function gxe(){var K,X,V,q,ee,ie,Re,Ye,Le;const{id:n}=DL(),e=Qt(),[t,s]=N.useState(null),[i,r]=N.useState(!0),[o,c]=N.useState(!1),[d,h]=N.useState(null),[u,p]=N.useState(null),[f,m]=N.useState(!1),[x,g]=N.useState({}),[b,y]=N.useState(!1),[C,w]=N.useState(null),[S,j]=N.useState(!1),[T,k]=N.useState(!1),[_,L]=N.useState(!1),[D,P]=N.useState({});N.useEffect(()=>{I()},[n]);const I=async()=>{try{r(!0),h(null);const te=await lt.getContent(n);te.success&&(s(te.data),g({title:te.data.title,description:te.data.description||"",subject:te.data.subject||"",gradeLevel:te.data.gradeLevel||""}))}catch(te){h(te.message||"Failed to load content")}finally{r(!1)}},M=async()=>{try{c(!0),h(null);const te={title:x.title,description:x.description||null,subject:x.subject||null,gradeLevel:x.gradeLevel||null},fe=await lt.updateContent(n,te);fe.success&&(s(fe.data),m(!1),p("Content saved successfully!"),setTimeout(()=>p(null),3e3))}catch(te){h(te.message||"Failed to save content")}finally{c(!1)}},O=async te=>{try{c(!0);const fe=await lt.updateContentStatus(n,te);fe.success&&(s(fe.data),p(`Content ${te.toLowerCase()} successfully!`),setTimeout(()=>p(null),3e3))}catch(fe){h(fe.message||"Failed to update status")}finally{c(!1)}},F=async()=>{try{c(!0);const te=await lt.duplicateContent(n);te.success&&e(`/teacher/content/${te.data.id}`)}catch(te){h(te.message||"Failed to duplicate content")}finally{c(!1)}},B=async()=>{try{L(!0),await lt.deleteContent(n),e("/teacher/content")}catch(te){h(te.message||"Failed to delete content"),L(!1),k(!1)}},U=async(te,fe={})=>{var Ne;try{j(!0),h(null);let Pe;const nt=t.extractedText||((Ne=t.lessonContent)==null?void 0:Ne.content)||"";te==="quiz"?Pe=await lt.generateQuiz(n,{content:nt,questionCount:fe.questionCount||10,difficulty:fe.difficulty||"medium",gradeLevel:t.gradeLevel},!0):te==="flashcards"?Pe=await lt.generateFlashcards(n,{content:nt,cardCount:fe.cardCount||20,includeHints:fe.includeHints!==!1,gradeLevel:t.gradeLevel},!0):te==="study-guide"&&(Pe=await lt.generateStudyGuide(n,{content:nt,format:fe.format||"detailed",includeKeyTerms:fe.includeKeyTerms!==!1,includeReviewQuestions:fe.includeReviewQuestions!==!1,gradeLevel:t.gradeLevel})),Pe!=null&&Pe.success&&(p(`${te.charAt(0).toUpperCase()+te.slice(1)} generated successfully!`),setTimeout(()=>p(null),3e3),I())}catch(Pe){h(Pe.message||`Failed to generate ${te}`)}finally{j(!1),y(!1),w(null)}};if(i)return a.jsx("div",{style:J.container,children:a.jsxs("div",{style:J.loadingContainer,children:[a.jsx(Hk,{}),a.jsx("span",{style:{marginLeft:"12px",color:"#6B7280"},children:"Loading content..."})]})});if(d&&!t)return a.jsx("div",{style:J.container,children:a.jsxs("div",{style:J.errorContainer,children:[a.jsx("h2",{style:{color:"#DC2626",marginBottom:"8px"},children:"Error"}),a.jsx("p",{style:{color:"#6B7280"},children:d}),a.jsxs(qe,{to:"/teacher/content",style:J.backLink,children:[a.jsx(e8,{})," Back to Content"]})]})});const $=((K=HR[t==null?void 0:t.contentType])==null?void 0:K.icon)||nQ,G=((X=HR[t==null?void 0:t.contentType])==null?void 0:X.color)||"#8B5CF6",ne=((V=HR[t==null?void 0:t.contentType])==null?void 0:V.label)||"Content",Z=t8[t==null?void 0:t.status]||t8.DRAFT;return a.jsxs("div",{style:J.container,children:[a.jsxs("div",{style:J.header,children:[a.jsxs(qe,{to:"/teacher/content",style:J.backLink,children:[a.jsx(e8,{})," Back to Content"]}),a.jsx("div",{style:J.headerActions,children:f?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{m(!1),g({title:t.title,description:t.description||"",subject:t.subject||"",gradeLevel:t.gradeLevel||""})},style:J.secondaryButton,children:"Cancel"}),a.jsxs("button",{onClick:M,style:J.primaryButton,disabled:o,children:[o?a.jsx(Hk,{}):a.jsx(cxe,{})," Save Changes"]})]}):a.jsxs(a.Fragment,{children:[a.jsx(lxe,{contentId:n,contentTitle:t.title}),a.jsxs("button",{onClick:()=>m(!0),style:J.secondaryButton,children:[a.jsx(dxe,{})," Edit"]}),a.jsxs("button",{onClick:F,style:J.secondaryButton,disabled:o,children:[a.jsx(pxe,{})," Duplicate"]}),a.jsxs("button",{onClick:()=>k(!0),style:{...J.secondaryButton,color:"#DC2626"},children:[a.jsx(uxe,{})," Delete"]})]})})]}),a.jsxs(Ie,{children:[u&&a.jsx(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:J.successBanner,children:u}),d&&a.jsxs(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:J.errorBanner,children:[d,a.jsx("button",{onClick:()=>h(null),style:J.dismissButton,children:""})]})]}),a.jsxs("div",{style:J.contentHeader,children:[a.jsx("div",{style:J.typeIconWrapper,children:a.jsx("div",{style:{...J.typeIcon,backgroundColor:`${G}20`,color:G},children:a.jsx($,{})})}),a.jsxs("div",{style:J.contentMeta,children:[f?a.jsx("input",{type:"text",value:x.title,onChange:te=>g({...x,title:te.target.value}),style:J.titleInput,placeholder:"Content title"}):a.jsx("h1",{style:J.contentTitle,children:t.title}),a.jsxs("div",{style:J.metaRow,children:[a.jsx("span",{style:{...J.badge,backgroundColor:`${G}20`,color:G},children:ne}),a.jsx("span",{style:{...J.badge,backgroundColor:Z.bg,color:Z.color},children:Z.label}),t.subject&&a.jsx("span",{style:J.metaText,children:t.subject}),t.gradeLevel&&a.jsxs("span",{style:J.metaText,children:["Grade ",t.gradeLevel]})]})]}),a.jsxs("div",{style:J.statusActions,children:[t.status==="DRAFT"&&a.jsx("button",{onClick:()=>O("PUBLISHED"),style:{...J.statusButton,backgroundColor:"#10B981",color:"white"},disabled:o,children:"Publish"}),t.status==="PUBLISHED"&&a.jsx("button",{onClick:()=>O("ARCHIVED"),style:{...J.statusButton,backgroundColor:"#6B7280",color:"white"},disabled:o,children:"Archive"}),t.status==="ARCHIVED"&&a.jsx("button",{onClick:()=>O("DRAFT"),style:{...J.statusButton,backgroundColor:"#3B82F6",color:"white"},disabled:o,children:"Restore to Draft"})]})]}),a.jsxs("div",{style:J.contentGrid,children:[a.jsxs("div",{style:J.detailsColumn,children:[a.jsxs("div",{style:J.section,children:[a.jsx("h3",{style:J.sectionTitle,children:"Description"}),f?a.jsx("textarea",{value:x.description,onChange:te=>g({...x,description:te.target.value}),style:J.descriptionInput,placeholder:"Add a description...",rows:4}):a.jsx("p",{style:J.description,children:t.description||"No description provided."})]}),f&&a.jsxs("div",{style:J.section,children:[a.jsx("h3",{style:J.sectionTitle,children:"Details"}),a.jsxs("div",{style:J.formRow,children:[a.jsxs("div",{style:J.formGroup,children:[a.jsx("label",{style:J.label,children:"Subject"}),a.jsxs("select",{value:x.subject,onChange:te=>g({...x,subject:te.target.value}),style:J.select,children:[a.jsx("option",{value:"",children:"Select subject"}),fxe.map(te=>a.jsx("option",{value:te,children:te.replace("_"," ")},te))]})]}),a.jsxs("div",{style:J.formGroup,children:[a.jsx("label",{style:J.label,children:"Grade Level"}),a.jsxs("select",{value:x.gradeLevel,onChange:te=>g({...x,gradeLevel:te.target.value}),style:J.select,children:[a.jsx("option",{value:"",children:"Select grade"}),mxe.map(te=>a.jsxs("option",{value:te,children:["Grade ",te]},te))]})]})]})]}),t.lessonContent&&a.jsxs("div",{style:J.section,children:[a.jsx("h3",{style:J.sectionTitle,children:"Lesson Content"}),a.jsxs("div",{style:J.contentPreview,children:[t.lessonContent.title&&a.jsx("h4",{style:J.previewTitle,children:t.lessonContent.title}),t.lessonContent.objectives&&a.jsxs("div",{style:J.previewSection,children:[a.jsx("strong",{children:"Objectives:"}),a.jsx("ul",{style:J.previewList,children:t.lessonContent.objectives.map((te,fe)=>a.jsx("li",{children:te},fe))})]}),t.lessonContent.sections&&a.jsxs("div",{style:J.previewSection,children:[a.jsx("strong",{children:"Sections:"}),t.lessonContent.sections.map((te,fe)=>{var Ne;return a.jsxs("div",{style:{...J.sectionPreview,cursor:"pointer",transition:"all 0.2s ease",border:D[`section-${fe}`]?"2px solid #8B5CF6":"1px solid #E5E7EB"},onClick:()=>P(Pe=>({...Pe,[`section-${fe}`]:!Pe[`section-${fe}`]})),children:[a.jsxs("div",{style:J.sectionHeader,children:[a.jsx("h5",{style:J.sectionPreviewTitle,children:te.title}),a.jsx("span",{style:{...J.expandIcon,transform:D[`section-${fe}`]?"rotate(180deg)":"rotate(0deg)"},children:""})]}),te.duration&&a.jsxs("span",{style:J.sectionDuration,children:[te.duration," min"]}),D[`section-${fe}`]?a.jsxs("div",{style:J.sectionFullContent,children:[a.jsx("p",{style:J.sectionContentText,children:te.content}),te.activities&&te.activities.length>0&&a.jsxs("div",{style:J.activitiesSection,children:[a.jsx("strong",{style:J.subHeading,children:"Activities:"}),a.jsx("ul",{style:J.activityList,children:te.activities.map((Pe,nt)=>a.jsx("li",{style:J.activityItem,children:typeof Pe=="string"?Pe:Pe.description||Pe.name},nt))})]}),te.teachingTips&&a.jsxs("div",{style:J.tipsSection,children:[a.jsx("strong",{style:J.subHeading,children:"Teaching Tips:"}),a.jsx("p",{style:J.tipText,children:te.teachingTips})]})]}):a.jsxs("p",{style:J.sectionPreviewContent,children:[(Ne=te.content)==null?void 0:Ne.substring(0,150),"...",a.jsx("span",{style:J.clickToExpand,children:" (click to expand)"})]})]},fe)})]}),t.lessonContent.vocabulary&&t.lessonContent.vocabulary.length>0&&a.jsxs("div",{style:J.previewSection,children:[a.jsxs("div",{style:{...J.vocabularyHeader,cursor:"pointer"},onClick:()=>P(te=>({...te,vocabulary:!te.vocabulary})),children:[a.jsxs("strong",{children:["Vocabulary (",t.lessonContent.vocabulary.length," terms)"]}),a.jsx("span",{style:{...J.expandIcon,transform:D.vocabulary?"rotate(180deg)":"rotate(0deg)"},children:""})]}),D.vocabulary&&a.jsx("div",{style:J.vocabularyGrid,children:t.lessonContent.vocabulary.map((te,fe)=>a.jsxs("div",{style:J.vocabularyCard,children:[a.jsx("span",{style:J.vocabularyTerm,children:te.term}),a.jsx("span",{style:J.vocabularyDefinition,children:te.definition})]},fe))})]}),t.lessonContent.assessment&&t.lessonContent.assessment.questions&&a.jsxs("div",{style:J.previewSection,children:[a.jsxs("div",{style:{...J.vocabularyHeader,cursor:"pointer"},onClick:()=>P(te=>({...te,assessment:!te.assessment})),children:[a.jsxs("strong",{children:["Assessment (",t.lessonContent.assessment.questions.length," questions)"]}),a.jsx("span",{style:{...J.expandIcon,transform:D.assessment?"rotate(180deg)":"rotate(0deg)"},children:""})]}),D.assessment&&a.jsx("div",{style:J.assessmentList,children:t.lessonContent.assessment.questions.map((te,fe)=>a.jsxs("div",{style:J.assessmentQuestion,children:[a.jsxs("span",{style:J.questionNumber,children:["Q",fe+1]}),a.jsxs("div",{style:J.questionContent,children:[a.jsx("p",{style:J.questionText,children:te.question}),te.options&&a.jsx("ul",{style:J.optionsList,children:te.options.map((Ne,Pe)=>a.jsx("li",{style:{...J.optionItem,backgroundColor:Ne===te.correctAnswer||Pe===te.correctIndex?"#D1FAE5":"#F9FAFB",fontWeight:Ne===te.correctAnswer||Pe===te.correctIndex?"500":"400"},children:Ne},Pe))})]})]},fe))})]})]})]}),t.quizContent&&a.jsxs("div",{style:J.section,children:[a.jsxs("h3",{style:J.sectionTitle,children:["Quiz (",((q=t.quizContent.questions)==null?void 0:q.length)||0," questions)"]}),a.jsxs("div",{style:J.contentPreview,children:[(ee=t.quizContent.questions)==null?void 0:ee.slice(0,3).map((te,fe)=>a.jsxs("div",{style:J.questionPreview,children:[a.jsxs("span",{style:J.questionNumber,children:["Q",fe+1]}),a.jsx("span",{children:te.question})]},fe)),((ie=t.quizContent.questions)==null?void 0:ie.length)>3&&a.jsxs("p",{style:J.moreText,children:["+",t.quizContent.questions.length-3," more questions"]})]})]}),t.flashcardContent&&a.jsxs("div",{style:J.section,children:[a.jsxs("h3",{style:J.sectionTitle,children:["Flashcards (",((Re=t.flashcardContent.cards)==null?void 0:Re.length)||0," cards)"]}),a.jsxs("div",{style:J.contentPreview,children:[(Ye=t.flashcardContent.cards)==null?void 0:Ye.slice(0,3).map((te,fe)=>a.jsxs("div",{style:J.flashcardPreview,children:[a.jsx("div",{style:J.flashcardFront,children:te.front||te.term}),a.jsx("div",{style:J.flashcardBack,children:te.back||te.definition})]},fe)),((Le=t.flashcardContent.cards)==null?void 0:Le.length)>3&&a.jsxs("p",{style:J.moreText,children:["+",t.flashcardContent.cards.length-3," more cards"]})]})]}),t.extractedText&&a.jsxs("div",{style:J.section,children:[a.jsx("h3",{style:J.sectionTitle,children:"Source Text"}),a.jsxs("div",{style:J.sourceText,children:[t.extractedText.substring(0,500),t.extractedText.length>500&&"..."]})]})]}),a.jsxs("div",{style:J.actionsColumn,children:[a.jsxs("div",{style:J.actionCard,children:[a.jsxs("h3",{style:J.actionCardTitle,children:[a.jsx(hxe,{})," Generate Content"]}),a.jsx("p",{style:J.actionCardDescription,children:"Use AI to generate additional materials from this content."}),a.jsxs("div",{style:J.generateButtons,children:[a.jsxs("button",{onClick:()=>{w("quiz"),y(!0)},style:J.generateButton,disabled:S,children:[a.jsx(iQ,{})," Generate Quiz"]}),a.jsxs("button",{onClick:()=>{w("flashcards"),y(!0)},style:J.generateButton,disabled:S,children:[a.jsx(rQ,{})," Generate Flashcards"]}),a.jsxs("button",{onClick:()=>{w("study-guide"),y(!0)},style:J.generateButton,disabled:S,children:[a.jsx(aQ,{})," Generate Study Guide"]})]})]}),a.jsxs("div",{style:J.infoCard,children:[a.jsx("h3",{style:J.infoCardTitle,children:"Information"}),a.jsxs("div",{style:J.infoRow,children:[a.jsx("span",{style:J.infoLabel,children:"Created"}),a.jsx("span",{style:J.infoValue,children:new Date(t.createdAt).toLocaleDateString()})]}),a.jsxs("div",{style:J.infoRow,children:[a.jsx("span",{style:J.infoLabel,children:"Last Updated"}),a.jsx("span",{style:J.infoValue,children:new Date(t.updatedAt).toLocaleDateString()})]}),t.publishedAt&&a.jsxs("div",{style:J.infoRow,children:[a.jsx("span",{style:J.infoLabel,children:"Published"}),a.jsx("span",{style:J.infoValue,children:new Date(t.publishedAt).toLocaleDateString()})]}),t.tokensUsed>0&&a.jsxs("div",{style:J.infoRow,children:[a.jsx("span",{style:J.infoLabel,children:"Tokens Used"}),a.jsx("span",{style:J.infoValue,children:t.tokensUsed.toLocaleString()})]}),t.template&&a.jsxs("div",{style:J.infoRow,children:[a.jsx("span",{style:J.infoLabel,children:"Template"}),a.jsx("span",{style:J.infoValue,children:t.template.name})]})]})]})]}),a.jsx(Ie,{children:b&&a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:J.modalOverlay,onClick:()=>{y(!1),w(null)},children:a.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},style:J.modal,onClick:te=>te.stopPropagation(),children:[a.jsxs("h2",{style:J.modalTitle,children:["Generate ",C==="study-guide"?"Study Guide":(C==null?void 0:C.charAt(0).toUpperCase())+(C==null?void 0:C.slice(1))]}),a.jsxs("p",{style:J.modalDescription,children:["AI will analyze your content and generate ",C==="quiz"?"quiz questions":C==="flashcards"?"flashcards":"a study guide","."]}),a.jsxs("div",{style:J.modalActions,children:[a.jsx("button",{onClick:()=>{y(!1),w(null)},style:J.secondaryButton,children:"Cancel"}),a.jsx("button",{onClick:()=>U(C),style:J.primaryButton,disabled:S,children:S?a.jsxs(a.Fragment,{children:[a.jsx(Hk,{})," Generating..."]}):"Generate"})]})]})})}),a.jsx(Ie,{children:T&&a.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:J.modalOverlay,onClick:()=>k(!1),children:a.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},style:J.modal,onClick:te=>te.stopPropagation(),children:[a.jsx("h2",{style:{...J.modalTitle,color:"#DC2626"},children:"Delete Content"}),a.jsxs("p",{style:J.modalDescription,children:['Are you sure you want to delete "',t.title,'"? This action cannot be undone.']}),a.jsxs("div",{style:J.modalActions,children:[a.jsx("button",{onClick:()=>k(!1),style:J.secondaryButton,children:"Cancel"}),a.jsx("button",{onClick:B,style:{...J.primaryButton,backgroundColor:"#DC2626"},disabled:_,children:_?a.jsxs(a.Fragment,{children:[a.jsx(Hk,{})," Deleting..."]}):"Delete"})]})]})})})]})}const J={container:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},loadingContainer:{display:"flex",alignItems:"center",justifyContent:"center",padding:"80px 20px"},errorContainer:{textAlign:"center",padding:"80px 20px"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},backLink:{display:"flex",alignItems:"center",gap:"8px",color:"#6B7280",textDecoration:"none",fontSize:"14px",fontWeight:"500"},headerActions:{display:"flex",gap:"12px"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 20px",backgroundColor:"#8B5CF6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},secondaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 20px",backgroundColor:"white",color:"#374151",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},successBanner:{padding:"12px 20px",backgroundColor:"#D1FAE5",color:"#065F46",borderRadius:"8px",marginBottom:"20px",fontWeight:"500"},errorBanner:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 20px",backgroundColor:"#FEE2E2",color:"#991B1B",borderRadius:"8px",marginBottom:"20px"},dismissButton:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"#991B1B"},contentHeader:{display:"flex",alignItems:"flex-start",gap:"20px",padding:"24px",backgroundColor:"white",borderRadius:"12px",border:"1px solid #E5E7EB",marginBottom:"24px"},typeIconWrapper:{flexShrink:0},typeIcon:{width:"56px",height:"56px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center"},contentMeta:{flex:1},contentTitle:{fontSize:"24px",fontWeight:"600",color:"#111827",margin:"0 0 12px 0"},titleInput:{fontSize:"24px",fontWeight:"600",color:"#111827",width:"100%",padding:"8px 12px",border:"2px solid #8B5CF6",borderRadius:"8px",marginBottom:"12px"},metaRow:{display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap"},badge:{padding:"4px 12px",borderRadius:"20px",fontSize:"13px",fontWeight:"500"},metaText:{color:"#6B7280",fontSize:"14px"},statusActions:{flexShrink:0},statusButton:{padding:"10px 20px",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},contentGrid:{display:"grid",gridTemplateColumns:"1fr 320px",gap:"24px"},detailsColumn:{display:"flex",flexDirection:"column",gap:"20px"},actionsColumn:{display:"flex",flexDirection:"column",gap:"20px"},section:{padding:"20px",backgroundColor:"white",borderRadius:"12px",border:"1px solid #E5E7EB"},sectionTitle:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:"0 0 16px 0"},description:{color:"#6B7280",lineHeight:"1.6",margin:0},descriptionInput:{width:"100%",padding:"12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"14px",lineHeight:"1.6",resize:"vertical"},formRow:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},formGroup:{display:"flex",flexDirection:"column",gap:"6px"},label:{fontSize:"14px",fontWeight:"500",color:"#374151"},select:{padding:"10px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"14px",backgroundColor:"white"},contentPreview:{backgroundColor:"#F9FAFB",borderRadius:"8px",padding:"16px"},previewTitle:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:"0 0 12px 0"},previewSection:{marginBottom:"16px"},previewList:{margin:"8px 0 0 0",paddingLeft:"20px",color:"#4B5563"},sectionPreview:{padding:"16px",backgroundColor:"white",borderRadius:"8px",marginTop:"12px",border:"1px solid #E5E7EB"},sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center"},sectionPreviewTitle:{fontSize:"15px",fontWeight:"600",color:"#374151",margin:0},expandIcon:{fontSize:"10px",color:"#9CA3AF",transition:"transform 0.2s ease"},sectionDuration:{display:"inline-block",fontSize:"12px",color:"#6B7280",backgroundColor:"#F3F4F6",padding:"2px 8px",borderRadius:"4px",marginTop:"8px"},sectionPreviewContent:{fontSize:"13px",color:"#6B7280",margin:"12px 0 0 0",lineHeight:"1.5"},clickToExpand:{color:"#8B5CF6",fontSize:"12px",fontStyle:"italic"},sectionFullContent:{marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #E5E7EB"},sectionContentText:{fontSize:"14px",color:"#374151",lineHeight:"1.7",margin:0,whiteSpace:"pre-wrap"},activitiesSection:{marginTop:"16px",padding:"12px",backgroundColor:"#F0FDF4",borderRadius:"6px"},subHeading:{fontSize:"13px",color:"#166534",display:"block",marginBottom:"8px"},activityList:{margin:0,paddingLeft:"20px"},activityItem:{fontSize:"13px",color:"#166534",marginBottom:"4px",lineHeight:"1.5"},tipsSection:{marginTop:"12px",padding:"12px",backgroundColor:"#FEF3C7",borderRadius:"6px"},tipText:{fontSize:"13px",color:"#92400E",margin:0,lineHeight:"1.5"},vocabularyHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",marginTop:"8px"},vocabularyGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"12px",marginTop:"12px"},vocabularyCard:{display:"flex",flexDirection:"column",gap:"4px",padding:"12px",backgroundColor:"#EEF2FF",borderRadius:"6px"},vocabularyTerm:{fontSize:"14px",fontWeight:"600",color:"#4338CA"},vocabularyDefinition:{fontSize:"13px",color:"#6366F1",lineHeight:"1.4"},assessmentList:{marginTop:"12px",display:"flex",flexDirection:"column",gap:"12px"},assessmentQuestion:{display:"flex",gap:"12px",padding:"16px",backgroundColor:"white",borderRadius:"8px",border:"1px solid #E5E7EB"},questionContent:{flex:1},questionText:{fontSize:"14px",color:"#374151",margin:"0 0 12px 0",fontWeight:"500"},optionsList:{listStyle:"none",margin:0,padding:0,display:"flex",flexDirection:"column",gap:"6px"},optionItem:{fontSize:"13px",color:"#4B5563",padding:"8px 12px",borderRadius:"4px"},questionPreview:{display:"flex",alignItems:"flex-start",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"6px",marginBottom:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151"},questionNumber:{backgroundColor:"#8B5CF6",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"600"},flashcardPreview:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",padding:"12px",backgroundColor:"white",borderRadius:"6px",marginBottom:"8px",border:"1px solid #E5E7EB",fontSize:"14px"},flashcardFront:{padding:"8px",backgroundColor:"#EEF2FF",borderRadius:"4px",color:"#4338CA",fontWeight:"500"},flashcardBack:{padding:"8px",backgroundColor:"#F0FDF4",borderRadius:"4px",color:"#166534"},moreText:{color:"#6B7280",fontSize:"13px",fontStyle:"italic",marginTop:"8px",marginBottom:0},sourceText:{backgroundColor:"#F9FAFB",padding:"16px",borderRadius:"8px",fontSize:"14px",color:"#4B5563",lineHeight:"1.6",whiteSpace:"pre-wrap"},actionCard:{padding:"20px",backgroundColor:"white",borderRadius:"12px",border:"1px solid #E5E7EB"},actionCardTitle:{display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontWeight:"600",color:"#111827",margin:"0 0 8px 0"},actionCardDescription:{color:"#6B7280",fontSize:"14px",marginBottom:"16px"},generateButtons:{display:"flex",flexDirection:"column",gap:"10px"},generateButton:{display:"flex",alignItems:"center",gap:"10px",padding:"12px 16px",backgroundColor:"#F3F4F6",color:"#374151",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer",textAlign:"left"},infoCard:{padding:"20px",backgroundColor:"white",borderRadius:"12px",border:"1px solid #E5E7EB"},infoCardTitle:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:"0 0 16px 0"},infoRow:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #F3F4F6"},infoLabel:{color:"#6B7280",fontSize:"14px"},infoValue:{color:"#111827",fontSize:"14px",fontWeight:"500"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modal:{backgroundColor:"white",borderRadius:"16px",padding:"24px",maxWidth:"400px",width:"90%"},modalTitle:{fontSize:"20px",fontWeight:"600",color:"#111827",margin:"0 0 12px 0"},modalDescription:{color:"#6B7280",fontSize:"14px",lineHeight:"1.5",marginBottom:"24px"},modalActions:{display:"flex",justifyContent:"flex-end",gap:"12px"}},xxe=()=>{var b;const{teacher:n,quota:e}=Cm(),[t,s]=N.useState("month"),[i,r]=N.useState(null),[o,c]=N.useState(!0);N.useEffect(()=>{c(!0),setTimeout(()=>{r({daily:[{date:"Mon",credits:2500},{date:"Tue",credits:4200},{date:"Wed",credits:3100},{date:"Thu",credits:5800},{date:"Fri",credits:2900},{date:"Sat",credits:1200},{date:"Sun",credits:800}],byOperation:[{name:"Lesson Generation",credits:45e3,percentage:45,icon:js},{name:"Quiz Generation",credits:25e3,percentage:25,icon:jN},{name:"Flashcard Creation",credits:18e3,percentage:18,icon:Ki},{name:"Study Guides",credits:12e3,percentage:12,icon:va}],recentActivity:[{type:"LESSON",title:"Introduction to Photosynthesis",credits:3200,time:"2 hours ago"},{type:"QUIZ",title:"Algebra Chapter 5 Quiz",credits:1800,time:"4 hours ago"},{type:"FLASHCARD_DECK",title:"Spanish Vocabulary Unit 3",credits:1200,time:"Yesterday"},{type:"LESSON",title:"World War II Timeline",credits:4100,time:"Yesterday"},{type:"QUIZ",title:"Grammar Assessment",credits:2100,time:"2 days ago"}]}),c(!1)},1e3)},[t]);const d=e?Math.min(100,Number(e.tokensUsed||0)/Number(e.monthlyQuota||1e5)*100):0,h=y=>y?y>=1e6?`${(y/1e6).toFixed(1)}M`:y>=1e3?`${(y/1e3).toFixed(1)}K`:y.toString():"0",p=(y=>{switch(y==null?void 0:y.toUpperCase()){case"PROFESSIONAL":return{name:"Professional",icon:NN,color:"teacher-gold",bgGradient:"from-teacher-gold/20 to-teacher-goldLight/20",credits:2e6,features:["Unlimited content types","Priority processing","Advanced analytics","API access"]};case"BASIC":return{name:"Basic",icon:Vu,color:"teacher-sage",bgGradient:"from-teacher-sage/20 to-teacher-sageLight/20",credits:5e5,features:["All content types","Standard processing","Basic analytics"]};default:return{name:"Free",icon:n3,color:"teacher-inkLight",bgGradient:"from-teacher-ink/5 to-teacher-ink/10",credits:1e5,features:["Basic content types","Limited generations","Community support"]}}})(n==null?void 0:n.subscriptionTier),f=p.icon,m=i?Math.max(...i.daily.map(y=>y.credits)):0,x=y=>{switch(y){case"LESSON":return js;case"QUIZ":return jN;case"FLASHCARD_DECK":return Ki;case"STUDY_GUIDE":return va;default:return va}},g=y=>{switch(y){case"LESSON":return"teacher-chalk";case"QUIZ":return"teacher-gold";case"FLASHCARD_DECK":return"teacher-plum";case"STUDY_GUIDE":return"teacher-terracotta";default:return"teacher-ink"}};return a.jsxs(OE,{title:"Usage & Billing",subtitle:"Monitor your AI credit usage and manage your subscription",children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`teacher-card p-6 bg-gradient-to-br ${p.bgGradient}`,children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsx("div",{className:`p-3 rounded-xl bg-${p.color}/20`,children:a.jsx(f,{className:`w-6 h-6 text-${p.color}`})}),a.jsx("span",{className:`teacher-badge ${((b=n==null?void 0:n.subscriptionTier)==null?void 0:b.toLowerCase())||"free"}`,children:"Current Plan"})]}),a.jsx("h3",{className:"font-display text-2xl font-bold text-teacher-ink mb-1",children:p.name}),a.jsxs("p",{className:"text-sm text-teacher-inkLight mb-4",children:[h(p.credits)," credits/month"]}),a.jsx("ul",{className:"space-y-2 mb-6",children:p.features.map((y,C)=>a.jsxs("li",{className:"flex items-center gap-2 text-sm text-teacher-ink",children:[a.jsx(gW,{className:`w-4 h-4 text-${p.color}`}),y]},C))}),(n==null?void 0:n.subscriptionTier)!=="PROFESSIONAL"&&a.jsxs("button",{className:"w-full teacher-btn-gold text-sm",children:["Upgrade Plan",a.jsx(Fae,{className:"w-4 h-4 ml-2 inline"})]})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"teacher-card p-6 lg:col-span-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-teacher-ink mb-1",children:"Credits Usage"}),a.jsx("p",{className:"text-sm text-teacher-inkLight",children:e!=null&&e.quotaResetDate?`Resets on ${new Date(e.quotaResetDate).toLocaleDateString("en-US",{month:"long",day:"numeric"})}`:"Monthly billing cycle"})]}),a.jsx("div",{className:"flex gap-2",children:["week","month"].map(y=>a.jsx("button",{onClick:()=>s(y),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${t===y?"bg-teacher-chalk text-white":"bg-teacher-ink/5 text-teacher-inkLight hover:bg-teacher-ink/10"}`,children:y.charAt(0).toUpperCase()+y.slice(1)},y))})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-end gap-3 mb-3",children:[a.jsx("span",{className:"font-display text-4xl font-bold text-teacher-ink",children:h((e==null?void 0:e.tokensUsed)||0)}),a.jsxs("span",{className:"text-lg text-teacher-inkLight mb-1",children:["/ ",h((e==null?void 0:e.monthlyQuota)||1e5)]}),a.jsxs("span",{className:`
                ml-auto px-2 py-1 rounded-lg text-sm font-medium
                ${d>90?"bg-teacher-coral/10 text-teacher-coral":d>70?"bg-teacher-gold/10 text-teacher-gold":"bg-teacher-sage/10 text-teacher-sage"}
              `,children:[Math.round(d),"% used"]})]}),a.jsx("div",{className:"h-4 bg-teacher-ink/5 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${d}%`},transition:{duration:1,ease:"easeOut"},className:`h-full rounded-full ${d>90?"bg-gradient-to-r from-teacher-coral to-red-400":d>70?"bg-gradient-to-r from-teacher-gold to-teacher-goldLight":"bg-gradient-to-r from-teacher-sage to-teacher-sageLight"}`})})]}),i&&a.jsx("div",{className:"flex items-end justify-between gap-2 h-24",children:i.daily.map((y,C)=>a.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[a.jsx(R.div,{initial:{height:0},animate:{height:`${y.credits/m*100}%`},transition:{duration:.5,delay:C*.05},className:"w-full bg-gradient-to-t from-teacher-chalk to-teacher-chalkLight rounded-t-md",style:{maxHeight:"60px"}}),a.jsx("span",{className:"text-xs text-teacher-inkLight",children:y.date})]},C))})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"teacher-card p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[a.jsx(CW,{className:"w-5 h-5 text-teacher-inkLight"}),a.jsx("h3",{className:"font-semibold text-teacher-ink",children:"Usage by Type"})]}),i&&a.jsx("div",{className:"space-y-4",children:i.byOperation.map((y,C)=>{const w=y.icon;return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg bg-teacher-ink/5 flex items-center justify-center",children:a.jsx(w,{className:"w-4 h-4 text-teacher-inkLight"})}),a.jsx("span",{className:"text-sm font-medium text-teacher-ink",children:y.name})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("span",{className:"text-sm font-semibold text-teacher-ink",children:h(y.credits)}),a.jsxs("span",{className:"text-xs text-teacher-inkLight ml-1",children:["(",y.percentage,"%)"]})]})]}),a.jsx("div",{className:"h-2 bg-teacher-ink/5 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:0},animate:{width:`${y.percentage}%`},transition:{duration:.5,delay:.3+C*.1},className:"h-full bg-gradient-to-r from-teacher-chalk to-teacher-chalkLight rounded-full"})})]},C)})})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"teacher-card p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Mae,{className:"w-5 h-5 text-teacher-inkLight"}),a.jsx("h3",{className:"font-semibold text-teacher-ink",children:"Recent Activity"})]}),a.jsx(qe,{to:"/teacher/content",className:"teacher-link text-sm",children:"View all"})]}),i&&a.jsx("div",{className:"space-y-3",children:i.recentActivity.map((y,C)=>{const w=x(y.type),S=g(y.type);return a.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl hover:bg-teacher-paper/50 transition-colors",children:[a.jsx("div",{className:`w-10 h-10 rounded-lg bg-${S}/10 flex items-center justify-center`,children:a.jsx(w,{className:`w-5 h-5 text-${S}`})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-teacher-ink truncate",children:y.title}),a.jsx("p",{className:"text-xs text-teacher-inkLight",children:y.time})]}),a.jsxs("span",{className:"text-sm font-mono text-teacher-inkLight",children:["-",h(y.credits)]})]},C)})})]})]}),(n==null?void 0:n.subscriptionTier)!=="PROFESSIONAL"&&a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"teacher-card teacher-accent-border p-8 bg-gradient-to-br from-teacher-gold/5 via-white to-teacher-chalk/5",children:a.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-6",children:[a.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-teacher-gold to-teacher-goldLight flex items-center justify-center flex-shrink-0",children:a.jsx(NN,{className:"w-10 h-10 text-white"})}),a.jsxs("div",{className:"flex-1 text-center lg:text-left",children:[a.jsx("h3",{className:"font-display text-xl font-semibold text-teacher-ink mb-2",children:"Unlock more with Professional"}),a.jsx("p",{className:"text-teacher-inkLight mb-4 max-w-xl",children:"Get 2M credits per month, priority processing, advanced analytics, and API access. Perfect for teachers who create content regularly."}),a.jsxs("div",{className:"flex flex-wrap justify-center lg:justify-start gap-4",children:[a.jsxs("button",{className:"teacher-btn-gold inline-flex items-center gap-2",children:[a.jsx(Ut,{className:"w-4 h-4"}),"Upgrade to Professional"]}),a.jsxs("button",{className:"teacher-btn-secondary inline-flex items-center gap-2",children:["Compare Plans",a.jsx(No,{className:"w-4 h-4"})]})]})]})]})})]})},yxe=()=>{const[n,e]=N.useState(""),[t,s]=N.useState(!1),i=c=>{c.preventDefault(),s(!0)},r=[{icon:q0,title:"Batch Upload",description:"Upload 30+ papers at once. Support for PDF, images, and typed submissions.",color:"teacher-chalk"},{icon:hm,title:"Custom Rubrics",description:"Create detailed rubrics with weighted criteria. AI grades consistently against your standards.",color:"teacher-gold"},{icon:Ut,title:"AI-Powered Grading",description:"Intelligent analysis using Gemini Pro. Understands context, not just keywords.",color:"teacher-plum"},{icon:soe,title:"Personalized Feedback",description:"Auto-generated constructive feedback for each student, tailored to their work.",color:"teacher-terracotta"},{icon:cM,title:"Smart Flagging",description:"Low-confidence submissions flagged for human review. You stay in control.",color:"teacher-coral"},{icon:e3,title:"Class Analytics",description:"See patterns across submissions. Identify common mistakes and knowledge gaps.",color:"teacher-sage"}],o=[{step:1,title:"Create Rubric",description:"Define grading criteria and point values",icon:va},{step:2,title:"Upload Papers",description:"Batch upload student submissions",icon:q0},{step:3,title:"AI Grades",description:"Automated analysis against your rubric",icon:Ut},{step:4,title:"Review & Finalize",description:"Approve, adjust, and export grades",icon:kd}];return a.jsxs(OE,{title:"AI Grading Center",subtitle:"Coming soon - Grade papers 10x faster with AI assistance",children:[a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-teacher-chalk via-teacher-chalk/90 to-teacher-chalkLight p-8 lg:p-12 mb-8",children:[a.jsx("div",{className:"absolute inset-0 opacity-10",children:a.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[a.jsx("pattern",{id:"grid",width:"10",height:"10",patternUnits:"userSpaceOnUse",children:a.jsx("path",{d:"M 10 0 L 0 0 0 10",fill:"none",stroke:"white",strokeWidth:"0.5"})}),a.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"})]})}),a.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row items-center gap-8",children:[a.jsxs("div",{className:"flex-1 text-center lg:text-left",children:[a.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/20 text-white/90 text-sm font-medium mb-4",children:[a.jsx(Pd,{className:"w-4 h-4"}),"Coming Q1 2025"]}),a.jsxs("h1",{className:"font-display text-3xl lg:text-4xl font-bold text-white mb-4",children:["Grade 30 papers in minutes,",a.jsx("br",{}),"not hours."]}),a.jsx("p",{className:"text-white/80 text-lg mb-6 max-w-xl",children:"Our AI grading assistant reads, analyzes, and scores student work against your rubric. You review the flagged ones and export when ready."}),t?a.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-white/20 text-white",children:[a.jsx(kd,{className:"w-5 h-5"}),"We'll notify you when it's ready!"]}):a.jsxs("form",{onSubmit:i,className:"flex flex-col sm:flex-row gap-3 max-w-md mx-auto lg:mx-0",children:[a.jsx("input",{type:"email",value:n,onChange:c=>e(c.target.value),placeholder:"Enter your email",required:!0,className:"flex-1 px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-white/30"}),a.jsxs("button",{type:"submit",className:"px-6 py-3 rounded-xl bg-white text-teacher-chalk font-semibold hover:bg-white/90 transition-colors flex items-center justify-center gap-2",children:[a.jsx(t3,{className:"w-4 h-4"}),"Notify Me"]})]})]}),a.jsx("div",{className:"w-full lg:w-auto",children:a.jsx(R.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},className:"bg-white rounded-2xl shadow-2xl p-4 max-w-sm mx-auto",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between pb-3 border-b border-teacher-ink/10",children:[a.jsx("span",{className:"text-sm font-semibold text-teacher-ink",children:"Essay Batch #12"}),a.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-teacher-sage/10 text-teacher-sage",children:"28/30 Done"})]}),[{name:"Sarah M.",score:92,status:"graded"},{name:"James K.",score:78,status:"graded"},{name:"Emily R.",score:null,status:"flagged"},{name:"Michael T.",score:85,status:"graded"}].map((c,d)=>a.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-teacher-paper/50",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-teacher-ink/5 flex items-center justify-center text-xs font-medium text-teacher-inkLight",children:c.name.split(" ").map(h=>h[0]).join("")}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"text-sm font-medium text-teacher-ink",children:c.name})}),c.status==="flagged"?a.jsxs("span",{className:"px-2 py-0.5 text-xs rounded-full bg-teacher-gold/10 text-teacher-gold flex items-center gap-1",children:[a.jsx(cM,{className:"w-3 h-3"}),"Review"]}):a.jsxs("span",{className:"text-sm font-semibold text-teacher-sage",children:[c.score,"%"]})]},d)),a.jsxs("div",{className:"pt-3 border-t border-teacher-ink/10",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs text-teacher-inkLight mb-2",children:[a.jsx("span",{children:"Processing..."}),a.jsx("span",{children:"93%"})]}),a.jsx("div",{className:"h-2 bg-teacher-ink/5 rounded-full overflow-hidden",children:a.jsx(R.div,{initial:{width:"60%"},animate:{width:"93%"},transition:{duration:2,ease:"easeOut"},className:"h-full bg-gradient-to-r from-teacher-chalk to-teacher-sage rounded-full"})})]})]})})})]})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-8",children:[a.jsx("h2",{className:"font-display text-xl font-semibold text-teacher-ink mb-6 text-center",children:"How It Works"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:o.map((c,d)=>{const h=c.icon;return a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+d*.1},className:"relative",children:[a.jsxs("div",{className:"teacher-card p-6 text-center h-full",children:[a.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-xl bg-teacher-chalk/10 flex items-center justify-center",children:a.jsx(h,{className:"w-6 h-6 text-teacher-chalk"})}),a.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-teacher-chalk text-white text-sm font-bold flex items-center justify-center",children:c.step}),a.jsx("h3",{className:"font-semibold text-teacher-ink mb-1",children:c.title}),a.jsx("p",{className:"text-sm text-teacher-inkLight",children:c.description})]}),d<o.length-1&&a.jsx("div",{className:"hidden md:block absolute top-1/2 -right-2 transform -translate-y-1/2 z-10",children:a.jsx(jm,{className:"w-4 h-4 text-teacher-inkLight"})})]},d)})})]}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mb-8",children:[a.jsx("h2",{className:"font-display text-xl font-semibold text-teacher-ink mb-6 text-center",children:"Powerful Features"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map((c,d)=>{const h=c.icon;return a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.35+d*.05},className:"teacher-card p-6 group",children:[a.jsx("div",{className:`w-12 h-12 mb-4 rounded-xl bg-${c.color}/10 flex items-center justify-center group-hover:scale-110 transition-transform`,children:a.jsx(h,{className:`w-6 h-6 text-${c.color}`})}),a.jsx("h3",{className:"font-semibold text-teacher-ink mb-2",children:c.title}),a.jsx("p",{className:"text-sm text-teacher-inkLight",children:c.description})]},d)})})]}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[{label:"Average Time Saved",value:"85%",icon:Pd},{label:"Grading Accuracy",value:"94%",icon:hm},{label:"Papers/Minute",value:"3-5",icon:Vu},{label:"Teacher Satisfaction",value:"4.8/5",icon:pW}].map((c,d)=>{const h=c.icon;return a.jsxs("div",{className:"teacher-card p-5 text-center",children:[a.jsx(h,{className:"w-6 h-6 mx-auto mb-2 text-teacher-inkLight"}),a.jsx("p",{className:"font-display text-2xl font-bold text-teacher-ink mb-1",children:c.value}),a.jsx("p",{className:"text-xs text-teacher-inkLight",children:c.label})]},d)})}),a.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"teacher-card p-8 text-center bg-gradient-to-br from-teacher-gold/5 to-teacher-chalk/5",children:[a.jsx("div",{className:"w-20 h-20 mx-auto mb-4",children:a.jsx("img",{src:"/assets/images/landing/meet-jeffrey.png",alt:"Jeffrey - Your AI Teaching Assistant",className:"w-full h-full object-contain"})}),a.jsx("h3",{className:"font-display text-xl font-semibold text-teacher-ink mb-2",children:"Be the first to know"}),a.jsx("p",{className:"text-teacher-inkLight mb-6 max-w-md mx-auto",children:"Join the waitlist and I'll let you know when AI Grading launches. I'll also send you tips for creating effective rubrics!"}),t?a.jsxs("div",{className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-teacher-sage/10 text-teacher-sage font-medium",children:[a.jsx(kd,{className:"w-5 h-5"}),"You're on the list!"]}):a.jsxs("form",{onSubmit:i,className:"flex flex-col sm:flex-row gap-3 max-w-md mx-auto",children:[a.jsx("input",{type:"email",value:n,onChange:c=>e(c.target.value),placeholder:"your@email.com",required:!0,className:"flex-1 px-4 py-3 rounded-xl bg-white border border-teacher-ink/10 text-teacher-ink placeholder:text-teacher-inkLight/50 focus:outline-none focus:ring-2 focus:ring-teacher-chalk/20 focus:border-teacher-chalk"}),a.jsx("button",{type:"submit",className:"teacher-btn-primary",children:"Join Waitlist"})]})]})]})},VR=({children:n,requireConsent:e=!0,requireProfile:t=!0,parentOnly:s=!1,redirectTo:i="/onboarding"})=>{const r=Qi(),{isAuthenticated:o,hasConsent:c,children:d,isLoading:h,isReady:u,needsEmailVerification:p,needsConsent:f,needsChildProfile:m}=Vt();return h||!u?a.jsxs("div",{className:"protected-route-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading..."}),a.jsx("style",{children:`
          .protected-route-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 16px;
          }

          .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e0e0e0;
            border-top-color: #ffc107;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          }

          @keyframes spin {
            to {
              transform: rotate(360deg);
            }
          }

          .protected-route-loading p {
            color: #666;
            font-size: 0.9375rem;
          }
        `})]}):o?p?a.jsx(Ln,{to:"/onboarding",state:{from:r.pathname,step:"email_verification"},replace:!0}):e&&f?a.jsx(Ln,{to:"/onboarding",state:{from:r.pathname,step:"consent_method"},replace:!0}):t&&!s&&m?a.jsx(Ln,{to:"/onboarding",state:{from:r.pathname,step:"create_profile"},replace:!0}):n:a.jsx(Ln,{to:i,state:{from:r.pathname},replace:!0})},Im=({children:n,requireEmailVerification:e=!0,redirectTo:t="/teacher/login"})=>{const s=Qi(),{isAuthenticated:i,isLoading:r,isReady:o,needsEmailVerification:c}=Cm();return r||!o?a.jsxs("div",{className:"protected-route-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading..."}),a.jsx("style",{children:`
          .protected-route-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 16px;
            background: linear-gradient(to bottom right, #eef2ff, #ffffff, #faf5ff);
          }

          .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e0e0e0;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          }

          @keyframes spin {
            to {
              transform: rotate(360deg);
            }
          }

          .protected-route-loading p {
            color: #666;
            font-size: 0.9375rem;
          }
        `})]}):i?e&&c?a.jsx(Ln,{to:"/teacher/verify-email",state:{from:s.pathname},replace:!0}):n||a.jsx(gE,{}):a.jsx(Ln,{to:t,state:{from:s.pathname},replace:!0})},bxe=({children:n,mode:e,requireConsent:t=!0})=>{const s=Qi();let i={isAuthenticated:!1,hasConsent:!1,isLoading:!0};try{i=Vt()}catch{}let r={currentMode:"child",parentPinVerified:!1};try{r=OL()}catch{}const{isAuthenticated:o,hasConsent:c,isLoading:d}=i,{currentMode:h,isParentMode:u}=r;return d?a.jsxs("div",{className:"mode-route-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading..."}),a.jsx("style",{children:`
          .mode-route-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            gap: 16px;
          }

          .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e0e0e0;
            border-top-color: #ffc107;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          }

          @keyframes spin {
            to {
              transform: rotate(360deg);
            }
          }

          .mode-route-loading p {
            color: #666;
            font-size: 0.9375rem;
          }
        `})]}):o?t&&!c?a.jsx(Ln,{to:"/onboarding",state:{step:"consent_method"},replace:!0}):e==="parent"&&!u?a.jsx(Ln,{to:"/parent/verify-pin",state:{from:s},replace:!0}):a.jsx(a.Fragment,{children:n}):a.jsx(Ln,{to:"/onboarding",state:{from:s},replace:!0})},oQ=()=>{const{currentMode:n,switchToChildMode:e}=OL(),t=Qt(),[s,i]=N.useState(!1),r=()=>{t("/parent/verify-pin")},o=()=>{n==="parent"&&i(!0)},c=()=>{e(),i(!1)};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mode-switcher",children:n==="child"?a.jsxs("button",{className:"mode-switch-button parent-mode",onClick:r,"aria-label":"Switch to parent mode",title:"Parent Mode",children:[a.jsx("span",{className:"mode-icon",children:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"10",cy:"7",r:"4",fill:"currentColor"}),a.jsx("path",{d:"M3 18C3 14.134 6.134 11 10 11C13.866 11 17 14.134 17 18",stroke:"currentColor",strokeWidth:"2",fill:"none"})]})}),a.jsx("span",{className:"mode-label",children:"Parent"})]}):a.jsxs("button",{className:"mode-switch-button child-mode",onClick:o,"aria-label":"Switch to child mode",title:"Back to Learning",children:[a.jsx("span",{className:"mode-icon",children:a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M10 4L3 9V17H7V13H13V17H17V9L10 4Z",fill:"currentColor"})})}),a.jsx("span",{className:"mode-label",children:"Learning"})]})}),s&&a.jsx("div",{className:"mode-switch-confirm-overlay",onClick:()=>i(!1),children:a.jsxs("div",{className:"mode-switch-confirm",onClick:d=>d.stopPropagation(),children:[a.jsx("div",{className:"confirm-icon",children:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"24",cy:"24",r:"22",fill:"#FFF3E0",stroke:"#FF9800",strokeWidth:"2"}),a.jsx("path",{d:"M24 14V28",stroke:"#FF9800",strokeWidth:"3",strokeLinecap:"round"}),a.jsx("circle",{cx:"24",cy:"34",r:"2",fill:"#FF9800"})]})}),a.jsx("h3",{children:"Switch to Child Mode?"}),a.jsx("p",{children:"You'll need to enter your PIN again to access parent settings."}),a.jsxs("div",{className:"confirm-actions",children:[a.jsx("button",{className:"confirm-cancel",onClick:()=>i(!1),children:"Cancel"}),a.jsx("button",{className:"confirm-switch",onClick:c,children:"Switch to Learning"})]})]})})]})},vxe=()=>{const n=[{to:"/learn",label:"Dashboard",icon:"",end:!0},{to:"/learn/achievements",label:"Progress",icon:""}];return a.jsx("nav",{className:"child-navigation",children:n.map(e=>a.jsxs(vG,{to:e.to,end:e.end,className:({isActive:t})=>`child-nav-item ${t?"active":""}`,children:[a.jsx("span",{className:"nav-icon",children:e.icon}),a.jsx("span",{className:"nav-label",children:e.label})]},e.to))})},wxe=()=>{var t;let n=0;try{const s=Vt();n=((t=s==null?void 0:s.children)==null?void 0:t.length)||0}catch{}const e=[{title:"Overview",items:[{to:"/parent/dashboard",label:"Dashboard",icon:""},{to:"/parent/children",label:"My Children",icon:"",badge:n}]},{title:"Learning",items:[{to:"/parent/reports",label:"Progress Reports",icon:""},{to:"/parent/safety",label:"Safety Logs",icon:""}]},{title:"Account",items:[{to:"/parent/settings",label:"Settings",icon:""},{to:"/parent/privacy",label:"Privacy Controls",icon:""},{to:"/parent/billing",label:"Subscription",icon:""}]},{title:"Help",items:[{to:"/parent/support",label:"Support",icon:""}]}];return a.jsx("nav",{className:"parent-navigation",children:e.map((s,i)=>a.jsxs("div",{className:"nav-section",children:[a.jsx("h3",{className:"nav-section-title",children:s.title}),a.jsx("ul",{className:"nav-section-items",children:s.items.map(r=>a.jsx("li",{children:a.jsxs(vG,{to:r.to,className:({isActive:o})=>`parent-nav-item ${o?"active":""}`,children:[a.jsx("span",{className:"nav-icon",children:r.icon}),a.jsx("span",{className:"nav-label",children:r.label}),r.badge!==void 0&&r.badge>0&&a.jsx("span",{className:"nav-badge",children:r.badge})]})},r.to))})]},i))})},Sxe={avatar_1:"",avatar_2:"",avatar_3:"",avatar_4:"",avatar_5:"",avatar_6:"",avatar_7:"",avatar_8:""},Cxe=({compact:n=!1})=>{const e=Qt(),{currentProfile:t,children:s,switchProfile:i,canAddChild:r,signOut:o,user:c}=Vt(),[d,h]=N.useState(!1),u=N.useRef(null);if(N.useEffect(()=>{const y=C=>{u.current&&!u.current.contains(C.target)&&h(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]),N.useEffect(()=>{const y=C=>{C.key==="Escape"&&h(!1)};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[]),!t||s.length===0)return null;const p=y=>{i(y),h(!1)},f=()=>{h(!1),e("/add-child")},m=()=>{h(!1),e("/parent")},x=()=>{h(!1),o(),e("/")},g=y=>Sxe[y]||"",b=y=>y===0?"Pre-K":`Grade ${y}`;return a.jsxs("div",{className:`profile-switcher ${n?"compact":""}`,ref:u,children:[a.jsxs("button",{className:"current-profile-btn",onClick:()=>h(!d),"aria-label":"Switch profile","aria-expanded":d,children:[a.jsx("div",{className:"profile-avatar",children:a.jsx("span",{className:"avatar-emoji",children:g(t.avatarUrl||t.avatarId)})}),!n&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"profile-info",children:[a.jsx("span",{className:"profile-name",children:t.displayName}),a.jsx("span",{className:"profile-grade",children:b(t.gradeLevel??t.grade)})]}),a.jsx("span",{className:`dropdown-arrow ${d?"open":""}`,children:a.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M2.5 4.5L6 8L9.5 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),a.jsx(Ie,{children:d&&a.jsxs(R.div,{className:"profile-dropdown",initial:{opacity:0,y:-8,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.95},transition:{duration:.15},children:[a.jsxs("div",{className:"dropdown-header",children:[a.jsx("span",{className:"header-label",children:"Switch Profile"}),a.jsxs("span",{className:"header-count",children:[s.length," profile",s.length!==1?"s":""]})]}),a.jsx("div",{className:"profile-list",children:s.map(y=>a.jsxs("button",{className:`profile-option ${y.id===t.id?"active":""}`,onClick:()=>p(y.id),children:[a.jsx("div",{className:"option-avatar",children:a.jsx("span",{className:"avatar-emoji",children:g(y.avatarUrl||y.avatarId)})}),a.jsxs("div",{className:"option-info",children:[a.jsx("span",{className:"option-name",children:y.displayName}),a.jsxs("span",{className:"option-details",children:[y.age?`Age ${y.age}`:"","  ",b(y.gradeLevel??y.grade)]})]}),y.id===t.id&&a.jsx("span",{className:"active-indicator",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M3 8L6.5 11.5L13 5",stroke:"#4CAF50",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},y.id))}),r&&a.jsxs("button",{className:"add-child-btn",onClick:f,children:[a.jsx("span",{className:"add-icon",children:"+"}),a.jsx("span",{children:"Add Another Child"})]}),a.jsx("div",{className:"dropdown-divider"}),a.jsxs("div",{className:"dropdown-footer",children:[a.jsxs("button",{className:"footer-btn",onClick:m,children:[a.jsx("span",{className:"footer-icon",children:""}),a.jsx("span",{children:"Parent Dashboard"})]}),a.jsxs("button",{className:"footer-btn",onClick:x,children:[a.jsx("span",{className:"footer-icon",children:""}),a.jsx("span",{children:"Sign Out"})]})]}),a.jsx("div",{className:"dropdown-user",children:a.jsx("span",{className:"user-email",children:c==null?void 0:c.email})})]})}),a.jsx("style",{children:`
        .profile-switcher {
          position: relative;
        }

        .current-profile-btn {
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 6px 12px;
          background: white;
          border: 2px solid #e0e0e0;
          border-radius: 50px;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .current-profile-btn:hover {
          border-color: #ffc107;
          box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
        }

        .profile-avatar {
          width: 36px;
          height: 36px;
          background: #ffc107;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .avatar-emoji {
          font-size: 1.25rem;
        }

        .profile-info {
          display: flex;
          flex-direction: column;
          text-align: left;
        }

        .profile-name {
          font-weight: 600;
          font-size: 0.875rem;
          color: #333;
          line-height: 1.2;
        }

        .profile-grade {
          font-size: 0.75rem;
          color: #666;
        }

        .dropdown-arrow {
          color: #666;
          transition: transform 0.2s ease;
        }

        .dropdown-arrow.open {
          transform: rotate(180deg);
        }

        /* Compact mode */
        .profile-switcher.compact .current-profile-btn {
          padding: 4px;
        }

        .profile-switcher.compact .profile-avatar {
          width: 32px;
          height: 32px;
        }

        .profile-switcher.compact .avatar-emoji {
          font-size: 1rem;
        }

        /* Dropdown */
        .profile-dropdown {
          position: absolute;
          top: calc(100% + 8px);
          right: 0;
          min-width: 280px;
          background: white;
          border-radius: 16px;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
          overflow: hidden;
          z-index: 1000;
        }

        .dropdown-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px 16px;
          background: #f9f9f9;
          border-bottom: 1px solid #eee;
        }

        .header-label {
          font-weight: 600;
          font-size: 0.8125rem;
          color: #333;
        }

        .header-count {
          font-size: 0.75rem;
          color: #999;
        }

        .profile-list {
          padding: 8px;
        }

        .profile-option {
          display: flex;
          align-items: center;
          gap: 12px;
          width: 100%;
          padding: 10px;
          background: transparent;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          transition: all 0.15s ease;
          text-align: left;
        }

        .profile-option:hover {
          background: #f5f5f5;
        }

        .profile-option.active {
          background: #fffde7;
        }

        .option-avatar {
          width: 40px;
          height: 40px;
          background: #ffc107;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
        }

        .option-info {
          flex: 1;
          display: flex;
          flex-direction: column;
        }

        .option-name {
          font-weight: 600;
          font-size: 0.9375rem;
          color: #333;
        }

        .option-details {
          font-size: 0.75rem;
          color: #666;
        }

        .active-indicator {
          flex-shrink: 0;
        }

        .add-child-btn {
          display: flex;
          align-items: center;
          gap: 8px;
          width: calc(100% - 16px);
          margin: 0 8px 8px;
          padding: 10px;
          background: #f5f5f5;
          border: 2px dashed #e0e0e0;
          border-radius: 10px;
          cursor: pointer;
          font-size: 0.875rem;
          color: #666;
          transition: all 0.15s ease;
        }

        .add-child-btn:hover {
          border-color: #ffc107;
          background: #fffde7;
          color: #f57c00;
        }

        .add-icon {
          width: 24px;
          height: 24px;
          background: #e0e0e0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: 1rem;
        }

        .add-child-btn:hover .add-icon {
          background: #ffc107;
          color: white;
        }

        .dropdown-divider {
          height: 1px;
          background: #eee;
          margin: 0 8px;
        }

        .dropdown-footer {
          padding: 8px;
        }

        .footer-btn {
          display: flex;
          align-items: center;
          gap: 10px;
          width: 100%;
          padding: 10px;
          background: transparent;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          font-size: 0.875rem;
          color: #666;
          transition: all 0.15s ease;
        }

        .footer-btn:hover {
          background: #f5f5f5;
          color: #333;
        }

        .footer-icon {
          font-size: 1rem;
        }

        .dropdown-user {
          padding: 10px 16px;
          background: #f9f9f9;
          border-top: 1px solid #eee;
        }

        .user-email {
          font-size: 0.75rem;
          color: #999;
        }

        @media (max-width: 480px) {
          .profile-dropdown {
            min-width: 260px;
          }
        }
      `})]})},Nxe=()=>{const n=Qt(),e=Qi();let t=null,s=[];try{const c=Vt();t=c==null?void 0:c.user,s=(c==null?void 0:c.children)||[]}catch{}let i=null;try{const c=OL();i=c==null?void 0:c.switchToChildMode}catch{}const r=()=>{n("/parent/dashboard")},o=()=>{i?i():n("/learn")};return a.jsxs("div",{className:"parent-layout",children:[a.jsxs("aside",{className:"parent-sidebar",children:[a.jsxs("div",{className:"sidebar-header",children:[a.jsx("button",{className:"sidebar-logo",onClick:r,children:a.jsx("img",{src:"/assets/Logo-nobg.png",alt:"OrbitLearn",className:"logo-image"})}),a.jsx("span",{className:"parent-badge",children:"Parent"})]}),a.jsx(wxe,{}),a.jsxs("div",{className:"sidebar-footer",children:[a.jsxs("button",{className:"switch-to-child-btn",onClick:o,children:[a.jsx("span",{className:"btn-icon",children:""}),a.jsx("span",{className:"btn-text",children:"Switch to Child View"})]}),t&&a.jsxs("div",{className:"parent-info",children:[a.jsx("span",{className:"parent-name",children:t.displayName||t.email}),a.jsxs("span",{className:"child-count",children:[s.length," ",s.length===1?"child":"children"]})]})]})]}),a.jsxs("div",{className:"parent-main-wrapper",children:[a.jsxs("header",{className:"parent-topbar",children:[a.jsx("div",{className:"topbar-left",children:a.jsx("h1",{className:"page-title",children:"Parent Dashboard"})}),a.jsxs("div",{className:"topbar-right",children:[a.jsx(oQ,{}),t&&a.jsx("div",{className:"user-menu",children:a.jsx("div",{className:"user-avatar",children:t.photoURL?a.jsx("img",{src:t.photoURL,alt:"Profile"}):a.jsx("span",{children:(t.displayName||t.email||"P")[0].toUpperCase()})})})]})]}),a.jsx("main",{className:"parent-main",children:a.jsx(gE,{},e.pathname)})]})]})},jxe=()=>{const n=Qi(),e=xG(),t=N.useRef(0);t.current++;const{isAuthenticated:s,hasConsent:i,isLoading:r,isReady:o,needsEmailVerification:c,needsConsent:d,needsChildProfile:h,currentProfile:u}=Vt();if(N.useEffect(()=>{console.log("[ProtectedChildLayout] Render #"+t.current),console.log("[ProtectedChildLayout] Location:",n.pathname),console.log("[ProtectedChildLayout] Matched routes:",e.map(f=>f.pathname).join(" -> "))}),N.useEffect(()=>{console.log("[ProtectedChildLayout] Route CHANGED to:",n.pathname)},[n.pathname]),r||!o)return console.log("[ProtectedChildLayout] Showing LOADING (isLoading:",r,"isReady:",o,")"),a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-gray-200 border-t-yellow-400 rounded-full"})});if(!s)return console.log("[ProtectedChildLayout] Redirecting to LOGIN (not authenticated)"),a.jsx(Ln,{to:"/login",state:{from:n.pathname},replace:!0});if(c)return console.log("[ProtectedChildLayout] Redirecting to ONBOARDING (email verification)"),a.jsx(Ln,{to:"/onboarding",state:{step:"email_verification"},replace:!0});if(d)return console.log("[ProtectedChildLayout] Redirecting to ONBOARDING (consent)"),a.jsx(Ln,{to:"/onboarding",state:{step:"consent_method"},replace:!0});if(h)return console.log("[ProtectedChildLayout] Redirecting to ONBOARDING (child profile)"),a.jsx(Ln,{to:"/onboarding",state:{step:"create_profile"},replace:!0});console.log("[ProtectedChildLayout] Rendering FULL LAYOUT for:",n.pathname);const p=()=>{if(!u)return"child-layout";const f=u.age;return f<=6?"child-layout young-learner":f<=9?"child-layout middle-learner":"child-layout older-learner"};return a.jsxs("div",{className:p(),children:[a.jsx(Axe,{}),a.jsxs("header",{className:"child-header",children:[a.jsx("div",{className:"child-header-left",children:a.jsx("div",{className:"app-logo",children:a.jsx("img",{src:"/assets/Logo-nobg.png",alt:"OrbitLearn",className:"logo-image"})})}),a.jsx("div",{className:"child-header-center",children:a.jsx(vxe,{})}),a.jsxs("div",{className:"child-header-right",children:[a.jsx(Cxe,{compact:!0}),a.jsx(oQ,{})]})]}),a.jsx("main",{className:"child-main",children:a.jsx(gE,{})},n.pathname),u&&u.age<=8&&a.jsxs("div",{className:"jeffrey-helper",children:[a.jsx("div",{className:"jeffrey-avatar",children:a.jsx("span",{children:""})}),a.jsx("button",{className:"help-button",children:"Need help?"})]})]})},Axe=()=>a.jsxs("div",{className:"cloud-background",children:[a.jsx(R.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1.5,ease:"easeOut"},className:"cloud-top",children:a.jsx("img",{src:"/assets/images/clouds/cloud_backdrop_top.png",alt:"",className:"cloud-image cloud-fade-down"})}),a.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:1.5,ease:"easeOut",delay:.3},className:"cloud-bottom",children:a.jsx("img",{src:"/assets/images/clouds/cloud_backdrop_bottom.png",alt:"",className:"cloud-image cloud-fade-up"})}),a.jsx(R.img,{src:"/assets/images/clouds/cloud_single_1.png",alt:"",className:"cloud-float cloud-float-1",animate:{x:[0,15,0],y:[0,5,0]},transition:{duration:20,repeat:1/0,ease:"easeInOut"}}),a.jsx(R.img,{src:"/assets/images/clouds/cloud_single_2.png",alt:"",className:"cloud-float cloud-float-2",animate:{x:[0,-20,0],y:[0,8,0]},transition:{duration:25,repeat:1/0,ease:"easeInOut"}}),a.jsx(R.img,{src:"/assets/images/clouds/cloud_single_1.png",alt:"",className:"cloud-float cloud-float-3",animate:{x:[0,-10,0]},transition:{duration:18,repeat:1/0,ease:"easeInOut"}})]}),Exe=()=>{const n=Qt(),e=Qi(),{switchToParentMode:t,hasParentPin:s,isLocked:i,remainingAttempts:r,timeUntilUnlock:o}=OL(),[c,d]=N.useState(["","","",""]),[h,u]=N.useState(""),[p,f]=N.useState(!1),m=N.useRef([]);N.useEffect(()=>{var w;(w=m.current[0])==null||w.focus()},[]);const x=(w,S)=>{var T;if(S&&!/^\d$/.test(S))return;const j=[...c];if(j[w]=S,d(j),u(""),S&&w<3&&((T=m.current[w+1])==null||T.focus()),w===3&&S){const k=j.join("");y(k)}},g=(w,S)=>{var j;S.key==="Backspace"&&!c[w]&&w>0&&((j=m.current[w-1])==null||j.focus())},b=w=>{w.preventDefault();const S=w.clipboardData.getData("text").replace(/\D/g,"").slice(0,4);if(S.length===4){const j=S.split("");d(j),y(S)}},y=async w=>{var S,j,T,k;if(i){u(`Too many attempts. Try again in ${o} minutes.`);return}f(!0),u("");try{if(await t(w)){const L=((j=(S=e.state)==null?void 0:S.from)==null?void 0:j.pathname)||"/parent/dashboard";n(L)}else u(i?`Too many attempts. Try again in ${o} minutes.`:s?`Incorrect PIN. ${r} attempt${r!==1?"s":""} remaining.`:"PIN must be 4 digits."),d(["","","",""]),(T=m.current[0])==null||T.focus()}catch{u("Failed to verify PIN. Please try again."),d(["","","",""]),(k=m.current[0])==null||k.focus()}finally{f(!1)}},C=()=>{n("/learn")};return a.jsx("div",{className:"pin-verification-screen",children:a.jsxs("div",{className:"pin-verification-container",children:[a.jsxs("div",{className:"pin-header",children:[a.jsx("div",{className:"parent-icon",children:a.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"32",cy:"32",r:"32",fill:"#E3F2FD"}),a.jsx("circle",{cx:"32",cy:"24",r:"10",fill:"#2196F3"}),a.jsx("path",{d:"M16 52C16 43.16 23.16 36 32 36C40.84 36 48 43.16 48 52",stroke:"#2196F3",strokeWidth:"4",fill:"none"})]})}),a.jsx("h2",{children:s?"Enter Parent PIN":"Set Parent PIN"}),a.jsx("p",{className:"pin-description",children:s?"Enter your 4-digit PIN to access parent controls":"Create a 4-digit PIN to protect parent settings"})]}),i?a.jsxs("div",{className:"lockout-message",children:[a.jsx("span",{className:"lockout-icon",children:""}),a.jsx("p",{children:"Too many failed attempts"}),a.jsxs("p",{className:"lockout-time",children:["Try again in ",o," minutes"]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pin-input-group",onPaste:b,children:c.map((w,S)=>a.jsx("input",{ref:j=>m.current[S]=j,type:"tel",inputMode:"numeric",maxLength:1,value:w,onChange:j=>x(S,j.target.value),onKeyDown:j=>g(S,j),className:`pin-input ${h?"error":""}`,disabled:p,"aria-label":`PIN digit ${S+1}`},S))}),h&&a.jsxs("div",{className:"pin-error",children:[a.jsx("span",{className:"error-icon",children:"!"}),h]}),p&&a.jsxs("div",{className:"pin-verifying",children:[a.jsx("span",{className:"verifying-spinner"}),"Verifying..."]})]}),a.jsx("div",{className:"pin-actions",children:a.jsxs("button",{className:"cancel-button",onClick:C,disabled:p,children:[a.jsx("span",{className:"back-icon",children:""}),"Back to Learning"]})}),!s&&!i&&a.jsxs("div",{className:"pin-setup-notice",children:[a.jsx("div",{className:"notice-icon",children:""}),a.jsxs("div",{className:"notice-content",children:[a.jsx("p",{children:a.jsx("strong",{children:"Remember your PIN!"})}),a.jsx("p",{children:"You'll need it to access parent settings, billing, and reports."})]})]}),a.jsxs("div",{className:"pin-security-notice",children:[a.jsx("span",{className:"lock-icon",children:""}),a.jsx("span",{children:"Your PIN is stored securely and never shared with your child."})]})]})})};function kxe(){return a.jsx(Pte,{children:a.jsx(Ite,{children:a.jsx(Fte,{children:a.jsx(tse,{children:a.jsx(rse,{children:a.jsx(Gte,{children:a.jsxs(Kte,{children:[a.jsx(wG,{getKey:n=>n.pathname}),a.jsx(Zte,{children:a.jsx(gE,{})}),a.jsx(epe,{}),a.jsx(sge,{})]})})})})})})})}function Txe(){return a.jsxs(Jte,{children:[a.jsx(wG,{getKey:n=>n.pathname}),a.jsx(gE,{})]})}function _xe({title:n}){return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",textAlign:"center",padding:"40px"},children:[a.jsx("h1",{style:{fontSize:"1.5rem",marginBottom:"16px",color:"#333"},children:n}),a.jsx("p",{style:{color:"#666",fontSize:"1rem"},children:"This page is coming soon."})]})}const Pxe=ate([{path:"/",element:a.jsx(kxe,{}),children:[{index:!0,element:a.jsx(Ooe,{})},{path:"login",element:a.jsx(kge,{})},{path:"onboarding",element:a.jsx(Vz,{})},{path:"learn",element:a.jsx(jxe,{}),children:[{index:!0,element:a.jsx(Phe,{})},{path:"study",element:a.jsx(Ln,{to:"/learn",replace:!0})},{path:"study/:lessonId",element:a.jsx(Yme,{})},{path:"achievements",element:a.jsx(Kme,{})},{path:"flashcards",element:a.jsx(Oz,{})},{path:"flashcards/:deckId",element:a.jsx(Oz,{})},{path:"notebook",element:a.jsx(lge,{})}]},{path:"study",element:a.jsx(Ln,{to:"/learn",replace:!0})},{path:"achievements",element:a.jsx(Ln,{to:"/learn/achievements",replace:!0})},{path:"flashcards",element:a.jsx(Ln,{to:"/learn/flashcards",replace:!0})},{path:"parent/verify-pin",element:a.jsx(VR,{requireProfile:!1,children:a.jsx(Exe,{})})},{path:"parent",element:a.jsx(VR,{requireProfile:!1,children:a.jsx(bxe,{mode:"parent",children:a.jsx(Nxe,{})})}),children:[{index:!0,element:a.jsx(Ln,{to:"/parent/dashboard",replace:!0})},{path:"dashboard",element:a.jsx(bge,{})},{path:"children",element:a.jsx(jge,{})},{path:"children/:childId",element:a.jsx(Ege,{})},{path:"children/:childId/notebook",element:a.jsx(_ge,{})},{path:"reports",element:a.jsx(Hge,{})},{path:"safety",element:a.jsx(Fge,{})},{path:"settings",element:a.jsx($ge,{})},{path:"privacy",element:a.jsx(Uge,{})},{path:"billing",element:a.jsx(_xe,{title:"Subscription"})},{path:"support",element:a.jsx(Wge,{})}]},{path:"add-child",element:a.jsx(VR,{requireProfile:!1,children:a.jsx(Vz,{initialStep:"create_profile"})})},{path:"*",element:a.jsx(Ln,{to:"/learn",replace:!0})}]},{path:"/teacher",element:a.jsx(Txe,{}),children:[{path:"login",element:a.jsx(Yge,{})},{path:"signup",element:a.jsx(Xge,{})},{path:"verify-email",element:a.jsx(Kge,{})},{index:!0,element:a.jsx(Im,{children:a.jsx(Ln,{to:"/teacher/dashboard",replace:!0})})},{path:"dashboard",element:a.jsx(Im,{children:a.jsx(Jge,{})})},{path:"content",element:a.jsx(Im,{children:a.jsx(exe,{})})},{path:"content/create",element:a.jsx(Im,{children:a.jsx(oxe,{})})},{path:"content/:id",element:a.jsx(Im,{children:a.jsx(gxe,{})})},{path:"usage",element:a.jsx(Im,{children:a.jsx(xxe,{})})},{path:"grading",element:a.jsx(Im,{children:a.jsx(yxe,{})})},{path:"*",element:a.jsx(Ln,{to:"/teacher/dashboard",replace:!0})}]}]);function Lxe(){return a.jsx(fte,{router:Pxe})}YR.createRoot(document.getElementById("root")).render(a.jsx(Td.StrictMode,{children:a.jsx(Lxe,{})}));export{Z5 as A,js as B,SE as C,va as F,Mme as H,nc as L,Wme as P,gue as S,d3 as W,voe as Z,fue as a,by as b,ae as c,Ie as d,Cr as e,Ki as f,Ut as g,a as j,R as m,N as r};
